000100200423      * %ATTR OPTION(*XREF *GEN) DBGVIEW(*LIST)
000110200605       IDENTIFICATION DIVISION.
000120200918       PROGRAM-ID.     TRNPST.
000130200501       INSTALLATION.   JEWELSTONE SYSTEMS INC.
000140210616       AUTHOR.         Ralph C. Hollander.
000150200423       DATE-WRITTEN.   April 1993.
000160210322       DATE-COMPILED.
000170210729R98466 COPY CPTRNCOMM.
000180201222      ******************************************************************
000190210408      *    C H A N G E   H I S T O R Y                                 *
000200200624      ******************************************************************
000210210623      * Please add change history into copybook CPYTRNPST.             *
000220200423      ******************************************************************
000230210408R29550 COPY CPYTRNPST.
000240210405       ENVIRONMENT DIVISION.
000250210405       CONFIGURATION SECTION.
000260210531       SOURCE-COMPUTER. IBM-AS400.
000270200423       OBJECT-COMPUTER. IBM-AS400.
000280210803       SPECIAL-NAMES.
000290210809187471     LINKAGE TYPE IS PROCEDURE FOR "FXGDTHVSCV"
000291210916186588     LINKAGE TYPE IS PROCEDURE FOR "FXTRNPRSEQ"
000300200423R17685     DATA-AREA IS WS-DTAARA-MFAPRCDTP
000310200423R72268     DATA-AREA IS lc_dtaaraMfaobjects
000320200423R96527     DATA-AREA IS WS-DTAARA-MFASEGPARM
000330200423117124     DATA-AREA IS WS-DTAARA-MFAGICPARM
000340200423R98866     DATA-AREA IS WS-DTAARA-WKRDSPDATA
000350200423           LOCAL-DATA IS WS-LOCAL.
000360200423      /
000370200423       INPUT-OUTPUT SECTION.
000380200423R50475 COPY CPYTPFILES.
000390200423       WORKING-STORAGE SECTION.
000400200423      *    W O R K I N G   S T O R A G E   S E C T I O N               *
000410200423      ** RFS 18281 begin
000420200423      *** CopyBook - Rejections   ***
000430200423       COPY CPYREJCD.
000440210218185788 COPY CPDSTOPT.
000450200423      ** RFS 18281 end
000460201223      * RFS185174 - Start: Copybook to get DSC Active Units
000470201223       COPY CPGETDSCU.
000480201223      * RFS185174 - End
000490210223      *RFS177665 - Starts
000500200423       01 lc_SWOInvestmentCode                 PIC X(05) VALUE SPACES.
000510200423       01 lc_SWIInvestmentCode                 PIC X(05) VALUE SPACES.
000520200423       01 lc_SameInvStructFlag                 PIC X(01) VALUE SPACES.
000530200423       01 lc_ERFSwoExistFlag                   PIC X(01) VALUE SPACES.
000540200423       01 ln_RecCounter                        PIC 9(01) VALUE 0.
000550200423       01 lc_FunctionCode                      PIC X(10) VALUE SPACES.
000560200423       01 lc_FuncInvStructureCode              PIC X(05) VALUE SPACES.
000570200423      *RFS177665 - Ends
000580200423      * RFS49699 - Begin
000590200423      *  screen edits allowed
000600200423           copy CPSCEDTAL1.
000610200423      *  log array info
000620200423           copy CPFXLOGAU.
000630200423      *  log array table name
000640200423           copy CPFXLOGAT.
000650200423      * RFS49699 - End
000660201001R96527* Copy Book for Age Validation
000670200423R96527 COPY CPYFXSGAGV.
000680200423R98866* Copy Book for RDSP Data
000690200423R98866 COPY CPRDSDATA.
000700200423112135 COPY CPTRFVAL.
000710200423103858 COPY CPDEPCOMP.
000720200423103858 COPY CPCLCDEPMA.
000730200423121057 COPY CPYCHKACON.
000740200423122815 COPY CPACCACB.
000750200423      * RFS39005 - Begin: to keep units to calculate proportion
000760200423       01 ln_unitsFrom PIC S9(10)V999 COMP-3.
000770200423       01 ln_unitsTo   PIC S9(10)V999 COMP-3.
000780200423      * RFS39005 - End
000790200423      * RFS35909 - Start
000800200423       01 ln_currContractNo PIC S9(09) VALUE 0.
000810200423      * RFS35909 - End
000820200423      * RFS80602 - Start
000830200423       01 ln_MinWithdrawalAmt PIC S9(11)V9(02) COMP-3.
000840200423      * RFS80602 - End
000850200423      * RFS15626 - Begin
000860200423       01 WD-FORMAT-FIELDS.
000870200423         03 WD-CCYYMMDD         FORMAT DATE "@Y%m%d".
000880200423         03 WD-CCYYMMDD-1       FORMAT DATE "@Y%m%d".
000890200423103858   03 WD-CCYYMMDD-2       FORMAT DATE "@Y%m%d".
000900200423103858   03 WD-CCYYMMDD-3       FORMAT DATE "@Y%m%d".
000910200423      * RFS47719 - Begin
000920200423       01 li_ChangeDate            PICTURE S9(8).
000930200423       01 li_ChangeDateR REDEFINES li_ChangeDate
000940200423                                   FORMAT DATE "@Y%m%d".
000950200423      * RFS47719 - End
000960200423      * RFS42622 - Begin
000970200423       01 lc_refNumber.
000980200423         03 ln_placementDate  PIC S9(09) COMP-3.
000990200423         03 ln_transNo        PIC S9(09) COMP-3.
001000200423       01 ln_commRate         PIC S9(04)V9(03) COMP-3.
001010200507      * RFS42622 - End
001020200507      * RFS 1015797 - Begin
001030200507       01 lc_negativeUnitsFlag PIC X(1)            VALUE SPACES.
001040200507          88 lncc_negativeunitsOn                  VALUE "Y".
001050200507       01 lc-ACtionCode       PIC X(03).
001060200507       01 lc-ReturnCodeS      PIC X(02).
001070200507      * RFS 1015797 - End
001080210405      * RFS 1104788 - Begin
001090210405       01 lc_ExtLoadTyp       PIC X(10).
001100210405       01 lc_CommRecovCde     PIC X(05).
001110210405      * RFS 1104788 - Ends
001120210720      * RFS 186019 - Starts
001130210720       01 lc_REGR_ACCR        PIC X(01).
001140210720       01 lc_DealerCode       PIC X(04).
001150210720       01 lc_DealerRepCode    PIC X(06).
001160210720      * RFS 1186019 - Ends
001170210405
001180200423      * RFS128793- Begin
001190200423       01 ln_accountno        PIC S9(09).
001200200423       01 ln_placementDate1   PIC S9(09).
001210200423       01 ln_transNo1         PIC S9(09).
001220200423       01 ln_Investmentcode   PIC X(05).
001230200423       01 ln_Tradeamount      PIC S9(09)V9(02) COMP-3.
001240200423       01 lc_Rejcode          PIC X(02).
001250200423       01 lnc_00              PIC 9(02) Value     ZEROS.
001260200423       01 lnc_G44             PIC X(03) Value     "G44".
001270200423       01 ln_unitbalance      PIC S9(09)V9(02).
001280200423       01 ln_CertIDNo         PIC S9(10).
001290200423       01 lc_ByPassCGrossamt   PIC X(01).
001300200423         88  lncc_ByPassCGrossamt-YES              VALUE "Y".
001310200423         88  lncc_ByPassCGrossamt-NO               VALUE "N".
001320200423      * RFS128793- End
001330200423
001340201223      *RFS180707 - Starts
001350201223       01 lc_ACINDSCInvCode         PIC X(5)  VALUE SPACES.
001360201223       01 lc_ACINDSCFncCode         PIC X(10) VALUE "ACINDSC".
001370201223       01 lc_InvestmentStructure    PIC X(10) VALUE SPACES.
001380201223       01 lc_ACINDSCDecINRSTRF      PIC X(1)  VALUE "Y".
001390201223       01 lc_ACINDSCFlag            PIC X(01) VALUE SPACES.
001400201223         88 lnc_ACINDSCYes                    VALUE "Y".
001410201223         88 lnc_ACINDSCNo                     VALUE "N".
001420201223      *RFS180707- Ends
001430210316      *RFS181302-Starts.
001440200423       01 Lb_TriggerInterest   PIC X(01).
001450200423         88  Lb_TriggerInterestYES            VALUE "Y" "O".
001460200423         88  Lb_TriggerInterestNO             VALUE "N" " ".
001470200423      *RFS181302-Ends.
001480210316      *RFS1101968-Start
001490210405       01  Lncc_C                             PIC X(01) VALUE "C".
001500210316      *RFS1101968-End
001510200423      *RFS1005983 - Starts
001520200423       01 Ln_RDSPTotalIncentives PIC S9(11)V9(02) COMP-3.
001530200423       01 Ln_RDSPDenominator PIC S9(11)V9(02) COMP-3.
001540200423      *RFS1005983 - Ends
001550200423       01 WS-DURATION-VARS.
001560200423         03 WS-DURATION         PIC 9(09).
001570200423       01 WS-OUT-DATE           PIC 9(08).
001580200423       01 WS-CURR-GRACE-VARS.
001590200423         05 WS-CURR-GRACE-CALCULATION-TYPE PIC X(01).
001600200423         05 WS-CURR-GRACE-DAYS             PIC S9(03) PACKED-DECIMAL.
001610200423         05 WS-CURR-JURISDICTION           PIC X(03).
001620200423         05 WS-CURR-DSC-WAIVE-OPTION-FLAG        PIC X(01).
001630200423            88 ws-curr-dsc-waive-option-none     VALUE "N".
001640200423            88 ws-curr-dsc-waive-option-all      VALUE "A".
001650200423            88 ws-curr-dsc-waive-option-grace    VALUE "R".
001660200423       01 WS-TEMP-VARS.
001670200423         05 WS-TEMP-PLACEMENT-DATE    PIC S9(09) COMP-3.
001680200423         05 WS-TEMP-TRANS-NO          PIC S9(09) COMP-3.
001690200423      * RFS15626 - End
001700200423      * RFS19210 - Begin
001710200423       01 DISPLAY-DATA.
001720200423         05 DSP-ACCOUNT-NO          PIC -9(08)9.
001730200423         05 DSP-PLACEMENT-DATE      PIC -9(08)9.
001740200423         05 DSP-TRANS-NO            PIC -9(08)9.
001750200423      * RFS19210 - End
001760200423      * RFS16505 - Begin
001770200423      * ---------------------------------
001780200423       01 LNK-GETDSCMET-PARAMETERS.
001790200423         05 LNK-ACCOUNT-NO                      PIC S9(09).
001800200423         05 LNK-TRANS-TYPE-CODE                 PIC X(03).
001810200423         05 LNK-TRANS-ORIGIN-CODE               PIC X(03).
001820200423112134   05 LNK-TRANS-SUBTYPE                   PIC X(05).
001830200423         05 LNK-DSC-REDUCTION-METHOD            PIC X(01).
001840200423           88 LNK-DSC-REDUCTION-METHOD-CHRG       VALUE "C".
001850200423112134     88 LNK-DSC-REDUCTION-METHOD-WAIVE      VALUE "S".
001860200423         05 LNK-RET-CODE                        PIC X(02).
001870200423           88 LNK-RET-CODE-OK                     VALUE SPACES.
001880200423           88 LNK-RET-CODE-ACC-NOT-EXIST          VALUE "20".
001890200423           88 LNK-RET-CODE-DSC-RED-NOT-EXIST      VALUE "22".
001900200423      * RFS16505 - End
001910200423      * RFS 98866 - Start
001920200423       01  PASS-CDSC-CALCULATOR-FLAG             PIC X(01).
001930200423         88  PASS-CDSC-CALCULATOR-YES              VALUE "Y".
001940200423         88  PASS-CDSC-CALCULATOR-NO               VALUE "N".
001950200423      * RFS 98866 - End
001960200423      * RFS5512 - Begin
001970200423       01 WS-REMAINING-BAL-THRESHOLD-X                PIC X(05).
001980200423       01 WS-REMAINING-BAL-THRESHOLD
001990200423            REDEFINES WS-REMAINING-BAL-THRESHOLD-X    PIC 9(2)V9(03).
002000200423       01 WS-REMAINING-BAL-THRESHOLD-MIN              PIC S9(2)V9(03)
002010200423                                                      VALUE ZEROES.
002020200423      * RFS5512 - End
002030200423      * RFS16522 - Begin
002040200423       01 WS-PROCESS-AAP-EXCEPTION PIC X(01) VALUE SPACES.               RFS9932
002050200423      * RFS16522 - End
002060200423      * RFS20722 Start
002070200423       01 WS-TRACK-RE-INVESTED-DISTRIB PIC X(01) VALUE SPACES.           RFS9932
002080200423      * RFS20722 End
002090200423      * RFS20311 Start
002100200423       01 WS-VALIDATE-REP-ACTIVE       PIC X(01) VALUE SPACES.           RFS9932
002110200423       01 WS-VALIDATE-REP-EXISTS       PIC X(01) VALUE SPACES.           RFS9932
002120200423      * RFS20311 End
002130200423      * RFS22180 - Begin
002140200423       01 WS-VALIDATE-INV-MISC-DETAIL-FL PIC X(01).
002150200423         88 WS-VALIDATE-INV-MISC-DETAIL   VALUE "Y".
002160200423      * RFS22180 - End
002170200423      * RFS17813 - Begin
002180200423       01 WS-BASE-CURRENCY         PIC X(03) VALUE SPACES.
002190200423      * RFS17813 - End
002200200423      * RFS20883 - Begin
002210200423       01 WS-GEN-TRADES-ON-HLD-FLAG PIC X(01) VALUE SPACES.
002220200423         88 WS-GEN-TRADES-ON-HLD    VALUE "Y".
002230200423      * RFS20883 - End
002240200423      * RFS43082 - Begin
002250200423       01 lc_cdscScheduleFlag      PIC 1.
002260200423         88 lncc_cdscScheduleNotExists VALUE B"0".
002270200423         88 lncc_cdscScheduleExists    VALUE B"1".
002280200423      * RFS43082 - End
002290200423      * RFS45141 - Begin
002300200423       01 lncc_SYSAOT              PIC X(06) VALUE "SYSAOT".
002310200423       01 lncc_createdBySYSAOT     PIC X(10) VALUE "SYS.AOT".
002320200423114676 01 lncc_SYEFTB              PIC X(06) VALUE "SYEFTB".
002330200423114676 01 lncc_createdBySYEFTB     PIC X(10) VALUE "SYS.EFTBUY".
002340200423       01 lc_saveTransStatusCode   PIC X(03) VALUE SPACES.
002350200423       01 lncc_PND                 PIC X(03) VALUE "PND".
002360200423      * RFS45141 - End
002370200423107679 COPY CPORCNTMAG.
002380200423107679 01 lc_FlagCallFXCNTMATAG              PIC X(01) VALUE SPACES.
002390200423107679   88 lc_FlagCallFXCNTMATAGYes                   VALUE "Y".
002400200423107679 01  li_orgCntMaturity                 PIC 9(08).
002410200423107679 COPY CPRTVJOBA.
002420200423107679 COPY CPSEGLOG.
002430200423146960 COPY CPSEQAWD.
002440200423139287 COPY CPANDLRVAL.
002450200423      * RFS115495 - Start
002460200423       01  lb_WVNRTFunc            PIC X(01) VALUE SPACES.
002470200423         88  lb_WVNRTFuncNo              VALUE "N".
002480200423         88  lb_WVNRTFuncYes             VALUE "Y".
002490200423       01  lb_EOF-Inv-Struct       PIC X(01) VALUE SPACES.
002500200423         88  lb_EOF-Inv-StructNo         VALUE "N".
002510200423         88  lb_EOF-Inv-StructYes        VALUE "Y".
002520200423       01  lnc_16                  PIC X(02) VALUE "16".
002530200423       01  lc_Account-Type-Code    PIC X(05) VALUE SPACES.
002540200423       01  lnc_WVNRT               PIC X(05) VALUE "WVNRT".
002550200423      * RFS115495 - End
002560200423      * RFS112944 - Start
002570200423       01 lc_RewriteFlag           PIC X(1) VALUE "N".
002580200423          88 lb_RewriteYes               VALUE "Y".
002590200423          88 lb_RewriteNo                VALUE "N".
002600200423       01 lc_WriteFlag           PIC X(1)  VALUE "N".
002610200423          88 lb_WriteYes               VALUE "Y".
002620200423          88 lb_WriteNo                VALUE "N".
002630200423      * RFS112944 - End
002640200423      * RFS120585 - Start
002650200423       01 lc_ProceedFlag           PIC X(1) VALUE "N".
002660200423          88 lb_NotProceedFlag           VALUE "Y".
002670200423          88 lb_ProceedFlag              VALUE "N".
002680200423       01 lc_EndFlag               PIC X(1)  VALUE "N".
002690200423          88 lb_EndFlag                VALUE "Y".
002700200423          88 lb_NotEndFlag             VALUE "N".
002710200423      * RFS120585 - End
002720200423122815 01 lc_OnlineMode            PIC X(1)  VALUE "N".
002730200423122815    88 lb_OnlineYes              VALUE "Y".
002740200423122815    88 lb_OnlineNo               VALUE "N".
002750200423      * RFS92145 - Start
002760200423       01 lncc_MREB                PIC X(04) VALUE "MREB".
002770200423       01 lncc_MFR                 PIC X(03) VALUE "MFR".
002780200423       01 lncc_UNC                 PIC X(03) VALUE "UNC".
002790200423       01 lncc_REI                 PIC X(03) VALUE "REI".
002800200423       01 lncc_M01                 PIC X(03) VALUE "M01".
002810200423       01 lncc_M02                 PIC X(03) VALUE "M02".
002820200423       01 lncc_99                  PIC X(02) VALUE "99".
002830200423113773 01 lnc_63                   PIC X(02) VALUE "63".
002840200423113773 01 lnc_ContractNo           PIC S9(9) VALUE ZEROES.
002850200423119916 01 lnc_Dii                  PIC X(03) VALUE "DII".
002860200423       01 lncc_U                   PIC X(01) VALUE "U".
002870200423      * RFS92504 - Start.
002880200423       01 lncc_MRG                 PIC X(03) VALUE "MRG".
002890200423       01 lncc_SWO                 PIC X(03) VALUE "SWO".
002900200423       01 lncc_S                   PIC X(01) VALUE "S".
002910200423      * RFS92504 - End.
002920200423139287 01 lnc_DTH                  PIC X(03) VALUE "DTH".
002930200423139287 01 lc_DLRVALIDFLG           PIC X(01) VALUE SPACES.
002940200423      * Parms to call FXMFRESP and MFMFRCAP functions
002950200423       01 li_PlacementDate           PIC S9(8).
002960200423       01 li_TransNo                 PIC S9(9).
002970200423       01 li_AccountNo               PIC S9(9).
002980200423       01 li_AccountNoTRI            PIC S9(9).
002990200423       01 lc_InvestmentCode          PIC X(5).
003000200423       01 li_TradeDate               PIC S9(8).
003010200423       01 ln_UnitAmount              PIC S9(10)V999.
003020200423       01 lc_TransTypeCode           PIC X(3).
003030200423       01 lc_FullRedemption          PIC X(1).
003040200423       01 lc_ReturnCode              PIC X(2).
003050200423       01 ln_MFRAMT                  PIC S9(11)V99.
003060200423       01 ln_PSTAMT                  PIC S9(11)V99.
003070200423       01 ln_GSTAMT                  PIC S9(11)V99.
003080200423      * RFS92145 - End
003090200709      * RFS184676 Starts
003100200714185172*01 li_AnnuitantContractAge    PIC S9(03).
003110201001   |   01 li_AnnuitantContractAge    PIC S9(07)V9(04).
003120200714   |  *01 li_AnnuitantAge_GDth       PIC S9(03).
003130200714185172 01 li_AnnuitantAge_GDth       PIC S9(07)V9(04).
003140200714       01 ld_YoungerAnnDOB           PIC S9(08).
003150200709       COPY CPCHKGDTHV.
003160200709      * RFS184676 Ends
003170200423      * RFS92504 - Start.
003180200423       01 lc_MoveCRT           PIC  X(01)    VALUE SPACES.
003190200423       01 ln_TotCertSWI        PIC S9(10)V9(03)
003200200423                                             VALUE ZEROES.
003210200423       01 ln_CertUnitsSWI      PIC S9(10)V9(03)
003220200423                                             VALUE ZEROES.
003230200423       01 lc_NewCertNo         PIC  X(07).
003240200423       01 ln_NewCertNo REDEFINES lc_NewCertNo
003250200423                               PIC  9(07).
003260200423       01 ln_NewCertNo1        PIC  9(07)    VALUE ZEROES.
003270200423       01 ln_Length            PIC  9(07)    VALUE ZEROES.
003280200423       01 lc_CertRecStatus     PIC  X(1)     VALUE "Y".
003290200423          88 lb_CertNotFound                 VALUE "N".
003300200423          88 lb_CertFound                    VALUE "Y".
003310200423       01 lc_CertEOF           PIC  X(1)     VALUE "N".
003320200423          88 lb_CertEOF                      VALUE "Y".
003330200423      * RFS92504 - End.
003340200423      * RFS117124 - Start
003350200423        COPY CPYGICTERM.
003360200423120931  COPY CPYFXSAWDT.
003370200423117124  COPY CPGMATDAT.
003380200423        01 ln_GICTerm          PIC S9(07).
003390200423        01 ln_GICTermR Redefines ln_GICTerm.
003400200423           05 ln_GICTermYears  PIC S9(04).
003410200423           05 ln_GICTermDays   PIC S9(03).
003420200423      * RFS117124 - End
003430200423      * RFS92475 - Start.
003440200423       01 lc_CalcMode          PIC X(01)     VALUE " ".
003450200423       01 Lb-EOF-FeeExcln      PIC X(01).
003460200423         88 Lb-EOF-FeeExc-Yes                VALUE "Y".
003470200423         88 Lb-EOF-FeeExc-No                 VALUE "N".
003480200423      * RFS92475 - End.
003490200423      *RFS96530 - START
003500200423       01 Lc-EOF-Schcode       PIC X(01).
003510200423         88 Lc-EOF-Schcode-Yes                VALUE "Y".
003520200423         88 Lc-EOF-Schcode-No                 VALUE "N".
003530200423       01 Lc-Schcode-Flag      PIC X(01).
003540200423         88 Lc-Schcode-Yes                    VALUE "Y".
003550200423         88 Lc-Schcode-No                     VALUE "N".
003560200423      *RFS96530 - END
003570200423      * RFS 52265 - begins.
003580200423       01 lc_Bypass            PIC X(01).
003590200423       01 lc_Trans_Type_Code   PIC X(3).
003600200423       01 lc_Trans_Sub_Type    PIC X(5).
003610200423       01 lc_Trans_Origin_Code PIC X(3).
003620200423       01 lc_Exemption_Rule    PIC X(2).
003630200423       01 Lb-EOF-TrnExempt     PIC X(01).
003640200423         88 Lb-EOF-TrnExempt-Yes                VALUE "Y".
003650200423         88 Lb-EOF-TrnExempt-No                 VALUE "N".
003660200423      * RFS 52265 - ends.
00367020042345781  01 ln_Trade_Amt         PIC S9(13)V99 VALUE ZEROES.
003680200423  ¦    01 ln_AccInv_MV         PIC S9(13)V99 VALUE ZEROES.
003690200423D.26   01 ln_Round             PIC 9(03)V9(03) COMP-3 VALUE 0.010.
003700200423  ¦    01 lc_WaiveInvMin_Flag  PIC X(1) VALUE SPACES.
003710200423  ¦       88 lc_WaiveFlag      VALUE "Y".
003720200423D.22  *   88 lc_NotWaiveFlag   VALUE "N".
003730200423D.22      88 lc_NotWaiveFlag   VALUE " ".
003740200423  ¦    01 lc_Drive_Rule      PIC X(3) VALUE SPACES.
003750200423D.30      88 lc_Origin_DCA        VALUES "DCA".
003760200423D.30      88 lc_Origin_AWD        VALUES "AWD" "AWC" "AWE" "AWR".
003770200423117763    88 lc_Origin_PAC        VALUES "PAC".
003780200423  ¦    01 lc_ReadFlag          PIC X(1) VALUE SPACES.
003790200423  ¦       88 lc_ReadOk         VALUE "Y".
00380020042345781     88 lc_ReadNotOk      VALUE "N".
003810200423      * RFS92145 - Start
003820200423       01 lc_MFRAccrualOn      PIC X(1) VALUE SPACES.
003830200423          88 lb_MFRAccrualOn   VALUE "Y".
003840200423       01 lc_MFRTransLoop      PIC X(1) VALUE SPACES.
003850200423          88 lb_MFRTransLoop   VALUE "Y".
003860200423       01 lc_MFRTransEOF       PIC X(1) VALUE SPACES.
003870200423          88 lb_MFRTransEOF    VALUE "Y".
003880200423       01 lc_MFRTransFound     PIC X(1) VALUE SPACES.
003890200423          88 lb_MFRTransFound  VALUE "Y".
003900200423      * RFS92145 - End
003910200423      * RFS113784 - Begin
003920200423       01 lc_MULTDetailEOF       PIC X(1) VALUE SPACES.
003930200423          88 lb_MULTDetailEOF    VALUE "Y".
003940200423       01 lc_MULTDKey            PIC X(1) VALUE SPACES.
003950200423          88 lb_MULTDKeyValid    VALUE "Y".
003960200423          88 lb_MULTDKeyNotValid VALUE "N".
003970200423       01 lc_ProcessFirstYes     PIC X(1) VALUE SPACES.
003980200423          88 lb_ProcessFirstYes  VALUE "Y".
003990200423          88 lb_ProcessFirstNo   VALUE "N".
004000200423       01 lc_TransRecord         PIC X(1) VALUE SPACES.
004010200423          88 lb_TransRecFound    VALUE "Y".
004020200423          88 lb_TransRecNotFound VALUE "N".
004030200423      * RFS113784 - End
004040200423      * RFS126805 - Begin
004050200423       01 lb_Read_Multi_Flag     PIC X(1).
004060200423          88 lb_Read_Multi_Yes     VALUE "Y".
004070200423      * RFS126805 - End
004080210809      *iRFS187471 Start
004090210805       01 lb_DepTDDthPercentFlag PIC X(01) VALUE SPACES.
004100210805          88 lb_DepTDDthPercentYes  VALUE "Y".
004110210805          88 lb_DepTDDthPercentNo   VALUE "N".
004120210805      * RFS187471 End
004130210809      * RFS187471 - Starts
004140210809       01 pc_Schedulecode            PIC X(05).
004150210809       01 pi_Scheduledate            PIC S9(08).
004160210809       01 pc_Accounttypecode         PIC X(05).
004170210809       01 pc_trackingrule            PIC X(01).
004180210812       01 pc_Annuitantagerule        PIC X(01).
004190210809       01 pc_Applypercentatdeposittd PIC X(01).
004200210809       01 li_prevaccountno           PIC S9(09).
004210210809       01 lc_AnnuitantAgeCalcRule    PIC X(05).
004220210809       01 lnci_10000                 PIC S9(05) VALUE 10000.
004230210809      * RFS187471 End
004240200423      * RFS110904 - Start
004250200423       01 LC-INVSTRUCTURECODE           PIC X(5).
004260200423       01 CURR-INVESTMENT-CODE          PIC X(5).
004270200423127401 01 LC-GUARBENEFITELIGIBLE        PIC X(5).
004280200423      * RFS110904 - End
004290200423      *GIC MOD
004300200423      * Literals
004310200423      * RFS32873 - Begin
004320200423       01 lc_literals.
004330200423         03 lncc_X                    PIC X(01) VALUE "X".
004340210305185788   03 lncc_E                    PIC X(01) VALUE "E".
004350200423129787   03 lncc_M                    PIC X(01) VALUE "M".
004360200423         03 lncc_G                    PIC X(01) VALUE "G".
00437020042352265    03 lncc_1                    PIC X(01) VALUE "1".
00438020042352265    03 lncc_5                    PIC X(01) VALUE "5".
00439020042352265    03 lncc_6                    PIC X(01) VALUE "6".
00440020042352265    03 lncc_15                   PIC X(02) VALUE "15".
004410200423      * 52265 - defect 2 fix - begins.
004420200423         03 lncc_2                    PIC X(01) VALUE "2".
004430200423         03 lncc_3                    PIC X(01) VALUE "3".
004440200423         03 lncc_4                    PIC X(01) VALUE "4".
004450200423         03 lncc_12                   PIC X(02) VALUE "12".
004460200423         03 lncc_13                   PIC X(02) VALUE "13".
004470200423         03 lncc_14                   PIC X(02) VALUE "14".
004480200423      * 52265 - defect 2 fix - ends.
004490200423139288   03 lncc_36                   PIC X(02) VALUE "36".
004500200423139288   03 WS-INSURANCE-FEE          PIC S9(11)V99  VALUE 0.
004510200423146960   03 WS-AWD-SEQNO              PIC S9(03)     VALUE 0.
004520200423146960   03 lncc_ReadNxtACCSP         PIC X(01) VALUE SPACES.
004530200423         03 lncc_backEndLoad          PIC X(01) VALUE "R".
004540200423      * RFS40845 - Begin
004550200423         03 lncc_Y                    PIC X(01) VALUE "Y".
004560200423      * RFS40845 - End
004570200423      * RFS32873 - End
004580200423      * RFS 28264 - begins.
004590200423         03 lncc_A                    PIC X(01) VALUE "A".
004600200423         03 lncc_D                    PIC X(01) VALUE "D".
004610200423         03 lncc_N                    PIC X(01) VALUE "N".
004620200423      * RFS 28264 - ends.
004630200423      * RFS36325 - Begins
004640200423         03 lncc_L                    PIC X(01) VALUE "L".
00465020042346707    03 lncc_Open                 PIC X(01) VALUE "O".
004660200423      * RFS36325 - Ends
004670200423      * RFS84977 - Begin
004680200423         03 lncc_00                   PIC X(02) VALUE "00".
004690200423      * RFS849770.17 - Begin - Add variable
004700200423         03 lncc_I                    PIC X(01) VALUE "I".
004710200423      * RFS849770.17 - Ends
004720200423      * RFS84977 - End
004730200423      * RFS92475 - Start.
004740200423         03 lncc_ERED                 PIC X(04) VALUE "ERED".
004750200423         03 lncc_10                   PIC X(02) VALUE "10".
004760200423      * RFS92475 - End
004770200423      * RFS20711 - Begin
004780200423      * File Errors
004790200423       01 LT-ERR.
004800200423          05 LT-ERR-DUPLICATE         PIC X(02) VALUE "22".
004810200423          05 LT-ERR-REC-NOT-EXISTS    PIC X(02) VALUE "23".
004820200423      * RFS20711 - End
004830200423       01 LT-VARS.                                                       RFS7652
004840200423          05 LT-LAST-MMDD             PIC 9(04) VALUE 1231.              RFS7652
004850200423          05 LT-Y                     PIC X(01) VALUE "Y".               RFS9932
004860200423      * RFS17180 - Begin
004870200423          05 LT-A1                    PIC X(02) VALUE "A1".              RFS9932
004880200423          05 LT-A                     PIC X(01) VALUE "A".               RFS9932
004890200423      * RFS17180 - End
004900200423      * RFS15626 - Begin
004910200423          05 LT-B                     PIC X(01) VALUE "B".
004920200423          05 LT-P                     PIC X(01) VALUE "P".
004930200423          05 LT-F                     PIC X(01) VALUE "F".
004940200423          05 LT-FED                   PIC X(03) VALUE "FED".
004950200423      * RFS15626 - End
004960200423      * RFS14710 - Begin
004970200423          05 LT-AASWITCH              PIC X(10) VALUE "AASWITCH".        RFS9932
004980200423          05 LT-AAREBAL1              PIC X(10) VALUE "AAREBAL1".        RFS9932
004990200423      * RFS14710 - End
005000200423      * RFS91768 - Begin
005010200423          05 LT-AAREBAL2              PIC X(10) VALUE "AAREBAL2".
005020200423      * RFS91768 - End
005030200423      * RFS13383 - Begin
005040200423          05 LT-AMT-TO-CHECK       PIC S9(03)V99  COMP-3 VALUE 10.00.    RFS9932
005050200423          05 LT-UNITS-TO-CHECK     PIC S9(03)V999 COMP-3 VALUE 10.000.   RFS9932
005060200423      * RFS13383 - End
005070200423      * RFS10608 - Begin
005080200423          05 LT-N                     PIC X(01) VALUE "N".
005090200423          05 LT-DEC-1                 PIC S9(01) VALUE 1.
005100200423      * RFS10608 - End
005110200423      * RFS10040 - Begin
005120200423          05 LT-BONUS-SOURCE-U        PIC X(01) VALUE "U".
005130200423          05 LT-SEG                   PIC X(03) VALUE "SEG".
005140200423      * RFS10040 - End
005150200423      * RFS14975 - Begin
005160200423          05 LT-DSC-ROUND        PIC 9(03)V9(03) COMP-3 VALUE 0.045.
005170200423          05 LT-DSC-DIFF-ROUND   PIC 9(03)V9(03) COMP-3 VALUE 0.025.
005180200423      * RFS14975 - End
005190200423      * RFS20263 - Begin
005200200423          05 LT-ONE-ACTIVE-AAP-MASTER-ACC PIC X(01) VALUE "S".
005210200423      * RFS20263 - End
005220200423      * RFS5512 - Begin
005230200423          05 LT-MINUS-ONE        PIC S9(01) VALUE -1.
005240200423          05 LT-PERCENT          PIC X(01)  VALUE "%".
005250200423          05 LT-PROGRAM-CODE-OETRANS22  PIC X(8) VALUE "ORDEN2.2".
005260200423          05 LT-SPLIT-UNITS      PIC X(01)  VALUE "U".
005270200423          05 LT-SPLIT-DOLLARS    PIC X(01)  VALUE "$".
005280200423          05 LT-SEL              PIC X(03)  VALUE "SEL".
005290200423          05 LT-PND              PIC X(03)  VALUE "PND".
005300200423      * RFS5512 - End
005310200423      * RFS21772 - Begin
005320200423          05 LT-R                PIC X(01)  VALUE "R".
005330200423          05 LT-C                PIC X(01)  VALUE "C".
005340200423      * RFS21772 - End
00535020042354435    03 lncc_ModuleTFSA          PIC X(10) VALUE "TFSA".
00536020042354435    03 lncc_TFSA-StartTrade     PIC 9(08) VALUE 20090101.
00537020042356471    03 lncc_ModuleSPIA          PIC X(10) VALUE "SEGSPIA".
005380200423139286   03 lncc_ModulePOANN         PIC X(10) VALUE "POANN".
005390200423139286   03 lncc_ProcessAnnuity      PIC X(10) VALUE "ANNUITY".
005400200423146960   03 lncc_POAN                PIC X(04) VALUE "POAN".
00541020042380144    03 lncc_ModuleIQEE          PIC X(10) VALUE "IQEE".
00542020042364348    03 lncc_ModuleSRVFEE        PIC X(10) VALUE "SRVFEE".
005430200423138805   03 lncc_ModuleSEGFUND       PIC X(10) VALUE "SEGFUND".
005440200423138805   03 lncc_ModuleGIC           PIC X(10) VALUE "GIC".
005450200423183140   03 lncc_ModuleLNPREMAT      PIC X(10) VALUE "LNPREMAT".
005460200814186430   03 lncc_MFAACLBENP          PIC X(10) VALUE "MFAACLBENP".
005470200423      * RFS40845 - Begin
005480200423      *    RFS71433 -Begin
005490200423      *RFS108486 - Start : Un-commented variables
005500200423       01 lc_screenEditCodeGrntnf.
005510200423          05 lncc_screenCodeGrntnf      PIC X(08) VALUE "TRNPST".
005520200423          05 lncc_editCodeGrntnf        PIC X(06) VALUE "GRNTNF".
005530200423          05 lncc_levelCodeGrntnf       PIC X(01) VALUE "T".
005540200423       01 lc_GrntnfFlag               PIC X(01) VALUE SPACES.
005550200423         88 lncc_GrntnfOn               VALUE "Y".
005560200423      *RFS108486 - End
005570200423      *    RFS71433 -End
005580200423       01 lc_grantTradeFlag           PIC X(01) VALUE SPACES.
005590200423         88 lncc_grantTrade             VALUE "Y".
005600200423      * RFS40845 - End
005610200423      * RFS52816 - Begin
005620200423       01 lc_screenEditCodeRIFGLW.
005630200423          05 lncc_screenCodeRIFGLW      PIC X(08) VALUE "ACCCGWDT".
005640200423          05 lncc_editCodeRIFGLW        PIC X(06) VALUE "RIFGLW".
005650200423          05 lncc_levelCodeRIFGLW       PIC X(01) VALUE "A".
005660200423       01 lc_RIFGLWFlag               PIC X(01) VALUE SPACES.
005670200423         88 lncc_RIFGLWOn               VALUE "Y".
005680200423      * RFS52816 - End
005690210531      * RFS186729- Start
005700210531       01 lt-Pgm-Dummy                         PIC X(10)
005710210531                                                      VALUE "PGM_DUMMY".
005720210531       01 lc_screenEditCodeSFMSGW.
005730210531         05 lncc_screenCodeSFMSGW              PIC X(08) VALUE "TRNPST".
005740210531         05 lncc_editCodeSFMSGW                PIC X(06) VALUE "SFMSGW".
005750210531         05 lncc_levelCodeSFMSGW               PIC X(01) VALUE "T".
005760210531       01 lc_SFMSGWFlag                        PIC X(01) VALUE SPACES.
005770210531         88 lncc_SFMSGWOff                               VALUE "N".
005780210531      * RFS186729 - End
005790200423      * RFS104600 - Begin
005800200423       01  lc_screenEditCodeNOMRUL.
005810200423         05  lnc_screenCodeNOMRUL      PIC X(08) VALUE "ACCCGWDT".
005820200423         05  lnc_editCodeNOMRUL        PIC X(06) VALUE "NOMRUL".
005830200423         05  lnc_levelCodeNOMRUL       PIC X(01) VAlUE "A".
005840200423       01  lc_NOMRULFlag               PIC X(01) VALUE SPACES.
005850200423         88  lncc_NOMRULOn                        VALUE "Y".
005860200423      *RFS 137032 - Begins.
005870200423       01  lc_screenEditLevelMin.
005880200423         05  lnc_screencodeminTRNPST   PIC X(08) VALUE "TRNPST".
005890200423         05  lnc_editcodeminOVRIMT     PIC X(06) VALUE "OVRIMT".
005900200423         05  lnc_levelcodeminT         PIC X(01) VALUE "T".
005910200423       01  lncc_OVRIMT                 PIC X(01) VALUE SPACES.
005920200423         88  lncc_OVRIMTOn                       VALUE "Y".
005930200423      *RFS 137032 - Ends.
005931210916      *RFS186588 - Starts
005932210916       01 lc_screenEditCodeTRNSEQ.
005933210921          05 lncc_ScreenCdTRNPST       PIC X(08) VALUE "TRNPST".
005934210921          05 lncc_EditCdTRNSEQ         PIC X(06) VALUE "TRNSEQ".
005935210921          05 lnc_LevelCdT              PIC X(01) VALUE "T".
005939210916       01 lc_TRNSEQFlag                PIC X(01) VALUE SPACES.
005940210921          88 lncc_TRNSEQOn                 VALUE "Y".
005941210916       01 li_Process_Date              PIC S9(08) VALUE ZEROES.
005945210916      *RFS186588 - Ends
005946200423       01 WS-SYSTIME                   PIC 9(8).
005950200423       01 WS-SYSDATE                   PIC 9(8).
005960200423      * RFS 104600 - End
005970200423      * RFS22180 - Begin
005980200423       01 LT-SCREEN-EDIT-CODES.
005990200423          05 LT-SCREEN-CODE-INVDTL  PIC X(08) VALUE "INVDTL".
006000200423          05 LT-EDIT-CODE-INVDT     PIC X(06) VALUE "INVDT".
006010200423          05 LT-LEVEL-CODE-I        PIC X(01) VALUE "I".
006020200423      * RFS32873 - Begin
006030200423          05 lc_editCodeCLWBCK      PIC X(06) VALUE "CLWBCK".
006040200423       01 lc_clawbackLLOnFlag       PIC X(01) VALUE SPACES.
006050200423         88 lncc_clawbackLLOn         VALUE "Y".
006060200423       01 lc_ChangeLoadFlag         PIC X(01) VALUE SPACES.
006070200423         88 lncc_ChangeLoad           VALUE "Y".
006080200423         88 lncc_notChangeLoad        VALUE SPACES.
00609020042332873*** defect #10 - begin
006100200423       01 lc_clawbackBEOnFlag       PIC X(01) VALUE SPACES.
006110200423         88 lncc_clawbackBEOn         VALUE "Y".
00612020042332873*** defect #10 - end
006130200423      * RFS32873 - End
006140200423      * RFS22180 - End
006150200423      * RFS42286.1-Begin: flag to indicate if negative distributions
006160200423      *   exists for the account investment.
006170200423       01 lc_negativeCppFlag        PIC X(01) VALUE SPACES.
006180200423         88 lncc_negativeCppNo        VALUE SPACES.
006190200423         88 lncc_negativeCppYes       VALUE "Y".
006200200423      * RFS42286.1 - End
006210200423      * RFS42622 - Begin: new flag to know if it is IP Maturity trade
006220200423       01 lc_ipMaturityFlag         PIC X(01) VALUE SPACES.
006230200423         88 lncc_ipMaturity           VALUE "Y".
006240200423      * RFS42622 - End
006250200423      * RFS46125 - Begin:new flag to know if it is Switch on Death Claims
006260200423       01 lc_deathClaimsFlag        PIC X(01) VALUE SPACES.
006270200423         88 lncc_deathClaims          VALUE "Y".
006280200423129787 01 lc_OptionXFlag            PIC X(01) VALUE SPACES.
006290200423129787   88 lb_OptionXOn              VALUE "Y".
006300200423143631 01 lc_SameAccount            PIC X(01) VALUE SPACES.
006310200423143631   88 lb_SameAccountNo          VALUE "N".
006320200423143631   88 lb_SameAccountYes         VALUE "Y".
006330200423143631 01 li_DiffAccountFree        PIC S9(11)V99  VALUE 0.
006340200423      * RFS46125 - End
006350200423R30134 01 lnc_sysplan_validation.
006360200423          05 lnc_Screen_Code        PIC X(08) VALUE "TRNPST".
006370200423
006380200423          05 lnc_Trntrd_Edit_C      PIC X(06) VALUE "TRNTRD".
006390200423          05 lnc_Trntrd_Level_C     PIC X(01) VALUE "T".
006400200423          05 lnc_Accact_Edit_C      PIC X(06) VALUE "ACCACT".
006410200423R30134    05 lnc_Accact_Level_C     PIC X(01) VALUE "A".
00642020042332873  01  lnc_EditCode1ACCONSetup.
00643020042332873      03  lnc_EditCode1ACCONScreenCode  PIC X(08) VALUE "OETRNPST".
00644020042332873      03  lnc_EditCode1ACCONEditCode    PIC X(06) VALUE "1ACCON".
00645020042332873      03  lnc_EditCode1ACCONLevel       PIC X(01) VALUE "T".
006460200423      * RFS35075- Begin
006470200423       01  lnc_EditCodeREPLICSetup.
006480200423           03  lnc_EditCodeREPLICScreenCode  PIC X(08) VALUE "TRNPST".
006490200423           03  lnc_EditCodeREPLICEditCode    PIC X(06) VALUE "REPLIC".
006500200423           03  lnc_EditCodeREPLICLevel       PIC X(01) VALUE "T".
006510200423      * RFS35075 - End
00652020042344930  01  lnc_EditCodeTGDVSetup.
00653020042344930      03  lnc_EditCodeTGDVScreenCode    PIC X(08) VALUE "ACCCDTL".
00654020042344930      03  lnc_EditCodeTGDVEditCode      PIC X(06) VALUE "TGDV".
00655020042344930      03  lnc_EditCodeTGDVLevel         PIC X(01) VALUE "C".
00656020042346707  01  lnc_EditCodeANNDTHSetup.
00657020042346707      03  lnc_EditCodeANNDTHScreenCode  PIC X(08) VALUE "ACCCDTL".
00658020042346707      03  lnc_EditCodeANNDTHEditCode    PIC X(06) VALUE "ANNDTH".
00659020042346707      03  lnc_EditCodeANNDTHLevel       PIC X(01) VALUE "A".
006600200423      * RFS50475 - Begin
006610200423       01  lnc_EditCodeALDSetup.
006620200423           03  lnc_EditCodeALDScreenCode      PIC X(08) Value "ACCCDTL".
006630200423           03  lnc_EditCodeALDEditCode        PIC X(06) Value "ALDTTF".
006640200423           03  lnc_EditCodeALDLevel           PIC X(01) Value "A".
006650200423           03  lc_EditCodeALDSetupFlag        PIC X(01) Value Space.
006660200423               88  lb_EditCodeALDSetupYes     Value "Y".
006670200423               88  lb_EditCodeALDSetupNo      Value "N".
006680200423      * RFS50475 - End
006690200423      * RFS112945- Begin
006700200423       01  lnc_EditCodeALDTTSetup.
006710200423           03  lnc_EditCodeALDTTScreenCode    PIC X(08) Value "SRVPUP".
006720200423           03  lnc_EditCodeALDTTEditCode      PIC X(06) Value "ALDTTF".
006730200423           03  lnc_EditCodeALDTTLevel         PIC X(01) Value "A".
006740200423           03  lc_EditCodeALDTTSetupFlag      PIC X(01) Value Space.
006750200423               88  lb_EditCodeALDTTSetupYes   Value "Y".
006760200423               88  lb_EditCodeALDTTSetupNo    Value "N".
006770200423      * RFS112945- End
006780200423      * RFS103858- Begin
006790200423       01  lnc_EditCodeGENPUPSetup.
006800200423           03  lnc_EditCodeGENPUPScreenCode   PIC X(08) Value "TRNPST".
006810200423           03  lnc_EditCodeGENPUPEditCode     PIC X(06) Value "GENPUP".
006820200423           03  lnc_EditCodeGENPUPLevel        PIC X(01) Value "T".
006830200423           03  lc_EditCodeGENPUPSetupFlag     PIC X(01) Value Space.
006840200423               88  lb_EditCodeGENPUPSetupYes  Value "Y".
006850200423               88  lb_EditCodeGENPUPSetupNo   Value "N".
006860200423      * RFS103858- End
006870200423      * RFS42278- Begin
006880200423       01  lnc_LinkNotesEditCode.
006890200423           03  lnc_LinkNoteScreenCode   PIC X(08) VALUE "TRNPST".
006900200423           03  lnc_LinkNoteEditCode     PIC X(06) VALUE "LNMAT".
006910200423           03  lnc_LinkNoteLevel        PIC X(01) VALUE "T".
006920200423           03  lc_LinkNoteSetonFlag     PIC X(01) Value Space.
006930200423               88 lb_LinkNoteSeton          VALUE "Y".
006940200423               88 lb_LinkNoteSetoff         VALUE "N".
006950200423       01  lnc_LinkNoteInvestment       PIC X(01) Value Spaces.
006960200423               88  lb_LinkNoteYes       VALUE "Y".
006970200423               88  lb_LinkNoteNo        VALUE "N".
006980200423      *RFS 68035 - Begin
006990200423       01  lc_GroupComplete            PIC X(01) Value Spaces.
007000200423               88  lb_GroupCompleteYes  VALUE "Y" " ".
007010200423               88  lb_GroupCompleteNo   VALUE "N".
007020200423      *RFS 68035 - End
007030200423      *RFS 84063 - Begin
007040200423       01  lc_AccrualUpdate            PIC X(01) Value Spaces.
007050200423               88  lb_AccrualUpdatedYes VALUE "Y" " ".
007060200423               88  lb_AccrualUpdatedNo  VALUE "N".
007070200423      *RFS 84063 - End
00708020042383793  01  lc_AlreadyJLBack            PIC X(01) Value Spaces.
007090200423  |            88  lb_AlreadyJLBackYes VALUE "Y" " ".
00710020042383793          88  lb_AlreadyJLBackNo  VALUE "N".
007110200423
007120200423       01  lc_ChargeNont                PIC X(01) Value Spaces.
007130200615      * RFS42278 - End
007140200615      * RFS15194 - Begin
007150200423       01 WS1-EST-VARS.
007160200423          05 WS1-GROSS           PIC S9(11)V9(03) COMP-3 VALUE 0.0.
007170200423          05 WS1-EST-GROSS       PIC S9(11)V9(03) COMP-3 VALUE 0.0.
007180200423          05 WS1-UNITS           PIC S9(11)V9(03) COMP-3 VALUE 0.0.
007190200423          05 WS1-PRICE           PIC S9(11)V9(04) COMP-3 VALUE 0.0.
007200200423          05 WS1-DSC-DIFF-ROUND  PIC S9(11)V9(03) COMP-3 VALUE 0.0.
007210200423      * RFS15194 - End
007220200423      * RFS10608 - Begin
007230200423       01 SW-SWITCHES.
007240200423      * RFS25821 - Begin
007250200423         03 SW-RETN-BAL-STATUS-FLAG        PIC X(01) VALUE SPACES.
007260200423            88 SW-RETN-BAL-STATUS-OK       VALUE " ".
007270200423      * RFS25821 - End
007280200423         03 SW-TEMP-FLAG                   PIC X(01) VALUE SPACES.
007290200423            88 SW-TEMP-OK                  VALUE SPACES.
007300200423            88 SW-TEMP-FAIL                VALUE "Y".
007310200423      * RFS15626 - Begin
007320200423            88 SW-TEMP-FOUND               VALUE "F".
007330200423            88 SW-TEMP-END                 VALUE "E".
007340200423         03 SW1-TEMP-FLAG                   PIC X(01) VALUE SPACES.
007350200423            88 SW1-TEMP-OK                  VALUE SPACES.
007360200423            88 SW1-TEMP-FAIL                VALUE "Y".
007370200423            88 SW1-TEMP-FOUND               VALUE "F".
007380200423            88 SW1-TEMP-END                 VALUE "E".
007390200423         03 SW-GRACE-DSC-FOUND-FLAG         PIC X(01) VALUE SPACES.
007400200423            88 SW-GRACE-DSC-OK              VALUE SPACES.
007410200423            88 SW-GRACE-DSC-FAIL            VALUE "Y".
007420200423            88 SW-GRACE-DSC-FOUND           VALUE "F".
007430200423            88 SW-GRACE-DSC-END             VALUE "E".
007440200423         03 SW-WAIVE-FROM-OPTIONS-FLAG      PIC X(01).
007450200423            88 SW-WAIVE-FROM-OPTIONS        VALUE "Y".
007460200423      * RFS15626 - End
007470200423      * RFS10608 - End
007480200423      * RFS5512 - Begin
007490200423         03 SW-REJECTION-CODE              PIC X(02).
007500200423            88 SW-REJECTION-CODE-OK        VALUES "00" "  ".
007510200423         03 SW-CHECK-REMAINING-BAL-FLAG    PIC X(01) VALUE SPACES.
007520200423            88 SW-CHECK-REMAINING-BAL-NO      VALUE SPACES.
007530200423            88 SW-CHECK-REMAINING-BAL         VALUE "Y".
007540200423         03 SW-CHANGE-SPLIT-OPTION-FLAG    PIC X(01) VALUE SPACES.
007550200423            88 SW-CHANGE-SPLIT-OPTION-NO      VALUE SPACES.
007560200423            88 SW-CHANGE-SPLIT-OPTION         VALUE "Y".
007570200423      * RFS5512 - End
007580200423      * RFS13383 - Begin
007590200423         03 SW-N-PASSES-FLAG               PIC X(01) VALUE SPACES.
007600200423            88 SW-N-PASSES-INIT            VALUE SPACES.
007610200423            88 SW-N-ONE-PASS               VALUE "1".
007620200423            88 SW-N-TWO-PASSES             VALUE "2".
007630200423      * RFS13383 - End
007640200423      * RFS15425 - Begin
007650200423         03 SW-CHANGE-TRANS-STATUS-FLAG    PIC X(01) VALUE SPACES.
007660200423            88 SW-NO-CHANGE-TRANS-STATUS   VALUE SPACE.
007670200423            88 SW-CHANGE-TRANS-STATUS      VALUE "Y".
007680200423      * RFS15425 - End
007690200423      * RFS21772 - Begin
007700200423         03 SW-FILES-OPEN-FLAG              PIC X(01).
007710200423            88 SW-FILES-OPENED                VALUE "Y".
007720200423         03 SW-CALC-NO-UPDATES-FLAG         PIC X(01).
007730200423            88 SW-CALC-NO-UPDATES             VALUE "1".
007740200423      * RFS32409 - Start
007750200423            88 lnc_calcSoa                    VALUE "2".
007760200423      * RFS32409 - End
007770200423      * RFS50832 - Begin: same as calcSoa but update some files
007780200423            88 lnc_calcSoaUpd                 VALUE "3".
007790200423      * RFS50832 - End
007800200423         03 SW-PAYMENT-TYPE-RULE            PIC X(1).
007810200423            88 SW-PAYMENT-TYPE-RULE-REINVEST       VALUES "A", "Y".
007820200423            88 SW-PAYMENT-TYPE-RULE-EFT-TRANS      VALUES "E".
007830200423            88 SW-PAYMENT-TYPE-RULE-CHQ-TRANS      VALUES "C".
007840200423      * RFS21772 - End
007850200423      * RFS15626 - Begin
007860200423         03 SW-GRACE-PERIOD-FLAG                   PIC X(01).
007870200423           88 SW-GRACE-PERIOD-NOT-EXISTS           VALUES SPACES.
007880200423           88 SW-GRACE-PERIOD-EXISTS               VALUES "Y".
007890200423      * RFS15626 - End
00790020042326151    03 SW-RECORD-FOUND                        PIC 1.
00791020042326151      88 SW-RECORD-FOUND-YES                  VALUE B"1".
00792020042326151      88 SW-RECORD-FOUND-NO                   VALUE B"0".
007930200423      * RFS27297 - Begin
007940200423         03 SW-TRANS-CDSC-CLOCK-FLAG        PIC X(01) VALUE SPACES.
007950200423            88 SW-TRANS-CDSC-CLOCK-OK       VALUE SPACES.
007960200423            88 SW-TRANS-CDSC-CLOCK-END      VALUE "E".
007970200423      * RFS27297 - End
007980200423
007990200423      * RFS185169 Starts
008000200624         03 WRITE-ACCOUNT-BENEFITS          PIC X(01) VALUE SPACES.
008010200423         03 Li_EligibleDateIn               PIC S9(9) VALUE ZEROES.
008020200423         03 Li_EligibleDateOut              PIC S9(9) VALUE ZEROES.
008030200423         03 LI_FORCEDATEIN                  PIC S9(9) VALUE ZEROES.
008040200423         03 LI_FORCEDATEOUT                 PIC S9(9) VALUE ZEROES.
008050200423         03 LI_INITDEPOSITDATEIN            PIC S9(9) VALUE ZEROES.
008060200423         03 LI_INITDEPOSITDATEOUT           PIC S9(9) VALUE ZEROES.
008070200429         03 LI_INVESTMENTSERIESIN           PIC X(05) VALUE SPACES.
008080200429         03 LI_INVESTMENTSERIESOUT          PIC X(05) VALUE SPACES.
008090200429         03 LI_GUARWDPERCENTIN              PIC S9(05)V9(2) COMP-3
008100200429                                                      VALUE ZEROES.
008110200429         03 LI_GUARWDPERCENTOUT             PIC S9(05)V9(2) COMP-3
008120200429                                                      VALUE ZEROES.
008130200429         03 LI_GUARWDAMOUNTIN               PIC S9(11)V9(2) COMP-3
008140200429                                                      VALUE ZEROES.
008150200429         03 LI_GUARWDAMOUNTOUT              PIC S9(11)V9(2) COMP-3
008160200429                                                      VALUE ZEROES.
008170200429         03 LI_YTDEXCESSWDIN                PIC S9(11)V9(2) COMP-3
008180200429                                                      VALUE ZEROES.
008190200429         03 LI_YTDEXCESSWDOUT               PIC S9(11)V9(2) COMP-3
008200200429                                                      VALUE ZEROES.
008210200429         03 LI_GUARWDEXCESSIN               PIC S9(11)V9(2) COMP-3
008220200429                                                      VALUE ZEROES.
008230200429         03 LI_GUARWDEXCESSOUT              PIC S9(11)V9(2) COMP-3
008240200429                                                      VALUE ZEROES.
008250200429         03 LI_YTDGUARWDAMOUNTIN            PIC S9(11)V9(2) COMP-3
008260200429                                                      VALUE ZEROES.
008270200429         03 LI_YTDGUARWDAMOUNTOUT           PIC S9(11)V9(2) COMP-3
008280200429                                                      VALUE ZEROES.
008290200423         03 LI_GWASTARTDATEIN               PIC S9(9) VALUE ZEROES.
008300200423         03 LI_GWASTARTDATEOUT              PIC S9(9) VALUE ZEROES.
008310200423      * RFS185169 Ends
008320200814      * RFS186430 - Begin
008330200814         03 lc_FXGETMAXIDParms.
008340200814            05  pc_FXGETMX_TableName        PIC X(10) VALUE SPACES.
008350200814            05  pi_FXGETMX_MaxRowID         PIC S9(12) VALUE ZEROES.
008360200814            05  pc_FXGETMX_ReturnCde        PIC X(02) VALUE SPACES.
008370200814      * RFS186430 - End
008380200423R26260* Begin
008390200423         03 lc_Contract                     PIC X(01).
008400200423            88 lncc_ContractNotFound        VALUE "N".
008410200423R26260* End
00842020042332873    03 lb_EditCode1ACCONSetupFlag      PIC 1.
00843020042332873       88  lb_EditCode1ACCONSetupYes   VALUE B"1".
00844020042332873       88  lb_EditCode1ACCONSetupNo    VALUE B"0".
008450200423      * RFS35075 - Begin
008460200423         03 lc_EditCodeREPLICSetupFlag      PIC X(1).
008470200423            88  lnc_EditCodeREPLICSetupYes   VALUE "Y".
008480200423      * RFS35075 - End
008490200423      * RFS12420 - Begin
00850020042344930    03 lc_EditCodeTGDVSetupFlag        PIC X(01).
00851020042344930       88  lb_EditCodeTGDVSetupYes     VALUE "Y".
00852020042344930       88  lb_EditCodeTGDVSetupNo      VALUE "N".
00853020042346707    03 lc_EditCodeANNDTHSetupFlag      PIC X(01).
00854020042346707       88  lb_EditCodeANNDTHSetupYes   VALUE "Y".
00855020042346707       88  lb_EditCodeANNDTHSetupNo    VALUE "N".
00856020042344930    03 lb_DthPercentCalculatedFlag     PIC 1.
00857020042344930       88  lb_DthPercentCalculatedYes  VALUE B"1".
00858020042344930       88  lb_DthPercentCalculatedNo   VALUE B"0".
00859020042344930    03 lb_SameGDVPercent               PIC 1.
00860020042344930       88  lb_SameGDVPercentYes        VALUE B"1".
00861020042344930       88  lb_SameGDVPercentNo         VALUE B"0".
00862020042344930    03 lc_AnnuitantAgeCalcMethod       PIC X(01).
00863020042344930       88  lb_AnnuitantAgeCalcMethodB  VALUE "B".
00864020042344930       88  lb_AnnuitantAgeCalcMethodY  VALUE "Y".
00865020042340942    03 lc_ModuleSEGGLWBFlag            PIC X(01).
00866020042340942       88  lc_ModuleSEGGLWBOn          VALUE "Y".
00867020042340942       88  lc_ModuleSEGGLWBOff         VALUE "N".
00868020042354435    03 lc_ModuleTFSAFlag               PIC X(01).
00869020042354435       88  lc_ModuleTFSAOn             VALUE "Y".
00870020042354435       88  lc_ModuleTFSAOff            VALUE "N".
008710200423139286   03 lc_ModulePOANNFlag              PIC X(01).
008720200423139286      88  lc_ModuleSEGPOANOn          VALUE "Y".
008730200423139286      88  lc_ModuleSEGPOANOff         VALUE "N".
00874020042356471    03 lc_ModuleSPIAFlag               PIC X(01).
008750200423  |         88  lc_ModuleSEGSPIAOn          VALUE "Y".
008760200423  |         88  lc_ModuleSEGSPIAOff         VALUE "N".
008770200423  |      03 lc_SPIAInvestFlag               PIC X(01).
008780200423  |         88  lb_SPIAInvestYes            VALUE "Y".
00879020042356471       88  lb_SPIAInvestNo             VALUE "N".
008800200423139286   03 lc_POANInvestFlag               PIC X(01).
008810200423139286      88  lb_POANInvestYes            VALUE "Y".
008820200423139286      88  lb_POANInvestNo             VALUE "N".
00883020042380144    03 lc_ModuleIQEEFlag               PIC X(01).
00884020042380144       88  lc_ModuleIQEEOn             VALUE "Y".
00885020042380144       88  lc_ModuleIQEEOff            VALUE "N".
00886020042364348    03 lc_ModuleSRVFEEFlag             PIC X(01).
00887020042364348       88  lc_ModuleSRVFEEOn           VALUE "Y".
00888020042364348       88  lc_ModuleSRVFEEOff          VALUE "N".
00889020042368035    03 lc_GroupProcessing              PIC X(01).
008900200423  |         88  lb_GroupProcessingYes       VALUE "Y".
00891020042368035       88  lb_GroupProcessingNo        VALUE "N", " ".
00892020042384456    03 lc_GroupAdjust                  PIC X(01).
00893020042384456       88  lb_GroupAdjustYes           VALUE "Y".
00894020042384456       88  lb_GroupAdjustNo            VALUE "N", " ".
00895020042368035    03 lc_TransRDSPFound               PIC X(01).
008960200423  |         88  lb_TransRDSPFoundYes        VALUE "Y".
00897020042368035       88  lb_TransRDSPFoundNo         VALUE "N", " ".
00898020042368035    03 lc_AHATransFailed               PIC X(01).
008990200423  |         88  lb_AHATransFailedYes        VALUE "Y".
00900020042368035       88  lb_AHATransFailedNo         VALUE "N", " ".
009010200423      *RFS138805 Start
009020200423         03 lc_SEGFUNDFlag                  PIC X(01).
009030200423            88  lc_SEGFUNDOn                VALUE "Y".
009040200423            88  lc_SEGFUNDOff               VALUE "N".
009050200423         03 lc_GICFlag                      PIC X(01).
009060200423            88  lc_GICOn                    VALUE "Y".
009070200423            88  lc_GICOff                   VALUE "N".
009080200423      *RFS183140 - Begin
009090200423         03 lc_LNPREMATFlag                 PIC X(01).
009100200423            88  lc_LNPREMATOn               VALUE "Y".
009110200423            88  lc_LNPREMATOff              VALUE "N".
009120200423      *RFS183140 - End
009130200423      *RFS138805 End
009140210216      *RFS180721 Start
009150210216         03 lc_accountbenetitsexists        PIC X(01).
009160210216            88 lb_accountbenetitsexistsfalse VALUE "N".
009170210216            88 lb_accountbenetitsexiststrue  VALUE "Y".
009180210216      *RFS180721 End
009190210720      *RFS1115650 Start
009200210720         03 lc-SEG-TRANSFER-EFFECTIVE-DATE PIC X(01) VALUE SPACES.
009210210720            88 SEG-TRANSFER-EFFECTIVE-DATE  VALUE "Y".
009220210720      *RFS1115650 End
009230210720      *RFS187317 Start
009240210720         03 lc_OneDayProduct                PIC X(01).
009250210720            88 lb_OneDayProductYes          VALUE "Y".
009260210720            88 lb_OneDayProductNo           VALUE "N".
009270210720         03 lc_ContractExist                PIC X(01).
009280210720            88 lb_ContractExistYes          VALUE "Y".
009290210720            88 lb_ContractExistNo           VALUE "N".
009300210720      *RFS180721 End
009310200423      *
009320200423       01 SW-WITHH-RATES-FLAG            PIC X(01) VALUE SPACES.
009330200423            88 SW-WITHH-RATES-ONE          VALUE SPACES.
009340200423            88 SW-WITHH-RATES-ALL          VALUE "Y".
009350200423      * Flag - to control reading withholding Tax Table
009360200423
009370200423      * RFS13839 - Begin
009380200423       01 SW-DSC-OPEN-FLAG               PIC X(01) VALUE SPACES.
009390200423            88 SW-DSC-OPENED               VALUE "Y".
009400200423            88 SW-DSC-NOT-OPENED           VALUE SPACE.
009410200423      * RFS13839 - End
009420200423R27609 01 EC-WOR-FLAG                    PIC X(01) VALUE "N".
009430200423R27609    88 EC                          VALUE "Y".
009440200423R27609    88 NOT-EC-WOR                  VALUE "N".
009450200423       01 WS-IND-FOR-WITHH-RATES.
009460200423         05 WS-IND-RATE                      PIC 9(05) VALUE ZEROES.
009470200423         05 WS-IND-CURR                      PIC 9(05) VALUE ZEROES.
009480200423      * Current index of Withholding tax table for minimizing
009490200423         05 WS-IND-RATE-SAV                  PIC 9(05) VALUE ZEROES.
009500200423      * Current index of Withholding tax table for the specific
009510200423      * value
009520200423         05 WS-IND-RATE-CHK                  PIC 9(05) VALUE ZEROES.
009530200423      * Last Index from Withholding tax table
009540200423         05 WS-IND-RATE-LAST                 PIC 9(05) VALUE ZEROES.
009550200423      * Last Index (Length of the table)
009560200423      * Withholding tax table TO check for existance
009570200423         05 WS-CHK-NET                       PIC S9(11)V99 COMP-3
009580200423                                                VALUE ZEROES.
009590200423      *
009600200423       01 LT-MIN-NET           PIC S9(11)V99 COMP-3
009610200423                                                VALUE -99999999999.99.
009620200423       01 LT-MAX-NET           PIC S9(11)V99 COMP-3
009630200423                                                VALUE  99999999999.99.
009640200423       01 WS1-TAXABLE-AMT-SAV               PIC S9(11)V9(02) COMP-3
009650200423                                                VALUE ZEROES.
009660200423       01 WS1-WITHH-RATES-TABLE.
009670200423         05 WS1-WITHH-RATES-TBL             OCCURS 32.
009680200423            10 WS1-TAXABLE-AMT-FROM         PIC S9(11)V9(02) COMP-3.
009690200423            10 WS1-TAXABLE-AMT-TO           PIC S9(11)V9(02) COMP-3.
009700200423            10 WS1-FEDERAL-TAX-RATE         PIC S9(03)V9(02) COMP-3.
009710200423            10 WS1-PROVINCIAL-TAX-RATE      PIC S9(03)V9(02) COMP-3.
009720200423R24191      10 WS1-FED-POOLED-TAX-RATE      PIC S9(3)V9(2) COMP-3.
009730200423R24191      10 WS1-INCLUSION-RATE           PIC S9(5)V9(2) COMP-3.
009740200423      * RFS12420 - End
009750200423      * RFS32914 - Start
009760200423       01 lnc-Misc.
009770200423            10 ln_TaxAmtTopGross       PIC S9(11)V9(02) COMP-3 VALUE 0.
009780200423            10 lnc_RoundRange          PIC S9(11)V9(02) COMP-3
009790200423                                       VALUE 20000.00.
00980020042366816       10 ln_WorkNetRate          PIC S9(3)V9(20)  VALUE 0.
009810200423       01   lb_SetTop            PIC X(1).
009820200423                88 lb_SetTopYes      VALUE "Y".
009830200423                88 lb_SetTopNo       VALUE "N".
009840200423       01   lb_SetRejNet         PIC X(1).
009850200423                88 lb_SetRejNetYes   VALUE "Y".
009860200423                88 lb_SetRejNetNo    VALUE "N".
009870200423       01   lb_SetAddFee         PIC X(1).
009880200423                88 lb_SetAddFeeYes   VALUE "Y".
009890200423                88 lb_SetAddFeeNo    VALUE "N".
009900200423      * RFS32914 - End
009910200423       01  REQUEST-LAYOUT.
009920200423           05 WS-RL-PLACEMENT-DATE  PIC X(9).
009930200423           05 WS-RL-TRANS-NO        PIC X(9).
009940200423           05 WS-RL-SEQID           PIC X(5).
009950200423           05 WS-RL-MGMT-CO         PIC X(3).
009960200423           05 FILLER                PIC X(14).
009970200423      * RFS 113784 - Start
009980200423           05 WS-RL-INSTR-DATE      PIC X(09).
009990200423           05 WS-RL-INSTR-DATE1   REDEFINES
010000200423              WS-RL-INSTR-DATE      PIC 9(09).
010010200423           05 WS-RL-INSTR-NUM       PIC X(09).
010020200423           05 WS-RL-INSTR-NUM1    REDEFINES
010030200423              WS-RL-INSTR-NUM       PIC 9(09).
010040200423      * RFS 113784 - End
010050200423       01  REQUEST-LAYOUT-NUMERIC.
010060200423           05 WS-RLN-PLACEMENT-DATE PIC S9(9).
010070200423           05 WS-RLN-TRANS-NO       PIC X(9).
010080200423       01  REQUEST-LAYOUT2.
010090200423           05 WS-RQ-PLACEMENT-DATE  PIC X(9).
010100200423           05 WS-RQ-TRANS-NO        PIC X(9).
010110200423           05 WS-RQ-SEQID           PIC X(5).
010120200423           05 WS-RQ-MGMT-CO         PIC X(3).
010130200423           05 FILLER                PIC X(14).
010140200423      * Batch Balancing Switches
010150200423       01 T-BAL-SWITCHES.
010160200423          05 T-BAL-SW1                   PIC X.
010170200423          05 T-BAL-SW2                   PIC X.
010180200423          05 T-BAL-SW3                   PIC X.
010190200423          05 T-BAL-SW4                   PIC X.
010200200423          05 T-BAL-SW5                   PIC X.
010210200423          05 T-BAL-SW6                   PIC X.
010220200423          05 T-BAL-SW7                   PIC X.
010230200423          05 T-BAL-SW8                   PIC X.
010240200423       01 T-BAL-SWITCHES-R REDEFINES T-BAL-SWITCHES.
010250200423          05 FILLER                      PIC X.
010260200423          05 T-BAL-SWITCH-2-6            PIC X(6).
010270200423          05 FILLER                      PIC X.
010280200423       01 T-BAL-SWITCHES-R2 REDEFINES T-BAL-SWITCHES.
010290200423          05 FILLER                      PIC X.
010300200423          05 T-BAL-SWITCH-2-3            PIC X(3).
010310200423          05 FILLER                      PIC X(4).
010320200423       01 WSA-PARMS.
010330200423          03 WSA-MODE                   PIC X(2).
010340200423          03 WSA-ACCOUNT-NO             PIC S9(9).
010350200423          03 WSA-INVESTMENT-CODE        PIC X(5).
010360200423          03 WSA-CERT-ID-NO             PIC S9(10).
010370200423          03 WSA-TRADE-DATE             PIC S9(8).
010380200423          03 WSA-GROSS-AMT              PIC S9(11)V99.
010390200423          03 WSA-INTEREST-AMT           PIC S9(11)V99.
010400200423          03 WSA-SCHEDULE-CODE          PIC X(5).
010410200423          03 WSA-REPMT-RED-FEE          PIC S9(11)V99.
010420200423          03 WSA-RED-PENALTY            PIC S9(11)V99.
010430200423          03 WSA-REPMT-RATE             PIC S9(3)V999.
010440200423          03 WSA-PENALTY-RATE           PIC S9(3)V999.
010450200423          03 WSA-RETCODE                PIC X(2).
010460200423          03 WSA-RETCODE-DESC           PIC X(80).
010470200423      * RFS10737 - Begin                                                RFS10008
010480200423          03 WSA-BALANCE                PIC S9(11)V99.                  RFS10008
010490200423      * RFS10737 - End                                                  RFS10008
010500200423113783    03 WSA-SETTLE-METHOD          PIC X(1).
010510200423113783    03 WSA-TRANS-TYPE             PIC X(3).
010520200423113783 01 lc_MVA                     PIC X(1) VALUE "2".
010530200423113783 01 lc_WaveMethod              PIC X(1) VALUE " ".
010540200423113783 01 lc_PenaltyMethod           PIC X(2) VALUE " ".
010550200423113783 01 ln_RepAmountMin            PIC S9(11)V9(2).
010560200423159011 01 lc_DistribTran           PIC X(1)  VALUE "Y".
010570200423159011    88 lb_ProcessTran            VALUE "Y".
010580200423159011    88 lb_NoProcessTran          VALUE "N".
010590200423167010 01 lc_Matureflag            PIC X(1)  VALUE " ".
010600200423167010 01 lc_GICDetails.
010610200423167010    03 ln_GICMATCertIDno         PIC S9(10) Value Zero.
010620200423167010    03 ln_GICMATDate             PIC S9(09) Value Zero.
010630200423167010    03 ln_GICMATPlaceDate        PIC S9(09) Value Zero.
010640200423167010    03 ln_GICMATTransno          PIC S9(09) Value Zero.
010650200703
010660200703      *RFS184842 Starts
010670200703       01 lc_MultGICDetails.
010680200703          03 ln_MultGICMatCertIdNo     PIC S9(10) Value Zero.
010690200703          03 ln_MultGICMatDate         PIC S9(09) Value Zero.
010700200703      *RFS184842 Ends
010710200423      * RFS10008 - start                                                RFS10008
010720200423      * This parameters is used to call INTCLC                          RFS10008
010730200423       01 WSB-PARMS.                                                    RFS10008
010740200423          03 WSB-MODE                   PIC X(2).                       RFS10008
010750200423          03 WSB-ACCOUNT-NO             PIC S9(9).                      RFS10008
010760200423          03 WSB-INVESTMENT-CODE        PIC X(5).                       RFS10008
010770200423          03 WSB-CERT-ID-NO             PIC S9(10).                     RFS10008
010780200423          03 WSB-TRADE-DATE             PIC S9(8).                      RFS10008
010790200423          03 WSB-GROSS-AMT              PIC S9(11)V99.                  RFS10008
010800200423          03 WSB-INTEREST-AMT           PIC S9(11)V99.                  RFS10008
010810200423          03 WSB-SCHEDULE-CODE          PIC X(5).                       RFS10008
010820200423          03 WSB-REPMT-RED-FEE          PIC S9(11)V99.                  RFS10008
010830200423          03 WSB-RED-PENALTY            PIC S9(11)V99.                  RFS10008
010840200423          03 WSB-REPMT-RATE             PIC S9(3)V999.                  RFS10008
010850200423          03 WSB-PENALTY-RATE           PIC S9(3)V999.                  RFS10008
010860200423          03 WSB-RETCODE                PIC X(2).                       RFS10008
010870200423          03 WSB-RETCODE-DESC           PIC X(80).                      RFS10008
010880200423      * RFS10008 - end                                                  RFS10008
010890200423      * RFS10737 - Begin                                                RFS10008
010900200423          03 WSB-BALANCE                PIC S9(11)V99.                  RFS10008
010910200423      * RFS10737 - End                                                  RFS10008
010920200423113783    03 WSB-SETTLE-METHOD          PIC X(1).
010930200423113783    03 WSB-TRANS-TYPE             PIC X(3).
010940200423      * RFS135520- Begin
010950200423       01 WSC-PARMS.
010960200423          03 WSC-MODE                   PIC X(2).
010970200423          03 WSC-ACCOUNT-NO             PIC S9(9).
010980200423          03 WSC-INVESTMENT-CODE        PIC X(5).
010990200423          03 WSC-CERT-ID-NO             PIC S9(10).
011000200423          03 WSC-TRADE-DATE             PIC S9(8).
011010200423          03 WSC-GROSS-AMT              PIC S9(11)V99.
011020200423          03 WSC-INTEREST-AMT           PIC S9(11)V99.
011030200423          03 WSC-SCHEDULE-CODE          PIC X(5).
011040200423          03 WSC-REPMT-RED-FEE          PIC S9(11)V99.
011050200423          03 WSC-RED-PENALTY            PIC S9(11)V99.
011060200423          03 WSC-REPMT-RATE             PIC S9(3)V999.
011070200423          03 WSC-PENALTY-RATE           PIC S9(3)V999.
011080200423          03 WSC-RETCODE                PIC X(2).
011090200423          03 WSC-RETCODE-DESC           PIC X(80).
011100200423          03 WSC-BALANCE                PIC S9(11)V99.
011110200423          03 WSC-SETTLE-METHOD          PIC X(1).
011120200423          03 WSC-TRANS-TYPE             PIC X(3).
011130200423      * RFS135520- End
011140200423      * RFS11964 - Begin
011150200423       01 WS-PASS-PROCESS-DATE-SAV      PIC 9(08) VALUE ZEROES.
011160200423      * RFS11964 - End
011170200423R95850 01 Ws-Cmp-GBVGrossNet            PIC X(01) VALUE SPACES.
011180200423      * RFS22072 - Begin
011190200423       01 WS-TRANS-STATUS-CODE-SAV      PIC X(03).
011200200423      * RFS22072 - End
011210200423      * RFS 12261 BEGIN
011220200423       01 WS-ALL-NR-INTEREST            PIC S9(11)V99.
011230200423      * RFS 12261 END
011240200423      * RFS15841 - Begin
011250200423       01 WS-NR-NET-AMT                 PIC S9(11)V99.
011260200423      * RFS15841 - End
011270200423RF8464 01  WS-ORIGINAL-GROSS            PIC S9(11)V99.
011280200423113783 01  WS-GIC-INT-AMT               PIC S9(11)V99.
011290200423      *END GIC MOD
011300200423       01  WS-ACCOUNT-ASSIGN-PAC-REC.  COPY DD-ALL-FORMATS
011310200423                                            OF MFAACCASP.
011320200423       01  WS-TRANS-ASSIGN-PAC-REC.    COPY DD-ALL-FORMATS
011330200423                                            OF MFATRNASP.
011340200423      *RFS86395-Begin
011350200423       01  WS-ACCOUNT-ASSIGN-LOANID-REC.  COPY DD-ALL-FORMATS
011360200423                                            OF MFAACCASP.
011370200423       01  WS-TRANS-ASSIGN-LOANID-REC.    COPY DD-ALL-FORMATS
011380200423                                            OF MFATRNASLB.
011390200423      *RFS86395-End
011400200423       01 WS-TRANS-REC.        COPY DD-ALL-FORMATS OF MFATRNLD.
011410200423       01 WS-TRANS-REC-1.      COPY DD-ALL-FORMATS OF MFATRNLD.
011420200423       01 WS-TRANS-REC-2.      COPY DD-ALL-FORMATS OF MFATRNLD.
011430200423       01 WS-TRANS-REC-3.      COPY DD-ALL-FORMATS OF MFATRNLD.
011440200423       01 WS-TRANS-REC-4.      COPY DD-ALL-FORMATS OF MFATRNLD.
011450200423       01 WS-TRANS-REC-5.      COPY DD-ALL-FORMATS OF MFATRNLD.
011460200423      * RFS16941
011470200423       01 WS-TRANS-REC-5-SAV.  COPY DD-ALL-FORMATS OF MFATRNLD.
011480200423      * RFS16941
011490200423       01 WS-TRANS-REC-6.      COPY DD-ALL-FORMATS OF MFATRNLD.
011500200423       01 WS-INTEREST-TRANS.   COPY DD-ALL-FORMATS OF MFATRNLD.
011510200423      * RFS9530 - Begin
011520200423       01 WS-TEMP-TRANS-REC.   COPY DD-ALL-FORMATS OF MFATRNLD.
011530200423      * RFS9530 - End
01154020042392145  01 WS-TRANS-REC-7.      COPY DD-ALL-FORMATS OF MFATRNLD.
011550200423R50475 01 WS-TRANS-SWO-REC.    COPY DD-ALL-FORMATS OF MFATRNLD.
011560200423R24192 01 WS-NRR-DIST-TRANS.        COPY DD-ALL-FORMATS OF MFATRNLD.
011570200423R24192 01 WS-NRR-SEL-TRANS.         COPY DD-ALL-FORMATS OF MFATRNLD.
011580200423R24192 01 WS-NRR-TRANS-TARGET.      COPY DD-ALL-FORMATS OF MFATRNTGP.
011590200423R24192 01 WS-NRR-TRANS-REDEM-DTLS.  COPY DD-ALL-FORMATS OF MFATRNREP.
011600200423R24192 01 WS-NRR-BATCH-HDR-DTL.     COPY DD-ALL-FORMATS OF MFABCHHDP.
011610200423      * RFS17685 - Begin
011620200423       01 WS-INTEREST-ADJ-TRANS.  COPY DD-ALL-FORMATS OF MFATRNLD.
011630210624       01 WS-TRANS-INTEREST-ADJ-DETAILS.
011640200423                               COPY DD-ALL-FORMATS OF MFATRNIDP.
011650200423      * RFS17685 - End
011660200423       01 WS-TRANS-INTEREST-DETAILS.
011670200423                               COPY DD-ALL-FORMATS OF MFATRNIDP.
011680200423       01 WS-TRANS-BUY-LSIF-REC.
011690200423                               COPY DD-ALL-FORMATS OF MFATBLP.
011700200423       01 WS-TRANS-CONTRACT-DETAILS.
011710200423                               COPY DD-ALL-FORMATS OF MFATRCODP.
011720200423       01 WS-ACCOUNT-CONTRACT-INVESTMENT.
011730200423                               COPY DD-ALL-FORMATS OF MFAACCCIP.
011740200423      * RFS106558 - Starts
011750200423       01 WS-ACCOUNT-LOAN-DETAIL-REC.
011760200423                               COPY DD-ALL-FORMATS OF MFAACCLNP.
011770200423      * RFS106558 - Ends
011780200423      *RFS 13306 BEGIN
011790200423       01 WS-TRANS-CONTRACT-TARGET.
011800200423                               COPY DD-ALL-FORMATS OF MFATRCTGLA.
011810200423       01 WS-SEGFUND-MULTIPLE-WRITE.
011820200423110292*   03 WS-TRANS-CONTRACT-DETAILS-2       OCCURS 150.
011830200423110292    03 WS-TRANS-CONTRACT-DETAILS-2       OCCURS 500.
011840200423                               COPY DD-ALL-FORMATS OF MFATRCODP.
011850200423110292*   03 WS-ACCOUNT-CONTRACT-INVEST-2      OCCURS 150.
011860200423110292    03 WS-ACCOUNT-CONTRACT-INVEST-2      OCCURS 500.
011870200423                               COPY DD-ALL-FORMATS OF MFAACCCIP.
011880200423110292*   03 WS-TRANS-CONTRACT-TARGET-2        OCCURS 150.
011890200423110292    03 WS-TRANS-CONTRACT-TARGET-2        OCCURS 500.
011900200423                               COPY DD-ALL-FORMATS OF MFATRCTGLA.
011910200423110292*   03 WS-ACCOUNT-CONTRACT-2               OCCURS 150.
011920200423110292    03 WS-ACCOUNT-CONTRACT-2               OCCURS 500.
011930200423                               COPY DD-ALL-FORMATS OF MFAACCONP.
011940200423110292*   03 WS-ACCOUNT-CONT-ANNT-2               OCCURS 150.
011950200423110292    03 WS-ACCOUNT-CONT-ANNT-2               OCCURS 500.
011960200423                               COPY DD-ALL-FORMATS OF MFAACCANP.
011970200423       01 WS-INVESTMENT-SEG-IN.
011980200423          03 WS-INVESTMENT-CODE-IN            PIC X(5) VALUE SPACES.
011990200423          03 WS-GUAR-MAT-SCHED-CODE-IN        PIC X(5) VALUE SPACES.
012000200423          03 WS-GUAR-DEATH-SCHED-CODE-IN      PIC X(5) VALUE SPACES.
012010200423          03 WS-CONTRACT-STAT-SCHD-CODE-IN    PIC X(5) VALUE SPACES.
012020200423          03 WS-RESET-TYPE-CODE-IN            PIC X(1) VALUE SPACES.
012030200423          03 WS-MATURITY-ALLOW-DAYS-IN        PIC S9(4) VALUE 0.
012040200423          03 WS-GUAR-VALUE-INVESTMENT-IN      PIC X(5) VALUE SPACES.
012050200423          03 WS-RESET-SCHEDULE-CODE-IN        PIC X(5) VALUE SPACES.
012060200423          03 WS-CALC-METHOD-IN                PIC X(1) VALUE SPACES.
01207020042355140     03 Ws-Investment-Series-In          PIC X(5) VALUE SPACES.
01208020042357388     03 Ws-gdv-sched-code-in             PIC X(5) VALUE SPACES.
01209020042352328  01 ws-index                            PIC  9(9) VALUE 0.
01210020042352328  01 ws-can-consolidate                  PIC  X.
012110200423       01 WS-INVESTMENT-SEG-OUT.
012120200423          03 WS-INVESTMENT-CODE-OUT           PIC X(5) VALUE SPACES.
012130200423          03 WS-GUAR-MAT-SCHED-CODE-OUT       PIC X(5) VALUE SPACES.
012140200423          03 WS-GUAR-DEATH-SCHED-CODE-OUT     PIC X(5) VALUE SPACES.
012150200423          03 WS-CONTRACT-STAT-SCHD-CODE-OUT   PIC X(5) VALUE SPACES.
012160200423          03 WS-RESET-TYPE-CODE-OUT           PIC X(1) VALUE SPACES.
012170200423          03 WS-MATURITY-ALLOW-DAYS-OUT       PIC S9(4) VALUE 0.
012180200423          03 WS-GUAR-VALUE-INVESTMENT-OUT     PIC X(5) VALUE SPACES.
012190200423          03 WS-RESET-SCHEDULE-CODE-OUT       PIC X(5) VALUE SPACES.
012200200423          03 WS-CALC-METHOD-OUT               PIC X(1) VALUE SPACES.
01221020042355140     03 Ws-Investment-Series-Out         PIC X(5) VALUE SPACES.
01222020042357388     03 Ws-gdv-sched-code-out            PIC X(5) VALUE SPACES.
012230200423       01 WS-SEG-ARRAY-CTR                    PIC  9(9) VALUE 0.
012240200423       01 WS-ACI2-TOTAL                       PIC  9(9) VALUE 0.
012250200423       01 WS-TCD2-TOTAL                       PIC  9(9) VALUE 0.
012260200423       01 WS-SAME-DAY-FLAG                    PIC  X(1) VALUE 0.
012270200423       01 WS-SEG-OUT-CONTRACT-ARR.
012280200423      * RFS 157743 STARTS
012290200423      *   03 WS-SEG-ARRAY-CONTRACT     OCCURS 300 TIMES.
012300200423          03 WS-SEG-ARRAY-CONTRACT     OCCURS 3000 TIMES.
012310200423      * RFS 157743 ENDS
012320200423             10 WS-SEG-ARRAY-ACCOUNT-NO        PIC S9(9) VALUE 0.
012330200423             10 WS-SEG-ARRAY-PLACEMENT-DATE    PIC  9(9) VALUE 0.
012340200423             10 WS-SEG-ARRAY-TRANS-NO          PIC  9(9) VALUE 0.
012350200423             10 WS-SEG-ARRAY-CONTRACT-NO       PIC S9(9) VALUE 0.
012360200423             10 WS-SEG-ARRAY-INVESTMENT-CODE   PIC  X(5) VALUE SPACES.
012370200423             10 WS-SEG-ARRAY-CONTRACT-UNITS    PIC S9(9)V99999 VALUE 0.
012380200423      *RFS18686 Begin
012390200423             10 WS-SEG-ARRAY-TOTAL-UNITS       PIC S9(9)V99999 VALUE 0.
012400200423120908*      10 WS-SEG-ARRAY-OUT-PERC          PIC  9(4)V99999 VALUE 0.
012410200423120908       10 WS-SEG-ARRAY-OUT-PERC          PIC  9(4)V9(12) VALUE 0.
012420200423      *RFS18686 End
012430200423             10 WS-SEG-ARRAY-UNIT-PRICE        PIC S9(5)V9999  VALUE 0.
01244020042344930        10 Ws-Seg-Array-GDV-Percent       PIC S9(03)V9(02) VALUE 0.
012450200423       01 WS-OVERRIDE-CONTRACT-NO        PIC S9(9) VALUE 0.
012460200423       01 WS-SEG-NEW-CONTRACT            PIC X(1) VALUE SPACES.
012470200423          88 SEG-NEW-CONTRACT            VALUE 'Y'.
012480200423       01 WS-SEG-NEW-CONTRACT2           PIC X(1) VALUE SPACES.
012490200423          88 SEG-NEW-CONTRACT2           VALUE 'Y'.
012500200423       01 WS-SEG-TRANSFER-ANNUITANT      PIC X(1) VALUE SPACES.
012510200423          88 SEG-TRANSFER-ANNUITANT      VALUE 'Y'.
012520200423       01 WS-SEG-TRANSFER-MATURITY-DATE  PIC X(1) VALUE SPACES.
012530200423          88 SEG-TRANSFER-MATURITY-DATE  VALUE 'Y'.
012540200423       01 WS-SEG-DO-OLD-SEGFUND-LOGIC         PIC X(1) VALUE SPACES.
012550200423          88 SEG-DO-OLD-SEGFUND-LOGIC    VALUE 'Y'.
012560200423       01 WS-SEG-IN-ACCOUNT-NO           PIC 9(9)        VALUE ZEROES.
012570200423       01 WS-SEG-IN-INVESTMENT-CODE      PIC X(5)        VALUE SPACES.
012580200423       01 WS-SEG-OUT-ACCOUNT-NO          PIC 9(9)        VALUE ZEROES.
012590200423       01 WS-SEG-OUT-INVESTMENT-CODE     PIC X(5)        VALUE SPACES.
012600200423       01 WS-SEG-OUT-NUMBER-OF-CONTRACTS PIC 9(9)        VALUE ZEROES.
012610200423      *RFS 18686 Begin
012620200423      *01 WS-SEG-OUT-DOLLARS             PIC 9(11)V9(08) VALUE ZEROES.
012630200423120908*01 WS-SEG-OUT-PERC                PIC 9(04)V99999 VALUE ZEROES.
012640200423      *RFS 18686 End
012650200423      *RFS 15719 Begin
012660200423       01 WS-SEG-IN-UNITS                PIC S9(9)V9(03) VALUE ZEROES.
012670200423       01 WS-SEG-IN-UNITS-ACCUMULATED    PIC S9(9)V9(03) VALUE ZEROES.
012680200423      *RFS 15719 End
012690200423      *RFS 15847 Begin
012700200423       01 WS-SEG-OUT-PROCESSED-FLAG      PIC X(1)        VALUE SPACES.
012710200423          88 SEG-OUT-PROCESSED                           VALUE 'Y'.
012720200423       01 WS-SEG-VALIDATION-MODE-FLAG    PIC X(1)        VALUE 'N'.
012730200423          88 SEG-VALIDATION-MODE                         VALUE 'Y'.
012740200423      *RFS 15847 End
012750200423       01 WS-SEG-SAME-ACCOUNT-FLAG       PIC X(1)        VALUE SPACES.
012760200423          88 SEG-SAME-ACCOUNT                            VALUE 'Y'.
012770200423       01 WS-SEG-SAME-INVESTMENT-FLAG    PIC X(1)        VALUE SPACES.
012780200423          88 SEG-SAME-INVESTMENT                         VALUE 'Y'.
012790200423       01 WS-SEG-SAME-INVEST-TYPE-FLAG   PIC X(1)        VALUE SPACES.
012800200423          88 SAME-INVESTMENT-TYPE                        VALUE 'Y'.
012810200423       01 WS-SEG-BOTH-FUNDS-IN-CONTRACT  PIC X(1) VALUE SPACES.
012820200423          88 BOTH-FUNDS-IN-CONTRACT                      VALUE 'Y'.
012830200423       01 WS-SEG-CONTRACTS-LINKED-FLAG   PIC X(1) VALUE SPACES.
012840200423          88 CONTRACTS-LINKED                            VALUE 'Y'.
012850200423       01 WS-SEG-FUND-IN-LINKED-FLAG     PIC X(1) VALUE SPACES.
012860200423          88 FUND-IN-LINKED                              VALUE 'Y'.
012870200423
012880200423      **** The following flags are manipulated in order to determine
012890200423      **** whether the following 4 files need to be written or skipped
012900200423      **** within new Segfund multi-contract logic.
012910200423      ****
012920200423      ****         TRANS-CONTRACT-DETAILS(TCD)
012930200423      ****         ACCOUNT-CONTRACT-INVESTMENT(ACI)
012940200423      ****         ACCOUNT-CONTRACT(AC)
012950200423      ****         TRANS-CONTRACT-TARGET(TCT)
012960200423      ****         ACCOUNT-CONTRACT-ANNUITANT(ACA)
012970200423
012980200423       01 WS-CREATE-TCD-FLAG             PIC X(1) VALUE SPACES.
012990200423          88 CREATE-TCD                                  VALUE 'Y'.
013000200423       01 WS-CREATE-ACI-FLAG             PIC X(1) VALUE 'N'.
013010200423          88 CREATE-ACI                                  VALUE 'Y'.
013020200423       01 WS-CREATE-AC-FLAG              PIC X(1) VALUE 'N'.
013030200423          88 CREATE-AC                                   VALUE 'Y'.
013040200423       01 WS-CREATE-TCT-FLAG             PIC X(1) VALUE 'N'.
013050200423          88 CREATE-TCT                                  VALUE 'Y'.
013060200423       01 WS-CREATE-ACA-FLAG             PIC X(1) VALUE 'N'.
013070200423          88 CREATE-ACA                                  VALUE 'Y'.
013080200423      *RFS 15719 Begin
013090200423       01 WS-WRITE-REWRITE-ARRAYS.
013100200423110292*   03 WS-WRITE-REWRITE-ACI2-ARRAY         OCCURS 150.
013110200423110292    03 WS-WRITE-REWRITE-ACI2-ARRAY         OCCURS 500.
013120200423             05 WS-WRITE-REWRITE-ACI2            PIC X(1) VALUE SPACES.
013130200423      *RFS 15719 End
013140200423
013150200423       01 WS-WRITE-CTR-ARRAYS.
013160200423          05 WS-TCT2                     PIC 9(4) VALUE 0.
013170200423          05 WS-ACI2                     PIC 9(4) VALUE 0.
013180200423          05 WS-TCD2                     PIC 9(4) VALUE 0.
013190200423          05 WS-ACC2                     PIC 9(4) VALUE 0.
013200200423          05 WS-ACA2                     PIC 9(4) VALUE 0.
013210200423      *RFS 13306 END
013220200423      *RFS 16941 Begin
013230200423       01 WS-SETTRFBW-MODE-O-FLAG           PIC X(1) VALUE "N".
013240200423            88 WS-SETTRFBW-MODE-O-ON                 VALUE "Y".
013250200423            88 WS-SETTRFBW-MODE-O-OFF                VALUE "N".
013260200423       01 WS-TRF-BW-ERR-FLAG                PIC X(1) VALUE SPACES.
013270200423            88 WS-TRF-BW-ERR-OK                      VALUE SPACES.
013280200423            88 WS-TRF-BW-ERR-OPEN                    VALUE "1".
013290200423            88 WS-TRF-BW-ERR-OVERRIDE                VALUE "2".
013300200423       01 WS-FROM-ENV-DATA.
013310200423          05 WS-FROM-PLACEMENT-DATE         PIC 9(09) VALUE ZEROES.
013320200423          05 WS-FROM-TRANS-NO               PIC 9(09) VALUE ZEROES.
013330200423          05 WS-FROM-MANAGEMENT-CO-CATAGORY PIC X(10) VALUE SPACES.
013340200423          05 WS-FROM-LIBRARY-NAME           PIC X(10) VALUE SPACES.
013350200423            88 WS-FROM-LIBRARY-NOT-EXISTS             VALUE SPACES.
013360200423       01 WS-FXENVPUR-PLACEMENT-DATE     PIC 9(09) VALUE ZEROES.
013370200423       01 WS-FXENVPUR-TRANS-NO           PIC 9(09) VALUE ZEROES.
013380200423       01 WS-FXENVPUR-PLACEMENT-DATE-2   PIC 9(09) VALUE ZEROES.
013390200423       01 WS-FXENVPUR-TRANS-NO-2         PIC 9(09) VALUE ZEROES.
013400200423       01 WS-FXENVPUR-COMPANY-CODE       PIC X(03) VALUE SPACES.
013410200423       01 WS-FXENVPUR-LIBRARY-NAME       PIC X(10) VALUE SPACES.
013420200423       01 WS-FXENVPUR-RETURN-CODE        PIC X(02) VALUE SPACES.
013430200423       01 WS-SETTRFBW-LIBRARY            PIC X(10) VALUE SPACES.
013440200423       01 WS-SETTRFBW-ACTION             PIC X(02) VALUE SPACES.
013450200423       01 WS-SETTRFBW-RETURN-CODE        PIC X(02) VALUE SPACES.
013460200423       01 WS-CHECKTRNS-PLACEMENT-DATE-2  PIC 9(09) VALUE 0.
013470200423       01 WS-CHECKTRNS-TRANS-NO-2        PIC 9(09) VALUE 0.
013480200423       01 WS-NET-AMT                     PIC S9(11)V99.
013490200423       01 WS-CHECKTRNS-LIBRARY           PIC X(10) VALUE SPACES.
013500200423       01 WS-CHECKTRNS-CHECK-CODE        PIC X(01) VALUE SPACES.
013510200423       01 WS-CHECKTRNS-PASS-FAIL         PIC X(01) VALUE SPACES.
013520200423       01 WS-CHECKTRNS-REJECT-MESSAGE    PIC X(45) VALUE SPACES.
013530200423       01 WS-MANAGEMENT-COMPANY          PIC X(03) VALUE SPACES.
013540200423      *RFS 16941 End
013550200423      *RFS 18486 BEGIN
013560200423       01 WS-TBL-ALREADY-EXISTS          PIC X(01) VALUE SPACES.
013570200423          88 TBL-ALREADY-EXISTS                    VALUE "Y".
013580200423      *RFS 18486 END
013590200423      *RFS 16760 BEGIN
013600200423       01 WS-SAVE-TYPE                         PIC X(03) VALUE SPACES.
013610200423       01 WS-LBS-VALIDATION-MODE-FLAG          PIC X(01) VALUE SPACES.
013620200423       01 WS-TBL-FREE-UNITS                    PIC 9(10)V999 VALUE 0.
013630200423       01 WS-TBL-ARRAY-CTR                     PIC 9(09) VALUE 0.
013640200423       01 WS-TBL-ARRAY-CTR-2                   PIC 9(09) VALUE 0.
013650200423       01 WS-TBL-ARRAY-CHARGE-CLAWBACK         PIC X(01) VALUE SPACES.
013660200423      * RFS 19900 Start
013670200423       01 WS-UPDATE-LSIF-FILES-BEFORE          PIC X(01) VALUE SPACES.
013680200423      * RFS 19900 End
013690200423
013700200423      * RFS15626 - Begin
013710200423       01 WS-TBL-ARRAY-MAX     PIC S9(05) PACKED-DECIMAL VALUE 800.
013720200423       01 WS-TEMP-IND                          PIC 9(09) VALUE 0.
013730200423      * RFS15626 - End
013740200423
013750200423       01 WS-TBL-UPDATE-LSIF-FILES             PIC X(01) VALUE SPACES.
013760200423
013770200423      * RFS25821 - Begin
013780200423       01 WS-CURR-UNITS-BAL-PER-PHANTOM        PIC S9(09)V9(03) COMP-3.
013790200423       01 WS-CURR-AA-MODEL-CODE                PIC X(04).
013800200423      * RFS25821 - End
013810200423
013820200423      * RFS 16590 Start
013830200423       01 WS-LSIF-SYNC-DSC                     PIC X(01) VALUE SPACES.
013840200423       01 WS-SKIP-CDSC-RECORD                  PIC X(01) VALUE SPACES.
013850200423       01 WS-TRANS-UNIT-AMT                    PIC 9(10)V999 VALUE 0.
013860200423       01 WS-F-RY-CONTR                        PIC 9(11)V99 VALUE 0.
013870200423       01 WS-P-RY-CONTR                        PIC 9(11)V99 VALUE 0.
013880200423       01 WS-F-F60-CONTR                       PIC 9(11)V99 VALUE 0.
013890200423       01 WS-P-F60-CONTR                       PIC 9(11)V99 VALUE 0.
013900200423       01 WS-F-CONTR-MAX                       PIC 9(11)V99 VALUE 0.
013910200423       01 WS-P-CONTR-MAX                       PIC 9(11)V99 VALUE 0.
013920200423       01 WS-PARTIAL-OVERCON                   PIC 9(11)V99 VALUE 0.
013930200423       01 WS-FED-OVERCON-AMOUNT                PIC S9(11)V99 VALUE 0.
013940200423       01 WS-PRV-OVERCON-AMOUNT                PIC S9(11)V99 VALUE 0.
01395020042327050 *01 WS-YEARLY-CONTR                      PIC 9(11)V99 VALUE 0.
013960200423      * RFS40362 - Begin
013970200423        01 Ws-Overcon-Prv                      PIC S9(11)V99 VALUE 0.
013980200423 27050*01 WS-OVERCON-PRV                       PIC 9(11)V99 VALUE 0.
013990200423      * RFS40362 - End
014000200423       01 WS-CURR-BOOK-VAL                     PIC 9(11)V99 VALUE 0.
014010200423       01 WS-TAX-YEAR-PRV                      PIC 9(04)    VALUE 0.
014020200423       01 WS-PROVINCE-CODE-PRV                 PIC X(03) VALUE SPACES.
014030200423       01 WS-SPOUSAL-ACCOUNT-FLAG              PIC X(01) VALUE SPACES.
014040200423       01 WS-FED-SPOUSAL-PERMITTED             PIC X(01) VALUE SPACES.
014050200423       01 WS-PRV-SPOUSAL-PERMITTED             PIC X(01) VALUE SPACES.
01406020042327050 *01 WS-F-NON-CLAW-UNITS-REDUCED          PIC 9(10)V999 VALUE 0.
01407020042327050 *01 WS-P-NON-CLAW-UNITS-REDUCED          PIC 9(10)V999 VALUE 0.
01408020042327050  01 WS-F-TAX-CREDIT-ELIG-UNITS-RED       PIC 9(10)V999 VALUE 0.
01409020042327050  01 WS-P-TAX-CREDIT-ELIG-UNITS-RED       PIC 9(10)V999 VALUE 0.
014100200423       01 WS-FED-OVERCON-UNITS                 PIC 9(11)V999 VALUE 0.
014110200423       01 WS-PRV-OVERCON-UNITS                 PIC 9(11)V999 VALUE 0.
014120200423       01 WS-OVERCON-UNITS-TO-REDEEM           PIC 9(9)V9(3) VALUE 0.
014130200423       01 WS-LBS-CDSC-UNITS-TO-REDUCE          PIC 9(9)V9(3) VALUE 0.
014140200423      * RFS 16590 End
014150200423      * RFS 23433 Start
014160200423       01 WS-PARTIAL-UNITS-TO-REDEEM           PIC 9(9)V9(3) VALUE 0.
01417020042328482**01 TBLP-TRANSACTION-CATAGORIES.
01418020042328482**   05 TBLP-TRANS-CATAGORY              PIC X(3).
01419020042328482**      88 TBLP-DISTRIBUTION        VALUES "INC" "CPG" "INT" "MFR".
014200200423      * RFS 23433 End
014210200423      *This array will hold TRANS-BUY-LSIF and TRANS-SELL-LSIF records
014220200423      *in order to write/rewrite records after array is looped through
014230200423      *several times and updated for the following 3 activities:
014240200423      *1) Exhaust overcontributed units
014250200423      *2) Exhaust Clawback Free units
014260200423      *3) Exhaust Clawback Charged units
014270200423       01 WS-TRANS-BUY-LSIF-ARRAY.
014280200423      * RFS 18781 - increased size of the array below because of significant
014290200423      * number of converted CGI MFATBLP records for the account/investment comb.
01430020042318781 *   03 WS-TBL-ARRAY                      OCCURS 150.
01431020042318781     03 WS-TBL-ARRAY                      OCCURS 800.
014320200423             COPY DD-ALL-FORMATS OF MFATBLP.
014330200423             05 WS-TSL-RECORD-CREATED          PIC X(01) VALUE SPACES.
014340200423             05 WS-TSL-PLACEMENT-DATE          PIC 9(09) VALUE 0.
014350200423             05 WS-TSL-TRANS-NO                PIC 9(09) VALUE 0.
014360200423             05 WS-TSL-LSIF-SEQ-NO             PIC 9(08) VALUE 0.
014370200423             05 WS-TSL-PLACEMENT-DATE-2        PIC 9(09) VALUE 0.
014380200423             05 WS-TSL-TRANS-NO-2              PIC 9(09) VALUE 0.
014390200423             05 WS-TSL-LSIF-SEQ-NO-2           PIC 9(08) VALUE 0.
014400200423             05 WS-TSL-TRADE-DATE              PIC 9(09) VALUE 0.
014410200423             05 WS-TSL-UNITS-REDUCED           PIC 9(10)V999 VALUE 0.
014420200423      *RFS 18540 Begin
014430200423      *      05 WS-TSL-OVERCON-UNITS-REDUCED   PIC 9(10)V999 VALUE 0.
014440200423      *RFS 18540 End
014450200423      *RFS16590 Start
014460200423      *      05 WS-TSL-CLAWBACK-FREE-REDUCED   PIC 9(10)V999 VALUE 0.
014470200423      *      05 WS-TSL-CLAWBACK-CHRG-REDUCED   PIC 9(10)V999 VALUE 0.
014480200423      *RFS16590 End
014490200423             05 WS-TSL-TRANS-TYPE-CODE         PIC X(03) VALUE SPACES.
014500200423             05 WS-TSL-LSIF-WAIVE-CLAWBACK-FED PIC X(01) VALUE SPACES.
014510200423             05 WS-TSL-LSIF-WAIVE-CLAWBACK-PRV PIC X(01) VALUE SPACES.
014520200423             05 WS-TSL-LSIF-FED-CLAWBACK-AMT   PIC 9(11)V99 VALUE 0.
014530200423             05 WS-TSL-LSIF-PROV-CLAWBACK-AMT  PIC 9(11)V99 VALUE 0.
014540200423             05 WS-TSL-LSIF-STATUS             PIC X(01) VALUE SPACES.
014550200423             05 WS-TSL-REPORTED-DATE           PIC 9(09) VALUE 0.
014560200423      *RFS16590 Start
014570200423             05 WS-TSL-PROV-CLAWBACK-UNITS-RED PIC 9(10)V999 VALUE 0.
014580200423             05 WS-TSL-FED-CLAWBACK-UNITS-RED  PIC 9(10)V999 VALUE 0.
014590200423      *RFS16590 End
014600200423      *RFS 18191 Begin
014610200423             05 WS-TBL-LSIF-STATUS             PIC X(01) VALUE SPACES.
014620200423      *RFS 18191 End
014630200423             05 WS-TBL-CLAWBACK-FREE-UNITS     PIC 9(09)V999 VALUE 0.
014640200423      *RFS 18540 Begin
014650200423      *      05 WS-TBL-OVERCON-UNITS           PIC 9(09)V999 VALUE 0.
014660200423      *RFS 18540 End
014670200423             05 WS-TBL-FED-CLAWBACK-CODE       PIC X(01) VALUE SPACES.
014680200423             05 WS-TBL-PROV-CLAWBACK-CODE      PIC X(01) VALUE SPACES.
014690200423             05 WS-TBL-WAIVE-CLAWBACK-YN-F     PIC X(01) VALUE SPACES.
014700200423             05 WS-TBL-WAIVE-CLAWBACK-YN-P     PIC X(01) VALUE SPACES.
014710200423             05 WS-TBL-PROV-CLAWBACK-CHARGE    PIC 9(09)V99  VALUE 0.
014720200423             05 WS-TBL-FED-CLAWBACK-CHARGE     PIC 9(09)V99  VALUE 0.
014730200423      *RFS16590 Start
014740200423             05 WS-TBL-OVERCON-REDUCED         PIC 9(09)V999 VALUE 0.
014750200423             05 WS-TBL-FED-OS-OVERCON          PIC 9(09)V999 VALUE 0.
014760200423             05 WS-TBL-PRV-OS-OVERCON          PIC 9(09)V999 VALUE 0.
014770200423      *RFS16590 End
014780200423      * RFS15626 - Begin
014790200423             05 WS-TBL-GRACE-CALCULATION-TYPE PIC X(01).
014800200423             05 WS-TBL-GRACE-DAYS             PIC S9(03)
014810200423                                                PACKED-DECIMAL.
014820200423      * RFS15626 - End
014830200423      *RFS 16760 END
014840200423      *RFS 18191 BEGIN
014850200423       01 WS-JURISDICTION-CHECK-FLAGS.
014860200423          05 WS-FED-JURISDICTION-EXIST      PIC X(01) VALUE SPACES.
014870200423          05 WS-FED-JURISDICTION-ISSUE      PIC X(01) VALUE SPACES.
014880200423          05 WS-FED-CHARGE-EXTRA-CLAWBACK   PIC X(01) VALUE SPACES.
014890200423          05 WS-PRV-JURISDICTION-EXIST      PIC X(01) VALUE SPACES.
014900200423          05 WS-PRV-JURISDICTION-ISSUE      PIC X(01) VALUE SPACES.
014910200423          05 WS-PRV-CHARGE-EXTRA-CLAWBACK   PIC X(01) VALUE SPACES.
014920200423      *RFS 18191 END
014930200423R21254 01 WS-TEMP-NET-AMT                      PIC S9(11)V99  VALUE 0.
014940200423      *RFS 19058 Begin
014950200423      *01 WS-JULIAN-TRADE-DATE                 PIC 9(08)      VALUE 0.
014960200423      *01 WS-JULIAN-AGE-DATE                   PIC 9(08)      VALUE 0.
014970200423       01 WS-CONTRACT-RECENTLY-OPEN-FLAG       PIC X(01) VALUE SPACES.
014980200423          88 CONTRACT-RECENTLY-OPEN            VALUE "Y".
014990200423       01 WS-AC-ACCOUNT-NO                     PIC S9(09) VALUE ZEROES.
015000200423       01 WS-AC-CONTRACT-NO                    PIC S9(09) VALUE ZEROES.
015010200423       01 WS-AC-START-DATE                     PIC  9(08) VALUE ZEROES.
015020200423       01 WS-AC-ACTIVE-DAYS                    PIC  9(09) VALUE ZEROES.
015030200423       01 WS-AC-ACTIVE-DATE                    PIC  9(08) VALUE ZEROES.
015040200423       01 WS-AC-CONTRACT-STATUS                PIC  X(01) VALUE SPACES.
015050200423      *RFS 19058 End
015060200423127383 01 LI-CON-START-DATE                    PIC  9(08) VALUE ZEROES.
015070200423
015080200423      *RFS29134 - Begins
015090200423       01 WS-ERF-THRESHOLD-WAIVE-FLAG          PIC X(1) VALUE SPACES.
015100200423       01 WS-ERF-AWD-OR-DCA                    PIC X(3).
015110200423          88 ERF-AWD-OR-DCA             VALUES "AWE" "AWC" "ALC"
015120200423                                               "ALE" "AWR" "DCA" "DLA".
015130200423      *RFS29134 - Ends
015140200423      *RFS 14380 Begin
015150200423       01 WS-WAIVE-ERF-FLAG                    PIC X(01) VALUE SPACES.
015160200423          88 WAIVE-ERF                         VALUE "Y".
015170200423       01 WS-ERF-NET-GROSS-FACTOR              PIC S9(11)V99  VALUE 0.
015180200423       01 WS-ERF-DOLLARS-REDUCED               PIC S9(11)V99  VALUE 0.
015190200423       01 WS-JULIAN-TRADE-DATE                 PIC 9(08)      VALUE 0.
015200200423       01 WS-JULIAN-AGE-DATE                   PIC 9(08)      VALUE 0.
015210200423       01 WS-ERF-AGE-DIFFERENCE                PIC 9(09)      VALUE 0.
015220200423       01 WS-ERF-PRICE                         PIC S9(5)V9999 VALUE 0.
015230200423       01 WS-ERF-USE-FREE                      PIC X(1) VALUE "N".
015240200423       01 WS-ERF-VALIDATION-MODE-FLAG          PIC X(01) VALUE SPACES.
015250200423       01 WS-ERF-SWI-SEQ                       PIC 9(08) VALUE ZEROES.
015260200423       01 WS-ERF-SELL-SEQ                      PIC 9(08) VALUE ZEROES.
015270200423       01 WS-TEP-ARRAY-CHARGE-ERF              PIC X(01) VALUE SPACES.
015280200423       01 WS-TRANS-ERF-PURCHASE-REC.
015290200423                               COPY DD-ALL-FORMATS OF MFATRNEPP.
015300200423       01 WS-TEP-CURR-UNITS-FREE               PIC 9(10)V999 VALUE 0.
015310200423       01 WS-TEP-UPDATE-ERF-FILES              PIC X(01) VALUE SPACES.
015320200423       01 WS-ERF-UNITS-TO-REDEEM               PIC S9(9)V9(3) VALUE 0.
015330200423       01 WS-TEP-ARRAY-CTR                     PIC 9(09)      VALUE 0.
015340200423       01 WS-TEP-ARRAY-CTR-2                   PIC 9(09)      VALUE 0.
015350200423      * RFS 20200 Start
015360200423       01 WS-TEP-MAX                           PIC 9(09)      VALUE 0.
015370200423      * RFS 20200 End
015380200423      * RFS 23477 Begin
015390200423       01 WS-CURR-UNIT-BAL-ACCUMULATOR         PIC 9(10)V999  VALUE 0.
015400200423       01 WS-CURR-UNIT-BAL-MISSING             PIC S9(10)V999 VALUE 0.
015410200423      * RFS 23477 End
015420200423      * RFS 20515 Start
015430200423       01 WS-CDSC-RATE                         PIC 9(03)V999  VALUE 0.
015440200423       01 WS-DAF-RATE                          PIC 9(03)V999  VALUE 0.
015450200423       01 WS-REDF-RATE                         PIC 9(03)V999  VALUE 0.
015460200423       01 WS-HRDF-RATE                         PIC 9(03)V999  VALUE 0.
015470200423115704*01 WS-GST-RATE                          PIC 9(03)V999  VALUE 0.
015480200423115704*01 WS-PST-RATE                          PIC 9(03)V999  VALUE 0.
015490200423115704 01 WS-GST-RATE                          PIC 9(03)V9(5) VALUE 0.
015500200423115704 01 WS-PST-RATE                          PIC 9(03)V9(5) VALUE 0.
015510200423      * RFS 20515 End
015520200423       01 WS-TRANS-ERF-PURCHASE-ARRAY.
015530200423      * RFS 20200 Start
015540200423      *   03 WS-TEP-ARRAY                      OCCURS 150.
015550200423      * RFS1017119 - Start: increased array size
015560200423      *   03 WS-TEP-ARRAY                      OCCURS 1 TO 2000
015561211004      * RFS 1115611 - Starts
015570211004      *   03 WS-TEP-ARRAY                      OCCURS 1 TO 6000
015571211004          03 WS-TEP-ARRAY                      OCCURS 1 TO 30000
015572211004      * RFS 1115611 - Starts
015580200423      * RFS1017119 - End
015590200423                                               DEPENDING ON WS-TEP-MAX.
015600200423      * RFS 20200 End
015610200423             COPY DD-ALL-FORMATS OF MFATRNEPP.
015620200423             05 WS-TES-RECORD-CREATED          PIC X(01) VALUE SPACES.
015630200423             05 WS-TES-PLACEMENT-DATE          PIC 9(09) VALUE 0.
015640200423             05 WS-TES-TRANS-NO                PIC 9(09) VALUE 0.
015650200423             05 WS-TES-ERF-SEQ-NO              PIC 9(08) VALUE 0.
015660200423             05 WS-TES-PLACEMENT-DATE-2        PIC 9(09) VALUE 0.
015670200423             05 WS-TES-TRANS-NO-2              PIC 9(09) VALUE 0.
015680200423             05 WS-TES-ERF-SEQ-NO-2            PIC 9(08) VALUE 0.
015690200423             05 WS-TES-ERF-STATUS              PIC X(01) VALUE SPACES.
015700200423             05 WS-TES-FREE-UNITS-TAKEN-DOWN   PIC 9(10)V999 VALUE 0.
015710200423             05 WS-TES-CHRG-UNITS-TAKEN-DOWN   PIC 9(10)V999 VALUE 0.
015720200423             05 WS-TES-ERF-CHARGED             PIC 9(09)V99  VALUE 0.
015730200423             05 WS-TES-REVERSED                PIC X(01) VALUE SPACES.
015740200423             05 WS-TES-AGE-DATE                PIC 9(09) VALUE 0.
015750200423             05 WS-TES-ERF-SCHEDULE-CODE       PIC X(08) VALUE SPACES.
015760200423      * RFS 26847 Begin
015770200423      *      05 WS-TES-UNIT-PRICE              PIC 9(10)V999 VALUE 0.
015780200423             05 WS-TES-UNIT-PRICE              PIC 9(10)V9999 VALUE 0.
015790200423      * RFS 26847 End
015800200423      * -- RFS33712 Begins
015810200423             05 ld-Tes-Chrg-Units-Taken-Dwn-Fr PIC 9(10)V999 VALUE 0.
015820200423      * -- RFS33712 Ends
015830200423      *RFS 14380 End
015840200423      *RFS 20265 Begin
015850200423       01 WS-NOMINEE-ACCOUNT-TYPE           PIC X(05) VALUE SPACES.
015860200423       01 WS-SKIP-TRANS-BUY-LSIF-FLAG          PIC X(01) VALUE SPACES.
015870200423          88 SKIP-TRANS-BUY-LSIF                         VALUE "Y".
015880200423      *RFS 20265 End
015890200423
015900200423      *RFS 25997 Begin
015910200423       01 WS-LLP-REJECT                     PIC X(01) VALUE SPACES.
015920200423          88 LLP-REJECT                     VALUE "Y".
015930200423      *RFS 25997 End
015940200423       01 WS-ACCOUNT-CONTRACT.
015950200423                               COPY DD-ALL-FORMATS OF MFAACCONP.
015960200423      *RFS185169  Starts
015970200423       01 WS-ACCOUNT-BENEFITS.
015980200423                               COPY DD-ALL-FORMATS OF MFAACLBENP.
015990200423      *RFS185169  Ends
016000200423       01 WS-ACCOUNT-CONT-ANNT.
016010200423                               COPY DD-ALL-FORMATS OF MFAACCANP.
016020200423R52779 01 WS-ACCOUNT-CONT-ANNT-JL.
016030200423R52779                         COPY DD-ALL-FORMATS OF MFAACCANP.
016040200423       01 WS-GIC-TRANS-RELATIONSHIP-REC.
016050200423                                 COPY DD-ALL-FORMATS OF MFAGITRP.
016060200423      /
016070200423      * RFS14090 - Begin
016080200423       01 WS-ACCNT-LEVEL-FREE-HLD-REC.
016090200423                               COPY DD-ALL-FORMATS OF MFAALVFAP.
016100200423      * RFS14090 - End
016110200423      * RFS26557 Start
016120200423       01 NEW-LSIF-BUY-VARIABLES.
016130200423          03 WS-PROVINCE-CODE                  PIC X(03) VALUE SPACES.
016140200423          03 WS-FED-TAX-CREDIT-PARMS-EXIST     PIC X(01) VALUE "N".
016150200423          03 WS-PRV-TAX-CREDIT-PARMS-EXIST     PIC X(01) VALUE "N".
016160200423          03 WS-FED-BOX-ID                     PIC X(02) VALUE SPACES.
016170200423          03 WS-PRV-BOX-ID                     PIC X(02) VALUE SPACES.
016180200423          03 WS-FED-PRINT-DATE                 PIC 9(09) VALUE 0.
016190200423          03 WS-PRV-PRINT-DATE                 PIC 9(09) VALUE 0.
016200200423          03 WS-JURISDICTION-EXIST             PIC X(01) VALUE SPACES.
016210200423          03 WS-JURISDICTION-ISSUE             PIC X(01) VALUE SPACES.
016220200423      * RFS26557 End
016230200423      * RFS26557X3 Start
016240200423       01 WS-LSIF-STATUS-SV                    PIC X(01) VALUE " ".
016250200423       01 WS-LSIF-STATUS-MFATSLP               PIC X(01) VALUE " ".
016260200423      * RFS26557X3 End
016270200423
016280200423      *RFS29550 - Begins
016290200423       01 WS-USWT-ACCOUNT-NO             PIC 9(9)       VALUE 0.
016300200423       01 WS-USWT-INVESTOR-NO            PIC 9(9)       VALUE 0.
016310200423R30190*01 WS-USWT-NOMINEE-CODE           PIC X(5)       VALUE SPACES.
016320200423R30190*01 WS-USWT-DEALER-CODE            PIC X(4)       VALUE SPACES.
016330200423R30190 01 WS-USWT-PLACEMENT-DATE         PIC 9(9)       VALUE 0.
016340200423R30190 01 WS-USWT-TRANS-NO               PIC 9(9)       VALUE 0.
016350200423R30190 01 WS-USWT-ACCOUNT-TYPE-CODE      PIC X(5)       VALUE SPACES.
016360200423R30190 01 WS-USWT-CONTR-REDEM-CODE       PIC X(6)       VALUE SPACES.
016370200423       01 WS-USWT-TRANS-TYPE-CODE        PIC X(3)       VALUE SPACES.
016380200423       01 WS-USWT-TRADE-DATE             PIC 9(9)       VALUE 0.
016390200423       01 WS-USWT-TAX-RATE               PIC S9(3)V99   VALUE 0.
016400200423       01 WS-USWT-APPLY-TAX              PIC X(1)       VALUE SPACES.
016410200423          88 USWT-APPLY-TAX              VALUE "Y".
016420200423       01 WS-USWT-RETURN-CODE            PIC X(3)       VALUE SPACES.
016430200423      *RFS29550 - Ends
016440200423R43677*RFS 43677 - Begin
016450200423       01 Link-Notes-Maturity-NR.
016460200423          03 Ws-Lnk-Maturity-NR-Flag     PIC X(01)      Value SPACES.
016470200423             88 Link-Maturity-NR         VALUE "Y".
016480200423      *RFS183140 - Begin
016490200423          03 Ws-Lnk-Pre-Maturity-Flag    PIC X(01)      Value SPACES.
016500200423             88 Link-Pre-Maturity        VALUE "Y".
016510200423      *RFS183140 - End
016520200423          03 Ws-Acct-Type-Cash           PIC X(01)      Value SPACES.
016530200423             88 Acct-Type-Cash           VALUE "Y".
016540200423          03 Ws-Nom-Acct-Type-Cash       PIC X(01)      Value SPACES.
016550200423             88 Nom-Acct-Type-Cash       VALUE "Y".
016560200423R53578       88 Nom-Acct-Type-Registered VALUE "N".
016570200423R43677*RFS 43677 - End
016580200423
016590200423      *RFS24191 - Begins
016600200423       01 WS-POOLED-FUND                 PIC X(1) VALUE SPACES.
016610200423          88 POOLED-FUND                 VALUE "Y".
016620200423       01 WS-INCRATCPG-CALC              PIC X(1) VALUE SPACES.
016630200423          88 INCRATCPG-CALC              VALUE "Y".
016640200423       01 WS-POOLED-FUNCTION             PIC X(1) VALUE SPACES.
016650200423          88 POOLED-FUNCTION             VALUE "Y".
016660200423
016670200423       01 WS-ACCOUNT-TYPE-RULE           PIC X(1) VALUE SPACES.
01668020042354435     88 TFSA-ACCOUNT-RULE           VALUE "9".
01669020042354431     88 RDSP-ACCOUNT-RULE           VALUE "0".
016700200423       01 WS-ACCOUNT-TYPE-RULE-NOMINEE   PIC X(1) VALUE SPACES.
01671020042354435     88 TFSA-NOMINEE-ACCOUNT-RULE   VALUE "9".
01672020042380658  01 WS-ACCOUNT-NO-FOR-RULE         PIC S9(9) VALUE 0.
016730200423
016740200423       01 WS-FXINVTY-INVESTMENT-CODE     PIC X(5) VALUE SPACES.
016750200423       01 WS-FXINVTY-RETURN-CODE         PIC X(1) VALUE SPACES.
016760200423      *RFS24191 - Ends
016770200423      *RFS24190 - Begins
016780200423       01 WS-NTAXT2062-CALC              PIC X(1) VALUE SPACES.
016790200423          88 NTAXT2062-CALC              VALUE "Y".
016800200423       01 WS-NTAXREGSEL-CALC             PIC X(1) VALUE SPACES.
016810200423          88 NTAXREGSEL-CALC             VALUE "Y".
016820200423       01 WS-AUC-CALCULATED              PIC X(1) VALUE SPACES.
016830200423          88 AUC-CALCULATED              VALUE "Y".
016840200423       01 WS-AUC-UNIT-COST-OK            PIC X(1) VALUE SPACES.
016850200423          88 AUC-UNIT-COST-OK            VALUE "Y".
016860200423       01 WS-AUC-INVESTMENT-CODE         PIC X(5) VALUE SPACES.
016870200423       01 WS-AUC-REJECTION-CODE          PIC X(3) VALUE SPACES.
016880200423       01 WS-TFR-AT-COST-OCCURS          PIC X(1) VALUE SPACES.
016890200423          88 TFR-AT-COST-OCCURS          VALUE "Y".
016900200423      *RFS24190 - Ends
016910200423      *RFS24192 - Begins
016920200423       01 WS-NNRDSTGN-NEW-BATCH-FLAG     PIC X(1) VALUE SPACES.
016930200423       01 WS-NNRDSTGN-RETURN-CODE        PIC X(3) VALUE SPACES.
016940200423       01 WS-NDSNRR-GENERATED            PIC X(1) VALUE "0".
016950200423       01 WS-NDSNRR-NO-READ              PIC X(1) VALUE "N".
016960200423      *RFS24192 - Ends
016970200423R35045 01 ADD-TAX-AMT-FLAG               PIC X(1) VALUE SPACES.
016980200423
016990200423      *RFS102421 Begins
017000200423       01 lb_WriteTransAsnFlag           PIC X(01).
017010200423          88 lb_WriteTransAsn_Yes        VALUE "Y".
017020200423          88 lb_WriteTransAsn_No         VALUE "N".
017030200423      *RFS102421 Ends
017040200423      *RFS92465 Begins
017050200423       01 ln_Assigned_Amt                PIC S9(11)V99  VALUE 0.
017060200423       01 ln_AssignedUnit_Conv           PIC S9(10)V999 VALUE 0.
017070200423       01 ln_PAC_UnitAss           PIC S9(10)V9(03) COMP-3 VALUE ZERO.
017080200423       01 lc_MoveAssFlag                 PIC X(01).
017090200423          88 lb_MoveAssFlagYes  VALUE "Y".
017100200423       01 WS-FXASNCAROV                  PIC X(10) VALUE 'FXASNCAROV'.
017110200423       01 WS-FROM-ACCOUNT-ASN            PIC S9(9).
017120200423       01 WS-TO-ACCOUNT-ASN              PIC S9(9).
017130200423       01 WS-TO-INV-CODE                 PIC X(5).
017140200423103437 01 li_TransNo_CarOvr              PIC S9(9) VALUE ZEROES.
017150200423113784 01 li_SucdCnt                     PIC S9(3) VALUE ZEROES.
017160200423113784 01 li_Rejcnt                      PIC S9(3) VALUE ZEROES.
017170200423
017180200423       01 lb_AssCarOvrflag               PIC 1.
017190200423           88  lb_AssCarOvr_No           VALUE B"0".
017200200423           88  lb_AssCarOvr_Yes          VALUE B"1".
017210200423      *RFS92465 Ends
017220200423
017230200423R92465 COPY CPYASNCAR.
017240200423       01 WS-ACCT-ASSIGNMENT.
017250200423      ******************************************************************
017260200423      *    A C C O U N T   A S S I G N M E N T   D A T A               *
017270200423      ******************************************************************
017280200423
017290200423           03  WS-ACCOUNT-ASSIGNMENT   OCCURS  25  TIMES
017300200423                                       INDEXED BY  PACIDX
017310200423                                                   PACMAX.
017320200423                                       COPY DD-ALL-FORMATS
017330200423                                            OF MFAACCASP.
017340200423       01 WS-ACCT-ASSIGNMENT-TARGET.
017350200423      ******************************************************************
017360200423      *    A C C O U N T   A S S I G N M E N T   T A R G E T   D A T A *
017370200423      ******************************************************************
017380200423      *****    The following fields will occur once for every Account
017390200423      *****    Assignment entry defined above under WS-ACCT-ASSIGNMENT.
017400200423           03  WS-ACCT-ASS-TARGET      OCCURS  25  TIMES
017410200423                                       INDEXED BY  PACIDX2.
017420200423               05  WS-FRM-ASGN-AMOUNT  PICTURE S9(11)V9(3) COMP-3.
017430200423               05  WS-FRM-ASGN-STATUS  PICTURE X(1).
017440200423               05  WS-FRM-ASGN-UNITS   PICTURE S9(11)V9(3) COMP-3.
017450200423      /
017460200423       01  WS-CB-CPYCALDR.             COPY CPYCALDR.
017470200423      /
017480200423                                       COPY DRG2JLS.
017490200423
017500200423                                       COPY DRJ2GLS.
017510200423      *RFS 16454 Begin
017520200423                                       COPY DRLEAPLS.
017530200423      *RFS 16454 End
017540200423      *RFS 16941 Begin
017550200423                                       COPY CPYENVRED.
017560200423      *RFS 16941 End
017570200423       01  WS-PGM-DEFINED-WORK-ITEMS.
017580200423      ******************************************************************
017590200423      *    P R O G R A M   D E F I N E D   W O R K   I T E M S         *
017600200423      ******************************************************************
017610200423      *****    Miscellaneous Numeric Items.
017620200423
017630200423           03  WS-ASSIGN-SEQ-NO        PICTURE S9(3)       COMP-3.
017640200423
017650200423           03  WS-SYSTIM-X.
017660200423               05  WS-SYSTIM           PICTURE 9(8).
017670200423               05  WS-SYSTIM-R         REDEFINES WS-SYSTIM.
017680200423                   07  WS-SYSTIM-1-4   PICTURE 9(4).
017690200423                   07  FILLER          PICTURE X(4).
017700200423      *****
017710200423      *****    Miscellaneous Switches.
017720200423      *****
017730200423           03  WS-MFAACCASP-WSW        PICTURE X(1).
017740200423           03  WS-MFAACCASPA-WSW       PICTURE X(1).
017750200423           03  WS-MFAIVRCLP-WSW        PICTURE X(1).
017760210603           03  WS-MFATRNASP-WSW        PICTURE X(1).
017770200423           03  WS-ASSIGN-SEQ-NO9       PICTURE S9(3) COMP-3 VALUE 0.
017780200423106558     03  WS-MFAACCLNP-WSW        PICTURE X(1)  VALUE SPACES.
017790200423      /
017800200423       01 CURR-CONTROLS                  PIC X(1).
017810200423       01 WS-FILE-STATUS                 PIC X(2).
017820210603      *RFS186729 STARTS
017830210603         88 lncc_FileStatus30                      VALUE "30".
017840210603      *01 WS-FILE-STATUS-FILE-NAME       PIC X(15).
017850210603       01 WS-FILE-STATUS-FILE-NAME       PIC X(25).
017860210603         88 lncc_FileNameStatus30      VALUES "TRANS COMMISSION CHARGES"
017870210531                        "INT ADJ TRAN" "TRANS TGT DETAILS" "TRANSACTION"
017880210531                       "TRANS SPONSOR CHARGES" "FEDERAL/NON RES CHARGES"
017890210531               "PROVINCIAL TAX CHARGES" "ERF CHARGE" "US WH TAX CHARGES"
017900210531                "FEDERAL CLAWBACK" "PROVINCIAL CLAWBACK" "INSURANCE FEE"
017910210531                            "CDSC CHARGES" "DAF CHARGES" "REDEM FEE CHG"
017920210531                      "HH RED FEE CHG" "GST CHARGES" "ERF CHG" "PTY CHG"
017930210531                                     "PST CHARGES" "ACCOUNT INVESTMENT".
017940210603      *RFS186729 ENDS
017950200423      * RFS9530 - Begin
017960200423       01 WS-TEMP-STR                    PIC X(80).
017970200423      * RFS9530 - End
017980200423
017990200423      * RFS13471 - Begin
018000200423       01 WS-CONTR-REDEM-CODE-FEE-FLAG      PIC X(02)  VALUE SPACES.
018010200423          88 WS-CONTR-REDEM-CODE-RULE-FEE   VALUES "52" "53".
018020200423      * RFS13471 - End
018030200423
018040200423      * RFS5512 - Begin
018050200423       01 WS-TEMP-BAL              PIC S9(10)V9(03) COMP-3 VALUE ZERO.
018060200423      * RFS5512 - End
018070200423      * RFS21258 - Begin
018080200423      * Difference bwtween estimated and calculated Net
018090200423       01 WS-DIFF-EST-NET               PIC S9(09)V9(02) COMP-3.
018100200423       01 WS-CALC-NET-THRESHOLD         PIC S9(09)V9(02) COMP-3.
018110200423      * Constant to calculate threshold
018120200423      * Ex.: for the amount 1000 we will get 1000*0.0004 = 0.40$
018130200423
018140200423       01 WS-APPLY-NET-THRESHOLD-PROC   PIC S9(03)V9(07) COMP-3
018150200423                                        VALUE 0.0004.
018160200423       01 WS-MAX-EST-NET-THRESHOLD  PIC S9(03)V9(02) COMP-3 VALUE 0.99.
018170200423      * RFS21258 - End
018180200423      * RFS31294 - Begin
018190200423       01 lnc_minEstNetThreshold    PIC S9(03)V9(02) COMP-3 VALUE 0.02.
018200200423      * RFS31294 - End
01821020042334309  01 WS-100-PERCENT            PIC S9(03)V9(02) COMP-3 VALUE 100.
018220200423
018230200423      * RFS11194 - Begin
018240200423       01 WS-TEMP-AMT              PIC S9(13)V9(05) COMP-3 VALUE ZERO.
018250200423       01 SW01-SWITCHES.                                                RFS8371
018260200423          05 SW01-STS-FLAG                       PIC X(01).             RFS8371
018270200423             88 SW01-STS-OK                      VALUE " ".             RFS8371
018280200423             88 SW01-STS-FAIL                    VALUE "1" "2" "3"      RFS8371
018290200423                                                       "4" "5" "6"      RFS8371
018300200423                                                       "7" "8" "9".     RFS8371
018310200423             88 SW01-STS-OPEN                    VALUE "1".             RFS8371
018320200423             88 SW01-STS-START                   VALUE "2".             RFS8371
018330200423             88 SW01-STS-READ                    VALUE "3".             RFS8371
018340200423             88 SW01-STS-REWRITE                 VALUE "4".             RFS8371
018350200423             88 SW01-STS-WRITE                   VALUE "5".             RFS8371
018360200423             88 SW01-STS-DELETE                  VALUE "6".             RFS8371
018370200423             88 SW01-STS-END                     VALUE "7".             RFS8371
018380200423             88 SW01-STS-CLOSE                   VALUE "8".             RFS8371
018390200423             88 SW01-STS-RANGE                   VALUE "9".             RFS8371
018400200423
018410200423      * RFS11194 - End
018420200423
018430200423      *** THIS FLD STORES CODE FOR SWO/TRO EXCHANGE RATE SELECTION
018440200423       01 WS-EXCHANGE-RATE-TYPE1         PIC X.
018450200423      *** THIS FLD STORES CODE FOR SWI/TRI EXCHANGE RATE SELECTION
018460200423       01 WS-EXCHANGE-RATE-TYPE1A        PIC X.
018470200423      *** THIS FLD STORES CODE FOR TAX EXCHANGE RATE SELECTION
018480200423       01 WS-EXCHANGE-RATE-TYPE2         PIC X.
018490200423
018500200423       01 WS-ERROR-LINE                  PIC X(80).
018510200423       01 WS-RELATIONSHIP-CODE           PIC X(3).
018520200423       01 WS-REJECTION-CODE              PIC X(3).
018530200423       01 WS-REJECTION-CODE-OUT          PIC X(3).
018540200423       01 WS-INCLUDE-SCHEDULE            PIC X(5) VALUE "CDSCW".
018550200423       01 WS-EXCLUDE-SCHEDULE            PIC X(5) VALUE "CDSCA".
018560200423       01 WS-INTEREST-GENERATED          PIC X(1) VALUE "0".
018570200423       01 WS-CRC-0020-EXIT-POINT         PIC X(1) VALUE "N".
018580200423       01 WS-CAC-0005-EXIT-POINT         PIC X(1) VALUE "N".
018590200423       01 WS-USE-DEFAULT-RATE            PIC X(1) VALUE "N".
018600200423       01 WS-FINANCER-SCHEDULE-ERROR     PIC X(1).
018610200423       01 WS-ASSIGN-START-NO             PIC 9(5) VALUE 0.
018620200423      * RFS5512 - Begin
018630200423       01 WS-ORIG-SPLIT-OPTION-CODE      PIC X(1).
018640200423      * RFS5512 - End
018650200423       01 WS-NO-CALC-RULES               PIC X(1).
018660200423       01 WS-SAV-SPLIT-OPTION-CODE       PIC X(1).
018670200423       01 WS-INVALID-PIA-START           PIC X(1).
018680200423       01 WS-UNITS-TO-MOVE               PIC S9(9)V99999
018690200423                                                        VALUE 0.
018700200423       01 WS-LAST-PLACEMENT-DATE         PIC 9(8)       VALUE 0.
018710200423       01 WS-LAST-TRANS-NO               PIC 9(7)       VALUE 0.
018720200423       01 WS-TOTAL-UNIT-ALLOCATION       PIC S9(11)V999 VALUE 0.
018730200423       01 WS-UNITS-TO-ALLOCATE           PIC S9(11)V999 VALUE 0.
018740200423       01 WS-DSC-PRICE-TO-USE            PIC S9(5)V9(4) VALUE 0.
018750200423       01 WS-UNITS-TODAY                 PIC S9(9)V9(3) VALUE 0.
018760200423       01 WS-ACCRUAL-TODAY               PIC S9(9)V9(8) VALUE 0.
018770200423       01 WS-DAYS-IN-YEAR                PIC S9(3)      VALUE 0.
018780200423      *RFS 8470 BEGIN
018790200423       01 WS-UPPER-LIMIT-DATE            PIC S9(8)      VALUE 0.
018800200423       01 WS-UPPER-LIMIT-DATE-R REDEFINES WS-UPPER-LIMIT-DATE
018810200423                                         PIC X(8).
018820200423       01 WS-UPPER-LIMIT-DAT2            PIC S9(8)      VALUE 0.
018830200423       01 WS-UPPER-LIMIT-DAT2-R REDEFINES WS-UPPER-LIMIT-DAT2
018840200423                                         PIC X(8).
018850200423      *RFS 8470 END
018860200423      * RFS9530 - Begin
018870200423       01 WS-NEXT-DATE-SWI-FLAG          PIC X(01)      VALUE SPACE.
018880200423         88 WS-NEXT-DATE-SWI-NO              VALUE SPACE.
018890200423         88 WS-NEXT-DATE-SWI-YES             VALUE "Y".
018900200423      * RFS9530 - End
018910200423
018920200423      * RFS14898 - Begin
018930200423       01 WS-SWITCH-TO-SAME-ACC-INV-FLAG  PIC X(01)      VALUE SPACE.
018940200423         88 WS-SWITCH-TO-SAME-ACC-INV-NO     VALUE SPACE.
018950200423         88 WS-SWITCH-TO-SAME-ACC-INV-YES    VALUE "Y".
018960200423      * RFS14898 - End
018970200423      *RFS182952 START
018980200423       01 WS-SWITCH-TO-SAME-ACC-FLAG      PIC X(01)      VALUE SPACE.
018990200423         88 WS-SWITCH-TO-SAME-ACC-NO         VALUE SPACE.
019000200423         88 WS-SWITCH-TO-SAME-ACC-YES        VALUE "Y".
019010200423      *RFS182952 END
019020200423
019030200423      * RFS18779 - Begin
019040200423       01 WS-CURR-CONTR-REDEM-CODE-RULE   PIC X(02)      VALUE SPACE.
019050200423         88 WS-CURR-CONTR-REDEM-RULE-TAX  VALUE "26".
019060200423         88 WS-CURR-CONTR-REDEM-RULE-IFP  VALUE "27".
019070200423R24190   88 WS-CURR-CONTR-REDEM-RULE-47   VALUE "47".
019080200423R24190   88 WS-CURR-CONTR-REDEM-RULE-49   VALUE "49".
019090200423R42278   88 lnc_ContrRedemRuleLinkNote    VALUE "77".
019100200423      * RFS87136 - Begin
019110200423         88 WS-CURR-CONTR-REDEM-RULE-GPG  VALUE "60".
019120200423      * RFS87136 - End
019130200423      * RFS40845 - Begin
019140200423
019150200423      *    RFS71433 -Begin
019160200423      *  88 lncc_currContrRedemRuleGrant  VALUES "5" "15" "16".
019170200423      *    RFS71433.2 -Begin
019180200423      *  88 lncc_currContrRedemRuleGrant  VALUES "5" "15" "16"
019190200423      *                                          "25" "26" "88".
019200200423         88 lncc_currContrRedemRuleGrant  VALUES "5" "15" "16"
019210200423143608*                                          "25" "26".
019220200423143608                                           "25" "26" "32"
019230200423143608                                           "37".
019240200423      *    RFS71433.2 -End
019250200423      *    RFS71433 -End
019260200423
019270200423      * RFS40845 - End
019280200423      * RFS76541 - Begin: added RDSP Grant Bond Contr Redem rule
019290200423         88 lncc_currRdsp_Grant_Bond      VALUE "2" "3".
019300200423      * RFS76541 - End
019310200423      * RFS18779 - End
01932020042344202 *  88 WS-CURR-CONTR-REDEM-RULE-ROLL VALUE "28".                   R73715
019330200423R73715   88 WS-CURR-CONTR-REDEM-RULE-ROLL VALUE "28" "88".
019340200423      *    RFS84977 -Begin
01935020042334309 *  88 WS-CURR-CONTR-REDEM-RULE-EAP  VALUE "6" "7".
019360200423         88 WS-CURR-CONTR-REDEM-RULE-EAP  VALUE "6", "7", "17", "18"
019370200423143609*                                         "28", "30".
019380200423143609                                          "28", "30", "33", "38".
019390200423      *  RFS84977.17 - Begins - Condition for Rule 30
019400200423         88 WS-CURR-CONTR-REDEM-RULE-30   VALUE "30".
019410200423      *  RFS84977.17 - Ends
019420200423      *    RFS84977 -End
01943020042368035    88 WS-CURR-CONTR-REDEM-RULE-DAP  VALUE  "11" "12".
019440200423126482   88 WS-CURR-CONTR-REDEM-RULE-LDAP VALUE  "12".
01945020042368035    88 WS-CURR-CONTR-REDEM-RULE-AHA  VALUE "13".
019460200423      * RFS17180 - Begin
019470200423       01 WS-CURR-PHANTOM                 PIC X(05)      VALUE SPACE.
019480200423       01 WS-CURR-ACTIVE-INVESTMENT       PIC X(05)      VALUE SPACE.
019490200423         88 WS-CURR-ACTIVE-INV-NOT-EXISTS                VALUE SPACE.
019500200423       01 WS-CURR-ACCOUNT-INV-STATUS      PIC X(03)      VALUE SPACE.
019510200423         88 WS-CURR-ACCOUNT-INV-STATUS-ACT VALUE "ACT".
019520200423         88 WS-CURR-ACCOUNT-INV-STATUS-PND VALUE "PND".
019530200423
019540200423       01 WS-ALL-UNITS-TO-OTHER-PH-FLAG   PIC X(01)      VALUE SPACE.
019550200423         88 WS-ALL-UNITS-TO-OTHER-PH-NO      VALUE SPACE.
019560200423         88 WS-ALL-UNITS-TO-OTHER-PH-YES     VALUE "Y".
019570200423      * RFS17180 - End
019580200423
019590200423      * RFS14975 - Begin
019600200423       01 WS-FREE-DOLLARS-RND            PIC S9(10)V9(02) VALUE 0.
019610200423      * RFS14975 - End
019620200423
019630200423      * RFS12308 - Begin
019640200423       01 INVESTMENT-TYPE-RULE-SW-FLAGS.
019650200423          03 INVESTMENT-TYPE-RULE-SW-OUT  PIC X(1) VALUE SPACE.
019660200423             88 GIC-INVESTMENT-SW-OUT     VALUES "2".
019670200423             88 DII-INVESTMENT-SW-OUT     VALUES "7".
019680200423             88 GIC-DII-INVESTMENT-SW-OUT VALUES "2" "7".
019690200423      * RFS14710 - Begin
019700200423             88 AAH-INVESTMENT-SW-OUT     VALUES "4".
019710200423      * RFS17180 - Begin
019720200423             88 AAP-INVESTMENT-SW-OUT     VALUES "3".
019730200423             88 AAP-AAH-INVESTMENT-SW-OUT VALUES "3" "4".
019740200423      * RFS17180 - End
019750200423      * RFS14710 - End
019760200423          03 INVESTMENT-TYPE-RULE-SW-IN   PIC X(1) VALUE SPACE.
019770200423             88 GIC-INVESTMENT-SW-IN      VALUES "2".
019780200423             88 DII-INVESTMENT-SW-IN      VALUES "7".
019790200423             88 GIC-DII-INVESTMENT-SW-IN  VALUES "2" "7".
019800200423      * RFS14710 - Begin
019810200423             88 AAH-INVESTMENT-SW-IN      VALUES "4".
019820200423      * RFS17180 - Begin
019830200423             88 AAP-INVESTMENT-SW-IN      VALUES "3".
019840200423             88 AAP-AAH-INVESTMENT-SW-IN  VALUES "3" "4".
019850200423      * RFS17180 - End
019860200423      * RFS14710 - End
019870200423      * RFS12308 - End
019880200423
019890200423      *RFS 8058
019900200423       01 WS-TRANS-CATAGORY-HOLD         PIC  X(3).
019910200423       01 WS-TRANS-STATUS-CATAGORY-HOLD  PIC  X(3).
019920200423       01 WS-CDSC-MARKET-VALUE-ACC       PIC  S9(13)V99 COMP-3 VALUE 0.
019930200423       01 WS-CDSC-ORIG-VALUE-ACC         PIC  S9(13)V99 COMP-3 VALUE 0.
019940200423       01 WS-CDSC-ORIG-VALUE-ACC-HLD     PIC  S9(13)V99 COMP-3 VALUE 0.
019950200423       01 WS-UNITS-CONVERTED             PIC  X.
019960200423       01 WS-ACCOUNT-LEV-FREE-UNITS      PIC  S9(13)V999 COMP-3 VALUE 0.
019970210216      * RFS185174.2 - Start: new variable to keep original free
019980210216       01 WS-ACCOUNT-LEV-FREE-UNITS-ORIG PIC  S9(13)V999 COMP-3 VALUE 0.
019990210216      * RFS185174.2 - End
020000200423      *RFS 11318 BEGIN
020010200423       01 WS-AL-FREE-DOLLARS             PIC  S9(13)V999 COMP-3 VALUE 0.
020020200423      *RFS 11318 END
020030200423118527 01 li-Txn-Free-Dollars            PIC  S9(13)V999 COMP-3 VALUE 0.
020040200423124497 01 lc-WriteGICRedemption          PIC  X(01) VALUE SPACES.
020050200423124497 01 li-Avail-AccFreeDlr            PIC  S9(13)V999 COMP-3 VALUE 0.
020060200423       01 ACCOUNT-LEV1.
020070200423          05 WS-ACCT-LEV-UNITS           PIC  S9(13)V999 COMP-3 VALUE 0.
020080200423          05 WS-ACCT-LEV-INVESTMENT      PIC  X(5).
020090200423          05 WS-ACCT-LEV-PRICE           PIC  S9(5)V9(4) COMP-3
020100200423                                                               VALUE 0.
020110200423       01 ACCOUNT-LEV2.
020120200423          05 WS-ACCT-LEV-UNITS2          PIC  S9(13)V999 COMP-3 VALUE 0.
020130200423      *RFS 8058 END
020140200423
020150200423      *RFS 13405 BEGIN
020160200423       01 ACCOUNT-LEV4.
020170200423          05 WS-ACCT-LEV-UNITS4          PIC  S9(13)V999 COMP-3 VALUE 0.
020180200423          05 WS-ACCT-LEV-INVESTMENT4     PIC  X(5).
020190200423          05 WS-ACCT-LEV-PRICE4          PIC  S9(5)V9(4) COMP-3 VALUE 0.
020200200423          05 WS-MARKET-VAL-ACCUM         PIC  S9(1)V999  COMP-3 VALUE 0.
020210200423      *RFS 13405 END
020220200423
020230200423      * RFS10040 - Begin
020240200423      * RFS11025 - Begin
020250200423      *01 WS-COMM-RATE              PIC S9(5)V999 COMP-3 VALUE 0.
020260200423       01 WS-COMM-RATE              PIC S9(5)V9(08) COMP-3 VALUE 0.
020270200423      * RFS11025 - End
020280200423      * RFS10040 - End
020290200423
020300200423       01 WS-NOTIONAL-DISTRIB            PIC X          VALUE "S".
020310200423       01 WS-PASS-CDSC-CALCULATOR-HOLD   PIC X          VALUE " ".
020320200423       01 WS-PASS-SWITCH-EDIT            PIC X          VALUE "0".
020330200423       01 WS-INSUFFIC-BUY-PROCEEDS       PIC X          VALUE "N".
020340200423       01 WS-SCREEN-EDITS-ALLOWED        PIC X(1) VALUE "N".
020350200423       01 WS-SCREEN-CODE                 PIC X(8) VALUE "UPDACCFI".
020360200423       01 WS-EDIT-CODE                   PIC X(6) VALUE "ACCSUM".
020370200423       01 WS-LEVEL-CODE                  PIC X(1) VALUE "F".
020380200423       01 WS-EDIT-SEG-CONTR-PROV         PIC X(1).
020390200423162289 01 WS-EDIT-T4R2TR                 PIC X(1).
02040020042334309  01 WS-ACC-BEN-PROV                PIC X(3).
02041020042334309  01 WS-ACC-BEN-CNTRY               PIC X(3).
020420200423      *RFS18568 Begin
020430200423       01 WS-EDIT-CSH-DST-PAY-MTHD       PIC X(1).
020440200423      *RFS18568 End
020450200423      * RFS32873 - Begin
020460200423       01 lc_editCLWBCKflag              PIC X(01).
020470200423         88 lncc_editCLWBCK                VALUE "Y".
020480200423      * RFS32873 - End
020490200423      *RFS1016152-Starts
020500200423       01 lc_TRNPST                      PIC X(8) VALUE "TRNPST".
020510200423       01 lc_SKPREJ                      PIC X(6) VALUE "SKPREJ".
020520200423      *RFS1016152-Ends
020530200423      *RFS23020 Begin
020540200423       01 WS-EDIT-AAH-AADSOP             PIC X(1).
020550200423      *RFS23020 End
020560200423       01 WS-LBR-UNITS-TO-REDEEM         PIC S9(9)V9(3) VALUE 0.
020570200423       01 WS-LSIF-CHK-UNITS              PIC S9(9)V9(3) VALUE 0.
020580200423       01 WS-LSIF-SELL-SEQ               PIC 9(8)       VALUE 0.
020590200423       01 WS-LSIF-SWI-SEQ                PIC 9(8)       VALUE 0.
020600200423       01 WS-LSIF-DAYS                   PIC S9(8)      VALUE 0.
020610200423       01 WS-LSIF-YEARS                  PIC S9(8)      VALUE 0.
020620200423       01 WS-LSIF-IVR-YEARS              PIC S9(8)      VALUE 0.
020630200423      * RFS31860 - Begin: Unit price for SWO/SWI
020640200423       01 WS-SWO-UNIT-PRICE              PIC S9(09)V9(04) COMP-3.
020650200423       01 WS-SWI-UNIT-PRICE              PIC S9(09)V9(04) COMP-3.
020660200423      * RFS31860 - End
020670200423       01 WS-LSIF-CLAW-PRICE             PIC S9(5)V9999 VALUE 0.
020680200423      *RFS18191 Begin
020690200423       01 WS-LSIF-CLAW-PRICE-F           PIC S9(5)V9999 VALUE 0.
020700200423       01 WS-LSIF-CLAW-PRICE-P           PIC S9(5)V9999 VALUE 0.
020710200423       01 WS-LSIF-CLAW-PRICE-FE          PIC S9(5)V9999 VALUE 0.
020720200423       01 WS-LSIF-CLAW-PRICE-PE          PIC S9(5)V9999 VALUE 0.
020730200423      *RFS18191 End
020740200423       01 WS-PROVINCIAL-LSIF-RATE        PIC S9(3)V99   VALUE 0.
020750200423       01 WS-FEDERAL-LSIF-RATE           PIC S9(3)V99   VALUE 0.
020760200423      *RFS18191 Begin
020770200423       01 WS-PROVINCIAL-LSIF-RATE-EXTRA  PIC S9(3)V99   VALUE 0.
020780200423       01 WS-FEDERAL-LSIF-RATE-EXTRA     PIC S9(3)V99   VALUE 0.
020790200423      *RFS18191 End
020800200423       01 WS-CALC-FILE-WRITE             PIC X.
020810200423       01 WS-POPULATE-CALC-FILE          PIC X.
020820200423       01 WS-LSIF-FROM-DATE              PIC S9(8)      VALUE 0.
020830200423       01 WS-LSIF-FROM-DATE-R REDEFINES WS-LSIF-FROM-DATE.
020840200423          05 WS-LSIF-F-YYYY              PIC S9(4).
020850200423          05 WS-LSIF-F-MMDD              PIC S9(4).
020860200423
020870200423       01 WS-LSIF-TO-DATE                PIC S9(8)      VALUE 0.
020880200423       01 WS-LSIF-TO-DATE-R REDEFINES WS-LSIF-TO-DATE.
020890200423          05 WS-LSIF-T-YYYY              PIC S9(4).
020900200423          05 WS-LSIF-T-MMDD              PIC S9(4).
020910200423
020920200423       01 WS-LSIF-WAIVE-CLAWBACK-FED     PIC X          VALUE SPACES.
020930200423       01 WS-LSIF-WAIVE-CLAWBACK-PROV    PIC X          VALUE SPACES.
020940200423      *RFS 16760 Begin
020950200423       01 WS-LSIF-WAIVE-CLAWBACK-YN-F    PIC X          VALUE SPACES.
020960200423       01 WS-LSIF-WAIVE-CLAWBACK-YN-P    PIC X          VALUE SPACES.
020970200423      *RFS 16760 Begin
020980200423       01 WS-TRANS-WAIVE-EXIST           PIC X          VALUE SPACES.
020990200423       01 WS-FEDERAL-PROVINCIAL-MODE     PIC X          VALUE SPACES.
021000200423       01 WS-EXCLUDE-ALL.
021010200423          05 WS-EXCLUDE-D                PIC X.
021020200423          05 WS-EXCLUDE-E                PIC X.
021030200423          05 WS-EXCLUDE-G                PIC X.
021040200423          05 WS-EXCLUDE-H                PIC X.
021050200423          05 WS-EXCLUDE-K                PIC X.
021060200423       01 WS-FEDERAL-FAIL                PIC X          VALUE SPACES.
021070200423       01 WS-PROVINCIAL-FAIL             PIC X          VALUE SPACES.
021080200423       01 WS-UPDATE-PRIMARY              PIC X(1)       VALUE "N".
021090200423      *RFS 7152 start
021100200423       01 WS-IREDRT-EMPTY                PIC X          VALUE "Y".
021110200423      *RFS 7152 end
021120200423
021130200423      *RFS 8066 BEGIN
021140200423       01 WS-FROM-ACCOUNT-TYPE.
021150200423          05 WS-FROM-ACCOUNT-TP1         PIC X(5) VALUE SPACES.
021160200423          05 WS-FROM-ACCOUNT-TP2         PIC X(5) VALUE SPACES.
021170200423       01 WS-TO-ACCOUNT-TYPE.
021180200423          05 WS-TO-ACCOUNT-TP1           PIC X(5) VALUE SPACES.
021190200423          05 WS-TO-ACCOUNT-TP2           PIC X(5) VALUE SPACES.
021200200423      *RFS 8066 END
021210200423
021220200423       01 WS-NET-OUT-AMOUNTS.
021230200423          03 WS-OUT-NET                  PIC S9(11)V99 VALUE 0.
021240200423          03 WS-OUT-UNITS                PIC S9(11)V999 VALUE 0.
021250200423          03 WS-OUT-NET-2                PIC S9(11)V99 VALUE 0.
021260200423
021270200423       01 WS-CURRENCIES.
021280200423          03 WS-OUT-CURRENCY             PIC X(3).
021290200423          03 WS-OUT-EXCHANGE-RATE        PIC S9(2)V9(7) VALUE 0.
021300200423          03 WS-OUT-PRODUCT-TYPE         PIC X(3).
021310200423          03 WS-IN-CURRENCY              PIC X(3).
021320200423          03 WS-IN-EXCHANGE-RATE         PIC S9(2)V9(7) VALUE 0.
021330200423          03 WS-IN-TRADE-DATE            PIC  9(8)      VALUE 0.
021340200423          03 WS-IN-PRODUCT-TYPE          PIC X(3).
021350200423
021360200423       01 WRITE-SWITCHES.
021370200423          03 WRITE-TRANS-COMMISSION      PIC X(1).
021380200423          03 WRITE-TRANS-CDSC-PURCHASE   PIC X(1).
021390200423          03 WRITE-TRANS                 PIC X(1).
021400200423          03 WRITE-TRANS-DLY-SEQ         PIC X(1).
021410200423          03 WRITE-ACCOUNT-INVESTMENT    PIC X(1).
021420200423          03 WRITE-BATCH-HEADER          PIC X(1).
021430200423          03 WRITE-ACCT-INV-DIST-ACCUM   PIC X(1).
021440200423          03 WRITE-ACCOUNT-INV-ACCRUALS  PIC X(1).
021450200423          03 WRITE-TRANS-INTEREST-DETAILS PIC X(1).
021460200423          03 WRITE-TRANS-TARGET          PIC X(1).
021470200423          03 WRITE-TRANS-WO-LOCATOR      PIC X(1).
021480200423          03 WRITE-SPONSOR               PIC X(1).
021490200423          03 WRITE-COMMISSION            PIC X(1).
021500200423          03 WRITE-FEDTAX                PIC X(1).
021510200423          03 WRITE-PRVTAX                PIC X(1).
021520200423          03 WRITE-NONTAX                PIC X(1).
021530200423R29550    03 WRITE-USWT                  PIC X(1).
021540200423          03 WRITE-FEDCLW                PIC X(1).
021550200423          03 WRITE-PRVCLW                PIC X(1).
021560200423      * RFS 14380 BEGIN
021570200423          03 WRITE-ERF                   PIC X(1).
021580200423      * RFS 14380 END
021590200423139288    03 WRITE-INSURANCE-FEE         PIC X(1).
021600200423          03 WRITE-DAF                   PIC X(1).
021610200423          03 WRITE-CDSC                  PIC X(1).
021620200423          03 WRITE-PROCESSED-COUNT       PIC X(1).
021630200423          03 WRITE-ACCOUNT-ASSIGNMENT    PIC X(1).
021640200423          03 WRITE-REDEMPTION-FEE        PIC X(1).
021650200423          03 WRITE-HRDF-FEE              PIC X(1).
021660200423          03 WRITE-ALLOCATION-HEADER     PIC X(1).
021670200423          03 WRITE-EXCHANGE-RATE         PIC X(1).
021680200423          03 WRITE-TRANS-REDEM-DETAILS   PIC X(1).
021690200423      * RFS 13306 BEGIN
021700200423          03 WRITE-TRANS-CONTRACT        PIC X(2).
021710200423          03 WRITE-ACCOUNT-CONTRACT-INV  PIC X(2).
021720200423          03 WRITE-ACCOUNT-CONTRACT      PIC X(2).
021730200423          03 WRITE-TRANS-CONTRACT-TARGET PIC X(2).
021740200423          03 WRITE-ACCOUNT-CONT-ANNT     PIC X(2).
021750200423      * RFS 13306 END
021760200423          03 WRITE-GST                   PIC X(1).
021770200423          03 WRITE-PST                   PIC X(1).
021780200423          03 WRITE-ACCT-INVEST-BASIS     PIC X(1).
021790200423          03 WRITE-TXN-REDFEE-CALC-DT    PIC X(1).
021800200423          03 WRITE-TRANS-RED-DEP-XFR     PIC X(1).
021810200423          03 WRITE-GIC-CERT-DETAILS      PIC X(1).
021820200423          03 WRITE-GIC-TRANS-RELATIONSHIP
021830200423                                         PIC X(1).
021840200423          03 WRITE-REPMT-RED-FEE         PIC X(1).
021850200423          03 WRITE-RED-PENALTY           PIC X(1).
021860200423          03 WRITE-GIC-RED-DETAILS       PIC X(1).
021870200423          03 WRITE-ACCOUNT-FIN-TOTALS    PIC X(1).
021880200423          03 WRITE-ACCOUNT-INV-REG       PIC X(1).
021890200423      *RFS 8058 BEGIN
021900200423          03 WRITE-TRANS-ACC-LV-D        PIC X(1).
021910200423          03 WRITE-ACC-LV-FR             PIC X(1).
021920200423          03 WRITE-TRANS-CDSC-PUR-SUB    PIC X(1).
021930200423      *RFS 8058 END
021940200423      *RFS 8066 BEGIN
021950200423          03 WRITE-ACC-QUAL              PIC X(1).
021960200423      *RFS 8066 END
021970200423      *RFS 18568 BEGIN
021980200423          03 WRITE-TRANS-PAY-TO-CHEQUE   PIC X(1).
021990200423          03 WRITE-TRANS-PAY-TO-BANK-2   PIC X(1).
022000200423      *RFS 18568 END
022010200423R24191    03 WRITE-TRANS-INCL-RATE       PIC X(1).
022020200423R24190    03 WRITE-TRANS-UNIT-COST       PIC X(1).
02203020042334309     03 WRITE-TRANS-DIST-CNTRY-CODE PIC X(1).
022031210928      *RFS186588 - Starts
022032210928          03 lc_WriteMFATRNSEQP          PIC X(1).
022033210928            88  lc_WriteMFATRNSEQPYes    VALUE "Y".
022034210928      *RFS186588 - Ends
022040200423      * RFS32873 - Begin
022050200423          03 lc_writeRewBonusCommFlag     PIC X(2).
022060200423            88 lncc_writeRewBonusComm     VALUE "WR".
022070200423      * RFS32873 - End
022080200423      *RFS1016152-Starts
022090200423          03 lncc_skipRejectedTrades      PIC X(1)         VALUE "N".
022100200423            88  lncc_NoBySKPREJ                            VALUE "N".
022110200423            88  lncc_YesBySKPREJ                           VALUE "Y".
022120200423      *RFS1016152-Ends
022130200423
022140200423      * RFS 16941 - Begin
022150200423           03 WS-BUY-BW-ENV-FLAG         PIC  X(01)        VALUE "N".
022160200423              88 WS-BUY-BW-ENV                             VALUE "Y".
022170200423           03 WS-SEL-BW-ENV-FLAG         PIC  X(01)        VALUE "N".
022180200423              88 WS-SEL-BW-ENV                             VALUE "Y".
022190200423      * RFS 16941 - End
022200200423      *****
022210200423      *****    The following switches are referenced by the CPDSC copy
022220200423      *****    book routine and can be deleted when CPDSC is changed.
022230200423      *****
022240200423           03  WRITE-TRANS-CDSC-CLOCK  PICTURE X(1).
022250200423169270     03  WRITE-ACCOUNT-MISC-DETAILS  PIC X(1).
022260200423      *RFS17685 Begin
022270200423       01 WRITE-INTEREST-ADJ-TRANS    PIC X(1) VALUE " ".
022280200423       01 WRITE-TRANS-INTEREST-ADJ-DTLS PIC X(1) VALUE " ".
022290200423      *RFS17685 End
022300210405      *1110228-STARTS
022310210405       01 lncc_WithHierFilNme         PIC X(10) VALUE "MFAWDHIERP".
022320210405       01 li_WithHierRecCount         PIC S9(10) COMP-3 VALUE 0.
022330210405      *1110228-ENDS
022340200423
022350200423       01 SYSTEMATIC-SWITCHES-INIT.
022360200423          03 WS-COMMISSION-DEDUCT        PIC X(1) VALUE "N".
022370200423          03 WS-COMMISSION-CDSC          PIC X(1) VALUE "N".
022380200423          03 WS-ADD-FREE-SW              PIC X(1) VALUE "N".
022390200423          03 WS-ADD-UNITS-SW             PIC X(1) VALUE "N".
022400200423          03 WS-END-OF-CDSC-PURCHASES    PIC X(1) VALUE "N".
022410200423          03 WS-TARGET-NOT-FOUND         PIC X(1) VALUE "N".
022420200423          03 WS-BYPASS-CDSC-WRITE        PIC X(1) VALUE "N".
022430200423          03 WS-BYPASS-FREE-UNIT-READ    PIC X(1) VALUE "N".
022440200423          03 WS-UNITS-MATURE             PIC X(1) VALUE "N".
022450200423          03 WS-TAX-CDSC-APPLICABLE      PIC X(1) VALUE "N".
022460200423          03 WS-TAX-LBS-APPLICABLE       PIC X(1) VALUE "N".
022470200423          03 WS-TAX-HH-REDFEE-APPLICABLE PIC X(1) VALUE "N".
022480200423          03 WS-TAX-REPMT-RFE-APPLICABLE PIC X(1) VALUE "N".
022490200423          03 WS-TAX-REDE-PLTY-APPLICABLE PIC X(1) VALUE "N".
022500200423          03 WS-TAX-OFF-SW               PIC X(1) VALUE "N".
022510200423          03 WS-ACCRUAL-RECORD-FOUND     PIC X(1) VALUE "N".
022520200423          03 WS-ADD-NET-FOR-TAX          PIC X(1) VALUE "N".
022530200423          03 WS-TRANS-ADDL-TAX-FOUND     PIC X(1) VALUE "N".
022540200423          03 WS-FROM-CLOCK               PIC X(1) VALUE "N".
022550200423          03 WS-TO-CLOCK                 PIC X(1) VALUE "N".
022560200423          03 WS-FIRST-CLOCK-REC-FOUND    PIC X(1) VALUE "N".
022570200423      * RFS9932 - Start
022580200423          03 WS-FUTURE-AWD               PIC X(1) VALUE "N".
022590200423      * RFS9932 - End
022600200423      * RFS 16152 - Start
022610200423          03 WS-DII-AWD                  PIC X(1) VALUE "N".
022620200423      * RFS 16152 - End
022630200423
022640200423      * RFS23020 - Begin
022650200423          03 WS-ASSET-ALLOC-HDR-FND       PIC X(1) VALUE "N".
022660200423          03 WS-CAPITAL-GAIN-DISTR-OPTION PIC X(1) VALUE "R".
022670200423          03 WS-INCOME-DISTR-OPTION       PIC X(1) VALUE "R".
022680200423          03 WS-PAYMENT-TYPE-CODE         PIC X(1) VALUE "N".
022690200423      * RFS23020 - End
022700200423
022710200423      * RFS12308 - Start
022720200423          03 WS-GIC-DII-ASSIGNED          PIC X(1) VALUE "N".
022730200423          03 WS-ACCOUNT-ASSIGNED          PIC X(1) VALUE "N".
022740200423      * RFS12308 - End
022750200423
022760200423      * RFS10608 - Begin
022770200423           03 WS-PURCHASE-DETAIL         PIC  X(01)        VALUE "N".   RFS10608
022780200423      * RFS10608 - End
022790200423      *****
022800200423      *****    The following switches are referenced by the CPDSC copy
022810200423      *****    book routine and can be deleted when CPDSC is changed.
022820200423      *****
022830200423           03  WS-FIRST-PURCHASE-REC-FOUND
022840200423                                       PICTURE X(1)        VALUE "N".
022850200423
022860200423      * RFS15841 - Begin
022870200423           03 WS-APPLY-NR-INTEREST-FLAG PIC X(01)          VALUE "N".
022880200423             88 WS-APPLY-NR-INTEREST                       VALUE "Y".
022890200423      * RFS15841 - End
022900200423      * RFS 17117 begin
022910200423          03 WS-TRADE-ON-HOLDING         PIC X(1) VALUE "N".
022920200423      * RFS 17117 end
022930200423
022940200423      * RFS 14710 begin
022950200423          03 WS-TRADE-ON-HOLDING-AASWITCH PIC X(1) VALUE "N".
022960200423      * RFS 14710 end
022970200423
022980200423      * RFS 17180 Begin
022990200423          03 WS-SET-TO-ACTIVE             PIC X(1) VALUE "N".
023000200423          03 WS-LAST-AA-REC-TO-PROCESS    PIC X(1) VALUE "N".
023010200423      * RFS 17180 End
023020200423      * RFS 23802 Begin
023030200423          03 WS-DEL-ACTIVE-AAP            PIC X(1) VALUE "N".
023040200423      * RFS 23802 End
023050200423
023060200423      * RFS16505 - Begin
023070200423           03 WS-CHARGEABLE-FIRST       PIC X(01)          VALUE "N".
023080200423      * RFS16505 - End
023090200423
023100200423      * RFS15626 - Begin
023110200423      * If at least one Grace Period retrieved then the variable will
023120200423      *  be "Y".
023130200423           03 WS-GRACE-PERIOD            PIC X(01) VALUE "N".
023140200423      * RFS15626 - End
023150200423
023160200423      * RFS21253 - Begin
023170200423           03 WS-LSIF-DEEMED-DISTR      PIC X(01)          VALUE "N".
023180200423      * RFS21253 - End
023190200423      * RFS24228 - Begin
023200200423           03 WS-CDSC-CALCULATOR-INTERNAL  PIC X(01)       VALUE SPACES.
023210200423             88 WS-CDSC-CALCULATOR-INTER-INIT              VALUE SPACES.
023220200423             88 WS-CDSC-CALCULATOR-INTERNAL-C              VALUE "C".
023230200423      * RFS24228 - End
023240200423
023250200423       01 SYSTEMATIC-SWITCHES-UNINIT.
023260200423          03 WS-NO-READ                  PIC X(1) VALUE "N".
023270200423
023280200423       01 NUMERIC-WORK-FIELDS.
023290200423      * RFS50058 - Begin
023300200423           05 ln_logUnitAmt              PIC S9(10)V9(03) COMP-3.
023310200423      * RFS50058 - End
023320200423140721    03 ln_freeDollarsUsed      PIC S9(11)V9(2) COMP-3 VALUE 0.
023330200423          03 WS-BATCH-AMOUNT             PIC S9(11)V99  VALUE 0.
023340200423          03 WS-BATCH-UNITS              PIC S9(10)V999 VALUE 0.
023350200423          03 WS-COMMISSION-AMOUNT        PIC S9(11)V99  VALUE 0.
023360200423          03 WS-TAXABLE-AMOUNT           PIC S9(11)V99  VALUE 0.
023370200423183140    03 WS-LINKTAX-AMOUNT           PIC S9(11)V99  VALUE 0.
023380200423183140    03 WS-EST-NR-TAX               PIC S9(11)V99  VALUE 0.
023390200423136069    03 Li_RDSPHoldTaxable          PIC S9(11)V99  VALUE 0.
023400200423136069    03 Li_RDSPFedTax               PIC S9(11)V99  VALUE 0.
023410200423136069    03 Li_RDSPProvTax              PIC S9(11)V99  VALUE 0.
023420200423          03 WS-WORK-TAX-RATE            PIC S9(3)V9999 VALUE 0.
023430200423          03 WS-FEDERAL-TAX-RATE         PIC S9(3)V99   VALUE 0.
023440200423          03 WS-PROVINCIAL-TAX-RATE      PIC S9(3)V99   VALUE 0.
023450200423          03 WS-FEDERAL-TAX-RATE-2       PIC S9(3)V99   VALUE 0.
023460200423          03 WS-PROVINCIAL-TAX-RATE-2    PIC S9(3)V99   VALUE 0.
023470200423          03 WS-FEDERAL-TAX-AMOUNT       PIC S9(11)V99  VALUE 0.
023480200423R45991    03 WS-FEDERAL-TAX-AMOUNT-2     PIC S9(11)V99  VALUE 0.
023490200423R24192    03 WS-NRR-FEDERAL-TAX-AMT      PIC S9(11)V99  VALUE 0.
023500200423          03 WS-PROVINCIAL-TAX-AMOUNT    PIC S9(11)V99  VALUE 0.
023510200423R45991    03 WS-PROVINCIAL-TAX-AMOUNT-2  PIC S9(11)V99  VALUE 0.
023520200423R29550    03 WS-US-WH-TAX-AMOUNT         PIC S9(11)V99  VALUE 0.
023530200423          03 WS-GST-AMOUNT               PIC S9(11)V99  VALUE 0.
023540200423          03 WS-PST-AMOUNT               PIC S9(11)V99  VALUE 0.
023550200423          03 WS-GST-AMOUNT2              PIC S9(11)V99  VALUE 0.
023560200423          03 WS-PST-AMOUNT2              PIC S9(11)V99  VALUE 0.
023570200423          03 WS-GST-PST-TAX-BASIS        PIC S9(11)V99  VALUE 0.
023580200423          03 WS-REDEMPTION-FEE           PIC S9(11)V99  VALUE 0.
023590200423      *RFS 7152 start
023600200423          03 WS-INVESTMENT-REDEM-RATE    PIC S9(4)v99   VALUE 0.
023610200423      *RFS 7152 end
023620200423          03 WS-NET-TAX-AMOUNT           PIC S9(11)V99  VALUE 0.
023630200423          03 WS-DAF-AMOUNT               PIC S9(11)V99  VALUE 0.
023640200423          03 WS-CDSC-AMOUNT              PIC S9(11)V99  VALUE 0.
023650200423          03 WS-CDSC-AMOUNT-2            PIC S9(11)V99  VALUE 0.
023660200423          03 WS-FEDERAL-CLAWBACK         PIC S9(11)V99  VALUE 0.
023670200423          03 WS-FEDERAL-CLAWBACK-2       PIC S9(11)V99  VALUE 0.
023680200423          03 WS-PROVINCIAL-CLAWBACK      PIC S9(11)V99  VALUE 0.
023690200423          03 WS-PROVINCIAL-CLAWBACK-2    PIC S9(11)V99  VALUE 0.
023700200423          03 WS-TOTAL-CLAWBACK           PIC S9(11)V99  VALUE 0.
023710200423          03 WS-LAST-TOTAL-CLAWBACK      PIC S9(11)V99  VALUE 0.
023720200423          03 WS-LSIF-CLAW-DIFF           PIC S9(11)V99  VALUE 0.
023730200423      * RFS14380 - Begin
023740200423          03 WS-ERF-CHARGE               PIC S9(11)V99  VALUE 0.
023750200423      * RFS14380 - End
023760200423          03 WS-TAX-BASE-AMOUNT          PIC S9(11)V99  VALUE 0.
023770200423          03 WS-PREVIOUS-CDSC-AMOUNT     PIC S9(11)V99  VALUE 0.
023780200423          03 WS-TAX-INCURRED             PIC S9(11)V99  VALUE 0.
023790200423          03 WS-ASSIGNED-UNITS           PIC S9(10)V999 VALUE 0.
023800200423128793    03 WS-ASSIGNED-UNITSCDIC       PIC S9(10)V999 VALUE 0.
023810200423128793    03 WS-ASSIGNED-UNITSNCDIC      PIC S9(10)V999 VALUE 0.
023820200423128793    03 WS-ASSIGNED-UNITSDIIC       PIC S9(10)V999 VALUE 0.
023830200423      * RFS16693 - Begin
023840200423          03 WS-CERT-UNITS               PIC S9(10)V999 VALUE 0.
023850200423      * RFS16693 - Begin
023860200423          03 WS-UNITS-REFRESH            PIC S9(10)V999 VALUE 0.
023870200423          03 WS-UNITS-SEG-ALLOCATED      PIC S9(10)V999 VALUE 0.
023880200423          03 WS-AVAILABLE-UNITS          PIC S9(10)V999 VALUE 0.
023890200423          03 WS-AVAILABLE-UNITS2         PIC S9(10)V999 VALUE 0.
02390020042392465     03 WS-AVAILABLE-UNITS3         PIC S9(10)V999 VALUE 0.
023910200423      * RFS44611 - Begin: Available units (not contracted)
023920200423          03 ln_AvailUnitsNotContr       PIC S9(10)V999 VALUE 0.
023930200423      * RFS44611 - Begin
023940200423          03 WS-FREE-UNIT-HOLD           PIC S9(10)V999 VALUE 0.
023950200423          03 WS-CHRG-UNIT-HOLD           PIC S9(10)V999 VALUE 0.
023960200423          03 WS-FREE-TO-USE              PIC S9(10)V999 VALUE 0.
023970200423          03 WS-OLD-CDSC-UNITS           PIC S9(10)V999 VALUE 0.
023980200423          03 WS-CURRENT-VALUE            PIC S9(11)V99  VALUE 0.
023990200423          03 WS-NET-AMOUNT               PIC S9(11)V99  VALUE 0.
024000200423          03 WS-VARIANCE-AMOUNT          PIC S9(11)V99  VALUE 0.
024010200423          03 WS-PERCENT-CHARGE           PIC S9V99999   VALUE 0.
024020200423          03 WS-LIABILITY-UNITS-APPLICABLE
024030200423                                         PIC S9(10)V999  VALUE 0.
024040200423          03 WS-LIABILITY-APPLICABLE     PIC S9(11)V99   VALUE 0.
024050200423          03 WS-ORIGINAL-LIABILITY       PIC S9(11)V99   VALUE 0.
024060200423          03 WS-LIABILITY-PER-UNIT       PIC S9(4)V9999999999
024070200423                                                         VALUE 0.
024080200423          03 WS-FEES-RECOVERED           PIC S9(11)V99   VALUE 0.
024090200423          03 WS-ADVISOR-PCT-PER-ANNUM    PIC S9(4)V9999  VALUE 0.
02410020042359781 *   03 WS-CDSC-SEQ-CLOCK           PIC S9(5)       VALUE 0.
02411020042359781     03 WS-CDSC-SEQ-CLOCK           PIC S9(9)       VALUE 0.
024120200423          03 WS-CB-ACCRUED               PIC S9(7)V99999999 VALUE 0.
024130200423          03 WS-UPDFIN-GROSS             PIC S9(11)V99   VALUE 0.
024140200423          03 WS-HH-REDEM-RATE            PIC S9(3)V9999.
024150200423          03 WS-HH-REDEM-RATE-MAX        PIC S9(3)V9999.
024160200423          03 WS-HH-MAX-RED-AMT           PIC S9(11)V99.
024170200423          03 WS-HH-RED-AMT               PIC S9(11)V99.
024180200423          03 WS-HH-PLACEMENT-DT          PIC S9(9).
024190200423          03 WS-HH-TRANS-NO              PIC S9(9).
024200200423          03 WS-HH-REM-AMT               PIC S9(11)V99.
024210200423      *RFS24191 - Begins
024220200423          03 WS-FED-POOLED-TAX-RATE-2    PIC S9(3)V9(2)  VALUE 0.
024230200423          03 WS-INCLUSION-RATE-2         PIC S9(5)V9(2)  VALUE 0.
024240200423          03 WS-FED-INCL-RATE-2          PIC S9(8)V9(2)  VALUE 0.
024250200423      *RFS24191 - Ends
024260200423      *RFS24190 - Begins
024270200423          03 WS-AUC-PROCESS-DATE         PIC S9(9)       VALUE 0.
024280200423          03 WS-AUC-UNIT-COST            PIC S9(5)V9(4)  VALUE 0.
024290200423          03 WS-AUC-ACCOUNT-NO           PIC S9(9)       VALUE 0.
024300200423          03 WS-BOOK-VALUE               PIC S9(11)V9(2) COMP-3
024310200423                                                         VALUE 0.
024320200423          03 WS-CAPITAL-GAIN             PIC S9(11)V9(2) COMP-3
024330200423                                                         VALUE 0.
024340200423      *RFS24190 - Ends
024350200423R33578    03 ln_QcWhTxAwdProvTaxRate     PIC S9(3)V9(2)  VALUE 0.
024360200423      *****
024370200423      *****    ITEMS FOR HOUSEHOLD VALUATION
024380200423      *****
024390200423          03 HHLD-VALUATION-HH-LINKAGE    PIC X(3).
024400200423          03 HHLD-VALUATION-SCHED-CODE    PIC X(5).
024410200423          03 HHLD-VALUATION-HH-INVESTOR   PIC X(9).
024420200423          03 HHLD-VALUATION-HH-INVESTOR-N REDEFINES
024430200423             HHLD-VALUATION-HH-INVESTOR   PIC S9(9).
024440200423          03 HHLD-TOTAL-VALUE             PIC X(15).
024450200423          03 HHLD-TOTAL-VALUE-N REDEFINES
024460200423             HHLD-TOTAL-VALUE             PIC S9(13)V99.
024470200423      * RFS32873 - Begin
024480200423          03 ln_BonusComm                 PIC S9(11)V9(03).
024490200423      * RFS32873 - End
02450020042340942     03 ln_InitialPurchaseGWAPercent PIC S9(03)V9(02).
02451020042340942     03 ln_GWAAmount                 PIC S9(11)V9(02).
02452021062444930     03 ln_NewGDVPercent             PIC S9(03)V9(02).
02453020042344930     03 li_AnnuitantAge              PIC S9(03).
02454020042344930     03 li_TempDate                  PIC 9(9).
02455021062444930     03 li_TempDateR REDEFINES li_TempDate.
02456020042344930        05 li_TempDateYear           PIC 9(5).
02457020042344930        05 li_TempDateMonth          PIC 9(2).
02458020042344930        05 li_TempDateDay            PIC 9(2).
024590200423139286    03 lc_SaveANInvSeries           PIC X(05) VALUE SPACES.
02460020042346707     03 lc_SaveInvSeries             PIC X(05) VALUE SPACES.
02461020042346707     03 li-EligibleStartDftAge       PIC 9(03) VALUE SPACES.
02462020042346707     03 li-ForceStartDftAge          PIC 9(03) VALUE SPACES.
02463020042350474     03 lc_GlwbInvestment            PIC X(01) VALUE "N".
02464020042356471     03 lc_SaveSPInvSeries           PIC X(05) VALUE SPACES.
024650200423  |       03 lc_SeriesType                PIC X(05) VALUE SPACES.
02466020042356471     03 lc_AllowMultipleContracts    PIC X(01) VALUE SPACES.
024670200423112133    03 ln_accountTypePercentFree  PIC S9(5)V9(2) COMP-3 VALUE 0.
024680200423Q31514    03 ln_gainChargeable         PIC S9(10)V9(3) COMP-3 VALUE 0.
024690200423      *RFS140386 -Start
024700200423          03 li_TemporaryDate             PIC 9(8).
024710200423          03 li_TemporaryDateR REDEFINES li_TemporaryDate.
024720200423             05 li_TempDateYr             PIC 9(4).
024730200423             05 li_TempDateMMDD           PIC 9(4).
024740200423      *RFS140386 -End
024750200423
024760200423      * RFS52816 - Begin
024770200423          03 WS-ACCOUNT-TYPE-NOMINEE-CAT  PIC X(01) VALUE SPACES.
024780200423             88 CASH-NOMINEE-ACCOUNT     VALUE "1".
024790200423             88 RRSP-NOMINEE-ACCOUNT     VALUE "2".
024800200423             88 RRIF-NOMINEE-ACCOUNT     VALUE "3".
024810200423             88 RESP-NOMINEE-ACCOUNT     VALUE "4".
024820200423             88 LIF-NOMINEE-ACCOUNT      VALUE "5".
024830200423             88 IPP-NOMINEE-ACCOUNT      VALUE "6".
024840200423             88 DPSP-NOMINEE-ACCOUNT     VALUE "7".
024850200423             88 DPSPF-NOMINEE-ACCOUNT    VALUE "8".
024860200423      * RFS52816 - End
024870200423      * RFS92482   Start
024880200423          03 ln_ROC_Percent               PIC S9(3)V9999 COMP-3
024890200423                                                         VALUE 0.
024900200423          03 lc_ROCFound                  PIC X(1) VALUE "N".
024910200423          03 lc_NonRes_Cal                PIC X(1) VALUE "N".
024920200423      * RFS92482 - End
024930200423      * RFS103858 - Start
024940200423          03  ln_depCommYearsToMaturity    PIC S9(5) VALUE ZEROES.
024950200423          03  ln_depCommRate               PIC S9(4)V9(3) COMP-3.
024960200423          03  lc_depCommYearsFlag          PIC X(1).
024970200423            88  lncc_depCommYears                  VALUE "Y".
024980200423      * RFS103858 - end
024990200423      * RFS128279 - Start
025000200423          03  ws_Skip-Withholding-Tax      PIC X(1) VALUE SPACES.
025010200423            88  ws_Skip-Withholding-TaxYes          VALUE "Y".
025020200423      * RFS 114854 STARTS
025030200423          03 WS_TXWAV                    PIC X(01).
025040200423            88 WS_TXWAV_YES              VALUE "Y".
025050200423            88 WS_TXWAV_NO               VALUE SPACES.
025060200423      * RFS 114854 ENDS .
025070200423      * RFS128279 - End
025080200423152582    03 WS-CURRENT-VALUE-NEW        PIC S9(11)V99  VALUE 0.
025090200423
025100200423
025110200423170676    03 lc_ClawbackAdjustedFlag     PIC X(1) VALUE " ".
025120200423170676      88 lncc_ClawbackAdjusted     VALUE "Y".
025130200929
025140200929      *RFS185892 - Start
025150200929          03 lc_INDSTExistFlag           PIC X(1) VALUE " ".
025160200929            88 lncc_INDSTExistYes        VALUE "Y".
025170200929      *RFS185892 - End
025180201223      * RFS185174 - Start: prorate free based on Month left
025190201223          03 lc_FreeProrateMethodFlag PIC X(01) VALUE SPACES.
025200201223            88 lncc_freeProrateMethodP    VALUE "P".
025210201223          03 ln_monthDiff             PIC S9(7) VALUE 0.
025220201223          03 ln_YearsTotalDsc         PIC S9(5) VALUE 0.
025230201223          03 lc_FLDALFFlag PIC X(01) VALUE SPACES.
025240201223            88 lncc_FLDALFYes    VALUE "Y".
025250201223          03 lc_FLDALFInvStructure  PIC X(05)  VALUE SPACES.
025260201223          03 ln_totCDSCUnitAmt      PIC S9(10)V9(03) COMP-3 VALUE 0.
025270201223          03 ln_trgChrgUnitAmt      PIC S9(10)V9(03) COMP-3 VALUE 0.
025280201223          03 ln_clcChrgUnitAmt      PIC S9(10)V9(03) COMP-3 VALUE 0.
025290201223          03 ln_currUnitBalSav      PIC S9(10)V9(03) COMP-3 VALUE 0.
025300201223      * RFS185174 - End
025310210512      * RFS186888 - Starts
025320210512          03 ln_LiaClcAmt           PIC S9(11)V9(02) COMP-3 VALUE 0.
025330210512          03 ln_LIAOrigAmt          PIC S9(11)V9(02) COMP-3 VALUE 0.
025340210512          03 ln_clcChrgOnAmt        PIC S9(11)V9(02) COMP-3 VALUE 0.
025350210512          03 ln_clcChrgOnAmtPrv     PIC S9(11)V9(02) COMP-3 VALUE 0.
025360210512          03 ln_tmpAmt              PIC S9(11)V9(02) COMP-3 VALUE 0.
025370210609          03 ln_tmpAmtU             PIC S9(10)V9(03) COMP-3 VALUE 0.
025380210512      * RFS186888 - Ends
025390200423170676    01  li_FXUPDCLW-Pl-Dte        PIC S9(9) VALUE 0.
025400200423170676    01  li_FXUPDCLW-Trn-No        PIC S9(9) VALUE 0.
025410200423170676    01  li_FXUPDCLW-Ut-Pr   PIC S9(05)V9(4) VALUE 0.
025420200423
025430200423       01 WS-TARGET-DATE                 PIC 9(9).
025440200423       01 WS-TARGET-DATE-R REDEFINES WS-TARGET-DATE.
025450200423          03 WS-TGT-YEAR                 PIC 9(5).
025460200423          03 WS-TGT-MONTH                PIC 9(2).
025470200423          03 WS-TGT-DAYS                 PIC 9(2).
025480200423
025490200423       01 WS-WK-PROCESS-DATE             PIC 9(9).
025500200423       01 WS-WK-PROCESS-DATE-R REDEFINES WS-WK-PROCESS-DATE.
025510200423          03 WS-WKP-YEAR                 PIC 9(5).
025520200423          03 WS-WKP-MONTH                PIC 9(2).
025530200423          03 WS-WKP-DAYS                 PIC 9(2).
025540200423
025550200423       01 WS-WK-TRADE-DATE               PIC 9(9).
025560200423       01 WS-WK-TRADE-DATE-R REDEFINES WS-WK-TRADE-DATE.
025570200423          03 WS-WKT-YEAR                 PIC 9(5).
025580200423          03 WS-WKT-MONTH                PIC 9(2).
025590200423          03 WS-WKT-DAYS                 PIC 9(2).
025600200423
025610200423       01 WS-DAYS-TOTAL                  PIC 9(5) VALUE 0.
025620200423      * RFS15626 - Begin
025630200423       01 WS-CURR-DAYS-TOTAL             PIC 9(5) VALUE 0.
025640200423      * RFS15626 - End
025650200423       01 WS-EXCLUDE-FREE-UNITS          PIC S9(10)V999 VALUE 0.
025660200423       01 WS-PLACEMENT-DATE              PIC 9(9) VALUE 0.
025670200423       01 WS-TRADE-DATE                  PIC 9(9) VALUE 0.
025680200423       01 WS-TRANS-NO                    PIC 9(9) VALUE 0.
025690200423       01 WS-FINANCER-CODE               PIC X(3) VALUE " ".
025700200423
025710200423      * RFS10608 - Begin
025720200423       01 WS-ACCOUNT-NO                  PIC S9(09) VALUE ZEROES.
025730200423       01 WS-DEALER-CODE                 PIC X(04)  VALUE SPACES.
025740200423      * RFS10608 - End
025750200423
025760200423       01 WS-FINANCER-SCHEDULE           PIC X(4) VALUE " ".
025770200423       01 WS-CDSC-SCHEDULE               PIC X(5) VALUE " ".
025780200423       01 WS-INVESTMENT-CODE             PIC X(5) VALUE " ".
025790200423       01 WS-DISTRIBUTION-PLACEMENT-DATE PIC 9(9) VALUE 0.
025800200423       01 WS-DISTRIBUTION-TRANS-NO       PIC 9(9) VALUE 0.
025810200423       01 WS-MTD-ACCRUAL-FLAG            PIC X(1) VALUE "N".
025820200423       01 WS-YTD-ACCRUAL-FLAG            PIC X(1) VALUE "N".
025830200423       01 WS-CASH-SWITCH-MODE            PIC X(1) VALUE "N".
025840200423       01 WS-SPOT-RATE-EXISTS            PIC X(1) VALUE "N".
025850200423       01 WS-LBS-USE-FREE                PIC X(1) VALUE "N".
025860200423       01 WS-LSIF-CALCULATE-MODE         PIC X(1) VALUE "N".
025870200423       01 WS-NEW-CONTROL-REC             PIC X(1) VALUE "N".
025880200423      * Seg fund flds
025890200423       01 WS-SEG-UNITS-REDUCE            PIC S9(11)V999 VALUE 0.
025900200423       01 WS-SEG-UNITS-AVAILABLE         PIC S9(11)V999 VALUE 0.
025910200423       01 WS-SEG-ALLOC-FOUND             PIC X(1) VALUE "N".
025920200423       01 WS-SEG-ANNUIT-AGE-THRESH       PIC X(1) VALUE "N".
025930200423       01 WS-TRANS-CONTR-EXISTS          PIC X(1) VALUE "N".
025940200423       01 WS-EDIT-SPECIFIC-CONTRACT      PIC X(1) VALUE "N".
02595020042346707  01 WS-EDIT-SPECIFIC-CONTRACT-OLD  PIC X(1) VALUE "N".
025960200423
025970200423      *RFS 9092 BEGIN
025980200423       01 WS-EDIT-SEG-JURISDICTION       PIC X(1) VALUE "N".
025990200423       01 WS-SAME-JURISDICTION-FOUND     PIC X(1) VALUE "N".
026000200423       01 WS-INVESTMENT-STRUCTURE        PIC X(5) VALUE SPACES.
026010200423      *RFS 9092 END
026020200423
026030200423       01 WS-CONTRACT-MATCH              PIC X(1) VALUE "N".
026040200423       01 WS-CONTRACT-IS-EMPTY           PIC X(1) VALUE "N".
026050200423       01 WS-REQ-INDIV-CONTRACT          PIC X(1) VALUE "N".
026060200423       01 WS-CMP-RESET-TYPE              PIC X(1) VALUE " ".
026070200423       01 WS-CMP-CONTRACT-STATUS-SCHED   PIC X(5) VALUE "     ".
02608020042357388  01 Ws-cmp-gdv-sched-code          PIC X(5) VALUE "     ".
026090200423      * RFS 7924 - BEGIN
026100200423       01 WS-CMP-RESET-SCHEDULE-CODE     PIC X(5) VALUE "     ".
026110200423      * RFS 7924 - END
026120200423       01 WS-CMP-MATURITY-ALLOW-DAYS     PIC 9(5) VALUE 0.
026130200423       01 WS-CMP-DEPOSIT-LEN             PIC 9(5) VALUE 0.
02614020042344930  01 Ws-Cmp-Guar-Death-Sched-Code   PIC X(5) VALUE SPACE.
026150200423       01 WS-BLANKET-INSURANCE-LICENSE   PIC X(1) VALUE " ".
026160200423       01 WS-ACCOUNT-EXISTS              PIC X(1) VALUE " ".
026170200423       01 WS-ACCEPT-FROM-DQ              PIC X(1) VALUE "N".
026180200423       01 WS-HH-SWITCH-OUT-DEP           PIC S9(11)V99 VALUE 0.
026190200423       01 WS-HH-SWITCH-OUT-FEE           PIC S9(11)V99 VALUE 0.
02620020042355136  01 Ws-Cmp-Investment-Series       PIC X(5) VALUE "     ".
026210200423      *1001156 Local variable
026220200423       01 WS-LOC-Investment-Series       PIC X(5) VALUE SPACE.
026230200423
026240200423       01 WS-MATURITY-DATE               PIC 9(9).
026250200423       01 WS-MATURITY-DATE-R REDEFINES WS-MATURITY-DATE.
026260200423          03 WS-MATURITY-YEAR            PIC 9(5).
026270200423          03 WS-MATURITY-MONTH           PIC 9(2).
026280200423          03 WS-MATURITY-DAYS            PIC 9(2).
026290200423
026300200423       01 WS-YEAR-END-DATE               PIC 9(08).                     RFS7652
026310200423       01 WS-YEAR-END-DATE-R REDEFINES WS-YEAR-END-DATE.                RFS7652
026320200423          10 WS-YEAR-END-CCYY            PIC 9(04).                     RFS7652
026330200423          10 WS-YEAR-END-MMDD            PIC 9(04).                     RFS7652
026340200423140269 01 WS-NEW-YEAR-DATE               PIC 9(08).
026350200423140269 01 WS-NEW-YEAR-DATE-R REDEFINES WS-NEW-YEAR-DATE.
026360200423140269    10 WS-NEW-YEAR-CCYY            PIC 9(04).
026370200423140269    10 WS-NEW-YEAR-MMDD            PIC 9(04).
026380200423      *------------------------------------------------*
026390200423      * CDSC ELEMENTS                                  *
026400200423      *------------------------------------------------*
026410200423       01 WS-CURR-UNITS-FREE             PIC S9(9)V9(3) VALUE 0.
026420200423       01 WS-CURR-UNITS-CHRG             PIC S9(9)V9(3) VALUE 0.
026430200423       01 WS-CURR-UNITS-BAL              PIC S9(9)V9(3) VALUE 0.
026440200423       01 WS-CURR-UNITS-BAL-REMAIN       PIC S9(9)V9(3) VALUE 0.
026450200423       01 WS-CURR-UNITS-FREE-AWD         PIC S9(9)V9(3) VALUE 0.
026460200423      * RFS16505 - Begin
026470200423       01 WS-CURR-UNITS-TMP              PIC S9(9)V9(3) VALUE 0.
026480200423       01 WS-CURR-UNITS-MAT              PIC S9(9)V9(3) VALUE 0.
026490200423       01 WS-CURR-UNITS-FREE-AND-AWD     PIC S9(9)V9(3) VALUE 0.
026500200423      * Chargeable Units which are not matured
026510200423       01 WS-CURR-UNITS-CHRG-TO-CHARGE   PIC S9(9)V9(3) VALUE 0.
026520200423      * RFS16505 - End
026530200423       01 WS-AWD-CHARGABLE-UNITS         PIC S9(9)V9(3) VALUE 0.
026540200423       01 WS-DISTRIBUTION-UNITS          PIC S9(9)V9(3) VALUE 0.
026550200423       01 WS-UNITS-TO-BE-APPLIED         PIC S9(9)V9(3) VALUE 0.
026560200423       01 WS-UNITS-APPLIED               PIC S9(9)V9(3) VALUE 0.
026570200423       01 WS-CASH-UNITS-REDUCED          PIC S9(9)V9(3) VALUE 0.
026580200423       01 WS-CASH-UNITS-REINVEST         PIC S9(9)V9(3) VALUE 0.
026590200423129787 01 li_CommAmt                     PIC S9(11)V99  VALUE 0.
026600200423129787 01 li_OutAccntPerFree             PIC S9(5)V9(2) COMP-3 VALUE 0.
026610200423129787 01 li_InAccntPerFree              PIC S9(5)V9(2) COMP-3 VALUE 0.
026620200423129787 01 li_PercentFree                 PIC S9(5)V9(2) COMP-3 VALUE 0.
026630200423      * RFS14898 - Begin
026640200423      * RFS16051 - Begin
026650200423      *01 WS-UNIT-PERCENTAGE           PIC S9(3)V9(28) COMP-3 VALUE 0.
026660200423       01 WS-UNIT-PERCENTAGE           PIC S9(3)V9(15) COMP-3 VALUE 0.
026670200423      * RFS16051 - End
026680200423      * RFS14898 - End
026690200423      * RFS75512 - Begins
026700200423      *01 WS-REDUCTION-SEQ-NO            PIC S9(5)      VALUE 0.
026710200423      *01 WS-ADDITION-SEQ-NO             PIC S9(5)      VALUE 0.
026720200423       01 WS-REDUCTION-SEQ-NO            PIC S9(9)      VALUE 0.
026730200423       01 WS-ADDITION-SEQ-NO             PIC S9(9)      VALUE 0.
026740200423      * RFS75512 - Ends
026750200423      * RFS14898 - Begin
026760200423      *01 WS-PRORATE-PERCENTAGE          PIC S9(3)V9999999999 VALUE 0.
026770200423      * RFS16051 - Begin
026780200423      *01 WS-PRORATE-PERCENTAGE        PIC S9(3)V9(28) COMP-3 VALUE 0.
026790200423       01 WS-PRORATE-PERCENTAGE        PIC S9(3)V9(15) COMP-3 VALUE 0.
026800200423      * RFS16051 - End
026810200423      * RFS14898 - End
026820200423       01 WS-APPLY-FREE-PRORATE          PIC X           VALUE "N".
026830200423       01 WS-CHARGE-ALL-FREE             PIC X           VALUE "N".
026840200423       01 WS-PRORATED-FREE               PIC S9(9)V9(3)  VALUE 0.
026850200423       01 WS-CALCULATOR-CHARGE           PIC S9(11)V9(2) VALUE 0.
026860200423176052 01 WS-CURR-UNITS-FREE-TOPUP       PIC S9(09)V9(3) VALUE 0.
026870200423176052 01 WS-CURR-UNITS-CHRG-TOPUP       PIC S9(09)V9(3) VALUE 0.
026880200423      *------------------------------------------------*
026890200423      * ESTIMATE ELEMENTS                              *
026900200423      *------------------------------------------------*
026910200423       01 WS-EST-TAX                     PIC S9(11)V99   VALUE 0.
026920200423       01 WS-EST-NET                     PIC S9(11)V99   VALUE 0.
026930200423       01 WS-D-DEDUCTIONS                PIC S9(11)V99   VALUE 0.
026940200423       01 WS-SUB-DEDUCTION-NET           PIC S9(11)V99   VALUE 0.
026950200423       01 WS-CURRENT-RANGE-VALUE         PIC S9(11)V99   VALUE 0.
026960200423       01 WS-CURRENT-RANGE-MAXIMUM       PIC S9(11)V99   VALUE 0.
026970200423       01 WS-CURRENT-RANGE-MINIMUM       PIC S9(11)V99   VALUE 0.
026980200423       01 WS-CURRENT-RANGE-VALUE-D       PIC S9(11)V99   VALUE 0.
026990200423       01 WS-CURRENT-RANGE-MAXIMUM-D     PIC S9(11)V99   VALUE 0.
027000200423       01 WS-CURRENT-RANGE-MINIMUM-D     PIC S9(11)V99   VALUE 0.
027010200423      * RFS117135 - Begin
027020200423       01 lc_tmpCountryCode              PIC X(03) VALUE SPACES.
027030200423       01 lc_tmpProvinceCode             PIC X(03) VALUE SPACES.
027040200423      * RFS117135 - End
027050200423      * RFS46962 - Begin: temporary variable to keep the range
027060200423       01 ln_tmpRange                    PIC S9(11)V99   VALUE 0.
027070200423      * Special counter to prevent TRNPST from looping
027080200423       01 ln_estimateCounter             PIC S9(09)      VALUE 0.
027090200423       01 lnc_estimateCounterMax         PIC S9(09)      VALUE 1000.
027100200423      * RFS46962 - End
027110200423
027120200423      * RFS12420 - Begin
027130200423      *01 WS-GROSS-STORED                PIC S9(11)V99   VALUE 0.
027140200423      * RFS12420 - End
027150200423
027160200423      *RFS 13405 BEGIN
027170200423       01 WS-ALV-GROSS                   PIC S9(11)V99   VALUE 0.
027180200423      *RFS 13405 END
027190200423       01 WS-DEDUCTION-MODE              PIC X           VALUE SPACES.
027200200423       01 WS-CDSC-DEDUCTION-TYPE         PIC X           VALUE SPACES.
027210200423       01 WS-CLAWBACK-DEDUCTION-TYPE     PIC X           VALUE SPACES.
027220200423       01 WS-HH-REDFEE-DEDUCTION-TYPE    PIC X           VALUE SPACES.
027230200423       01 WS-REPMT-RFE-DEDUCTION-TYPE    PIC X           VALUE SPACES.
027240200423       01 WS-REDE-PLTY-DEDUCTION-TYPE    PIC X           VALUE SPACES.
027250200423       01 WS-TAX-DEDUCTION-TYPE          PIC X           VALUE SPACES.
027260200423       01 WS-SWITCH-GROSS-MODE           PIC X           VALUE SPACES.
027270200423       01 WS-BASE-DEDUCTIONS             PIC S9(11)V99   VALUE 0.
027280200423      * RFS12420 - Begin
027290200423      * ---------------------------------------------------------------
027300200423      *01 WS-FINAL-TAX-PASS              PIC X(1) VALUE "N".
027310200423      *01 WS-TAX-PASS-COUNT              PIC S9(3)       VALUE 0.
027320200423      * ---------------------------------------------------------------
027330200423      * RFS12420 - End
027340200423      ** MULTI LOCK MOD
027350200423100055* 01 WS-CONTROL-COUNT               PIC S9(9)       VALUE 0.
027360200423      ** MULTI LOCK END
027370200423      *****
027380200423      *****    ITEMS FOR HOUSEHOLD VALUATION
027390200423      *****
027400200423        01 WS-HH-RATES-APPLY            PIC X(1).
027410200423           88 WS-HH-RATES-APPLICABLE    VALUES "Y".
027420200423
027430200423      ** GIC MOD
027440200423       01 WS-GIC-PROCESS-MODE            PIC X           VALUE SPACES.
027450200423       01 WS-GIC-CRT-FOUND               PIC X           VALUE SPACES.
027460200423       01 WS-IGT-TXN-FOUND               PIC X           VALUE SPACES.
027470200423       01 WS-CUR-LIB                     PIC X(10)       VALUE SPACES.
027480200423       01 WS-CERT-STATUS-CODE-CLOSE      PIC X           VALUE SPACES.
027490200423       01 WS-CERT-STATUS-CODE-ACTIVE     PIC X           VALUE SPACES.
027500200423       01 WS-PROCESS-GIC-INT-FIRST       PIC X           VALUE SPACES.
027510200423
027520200423      *RFS 7390 BEGIN
027530200423       01 WS-STD-GIC-INT                 PIC X           VALUE SPACES.
027540200423      * RFS49699 - Begin
027550200423       01 WS-ARRAY-LOG-MISC.
027560200423           05 WS-ARRAY1-NAME           PIC X(32)
027570200423                               VALUE "WS1-WITHH-RATES-TBL".
027580200423           05 WS-ARRAY1-MAX            PIC 9(09)
027590200423                               VALUE 32.
027600200423           05 WS-ARRAY1-MAX-USED       PIC 9(09)
027610200423                               VALUE 0.
027620200423           05 WS-ARRAY2-NAME           PIC X(32)
027630200423                               VALUE "WS-TRANS-CONTRACT-DETAILS-2".
027640200423           05 WS-ARRAY2-MAX            PIC 9(09)
027650200423110292*                        VALUE 150.
027660200423110292                         VALUE 500.
027670200423           05 WS-ARRAY2-MAX-USED       PIC 9(09)
027680200423                               VALUE 0.
027690200423           05 WS-ARRAY3-NAME           PIC X(32)
027700200423                               VALUE "WS-ACCOUNT-CONTRACT-INVEST-2".
027710200423           05 WS-ARRAY3-MAX            PIC 9(09)
027720200423110292*                        VALUE 150.
027730200423110292                         VALUE 500.
027740200423           05 WS-ARRAY3-MAX-USED       PIC 9(09)
027750200423                               VALUE 0.
027760200423           05 WS-ARRAY4-NAME           PIC X(32)
027770200423                               VALUE "WS-TRANS-CONTRACT-TARGET-2".
027780200423           05 WS-ARRAY4-MAX            PIC 9(09)
027790200423110292*                        VALUE 150.
027800200423110292                         VALUE 500.
027810200423           05 WS-ARRAY4-MAX-USED       PIC 9(09)
027820200423                               VALUE 0.
027830200423           05 WS-ARRAY5-NAME           PIC X(32)
027840200423                               VALUE "WS-ACCOUNT-CONTRACT-2".
027850200423           05 WS-ARRAY5-MAX            PIC 9(09)
027860200423110292*                        VALUE 150.
027870200423110292                         VALUE 500.
027880200423           05 WS-ARRAY5-MAX-USED       PIC 9(09)
027890200423                               VALUE 0.
027900200423           05 WS-ARRAY6-NAME           PIC X(32)
027910200423                               VALUE "WS-ACCOUNT-CONT-ANNT-2".
027920200423           05 WS-ARRAY6-MAX            PIC 9(09)
027930200423110292*                        VALUE 150.
027940200423110292                         VALUE 500.
027950200423           05 WS-ARRAY6-MAX-USED       PIC 9(09)
027960200423                               VALUE 0.
027970200423           05 WS-ARRAY7-NAME           PIC X(32)
027980200423                               VALUE "WS-SEG-ARRAY-CONTRACT".
027990200423           05 WS-ARRAY7-MAX            PIC 9(09)
028000200423                               VALUE 150.
028010200423           05 WS-ARRAY7-MAX-USED       PIC 9(09)
028020200423                               VALUE 0.
028030200423           05 WS-ARRAY8-NAME           PIC X(32)
028040200423                               VALUE "WS-WRITE-REWRITE-ACI2-ARRAY".
028050200423           05 WS-ARRAY8-MAX            PIC 9(09)
028060200423                               VALUE 150.
028070200423           05 WS-ARRAY8-MAX-USED       PIC 9(09)
028080200423                               VALUE 0.
028090200423           05 WS-ARRAY9-NAME           PIC X(32)
028100200423                               VALUE "WS-TBL-ARRAY".
028110200423           05 WS-ARRAY9-MAX            PIC 9(09)
028120200423                               VALUE 800.
028130200423           05 WS-ARRAY9-MAX-USED       PIC 9(09)
028140200423                               VALUE 0.
028150200423           05 WS-ARRAY10-NAME          PIC X(32)
028160200423                               VALUE "WS-TEP-ARRAY".
028170200423           05 WS-ARRAY10-MAX           PIC 9(09)
028180200423      * RFS1017119 - Start: increased array size
028190200423      *                        VALUE 2000.
028200200423                               VALUE 6000.
028210200423      * RFS1017119 - End
028220200423           05 WS-ARRAY10-MAX-USED      PIC 9(09)
028230200423                               VALUE 0.
028240200423           05 WS-ARRAY11-NAME          PIC X(32)
028250200423                               VALUE "WS-ACCOUNT-ASSIGNMENT".
028260200423           05 WS-ARRAY11-MAX           PIC 9(09)
028270200423                               VALUE 25.
028280200423           05 WS-ARRAY11-MAX-USED      PIC 9(09)
028290200423                               VALUE 0.
028300200423           05 WS-ARRAY12-NAME          PIC X(32)
028310200423                               VALUE "WS-ACCT-ASS-TARGET".
028320200423           05 WS-ARRAY12-MAX           PIC 9(09)
028330200423                               VALUE 25.
028340200423           05 WS-ARRAY12-MAX-USED      PIC 9(09)
028350200423                               VALUE 0.
028360200423           05 WS-ARRAY13-NAME          PIC X(32)
028370200423                               VALUE "WS-ASL-ARRAY".
028380200423           05 WS-ARRAY13-MAX           PIC 9(09)
028390200423                               VALUE 50.
028400200423           05 WS-ARRAY13-MAX-USED      PIC 9(09)
028410200423                               VALUE 0.
028420200423      * RFS49699 - End
028430200423       01 WS-CLOSING-REASON-TRO          PIC X(3)        VALUE SPACES.
028440200423      *RFS 7390 END
028450200423
028460200423      *RFS 7721 BEGIN
028470200423       01 WS-ASL-FIELDS.
028480200423           03 WS-ASL-FLAG       PIC X           VALUE SPACES.
028490200423      *** FLAG VALUES: W - write; R - rewrite; C - charge fee
028500200423           03 WS-ASL-AMOUNTS.
028510200423              05 WS-ASL-REDF                 PIC S9(11)V99  VALUE 0.
028520200423              05 WS-ASL-REDF-RATE            PIC S9(3)V99   VALUE 0.
028530200423           03 WS-ASL-INVESTMENT-STR          PIC X(5) VALUE SPACES.
028540200423           03 WS-ASL-CODE                    PIC X(5) VALUE SPACES.
028550200423           03 WS-ASL-TRADE-DATE              PIC 9(09).
028560200423           03 WS-ASL-TRADE-DATE-R REDEFINES WS-ASL-TRADE-DATE.
028570200423              10 WS-ASL-YEAR                 PIC 9(05).
028580200423              10 WS-ASL-MMDD                 PIC 9(04).
028590200423           03 WS-ASL-TRADE-DATE-H            PIC 9(09).
028600200423           03 WS-ASL-TRADE-DATE-H-R REDEFINES WS-ASL-TRADE-DATE-H.
028610200423              10 WS-ASL-YEAR-H               PIC 9(05).
028620200423              10 WS-ASL-MMDD-H               PIC 9(04).
028630200423
028640200423       01 WS-ASL-ARR.
028650200423          03 WS-ASL-ARRAY OCCURS  50  TIMES
028660200423                                      INDEXED BY  ASLIDX.
028670200423             10  WS-ASL-ARR-INV-CODE     PIC X(5).
028680200423             10  WS-ASL-ARR-INV-STR-CODE PIC X(5).
028690200423             10  WS-ASL-ARR-CODE         PIC X(5).
028700200423             10  WS-ASL-ARR-YEAR         PIC 9(4)   VALUE 0.
028710200423      *RFS 7721 END
028720200423      /
0287302004237858   01 WS-CLOSING-REASON              PIC X(3)        VALUE SPACES.
028740200423
028750200423      *RFS 9346 - BEGIN
028760200423       01 UPESPFN-AREA                   PIC X(200).
028770200423       01 UPESPFN-BUFFER-AREA REDEFINES UPESPFN-AREA.
028780200423          05 UPESPFN-PROCESS-OPTION        PIC X(1).
028790200423          05 UPESPFN-NEXT-PROCESS-DATE-OPT PIC X(1).
028800200423          05 UPESPFN-GIC-DII-OPTION        PIC X(1).
028810200423          05 UPESPFN-CONTR-REDEM-RULE      PIC X(2).
028820200423          05 UPESPFN-PROCESS-DATE          PIC 9(8).
028830200423          05 UPESPFN-START-DATE            PIC 9(8).
028840200423          05 UPESPFN-END-DATE              PIC 9(8).
028850200423          05 UPESPFN-ACCOUNT-NO            PIC 9(9).
028860200423          05 UPESPFN-PLACEMENT-DATE        PIC 9(9).
028870200423          05 UPESPFN-TRANS-NO              PIC 9(9).
028880200423          05 UPESPFN-REJECTION-CODE        PIC X(3).
028890200423      *RFS 9346 - END
028900200423
028910200423      *RFS 80144 - Begin
028920200423       COPY CPUPIQEEFN.
028930200423      *RFS 80144 - End
028940200423
028950200423      ** END GIC MOD
028960200423      *    RFS84977 -Begin
028970200423       01 WS-FXRESPVAL-PLACEMENT-DATE    PIC 9(09) VALUE ZEROES.
028980200423       01 WS-FXRESPVAL-TRANS-NO          PIC 9(09) VALUE ZEROES.
028990200423       01 WS-FXRESPVAL-NET-AMT           PIC S9(11)V99.
029000200423       01 WS-FXRESPVAL-REJECTION-CODE    PIC X(2).
029010200423       01 ln_tmpcnt                      PIC S9(05) COMP-3.
029020200423      *    RFS84977 -End
029030200423      *    RFS84977.17 -Begins - Add FXRESPEAP copybook
029040200423       COPY CPYRESPEAP.
029050200423      *    RFS84977.17 -Ends
029060200423      *------------------------------------------------*
029070200423      * LEVEL 88 ELEMENTS                              *
029080200423      *------------------------------------------------*
029090200423       01 MANAGEMENT-COMPANY-SPEC-CAT.
029100200423          05 MANAGEMENT-CO-CATAGORY      PIC X(3).
029110200423             88 TREAT-ALL-AS-CHRG        VALUES "AIC" "ADE" "TAI".
029120200423             88 PRORATE-FREE-ACROSS      VALUES "AIC" "ADE" "TAI".
029130200423             88 NO-DSC-ON-CASH-DISTRIBS  VALUES "AIC" "ATL" "ADE"
029140200423R34924*                                         "TAI".
029150200423R34924                                          "TAI" "GGF".
029160200423             88 SUPPRESS-ON-IFPAY        VALUES "MLA".
029170200423             88 DAF-REQUIRED             VALUES "CEM".
029180200423      * RFS46365 - Start: Retire functionality
029190200423      *      88 LIABILITY-SUPPORT        VALUES "ATL".
029200200423      *      88 CLOCK-SUPPORT            VALUES "ATL".
029210200423             88 LIABILITY-SUPPORT        VALUES "   ".
029220200423             88 CLOCK-SUPPORT            VALUES "   ".
029230200423      * RFS46365 - End
029240200423             88 POST-DISTR-IND-CLIENT    VALUES "ATL".
029250200423             88 HH-FEE-ACTIVE            VALUES "OGF".
029260200423      *RFS 8058 BEGIN
029270200423          05 WS-ACCOUNT-LEV-DSC          PIC X(1).
029280200423             88 ACCOUNT-LEV-DSC          VALUES "Y".
029290200423          05 WS-ACCOUNT-LEV-FREE-DOLLARS PIC X(1).
029300200423             88 ACCOUNT-LEV-FREE-DOLLARS VALUES "Y".
029310200423          05 WS-ACCOUNT-TYPE-PCT-FREE    PIC X(1).
029320200423             88 ACCOUNT-TYPE-PCT-FREE    VALUES "Y".
029330200423      *RFS 8058 END
029340200423      *RFS 7721 BEGIN
029350200423          05 WS-SPEC-MOD-AUTH-ALWBSWO    PIC X(1).
029360200423             88 SPEC-MOD-AUTH-ALWBSWO    VALUES "Y".
029370200423      *RFS 7721 END
029380200423      *RFS 16941 BEGIN
029390200423          05 WS-SPEC-MOD-AUTH-ENVTRNSFER PIC X(1).
029400200423             88 SPEC-MOD-AUTH-ENVTRNSFER VALUES "Y".
029410200423      *RFS 16941 END
029420200423      *RFS 17019 Begin
029430200423          05 WS-MFEAMS                   PIC X(1).
029440200423             88 SPEC-MOD-AUTH-MFEAMS     VALUES "Y".
029450200423      *RFS 17019 End
029460200423      * RFS17685 - Start
029470200423          05 WS-MMINTA                   PIC X(1).
029480200423             88 SPEC-MOD-AUTH-MMINTA     VALUES "Y".
029490200423      * RFS17685 - End
029500200423      *RFS 14380 Begin
029510200423          05 WS-ERFEE                    PIC X(1).
029520200423             88 SPEC-MOD-AUTH-ERFEE      VALUES "Y".
029530200423      *RFS 14380 End
029540200423      *RFS 13468 BEGIN
029550200423          05 WS-FREE-DOLLAR-DSC          PIC X(1).
029560200423             88 FREE-DOLLAR-DSC          VALUES "Y".
029570200423      *RFS 13468 END
029580200423      *RFS 8066 BEGIN
029590200423          05 WS-RESET-ACCTP-SWITCH       PIC X(1).
029600200423             88 RESET-ACCTP-SWITCH-ON    VALUES "Y".
029610200423          05 WS-EXTERNAL-TRANSFER        PIC X(1).
029620200423             88 EXTERNAL-TRANSFER-ON     VALUES "Y".
029630200423          05 WS-EXTERNAL-TRANSFER-CODE   PIC X(2).
029640200423             88 EXTERNAL-TRANSFER-CODE   VALUES "88".
029650200423      *RFS 8066 END
029660200423
029670200423      *RFS 10826 BEGIN
029680200423          05 WS-COMMISSION-RECOVERY      PIC X(1).
029690200423             88 COMMISSION-RECOVERY-ON   VALUES "Y".
029700200423          05 WS-REVERSAL-CODE-RULES      PIC X(1).
029710200423             88 COMMISSION-RECOVERY      VALUES "1".
029720200423      * RFS16941 - Begin
029730200423             88 REVERSAL-CODES-RULE-TRF-BW-ENV
029740200423                                         VALUES "2".
029750200423      * RFS16941 - End
029760200423      * RFS13743 - Begin
029770200423             88 WAIVE-ASL-CHARGES        VALUES "3".
029780200423      * RFS13743 - End
029790200423      * RFS16919 - Begin
029800200423             88 LSIF-ROLLOVER            VALUES "5".
029810200423      * RFS16919 - End
029820200423      * RFS10826 END
029830200423      *
029840200423      * RFS13471 - Begin
029850200423          05 WS-MANAGMENT-FEE            PIC X(1).
029860200423             88 MANAGMENT-FEE-ON         VALUES "Y".
029870200423      * RFS13471 - End
029880200423      *
029890200423      * RFS13587 - Begin
029900200423          05 WS-ADJUSTMENT-FEE           PIC X(1).
029910200423             88 ADJUSTMENT-FEE-ON        VALUES "Y".
029920200423      * RFS13587 - End
029930200423      *
029940200423      * RFS16505 - Begin
029950200423          05 WS-SPEC-MOD-AUTH-DSCMET     PIC X(1).
029960200423             88 SPEC-MOD-AUTH-DSCMET-ON  VALUES "Y".
029970200423      * RFS16505 - End
029980200423      * RFS37754 - Begin
029990200423          05 WS-SPEC-MOD-AUTH-SEGSYSMAT  PIC X(1).
030000200423             88 SPEC-MOD-AUTH-SEGSYSMAT-ON  VALUES "Y".
030010200423      * RFS37754 - End
030020200423      * RFS68035 - Begin
030030200423          05 WS-SPEC-MOD-AUTH-RDSP       PIC X(1).
030040200423             88 SPEC-MOD-AUTH-RDSP-ON     VALUES "Y".
030050200423      * RFS68035 - End
030060200423
030070200423      *RFS 10575 BEGIN
030080200423          05 WS-ACCOUNT-TYPE-CAT         PIC X.
030090200423      * RFS76541 - Begin: added new account type category
030100200423             88 RDSP-ACCOUNT             VALUE "0".
030110200423      * RFS76541 - End
030120200423             88 CASH-ACCOUNT             VALUE "1".
030130200423             88 RRSP-ACCOUNT             VALUE "2".
030140200423             88 RRIF-ACCOUNT             VALUE "3".
030150200423             88 RESP-ACCOUNT             VALUE "4".
030160200423             88 LIF-ACCOUNT              VALUE "5".
030170200423             88 IPP-ACCOUNT              VALUE "6".
030180200423             88 DPSP-ACCOUNT             VALUE "7".
030190200423             88 DPSPF-ACCOUNT            VALUE "8".
030200200423      *RFS 10575 END
030210200423
030220200423R29550    05 WS-USWT                     PIC X(1).
030230200423R29550       88 SPEC-MOD-AUTH-USWT       VALUES "Y".
030240200423
030250200423      *RFS24191 - Begins
030260200423          05 WS-POLTAX                   PIC X(1).
030270200423             88 SPEC-MOD-AUTH-POLTAX     VALUES "Y".
030280200423
030290200423          05 WS-EDIT-IRCPG               PIC X(1).
030300200423             88 EDIT-IRCPG               VALUES "Y".
030310200423      *RFS24191 - Ends
030320200423      *RFS24190 - Begins
030330200423          05 WS-EDIT-NT2062              PIC X(1).
030340200423             88 EDIT-NT2062              VALUES "Y".
030350200423          05 WS-EDIT-NRGSEL              PIC X(1).
030360200423             88 EDIT-NRGSEL              VALUES "Y".
030370200423      *RFS24190 - Ends
030380200423      *RFS24192 - Begins
030390200423          05 WS-EDIT-NDSNRR              PIC X(1).
030400200423             88 EDIT-NDSNRR              VALUES "Y".
030410200423      *RFS24192 - Ends
030420200423      *RFS33578 - Begins
030430200423          05 lb_EditCodeAcwtax           PIC X(1).
030440200423             88 lb_EditCodeAcwtaxYes     VALUES "Y".
030450200423             88 lb_EditCodeAcwtaxNo      VALUES "N".
030460200423          05 lb_QcWhTaxFunction          PIC X(1).
030470200423             88 lb_QcWhTaxFunctionYes    VALUES "Y".
030480200423             88 lb_QcWhTaxFunctionNo     VALUES "N".
030490200423      *RFS33578 - Ends
030500200423R48630    05 lc_SameLoadStructure        PIC X(1).
030510200423             88 SameLoadStructure        VALUES "Y".
030520200423             88 NotSameLoadStructure     VALUES "N".
030530200423def14     05 lc_SameSegSeries            PIC X(1).
030540200423             88 SameSegSeries            VALUES "Y".
030550200423             88 NotSameSegSeries         VALUES "N".
030560200423
030570200423      *RFS30134 - Begins
030580200423          05 lc_Trntrd_Flag             PIC X(1) VALUES "N".
030590200423          05 lc_Accact_Flag             PIC X(1) VALUES "N".
030600200423      *RFS30134 - Ends
03061020042334309     05 WS-VALID-RESP-EAP-TRADE     PIC X(1).
03062020042334309        88 VALID-RESP-EAP-TRADE     VALUES "Y".
03063020042369951        88 lnc_invalidRespEapTrade  VALUES "N".
030640201223      * RFS185174 - Start: set up FLDALF at environment level
030650201223          05 lc_ENV_FLDALFFlag PIC X(01) VALUE SPACES.
030660201223             88 lncc_ENV_FLDALFOn        VALUE "Y".
030670201223          05 lncc_FLDALF       PIC X(10) VALUE "FLDALF".
030680201223      * RFS185174 - End
030690200423       01 TRANS-ORIGIN-CATAGORIES.
030700200423          05 WS-TRANS-ORIGIN-88          PIC X(3).
030710200423             88 PAC                      VALUES "PAC" "PAA".
030720200423             88 AWD                      VALUES "AWE" "AWC" "ALC"
030730200423                                                "ALE".
030740200423 ****** RFS 30134 start ****
030750200423             88 DCA                      VALUES "DCA" "DLA".
030760200423             88 DSR                      VALUES "DSR".
030770200423             88 AWR                      VALUES "AWR".
030780200423             88 ALC                      VALUES "ALC".
030790200423             88 AWE                      VALUES "AWE" "AWC" "ALE".
030800200423             88 GRP                      VALUES "EEC" "ERC" "ERA"
03081020042371446 *                                         "ECA".
03082020042371446                                           "ECA" "VLC" "AEV".
030830200423             88 TRK                      VALUES "TRK" "TRA".
030840200423      * RFS35075 - Begin
030850200423             88 lnc_origCodesForREPLIC   VALUES "PAC" "EEC" "ERC"
03086020042371446 *                                         "AWR" "DSR".
03087020042371446                                           "AWR" "DSR" "VLC".
030880200423      * RFS35075 - End
030890200423      * RFS37754 - Begin
030900200423             88 lnc_origCodeMat          VALUES "MAT".
030910200423      * RFS37754 - End
03092020042339466        88 lnc_origCodeDth          VALUES "DTH".
03093020042344930        88 lnc_origCodeRST          VALUES "RST".
030940200423 ****** RFS 30134 end ******
030950200423 54431       88 RDSP-Screen-Input        VALUES "DIR" "WOR".
030960200423144361       88 lc_originCodeARA         VALUES "ARA".
030970200423       01 TRANSACTION-CATAGORIES.
030980200423          05 TRANS-CATAGORY              PIC X(3).
030990200423             88 PURCHASE-TRANSACTION     VALUES "BUY" "SWI" "TRI" "BAJ".
031000200423             88 PURCHASE-ADJUSTMENT      VALUES "BAJ".
031010200423             88 SWITCH-IN-TRANSACTION    VALUES "SWI" "TRI".
031020200423             88 TRANSFER-IN-TRANSACTION  VALUES "TRI".
031030200423             88 TRANSFER-OUT-TRANSACTION VALUES "TRO".
031040200423             88 REDEMPTION-TRANSACTION   VALUES "SEL" "SWO" "TRO" "SAJ"
031050200423                                                "TFE" "CQD" "FEE".
031060200423             88 REDEMPTION-ADJUSTMENT    VALUES "SAJ".
031070200423             88 FEE-TRANSACTION          VALUES "TFE" "FEE".
031080200423             88 SWITCH-OUT-TRANSACTION   VALUES "SWO" "TRO".
0310902004237721         88 SWO-TRANSACTION          VALUES "SWO".
031100200423      * RFS17180 - Begin
031110200423             88 SWI-TRANSACTION          VALUES "SWI".
031120200423             88 SWO-SWI-TRANSACTION      VALUES "SWO" "SWI".
031130200423      * RFS17180 - End
031140200423             88 DISTRIBUTION-TRANSACTION VALUES "INC" "CPG" "INT" "MFR".
031150200423             88 INCOME-TRANSACTION       VALUES "INC".
031160200423             88 CAPITAL-GAIN-TRANSACTION VALUES "CPG".
031170200423      *RFS 4637 - BEGIN
031180200423             88 CAPITAL-LOSS-TRANSACTION VALUES "CPL".
031190200423      *RFS 4637 - END
031200200423      *RFS 16941 - Begin
031210200423             88 SELL-TRANSACTION         VALUES "SEL".
031220200423      *RFS 16941 - End
031230200423             88 INTEREST-TRANSACTION     VALUES "INT".
031240200423             88 MAN-FEE-REB-TRANSACTION  VALUES "MFR".
031250200423             88 ADJUSTMENT               VALUES "BAJ" "SAJ".
031260200423             88 ADDITION-TRANSACTION     VALUES "BUY" "INC" "CPG" "BAJ"
031270200423                                                "SWI" "TRI" "INT" "MFR".
031280200423             88 REDUCTION-TRANSACTION    VALUES "SEL" "SWO" "TRO"
031290200423                                                "TFE" "CQD" "FEE" "SAJ".
031300200423      * RFS10040 - Begin
031310200423             88 BUY-TRANSACTION          VALUES "BUY".
031320200423      * RFS10040 - End
031330200423             88 VALID-TRANSACTION        VALUES "BUY" "SEL" "SWI"
031340200423                                                "SWO" "TRI" "TRO"
031350200423                                                "CPG" "INC" "INT"
031360200423                                                "TFE" "CQD" "FEE"
031370200423                                                "MFR" "SAJ" "BAJ" "CPL".
031380200423      * RFS14710 - Begin
031390200423             88 SWITCH-TRANSACTION       VALUES "SWO" "TRO"
031400200423                                                "SWI" "TRI".
031410200423      * RFS14710 - End
031420200423      * RFS17685 - Begin
031430200423             88 MM-ADJ-ADD-TRANSACTION   VALUES "BUY" "SWI"
031440200423                                                "MFR" "TRI".
031450200423             88 MM-ADJ-RED-TRANSACTION   VALUES "SEL" "SWO"
031460200423                                                "FEE" "TRO".
031470200423      * RFS17685 - End
031480200423R27609       88 EC-BUY-SELL-TRANSACTION  VALUES "BUY" "SEL".
031490200423
031500200423       01 TRANSACTION-AWD-CATAGORIES.
031510200423          05 TRANS-AWD-CATAGORY          PIC X(1).
031520200423             88 AWD-TRANSACTION          VALUE "Y".
031530200423
031540200423       01 TRANSACTION-STATUS-CATAGORIES.
031550200423          05 TRANS-STATUS-CATAGORY       PIC X(3).
031560200423      *RFS 25053 Begin
031570200423      ***    88 HISTORY                  VALUES "HST".
031580200423             88 HISTORY                  VALUES "HST" "HSC".
031590200423      *RFS 25053 End
031600200423             88 PENDING                  VALUES "PND" "VER" "CHQ".
031610200423             88 CONTRACTED               VALUES "CON".
031620200423             88 UNCONFIRMED              VALUES "UNC".
031630200423             88 CANCELLED                VALUES "CAN".
031640200423             88 SETTLED                  VALUES "SET".
031650200423             88 RVSD                     VALUES "RVS".
031660200423
031670200423       01 TRANSACTION-SPLIT-OPTIONS.
031680200423          05 TRANS-SPLIT-OPTION-CATAGORY PIC X(1).
031690200423             88 PLACED-NO-PRORATE-TYPE   VALUES "F" "M" "T".
031700200423             88 PLACED-FREE-UNITS        VALUES "F".
031710200423             88 PLACED-ALL-UNITS         VALUES "A".
031720200423      *RFS 16760 Begin
031730200423             88 PLACED-LBR-CLAWBACK-FREE VALUES "N".
031740200423             88 PLACED-UNITS             VALUES "U" "N".
031750200423      *RFS 16760 End
031760200423             88 PLACED-DOLLARS           VALUES "$".
031770200423             88 PLACED-CAPITAL-GAIN      VALUES "C".
031780200423             88 PLACED-INCOME            VALUES "I".
031790200423             88 PLACED-DISTRIBUTION      VALUES "D".
031800200423             88 PLACED-PERCENT           VALUES "%".
031810200423             88 PLACED-MATURE-UNITS      VALUES "M".
031820200423             88 PLACED-TOTAL-FREE-UNITS  VALUES "T".
031830200423      *RFS 16760 Begin
031840200423      *RFS 24112 - begin
031850200423      *      88 PLACED-IN-UNITS          VALUES "A" "F" "U" "N".
031860200423             88 PLACED-IN-UNITS          VALUES "A" "F" "U" "N"
031870200423                                                "M" "T".
031880200423      *RFS 24112 - end
031890200423      *RFS 16760 End
031900200423R92145       88 PLACED-IN-UNITS-MFR      VALUES "U".
031910200423
031920200423       01 TRANSACTION-GROSS-NET.
031930200423          05 TRANS-GROSS-NET             PIC X(1).
031940200423             88 PLACED-GROSS             VALUES "G".
031950200423             88 PLACED-NET               VALUES "N".
031960200423
031970200423       01 CDSC-CALC-RULES-LEV88.
031980200423          05 TRANSF-FIN-OR-LIAB          PIC X(1).
031990200423             88 TRANSFER-FINANCER        VALUES "F".
032000200423             88 TRANSFER-LIABILITY       VALUES "L".
032010200423          05 CDSC-IS-PAID-BY             PIC X(1).
032020200423             88 CDSC-PAID-BY-DEALER      VALUES "D".
032030200423             88 CDSC-PAID-BY-UNITHOLDER  VALUES "U".
032040200423          05 CDSC-METHOD88               PIC X(1).
032050200423             88 CDSC-ACCRUED             VALUES "A".
032060200423             88 CDSC-DECLINING           VALUES "D".
032070200423
032080200423       01 FUND-LOAD-CATAGORY.
032090200423          05 FUND-LOAD                   PIC X(1).
032100200423             88 FRONT-END-LOAD           VALUES "N".
032110200423             88 BACK-END-LOAD            VALUES "R".
032120200423             88 OLD-BACK-END-LOAD        VALUES "I"  "E".
032130200423             88 INCLUDE-DISTRIBUTIONS    VALUES "I".
032140200423             88 EXCLUDE-DISTRIBUTIONS    VALUES "E".
032150200423
032160200423       01 TO-FUND-LOAD-CATAGORY.
032170200423          05 TO-FUND-LOAD                   PIC X(1).
032180200423             88 TO-FRONT-END-LOAD           VALUES "N".
032190200423             88 TO-BACK-END-LOAD            VALUES "R".
032200200423             88 TO-OLD-BACK-END-LOAD        VALUES "I" "E".
032210200423             88 TO-INCLUDE-DISTRIBUTIONS    VALUES "I".
032220200423             88 TO-EXCLUDE-DISTRIBUTIONS    VALUES "E".
032230200423
032240200423      *RFS 8058 BEGIN
032250200423       01 FUND-LOAD-CATAGORY.
032260200423          05 FUND-LOAD-D                 PIC X(1).
032270200423             88 FRONT-END-LOAD-D         VALUES "N".
032280200423             88 BACK-END-LOAD-D          VALUES "R".
032290200423             88 OLD-BACK-END-LOAD-D      VALUES "I"  "E".
032300200423             88 INCLUDE-DISTRIBUTIONS-D  VALUES "I".
032310200423             88 EXCLUDE-DISTRIBUTIONS-D  VALUES "E".
032320200423      *RFS 8058 END
032330200423
032340200423       01 TO-HHFEE-CATAGORY.
032350200423          05 TO-HHFEE-TYPE                  PIC X(1).
032360200423             88 TO-HHFEE                    VALUES "Y".
032370200423
032380200423       01 FROM-FUND-LOAD-CATAGORY.
032390200423          05 FROM-FUND-LOAD                 PIC X(1).
032400200423             88 FROM-FRONT-END-LOAD         VALUES "N".
032410200423             88 FROM-BACK-END-LOAD          VALUES "R".
032420200423             88 FROM-OLD-BACK-END-LOAD      VALUES "I" "E".
032430200423             88 FROM-INCLUDE-DISTRIBUTIONS  VALUES "I".
032440200423             88 FROM-EXCLUDE-DISTRIBUTIONS  VALUES "E".
032450200423
032460200423       01 FROM-HHFEE-CATAGORY.
032470200423          05 FROM-HHFEE-TYPE                PIC X(1).
032480200423             88 FROM-HHFEE                  VALUES "Y".
032490200423
032500200423       01 TAX-PROVINCES.
032510200423          05 TAX-PROVINCE-CODE           PIC X(3).
032520200423             88 TAXABLE-PROVINCE         VALUES "QC ".
03253020042344202        88 PROVINCE-ON              VALUES "ON ".
03254020042334309     05 OLD-TAX-PROVINCE-CODE       PIC X(3).
032550200423
032560200423       01 INVESTMENT-TYPES.
032570200423          05 INVESTMENT-TYPE-RULE        PIC X(1).
032580200423             88 GIC-INVESTMENT           VALUES "2".
032590200423             88 DII-INVESTMENT           VALUES "7".
032600200423             88 GIC-DII-INVESTMENT       VALUES "2" "7".
032610200423      * RFS17180 - Begin
032620200423             88 AAP-INVESTMENT            VALUES "3".
032630200423             88 AAH-INVESTMENT            VALUES "4".
032640200423             88 AAP-AAH-INVESTMENT        VALUES "3" "4".
032650200423      * RFS17180 - End
032660200423
032670200423      * RFS9530 - Begin
032680200423          05 INVESTMENT-TYPE-RULE-1      PIC X(1).
032690200423             88 GIC-INVESTMENT-1         VALUES "2".
032700200423             88 DII-INVESTMENT-1         VALUES "7".
032710200423             88 GIC-DII-INVESTMENT-1     VALUES "2" "7".
032720200423          05 INVESTMENT-TYPE-RULE-2      PIC X(1).
032730200423             88 GIC-INVESTMENT-2         VALUES "2".
032740200423             88 DII-INVESTMENT-2         VALUES "7".
032750200423             88 GIC-DII-INVESTMENT-2     VALUES "2" "7".
032760200423      * RFS9530 - End
032770200423
032780200423       01 DISTRIBUTION-OPTIONS.
032790200423          05 DISTRIBUTION-OPTION-CODE    PIC X(1).
032800200423             88 REINVESTED-DISTRIB       VALUES "R".
032810200423             88 CASH-DISTRIB             VALUES "C".
032820200423
032830200423      * RFS20722 - Start
032840200423       01 DISTRIBUTION-OPTIONS-ALL.
032850200423          05 DISTRIB-OPTIONS-ALL         PIC X(1).
032860200423             88 REINVESTED-DISTRIBUTION  VALUES "N".
032870200423      * RFS20722 - End
032880200423
032890200423       01 FUND-TYPE.
032900200423          05 FUND-TYPE-CODE              PIC X(1).
032910200423             88 MONEY-MARKET-FUND        VALUE "F".
032920200423
032930200423      * RFS17685 - Start
032940200423       01 TRADE-TYPE.
032950200423          05 TRADE-TYPE-CODE             PIC X(1).
032960200423             88 BACKDATED-TRADE          VALUE "B".
032970200423
032980200423       01 BACKDATED-CUR-PRV.
032990200423          05 BACKDATED-FLAG              PIC X(1).
033000200423             88 BACKDATED-TO-CUR-MONTH   VALUE "C".
033010200423             88 BACKDATED-TO-PRV-MONTH   VALUE "P".
033020200423
033030200703      *RFS184842 Starts
033040200703       01 GIC-MULTI-INS.
033050200703          05 lc_GICMultiIns              PIC X(1).
033060200703             88 lb_GICMultiInsNo         VALUE "N".
033070200703             88 lb_GICMultiInsYes        VALUE "Y".
033080200703          05 lc_ReadMultiIns             PIC X(1).
033090200703             88 lb_ReadMultiInsNo        VALUE "N".
033100200703             88 lb_ReadMultiInsYes       VALUE "Y".
033110200703      *RFS184842 Ends
033120200703
033130200423      * Copy the Layout of MFAPRCDTP *DTAARA
033140200423       COPY PRCDTWS.
033150200423
033160200423      * This parameters is used to call MMINTR                          RFS10008
033170200423       01 FXMMACCR-PARMS.                                               RFS10008
033180200423          03 LK-ACCOUNT-NO             PIC S9(9).                       RFS10008
033190200423          03 LK-INVESTMENT-CODE        PIC X(5).                        RFS10008
033200200423          03 LK-TRADE-DATE             PIC S9(8).                       RFS10008
033210200423          03 LK-PROCESS-DATE           PIC S9(8).                       RFS10008
033220200423          03 LK-UNIT-AMT               PIC S9(10)V9(3).                 RFS10008
033230200423          03 LK-TRANS-TYPE-CODE        PIC X(3).                        RFS10008
033240200423          03 LK-REVERSAL               PIC X(1).                        RFS10008
033250200423          03 LK-ACCRUAL-AMT            PIC S9(10)V9(5).                 RFS10008
033260200423      * rfs 26666 - start
033270200423          03 LK-INT-AMT                PIC S9(10)V9(5).
033280200507      * rfs 26666 - end
033290200507      * RFS 1021726 - Start
033300200507          03 LK-INTADJINFO             PIC X(10).
033310200507      * RFS 1021726 - End
033320200423      * RFS17685 - End
033330200423
033340200423       01 ASSIGNMENT-TYPE-CD.
033350200423          05 ASSIGNMENT-TYPE-CODE        PIC X(1).
033360200423             88 PAC-ASSIGNMENT           VALUE "B".
033370200423
033380200423       01 TAX-MODE.
033390200423          05 WS-TAX-MODE                PIC X(1).
033400200423             88 TAX-ON-NET              VALUE "N".
033410200423             88 TAX-ON-GROSS            VALUE "G".
033420200423
033430200423      * RFS 10635 BEGIN
033440200423       01 GIC-WITHHOLDING.
033450200423          05 WS-NO-WITHHOLDING          PIC X(1).
033460200423             88 NO-WITHHOLDING          VALUE "Y".
033470200423      * RFS 10635 END
033480200423
033490200423      *RFS 4637 BEGIN
033500200423       01 WS-END-OF-ACI                   PIC X(02)     VALUE SPACES.
033510200423          88 END-OF-ACI                                 VALUE "10".
033520200423          88 KEY-TOO-HIGH                               VALUE "14".
033530200423
033540200423       01 WS-SAVE-CURR-UNIT-BAL           PIC S9(09)V999  VALUE ZEROES.
033550200423       01 WS-CONTRACT-UNIT-PERCENT        PIC 9(09)V9(09) VALUE 0.
033560200423       01 WS-REMAINING-UNITS              PIC S9(09)V999  VALUE ZEROES.
033570200423       01 WS-REMAINING-PERCENT            PIC S9(09)V99   VALUE 100.
033580200423       01 WS-PID-ERROR                    PIC X(01)     VALUE SPACES.
033590200423
033600200423      *    RFS71433 -Begin
033610200423      *    RFS71433.2 -Begin
033620200423      *01 WS-CONTR-REDEM-CODE-NO-FREE     PIC X(02).
033630200423      *   88 lncc_currContrRedemNoFreeDoll    VALUES "2" "3" "5" "15"
033640200423      *                                              "16" "25" "26".
033650200423      *    RFS71433.2 -End
033660200423       01 lc_rdpUpdateFlag                PIC X(1) VALUE SPACES.
033670200423          88 lncc_rdpUpdated         VALUE "Y".
033680200423          88 lncc_rdpNotUpdated      VALUE SPACES.
033690200423
033700200423       01 lc_cppFreeUpdateFlag            PIC X(1) VALUE SPACES.
033710200423          88 lncc_cppFreeUpdated     VALUE "Y".
033720200423          88 lncc_cppFreeNotUpdated  VALUE SPACES.
033730200423
033740200423       01 lc_freeDollStoredFlag           PIC X(1) VALUE SPACES.
033750200423          88 lncc_freeDollStored     VALUE "Y".
033760200423          88 lncc_freeDollNotStored  VALUE SPACES.
033770200423
033780200423       01 lc_tmpFlag                       PIC X(01)   VALUE SPACES.
033790200423          88 lncc_tmpStart                 VALUE SPACE.
033800200423          88 lncc_tmpEnd                   VALUE "1".
033810200423
033820200423       01 ln_arrFreeDollMax          PIC S9(05) COMP-3 VALUE 100.
033830200423       01 Ln_currUnitPrice           PIC S9(05)V9(04) COMP-3 VALUE 0.
033840200423
033850200423       01 ln_clcUnitsFree            PIC S9(10)V9(03) COMP-3.
033860200423       01 ln_totalDollarsFree        PIC S9(11)V9(02) COMP-3.
033870200423       01 ln_totalUnitsFree          PIC S9(10)V9(03) COMP-3.
033880200423       01 ln_currFreeDollars         PIC S9(11)V9(02) COMP-3.
033890200423       01 ln_currFreeUnits           PIC S9(10)V9(03) COMP-3.
033900200423       01 ln_currFreeDollarsTakenDown PIC S9(11)V9(02) COMP-3.
033910200423       01 ln_currFreeUnitsTakenDown    PIC S9(10)V9(03) COMP-3.
033920200423       01 ln_tmpCurrUnitBal         PIC S9(10)V9(03) COMP-3.
033930200423       01 ln_tmpCurrUnitsFree       PIC S9(10)V9(03) COMP-3.
033940200423       01 Ln_tmpUnitPrice           PIC S9(05)V9(04) COMP-3 VALUE 0.
033950200423       01 ln_availFreeUnits         PIC S9(10)V9(03) COMP-3.
033960200423       01 ln_coverUnits             PIC S9(10)V9(03) COMP-3.
033970200423
033980200423       01 Lc_currfinancerCode       PIC X(03).
033990200423       01 lc_arrFlag                PIC X(01) VALUE SPACES.
034000200423          88 lncc_arrStart          VALUE SPACES.
034010200423          88 lncc_arrEnd            VALUE "1".
034020200423
034030200423       01 lc_freedollUpdateFlag     PIC X(01) VALUE SPACE.
034040200423          88  lncc_freeDollUpdate     VALUE "Y".
034050200423          88 lncc_freeDollNoUpdate    VALUE SPACES.
034060200423
034070200423       01 lc_freeDollTypeFlag       PIC X(03) VALUE SPACES.
034080200423          88 lncc_freeDollTypeBuy          VALUE SPACE.
034090200423          88 lncc_freeDolltypeSwi          VALUE "SWI".
034100200423          88 lncc_freeDollTypeDistr        VALUE "DST".
034110200423          88 lncc_freeDollTypeSell         VALUE "SEL".
034120200423
034130200423       01 ln_arrCnt                 PIC S9(05) COMP-3 VALUE 0.
034140200423       01 ln_currFreeUnitsTakenDownAdj    PIC S9(10)V9(03) COMP-3.
034150200423
034160200423
034170200423       COPY CPFREEDU.
034180200423
034190200423       COPY CPLOADFRD.
034200200423
034210200423
034220200423       01 lc_DSCDOLFlag             PIC X(01) VALUE SPACE.
034230200423          88 lncc_DscDolYes         VALUE "Y".
034240200423          88 lncc_DscDolNo          VALUE "N".
034250200423
03426020042392456  01 lc-ByPassTran             PIC X(01) VALUE SPACE.
03427020042392456     88 lb-ByPassTran          VALUE "Y".
034280200423
034290200423       01  lc_DSCSetup.
034300200423           03  lc_EditCodeDSCScreenCode    PIC X(8) value "TRNPST".
034310200423           03  lc_EditCodeDSCEditCode      PIC X(6) value "DSCDOL".
034320200423           03  lc_EditCodeDSCLevel         PIC X    value "A".
034330200423
034340200423      *    RFS71433.4 - Begin
034350200423       01  lc_FreeChrgInvFinUnitsFlag     PIC X(01) VALUE SPACES.
034360200423           88 lncc_FreeChrgInvFinUnitsNo            VALUE SPACES.
034370200423           88 lncc_FreeChrgInvFinUnitsYes           VALUE "Y".
034380200423
034390200423       01  ln_tmpFcUnitBal          PIC S9(10)V9(3) COMP-3 VALUE 0.
034400200423       01  ln_fcCntMax              PIC S9(03) COMP-3 VALUE 100.
034410200423       01  ln_fcCntLast             PIC S9(03) COMP-3 VALUE 0.
034420200423
034430200423       01  lc_fcFreeChargeableArray.
034440200423           03 lc_fcFreeChargeableArr OCCURS 100 Indexed by ln_fcCnt.
034450200423              05 lc_fcFinancerCode         PIC X(03).
034460200423              05 ln_fcFreeUnits            PIC S9(10)V9(03) COMP-3.
034470200423              05 ln_fcUnitBal              PIC S9(10)V9(03) COMP-3.
034480200423              05 ln_fcApplyFreeUnits       PIC S9(10)V9(03) COMP-3.
034490200423              05 ln_fcApplyChrgUnits       PIC S9(10)V9(03) COMP-3.
034500200423
034510200423      *    RFS71433.4 -End
034520200423
034530200423      *    RFS71433 -End
034540200423
034550200423      * RFS92475 - Start.
034560200423       01 ln_Array-size                   PIC S9(09).
034570200423       01 Lr-Fee-Exclusions-Array.
034580200423           03 Fee-Exclusions-Array OCCURS 1 TO 30000
034590200423                             DEPENDING ON ln_Array-Size
034600200423                             INDEXED BY CRRIDX.
034610200423              05 Fee-Exclusions-Element.
034620200423              10 lc_Fee-Acct-Type-Code    PIC X(5).
034630200423              10 lc_Fee-Contr-Redem-Rule  PIC X(2).
034640200423              10 lc_Fee-Charge-Code       PIC X(4).
034650200423      * RFS92475 - End.
034660200423
034670200423      * RFS 52265 - begins.
034680200423       01 ln_TrnExemptArray-size          PIC S9(09).
034690200423       01 Lr-Trans-Type-Exemption-Array.
034700200423           03 Trans-Type-Exemption-Array OCCURS 1 TO 30000
034710200423                             DEPENDING ON ln_TrnExemptArray-Size
034720200423                             INDEXED BY TRNIDX.
034730200423              05 Trans-Type-Exemption-Element.
034740200423              10 lr_Trans-Type-Code       PIC X(3).
034750200423              10 lr_Trans-Sub-Type        PIC X(5).
034760200423              10 lr_Trans-Origin-Code     PIC X(3).
034770200423              10 lr_Exemption-Rule        PIC X(2).
034780200423115495        10 lr_Account-Type-Code     PIC X(5).
034790200423      * RFS 52265 - ends.
034800200423
034810200423      *RFS 13829 Begin
034820200423       01 WS-REC-ACIDB-EXISTS             PIC X(01)     VALUE SPACES.
034830200423       01 WS-ASSOCIATED-CONTRACT-FOUND    PIC X(01)     VALUE SPACES.
034840200423       01 WS-ASSOCIATED-CONTRACT          PIC S9(9)     VALUE 0.
034850200423      *RFS 13829 End
034860200423
034870200423       01 WS-CURR-BASE-UNITS              PIC 9(09)V999 VALUE ZEROES.
034880200423
034890200423      *RFS 16812 Begin
034900200423       01 WS-SEGFUND-SWO                  PIC X(01)     VALUE SPACES.
034910200423          88 SWO-IS-A-SEGFUND                           VALUE "Y".
034920200423          88 SWO-NOT-A-SEGFUND                          VALUE "N".
034930200423       01 WS-SAVE-STDF-PLACEMENT-DATE     PIC 9(09)     VALUE ZEROES.
034940200423       01 WS-SAVE-STDF-TRANS-NO           PIC 9(09)     VALUE ZEROES.
034950200423      *RFS 16812 End
034960200423
034970200423       01 WS-TRANSNOS.
034980200423          05 TRANSNO1                   PIC 9(07).
034990200423      *RFS 4637B- END
035000200423
035010200423      * DATA Q TO GET REQUEST  FROM
035020200423       77  DATA-I-NAME              PIC X(10)    VALUE SPACES.
035030200423       77  DATA-I-LIBRARY           PIC X(10)    VALUE SPACES.
035040200423       77  DATA-I-MESSAGE-LEN       PIC S9(5)    COMP-3 VALUE 32762.
035050200423       77  DATA-I-MESSAGE           PIC X(32762) VALUE SPACES.
035060200423       77  DATA-I-WAIT              PIC S9(5)    COMP-3 VALUE -1.
035070200423      * DATA Q TO GET RESPONSE FROM
035080200423       77  DATA-O-NAME              PIC X(10)    VALUE SPACES.
035090200423       77  DATA-O-LIBRARY           PIC X(10)    VALUE SPACES.
035100200423       77  DATA-O-MESSAGE-LEN       PIC S9(5)    COMP-3 VALUE 2.
035110200423       77  DATA-O-MESSAGE           PIC X(2)     VALUE SPACES.
035120200423       77  DATA-O-WAIT              PIC S9(5)    COMP-3 VALUE -1.
035130200423       77  WS-DATAQ-DISPLACEMENT    PIC S9(5)    VALUE -220.
035140200423
035150200423      ** GIC MOD
035160200423
035170200423      * DATA Q TO GET RESPONSE FROM
035180200423       77  DATA-I-NAME-GIC          PIC X(10)    VALUE "TRNPSTI".
035190200423       77  DATA-I-LIBRARY-GIC       PIC X(10).
035200200423       77  DATA-I-MESSAGE-LEN-GIC   PIC S9(5)    COMP-3 VALUE 100.
035210200423       77  DATA-I-MESSAGE-GIC       PIC X(100)   VALUE SPACES.
035220200423       77  DATA-I-WAIT-GIC          PIC S9(5)    COMP-3 VALUE -1.
035230200423       77  DATA-I-ORDER-GIC         PIC X(2)     VALUE "EQ".
035240200423       77  DATA-I-KEYLEN-GIC        PIC S9(3)    COMP-3 VALUE 40.
035250200423       77  DATA-I-KEY-GIC           PIC X(40)    VALUE SPACES.
035260200423       77  DATA-I-SENDERLEN-GIC     PIC S9(3)    COMP-3 VALUE 0.
035270200423       77  DATA-I-SENDERID-GIC      PIC X(44)    VALUE SPACES.
035280200423      /
035290200423      * DATA Q TO PLACE REQUEST ON
035300200423       77  DATA-O-NAME-GIC          PIC X(10)   VALUE "TRNPSTO".
035310200423       77  DATA-O-LIBRARY-GIC       PIC X(10).
035320200423       77  DATA-O-MESSAGE-LEN-GIC   PIC S9(5)   COMP-3 VALUE 100.
035330200423       77  DATA-O-MESSAGE-GIC       PIC X(100)  VALUE SPACES.
035340200423       77  DATA-O-WAIT-GIC          PIC S9(5)   COMP-3 VALUE -1.
035350200423       77  DATA-O-ORDER-GIC         PIC X(2)    VALUE SPACES.
035360200423       77  DATA-O-KEYLEN-GIC        PIC S9(3)   COMP-3 VALUE 40.
035370200423       77  DATA-O-KEY-GIC           PIC X(40)   VALUE SPACES.
035380200423       77  DATA-O-SENDERLEN-GIC     PIC S9(3)   COMP-3 VALUE 0.
035390200423       77  DATA-O-SENDERID-GIC      PIC X(44)   VALUE SPACES.
035400200423
035410200423      ** END GIC MOD
035420200423
035430200423      ** RFS 13468 BEGIN
035440200423       COPY WS1_UIDX.
035450200423       COPY WS2_UIDX.
035460200423      ** RFS 13468 END
035470200423
035480200423      * RFS21772 - Begin
035490200423       COPY cptrnpst1 REPLACING ==WS-LOCAL-DATA-AREA== BY
035500200423                                ==WS-LOCAL-DATA-AREA==.
035510200423      * RFS21772 - End
035520200423        COPY "SETCDSCCPY".
035530200423      * RFS13839 - End
035540200423
035550200423      * RFS15658 - Begin
035560200423       01 WS-FOREIGN-CONTENT-ELIGIBLE  PIC X.
035570200423      * RFS15658 - End
035580200423
035590200423      * RFS 17117 begin
035600200423       01 FXAH-PARMS.
035610200423          05 FXAH-PLACEMENT-DATE       PIC 9(8).
035620200423          05 FXAH-TRANS-NO             PIC 9(9).
035630200423          05 FXAH-USER                 PIC X(10).
035640200423          05 FXAH-OPER-FLAG            PIC X(1).
035650200423             88 GET-DATA               VALUE "G".
035660200423             88 PUT-DATA               VALUE "P".
035670200423          05 FXAH-TRN-EXISTS           PIC X(1).
035680200423             88 TRN-EXISTS             VALUE "Y".
035690200423          05 FXAH-RETN-CODE            PIC X(2).
035700200423      * RFS 17117 end
035710200423
035720200423      * RFS92475 - Start.
035730200423      * Parms to call the program FXCHKERF.
035740200423       01 li_FXCHKERFPlacementDate       PIC 9(09) COMP-3.
035750200423       01 li_FXCHKERFTransNo             PIC 9(09) COMP-3.
035760200423       01 lc_FXCHKERFReturnCode          PIC X(02).
035770200423      * RFS92475 - End.
035780200423
035790200423      * rfs 27724 - start
035800200423        01 WS-ADJ-DIST-DSC-VARS.
035810200423          05 WS-ADD-PLACEMENT-DATE     PIC S9(9) COMP-3 VALUE 0.
035820200423          05 WS-ADD-TRANS-NO           PIC S9(9) COMP-3 VALUE 0.
03583020042359781 *   05 WS-ADD-CDSC-SEQ-NO        PIC S9(5) COMP-3 VALUE 0.
03584020042359781     05 WS-ADD-CDSC-SEQ-NO        PIC S9(9) COMP-3 VALUE 0.
035850200423      * rfs 27724 - end
035860200423
03587020042326151  01  WS-OTHER-VARIABLES4.
03588020042326151      05 WS-EX-ACCOUNT-TYPE       PIC X(05).
03589020042326151      05 WS-EX-NOM-ACCOUNT-TYPE   PIC X(05).
03590020042326151      05 WS-EX-TRANS-TYPE-CODE    PIC X(03).
03591020042326151      05 WS-EX-TRANS-ORIGIN-CODE  PIC X(03).
03592020042326151      05 WS-EX-REVERSAL-CODE      PIC X(04).
03593020042326151      05 WS-EX-ACCOUNT-ATT-CODE   PIC X(05).
03594020042326151      05 EXCLUDE-TRANS-FLAG       PIC X(01).
035950200423
035960200423      * -- RFS32479 Starts --
035970200423       01 lc-OtherVar.                                                   RFS9932
035980200423          02 lc-InvCode                PIC X(05) VALUE SPACES.           RFS9932
035990200423          02 lc-JurExist               PIC X(01) VALUE SPACES.           RFS9932
036000200423          02 lc-ProCode                PIC X(03) VALUE SPACES.           RFS9932
036010200423          02 lc-ChkFail                PIC X(01) VALUE SPACES.           RFS9932
036020200423      * -- RFS32479 Ends --
036030200423      * RFS32873 - Begin
036040200423       01 lc_namedConstants.
036050200423      * RFS47719 - Begin
036060200423         03 lncc_clcStartDateMax       PIC S9(05) COMP-3 VALUE 99999.
036070200423      * RFS47719 - End
036080200423      * RFS46125 - Begin
036090200423         03 lncc_R                     PIC X(01) VALUE "R".
036100200423      * RFS46125 - End
036110200605         03 lncc_space1                PIC X(01) VALUE SPACES.
036120200423      * RFS32873 - End
036130200423      * RFS33578 - Begin
036140200423         03 lnc_ACWTAX                 PIC X(6)  VALUE "ACWTAX".
036150200423         03 lnc_CAL                    PIC X(3)  VALUE "CAL".
036160200423         03 lnc_T                      PIC X(1)  VALUE "T".
036170200423      * RFS38704 - Begin
036180200423         03 lnc_One                    PIC X(01) VALUE "1".
036190200423      * RFS35909 - Start
036200200423         03 lncc_ALDSC                 PIC X(05) VALUE "ALDSC".
036210200423      * RFS35909 - End
036220200423      * RFS33578 - Ends
036230200423114676   03 lnc_EFTProgramCd           PIC X(08) VALUE "EFTORDER".
03624020042340942    03 lncc_ModuleSEGGLWB         PIC X(10) VALUE "SEGGLWB".
03625020042346707    03 lnci_Rule1                 PIC X(03) VALUE "1  ".
03626020042346707    03 lnci_Rule2                 PIC X(03) VALUE "2  ".
036270200423134535   03 lnci_Rule3                 PIC X(03) VALUE "3  ".
036280200423129478*  03 lnci_Rule4                 PIC X(03) VALUE "4  ".
036290200423129478*  03 lnci_Rule5                 PIC X(03) VALUE "5  ".
036300200423139007   03 lnci_Rule4                 PIC X(03) VALUE "4  ".
036310200423144671   03 lnci_Rule5                 PIC X(03) VALUE "5  ".
036320200605      *RFS185169 STARTS
036330200605         03 lnci_Rule6                 PIC X(03) VALUE "6  ".
036340200605      *RFS185169 ENDS
036350200423
036360200423      *-- RFS43469 Begins
036370200423       01 lc-ReversalRule                 PIC X(01).
036380200423          88 lncc-ReversalRule7           VALUE "7".
036390200423       01 lnc-Variables.
036400200423          03 lnc-Buy                      PIC X(03) VALUE "BUY".
036410200423          03 lnc-Dir                      PIC X(03) VALUE "DIR".
036420200423      *-- RFS43469 Ends
036430200423
036440200423      *-- RFS33712 Begins
036450200423       01 ld-Variables.
036460200423          03 ld-Units-Free                PIC S9(9)V9(3) VALUE 0.
036470200423          03 ld-Curr-Units-Free-Hold      PIC S9(9)V9(3) VALUE 0.
036480200423r48630    03 lc_LoadStructureIn           PIC X(01) VALUE " ".
036490200423r48630    03 lc_LoadStructureOut          PIC X(01) VALUE " ".
036500200423def14     03 lc_InvSeriesIn               PIC X(05) VALUE " ".
036510200423def14     03 lc_InvSeriesOut              PIC X(05) VALUE " ".
036520200423       01 lnc-VariablesA.
036530200423          03 lnc-Yes                      PIC X(01) VALUE "Y".
036540200423          03 lnc-No                       PIC X(01) VALUE "N".
036550200423          03 lnc-T                        PIC X(01) VALUE "T".
03656020042369951     03 lnc-Canada                   PIC X(03) VALUE "CAN".
03657020042369951     03 lc-EOF                       PIC X(01).
03658020042369951        88 lncc-EOF                  PIC X(01) VALUE "Y".
03659020042369951     03 lc-FirstRecord               PIC X(01).
03660020042369951        88 lncc-FirstRecord          PIC X(01) VALUE "Y".
036610200423       01 lc-ERF-Free-On-T                PIC X(01).
036620200423          88 lncc-Erf-Free-On-T           VALUE "Y".
036630200423       01 lc-Waive-For-CDSC-Free          PIC X(01).
036640200423          88 lncc-Waive-For-CDSC-Free     VALUE "Y".
036650200423       01 lc-Notfound                     PIC X(01).
036660200423          88 lncc-Notfound                VALUE "Y".
036670200423      *-- RFS33712 Ends
03668020042344202b*   RFS 44202 Begins
036690200423  |    01 Pass-LIF.
036700200423  |       05 Pass-Account-No-LIF          PIC S9(09).
036710200423  |       05 Pass-Return-Code-LIF         PIC S9(02) VALUE ZEROS.
036720200423  |    01 Pass-LIF-R REDEFINES Pass-LIF.
036730200423  |       05 Pass-Account-No-Char         PIC X(09).
036740200423  |       05 Pass-Return-Code-Char        PIC X(02).
03675020042344202e*   RFS 44202 Ends
036760200423
036770200423      *-- RFS56974 Begins
036780200423       01 lc_SwitchIntoGlwb               PIC X(01).
036790200423          88 SwitchIntoGlwbYes            VALUE "Y".
036800200423      *-- RFS56974 Ends
036810200423      *-- RFS59842 Begins
036820200423       01  li_TFSAAge                           PIC 9(03).
036830200423       01  li_TFSAEffectiveDate                 PIC 9(08).
036840200423       01  lc_ReturnCd                          PIC X(02).
036850200423      *-- RFS59842 Ends
036860200423
03687020042358714  01  lc_Placement_Date              PIC X(09).
03688020042358714  01  lc_Trans_No                    PIC X(09).
036890200423
03690020042364348  01  lc_EffectiveDateRule           PIC X(02)   VALUE SPACES.
03691020042364348  01  lc_FromFundEffectiveDateRule   PIC X(02)   VALUE SPACES.
03692020042364348  01  lc_ToFundEffectiveDateRule     PIC X(02)   VALUE SPACES.
036930200423
036940200423126958 01  lc_keepAccLvlFreeFlag          PIC X(01)   VALUE SPACES.
036950200423126958    88 lncc_keepAccLvlFree            VALUE "Y".
036960200423103858 01  ln_TradeDate                   PIC S9(9)   VALUE ZEROES.
036970200423103858 01  ln_MaturityDate                PIC S9(9)   VALUE ZEROES.
036980200423103858 01  ln_tmpDepositMaturityDate      PIC S9(9)   VALUE ZEROES.
036990200423125695 01  lc_EditSpecific                PIC X(01)   VALUE SPACES.
037000200423127385 01  lc_CreateDummyRDP              PIC X(01)   VALUE SPACES.
037010200423
037020200423      * 51186 begins
037030200423       01  lc-returnCode                  PIC XX.
037040200423       01  lnc_EditCodeACINVGSetup.
037050200423           03  lnc_EditCodeACINVGScreenCode  PIC X(8) value "TRNPST".
037060200423           03  lnc_EditCodeACINVGEditCode    PIC X(6) value "ACINVG".
037070200423           03  lnc_EditCodeACINVGLevel       PIC X    value "A".
037080200423           03  lc_EditCodeACINVGSetupFlag    PIC X    value " ".
037090200423               88  lb_EditCodeACINVGSetupYes          value "Y".
037100200423               88  lb_EditCodeACINVGSetupNo           value "N".
037110200423      * 51186 ends
037120200423
037130200423      * RFS71427 Begins
037140200423       01  lnc_EditCodeSTTFSetup.
037150200423           03  lnc_EditCodeSTTFScreenCode  PIC X(8) value "DLYRPT3".
037160200423           03  lnc_EditCodeSTTFEditCode    PIC X(6) value "STTF".
037170200423           03  lnc_EditCodeSTTFLevel       PIC X    value "T".
037180200423           03  lc_EditCodeSTTFSetupFlag    PIC X    value " ".
037190200423               88  lb_EditCodeSTTFSetupYes          value "Y".
037200200423               88  lb_EditCodeSTTFSetupNo           value "N".
037210200423      * RFS71427 Ends
037220200423
037230200423      * RFS96081 Starts
037240200423
037250200423       01 lc_ScreenCodeOETRNPST           PIC X(8) VALUE "OETRNPST".
037260200423       01 lc_editCodeEWACD                PIC X(6) VALUE "EWACD".
037270200423       01 lc_levelCodeA                   PIC X(1) VALUE "A".
037280200423       01 lc_EWACDFlag                    PIC X(1).
037290200423           88 lncc_EWACDYes               VALUE "Y".
037300200423       01 lb_EWACDExists                  PIC 1.
037310200423           88 lb_EWACDExistsYes           VALUE B"1".
037320200423           88 lb_EWACDExistsNo            VALUE B"0".
037330200423
037340200423      * RFS96081 Ends
037350200423
037360200423      * RFS72268 begins
037370200423       01 lc_Mfaobjects.
037380200423          05 lc_OJLibrary                 PIC X(10) VALUE " ".
037390200423       01 lc_prvOJLibrary                 PIC X(10) VALUE " ".
037400200423      * RFS72268 ends
037410200423
037420200423      * RFS96527 - START
037430200423      * Parm to retrieve Age Res contract start date from data area.
037440200423        01 lc_Mfasegparm.
037450200423          05 FILLER                    PIC X(21).
037460200423          05 lc_Age_Res_Con_St_Date    PIC X(8) VALUE SPACES.
037470200423112944    05 lc_Policy                 PIC X(1) VALUE SPACE.
037480200423121057    05 lc_Seg_Contract_Rule      PIC X(1).
037490200423130780    05 lc_GuarBenEligibleDate    PIC X(8) VALUE SPACES.
037500200423      * RFS185169 STARTS
037510200423          05 FILLER                    PIC X(11).
037520200423          05 Lc_AccountLevelGLWB       PIC X(01).
037530200507             88 Lb_AccountLevelGlwbYes VALUE "Y".
037540200507             88 Lb_AccountLevelGlwbNo  VALUE "N".
037550200423      * RFS185169 ENDS
037560201224
037570201224      * RFS185455 STARTS
037580201224          05 Lc_Accountguarantee       PIC X(01).
037590201224             88 Lb_AccountguaranteeYes VALUE "Y".
037600201224             88 Lb_AccountguaranteeNo  VALUE "N".
037610201224      * RFS185455 ENDS
037620200423
037630200423        01  li_Age_Res_Con_St_Date      PIC S9(8) VALUE ZEROS.
037640200423      * RFS96527 - End
037650200714      * RFS183812 START
037660200714       COPY CPYFXINTRF.
037670200714        01 lc_var.
037680200714          05 lc-TRI                    PIC X(03) VALUE "TRI".
037690200714          05 lc-R                      PIC X(01) VALUE "R".
037700200714          05 lc-B                      PIC X(01) VALUE "B".
037710200714          05 ln-2                      PIC 9(01) VALUE 2.
037720200714          05 lncc_MTAUTTFR             PIC X(10) VALUE "MTAUTTFR".
037730200714          05 lncc_YEAUTTFR             PIC X(10) VALUE "YEAUTTFR".
037740200714          05 lncc_ONAUTTFR             PIC X(10) VALUE "ONAUTTFR".
037750200714      * RFS183812 ENDS
037760200423
037770200423      * -- RFS 64263 begins
037780200423       01  lc-returnCodeDesc              PIC X(65).
037790200423       01  lnc-TRNPST                     PIC X(10) VALUE "TRNPST".
037800200423      * -- RFS 64263 ends
037810200423      *-- RFS68035 Begin
03782020042384456 *01  RDSP-Seq-No                          PIC 9(03).
03783020042384456 *01  Next-RDSP-Seq-No                     PIC 9(03).
037840200423       01  ln_NonTaxableAmount                  PIC S9(11)V9(02) COMP-3.
037850200423       01  ln_CDSPGrantAmount                   PIC S9(11)V9(02) COMP-3.
037860200423       01  ln_CDSPBondAmount                    PIC S9(11)V9(02) COMP-3.
037870200423126482 01  li_CurrentTaxable                    PIC S9(09)V99.
037880200423126482 01  li_ForecastedTaxable                 PIC S9(09)V99.
037890200423126482 01  li_AmountAboveDTCBPA                 PIC S9(09)V99.
037900200423126482 01  li_AmountAboveProvDTCBPA             PIC S9(09)V99.
03791020042384456  01  ln_TotNonTaxableAmount               PIC S9(11)V9(02) COMP-3.
03792020042384456  01  ln_TotCDSPGrantAmount                PIC S9(11)V9(02) COMP-3.
03793020042384456  01  ln_TotCDSPBondAmount                 PIC S9(11)V9(02) COMP-3.
03794020042384456  01  ln_NonTaxableAmount12                PIC S9(11)V9(12) COMP-3.
03795020042384456  01  ln_TotNonTaxableAmount12             PIC S9(11)V9(12) COMP-3.
03796020042384456  01  ln_TotCDSPGrantAmount12              PIC S9(11)V9(12) COMP-3.
03797020042384456  01  ln_TotCDSPBondAmount12               PIC S9(11)V9(12) COMP-3.
03798020042384456  01  ln_TotNonTaxableAmount2R             PIC S9(11)V9(02) COMP-3.
03799020042384456  01  ln_TotCDSPGrantAmount2R              PIC S9(11)V9(02) COMP-3.
03800020042384456  01  ln_TotCDSPBondAmount2R               PIC S9(11)V9(02) COMP-3.
038010200423       01  ln_RDSPGross                         PIC S9(11)V9(02) COMP-3.
038020200423       01  ln_RDSPTotCapital                    PIC S9(11)V9(02) COMP-3.
038030200423       01  ln_RDSPTotGrant                      PIC S9(11)V9(02) COMP-3.
038040200423       01  ln_RDSPTotMV                         PIC S9(11)V9(02) COMP-3.
038050200423       01  ln_RDSPTotBond                       PIC S9(11)V9(02) COMP-3.
038060200423       01  ln_RDSPAHAGrant                      PIC S9(11)V9(02) COMP-3.
038070200423       01  ln_RDSPAHABond                       PIC S9(11)V9(02) COMP-3.
038080200423       01  ln_RDSPActualMV                      PIC S9(11)V9(02) COMP-3.
038090200423       01  ln_RDSPActualGrant                   PIC S9(11)V9(02) COMP-3.
038100200423       01  ln_RDSPActualBond                    PIC S9(11)V9(02) COMP-3.
038110200423      *-- RFS68035 End
03812020042380658  01  Lc_TaxCountryCode                    PIC X(03).
038130200423      *   RFS80658.7
03814020042380658  01  Lc_TaxProvinceCode                   PIC X(03).
038150200423
038160200423180669 01  li_HierGross                         PIC S9(11)V9(02).
038170200423017341 01  li_OutAccountNo                      PIC S9(09) COMP-3.
038180200423
038190200423      *RFS86395-Begin
038200200423       01  lc-TrnaspRecord                      PIC X(01).
038210200423           88  lc-TrnaspRecordYes               Value "Y".
038220200423           88  lc-TrnaspRecordNo                Value "N".
038230200423      *RSF86395-End
038240200423
038250200423      * RFS101832/92499 - Start
038260200423       01 lc-WorkFields1.
038270200423         05  lc-ExchangeRateTypeCAD             PIC X(01) VALUE "S".
038280200423         05  lc-ExchangeRateTypeUSD             PIC X(01) VALUE "B".
038290200423      * RFS101832/RFS92499 - End
038300200423
038310200423      * RFS102778 - Start
038320200423       01  lc-XINRRPTMIN-Parms.
038330200423           03  li_XMINAcctNo                       PIC S9(09).
038340200423           03  lc_XMINInvCde                       PIC  X(05).
038350200423           03  lc_XMINPlanTrans                    PIC  X(05).
038360200423           03  lc_XMINChqType                      PIC  X(03).
038370200423           03  lc_XMINPrdTpRule                    PIC  X(01).
038380200423           03  ln_XMINAmt                          PIC
038390200423                                                   S9(11)V9(02) COMP-3.
038400200423112072     03  ln_XMINDlrCde                       PIC  X(04).
038410200423112072     03  ln_XMINDlrRepCde                    PIC  X(06).
038420200423113777     03  ln_XMINAccAmt                       PIC
038430200423                                                   S9(11)V9(02) COMP-3.
038440200423
038450200423117763     03  lc_XMINOutAccount                   PIC X(09).
038460200423117763     03  lc_OutAccountNo REDEFINES           lc_XMINOutAccount
038470200423                                                   PIC S9(9).
038480200423117763     03  lc_XMINOutTransType                 PIC X(03).
038490200423117763     03  lc_XMINOutTransOrigCode             PIC X(03).
038500200423117763     03  lc_XMINOutContrRedemCode            PIC X(06).
038510200423176315     03  lc-XMIN-Trans-Mode                  PIC X(01).
038520200423176315     03  lc-XMIN-InOut-Data.
038530200423176315        10 lc-XMIN-Trade-Date                PIC 9(08).
038540200423005795        10 lc-XMIN-PlacementDate             PIC 9(08).
038550200423005795        10 lc-XMIN-TrasnNo                   PIC 9(09).
038560200423176315        10 FILLER                            PIC X(22).
038570200423
038580200423117763 01 lc_PurchRejectionCode                    PIC X(03)
038590200423                                                   VALUE  SPACES.
038600200423129525 01 lc_GICCommRejCode                        PIC X(03)
038610200423129525                                             VALUE  SPACES.
038620200423129525 01 lc_TrfCertDtl                            PIC X VALUE SPACE.
038630200423138276 01 lc_OriginTransType                     PIC X(3) VALUE SPACE.
038640200423
038650200423       01  ltb_MinMaxInv.
038660200423           03  ltb_FromInv OCCURS 1000 TIMES
038670200423                           INDEXED BY li_MinIdx.
038680200423               05  ltb_MinMaxInvCode             PIC X(05).
038690200423117763         05  ltb_MinMaxInvStrCode          PIC X(05).
038700200423       01  lnc_Constant.
038710200423           03  lnc_BAL                           PIC X(03) VALUE "BAL".
038720200423           03  lnc_MAX                           PIC X(03) VALUE "MAX".
038730200423           03  lnc_BMO                           PIC X(03) VALUE "BMO".
038740200423           03  lnc_BMX                           PIC X(03) VALUE "BMX".
038750200423           03  lnc_MXO                           PIC X(03) VALUE "MXO".
038760200423           03  lnc_BOT                           PIC X(03) VALUE "BOT".
038770200423           03  lnc_AWD                           PIC X(03) VALUE "AWD".
038780200423           03  lnc_DCA                           PIC X(03) VALUE "DCA".
038790200423117763     03  lnc_DCB                           PIC X(03) VALUE "DCB".
038800200423117763     03  lnc_INI                           PIC X(03) VALUE "INI".
038810200423117763     03  lnc_PAC                           PIC X(03) VALUE "PAC".
038820200423117763     03  lnc_S56                           PIC X(03) VALUE "S56".
038830200423126482     03  lnc_CAN                           PIC X(03) VALUE "CAN".
038840201223180721     03  lcc_9                             PIC  X(1) VALUE "9".
038850200423      * RFS111550 - Start
038860200423           03  lnci_20130101         PIC S9(08) COMP-3 VALUE 20130101.
038870200423           03  lncc_NR301                    PIC X(05) VALUE "NR301".
038880200423      * RFS111550 - End
038890210607113795     03  lncc_81                           PIC X(02) VALUE "81".
038900200423      * RFS117763 - Begins - New Array
038910200423       01  ltb_ACCTYPSPEC.
038920200423           03  ltb_AcctypspecInv OCCURS 2000 TIMES
038930200423                           INDEXED BY li_ATSIdx.
038940200423               05  ltb_ATSStrucCode              PIC X(05).
038950200423               05  ltb_ATSInvCode                PIC X(05).
038960200423       01  li_LastATSidx                         PIC S9(04).
038970200423       01  Lncc_AccTypSpec       PIC X(10) VALUE "ACCTYPSPEC".
038980200423       01  lb_EndOfFile2Flag                      PIC 1.
038990200423           88  lb_EndOfFile2Yes                       VALUE B"1".
039000200423           88  lb_EndOfFile2No                        VALUE B"0".
039010200423       01  lb_StructureFound                      PIC 1.
039020200423           88  lb_StructureFoundYes                   VALUE B"1".
039030200423           88  lb_StructureFoundNo                    VALUE B"0".
039040200423       01  lb_InvFound                            PIC 1.
039050200423           88  lb_InvFoundYes                         VALUE B"1".
039060200423           88  lb_InvFoundNo                          VALUE B"0".
039070200423      * RFS117763 - Ends
039080200423
039090200423       01  lb_EndOfFileFlag                      PIC 1.
039100200423           88  lb_EndOfFileYes                       VALUE B"1".
039110200423           88  lb_EndOfFileNo                        VALUE B"0".
039120200423       01  lb_MinmaxValidflag                    PIC 1.
039130200423           88  lb_MinmaxValidYes                     VALUE B"1".
039140200423           88  lb_MinmaxValidNo                      VALUE B"0".
039150200423      * RFS102778 - End
039160200423      *RFS161542 - Starts
039170200423       01  lc_ScreenEditsAllowedPURDTE.
039180200423           03  lnc_TRNPST-ScreenCode          PIC X(08) Value "TRNPST".
039190200423           03  lnc_PURDTE-EditCode            PIC X(06) Value "PURDTE".
039200200423           03  lnc_T-EditLevel                PIC X(01) Value "T".
039210200423           03  lc_PURDTE-RtnFlag              PIC X(01).
039220200423               88  lc_EditCodePURDTEOn        Value "Y".
039230200423               88  lc_EditCodePURDTEOff       Value "N".
039240200423      *RFS161542 - Ends
039250200423      * RFS111550 - Start
039260200423       01  lc_TaxTreatyFlag   PIC X(01) Value Spaces.
039270200423           88  lb_TaxTreatyYes                    VALUE "Y".
039280200423           88  lb_TaxTreatyNo                     VALUE "N".
039290200423       01  lc_LinkNoteNoNRTax PIC X(01) Value Spaces.
039300200423           88  lb_LinkNoteNoNRTax                 VALUE "Y".
039310200423      * RFS111550 - End
039320200423      * RFS91272 - Begin
039330200423       01  ln_CDSPRolloverAmount               PIC S9(11)V9(02) COMP-3.
039340200423       01  ln_TotCDSPRolloverAmount            PIC S9(11)V9(02) COMP-3.
039350200423       01  ln_TotCDSPRolloverAmount2R          PIC S9(11)V9(02) COMP-3.
039360200423       01  ln_TotCDSPRolloverAmount12          PIC S9(11)V9(12) COMP-3.
039370200423       01  ln_RDSPTotrollover                  PIC S9(11)V9(02) COMP-3.
039380200423      * RFS91272 - End
039390200423      * RFS112133 begin
039400200423       01 ln_CutOffGainDate           PIC S9(08) VALUE 0.
039410200423       01 ln_Gain                     PIC S9(11)V99 COMP-3 VALUE 0.
039420200423Q31514*01 ln_tmpUnitsTakenDown        PIC S9(10)V999 COMP-3 VALUE 0.
039430200423       01 ln_totAccrInterest          PIC S9(11)V99 COMP-3 VALUE 0.
039440200423       01 lc_SwitchOutNLFlag          PIC X(02).
039450200423          88 lncc_SwitchOutBlank      VALUE "  ".
039460200423          88 lncc_SwitchOutNL         VALUE "NL".
039470200423      * RFS112133 end
039480200423      * RFS17180 - Begin
039490200423      * RFS121245- Begin
039500200423        01 lc_AccMiscDtlLock                   PIC X(1)  VALUE SPACES.
039510200423           88 lncc_AccMiscDtlLockOn VALUE  "Y".
039520200423      * RFS121245- End
039530200423      * RFS108486 - Start
039540200423        01 lc_RDSPDSCWorkfile                  PIC X(1) VALUE SPACES.
039550200423           88 lb_RDSPDSCExistsYes              VALUE "Y".
039560200423           88 lb_RDSPDSCExistsNo               VALUE "N".
039570200423        01 li_RDSPDSCMax                       PIC S9(9)V9(2) VALUE 0.
039580200423        01 li_RDSPDSCTest                      PIC S9(9)V9(2) VALUE 0.
039590200423      * RFS108486 - End
039600200423      * RFS121437 - Start - Add new variables
039610200423        01 Lc_ValidateDealer                   PIC X(04).
039620200423        01 Lc_ValidateDealerRep                PIC X(06).
039630200423        01 Lc_ValidateProvince                 PIC X(03).
039640200423110904  01 Lc-Audit-Log-Ind                    PIC X(02).
039650200423110904  01 Li_ADLInvestor                      PIC S9(09).
039660200423110904  01 Li_ADLAccountNo                     PIC S9(09).
039670200423110904  01 Li_ADLContractNo                    PIC S9(09).
039680200423      * RFS121437 - End
039690200423
039700200423140269 01 lc_GICSequence              PIC X(1) VALUE SPACE.
039710200423140269    88 lb_SkipGICSeqYes                   VALUE "Y".
039720200423140269    88 lb_SkipGICSeqNo                    VALUE "N".
039730200423      * RFS117124 - Begins
039740200423      * Parm to retrieve Instruction Required from MFAGIGPARM data area
039750200423        01 lc_MfaGicParm.
039760200423          05 FILLER                    PIC X(4).
039770200423          05 lc_InstrReq               PIC X(1) VALUE SPACES.
039780200423140269    05 FILLER                    PIC X(1).
039790200423140269    05 lc_GICACB                 PIC X(1) VALUE SPACE.
039800210625      *RFS1113362 Starts
039810210625140269*      88 lb_GICActACB                    VALUE "2".
039820210625             88 lb_GICActACB                    VALUE "2" "3".
039830210625      *RFS1113362 Ends
039840200423      * RFS117124 - Ends
039850200423      * RFS140269 - Begin
039860200423140269 01 lc_GICMiscFields.
039870200423140269    05 WS-GIC-CRT-MAT-BUY        PIC X(1).
039880200423140269    05 WS-GIC-CRT-INT-BUY        PIC X(1).
039890200423140269    05 WS-GIC-CRT-MAT            PIC X(1).
039900200423140269    05 WS-GIC-CRT-INT            PIC X(1).
039910200423140269    05 WS-GIC-CRT-CERT           PIC X(1).
039920200423140269    05 WS-GIC-CRT-MAT-CERT       PIC X(1).
039930200423140269    05 WS-GIC-MAT-UPD            PIC X(1).
039940200423140269 01 WS-LOCAL-DATA-AREA-BK        PIC X(1024).
039950200423140269 01 CRTCERTC-CertNo              PIC X(11).
039960200423140269 01 CRTCERTC-Rejection           PIC X(27).
039970200423140269 01 JOBGICMAT-MODE               PIC X(3).
039980200423140269 01 JOBGICINT-REJECTION          PIC X(35).
039990200423140269 01 li_RePurPlacement            PIC S9(09).
040000200423140269 01 li_RePurTransNo              PIC S9(09).
040010200423140269 01 lc_RePurflag                 PIC  X(01).
040020200423140269 01 lc_ReCalcINT                 PIC  X(01).
040030200423      * RFS140269 - End
040040200423118636 01 lc_AMDCMDSameFlag          PIC X(01).
040050200423118636    88 lc_AMDCMDSame            VALUE "Y".
040060200423118636    88 lc_AMDCMDDiff            VALUE "N".
040070200423132956 01 lc_WarningCode               PIC X(02) VALUE SPACES.
040080200423
040090200423      *RFS135486 Start
040100200423       01  ln_AccountNum              PIC S9(09) VALUE ZEROES.
040110200423       01  ln_ContractNum             PIC S9(09) VALUE ZEROES.
040120200423       01  ld_StartDate               PIC S9(08) VALUE ZEROES.
040130200423       01  lc_GuarMatSchedCode        PIC  X(05) VALUE SPACES.
040140200423       01  lc_GuarDthSchedCode        PIC  X(05) VALUE SPACES.
040150200423       01  li_TransTradeDate          PIC S9(08) VALUE ZEROES.
040160200423       01  lc_NewContract             PIC  X(01) VALUE SPACES.
040170200423       01  ln_DepositLength           PIC S9(4)  VALUE ZEROES COMP.
040180200423       01  lc_DepositMaturityRule     PIC  X(01) VALUE SPACES.
040190200423       01  lnc_N                      PIC  X(01) VALUE "N".
040200200423       01  lnc_Y                      PIC  X(01) VALUE "Y".
040210200423       01  lnc_O                      PIC  X(01) VALUE "O".
040220200423       01  lnc_2                      PIC  X(01) VALUE "2".
040230201228185455 01  lncc_B                     PIC  X(01) VALUE "B".
040240201228185455 01  lncc_TRNPST                PIC X(06) VALUE "TRNPST".
040250200423      *RFS135486 End
040260200423137627 01  pn_DthAccount              PIC S9(09).
040270200423137627 01  pc_RtnDthPDy               PIC X(01).
040280200423184858 01  pi_est_mode                PIC X(03)  VALUE "EST".
040290200423      *RFS183140 - Begin
040300200423       01  pi_process_mode            PIC X(03)  VALUE "INT".
040310200423       01  pi_InterestAmt             PIC S9(11)V9(2) VALUE 0.
040320200423       01  pi_UnitAmt                 PIC S9(10)V9(3) VALUE 0.
040330200423       01  pi_NetAmt                  PIC S9(11)V9(2) VALUE 0.
040340200423       01  pi_RetnCode                PIC X(02).
040350200423      *RFS183140 - End
040360200423137833 01  li_AccrualAmt              PIC S9(11)V99 VALUE ZEROES.
040370200423138805 01  ln_CertMaturityDate        PIC S9(09) VALUE ZEROES.
040380200423138805 01  ln_ProcessDate             PIC S9(09) VALUE ZEROES.
040390200423138805 01  ln_AMDDate                 PIC S9(09) VALUE ZEROES.
040400200423138805 01  lc_RetnCd                  PIC  X(02) VALUE SPACES.
040410200423167104 01  li_ContractNum             PIC S9(09) VALUE ZEROES.
040420200423
040430200423147066 01 UPDOriginalLWA              PIC X(1) VALUE SPACES.
040440200423147066    88 UPDOriginalLWAYes                 VALUE "Y".
040450200423147066    88 UPDOriginalLWANo                  VALUE "N".
040460200423
040470200423      * RFS156864 - Begin
040480200423       01 lc-InvestmentCode             PIC X(5)  VALUE SPACES.
040490200423       01 lc-FunctionCode               PIC X(10) VALUE "SETPOL".
040500200423       01 lc-InvestmentStructure        PIC X(10) VALUE SPACES.
040510200423       01 lc-DeclareINRSTRF             PIC X(1)  VALUE "Y".
040520200423       01 lc_FirstReadFlag              PIC X(1)  VALUE SPACES.
040530200423          88 lb_FirstReadFoundYes              VALUE "Y".
040540200423          88 lb_FirstReadFoundNo               VALUE "N".
040550200423      * RFS156864 - End
040560200423149620 01  FXGICPRM-PARMS.
040570200423149620   03 ln_Account_No             PIC S9(09) COMP-3.
040580200423149620   03 ln_CertID_No              PIC S9(10) COMP-3.
040590200423149620   03 lc_GICWaive               PIC  X(01).
040600200423149620   03 ln_PenaltyAmt             PIC S9(11)V99.
040610200423149620   03 ln_ReplaceAmt             PIC S9(11)V99.
040620200423149620   03 lc_ErrCode                PIC  X(02).
040630200423168133 01 lc_MatBuyTrade              PIC X(01) VALUE 'N'.
040640210720      *RFS187317 Start
040650210720       01  FXONEDAYOP-PARMS.
040660210720         03 pc_OneDayInvCode          PIC X(05).
040670210720         03 pc_OneDayReturncode       PIC X(02).
040680210720      *RFS187317 End
040690200423      * RFS169270 - Starts
040700200423       01 lc_ACINVG                   PIC X(10) VALUE "ACINVG".
040710200423       01 lc_DeclareINRSTRF           PIC X(01) VALUE "Y".
040720200423       01 lc_InvCdACINVG              PIC X(05) VALUE SPACES.
040730200423       01 lc_InvStrucACINVG           PIC X(05) VALUE SPACES.
040740200423      * RFS169270 - Ends
040750200423      * RFS 114854 STARTS
040760200423      *01 WS_TXWAV                    PIC X(01).
040770200423      *  88 WS_TXWAV_YES              VALUE "Y".
040780200423      *  88 WS_TXWAV_NO               VALUE "N".
040790200423      * RFS 114854 ENDS .
040800200423      * RFS1008937- Starts
040810200423       01 lc_NL-FLAG                  PIC X(3)  VALUE SPACES.
040820200423          88 lb_NL                              VALUE "NL".
040830200423       01 lc_FROM-NL-FLAG             PIC X(3)  VALUE SPACES.
040840200423          88 lb_FROM-NL                         VALUE "NL".
040850200423       01 lc_TO-NL-FLAG               PIC X(3)  VALUE SPACES.
040860200423          88 lb_TO-NL                           VALUE "NL".
040870200423
040880200423       01 lc_CommRecovSchedCode       PIC X(5)  VALUE SPACES.
040890200423          88 lb_CommRecovSchedCodeSpace         VALUE SPACES.
040900200423       01 lc_FromCommRecovSchedCode   PIC X(5)  VALUE SPACES.
040910200423          88 lb_FromCommRecovSchedCodeSpace     VALUE SPACES.
040920200423       01 lc_ToCommRecovSchedCode     PIC X(5)  VALUE SPACES.
040930200423          88 lb_ToCommRecovSchedCodeSpace       VALUE SPACES.
040940200423      * RFS1008937- Ends
040950200423
040960200423      * RFS 1027849 - Start
040970200423      * RFS 182531 - Start
040980200423      *01 li_AddPeriod                PIC S9(2).
040990200423      *01 li_Start_DateD              FORMAT DATE "@Y%m%d".
041000200423      *01 li_Start_Date               PIC S9(8).
041010200423      *01 li_Start_DateC.
041020200423      *   03 li_StartDateYYMM         PIC S9(6).
041030200423      *   03 li_StartDateDD           PIC S9(2).
041040200423      * RFS 182531 - End
041050200423      * RFS 1027849 - End
041060200423
041070200423      * RFS 182531 - Start
041080200423       01 li_AddPeriod                PIC S9(2).
041090200423       01 li_Start_DateD              FORMAT DATE "@Y%m%d".
041100200423       01 li_Start_Date               PIC S9(8).
041110200423       01 li_Start_DateC.
041120200423          03 li_StartDateYYMM         PIC S9(6).
041130200423          03 li_StartDateDD           PIC S9(2).
041140200423      * RFS 182531 - End
041150200615
041160200615      * RFS1020521 STRAT
041170200615       01 RDSPCALCPlacementDate       PIC S9(09).
041180200615       01 RDSPCALCTransNo             PIC S9(09).
041190200615      * RFS1020521 END
041200201224      *RFS186198 START
041210201224       01 lc_InvStrucWorkVars.
041220201224          03 lc_FXSETPOL_Parms.
041230201224             05 li_FXSETPOL_PlacementDate  PIC S9(9) COMP-3 VALUE 0.
041240201224             05 li_FXSETPOL_TransNo        PIC S9(9) COMP-3 VALUE 0.
041250201224             05 lc_FXSETPOL_GuarBeneElig   PIC  X(1) VALUE SPACES.
041260201224             05 lc_FXSETPOL_InvCode        PIC  X(5) VALUE SPACES.
041270201224             05 lc_FXSETPOL_InvStrucCode   PIC  X(5) VALUE SPACES.
041280201224          03 lc_InvStrucCodeofTransInv     PIC  X(5) VALUE SPACES.
041290201224          03 lc_InvStrucCodeOfFirstContInv PIC  X(5) VALUE SPACES.
041300201224      *RFS186198 END
041310200615
041320210216      * RFS1104392 - Start
041330210216       01 lb_SetBackdatedBuyContract  PIC X(1).
041340210216          88 lb_BackdatedBuyContractYes   VALUE "Y".
041350210216          88 lb_BackdatedBuyContractNo    VALUE "N".
041360210216
041370210216       01 pi_STRSMD_AccountNo    PIC S9(09) VALUE ZEROS.
041380210216       01 pc_STRSMD_ContractXref PIC  X(09) VALUE SPACES.
041390210216       01 pd_STRSMD_PassedDate   PIC  9(08) VALUE ZEROS.
041400210216       01 pd_STRSMD_NewDate      PIC  9(08) VALUE ZEROS.
041410210216
041420210216       01  lnc_SetSTRSMDEditCode.
041430210216           03  lnc_UPDCONTScreenCode   PIC X(08) VALUE "UPDCONT".
041440210216           03  lnc_STRSMDEditCode      PIC X(06) VALUE "STRSMD".
041450210216           03  lnc_STRSMDLevel         PIC X(01) VALUE "C".
041460210216           03  lb_STRSMDSetonFlag      PIC X(01) Value Space.
041470210216               88 lb_STRSMDYes         VALUE "Y".
041480210216               88 lb_STRSMDNo          VALUE "N".
041490210216
041500210216      * RFS1104392 - End
041510210216
041511210914      *RFS1117962 Starts
041512210914       01 lc_DBRSTExistFlag           PIC X(1) VALUE " ".
041513210914         88 lc_DBRSTExistYes        VALUE "Y".
041514210914         88 lc_DBRSTExistNo         VALUE "N".
041515210914       01 lc_MBRSTExistFlag           PIC X(1) VALUE " ".
041516210914         88 lc_MBRSTExistYes        VALUE "Y".
041517210914         88 lc_MBRSTExistNo         VALUE "N".
041518210914       01 lc_rstattributes            PIC X(05) VALUE " ".
041519210914       01 lncc_DBRST                  PIC X(05) VALUE "DBRST".
041520210914       01 lncc_MBRST                  PIC X(05) VALUE "MBRST".
041521210914      *RFS1117962 Ends
041522210914
041523210216180708 01 WS-PLACEMENTDATE           PIC S9(09) VALUE 0.
041530210216180708 01 WS-TRANSNO                 PIC S9(09) VALUE 0.
041540210720      * RFS1114811 - Begins
041550210720       01 lc_TranSts                 PIC X(03)  VALUE SPACES.
041560210720      * RFS1114811 - Ends
041570210112
041580210624      * RFS1115261 Starts
041590210624        01 ACCOUNT-CONTRACT1-REC.
041600210624                      COPY DD-ALL-FORMATS OF MFAACCONP.
041610210624        01 TRANS-CONTRACT-DTL-REC.
041620210624                      COPY DD-ALL-FORMATS OF MFATRCODP.
041630210701        01 li_TransContPlacementDate PIC S9(09) VALUE 0.
041640210701        01 li_TransContTransNo       PIC S9(09) VALUE 0.
041650210624      * RFS1115261 Ends
041660210624
041670200423      * =================================
041680200423      * Copy Books - Begin
041690200423      * =================================
041700210112       COPY CPWSYSPARM.
041710200423       COPY CPAAAINV REPLACING ==COMM-PARAMETERS== BY
041720200423                               ==COMM-CPAAAINV-PARAMETERS==.
041730200423      * RFS17813 - Begin
041740210112       COPY CPBASCUR.
041750200423      * RFS17813 - End
041760200423      * RFS5512 - Begin
041770200423       COPY CPOELOGSP.
041780200423      * RFS5512 - End
041790200423      * RFS20711 - Begin
041800200423       COPY CPCERTTX.
041810200423      * RFS20711 - End
041820200423      * RFS22180 - Begin
041830200423       COPY CPINVDAT REPLACING ==COMM-PARAMETERS== BY
041840200423                               ==COMM-CPINVDAT-PARAMETERS==.
041850200423      * RFS22180 - End
041860200423      * RFS15626 - Begin
041870200423      * Copybook - for Grace Period
041880200423       COPY "CPLSGPPP".
041890200423      * Copybook - for Grace DSC Period
041900200423       COPY "CPLGRDSP".
041910200423      * RFS15626 - End
041920200423      * RFS25821 - Begin
041930200423       COPY "CPPHCUB".
041940200423      * RFS25821 - End
041950200423      * RFS32873 - Begin
041960200423       COPY "cpgetinvsw".
04197020042332873  COPY "Cpchksegat".
041980200423      * RFS32873 - End
04199020042333578  COPY CPYTAXPRP.
04200020042340942  COPY CPYGLWBVLD.
04201020042344930  COPY CPACCANUIT.
04202020042346707  COPY CPGLWBRULE.
04203020042384063 *COPY CPGLWBCKTT.
04204020042384063  COPY CPCKFEETRN.
04205020042346707  COPY CPCNTMATAG.
04206020042359842  COPY CPTFSADAT.
04207020042358714  COPY CPYIOERR.
04208020042356471  COPY CPSPIARULE.
042090200423139286 COPY CPPOANRULE.
04210020042354661  COPY CPUPRLTAX.
04211020042354431  COPY CPRDSPCHK.
04212020042368035  COPY CPCHKDAP.
04213020042380658  COPY CPYRDSAHA.
04214020042380658  COPY CPGETMKVT.
04215020042396081  COPY CPYFXGWRE.
042160200423111550 COPY CPYNONTRTY.
042170200423108944 COPY CPYVALCONT.
042180200423126805 COPY CPGICRD.
042190200423138805 COPY DRTRMDTLS.
042200200423      * RFS140721 - Start - commented out the copybook
042210200423136956*COPY CPTRNFRD.
042220200423      * RFS140721 - end
042230200423153983 COPY CPYCHKCON.
042240200428185170 COPY CPACCGLWBD.
042250200704184842 COPY CPCKMULGIC.
042260201224185455 COPY CPFXRESETD.
042270201224
042280200423      * =================================
042290200423      * Copy Books - End
042300200423      * =================================
042310200423      * RFS17180 - End
042320200423
042330200423       LINKAGE SECTION.
042340200423      * RFS21772 - Begin - Placed Linkage to Copybook
042350200423       COPY cptrnpst REPLACING ==PASS-PARAMETERS== BY
042360200423                               ==PASS-PARAMETERS==.
042370200423      * RFS21772 - End
042380200423      /
042390200423       PROCEDURE DIVISION USING PASS-PARAMETERS.
042400200423      ******************************************************************
042410200423      *    P R O C E D U R E   D I V I S I O N                         *
042420200423      ******************************************************************
042430200423      /
042440200423       MAINLINE SECTION.
042450200423      ******************************************************************
042460200423      *    M A I N   L I N E                                           *
042470200423      ******************************************************************
042480200423
042490200423       ML-0000.
042500200423           PERFORM INITIAL-LOGIC.
042510200423           IF CURR-CONTROLS IS EQUAL TO HIGH-VALUES
042520200423              GO TO ML-1200.
042530200423       ML-0010.
042540200423           PERFORM GET-CURRENT-RECORD.
042550200423           IF CURR-CONTROLS IS EQUAL TO HIGH-VALUES
042560200423              GO TO ML-1200.
042570200423
042580200423           PERFORM DETAIL-PROCESSING.
042590200423           GO TO ML-0010.
042600200423       ML-1200.
042610200423           PERFORM END-JOB.
042620200423      * RFS13839 - Begin
042630200423           GOBACK
042640200423      * RFS13839 - End
042650200423           STOP RUN.
042660200423      /
042670200423       GET-CURRENT-RECORD SECTION.
042680200423      ******************************************************************
042690200423      *    G E T   C U R R E N T   R E C O R D   R O U T I N E         *
042700200423      ******************************************************************
042710200423
042720200423       GCR-0000.
042730201001      *RFS1102149 START
042740201001           INITIALIZE WS-REQ-INDIV-CONTRACT.
042750201001      *RFS1102149 END
042760200423      * RFS9530 - Begin
042770200423           SET WS-NEXT-DATE-SWI-NO         TO TRUE
042780200423      * RFS9530 - End
042790200423182952     SET WS-SWITCH-TO-SAME-ACC-NO TO TRUE
042800200423122815*    SET lb_OnlineYes TO TRUE                                     136431
042810200423      * RFS14898 - Begin
042820200423           SET WS-SWITCH-TO-SAME-ACC-INV-NO TO TRUE
042830200423      * RFS14898 - End
042840200423      * RFS17180 - Begin
042850200423           SET WS-ALL-UNITS-TO-OTHER-PH-NO  TO TRUE
042860200423      * RFS17180 - End
042870200423      * RFS19210 - Begin
042880200423           INITIALIZE WS-CURR-PHANTOM
042890200423                      WS-CURR-ACTIVE-INVESTMENT
042900200423                      WS-CURR-ACCOUNT-INV-STATUS
042910200423      * RFS19210 - End
042920200423
042930200423      * RFS12308 - Begin
042940200423           INITIALIZE INVESTMENT-TYPE-RULE-SW-FLAGS
042950200423      * RFS12308 - End
042960200423      * RFS14090 - Begin
042970200423           MOVE ZERO         TO ACCOUNT-NO
042980200423                             OF WS-ACCNT-LEVEL-FREE-HLD-REC.
042990200423      * RFS14090 - End
043000200423           IF PASS-CDSC-CALCULATOR = "Y"
043010200423      * RFS21772 - Begin
043020200423             OR PASS-CDSC-CALCULATOR = "1"
043030200423      * RFS21772 - End
043040200423      * RFS32409 - Start
043050200423             OR PASS-CDSC-CALCULATOR = "2"
043060200423      * RFS32409 - End
043070200423      * RFS50832 - Start
043080200423             OR PASS-CDSC-CALCULATOR = "3"
043090200423      * RFS50832 - End
043100200423             MOVE "C"          TO PASS-CDSC-CALCULATOR
043110200423             PERFORM FORMAT-CDSC-CALC-TRANSACTION
043120200423             GO TO GCR-0010
043130200423           END-IF.
043140200423138770     IF PASS-CDSC-CALCULATOR = "C" AND
043150200423138770        WS-NO-READ = "Y"
043160200423138770          GO TO GCR-0010
043170200423138770     END-IF.
043180200423           IF PASS-CDSC-CALCULATOR = "C"
043190200423             PERFORM UPDATE-CDSC-CALC-PASS-AREA
043200200423             MOVE HIGH-VALUES  TO CURR-CONTROLS
043210200423             GO TO GCR-EXIT
043220200423           END-IF.
043230200423      * rfs 24192 - start
043240200423           IF WS-NDSNRR-NO-READ IS EQUAL TO "Y"
043250200423             GO TO GCR-0010
043260200423           END-IF.
043270200423      * rfs 24192 - end
043280200423           IF WS-NO-READ IS EQUAL TO "Y"
043290200423             GO TO GCR-0010
043300200423           END-IF.
043310200423      **GIC MOD
043320200423      ** The GIC process mode is used as a toggle.  The first time
043330200423      ** the program starts in interactive mode the mode is blank so
043340200423      ** response request is bypassed.  All subsequent occurences of
043350200423      ** the get current routine will trigger a response - RALPH
043360200423
043370200423           IF WS-GIC-PROCESS-MODE IS EQUAL "2"
043380200423             PERFORM UPDATE-INTERACTIVE-DATAQ
043390200423             MOVE "1"        TO WS-GIC-PROCESS-MODE
043400200423           END-IF.
043410200423           IF PASS-CDSC-CALCULATOR = "Q"
043420200423113784*      MOVE "2"        TO WS-GIC-PROCESS-MODE
043430200423             PERFORM LISTEN-INTERACTIVE-DATAQ
043440200423
043450200423             IF CURR-CONTROLS IS EQUAL HIGH-VALUES
043460200423               GO TO GCR-EXIT
043470200423             END-IF
043480200423      * RFS 113784 - Start
043490200423             IF  WS-RL-INSTR-DATE IS NUMERIC
043500200423             AND WS-RL-INSTR-NUM  IS NUMERIC
043510200423              IF NOT lb_MULTDetailEOF
043520200423                IF TRANS-STATUS-CODE OF TRANS-PRIMARY-REC IS NOT EQUAL
043530200423                  "PND" AND "VER" AND "CHQ"
043540200423                   GO TO GCR-0000
043550200423                ELSE
043560200423                   GO TO GCR-0010
043570200423                END-IF
043580200423              ELSE
043590200423                MOVE SPACE TO lc_MULTDetailEOF
043600200423                GO TO GCR-0000
043610200423              END-IF
043620200423             ELSE
043630200423      * RFS 113784 - End
043640200423      *RFS 8470 - begin
043650200423             IF TRANS-STATUS-CODE OF TRANS-PRIMARY-REC IS NOT EQUAL
043660200423             "PND" AND "VER" AND "CHQ"
043670200423               MOVE "NP"     TO WS-REJECTION-CODE
043680200423      * RFS11984 - Begin
043690200423               MOVE "N"      TO WS-PROCESS-GIC-INT-FIRST                RFS11984
043700200423      * RFS11984 - End
043710200423               GO TO GCR-0000
043720200423             END-IF
043730200423             GO TO GCR-0010
043740200423113784       END-IF
043750200423           END-IF.
043760200423      *RFS 8470 - end
043770200423      ** END GIC MOD
043780200423      *RFS 126805 - Begin - Read next record in multi trans detail
043790200423           IF PASS-CDSC-CALCULATOR = "W"
043800200423140269      OR (PASS-CDSC-CALCULATOR = "U" AND lb_SkipGICSeqYes)
043810200423             IF  WS-RL-INSTR-DATE IS NUMERIC
043820200423             AND WS-RL-INSTR-NUM  IS NUMERIC
043830200423               IF NOT lb_MULTDetailEOF
043840200423                 SET lb_Read_Multi_Yes TO TRUE
043850200423                 PERFORM GET-MULTI-TRANS-DETAIL
043860200423                 INITIALIZE WS-GIC-PROCESS-MODE
043870200423                 IF lb_MULTDetailEOF
043880200423                    MOVE SPACE TO lb_Read_Multi_Flag
043890200423                    INITIALIZE WS-RL-INSTR-DATE WS-RL-INSTR-NUM
043900200423                    GO TO GCR-0000
043910200423                 ELSE
043920200423                   GO TO GCR-0010
043930200423                 END-IF
043940200423               END-IF
043950200703             END-IF
043960200423           END-IF.
043970200423      *RFS 126805 - End
043980200423140269* Begin - Check if previous transaction is INT and re-purchase BUY
043990200423140269*         is created.  If yes, process the re-puchase BUY first
044000200423140269     MOVE " "  TO lc_RePurflag.
044010200423167010     MOVE " "  TO lc_Matureflag.
044020200423140269     IF (PASS-CDSC-CALCULATOR = "U" AND lb_SkipGICSeqYes)
044030200423140269       IF li_RePurPlacement > 0 AND li_RePurTransNo > 0
044040200423140269         AND TRANS-TYPE-CODE OF TRANS = "INT"
044050200423140269         AND (TRANS-ORIGIN-CODE OF TRANS = "GIM" OR "GIA")
044060200423140269           PERFORM RTV-REPURCHASE-TXN THRU RRT-EXIT
044070200423140269*  If re-repurchase BUY transaction found, bypass read next trans.
044080200423140269         IF lc_RePurflag = "Y"
044090200423140269             GO TO GCR-0010
044100200423140269           ELSE
044110200423140269             INITIALIZE li_RePurPlacement li_RePurTransNo
044120200423140269         END-IF
044130200423140269       END-IF
044140200423167010       IF ln_GICMATPlaceDate > 0 and ln_GICMATTransno > 0
044150200703      *RFS184842 Starts
044160200703167010*        AND TRANS-TYPE-CODE OF TRANS = "INT"
044170200703               AND (TRANS-TYPE-CODE OF TRANS = "INT" OR
044180200703                      (TRANS-TYPE-CODE OF TRANS NOT = "INT" AND
044190200703                       lb_GICMultiInsYes))
044200200703      *RFS184842 Ends
044210200423167010         AND (TRANS-ORIGIN-CODE OF TRANS = "GIM" OR "GIA")
044220200423167010           PERFORM RTV-MATURITY-TXN THRU RTT-EXIT
044230200423167010         IF lc_Matureflag = "Y"
044240200423167010           GO TO GCR-0010
044250200423167010         ELSE
044260200423167010           INITIALIZE ln_GICMATPlaceDate
044270200423167010                      ln_GICMATTransno
044280200423167010         END-IF
044290200423167010       END-IF
044300200423
044310200423140269     END-IF.
044320200423140269* End
044330200423      * MULTI LOCK MOD
044340200423      *RFS 92145 - Start
044350200423      * Post pending MFR trades generated by a full redemption
044360200423      * before posting the full redemption trade.
044370200423      * Change split option to "A" to redeem all units including MFR.
044380200423           IF lb_MFRTransLoop
044390200423              IF NOT lb_MFRTransEOF
044400200423                 PERFORM READ-MFR-TRANS
044410200423                 IF lb_MFRTransEOF
044420200423                    IF SPLIT-OPTION-CODE OF Ws-Trans-Rec-7 = lncc_U
044430200423                       MOVE lncc_A TO SPLIT-OPTION-CODE
044440200423                                          OF Ws-Trans-Rec-7
044450200423                       MOVE 0 TO UNIT-AMT OF Ws-Trans-Rec-7
044460200423                    END-IF
044470200423                    MOVE Ws-Trans-Rec-7 TO Trans-Rec
044480200423                    MOVE Ws-Trans-Rec-7 TO Ws-Trans-Rec
044490200423                 END-IF
044500200423              END-IF
044510200423              GO TO GCR-0010
044520200423           END-IF.
044530200423      *RFS 92145 - End
044540200423
04455020042368035      IF lb_GroupProcessingNo
04456020042389684 *    IF WS-CURR-CONTR-REDEM-RULE-DAP AND SPEC-MOD-AUTH-RDSP-ON
04457020042389684 *       AND (CONTRACTED OR HISTORY)
04458020042389684      IF SPEC-MOD-AUTH-RDSP-ON AND (CONTRACTED OR HISTORY)
04459020042389684         AND (SWITCH-OUT-TRANSACTION OR SELL-TRANSACTION)
04460020042389684        PERFORM CheckRDSPAcct
04461020042389684        If WS-CURR-CONTR-REDEM-RULE-DAP
04462020042384456         SET lb_GroupAdjustYes  TO  TRUE
044630200423  |           PERFORM SET-DAP-VALUES
04464020042384456         SET lb_GroupAdjustno   TO  TRUE
04465020042389684        End-If
04466020042368035      End-If
044670200423           IF WS-ACCEPT-FROM-DQ = "Y"
044680200423             COMPUTE WS-DATAQ-DISPLACEMENT =
044690200423             WS-DATAQ-DISPLACEMENT + 221
044700200423
044710200423             IF DATA-I-MESSAGE(WS-DATAQ-DISPLACEMENT:221) = SPACES
044720200423                MOVE SPACES  TO DATA-I-MESSAGE
044730200423                CALL "QRCVDTAQ" USING DATA-I-NAME
044740200423                                      DATA-I-LIBRARY
044750200423                                      DATA-I-MESSAGE-LEN
044760200423                                      DATA-I-MESSAGE
044770200423                                      DATA-I-WAIT
044780200423                MOVE 1       TO WS-DATAQ-DISPLACEMENT
044790200423             END-IF
044800200423
044810200423             IF DATA-I-MESSAGE(1:3) = "END"
044820200423               MOVE HIGH-VALUES
044830200423                             TO CURR-CONTROLS
044840200423               GO TO GCR-EXIT
044850200423             END-IF
044860200423
044870200423             MOVE DATA-I-MESSAGE(WS-DATAQ-DISPLACEMENT:221)
044880200423                             TO TRANS-REC
044890210720      * RFS 1114811 - Start
044900210720      * Check transaction just read is already processed.
044910210720      * If yes, go back to read next transaction.
044920210720
044930210720           INITIALIZE lc_TranSts
044940210720           IF PLACEMENT-DATE OF TRANS-REC IS NUMERIC AND
044950210720              TRANS-NO       OF TRANS-REC IS NUMERIC AND
044960210720              TRANS-ORIGIN-CODE OF TRANS-REC = "GIM"
044970210720               PERFORM CHK-TRANS-STATUS THRU CTS2-EXIT
044980210720               IF lc_TranSts = "HST"
044990210720                  GO TO GCR-0000
045000210720               END-IF
045010210720           END-IF
045020210720      * RFS 1114811 - Ends
045030200423           ELSE
045040200423             READ TRANS NEXT RECORD
045050200423               AT END
045060200423               MOVE HIGH-VALUES           TO CURR-CONTROLS
045070200423               GO TO GCR-EXIT
045080200423             END-READ
045090200423           END-IF
045100200423101280      MOVE SPACES TO pc_AccountTypeRule
04511020042389684       If SPEC-MOD-AUTH-RDSP-ON  AND
04512020042389684         (TRANS-TYPE-CODE OF TRANS = "SWO" OR
04513020042389684          TRANS-TYPE-CODE OF TRANS = "TRO" OR
04514020042389684          TRANS-TYPE-CODE OF TRANS = "SEL")
04515020042368035         PERFORM RESET-GROUP-PROCESS
045160200423  |            IF lb_GroupProcessingYes
045170200423  |             PERFORM READ-GROUP-TRANS
045180200423  |            END-IF
045190200423  |         End-If
045200200423  |        ELSE
045210200423  |        PERFORM READ-GROUP-TRANS
04522020042368035      END-IF.
045230200423      * MULTI LOCK MOD END
045240200423180669     INITIALIZE li_HierGross.
045250200423180669     MOVE GROSS-AMT OF TRANS TO li_HierGross.
045260200423       GCR-0010.
045270200423      *RFS 126805 - Begin - process multiple records for GIC maturity
045280200423           IF PASS-CDSC-CALCULATOR = "W"
045290200423140269      OR (PASS-CDSC-CALCULATOR = "U" AND lb_SkipGICSeqYes)
045300200423137837*      IF TRANS-STATUS-CODE OF TRANS = "CHQ"
045310200423140269*137837       IF TRANS-STATUS-CODE OF TRANS = "PND"
045320200423140269       IF (PASS-CDSC-CALCULATOR = "W"
045330200423140269         AND TRANS-STATUS-CODE OF TRANS = "PND"
045340200423               AND TRANS-TYPE-CODE OF TRANS = "SEL"
045350200423140269*        AND TRANS-ORIGIN-CODE OF TRANS = "MAT"
045360200423140269         AND TRANS-ORIGIN-CODE OF TRANS = "MAT")
045370200423140269        OR
045380200423140269          (PASS-CDSC-CALCULATOR = "U" AND lb_SkipGICSeqYes
045390200423140269           AND (TRANS-STATUS-CODE OF TRANS = "PND" OR "CHQ")
045400200423140269           AND (TRANS-TYPE-CODE OF TRANS =
045410200423140269           "SEL" OR "SWO" OR "TRO"))
045420200423               IF NOT lb_Read_Multi_Yes
045430200423                 PERFORM Get-Product-Type-Rule-1
045440200423                 IF GIC-INVESTMENT
045450200423                    PERFORM Get-Multi-Redemption
045460200423                 END-IF
045470200423               END-IF
045480200423               IF  WS-RL-INSTR-DATE IS NUMERIC
045490200423               AND WS-RL-INSTR-NUM  IS NUMERIC
045500200423                IF NOT lb_MULTDetailEOF
045510200423                  IF TRANS-STATUS-CODE OF TRANS-PRIMARY-REC NOT =
045520200423                    "PND" AND "VER" AND "CHQ"
045530200423                     GO TO GCR-0000
045540200423                  END-IF
045550200423                ELSE
045560200423                  MOVE SPACE TO lc_MULTDetailEOF lb_Read_Multi_Flag
045570200423                  INITIALIZE WS-RL-INSTR-DATE WS-RL-INSTR-NUM
045580200423                  GO TO GCR-0000
045590200423                END-IF
045600200423               END-IF
045610200423             END-IF
045620200423           END-IF.
045630200423      *RFS 126805 - End
045640200423
045650200423      * RFS 16941 Begin
045660200423             PERFORM INITIALIZE-VARIABLES.
045670200423      * RFS 16941 End
045680200423
045690200423      ** RFS177042 - Start **
045700200423      * RFS 35865 Begins
045710200423      *    IF PASS-CDSC-CALCULATOR = "E"
045720200423      *      IF TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL TO "WOR"
045730200423      *         GO TO GET-CURRENT-RECORD
045740200423      *      ELSE
045750200423      *         MOVE "N" TO EC-WOR-FLAG
045760200423      *         PERFORM CHK-AOT-REV
045770200423      *         IF EC-WOR-FLAG = "N"
045780200423      *            GO TO GET-CURRENT-RECORD
045790200423      *         END-IF
045800200423      *      END-IF
045810200423      *    END-IF.
045820200423      * RFS 35865 Ends
045830200423      ** RFS177042 - End   **
045840200423
045850200423      * RFS5512 - Begin
045860200423           PERFORM SAVE-ORIGINAL-TRANS-DATA
045870200423      * RFS5512 - End
045880200423
045890200423      * rfs 24192 - start
045900200423           IF WS-NDSNRR-GENERATED = "2"
045910200423             MOVE WS-NRR-SEL-TRANS
045920200423                               TO TRANS-REC
045930200423             MOVE WS-NRR-TRANS-TARGET
045940200423                               TO TRANS-TARGET-REC
045950200423             MOVE WS-NRR-TRANS-REDEM-DTLS
045960200423                               TO TRANS-REDEM-DETAILS-REC
045970200423             MOVE "1"          TO WS-NDSNRR-GENERATED
045980200423             GO TO GCR-0011
045990200423           ELSE
046000200423             IF WS-NDSNRR-GENERATED = "1"
046010200423                MOVE "0"       TO WS-NDSNRR-GENERATED
046020200423                MOVE "N"       TO WS-NDSNRR-NO-READ
046030200423                GO TO GCR-0011
046040200423             END-IF
046050200423           END-IF.
046060200423      * rfs 24192 - end
046070200423
046080200423           IF WS-INTEREST-GENERATED IS EQUAL TO "3"
046090200423             MOVE WS-TRANS-REC TO WS-TRANS-REC-6
046100200423             MOVE WS-INTEREST-TRANS
046110200423                               TO TRANS-REC
046120200423             MOVE WS-TRANS-INTEREST-DETAILS
046130200423                               TO TRANS-INTEREST-DETAILS-REC
046140200423             MOVE "2"          TO WS-INTEREST-GENERATED
046150200423           ELSE IF WS-INTEREST-GENERATED IS EQUAL TO "2"
046160200423              MOVE WS-TRANS-REC-6
046170200423                               TO TRANS-REC
046180200423
046190200423      *REGET THE ORIGINAL TRANS-STATUS-CODE
046200200423
046210200423              MOVE TRANS-REC   TO TRANS-PRIMARY-REC
046220200423              READ TRANS-PRIMARY WITH NO LOCK
046230200423              NOT INVALID KEY
046240200423                MOVE TRANS-STATUS-CODE OF TRANS-PRIMARY-REC
046250200423                               TO TRANS-STATUS-CODE OF TRANS-REC
046260200423              END-READ
046270200423
046280200423              MOVE "1"         TO WS-INTEREST-GENERATED
046290200423           ELSE IF WS-INTEREST-GENERATED IS EQUAL TO "1"
046300200423              MOVE "0"         TO WS-INTEREST-GENERATED
046310200423              MOVE "N"         TO WS-NO-READ
046320200423           END-IF.
046330200423
046340200423      * rfs 24192 - start
046350200423       GCR-0011.
046360200423      * rfs 24192 - end
046370200423           MOVE TRANS-TYPE-CODE OF TRANS
046380200423                               TO TRANS-CATAGORY.
046390200423
046400200423           MOVE TRANS-STATUS-CODE OF TRANS
046410200423                               TO TRANS-STATUS-CATAGORY.
046420200423      *RFS 10826 BEGIN
046430200423           IF REDEMPTION-TRANSACTION
046440200423      *RFS 16941 Begin
046450200423             OR (PURCHASE-TRANSACTION AND SPEC-MOD-AUTH-ENVTRNSFER)
046460200423      *RFS 16941 End
046470200423             IF REVERSAL-CODE OF TRANS IS NOT EQUAL REVERSAL-CODE
046480200423             OF REVERSAL-REASON
046490200423               MOVE REVERSAL-CODE OF TRANS
046500200423                               TO REVERSAL-CODE
046510200423                               OF REVERSAL-REASON
046520200423               READ REVERSAL-REASON
046530200423               INVALID KEY
046540200423                 MOVE SPACES   TO WS-REVERSAL-CODE-RULES
046550200423                 INITIALIZE    MFARVRP
046560200423               NOT INVALID KEY
046570200423                 MOVE REVERSAL-RULE OF REVERSAL-REASON-REC
046580200423                               TO WS-REVERSAL-CODE-RULES
046590200423               END-READ
046600200423             ELSE
046610200423                 MOVE REVERSAL-RULE OF REVERSAL-REASON-REC
046620200423                               TO WS-REVERSAL-CODE-RULES
046630200423             END-IF
046640200423           ELSE
046650200423             MOVE SPACES         TO WS-REVERSAL-CODE-RULES
046660200423           END-IF.
046670200423      *RFS 10826 END
046680200423           IF HISTORY OR CONTRACTED OR CANCELLED OR RVSD
046690200423             GO TO GET-CURRENT-RECORD
046700200423           END-IF.
046710200423      *RFS 18281 Begin
046720200423      **   Bypass specific rejected trades
046730200423           MOVE REJECTION-CODE OF TRANS TO REJ-TRANS-CODE.
046740200423           IF REJ-BYPASS-TRN-SPECIFIC
046750200423              GO TO GET-CURRENT-RECORD
046760200423           END-IF.
046770200423      *RFS 18281 End
046780200423
04679020042352265      MOVE SPACES TO lc_Trans_Sub_Type.
046800200423      *RFS 92456 Start
046810200423           IF REJ-TRANS-CODE = "12"
04682020042352265         OR FEE-TRANSACTION
046830200423              INITIALIZE MFATRNMSCP OF TRANS-MISC-DETAILS-REC
046840200423              MOVE PLACEMENT-DATE OF TRANS TO
046850200423                   PLACEMENT-DATE OF TRANS-MISC-DETAILS
046860200423              MOVE TRANS-NO OF TRANS TO TRANS-NO OF TRANS-MISC-DETAILS
046870200423
046880200423              READ TRANS-MISC-DETAILS
046890200423              INVALID KEY
046900200423                MOVE SPACE TO lc-ByPassTran
04691020042352265                         lc_Trans_Sub_Type
046920200423              NOT INVALID KEY
046930200423                MOVE OVER-TOLERANCE OF TRANS-MISC-DETAILS TO
046940200423                                             lc-ByPassTran
04695020042352265           MOVE TRANS-SUB-TYPE OF TRANS-MISC-DETAILS TO
04696020042352265                                        lc_Trans_Sub_Type
046970200423              END-READ
04698020042352265      END-IF.
046990200423
04700020042352265      IF REJ-TRANS-CODE = "12"
047010200423              IF lb-ByPassTran
047020200423                GO TO GET-CURRENT-RECORD
047030200423              END-IF
047040200423           END-IF.
047050200423      *RFS 92456 End
047060200423
047070200423      ** RFS177042 - Start **
047080200423           IF PASS-CDSC-CALCULATOR = "E"
047090200423      * RFS 1027849 - Start
047100200423      * RFS 1016245 - Start
047110200423      *       IF WS-INTEREST-GENERATED = "2"
047120200423      *          CONTINUE
047130200423      *       ELSE
047140200423      * RFS 1016245 - End
047150200423      * RFS 1027849 - End
047160200423
047170200423      * RFS 1016245 - Start
047180200423              IF WS-INTEREST-GENERATED = "2"
047190200423                 CONTINUE
047200200423              ELSE
047210200423      * RFS 1016245 - End
047220200423             IF TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL TO "WOR"
047230200423                GO TO GET-CURRENT-RECORD
047240200423             ELSE
047250200423                MOVE "N" TO EC-WOR-FLAG
047260200423                PERFORM CHK-AOT-REV
047270200423                IF EC-WOR-FLAG = "N"
047280200423                   GO TO GET-CURRENT-RECORD
047290200423                END-IF
047300200423             END-IF
047310200423      * RFS 1027849 - Start
047320200423      * RFS 1016245 - Start
047330200423      *      END-IF
047340200423      * RFS 1016245 - End
047350200423      * RFS 1027849 - End
047360200423
047370200423      * RFS 1016245 - Start
047380200423             END-IF
047390200423      * RFS 1016245 - End
047400200423           END-IF.
047410200423      ** RFS177042 - End   **
047420200423      *RFS1016152-Starts
047430200423           IF lncc_YesBySKPREJ                    AND
047440200423              REJECTION-CODE OF TRANS not = "  "  AND
047450200423              REJECTION-CODE OF TRANS not = "00"  AND
047460200423              PROCESS-DATE   OF TRANS     = PASS-PROCESS-DATE-9
047470200423                GO TO GET-CURRENT-RECORD
047480200423           END-IF.
047490200423      *RFS1016152-Ends
047500200423
047510200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "U" OR "C"
047520200423      * rfs 24192 - start
047530200423           OR WS-NDSNRR-GENERATED = "1"
047540200423      * rfs 24192 - end
047550200423             GO TO GCR-0015
047560200423           END-IF.
047570200423
047580200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "D"
047590200423RF7804       IF NOT INTEREST-TRANSACTION OR
047600200423RF7804          TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIM"
047610200423               GO TO GET-CURRENT-RECORD
047620200423             END-IF
047630200423           END-IF.
047640200423
047650200423      * RFS 17019 Begin
047660200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "B"
047670200423RF7804       IF TRANS-ORIGIN-CODE OF TRANS IS EQUAL "MFE"
047680200423RF7804           CONTINUE
047690200423             ELSE
047700200423                 GO TO GET-CURRENT-RECORD
047710200423             END-IF
047720200423           END-IF.
047730200423      * RFS 17019 End
047740200423
047750200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "I"
047760200423             IF NOT INCOME-TRANSACTION AND NOT
047770200423             CAPITAL-GAIN-TRANSACTION  AND NOT
047780200423             CAPITAL-LOSS-TRANSACTION
047790200423               GO TO GET-CURRENT-RECORD
047800200423             END-IF
047810200423           END-IF.
047820200423
047830200423      *RFS 7585 - BEGIN
047840200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "V"
047850200423             IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "FEE" OR
047860200423                TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "ADV"
047870200423               GO TO GET-CURRENT-RECORD
047880200423             END-IF
047890200423           END-IF.
047900200423      *RFS 7585 - END
047910200423
047920200423125258 COPY CPYGETCRR.
047930200423
047940200423RF8095     IF PASS-CDSC-CALCULATOR IS EQUAL TO "J"
047950200423RF8095       IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "INT" OR
047960200423RF8095          TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "GIA"
047970200423RF8095         GO TO GET-CURRENT-RECORD
047980200423RF8095       END-IF
047990200423RF8095     END-IF.
048000200423
048010200423RF8095     IF PASS-CDSC-CALCULATOR IS EQUAL TO "L"
048020200423RF8095       IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "BUY" OR
048030200423RF8095          TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "GIA"
048040200423RF8095         GO TO GET-CURRENT-RECORD
048050200423RF8095       END-IF
048060200423RF8095     END-IF.
048070200423
048080200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "Z"
048090200423             IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "SAJ" AND
048100200423                TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "CNS"
048110200423               GO TO GET-CURRENT-RECORD
048120200423             END-IF
048130200423           END-IF.
048140200423
048150200423      *RFS 7720 - BEGIN
048160200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "T"
048170200423             IF (TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "TRO" AND
048180200423                 TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "TRI") OR
048190200423                 TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "RST"
048200200423               GO TO GET-CURRENT-RECORD
048210200423             END-IF
048220200423           END-IF.
048230200423      *RFS 7720 - END
048240200423
048250200423      *RFS 47405 - Begin
048260200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "O"
048270200423             IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "FEE" OR
048280200423                TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "DIR"
048290200423                GO TO GET-CURRENT-RECORD
048300200423             END-IF
048310200423           END-IF.
048320200423      *RFS 47405 - End
048330200423
048340200423      *RFS 163650 Begin
048350200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "S"
048360200423             IF NOT (SWO-SWI-TRANSACTION AND
048370200423                TRANS-ORIGIN-CODE OF TRANS IS EQUAL "DIR"   AND
048380200423                TRANS-STATUS-CODE OF TRANS IS EQUAL "PND"   AND
048390200423               (CONTR-REDEM-CODE OF TRANS IS  EQUAL "AUTSWO" OR
048400200423                CONTR-REDEM-CODE OF TRANS IS  EQUAL "AUTSWI"))
048410200423                GO TO GET-CURRENT-RECORD
048420200423
048430200423             END-IF
048440200423           END-IF.
048450200423      *RFS 163650 End
048460200423
048470200423       GCR-0015.
048480200423
048490200423      *RFS17685 Start
048500200423      *RFS23955 Start
048510200423      *    IF TRADE-DATE OF TRANS < PLACEMENT-DATE OF TRANS
048520200423           IF TRADE-DATE OF TRANS < PASS-PROCESS-DATE-9
048530200423             MOVE "B" TO TRADE-TYPE-CODE
048540200423      *RFS23955 End
048550200423           ELSE
048560200423             MOVE " " TO TRADE-TYPE-CODE
048570200423           END-IF.
048580200423      *RFS17685 End
048590200423
048600200423      * RFS 68035.26 - begins.
04861020042368035 *    If lb_AccountTypeRDSP
048620200423  |   *      If REJECTION-CODE OF TRANS not = "00" and
048630200423  |   *         REJECTION-CODE OF TRANS not = "  "
048640200423  |   *         GO TO GET-CURRENT-RECORD
048650200423  |   *      End-If
048660200423  |   *    Else
048670200423  |   *      MOVE "00"           TO REJECTION-CODE OF TRANS
04868020042368035 *    End-If.
048690200423
048700200423           If lb_AccountTypeRDSP
048710200423             If REJECTION-CODE OF TRANS not = "00" and
048720200423                REJECTION-CODE OF TRANS not = "  "
048730200423                GO TO GET-CURRENT-RECORD
048740200423             End-If
048750200423           End-If.
048760200423
048770200423      *__________________________________________________________*
048780200423      * Do not comment out this move. TRNPST performs the final  *
048790200423      * updates only when rejection-code is set to "00".         *
048800200423      *__________________________________________________________*
048810200423           MOVE "00"           TO REJECTION-CODE OF TRANS.
048820200423      * RFS 68035.26 - ends.
048830200423
048840200423           IF SPLIT-OPTION-CODE OF TRANS = " "
048850200423             MOVE "$"          TO SPLIT-OPTION-CODE OF TRANS
048860200423             MOVE "Y"          TO WS-UPDATE-PRIMARY
048870200423           END-IF.
048880200423
048890200423      *RFS 24112 - begin
048900200423      *    IF SPLIT-OPTION-CODE OF TRANS = "A" OR "U" OR "F" OR "T"
048910200423           IF SPLIT-OPTION-CODE OF TRANS = "A" OR "U" OR "F" OR "T"
048920200423                                               OR "M"
048930200423      *RFS 24112 - end
048940200423             IF REDEMPTION-TRANSACTION
048950200423               IF GROSS-OR-NET OF TRANS IS NOT EQUAL "G"
048951210927      *RFS1119590 Starts
048952210927               AND ((ENTERED-BY OF TRANS IS EQUAL "WITHDHIERC"
048953210927                    AND SPLIT-OPTION-CODE OF TRANS IS NOT EQUAL
048954210927                                                        "M" AND "F")
048955210927                    OR ENTERED-BY OF TRANS IS NOT EQUAL "WITHDHIERC")
048956210927      *RFS1119590 Ends
048960200423                 MOVE "G"        TO GROSS-OR-NET OF TRANS
048970200423                 MOVE "Y"        TO WS-UPDATE-PRIMARY
048980200423               END-IF
048990200423             ELSE
049000200423               IF GROSS-OR-NET OF TRANS IS NOT EQUAL "N"
049010200423                 MOVE "N"        TO GROSS-OR-NET OF TRANS
049020200423                 MOVE "Y"        TO WS-UPDATE-PRIMARY
049030200423               END-IF
049040200423             END-IF
049050200423           END-IF.
049060200423
049070200423           IF FEE-TRANSACTION
049080200423             IF GROSS-OR-NET OF TRANS IS NOT EQUAL "N" AND "G"
049090200423               MOVE "N"          TO GROSS-OR-NET OF TRANS
049100200423               MOVE "Y"          TO WS-UPDATE-PRIMARY
049110200423             END-IF
049120200423           END-IF.
049130200423
049140200423           IF GROSS-OR-NET OF TRANS = " "
049150200423             MOVE "G"          TO GROSS-OR-NET OF TRANS
049160200423             MOVE "Y"          TO WS-UPDATE-PRIMARY
049170200423           END-IF.
049180200423
049190200423       GCR-WRITE-PRIMARY.
049200200423
049210200423           IF WS-UPDATE-PRIMARY IS NOT EQUAL "Y"
049220200423             GO TO GCR-WRITE-CONTINUE
049230200423           END-IF.
049240200423
049250200423           MOVE "N"            TO WS-UPDATE-PRIMARY.
049260200423
049270200423           MOVE TRANS-REC      TO TRANS-PRIMARY-REC.
049280200423
049290200423           READ TRANS-PRIMARY WITH NO LOCK
049300200423           INVALID KEY
049310200423           GO TO GCR-WRITE-CONTINUE.
049320200423
049330200423           MOVE TRANS-REC      TO TRANS-PRIMARY-REC.
049340200423
049350200423           REWRITE TRANS-PRIMARY-REC
049360200423           INVALID KEY
04937020042358714         MOVE "MFATRNP" TO WS-FILE-STATUS-FILE-NAME
04938020042358714         SET lncc_Err001  TO  TRUE
04939020042358714         PERFORM LOG-FILE-STATUS
049400200423           GO TO GCR-WRITE-CONTINUE.
049410200423
04942020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
04943020042358714         MOVE "MFATRNP" TO WS-FILE-STATUS-FILE-NAME
04944020042358714         SET lncc_Err002  TO  TRUE
04945020042358714         PERFORM LOG-FILE-STATUS
04946020042358714      END-IF.
049470200423
049480200423       GCR-WRITE-CONTINUE.
049490200423
049500200423           MOVE TRANS-REC      TO WS-TRANS-REC.
049510200423
049520200423           IF NOT VALID-TRANSACTION
049530200423             MOVE "36"         TO REJECTION-CODE OF TRANS
049540200423             PERFORM RECORD-UPDATES
049550200423
049560200423             GO TO GET-CURRENT-RECORD
049570200423           END-IF.
049580200423
049590200423
049600200423           IF SWITCH-OUT-TRANSACTION
049610200423            PERFORM EVALUATE-WIRE-ORDER-SELL-BUY
049620200423
049630200423              IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
049640200423                PERFORM RECORD-UPDATES
049650200423
049660200423                GO TO GET-CURRENT-RECORD
049670200423              END-IF
049680200423           END-IF.
049690200423
049700200423      * Check to see if this order is the buy portion of a sell-buy
049710200423
049720200423           IF SWITCH-IN-TRANSACTION
049730200423             GO TO GET-CURRENT-RECORD
049740200423           END-IF.
049750200423
049760200423       GCR-EXIT.
049770200423           EXIT.
049780200423      /
049790200423      ** GIC MOD
049800200423
049810200423      * RFS 113784 - Begin
049820200423      * Moved the  UPDATE - INTERACTIVE DATAQ SECTION AND
049830200423      * LISTEN-INTERACTIVE-DATAQ section to the copybook
049840200423      * CPINTDATAQ along with the changes for RFS113784
049850200423
049860200423       COPY CPINTDATAQ.
049870200423
049880200423      * RFS 113784 - End
049890200423      ** END GIC MOD
049900200423      * RFS16941 - Begin
049910200423      /
049920200423       INITIALIZE-VARIABLES SECTION.
049930200423      ******************************************************************
049940200423      *    I N I T I A L I Z E  V A R I A B L E S                      *
049950200423      ******************************************************************
049960200423       IVA-0000.
049970200423           MOVE SPACES      TO WS-FROM-LIBRARY-NAME.
049980200423      * RFS126958 - Start
049990200423           INITIALIZE     lc_keepAccLvlFreeFlag
050000200423      * RFS64348 - Begin
050010200423           INITIALIZE lc_FromFundEffectiveDateRule
050020200423                      lc_ToFundEffectiveDateRule.
050030200423      * RFS64348 - End
050040200423      * RFS16812 - Begin
050050200423           MOVE 'N'        TO WS-SEG-OUT-PROCESSED-FLAG.
050060200423           MOVE SPACES     TO WS-SEGFUND-SWO.
050070200423      * RFS16812 - End
050080200423      * RFS11984 - Begin
050090200423           MOVE "N"          TO WS-PROCESS-GIC-INT-FIRST.
050100200423      * RFS11984 - End
050110200423      * RFS19900 - Begin
050120200423           MOVE "N"          TO WS-UPDATE-LSIF-FILES-BEFORE.
050130200423      * RFS19900 - End
050140200423      * RFS5512 - Begin
050150200423           SET SW-CHECK-REMAINING-BAL-NO   TO TRUE.
050160200423           SET SW-CHANGE-SPLIT-OPTION-NO   TO TRUE.
050170200423      * RFS5512 - End
050180200423      * RFS40845 - Begin
050190200423           INITIALIZE lc_grantTradeFlag
050200200423      * RFS40845 - End
050210200423151731     INITIALIZE li_PercentFree
050220200423      * RFS32873 - Begin
050230200423           INITIALIZE lc_clawbackLLOnFlag
05024020042332873                 lc_clawbackBEOnFlag
050250200423      * RFS42622 - Begin: initialize the flag for every trade record
050260200423                      lc_ipMaturityFlag
050270200423      * RFS42622 - End
050280200423117763                lc_PurchRejectionCode
050290200423129525                lc_GICCommRejCode
050300200423129525                lc_TrfCertDtl
050310200423129787                lc_OptionXFlag
050320200423      * RFS46125 - Begin
050330200423                      lc_deathClaimsFlag.
050340200423      * RFS46125 - End
050350200423      * RFS32873 - End
050360200423112133     SET lncc_SwitchOutBlank TO TRUE.
050370200423      *    RFS71433 -Begin
050380200423           INITIALIZE MFAFICINP OF FINANCER-CDSC-INSTRUCTIONS.
050390200423      *    RFS71433 -End
050400200423      * RFS107031 - Begin
050410200423            INITIALIZE MFAACCONP OF WS-ACCOUNT-CONTRACT.
050420200423      * RFS107031 - End
050430200423       IVA-EXIT.
050440200423      * RFS16941 - End
050450200423       DETAIL-PROCESSING SECTION.
050460200423      ******************************************************************
050470200423      *    D E T A I L   P R O C E S S I N G   R O U T I N E           *
050480200423      ******************************************************************
050490200423       DPR-0000.
050500200423      *---------------------------------------------------------
050510200423      * Process purchase transactions
050520200423      *---------------------------------------------------------
050530200423      * RFS5512 - Begin
050540200423           MOVE "0"               TO WS-PASS-SWITCH-EDIT
050550200423           SET SW-N-PASSES-INIT   TO TRUE
050560200423      * RFS5512 - End
050570200423
050580200423168133     MOVE "N"               TO lc_MatBuyTrade
050590200423R92465     SET lb_AssCarOvr_No To TRUE
050600201223      *RFS180707 - Starts
050610201223           SET lnc_ACINDSCNo   TO TRUE
050620201223           IF ACCOUNT-LEV-DSC
050630201223              PERFORM VERIFY-FUNCTION-CODE
050640201223           END-IF
050650201223      *RFS180707 - Ends
050660200423
050670200423           IF PURCHASE-TRANSACTION
050680200423             AND NOT SWITCH-IN-TRANSACTION
050690200423             PERFORM VALIDATE-TRADE
050700200423
050710200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
050720200423               PERFORM RECORD-UPDATES
050730200423
050740200423               GO TO DPR-EXIT
050750200423             END-IF
050760200423
050770200423             PERFORM PROCESS-BUY
050780200423      * RFS117124 - Start
050790200423           IF REJECTION-CODE OF TRANS NOT EQUAL TO "00"
050800200423              PERFORM RECORD-UPDATES
050810200423           END-IF
050820200423      * RFS117124 - End
050830200423
050840200423             GO TO DPR-EXIT
050850200423           END-IF.
050860200423      *---------------------------------------------------------
050870200423      * Process redemption transactions
050880200423      *---------------------------------------------------------
050890200423
050900200423      * RFS5512 - Begin
050910200423       DPR-START-REDEMPTION.
050920200423      * RFS5512 - End
050930200423           IF REDEMPTION-TRANSACTION
050940200423             AND NOT SWITCH-OUT-TRANSACTION
050950200423      * RFS5512 - Begin
050960200423             EVALUATE WS-PASS-SWITCH-EDIT
050970200423               WHEN "0"
050980200423                 PERFORM SET-REMAINING-BAL-FLAG
050990200423               WHEN "2"
051000200423                 MOVE REJECTION-CODE OF TRANS-REC TO SW-REJECTION-CODE
051010200423                 PERFORM RE-GET-TRANS-PRIMARY
051020200423                 IF NOT SW-REJECTION-CODE-OK
051030200423                   PERFORM RECORD-UPDATES
051040200423                   GO TO DPR-EXIT
051050200423                 END-IF
051060200423                 IF SW-CHANGE-SPLIT-OPTION
051070200423                   PERFORM SET-SPLIT-OPTION-TO-ALL
051080200423                 END-IF
051090200423               WHEN OTHER
051100200423                 CONTINUE
051110200423             END-EVALUATE
051120200423      * RFS5512 - End
051130200423             PERFORM VALIDATE-TRADE
051140200423
051150200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
051160200423               PERFORM RECORD-UPDATES
051170200423
051180200423               GO TO DPR-EXIT
051190200423             END-IF
051200200423             PERFORM PROCESS-SELL
051210200423
051220200423             GO TO DPR-EXIT
051230200423           END-IF.
051240200423      *---------------------------------------------------------
051250200423      * Process wire order buy - sell
051260200423      *---------------------------------------------------------
051270200423      * The switch routine has been modified to insure that the
051280200423      * proceeds of the out transaction are enough to buy at least
051290200423      * .001 units on the in side.  In order to do this the system
051300200423      * has to mimick the switch process.  This is done by putting
051310200423      * the system into calculator mode.  If there is enough money
051320200423      * to do the buy (check ws-insuffic-buy-proceeds) then the
051330200423      * system is taken out of calculator mode and the transaction
051340200423      * proceeds as per normal.  If there is not enough proceeds
051350200423      * then the transaction is rejected.
051360200423      *            pass-switch-edit 1 = calculator mode
051370200423      *            pass-switch-edit 2 = calculator mode complete
051380200423      *---------------------------------------------------------
051390200423
051400200423RCH        MOVE "N"            TO WS-INSUFFIC-BUY-PROCEEDS.
051410200423117763     INITIALIZE          lc_PurchRejectionCode.
051420200423129525     INITIALIZE          lc_GICCommRejCode.
051430200423129525     INITIALIZE          lc_TrfCertDtl.
051440200423
051450200423RCH    DPR-0004.
051460200423      * In non edit mode re-get the transaction
051470200423RCH        IF SWITCH-OUT-TRANSACTION
051480200423RCH        AND  WS-PASS-SWITCH-EDIT = "2"
051490200423RCH          MOVE PLACEMENT-DATE OF TRANS
051500200423RCH                              TO PLACEMENT-DATE OF TRANS-PRIMARY
051510200423RCH          MOVE TRANS-NO OF TRANS
051520200423RCH                              TO TRANS-NO OF TRANS-PRIMARY
051530200423RCH          READ TRANS-PRIMARY WITH NO LOCK
051540200423RCH          MOVE TRANS-PRIMARY-REC
051550200423RCH                              TO TRANS-REC
051560200423RCH                                 WS-TRANS-REC
051570200423             MOVE TRANS-STATUS-CODE OF TRANS
051580200423                                 TO TRANS-STATUS-CATAGORY
051590200423      * RFS5512 - Begin
051600200423             IF SW-CHANGE-SPLIT-OPTION
051610200423               PERFORM SET-SPLIT-OPTION-TO-ALL
051620200423             END-IF
051630200423      * RFS5512 - End
051640200423RCH        END-IF.
051650200423RCH
051660200423      * RFS13383 - Begin
051670200423           IF SWITCH-OUT-TRANSACTION
051680200423             IF WS-PASS-SWITCH-EDIT = "0"
051690200423      * RFS117763 - Start
051700200423                MOVE "1"               TO WS-PASS-SWITCH-EDIT
051710200423                SET SW-N-TWO-PASSES    TO TRUE
051720200423      * RFS117763 - End
051730200423      * RFS117763 - Begin
051740200423      *        IF (SPLIT-OPTION-CODE OF TRANS = "$"  AND
051750200423      *            GROSS-OR-NET      OF TRANS = "G"  AND
051760200423      *            GROSS-AMT OF TRANS   >= LT-AMT-TO-CHECK)    OR
051770200423      *           (SPLIT-OPTION-CODE OF TRANS = "$"  AND
051780200423      *            GROSS-OR-NET      OF TRANS = "N"  AND
051790200423      *            NET-AMT OF TRANS   >= LT-AMT-TO-CHECK)      OR
051800200423      *           (SPLIT-OPTION-CODE OF TRANS = "U"  AND
051810200423      *            UNIT-AMT OF TRANS   >= LT-UNITS-TO-CHECK)
051820200423      *          MOVE "2"               TO WS-PASS-SWITCH-EDIT
051830200423      *          SET SW-N-ONE-PASS      TO TRUE
051840200423      *        ELSE
051850200423      *          MOVE "1"               TO WS-PASS-SWITCH-EDIT
051860200423      *          SET SW-N-TWO-PASSES    TO TRUE
051870200423      *        END-IF
051880200423      * -----------------------------------------------------------
051890200423      * RFS117763 - End
051900200423      * RFS92145 - Start
051910200423               IF lb_MFRTransLoop  AND
051920200423                  SPLIT-OPTION-CODE OF TRANS = "A"
051930200423                 MOVE "2"               TO WS-PASS-SWITCH-EDIT
051940200423                 SET SW-N-ONE-PASS      TO TRUE
051950200423               END-IF
051960200423      * RFS92145 - End
051970200423      * RFS5512 - Begin
051980200423               PERFORM SET-REMAINING-BAL-FLAG
051990200423      * RFS5512 - End
052000200423             END-IF
052010200423           END-IF.
052020200423      * RFS13383 - End
052030200423
052040200423RCH    DPR-0005.
052050200423
052060200423           IF SWITCH-OUT-TRANSACTION
052070200423
052080200423RCH          IF WS-INSUFFIC-BUY-PROCEEDS = "Y"
052090200423RCH            MOVE TRANS-REC
052100200423RCH                          TO TRANS-PRIMARY-REC
052110200423RCH            READ TRANS-PRIMARY WITH NO LOCK
052120200423RCH            MOVE TRANS-PRIMARY-REC
052130200423RCH                          TO TRANS-REC
052140200423RCH            MOVE TRANS-REC
052150200423RCH                          TO WS-TRANS-REC
052160200423      *RFS124505 - Start
052170200423RCH   *        MOVE "50"     TO REJECTION-CODE OF TRANS-REC
052180200423               IF lc_PurchRejectionCode = lnc_S56
052190200423129525           OR lc_GICCommRejCode Not = " "
052200200423                 MOVE "12"     TO REJECTION-CODE OF TRANS-REC
052210200423               ELSE
052220200423                 MOVE "50"     TO REJECTION-CODE OF TRANS-REC
052230200423               END-IF
052240200423      *RFS124505 - End
052250200423RCH          ELSE
052260200423               PERFORM VALIDATE-TRADE
052270200423RCH          END-IF
052280200423
052290200423             IF REJECTION-CODE OF TRANS-REC IS EQUAL "00"
052300200423               MOVE CURRENCY-DDS OF INVESTMENT
052310200423                               TO WS-OUT-CURRENCY
052320200423               MOVE PRODUCT-TYPE-CODE OF INVESTMENT
052330200423                               TO WS-OUT-PRODUCT-TYPE
052340200423               IF WS-OUT-CURRENCY IS NOT EQUAL TO WS-IN-CURRENCY
052350200423                 PERFORM GET-OFFSET-EXCHANGE-RATE
052360200423
052370200423               END-IF
052380200423             END-IF
052390200423
052400200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
052410200423               PERFORM RECORD-UPDATES
052420200423
052430200423               PERFORM GET-SELL-BUY-TARGET
052440200423      *RFS124505 - Start
052450200423      *        MOVE "13"       TO REJECTION-CODE OF TRANS
052460200423               IF lc_PurchRejectionCode = lnc_S56
052470200423                 MOVE lc_PurchRejectionCode
052480200423                               TO REJECTION-CODE OF TRANS-REC
052490200423               ELSE
052500200423129525          IF lc_GICCommRejCode Not = " "
052510200423129525             MOVE lc_GICCommRejCode
052520200423129525                  TO REJECTION-CODE OF TRANS-REC
052530200423129525          ELSE
052540200423                 MOVE "50"     TO REJECTION-CODE OF TRANS-REC
052550200423129525          END-IF
052560200423               END-IF
052570200423      *RFS124505 - End
052580200423               PERFORM RECORD-UPDATES
052590200423
052600200423      * Reget the out transaction so it can reject through
052610200423      * normal channels
052620200423
052630200423               IF WS-PASS-SWITCH-EDIT = "1"
052640200423                 PERFORM REGET-SELL-BUY-TARGET
052650200423               END-IF
052660200423
052670200423               GO TO DPR-EXIT
052680200423             END-IF
052690200423
052700200423
052710200423      * Process wire order sell
052720200423             PERFORM PROCESS-SELL
052730200423
052740200423      * A rejection has occurred on the redemption - get out of
052750200423      * edit mode
052760200423
052770200423RCH          IF WS-PASS-SWITCH-EDIT = "1" AND
052780200423RCH          REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
052790200423RCH            GO TO DPR-EXIT
052800200423RCH          END-IF
052810200423
052820200423RCH          IF WS-PASS-SWITCH-EDIT = "1"
052830200423RCH            MOVE TRANS-REC
052840200423RCH                          TO WS-TRANS-REC-5
052850200423RCH          END-IF
052860200423
052870200423             IF WS-INTEREST-GENERATED IS EQUAL TO "3"
052880200423               GO TO DPR-EXIT
052890200423             END-IF
052900200423
052910200423R92145* Post MFR before SWO transaction.
052920200423R92145       IF lb_MFRTransLoop
052930200423R92145         GO TO DPR-EXIT
052940200423R92145       END-IF
052950200423
052960200423      * Set up parameters for buy transaction1
052970200423             INITIALIZE WS-NET-OUT-AMOUNTS
052980200423             MOVE NET-AMT OF TRANS
052990200423                               TO WS-OUT-NET
053000200423
053010200423             MOVE WS-REJECTION-CODE
053020200423                               TO WS-REJECTION-CODE-OUT
053030200423
053040200423      * If update mode, Allowable Switch Fee charge, WS-ASL-REF,
053050200423      * is initialized before SWI transaction NET-AMT is calculated.
053060200423
053070200423      *RFS 13182 BEGIN
053080200423             IF WS-PASS-SWITCH-EDIT = "2"
053090200423                 MOVE ZEROES TO WS-ASL-REDF
053100200423             END-IF
053110200423      *RFS 13182 END
053120200423
053130200423      * Get purchase transaction
053140200423
053150200423             PERFORM GET-SELL-BUY-TARGET
053160200423
053170200423      * We saved the previous rejection code - If it does not fail
053180200423      * on the get then use the previous rejection code
053190200423
053200200423             IF WS-REJECTION-CODE = "00"
053210200423               MOVE WS-REJECTION-CODE-OUT TO WS-REJECTION-CODE
053220200423             END-IF
053230200423
053240200423
053250200423             IF WS-REJECTION-CODE IS NOT EQUAL TO "00"
053260200423               MOVE "13"       TO REJECTION-CODE OF TRANS
053270200423             ELSE
053280200423
053290200423      ** If the from and to funds are the same and there is no deduction
053300200423      ** on the out side then transfer the same number of units
053310200423
053320200423             IF GROSS-AMT OF WS-TRANS-REC-2
053330200423             IS EQUAL TO NET-AMT OF WS-TRANS-REC-2
053340200423               IF INVESTMENT-CODE OF TRANS
053350200423               IS EQUAL INVESTMENT-CODE OF WS-TRANS-REC-2
053360200423                 MOVE UNIT-AMT OF WS-TRANS-REC-2
053370200423                               TO WS-OUT-UNITS
053380200423               END-IF
053390200423             END-IF
053400200423
053410200423               PERFORM VALIDATE-TRADE
053420200423
053430200423             END-IF
053440200423
053450200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
053460200423               PERFORM RECORD-UPDATES
053470200423
053480200423               GO TO DPR-EXIT
053490200423             END-IF
053500200423
053510200423             PERFORM SET-SELL-BUY-PROCEEDS
053520200423
053530200423      * Process wire order buy
053540200423             PERFORM PROCESS-BUY
053550200423
053560200423      * RFS117763 - Start
053570200423      *      IF REJECTION-CODE OF TRANS-REC = "11"
053580200423             IF REJECTION-CODE OF TRANS-REC NOT = "00" AND
053590200423             REJECTION-CODE OF TRANS-REC NOT = SPACES
053600200423      * RFS117763 - End
053610200423               MOVE "Y"      TO WS-INSUFFIC-BUY-PROCEEDS
053620200423             END-IF
053630200423      * RFS117124 - Start
053640200423129525*    IF REJECTION-CODE OF TRANS NOT EQUAL TO "00"
053650200423129525*       PERFORM RECORD-UPDATES
053660200423129525*       GO TO DPR-EXIT
053670200423129525*    END-IF
053680200423      * RFS117124 - End
053690200423
053700200423      * Set transaction back to redemption
053710200423             PERFORM REGET-SELL-BUY-TARGET
053720200423
053730200423
053740200423             GO TO DPR-EXIT
053750200423           END-IF.
053760200423
053770200423      *---------------------------------------------------------
053780200423      * Process distributions
053790200423      *---------------------------------------------------------
053800200423
053810200423           IF DISTRIBUTION-TRANSACTION
053820200423             PERFORM VALIDATE-TRADE
053830200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
053840200423               PERFORM RECORD-UPDATES
053850200423               GO TO DPR-EXIT
053860200423             END-IF
053870200423             PERFORM PROCESS-DISTRIBUTION
053880200423             GO TO DPR-EXIT
053890200423           END-IF.
053900200423      *---------------------------------------------------------
053910200423      * Process Capital Loss
053920200423      *---------------------------------------------------------
053930200423
053940200423      *RFS 4637 - BEGIN
053950200423           IF CAPITAL-LOSS-TRANSACTION
053960200423             PERFORM VALIDATE-TRADE
053970200423             IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
053980200423               PERFORM RECORD-UPDATES
053990200423               GO TO DPR-EXIT
054000200423             END-IF
054010200423             PERFORM PROCESS-CAPITAL-LOSS
054020200423             GO TO DPR-EXIT
054030200423           END-IF.
054040200423      *RFS 4637 - END
054050200423
054060200423       DPR-EXIT.
054070200423
054080200423      *---------------------------------------------------------
054090200423      * If this is a switch prepass then (switch = 1) then the
054100200423      * program needs to be placed in update mode and re processed
054110200423      *---------------------------------------------------------
054120200423
054130200423RCH          IF WS-PASS-SWITCH-EDIT = "1"
054140200423RCH            MOVE "2"      TO WS-PASS-SWITCH-EDIT
054150200423      * RFS5512 - Begin
054160200423               IF REDEMPTION-TRANSACTION       AND
054170200423                  NOT SWITCH-OUT-TRANSACTION
054180200423                 GO TO DPR-START-REDEMPTION
054190200423               ELSE
054200200423                 GO TO DPR-0004
054210200423               END-IF
054220200423
054230200423      *        GO TO DPR-0004
054240200423      * RFS5512 - End
054250200423RCH          END-IF.
054260200423      *--------------------------------------------------------------
054270200423      * Now that detail processing is completed for this transaction,
054280200423      * we can reinitialize buffers before the next transaction is read
054290200423      *--------------------------------------------------------------
054300200423
054310200423      *RFS 13441 BEGIN
054320200423             INITIALIZE WS-ASL-FIELDS.
054330200423      *RFS 13441 END
054340200423
054350200423       DPR-EXIT2.
054360200423           EXIT.
054370200423      /
054380201223      *RFS180707 - Starts
054390201223       VERIFY-FUNCTION-CODE SECTION.
054400201223           INITIALIZE lc_ACINDSCInvCode,
054410201223                      lc_InvestmentStructure.
054420201223            MOVE INVESTMENT-CODE OF TRANS TO lc_ACINDSCInvCode.
054430201223            CALL "FXINRSTRF" USING
054440201223                 lc_ACINDSCInvCode
054450201223                 lc_ACINDSCFncCode
054460201223                 lc_InvestmentStructure
054470201223                 lc_ACINDSCDecINRSTRF.
054480201223            IF lc_InvestmentStructure NOT = SPACES
054490201223               SET lnc_ACINDSCYes TO TRUE
054500201223            END-IF.
054510201223
054520201223       VFC-EXIT.
054530201223            EXIT.
054540201223      /
054550201223      *RFS180707 - Ends
054560200423       PROCESS-BUY SECTION.
054570200423      ******************************************************************
054580200423      *    P R O C E S S   B U Y   R O U T I N E                       *
054590200423      ******************************************************************
054600200423
054610200423       PRB-0000.
054620201009      * RFS1104462 - Begin
054630201009           INITIALIZE pc_INTRF-IntactTrasferFlag
054640201009      * RFS1104462 - End
054650200423           PERFORM GET-BATCH-AMOUNTS.
054660200423           IF NOT SETTLED
054670200423             PERFORM CALCULATE-GROSS-AMT
054680200423      * RFS8690 Begin
054690200423             MOVE "N"          TO WS-CAC-0005-EXIT-POINT                RFS8690
054700200423      * RFS8690 End
054710200423             PERFORM CALCULATE-COMMISSIONS
054720200714      * RFS183812 - Start
054730200714             IF TRANS-TYPE-CODE OF TRANS = lc-TRI AND BACK-END-LOAD
054740200714             AND PRODUCT-TYPE-CODE OF INVESTMENT = LT-SEG
054750200714                PERFORM CALCULATE-BONUS-COMMISSION
054760200714             END-IF
054770200714      * RFS183812 - End
054780200423      * RFS117124 - Start
054790200423           IF REJECTION-CODE OF TRANS NOT EQUAL TO "00"
054800200423              GO TO PRB-EXIT
054810200423           END-IF
054820200423      * RFS117124 - End
054830200423             PERFORM CALCULATE-GROSS-NET
054840200423             PERFORM CALCULATE-UNITS-TRANSACTED
054850200423      * RFS159925 - Start
054860200423           IF REJECTION-CODE OF TRANS NOT EQUAL TO "00"
054870200423              GO TO PRB-EXIT
054880200423           END-IF
054890200423      * RFS159925 - End
054900200423             PERFORM POST-CDSC-PURCHASE-UNITS
054910200423             PERFORM CALCULATE-COMMISSION-CDSC
054920200423           END-IF.
054930200423
054940200423           IF SETTLED
054950200423             PERFORM CHANGE-WIRE-ORDER-CDSC-STATUS
054960200423           END-IF.
054970200423
054980200423           PERFORM CHANGE-TRANS-STATUS.
054990200423           PERFORM POST-INVESTMENT-UNITS.
055000200423           PERFORM POST-BATCH-AMOUNTS.
055010200423
055020200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
055030200423             PERFORM POST-LBR-SPNS-UNITS
055040200423           END-IF.
055050200423
055060200423      *RFS14380 Begin (Buys)
055070200423           IF SPEC-MOD-AUTH-ERFEE
055080200423               PERFORM POST-ERF-PURCHASE-UNITS
055090200423      *RFS177665 - Start
055100200423               MOVE SPACES TO lc_SameInvStructFlag
055110200423               MOVE SPACES TO lc_ERFSwoExistFlag
055120200423      *RFS177665 - Start
055130200423           END-IF.
055140200423      *RFS14380 End
055150200423
055160200423      *RFS17685 Begin
055170200423R27609     IF (SPEC-MOD-AUTH-MMINTA OR EC) AND MM-ADJ-ADD-TRANSACTION
055180200423R27609        AND MONEY-MARKET-FUND AND BACKDATED-TRADE AND
055190200423              BACKDATED-TO-CUR-MONTH AND
055200200423              WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
055210200423                PERFORM GENERATE-INTEREST-ADJUSTMENT
055220200423           END-IF.
055230200423      *RFS17685 End
055240200423
055250200423           IF SWITCH-IN-TRANSACTION
055260200423             PERFORM SET-TXN-EXCHANGE-RATE
055270200423             PERFORM SET-IN-PAC-ASSIGNMENT
055280200423             IF FROM-HHFEE AND TO-HHFEE
055290200423             AND ((FROM-FRONT-END-LOAD AND TO-FRONT-END-LOAD) OR
055300200423             (FROM-BACK-END-LOAD AND TO-BACK-END-LOAD))
055310200423               PERFORM COMPUTE-HH-SWITCH-IN-VALUES
055320200423             END-IF
055330200423           END-IF.
055340200423
055350200423      *****    If processing a purchase adjustment, initialize the
055360200423      *****    related fields on the transaction record.
055370200423
055380200423           IF  PURCHASE-ADJUSTMENT
055390200423               MOVE ZEROES             TO  GROSS-AMT
055400200423                                           OF TRANS-REC
055410200423               MOVE ZEROES             TO  NET-AMT
055420200423                                           OF TRANS-REC
055430200423               MOVE ZEROES             TO  SETTLEMENT-AMT
055440200423                                           OF TRANS-REC
055450200423           END-IF.
055460200423
055470200423           IF WS-HH-RATES-APPLICABLE
055480200423             IF PURCHASE-TRANSACTION AND NOT SWITCH-IN-TRANSACTION
055490200423               PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
055500200423             END-IF
055510200423
055520200423             IF SWITCH-IN-TRANSACTION
055530200423               IF FROM-HHFEE AND TO-HHFEE AND
055540200423               ((FROM-FRONT-END-LOAD AND TO-BACK-END-LOAD) OR
055550200423               (FROM-BACK-END-LOAD AND TO-FRONT-END-LOAD))
055560200423                 PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
055570200423               END-IF
055580200423
055590200423               IF NOT FROM-HHFEE
055600200423                 PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
055610200423               END-IF
055620200423
055630200423             END-IF
055640200423           END-IF.
055650200423
055660200423           PERFORM RECORD-UPDATES.
055670200423
055680200423       PRB-EXIT.
055690200423           EXIT.
055700200423      /
055710200423       PROCESS-DISTRIBUTION SECTION.
055720200423      ******************************************************************
055730200423      *    P R O C E S S   D I S T R I B U T I O N   R O U T I N E     *
055740200423      ******************************************************************
055750200423
055760200423       PRD-0000.
055770200423      * RFS15425 - Begin
055780200423           SET SW-NO-CHANGE-TRANS-STATUS     TO TRUE
055790200423      * RFS15425 - End
055800200423           PERFORM GET-BATCH-AMOUNTS.
055810200423
055820200423           IF DAF-REQUIRED
055830200423             PERFORM CALCULATE-DAF-AMOUNT
055840200423           END-IF.
055850200423
055860200423      **   Compute the net before tax **
055870200423
055880200423           IF TAX-ON-NET
055890200423             COMPUTE NET-AMT OF TRANS = GROSS-AMT OF TRANS -
055900200423             WS-DAF-AMOUNT
055910200423      * RFS15841 - Begin
055920200423             COMPUTE WS-NR-NET-AMT = WS-ALL-NR-INTEREST - WS-DAF-AMOUNT
055930200423      * RFS15841 - End
055940200423           END-IF.
055950200423
055960200423           IF (NOT (BACK-END-LOAD AND CASH-DISTRIB))
055970200423           OR (TAX-ON-GROSS)
055980200423             PERFORM CALCULATE-TAX-AMOUNT
055990200423           END-IF.
056000200423
056010200423      * RFS15841 - Begin
056020200423           IF WS-APPLY-NR-INTEREST    AND
056030200423              WS-FEDERAL-TAX-AMOUNT > GROSS-AMT OF TRANS
056040200423             MOVE GROSS-AMT OF TRANS        TO WS-FEDERAL-TAX-AMOUNT
056050200423           END-IF
056060200423      * RFS15841 - End
056070200423
056080200423           PERFORM CALCULATE-GROSS-NET.
056090200423           PERFORM CALCULATE-UNITS-TRANSACTED.
056100200423           PERFORM POST-DISTRIBUTION-CDSC-UNITS.
056110200423
056120200423      *RFS 1021726 - Start
056130200423           IF  INTEREST-TRANSACTION
056140200423           AND REINVESTED-DISTRIB
056150200423           AND TRANS-ORIGIN-CODE OF TRANS = "DIR"
056160200423           AND BACKDATED-TO-CUR-MONTH
056161210929      *RFS1115172 - Starts
056162210929           AND CURR-UNIT-BAL OF ACCOUNT-INVESTMENT = 0
056163210929      *RFS1115172 - Ends
056170200423               PERFORM GENERATE-INTEREST-ADJUSTMENT
056180200423               IF LK-ACCRUAL-AMT > 0
056190200423                  PERFORM POST-INTEREST-BALANCE
056200200423               END-IF
056210200423           END-IF.
056220200423      *RFS 1021726 - End
056230200423
056240200423           IF INTEREST-TRANSACTION AND
056250200423           ACCRUAL-ADJUSTMENT-AMT OF TRANS-INTEREST-DETAILS
056260200423           IS NOT EQUAL TO 0
056270200423             PERFORM POST-INTEREST-BALANCE
056280200423           END-IF.
056290200423
056300200423           IF (BACK-END-LOAD AND CASH-DISTRIB)
056310201125      *RFS 1102637 - Starts
056320201125             MOVE "N"          TO WS-CRC-0020-EXIT-POINT
056330201125      *RFS 1102637 - Ends
056340200423             PERFORM CALCULATE-REDEMPTION-CDSC
056350200423             PERFORM CALCULATE-GROSS-NET
056360200423             IF TAX-ON-NET
056370200423               PERFORM CALCULATE-TAX-AMOUNT
056380200423               PERFORM CALCULATE-GROSS-NET
056390200423             END-IF
056400200423           END-IF.
056410200423
056420200423      *  RFS 12261 BEGIN
056430200423      *    PERFORM CHANGE-TRANS-STATUS.
056440200423           IF GIC-INVESTMENT
056450200423              IF INTEREST-TRANSACTION AND
056460200423
056470200423      *  RFS 13258 - BEGIN - Use WS-UPPER-LIMIT-DATE instead of
056480200423      *              PASS-PROCESS-DATE-9
056490200423
056500200423                (TRADE-DATE OF TRANS IS EQUAL TO WS-UPPER-LIMIT-DATE OR
056510200423                 TRADE-DATE OF TRANS IS LESS THAN WS-UPPER-LIMIT-DATE)
056520200423
056530200423      *  RFS 13258 - END
056540200423
056550200423                 PERFORM CHANGE-TRANS-STATUS
056560200423              ELSE IF NOT INTEREST-TRANSACTION
056570200423                 PERFORM CHANGE-TRANS-STATUS
056580200423              END-IF
056590200423           ELSE
056600200423              PERFORM CHANGE-TRANS-STATUS
056610200423           END-IF.
056620200423      *  RFS 12261 END
056630200423           PERFORM POST-INVESTMENT-UNITS.
056640200423      * RFS15425 - Begin
056650200423           IF SW-CHANGE-TRANS-STATUS
056660200423               PERFORM POST-BATCH-AMOUNTS
056670200423           END-IF
056680200423      *    PERFORM POST-BATCH-AMOUNTS.
056690200423      * RFS15425 - End
056700200423
056710200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
056720200423             PERFORM POST-LBR-SPNS-UNITS
056730200423           END-IF.
056740200423
056750200423      *RFS14380 Begin (Distributions)
056760200423      *RFS1017282 Begin
056770200423      *    IF SPEC-MOD-AUTH-ERFEE
056780200423           IF SPEC-MOD-AUTH-ERFEE AND UNIT-AMT OF TRANS NOT = 0
056790200423      *RFS1017282 End
056800200423               PERFORM POST-ERF-PURCHASE-UNITS
056810200423      *RFS177665 - Start
056820200423               MOVE SPACES TO lc_SameInvStructFlag
056830200423               MOVE SPACES TO lc_ERFSwoExistFlag
056840200423      *RFS177665 - Start
056850200423           END-IF.
056860200423      *RFS14380 End
056870200423
056880200423      *RFS17685 Begin
056890200423R27609     IF (SPEC-MOD-AUTH-MMINTA OR EC) AND MM-ADJ-ADD-TRANSACTION
056900200423R27609        AND MONEY-MARKET-FUND AND BACKDATED-TRADE AND
056910200423              BACKDATED-TO-CUR-MONTH
056920200423                PERFORM GENERATE-INTEREST-ADJUSTMENT
056930200423           END-IF.
056940200423      *RFS17685 End
056950200423
056960200423      *RFS 4637 BEGIN
056970200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "SEG"
056980200423             PERFORM UPDATE-CONTRACT-DISTR
056990200423           END-IF.
057000200423      *RFS 4637 END
057010200423
057020200423           PERFORM RECORD-UPDATES.
057030200423
057040200423      *RFS24192 - Begins
057050200423      * Create NR Tax Redemption trans for the Distribution trans
057060200423      * only if Distribution trans was not rejected
057070200423           IF  EDIT-NDSNRR
057080200423           AND PASS-CDSC-CALCULATOR NOT = "C"
057090200423           AND UNIT-AMT OF TRANS = 0
057100200423           AND (TRANS-TYPE-CODE OF TRANS = "CPG" OR "INC")
057110200423      *    AND NOTIONAL-DISTRIBUTION OF INVESTMENT-NOTIONAL-DIST-DTLS
057120200423      *        = "N"
057130200423           AND WS-NOTIONAL-DISTRIB = "N"
057140200423           AND DISTR-OPTION-CODE OF TRANS-DISTR-DETAILS = "R"
05715020042380658 *    AND COUNTRY-CODE OF INVESTOR  NOT =  "CAN"
05716020042380658      AND Lc_TaxCountryCode         NOT =  "CAN"
057170200423           AND REJECTION-CODE OF TRANS = "00"
057180200423           AND WS-FEDERAL-TAX-AMOUNT  NOT =  0
057190200423
057200200423               PERFORM GENERATE-NR-TAX-SELL-TRANS
057210200423           END-IF.
057220200423      *RFS24192 - Ends
057230200423
057240200423       PRD-EXIT.
057250200423           EXIT.
057260200423      /
057270200423      *RFS 4637 - BEGIN
057280200423       PROCESS-CAPITAL-LOSS SECTION.
057290200423      ******************************************************************
057300200423      *    P R O C E S S   C A P I T A L  L O S S    R O U T I N E     *
057310200423      ******************************************************************
057320200423
057330200423       PCAL-0000.
057340200423
057350200423           PERFORM GET-BATCH-AMOUNTS.
057360200423           MOVE GROSS-AMT OF TRANS
057370200423                             TO NET-AMT OF TRANS.
057380200423      * RFS 11850 BEGIN  CPL LOGIC
057390200423           MOVE CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
057400200423             TO CLOSING-UNIT-BAL OF TRANS.
057410200423      * RFS 11850 END    CPL LOGIC
057420200423           PERFORM CHANGE-TRANS-STATUS.
057430200423           PERFORM POST-BATCH-AMOUNTS.
057440200423
057450200423           PERFORM RECORD-UPDATES.
057460200423
057470200423       PCAL-EXIT.
057480200423           EXIT.
057490200423      *RFS 4637 - END
057500200423      /
057510200423       PROCESS-SELL SECTION.
057520200423      ******************************************************************
057530200423      *    P R O C E S S   S E L L   R O U T I N E                     *
057540200423      ******************************************************************
057550200423
057560200423       PRS-0000.
057570200423
057580200423      *RFS 16941 BEGIN
057590200423      *If the SELL transaction is considered as a switch between
057600200423      *environments (based on Reversal Code Rule 2), then the SELL
057610200423      *transaction will be temporarily considered as a SWO.
057620200423
05763020042392504      MOVE SPACES                       TO lc_MoveCRT.
057640200423138276     MOVE TRANS-TYPE-CODE OF TRANS TO lc_OriginTransType.
057650200423
057660200423           IF WS-SEL-BW-ENV
057670200423               MOVE 'SWO' TO TRANS-TYPE-CODE OF TRANS
057680200423               MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
057690200423           END-IF.
057700200423
057710200423      *RFS 16941 END
057720200423      *RFS 16919 BEGIN
057730200423      *LSIF rollover redemption transactions will be temporarily
057740200423      *considered as a SELL.
057750200423
057760200423           IF LSIF-ROLLOVER
057770200423      *RFS112133 begin
057780200423              OR (lncc_SwitchOutNL
057790200423              AND YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0)
057800200423      *RFS112133 end
05781020042332873 * defect #10 - begin
05782020042332873      OR lncc_clawbackBEOn
05783020042332873 * defect #10 -end
057840200423      * RFS46125 - Begin: temporary consider trade as SELL
057850200423           OR lncc_deathClaims
057860200423129787     OR lb_OptionXOn
057870201223      * RFS185174 - Start
057880210407      * RFS1111190 - Start: It should be not as Sell
057890210407      *    OR lncc_FLDALFYes
057900210407      * RFS1111190 - End
057910201223      * RFS185174 - End
057920200423      * RFS46125 - End
057930200423               MOVE TRANS-TYPE-CODE OF TRANS TO WS-SAVE-TYPE
057940200423               MOVE 'SEL' TO TRANS-TYPE-CODE OF TRANS
057950200423               MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
057960200423           END-IF.
057970200423
057980200423      *RFS 16919 END
057990200423      *RFS 8066 BEGIN
058000200423
058010200423           IF EXTERNAL-TRANSFER-ON
058020200423
058030200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
058040200423                             TO ACCOUNT-TYPE-CODE
058050200423                             OF CONTR-REDEM-CODE-RULES
058060200423             MOVE CONTR-REDEM-CODE OF TRANS
058070200423                             TO CONTR-REDEM-CODE
058080200423                             OF CONTR-REDEM-CODE-RULES
058090200423
058100200423             READ CONTR-REDEM-CODE-RULES
058110200423             INVALID KEY
058120200423               MOVE SPACES   TO WS-EXTERNAL-TRANSFER-CODE
058130200423             NOT INVALID KEY
058140200423               MOVE CONTR-REDEM-CODE-RULE OF CONTR-REDEM-CODE-RULES
058150200423                             TO WS-EXTERNAL-TRANSFER-CODE
058160200423             END-READ
058170200423
058180200423           END-IF.
058190200423
058200200423      *RFS 8066 END
058210200423
058220200423           PERFORM GET-BATCH-AMOUNTS.
058230200423
058240200423           IF SETTLED
058250200423             PERFORM CHECK-WO-UNITS-AVAIL
058260200423           END-IF.
058270200423
058280210720      *RFS186888 - Starts
058290210720           INITIALIZE    ln_LIAOrigAmt
058300210720                         pc-DSCOnLIAFlag
058310210720           IF REJECTION-CODE OF TRANS IS EQUAL "00"
058320210720             INITIALIZE  ln_LIAOrigAmt
058330210720      *  Get Rider
058340210720             IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG" AND
058350210720                REDEMPTION-TRANSACTION
058360210720                PERFORM getRider
058370210720                IF pc_ACCGLWBD_RiderApplicable = "Y"
058380210720                   PERFORM getExcessThreshold
058390210720                   IF pc-DSCOnLIAFlag = "Y"
058400210720                   IF Lb_AccountLevelGlwbYes
058401210914      *RFS1117913 - Starts
058402210914      *               PERFORM ReadAccountBenefits
058403210914                      PERFORM ReadAccountBenefits1
058404210914      *RFS1117913 - Ends
058420210720                      COMPUTE ln_LIAOrigAmt =
058430210720                                      Guar-Withdrawal-Amount
058431210914      *RFS1117913 - Starts
058432210914      *                               OF Ws-Account-Benefits -
058433210914                                      OF ACCOUNT-BENEFITS-REC1 -
058434210914      *RFS1117913 - Ends
058450210720                                      YTD-GUAR-WITHDRAWAL-AMOUNT
058451210914      *RFS1117913 - Starts
058452210914      *                               OF Ws-Account-Benefits +
058453210914                                      OF ACCOUNT-BENEFITS-REC1 +
058454210914      *RFS1117913 - Ends
058470210720                                      pn-ExcessThreshold
058480210720                   ELSE
058481210914      *RFS1117913 - Starts
058482210914      *               Perform ReadAccountContractForGLWB
058483210914                      Perform ReadAccountContractForGLWB1
058484210914      *RFS1117913 - Ends
058500210720                      COMPUTE ln_LIAOrigAmt =
058510210720                                      Guar-Withdrawal-Amount
058511210914      *RFS1117913 - Starts
058512210914      *                               OF WS-ACCOUNT-CONTRACT -
058513210914                                      OF ACCOUNT-CONTRACT1 -
058514210914      *RFS1117913 - Ends
058530210720                                      YTD-GUAR-WITHDRAWAL-AMOUNT
058531210914      *RFS1117913 - Starts
058532210914      *                               OF WS-ACCOUNT-CONTRACT +
058533210914                                      OF ACCOUNT-CONTRACT1   +
058534210914      *RFS1117913 - Ends
058550210720                                      pn-ExcessThreshold
058560210720                   END-IF
058570210720                   END-IF
058580210720                END-IF
058590210720             END-IF
058600210720           END-IF.
058610210720      *RFS186888 - Ends
058620210720
058630200423           IF NOT SETTLED
058640200423             PERFORM CALCULATE-GROSS-AMT
058650200423             PERFORM CALCULATE-UNITS-TRANSACTED
058660200423146960       INITIALIZE WS-INSURANCE-FEE
058670200423             IF REJECTION-CODE OF TRANS IS EQUAL "00"
058680200423               IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG"
058690200423                 PERFORM VALIDATE-SEG-INDIV-REDEM
058700200423      *139288-START
058710200423                 IF (ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE = lncc_2 AND
058720200423                  CONTR-REDEM-CODE-RULE OF  CONTR-REDEM-CODE-RULES
058730200423                  = lncc_36)
058740200423                    PERFORM GET-INSURANCE-FEE
058750200423                 END-IF
058760200423      *139288-END
058770200423               END-IF
058780200423             END-IF
058790200423      *    RFS84977.12 -Begin
058800200423             IF REJECTION-CODE OF TRANS IS EQUAL "00"
058810200423               IF SELL-TRANSACTION                   AND
058820200423                  NOMINEE OF ACCOUNT NOT = lncc_Y    AND
058830200423                  RESP-ACCOUNT                       AND
058840200423                  WS-CURR-CONTR-REDEM-RULE-EAP
058850200423
058860200423      *           RFS84977.17 - Begins - Need to create MFATRNEAP recs for GIC f
058870200423                   IF GIC-DII-INVESTMENT     AND
058880200423                      WS-CURR-CONTR-REDEM-RULE-30
058890200423                      MOVE PLACEMENT-DATE OF TRANS
058900200423                                      TO pi_RESPEAP_PlacmentDate
058910200423                      MOVE TRANS-NO OF TRANS
058920200423                                      TO pi_RESPEAP_TransNo
058930200423
058940200423                      MOVE lncc_I     TO pc_RESPEAP_Mode
058950200423                      CALL "FXRESPEAP" USING pc_RESPEAP_Mode
058960200423                                         pi_RESPEAP_PlacmentDate
058970200423                                         pi_RESPEAP_TransNo
058980200423                   END-IF
058990200423      *           RFS84977.17 - Ends
059000200423
059010200423                  MOVE PLACEMENT-DATE OF TRANS
059020200423                               TO WS-FXRESPVAL-PLACEMENT-DATE
059030200423                  MOVE TRANS-NO OF TRANS
059040200423                               TO WS-FXRESPVAL-TRANS-NO
059050200423                  IF NET-AMT  OF TRANS > 0
059060200423                    MOVE NET-AMT  OF TRANS
059070200423                                  TO WS-FXRESPVAL-NET-AMT
059080200423                  ELSE
059090200423                    MOVE GROSS-AMT OF TRANS
059100200423                                  TO WS-FXRESPVAL-NET-AMT
059110200423                  END-IF
059120200423
059130200423                  MOVE SPACES TO WS-FXRESPVAL-REJECTION-CODE
059140200423                  CALL "FXRESPVAL" USING
059150200423                                 WS-FXRESPVAL-PLACEMENT-DATE
059160200423                                 WS-FXRESPVAL-TRANS-NO
059170200423                                 WS-FXRESPVAL-NET-AMT
059180200423                                 WS-FXRESPVAL-REJECTION-CODE
059190200423
059200200423                  IF WS-FXRESPVAL-REJECTION-CODE NOT = Lncc_00
059210200423                     MOVE WS-FXRESPVAL-REJECTION-CODE
059220200423                                     TO REJECTION-CODE OF TRANS
059230200423                  END-IF
059240200423              END-IF
059250200423             END-IF
059260200423      *    RFS84977.12 -End
059270200423           END-IF.
059280210519
059281210914      *RFS1117913- Starts
059290210519      *RFS186888 - Starts
059291210914      *    INITIALIZE    ln_LIAOrigAmt
059292210914      *                  pc-DSCOnLIAFlag
059293210914      *    IF REJECTION-CODE OF TRANS IS EQUAL "00"
059294210914      *      INITIALIZE  ln_LIAOrigAmt
059340210519      *  Get Rider
059341210914      *      IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG" AND
059342210914      *         REDEMPTION-TRANSACTION
059370210720      *         pc-DSCOnLIAFlag = "Y"
059371210914      *         PERFORM getRider
059372210914      *         IF pc_ACCGLWBD_RiderApplicable = "Y"
059373210914      *            PERFORM getExcessThreshold
059374210914      *            IF pc-DSCOnLIAFlag = "Y"
059375210914      *            IF Lb_AccountLevelGlwbYes
059376210914      *               PERFORM ReadAccountBenefits
059377210914      *               COMPUTE ln_LIAOrigAmt =
059378210914      *                               Guar-Withdrawal-Amount
059379210914      *                               OF Ws-Account-Benefits -
059380210914      *                               YTD-GUAR-WITHDRAWAL-AMOUNT
059381210914      *                               OF Ws-Account-Benefits +
059382210914      *                               pn-ExcessThreshold
059383210914      *            ELSE
059384210914      *               Perform ReadAccountContractForGLWB
059385210914      *               COMPUTE ln_LIAOrigAmt =
059386210914      *                               Guar-Withdrawal-Amount
059387210914      *                               OF WS-ACCOUNT-CONTRACT -
059388210914      *                               YTD-GUAR-WITHDRAWAL-AMOUNT
059389210914      *                               OF WS-ACCOUNT-CONTRACT +
059390210914      *                               pn-ExcessThreshold
059391210914      *            END-IF
059392210914      *            END-IF
059393210914      *         END-IF
059394210914      *      END-IF
059395210914      *    END-IF.
059630210519      *RFS186888 - Ends
059631210914      *RFS1117913 - Ends
059640200423
059650200423      * RFS92465 -Begin
059660200423           IF REJECTION-CODE OF TRANS IS EQUAL "00"  AND
059670200423103437      (TRANS-NO OF TRANS NOT = li_TransNo_CarOvr) AND
059680200423            lb_AssCarOvr_Yes
059690200423                MOVE ACCOUNT-NO OF TRANS TO pi_Frm_AcctNo
059700200423                MOVE PLACEMENT-DATE OF TRANS TO pi_Frm_PlacementDate
059710200423                MOVE TRANS-NO OF TRANS TO pi_Frm_TransNo
059720200423103437                                    li_TransNo_CarOvr
059730200423                MOVE INVESTMENT-CODE OF TRANS TO pc_Frm_InvCode
059740200423                IF PLACED-ALL-UNITS
059750200423                   COMPUTE pc_Frm_Amount Rounded =
059760200423                      WS-AVAILABLE-UNITS3 * UNIT-PRICE OF TRANS
059770200423                ELSE
059780200423                   MOVE GROSS-AMT OF TRANS TO pc_Frm_Amount
059790200423                END-IF
059800200423                MOVE UNIT-PRICE OF TRANS TO pn_Frm_UnitPrice
059810200423                MOVE WS-AVAILABLE-UNITS3 TO pn_Frm_AvailUnits
059820200423128793*         MOVE WS-ASSIGNED-UNITS   TO pn_Frm_AssUnits
059830200423128793*         ADD ln_PAC_UnitAss       TO pn_Frm_AssUnits
059840200423128793          IF DII-INVESTMENT
059850200423  |             MOVE WS-ASSIGNED-UNITSDIIC TO pn_Frm_AssUnits
059860200423  |             ADD  ln_PAC_UnitAss        TO pn_Frm_AssUnits
059870200423  |             ELSE
059880200423  |             MOVE WS-ASSIGNED-UNITS   TO pn_Frm_AssUnits
059890200423  |             ADD ln_PAC_UnitAss       TO pn_Frm_AssUnits
059900200423128793          END-IF
059910200423                MOVE WS-TO-INV-CODE  TO pc_To_InvCode
059920200423                MOVE GROSS-AMT    OF TRANS    TO pc_To_Amount
059930200423                MOVE WS-TO-ACCOUNT-ASN        TO pi_To_AcctNo
059940200423                MOVE "00"                TO pc_ReturnCode
059950200423
059960200423                CALL WS-FXASNCAROV USING pi_Frm_AcctNo
059970200423                                         pi_Frm_PlacementDate
059980200423                                         pi_Frm_TransNo
059990200423                                         pc_Frm_InvCode
060000200423                                         pc_Frm_Amount
060010200423                                         pn_Frm_UnitPrice
060020200423                                         pn_Frm_AvailUnits
060030200423                                         pn_Frm_AssUnits
060040200423                                         pc_To_InvCode
060050200423                                         pc_To_Amount
060060200423                                         PI_TO_ACCTNO
060070200423                                         pc_ReturnCode
060080200423
060090200423                IF pc_ReturnCode Not = '00'
060100200423                   MOVE "11"  TO REJECTION-CODE OF TRANS
060110200423                ELSE
060120200423                  IF PLACED-ALL-UNITS
060130200423                    MOVE pc_Frm_Amount TO GROSS-AMT OF TRANS
060140200423                    MOVE WS-AVAILABLE-UNITS3 TO UNIT-AMT OF TRANS
060150200423                  END-IF
060160200423                END-IF
060170200423           END-IF
060180200423      * RFS92465 - END
060190200423      * RFS180682 - START
060200200423      *Since the above process is not executed after the first
060210200423      *call based on (TRANS-NO OF TRANS NOT = li_TransNo_CarOvr)
060220200423      *condition, the below logic needs to be included for
060230200423      *subsequent calls of this routine.
060240200423           IF REJECTION-CODE OF TRANS IS EQUAL "00"  AND
060250200423            (TRANS-NO OF TRANS = li_TransNo_CarOvr) AND
060260200423            lb_AssCarOvr_Yes AND
060270200423            PLACED-ALL-UNITS AND
060280200423            pc_ReturnCode = "00"
060290200828      *RFS 1103110 - only exec on the second pass
060300200828      *            - when there's entire acct assignment, recalc gross-
060310200828      *       MOVE pc_Frm_Amount TO GROSS-AMT OF TRANS
060320200828            AND Ws-pass-switch-edit = "2"
060330200828              COMPUTE Gross-amt of Trans Rounded =
060340200930                      WS-AVAILABLE-UNITS3 * UNIT-PRICE OF TRANS
060350200828      *RFS 1103110 - end
060360200423              MOVE WS-AVAILABLE-UNITS3 TO UNIT-AMT OF TRANS
060370200423           END-IF
060380200423      * RFS180682 - END
060390200423
060400200423           IF REJECTION-CODE OF TRANS IS EQUAL "00"
060410200423             PERFORM CHANGE-TRANS-STATUS
060420200423             PERFORM POST-INVESTMENT-UNITS
060430200423
060440210720      * RFS186019 - Starts
060450210720             IF NOT lb_MFRTransLoop
060460210720               IF lc_REGR_ACCR = lncc_Y
060470210720                 IF Placed-All-Units OR (Placed-In-Units-MFR
060480210720                   AND CLOSING-UNIT-BAL OF TRANS = 0
060490210720                   AND CURR-UNIT-BAL OF ACCOUNT-INVESTMENT = 0)
060500210720                   MOVE lncc_Y TO lc_FullRedemption
060510210720                   IF NOT (SWITCH-OUT-TRANSACTION AND
060520210720                                    WS-PASS-SWITCH-EDIT = "1")
060530210720                      PERFORM CREATE-MFR-FOR-REGR-FULLRED
060540210720                   END-IF
060550210720                 END-IF
060560210720
060570210720                 IF lb_MFRTransLoop
060580210720                    PERFORM PROCESS-MFR-TRADES
060590210720                    IF lb_MFRTransEOF
060600210720                      INITIALIZE lc_MFRTransEOF
060610210720                      MOVE lncc_M01 TO Rejection-Code OF Trans
060620210720                    ELSE
060630210720                      GO TO PRS-EXIT
060640210720                    END-IF
060650210720                  END-IF
060660210720               END-IF
060670210720             END-IF
060680210720      * RFS186019 - Ends
060690200423      * RFS92145 Start
060700200423      * Post MFR trades prior to posting the full redemption.
060710200423      * IF MFR Trades not generated. Reject full redemption trade
060720200423R97579* For SWO transaction generate MFR on second pass only
060730200423
060740200423             IF NOT lb_MFRTransLoop
060750200423               IF Placed-All-Units OR (Placed-In-Units-MFR
060760200423                 AND CLOSING-UNIT-BAL OF TRANS = 0
060770200423                 AND CURR-UNIT-BAL OF ACCOUNT-INVESTMENT = 0)
060780200423                 MOVE lncc_Y TO lc_FullRedemption
060790200423R97579           IF NOT (SWITCH-OUT-TRANSACTION AND
060800200423R97579                            WS-PASS-SWITCH-EDIT = "1")
060810200423                    PERFORM PROCESS-MFR-ACCRUAL
060820200423R97579           END-IF
060830200423               END-IF
060840200423
060850200423               IF lb_MFRTransLoop
060860200423                 IF NOT Transfer-Out-Transaction
060870200423                   PERFORM PROCESS-MFR-TRADES
060880200423                   IF lb_MFRTransEOF
060890200423                     INITIALIZE lc_MFRTransEOF
060900200423                     MOVE lncc_M01 TO Rejection-Code OF Trans
060910200423                   ELSE
060920200423                     GO TO PRS-EXIT
060930200423                   END-IF
060940200423                 END-IF
060950200423               END-IF
060960200423             END-IF
060970200423      *RFS92145 End
060980200423
060990200423      *RFS17685 Begin
061000200423R27609       IF (SPEC-MOD-AUTH-MMINTA OR EC) AND
061010200423R27609          MM-ADJ-RED-TRANSACTION AND
061020200423                MONEY-MARKET-FUND AND BACKDATED-TRADE AND
061030200423                BACKDATED-TO-CUR-MONTH AND
061040200423                WS-INTEREST-GENERATED = "0"
061050200423                  PERFORM GENERATE-INTEREST-ADJUSTMENT
061060200423             END-IF
061070200423      *RFS17685 End
061080200423
061090200423             IF (PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
061100200423             AND (MONEY-MARKET-FUND)
061110200423             AND (WS-INTEREST-GENERATED = "0")
061120200423RCH          AND (WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"))
061130200423             OR ((GIC-DII-INVESTMENT)
0611402004238414         AND (PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C")
061150200423             AND (WS-INTEREST-GENERATED = "0")
061160200423RCH          AND (WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"))
061170200423138770       OR (PASS-CDSC-CALCULATOR = "C"
061180200423138770       AND ACCOUNT-LEV-FREE-DOLLARS
061190201223      *RFS180707 - Starts
061200201223             AND lnc_ACINDSCNo
061210201223      *RFS180707 - Ends
061220200423138770       AND GIC-INVESTMENT
061230200423138770       AND (WS-INTEREST-GENERATED = "0")
061240200423138770       AND (SPLIT-OPTION-CODE OF TRANS = "A"))
061250200423181302        OR (PASS-CDSC-CALCULATOR = "C"
061260200423181302       AND Lb_TriggerInterestYes)
061270200423               PERFORM GENERATE-INTEREST-TRADE
061280200423
061290200423               IF WS-INTEREST-GENERATED IS EQUAL TO "3"
061300200423      *RFS16919 Begin
061310200423                   IF LSIF-ROLLOVER
061320200423      *RFS112133 begin
061330200423                   OR (lncc_SwitchOutNL
061340200423                       AND YEARS-FOR-GAIN
061350200423                           OF FINANCER-CDSC-INSTRUCTIONS > 0)
061360200423      *RFS112133 end
06137020042332873 * defect #10 - begin
06138020042332873              OR lncc_clawbackBEOn
061390200423      * RFS46125 - Begin
061400200423                   OR lncc_deathClaims
061410200423129787             OR lb_OptionXOn
061420200423      * RFS46125 - End
061430201223      * RFS185174 - Start
061440210407      * RFS1111190 - Start: It should be not as Sell
061450210407      *     OR lncc_FLDALFYes
061460210407      * RFS1111190 - End
061470201223      * RFS185174 - End
06148020042332873 * defect #10 - begin
061490200423                       MOVE WS-SAVE-TYPE TO TRANS-TYPE-CODE OF TRANS
061500200423                       MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
061510200423                   END-IF
061520200423      *RFS16919 End
061530200423      *RFS16941 Begin
061540200423                   IF WS-SEL-BW-ENV
061550200423                       MOVE "SEL" TO TRANS-TYPE-CODE OF TRANS
061560200423                       MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
061570200423                   END-IF
061580200423      *RFS16941 End
061590200423                   GO TO PRS-EXIT
061600200423               END-IF
061610200423             END-IF
061620200423
061630200423             PERFORM POST-BATCH-AMOUNTS
061640200423
061650200423             IF HISTORY AND WIRE-ORDER-FLAG OF TRANS = "Y"
061660200423               GO TO PRS-0020
061670200423             END-IF
061680200423
061690200423             PERFORM GET-REDEMPTION-FEE
061700200423
061710200423      * RFS16384 Begin
061720200423      *      IF GIC-INVESTMENT
061730200423             IF (GIC-INVESTMENT  OR
061740200423                (PASS-CDSC-CALCULATOR = "C" AND GIC-DII-INVESTMENT))
061750200423      * RFS16384 End
061760200423               PERFORM CALCULATE-GIC-DEDUCTIONS
061770200423             END-IF
061780200423
061790200423             IF WS-HH-RATES-APPLICABLE AND NOT BACK-END-LOAD
061800200423               IF (NOT SWITCH-OUT-TRANSACTION)
061810200423                 PERFORM CALCULATE-HH-REDEM-FEE
061820200423               END-IF
061830200423             END-IF
061840200423
061850200423             IF SWITCH-OUT-TRANSACTION
061860200423
061870200423               IF FROM-HHFEE AND TO-HHFEE AND
061880200423               (FROM-FRONT-END-LOAD AND TO-BACK-END-LOAD)
061890200423                   PERFORM CALCULATE-HH-REDEM-FEE
061900200423               END-IF
061910200423
061920200423               IF FROM-HHFEE AND NOT TO-HHFEE AND
061930200423               (FROM-FRONT-END-LOAD)
061940200423                 PERFORM CALCULATE-HH-REDEM-FEE
061950200423               END-IF
061960200423
061970200423             END-IF
061980200423
061990200423      * RFS22072 - Begin
062000200423             IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
062010200423               MOVE "Y" TO WS-TBL-UPDATE-LSIF-FILES
062020200423               PERFORM CALCULATE-LBR-SPNS-REDEM
062030200423             END-IF
062040200423      * Restore orig TRANS-STATUS-CODE and do not upd CPP if Rejected
062050200423S1           IF REJECTION-CODE OF TRANS NOT = "00"
062060200423              MOVE WS-TRANS-STATUS-CODE-SAV TO
062070200423                      TRANS-STATUS-CODE OF TRANS
062080200423             ELSE
062090200423      * RFS22072 - End
062100200423      * RFS32873 - Begin
062110200423      *RFS1008937 - Starts
062120200423      *      IF lncc_clawbackLLOn  AND
062130200423      *         SWO-TRANSACTION    AND
062140200423      *         FROM-BACK-END-LOAD AND
062150200423      *         TO-BACK-END-LOAD
062160200423             IF (lncc_clawbackLLOn  AND
062170200423                 SWO-TRANSACTION    AND
062180200423                 FROM-BACK-END-LOAD AND
062190200423                 TO-BACK-END-LOAD)  OR
062200200423                (lb_TO-NL           AND
062210200423             NOT lb_ToCommRecovSchedCodeSpace)
062220200423      *RFS1008937 - Ends
062230200423               SET TO-FRONT-END-LOAD  TO TRUE
062240200423               MOVE "0"               TO WS-TAX-CDSC-APPLICABLE
062250200423               SET lncc_changeLoad    TO TRUE
062260200423             ELSE
062270200423               SET lncc_notChangeLoad TO TRUE
062280200423             END-IF
062290200423      * RFS32873 - End
062300200423             MOVE "Y"        TO WS-POPULATE-CALC-FILE
062310201125      *RFS 1102637 - Starts
062320201125             MOVE "N"          TO WS-CRC-0020-EXIT-POINT
062330201125      *RFS 1102637 - Ends
062340200423             PERFORM CALCULATE-REDEMPTION-CDSC
062350200423             MOVE "N"        TO WS-POPULATE-CALC-FILE
062360201223      * RFS185174 - Start: Validate if any charges
062370210216      *      PERFORM validateChargesFLDALF   RFS185174.1 - Commented
062380201223      * RFS185174 - End
062390200423      *RFS135520 - Begin
062400200423127197*      IF PASS-CDSC-CALCULATOR NOT = "C"
062410200423127197*         AND NOT WS-CDSC-CALCULATOR-INTERNAL-C
062420200423      * RFS140721 - Start
062430200423             IF ACCOUNT-LEV-FREE-DOLLARS AND
062440201223      *RFS180707 - Starts
062450201223                lnc_ACINDSCNo            AND
062460201223      *RFS180707 - Ends
062470200423                REDEMPTION-TRANSACTION   AND
062480200423                GIC-INVESTMENT AND lc_PenaltyMethod = lc_MVA  AND
062490200423                ln_freeDollarsUsed > 0
062500200423                  PERFORM WAIVE-MVA-CHARGE
062510200423             END-IF
062520200423      *      IF GIC-INVESTMENT AND lc_PenaltyMethod = lc_MVA
062530200423      *RFS135520 - End
062540200423118527*          PERFORM WAIVE-MVA-CHARGE
062550200423127197*      END-IF
062560200423      * RFS140721 - End
062570200423      * RFS32873 - Begin
062580200423             IF lncc_changeLoad
062590200423               SET TO-BACK-END-LOAD  TO TRUE
062600200423             END-IF
062610200423      * RFS32873 - End
062620200423
062630200423      * RFS22072 - Begin
062640200423      * Execute the code before CALCULATE-REDEMPTION-CDSC, because
062650200423      * it could produce Rejection Code which need to be handled.
062660200423      * ---------------------------------------------------------------
062670200423      * RFS22072 - End
062680200423
062690200423      *RFS 14380 Begin
062700200423             IF SPEC-MOD-AUTH-ERFEE
062710200423                 MOVE "Y" TO WS-TEP-UPDATE-ERF-FILES
062720200423                 PERFORM POST-ERF-SELL-UNITS
062730200423             END-IF
062740200423      *RFS 14380 End
062750200423
062760200423             IF TAX-ON-NET
062770200423               MOVE NET-AMT OF TRANS
062780200423                             TO WS-NET-AMOUNT
062790200423               COMPUTE NET-AMT OF TRANS = GROSS-AMT OF TRANS -
062800200423               WS-REDEMPTION-FEE - WS-CDSC-AMOUNT - WS-TOTAL-CLAWBACK -
062810200423               WS-HH-RED-AMT - WSA-REPMT-RED-FEE - WSA-RED-PENALTY
062820200423      *RFS 14380 Begin
062830200423               - WS-ERF-CHARGE
062840200423      *RFS 14380 End
062850200423      *RFS 139288Begin
062860200423               - WS-INSURANCE-FEE
062870200423      *RFS 139288End
062880200423      *RFS 19058 Begin
062890200423               - SPONSOR-AMT OF TRANS-COMMISSION
062900200423      *RFS 19058 End
062910200423
062920200423      *RFS 8467 Start
062930200423               IF PASS-CDSC-CALCULATOR = "C" AND
062940200423               WSA-INTEREST-AMT IS NOT EQUAL 0 AND
062950200423               PASS-SPLIT-OPTION IS EQUAL TO "A"
062960200423                     COMPUTE NET-AMT OF TRANS = NET-AMT OF TRANS +
062970200423                                                WSA-INTEREST-AMT
062980200423                     MOVE NET-AMT OF TRANS
062990200423                                   TO WS-NET-AMOUNT
063000200423               END-IF
063010200423      *RFS 8467 End
063020200423
063030200423               PERFORM CALCULATE-TAX-AMOUNT
063040200423               MOVE WS-NET-AMOUNT
063050200423                             TO NET-AMT OF TRANS
063060200423               MOVE ZEROES   TO WS-NET-AMOUNT
063070200423             ELSE
063080200423               PERFORM CALCULATE-TAX-AMOUNT
063090200423             END-IF
063100200423
063110200423             PERFORM CALCULATE-GROSS-NET
063120200423
063130200423             IF SWITCH-OUT-TRANSACTION
063140200423               PERFORM SET-OUT-PAC-ASSIGNMENT
063150200423               PERFORM SET-TXN-EXCHANGE-RATE
063160200423
063170200423               IF FROM-HHFEE AND TO-HHFEE
063180200423               AND ((FROM-FRONT-END-LOAD AND TO-FRONT-END-LOAD) OR
063190200423               (FROM-BACK-END-LOAD AND TO-BACK-END-LOAD))
063200200423                 PERFORM COMPUTE-HH-SWITCH-OUT-VALUES
063210200423               END-IF
063220200423             END-IF
063230200423
063240200423      *RFS 6958 BEGIN
063250200423
063260200423             IF FEE-TRANSACTION
063270200423               MOVE NET-AMT OF TRANS-REC
063280200423                             TO WS-GST-PST-TAX-BASIS
063290200423               PERFORM CALCULATE-GST-PST-AMOUNT
063300200423
063310200423      * RFS 164509 Begin
06332020042384063 *        IF HISTORY
063330200423  |   *         PERFORM UPDATE-ACCOUNT-FEE-ACCRUAL
06334020042384063 *        END-IF
063350200423      * RFS 164509 End
063360200423
06337020042387136        IF NOT WS-CURR-CONTR-REDEM-RULE-GPG
063380200423               IF PLACED-GROSS
063390200423                 COMPUTE WS-REDEMPTION-FEE  = NET-AMT OF TRANS-REC -
063400200423                 (WS-GST-AMOUNT + WS-PST-AMOUNT)
063410200423               ELSE
063420200423                 MOVE NET-AMT
063430200423                      OF TRANS-REC     TO  WS-REDEMPTION-FEE
063440200423               END-IF
063450200423
063460200423               MOVE ZEROES   TO  NET-AMT
063470200423                             OF TRANS-REC
063480200423               MOVE "W"      TO  WRITE-REDEMPTION-FEE
063490200423             END-IF
06350020042387136      END-IF
063510200423      *RFS 6958 END
063520200423
063530200423             IF  REDEMPTION-ADJUSTMENT
063540200423                 MOVE ZEROES           TO  GROSS-AMT
063550200423                                           OF TRANS-REC
063560200423                 MOVE ZEROES           TO  NET-AMT
063570200423                                           OF TRANS-REC
063580200423                 MOVE ZEROES           TO  SETTLEMENT-AMT
063590200423                                           OF TRANS-REC
063600200423             END-IF
063610200423      * RFS22072 - Begin
063620200423E1           END-IF
063630200423      * RFS22072 - End
063640200423
063650200423           END-IF.
063660200423
063670200423       PRS-0020.
063680200423
063690200423      ** The GST and PST were added into the Redemption Fee
063700200423      ** and they need to be subtracted before posting of the
063710200423      ** transaction
063720200423
063730200423           IF NOT FEE-TRANSACTION
063740200423           IF WS-REDEMPTION-FEE IS NOT EQUAL 0
063750200423               COMPUTE WS-REDEMPTION-FEE = WS-REDEMPTION-FEE -
063760200423               (WS-GST-AMOUNT2 + WS-PST-AMOUNT2)
063770200423               MOVE WS-GST-AMOUNT2
063780200423                             TO WS-GST-AMOUNT
063790200423               MOVE WS-PST-AMOUNT2
063800200423                             TO WS-PST-AMOUNT
063810200423               MOVE ZERO     TO WS-GST-AMOUNT2
063820200423                                WS-PST-AMOUNT2
063830200423             END-IF
063840200423           END-IF.
063850200423
063860200423           IF WS-HH-RATES-APPLICABLE
063870200423             IF REDEMPTION-TRANSACTION AND NOT SWITCH-OUT-TRANSACTION
063880200423               PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
063890200423               PERFORM COMPUTE-HH-REDFEE-CALC-DET
063900200423             END-IF
063910200423
063920200423             IF SWITCH-OUT-TRANSACTION
063930200423               IF FROM-HHFEE AND TO-HHFEE AND
063940200423               ((FROM-FRONT-END-LOAD AND TO-BACK-END-LOAD) OR
063950200423               (FROM-BACK-END-LOAD AND TO-FRONT-END-LOAD))
063960200423                 PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
063970200423                 PERFORM COMPUTE-HH-REDFEE-CALC-DET
063980200423               END-IF
063990200423
064000200423               IF NOT TO-HHFEE
064010200423                 PERFORM COMPUTE-HH-DEPOSIT-CALC-DET
064020200423                 PERFORM COMPUTE-HH-REDFEE-CALC-DET
064030200423               END-IF
064040200423             END-IF
064050200423           END-IF.
064060200423
064070200423      *RFS 16919 BEGIN
064080200423      *For LSIF rollovers, revert transaction from temporary 'SEL' to
064090200423      *the original transaction type of the transaction when it entered
064100200423      *this section.
064110200423
064120200423           IF LSIF-ROLLOVER
064130200423      *RFS112133 begin
064140200423              OR (lncc_SwitchOutNL
064150200423              AND YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0)
064160200423      *RFS112133 end
06417020042332873 *defect #10 - begin
06418020042332873      OR lncc_clawbackBEOn
06419020042332873 *defect #10 - end
064200200423      * RFS46125 - Begin
064210200423           OR lncc_deathClaims
064220200423129787     OR lb_OptionXOn
064230200423      * RFS46125 - End
064240201223      * RFS185174 - Start
064250210407      * RFS1111190 - Start: It should be not as Sell
064260210407      *    OR lncc_FLDALFYes
064270210407      * RFS1111190 - End
064280201223      * RFS185174 - End
064290200423               MOVE WS-SAVE-TYPE TO TRANS-TYPE-CODE OF TRANS
064300200423               MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
064310200423           END-IF.
064320200423
064330200423      *RFS 16919 END
064340200423      *RFS 16941 BEGIN
064350200423      *If the SELL transaction was considered as a switch between
064360200423      *environments (based on Reversal Code Rule 2), then the SELL
064370200423      *transaction was temporarily converted to a SWO. We will not
064380200423      *revert the transaction back to the original 'SEL' transaction
064390200423      *type code.
064400200423           IF WS-SEL-BW-ENV
064410200423               MOVE 'SEL' TO TRANS-TYPE-CODE OF TRANS
064420200423               MOVE TRANS-TYPE-CODE OF TRANS TO TRANS-CATAGORY
064430200423           END-IF.
064440200423
064450200423      *RFS 16941 END
064460200423      * RFS32873 - Begin
064470200423           IF lncc_clawbackLLOn
064480200423             PERFORM calc-bonus-commission
064490200423           END-IF
064500200423      * RFS32873 - End
064510200423
064520200423           PERFORM RECORD-UPDATES.
064530200423
064540200423      *RFS92145 Start
064550200423      * Reset MFR Trans loop flag.
064560200423           IF lb_MFRTransLoop
064570200423              INITIALIZE lc_MFRTransLoop
064580200423           END-IF.
064590200423      *RFS92145 End
064600200423
064610200423       PRS-EXIT.
064620200423           EXIT.
064630200423      /
064640200423       VALIDATE-TRADE SECTION.
064650200423      ******************************************************************
064660200423      *    V A L I D A T E   T R A D E   R O U T I N E                 *
064670200423      ******************************************************************
064680200423
064690200423       VTR-0000.
064700200423
064710200423      * RFS 68035.26 - begins.
064720200423      *__________________________________________________________*
064730200423      * Do not comment out this move. TRNPST performs the final  *
064740200423      * updates only when rejection-code is set to "00".         *
064750200423      *__________________________________________________________*
06476020042368035 *    If NOT lb_AccountTypeRDSP
064770200423      *      MOVE "00"     TO REJECTION-CODE OF TRANS
06478020042368035 *    End-If.
064790200423128793*RFS113784-Starts
064800200423  |   *    IF REJECTION-CODE OF TRANS-PRIMARY-REC
064810200423  |   *       EQUAL TO  "G44" OR "G45"
064820200423  |   *       GO TO VTR-EXIT
064830200423128793*    END-IF.
064840200423      *RFS113784-Ends
064850200423           MOVE "00"     TO REJECTION-CODE OF TRANS.
064860200423      * RFS 68035.26 - ends.
064870200423
06488020042362320 *    MOVE lncc_N TO Ws-Seg-Same-Account-Flag.                     60638
064890200423
064900200423      * RFS 10635 BEGIN
064910200423           MOVE SPACES TO WS-NO-WITHHOLDING.
064920200423      * RFS 10635 END
064930200423      * RFS 12261 BEGIN
064940200423           MOVE ZEROES TO WS-ALL-NR-INTEREST.
064950200423      * RFS 12261 END
064960200423
064970200423      * RFS15841 - Begin
064980200423           MOVE ZEROES TO WS-NR-NET-AMT
064990200423      * RFS15841 - End
065000200423
06501020042334309      INITIALIZE WS-VALID-RESP-EAP-TRADE.
065020200423           INITIALIZE NUMERIC-WORK-FIELDS
065030200423                      WSA-PARMS
065040200423      * RFS10008 - start
065050200423                      WSB-PARMS.                                        RFS10008
065060200423      * RFS10008 - end
065070200423
065080200423      * RFS18779 - Begin
065090200423           INITIALIZE WS-CURR-CONTR-REDEM-CODE-RULE
065100200423162192                Ws-Lnk-Maturity-NR-Flag
065110200423183140                Ws-Lnk-Pre-Maturity-Flag
065120200423      * RFS18779 - End
065130200423      *RFS24190 - Begins
065140200423           MOVE SPACES  TO WS-NTAXT2062-CALC
065150200423                           WS-NTAXREGSEL-CALC
065160200423                           WS-TFR-AT-COST-OCCURS
065170200423                           WS-AUC-UNIT-COST-OK
065180200423                           WS-AUC-CALCULATED.
065190200423           MOVE ZEROS   TO WS-AUC-UNIT-COST.
065200200423      *RFS24190 - Ends
065210200423
065220200423           MOVE SPACES         TO WS-NOTIONAL-DISTRIB.
065230200423
065240200423           MOVE ZEROES         TO HHLD-VALUATION-HH-INVESTOR-N
065250200423                                  HHLD-TOTAL-VALUE-N.
065260200423
065270200423           INITIALIZE MFATRNCMP OF TRANS-COMMISSION-REC.
065280200423
065290200423           MOVE SPACES         TO DISTRIBUTION-OPTION-CODE.
065300200423
065310200423           IF WS-INTEREST-GENERATED IS NOT EQUAL TO "2"
065320200423             INITIALIZE WRITE-SWITCHES
065330200423               MOVE "N"                TO  WS-MFAACCASP-WSW
065340200423               MOVE "N"                TO  WS-MFAACCASPA-WSW
065350200423               MOVE "N"                TO  WS-MFAIVRCLP-WSW
065360200423               MOVE "N"                TO  WS-MFATRNASP-WSW
065370200423           END-IF.
065380200423           INITIALIZE SYSTEMATIC-SWITCHES-INIT.
065390200423
065400200423      *    RFS71433 -Begin
065410200423           MOVE TRADE-DATE OF TRANS    TO WS-WK-TRADE-DATE
065420200423           MOVE PASS-PROCESS-DATE-9    TO WS-WK-PROCESS-DATE
065430200423
065440200423           INITIALIZE Lc_currfinancerCode
065450200423           PERFORM INIT-ARR-FREE-DOLL-FINANCER.
065460200423      *    RFS71433 -End
065470200423
065480200423      * rfs 24192 - start
065490200423           IF WS-NDSNRR-GENERATED = "1"
065500200423              INITIALIZE WRITE-SWITCHES
065510200423              MOVE "W"                 TO  WRITE-TRANS-TARGET
065520200423                                           WRITE-TRANS-REDEM-DETAILS
065530200423           END-IF.
065540200423 1    * rfs 24192 - end
065550200423           MOVE TRANS-REC      TO WS-TRANS-REC.
065560200423      * RFS169270 - Starts
065570200423           IF PURCHASE-TRANSACTION AND (NOT PURCHASE-ADJUSTMENT) AND
065580200423              lb_EditCodeACINVGSetupYes                          AND
065590200423              lc_Policy NOT = "A"
065600200423              PERFORM  ValidateACINVG THRU VAI-EXIT
065610200423              IF REJECTION-CODE OF TRANS IS EQUAL TO "S54" OR "S55"
065620200423                 GO TO VTR-EXIT
065630200423              END-IF
065640200423           END-IF.
065650200423      * RFS169270 - Ends
065660200423
065670200423      *---------------------------------------------------------
065680200423      *Validate that batch exists
065690200423      *---------------------------------------------------------
065700200423           IF BATCH-DATE OF TRANS IS EQUAL TO 0
065710200423             GO TO VTR-0010
065720200423           END-IF.
065730200423
065740200423           MOVE BATCH-DATE OF TRANS TO BATCH-DATE OF BATCH-HEADER.
065750200423           MOVE BATCH-CODE OF TRANS TO BATCH-CODE OF BATCH-HEADER.
065760200423
065770200423           READ BATCH-HEADER WITH NO LOCK
065780200423             KEY IS EXTERNALLY-DESCRIBED-KEY
065790200423             INVALID KEY
065800200423               MOVE "01"       TO REJECTION-CODE OF TRANS
065810200423               GO TO VTR-EXIT.
065820200423      *---------------------------------------------------------
065830200423      *Validate that batch status permits processing
065840200423      *
065850200423      *---------------------------------------------------------
065860200423           IF BATCH-STATUS OF BATCH-HEADER IS EQUAL "OPEN"
065870200423      *GIC MOD
065880200423140269*    AND PASS-CDSC-CALCULATOR IS NOT EQUAL "Q"
065890200423140269     AND PASS-CDSC-CALCULATOR IS NOT EQUAL "Q" AND
065900200423140269          (NOT (PASS-CDSC-CALCULATOR = "U" AND
065910200423140269           BATCH-TYPE-CODE OF BATCH-HEADER = "SYSGIC" AND
065920200423140269           TRANS-ORIGIN-CODE OF TRANS = "GIM"))
065930200423      *END GIC MOD
065940200423             MOVE "02"       TO REJECTION-CODE OF TRANS
065950200423             GO TO VTR-EXIT
065960200423           END-IF.
065970200423
065980200423       VTR-0010.
065990200423      *RFS108486 - Start
066000200423           INITIALIZE li_RDSPDSCMax
066010200423                      li_RDSPDSCTest.
066020200423           SET lb_RDSPDSCExistsNo TO TRUE.
066030200423181302     SET Lb_TriggerInterestNo TO TRUE.
066040200423           IF REDEMPTION-TRANSACTION
066050200423              INITIALIZE WKRDSPDSC OF RDSP-WORKFILE
066060200423              MOVE PLACEMENT-DATE OF TRANS
066070200423                TO PLACEMENT-DATE OF RDSP-WORKFILE
066080200423              MOVE TRANS-NO OF TRANS TO TRANS-NO OF RDSP-WORKFILE
066090200423
066100200423              READ RDSP-WORKFILE
066110200423               INVALID KEY
066120200423                 CONTINUE
066130200423               NOT INVALID KEY
066140200423                 IF PLACEMENT-DATE OF RDSP-WORKFILE NOT = 0 AND
066150200423                    TRANS-NO OF RDSP-WORKFILE NOT = 0
066160200423181302              MOVE Trigger-Interest-Gen of RDSP-WORKFILE
066170200423181302                                       TO Lb_TriggerInterest
066180200423181302              IF Lb_TriggerInterest IS NOT EQUAL "O"
066190200423                      SET lb_RDSPDSCExistsYes TO TRUE
066200200423                      MOVE CHARGE OF RDSP-WORKFILE TO li_RDSPDSCMax
066210200423181302              END-IF
066220200423                 END-IF
066230200423              END-READ
066240200423           END-IF.
066250200423      *RFS108486 - End
066260200423      * RFS16505 - Begin
066270200423           PERFORM SET-DSC-CHARGEABLE-METHOD
066280200423      * RFS16505 - End
066290200423
066300200423      * RFS25997 - Starts
066310200423      * This routine is used to get the MFATLLPXP work file records
066320200423      * (clear daily) to reject LLP redemption trades which exceeded
066330200423      * the LLP max withdrawals limit (LLPMAXVAL Cobol program)
066340200423      * SWO, TRO, or SEL will be rejected because of '109' rej. code.
066350200423
066360200423           PERFORM GET-LLP-MAX-VALIDATE-RULE THRU GLLP-EXIT.
066370200423           IF LLP-REJECT
066380200423              IF SWITCH-OUT-TRANSACTION OR SELL-TRANSACTION
066390200423                 MOVE "109"  TO REJECTION-CODE OF TRANS-REC
066400200423              END-IF
066410200423              GO TO VTR-EXIT
066420200423           END-IF.
066430200423      * RFS25997 - Ends
066440200423
066450200423      * RFS 16941 Begin @@@
066460200423      *If Special module for XFER between environments is set up and
066470200423      *Reversal code of SELL/BUY implies a cross environment SELL/BUY,
066480200423      *If SELL:
066490200423      *If BUY: We first call function FXENVPUR to get the key data of
066500200423      *        the original SELL transaction. We then call SETTRFBW to
066510200423      *        give access to the CPP/RDP files on the other
066520200423      *        environment. This is so we can carry forward age dates.
066530200423      *        Next, we call function CHECKTRNS to validate that the
066540200423      *        original SELL transactions exists (status, etc.)
066550200423
066560200423           MOVE "N"              TO WS-SEL-BW-ENV-FLAG
066570200423                                    WS-BUY-BW-ENV-FLAG.
066580200423
066590200423           IF SPEC-MOD-AUTH-ENVTRNSFER AND
066600200423              REVERSAL-CODES-RULE-TRF-BW-ENV
066610200423               IF SELL-TRANSACTION
066620200423                   MOVE "Y"      TO WS-SEL-BW-ENV-FLAG
066630200423               ELSE
066640200423                   IF BUY-TRANSACTION
066650200423
066660200423                       MOVE "Y"      TO WS-BUY-BW-ENV-FLAG
066670200423
066680200423      *                Call FXENVPUR to fetch TRANS-ENV-PURCH-XREF
066690200423      *                record which will give us the SELL placement
066700200423      *                date and transaction number, as well as the
066710200423      *                cross-environment company code.
066720200423
066730200423                       MOVE PLACEMENT-DATE OF TRANS
066740200423                       TO   WS-FXENVPUR-PLACEMENT-DATE
066750200423                       MOVE TRANS-NO       OF TRANS
066760200423                       TO   WS-FXENVPUR-TRANS-NO
066770200423
066780200423                       CALL "FXENVPUR" USING
066790200423                                       WS-FXENVPUR-PLACEMENT-DATE
066800200423                                       WS-FXENVPUR-TRANS-NO
066810200423                                       WS-FXENVPUR-PLACEMENT-DATE-2
066820200423                                       WS-FXENVPUR-TRANS-NO-2
066830200423                                       WS-FXENVPUR-COMPANY-CODE
066840200423                                       WS-FXENVPUR-LIBRARY-NAME
066850200423                                       WS-FXENVPUR-RETURN-CODE
066860200423
066870200423                       IF WS-FXENVPUR-RETURN-CODE IS NOT EQUAL " "
066880200423                           MOVE "T1"       TO REJECTION-CODE OF TRANS
066890200423                           GO TO VTR-EXIT
066900200423                       END-IF
066910200423
066920200423      *                Call CL-SETTRFBW, which will set the following 4
066930200423      *                4 files to override to the cross-environment.
066940200423      *                1) MFATRNP - aliased as TRFTRNP
066950200423      *                2) MFATRNCPP - aliased as TRFTRNCPP
066960200423      *                3) MFATRNRDP - aliased as TRFTRNRDP
066970200423      *                4) MFAENVRXP - aliased as TRNENVRXP
066980200423
066990200423                       MOVE WS-FXENVPUR-COMPANY-CODE
067000200423                       TO MANAGEMENT-COMPANY-CODE
067010200423                       OF TRANSFER-VALID-ENVIRONMENTS
067020200423
067030200423                       READ TRANSFER-VALID-ENVIRONMENTS
067040200423                       INVALID KEY
067050200423                           MOVE "T1"       TO REJECTION-CODE OF TRANS
067060200423                           GO TO VTR-EXIT
067070200423                       END-READ
067080200423
067090200423                       MOVE LIBRARY-NAME OF TRANSFER-VALID-ENVIRONMENTS
067100200423                       TO WS-SETTRFBW-LIBRARY
067110200423
067120200423                       IF WS-SETTRFBW-LIBRARY IS NOT EQUAL
067130200423                          WS-FROM-LIBRARY-NAME
067140200423
067150200423                           MOVE SPACES TO WS-TRF-BW-ERR-FLAG
067160200423                           MOVE "O"
067170200423                           TO WS-SETTRFBW-ACTION
067180200423
067190200423                           IF WS-SETTRFBW-MODE-O-OFF
067200200423                               CALL "SETTRFBW" USING
067210200423                                               WS-SETTRFBW-LIBRARY
067220200423                                               WS-SETTRFBW-ACTION
067230200423                                               WS-SETTRFBW-RETURN-CODE
067240200423                           END-IF
067250200423
067260200423                           IF WS-SETTRFBW-RETURN-CODE = " "
067270200423
067280200423                               MOVE LIBRARY-NAME
067290200423                               OF TRANSFER-VALID-ENVIRONMENTS
067300200423                               TO   WS-FROM-LIBRARY-NAME
067310200423
067320200423                               MOVE "Y" TO WS-SETTRFBW-MODE-O-FLAG
067330200423
067340200423                               OPEN I-O  BW-TRANS-CDSC-PUR-PRIMARY
067350200423                               IF  WS-FILE-STATUS IS NOT EQUAL TO "00"
067360200423                               AND WS-FILE-STATUS IS NOT EQUAL TO "41"
067370200423                                   PERFORM REJECT-AND-CLOSE-TRF-FILES
067380200423                                   GO TO VTR-EXIT
067390200423                               END-IF
067400200423
067410200423                               OPEN I-O  BW-TRANS-CDSC-PURCH-REDUCTION
067420200423                               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
067430200423                               AND WS-FILE-STATUS IS NOT EQUAL TO "41"
067440200423                                   PERFORM REJECT-AND-CLOSE-TRF-FILES
067450200423                                   GO TO VTR-EXIT
067460200423                               END-IF
067470200423                           ELSE
067480200423                               DISPLAY "@@@? SETTRF RETURN CODE ERROR"
067490200423                               MOVE "T9"   TO REJECTION-CODE OF TRANS
067500200423                               MOVE "2"    TO WS-TRF-BW-ERR-FLAG
067510200423                               DISPLAY "@@@ SETTRFBW FAILURE CODE: "
067520200423                               WS-SETTRFBW-RETURN-CODE
067530200423                               GO TO VTR-EXIT
067540200423                           END-IF
067550200423                       END-IF
067560200423
067570200423      *                Call function CHECKTRNS to ensure that
067580200423      *                SELL transaction exists and is historic, etc
067590200423
067600200423                       MOVE WS-FXENVPUR-PLACEMENT-DATE-2
067610200423                       TO   WS-CHECKTRNS-PLACEMENT-DATE-2
067620200423                       MOVE WS-FXENVPUR-TRANS-NO-2
067630200423                       TO   WS-CHECKTRNS-TRANS-NO-2
067640200423                       MOVE WS-FROM-LIBRARY-NAME
067650200423                       TO   WS-CHECKTRNS-LIBRARY
067660200423
067670200423                       CALL "CHECKTRNS" USING
067680200423                            WS-CHECKTRNS-PLACEMENT-DATE-2
067690200423                            WS-CHECKTRNS-TRANS-NO-2
067700200423                            WS-NET-AMT
067710200423                            WS-CHECKTRNS-LIBRARY
067720200423                            WS-CHECKTRNS-CHECK-CODE
067730200423                            WS-CHECKTRNS-PASS-FAIL
067740200423                            WS-CHECKTRNS-REJECT-MESSAGE
067750200423
067760200423                       IF WS-CHECKTRNS-PASS-FAIL = "F"
067770200423                           MOVE "TA"     TO REJECTION-CODE OF TRANS
067780200423                           GO TO VTR-EXIT
067790200423                       ELSE
067800200423
067810200423      *                    Call FXENVRED to read TRANS record on
067820200423      *                    the SELL environment. This BUY
067830200423      *                    transaction will be rejected if the
067840200423      *                    rejection code of FXENVRED is not
067850200423      *                    equal spaces.
067860200423
067870200423                           MOVE ZEROES
067880200423                           TO   FXER-PLACEMENT-DATE
067890200423                           MOVE ZEROES
067900200423                           TO   FXER-TRANS-NO
067910200423                           MOVE SPACES
067920200423                           TO   FXER-MANAGEMENT-COMPANY-CODE
067930200423                           MOVE WS-FXENVPUR-PLACEMENT-DATE-2
067940200423                           TO   FXER-PLACEMENT-DATE-2
067950200423                           MOVE WS-FXENVPUR-TRANS-NO-2
067960200423                           TO   FXER-TRANS-NO-2
067970200423                           MOVE "TRNP"
067980200423                           TO   FXER-FILE-TO-PROCESS
067990200423                           MOVE "R"
068000200423                           TO   FXER-ACTION-CODE
068010200423
068020200423                           CALL "FXENVRED" USING FXER-PARMS
068030200423                           IF FXER-RETURN-CODE EQUAL ' '
068040200423                               MOVE FXER-TRANS-REC
068050200423                               TO WS-TRANS-REC-5
068060200423                                  WS-TRANS-REC-5-SAV
068070200423                               MOVE NET-AMT OF WS-TRANS-REC-5
068080200423                               TO GROSS-AMT OF TRANS
068090200423                           ELSE
068100200423                               MOVE "TC" TO REJECTION-CODE OF TRANS
068110200423                               GO TO VTR-EXIT
068120200423                           END-IF
068130200423                       END-IF
068140200423                   END-IF
068150200423               END-IF
068160200423           END-IF.
068170200423      *RFS 16941 End
068180200423
068190200423      *GIC MOD
068200200423      *these routines moved so that product type is rtved before
068210200423      *trade date eval
068220200423      *---------------------------------------------------------
068230200423      *Investment is invalid - not found on investment master
068240200423      *---------------------------------------------------------
068250200423
068260200423           IF INVESTMENT-CODE OF TRANS
068270200423           IS NOT EQUAL INVESTMENT-CODE OF INVESTMENT
068280200423             MOVE INVESTMENT-CODE OF TRANS
068290200423                               TO INVESTMENT-CODE OF INVESTMENT
068300200423             READ INVESTMENT
068310200423             KEY IS EXTERNALLY-DESCRIBED-KEY
068320200423             INVALID KEY
068330200423               MOVE SPACES     TO INVESTMENT-CODE OF INVESTMENT
068340200423               MOVE "04"       TO REJECTION-CODE OF TRANS
068350200423               GO TO VTR-EXIT
068360200423             END-READ
068370200423133094     END-IF.
068380200423      *RFS112133 begin
068390200423             INITIALIZE MFAINVMDP OF INVESTMENT-MISC-DETAIL-REC
068400200423             MOVE INVESTMENT-CODE OF TRANS
068410200423               TO INVESTMENT-CODE OF INVESTMENT-MISC-DETAIL-REC
068420200423             READ INVESTMENT-MISC-DETAIL
068430200423               INVALID KEY
068440200423               INITIALIZE MFAINVMDP OF INVESTMENT-MISC-DETAIL-REC
068450200423             END-READ
068460200423             IF SWITCH-OUT-TRANSACTION
068470200423                MOVE EXTERNAL-LOAD-TYPE-CODE
068480200423                                    OF INVESTMENT-MISC-DETAIL-REC
068490200423                  TO lc_SwitchOutNLFlag
068500200423             END-IF
068510200423      *RFS112133 end
068520200423133094*    END-IF.
068530200423
068540200423      *RFS1008937-Starts
068550200423
068560200423             INITIALIZE MFAIMSCHP OF INVESTMENT-MANAGEMENT-SCHD-REC,
068570200423                        lc_NL-FLAG,
068580200423                        lc_FROM-NL-FLAG,
068590200423                        lc_TO-NL-FLAG,
068600200423                        lc_CommRecovSchedCode,
068610200423                        lc_FromCommRecovSchedCode,
068620200423                        lc_ToCommRecovSchedCode.
068630200423
068640200423             MOVE INVESTMENT-CODE OF TRANS
068650200423               TO INVESTMENT-CODE OF INVESTMENT-MANAGEMENT-SCHD-REC
068660200423             READ INVESTMENT-MANAGEMENT-SCHEDULE
068670200423               INVALID KEY
068680200423               INITIALIZE MFAIMSCHP OF INVESTMENT-MANAGEMENT-SCHD-REC
068690200423             END-READ
068700200423
068710200423             MOVE EXTERNAL-LOAD-TYPE-CODE
068720200423               OF INVESTMENT-MISC-DETAIL-REC
068730200423               TO lc_NL-FLAG
068740200423             MOVE COMM-RECOV-SCHED-CODE
068750200423               OF INVESTMENT-MANAGEMENT-SCHD-REC
068760200423               TO lc_CommRecovSchedCode
068770200423
068780200423             IF SWITCH-OUT-TRANSACTION
068790200423                MOVE EXTERNAL-LOAD-TYPE-CODE
068800200423                  OF INVESTMENT-MISC-DETAIL-REC
068810200423                  TO lc_FROM-NL-FLAG
068820200423                MOVE COMM-RECOV-SCHED-CODE
068830200423                  OF INVESTMENT-MANAGEMENT-SCHD-REC
068840200423                  TO lc_FromCommRecovSchedCode
068850200423             END-IF
068860200423
068870200423             IF SWITCH-IN-TRANSACTION
068880200423                MOVE EXTERNAL-LOAD-TYPE-CODE
068890200423                  OF INVESTMENT-MISC-DETAIL-REC
068900200423                  TO lc_TO-NL-FLAG
068910200423                MOVE COMM-RECOV-SCHED-CODE
068920200423                  OF INVESTMENT-MANAGEMENT-SCHD-REC
068930200423                  TO lc_ToCommRecovSchedCode
068940200423             END-IF
068950200423      *RFS1008937-Ends
068960200423102028*** Reject when ContrRedemCode is blank
068970200423109024***  IF CONTR-REDEM-CODE OF TRANS = SPACES
068980200423109024     IF CONTR-REDEM-CODE OF TRANS = SPACES AND
068990200423  |           (PASS-CDSC-CALCULATOR NOT = "C" AND
069000200423  |            PASS-CDSC-CALCULATOR NOT = "Y" AND
069010200423  |            PASS-CDSC-CALCULATOR NOT = "1" AND
069020200423  |            PASS-CDSC-CALCULATOR NOT = "2" AND
069030200423109024         PASS-CDSC-CALCULATOR NOT = "3")
069040200423  |          MOVE "75" TO REJECTION-CODE OF TRANS
069050200423102028       GO TO VTR-EXIT.
069060200423
069070200423R30134**** Check if edit codes are set for validating SYSPLAN
069080200423           IF lc_Trntrd_Flag = LT-Y OR lc_Accact_Flag = LT-Y
06909020042337754         OR SPEC-MOD-AUTH-SEGSYSMAT-ON
069100200423              MOVE Trans-Origin-Code OF Trans TO WS-TRANS-ORIGIN-88.
069110200423
069120200423R30134**** Validate Trading Code for SYSTEMATIC PLANS
069130200423
069140200423           IF lc_Trntrd_Flag = LT-Y AND
069150200423              (PAC OR AWD OR AWR OR DCA OR GRP OR TRK OR DSR)
069160200423              MOVE Trade-Code OF Investment TO
069170200423                   Trade-Code OF Trans-Trade-Codes-Rec
069180200423              MOVE Trans-Type-Code OF Trans TO
069190200423                   Trans-Type-Code OF Trans-Trade-Codes-Rec
069200200423              READ Trans-Trade-Codes
069210200423              INVALID KEY
069220200423              MOVE "70"       TO Rejection-Code OF Trans
069230200423R30134        GO TO VTR-EXIT.
069240200423183140         Initialize MFAINVLNP   OF INVESTMENT-LINK-NOTES-REC
069250200423
069260200423      *RFS42278 - Begins
069270200423      *-------------------------------------------------
069280200423            IF lb_LinkNoteSeton
069290200423183140      OR lc_LNPREMATFlag = "Y"
069300200423183140*        Initialize MFAINVLNP   OF INVESTMENT-LINK-NOTES-REC
069310200423               MOVE   INVESTMENT-CODE OF TRANS TO
069320200423                      INVESTMENT-CODE OF INVESTMENT-LINK-NOTES-REC
069330200423               READ INVESTMENT-LINK-NOTES
069340200423               NOT INVALID KEY
069350200423                   MOVE  "Y"  TO lnc_LinkNoteInvestment
069360200423      *RFS183140 - Begin
069370200423     /*            IF CHARGE-NRTAX OF INVESTMENT-LINK-NOTES-REC = "Y"*/
069380200423                   IF lb_LinkNoteSeton
069390200423                   IF (CHARGE-NRTAX OF
069400200423                      INVESTMENT-LINK-NOTES-REC = "M" OR "B") AND
069410200423                      (MATURITY-DATE OF
069420200423                      INVESTMENT-LINK-NOTES-REC <= TRADE-DATE OF TRANS)
069430200423      *RFS183140 - End
069440200423                      MOVE "Y"  To  lc_ChargeNont
069450200423                   ELSE
069460200423                      MOVE "N"  To  lc_ChargeNont
069470200423                   END-IF
069480200423      *RFS183140 - Begin
069490200423                   END-IF
069500200423
069510200423                   IF lc_LNPREMATFlag = "Y"
069520200423                    IF (CHARGE-NRTAX OF
069530200423                        INVESTMENT-LINK-NOTES-REC = "P" OR "B") AND
069540200423                       (MATURITY-DATE OF
069550200423                        INVESTMENT-LINK-NOTES-REC > TRADE-DATE OF TRANS)
069560200423                        AND (TRANS-TYPE-CODE OF
069570200423                        TRANS = "SWO" OR "TRO" OR "SEL")
069580200423                          MOVE "Y"  TO Ws-Lnk-Pre-Maturity-Flag
069590200423                          MOVE "Y"  To lc_ChargeNont
069600200423                    END-IF
069610200423                   END-IF
069620200423      *RFS183140 - End
069630200423               INVALID KEY
069640200423                   MOVE  "N"  TO lnc_LinkNoteInvestment
069650200423               END-READ
069660200423            END-IF.
069670200423      *RFS42278 - Ends
069680200423
069690200423      *RFS24191 - Begins
069700200423           MOVE SPACES  TO WS-POOLED-FUND.
069710200423
069720200423           IF SPEC-MOD-AUTH-POLTAX
069730200423              IF (EDIT-IRCPG AND CAPITAL-GAIN-TRANSACTION)
069740200423R24190        OR ((EDIT-NT2062 OR EDIT-NRGSEL) AND
069750200423R24190            (SELL-TRANSACTION OR SWITCH-OUT-TRANSACTION))
069760200423
069770200423                 MOVE INVESTMENT-CODE OF TRANS
069780200423                   TO WS-FXINVTY-INVESTMENT-CODE
069790200423                 MOVE SPACES  TO WS-FXINVTY-RETURN-CODE
069800200423
069810200423                 CALL "FXINVTY" USING WS-FXINVTY-INVESTMENT-CODE
069820200423                                      WS-FXINVTY-RETURN-CODE
069830200423
069840200423                 IF WS-FXINVTY-RETURN-CODE = "Y"
069850200423                    MOVE "Y"  TO WS-POOLED-FUND
069860200423                 END-IF
069870200423              END-IF
069880200423           END-IF.
069890200423      *RFS24191 - Ends
069900200423
069910200423      * RFS11838 - Begin
069920200423      *    IF PRODUCT-TYPE-CODE OF INVESTMENT
069930200423      *    IS NOT EQUAL PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
069940200423      * RFS11838 - End
069950200423             MOVE PRODUCT-TYPE-CODE OF INVESTMENT
069960200423                               TO PRODUCT-TYPE-CODE OF
069970200423                               PRODUCT-TYPE-CODES
069980200423             READ PRODUCT-TYPE-CODES
069990200423             INVALID KEY
070000200423               MOVE SPACES     TO PRODUCT-TYPE-CODE
070010200423                               OF PRODUCT-TYPE-CODES
070020200423               MOVE "40"       TO REJECTION-CODE OF TRANS
070030200423               GO TO VTR-EXIT
070040200423             END-READ
070050200423             MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES
070060200423                               TO INVESTMENT-TYPE-RULE
070070200423      * RFS12308 - Begin
070080200423             EVALUATE TRUE
070090200423               WHEN SWITCH-OUT-TRANSACTION
070100200423                 MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES   TO
070110200423                              INVESTMENT-TYPE-RULE-SW-OUT
070120200423               WHEN SWITCH-IN-TRANSACTION
070130200423                 MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES   TO
070140200423                              INVESTMENT-TYPE-RULE-SW-IN
070150200423             END-EVALUATE
070160200423      * RFS12308 - End
070170200423      *    END-IF.                                                      RFS11838
070180200423
070190200423           IF INVESTMENT-GROUP-CODE OF INVESTMENT IS NOT
070200200423           EQUAL INVESTMENT-GROUP-CODE OF INVESTMENT-GROUP
070210200423             MOVE INVESTMENT-GROUP-CODE OF INVESTMENT
070220200423                               TO INVESTMENT-GROUP-CODE
070230200423                               OF INVESTMENT-GROUP
070240200423             READ INVESTMENT-GROUP
070250200423             KEY IS EXTERNALLY-DESCRIBED-KEY
070260200423             INVALID KEY
070270200423      *RFS24191 - Begins
070280200423      **       MOVE SPACES     TO INVESTMENT-GROUP-CODE
070290200423      **                       OF INVESTMENT-GROUP
070300200423               INITIALIZE MFAINVGRP OF INVESTMENT-GROUP
070310200423      *RFS24191 - Ends
070320200423               MOVE "04"       TO REJECTION-CODE OF TRANS
070330200423               GO TO VTR-EXIT
070340200423             END-READ
070350200423           END-IF.
070360200423
070370200423      *RFS122496 - Begin - Moved below line from CPYACCMAT.
070380200423           INITIALIZE  lc_AccMiscDtlLock.
070390200423      *RFS122496 - End
070400200423      *RFS128793 - Starts
070410200423           IF GIC-INVESTMENT  AND REDEMPTION-TRANSACTION
070420200423131914     AND TRANS-TYPE-CODE OF TRANS NOT = "TRO"
070430200423131914     AND (TRANS-ORIGIN-CODE OF TRANS NOT = "MAT"
070440200423131914     AND TRANS-ORIGIN-CODE OF TRANS NOT = "GIM")
070450200423           INITIALIZE  lc_Rejcode
070460200423                       WS-ASSIGNED-UNITS
070470200423                       ln_CertIDNo
070480200423                       ln_unitbalance
070490200423           MOVE ACCOUNT-NO      OF TRANS TO ln_accountno
070500200423           MOVE TRANS-NO        OF TRANS TO ln_transno1
070510200423           MOVE PLACEMENT-DATE  OF TRANS
070520200423                             TO ln_placementdate1
070530200423           MOVE INVESTMENT-CODE OF TRANS
070540200423                             TO ln_Investmentcode
070550200423           MOVE GROSS-AMT   OF TRANS
070560200423                            TO ln_Tradeamount
070570200423           CALL "FXGICASSM" USING
070580200423                            ln_accountno
070590200423                            ln_placementdate1
070600200423                            ln_transno1
070610200423                            ln_Investmentcode
070620200423                            ln_Tradeamount
070630200423                            ln_unitbalance
070640200423                            ln_CertIDNo
070650200423                            lc_rejcode
070660200423
070670200423           IF lc_rejcode NOT = lnc_00
070680200423              MOVE lnc_G44 TO REJECTION-CODE OF TRANS
070690200423              GO TO VTR-EXIT
070700200423           ELSE IF lc_rejcode = lnc_00
070710200423              MOVE ln_unitbalance TO WS-ASSIGNED-UNITS
070720200423           END-IF
070730200423           END-IF.
070740200423      *RFS128793 - End
070750200423      *RFS112944 - Starts
070760200423            IF lc_Policy = "A"
070770200423122496*        COPY CPYACCMAT.
070780200423116449       IF ((GIC-DII-INVESTMENT  AND PURCHASE-TRANSACTION)
070790200423116449           OR (TRANS-ORIGIN-CODE OF TRANS = "TRK"
070800200423116449           OR GRP OR  TRK
070810200423116449           OR lnc_origCodesForREPLIC ))
070820200423116449          PERFORM DEALER-LICENSE
070830200423116449          PERFORM DEALER-REP-LICENSE
070840200423116449       END-IF
070850200423122496         PERFORM MiscDetailValidation
070860200423138805         PERFORM CERT-MATURITY-DATE-VALIDATION
070870200423122496      END-IF.
070880200423      * RFS112944 - End.
070890200423
070900200423      *END GIC MOD
070910200423      * RFS22180 - Begin
070920200423           IF WS-VALIDATE-INV-MISC-DETAIL
070930200423             PERFORM CHECK-INV-CODE-MISC-DETAIL
070940200423             IF RETN-CODE-FAIL OF COMM-CPINVDAT-PARAMETERS
070950200423               MOVE "A1"       TO REJECTION-CODE OF TRANS
070960200423               GO TO VTR-EXIT
070970200423             END-IF
070980200423           END-IF
070990200423      * RFS22180 - End
071000200423      *---------------------------------------------------------
071010200423      *Select only transactions with a placement date equal
071020200423      *to or less than current processing date
071030200423      *
071040200423      *---------------------------------------------------------
071050200423      *GIC MOD
071060200423
071070200423           IF NOT GIC-INVESTMENT
071080200423      * RFS9932 - Start                                                 RFS9932
071090200423            IF DII-INVESTMENT                                    AND    RFS9932
071100200423              (TRANS-ORIGIN-CODE OF TRANS = "AWE" OR                    RFS9932
071110200423              TRANS-ORIGIN-CODE OF TRANS = "AWC")                AND    RFS9932
071120200423              TRANS-STATUS-CODE OF TRANS = "CHQ"                 AND    RFS9932
071130200423              TRADE-DATE OF TRANS > WS-UPPER-LIMIT-DATE                 RFS9932
071140200423               MOVE LT-Y       TO WS-FUTURE-AWD                         RFS9932
071150200423            ELSE                                                        RFS9932
071160200423      * RFS9932 - End                                                   RFS9932
071170200423            IF DII-INVESTMENT       AND                                 RFS7652
071180200423               TRADE-DATE OF TRANS = WS-YEAR-END-DATE                   RFS7652
071190200423                CONTINUE                                                RFS7652
071200200423            ELSE                                                        RFS7652
071210200423      * RFS9530 - Begin Check against next Trade Date for SWO from
071220200423      *           MF to GIC/DII
071230200423            IF WS-NEXT-DATE-SWI-YES              AND
071240200423               TRANS-TYPE-CODE OF TRANS = "SWI"
071250200423             IF TRADE-DATE OF TRANS > WS-UPPER-LIMIT-DAT2
071260200423                 MOVE "03"       TO REJECTION-CODE OF TRANS
071270200423                 GO TO VTR-EXIT
071280200423             END-IF
071290200423            ELSE
071300200423      * RFS9530 - End
071310200423      * RFS9932 - Begin
071320200423            IF DII-INVESTMENT                                           RFS7652
071330200423             IF TRADE-DATE OF TRANS IS GREATER
071340200423                                    THAN WS-UPPER-LIMIT-DATE
071350200423      * RFS13839 - Begin
071360200423              AND PASS-CDSC-CALCULATOR NOT = "C"
071370200423      * RFS13839 - End
071380200423                MOVE "03"       TO REJECTION-CODE OF TRANS
071390200423                GO TO VTR-EXIT
071400200423             END-IF
071410200423            ELSE
071420200423      * RFS9932 - End
071430200423             IF TRADE-DATE OF TRANS IS GREATER
071440200423             THAN PASS-PROCESS-DATE-9
071450200423      * RFS13839 - Begin
071460200423              AND PASS-CDSC-CALCULATOR NOT = "C"
071470200423      * RFS13839 - End
071480200423                MOVE "03"       TO REJECTION-CODE OF TRANS
071490200423                GO TO VTR-EXIT
071500200423             END-IF
071510200423            END-IF                                                      RFS7652
071520200423           END-IF.
071530200423      * RFS147796 - STARTS
071540200423           IF SELL-TRANSACTION
071550200423      * RFS155857 - Start: rollback RFS153113
071560200423           AND PAYMENT-TYPE-CODE OF TRANS = "E"
071570200423      * RFS155857 - End
071580200423              INITIALIZE MFATRNBP
071590200423                OF TRANS-PAY-TO-BANK-REC
071600200423              MOVE PLACEMENT-DATE  OF TRANS-REC
071610200423                    TO  PLACEMENT-DATE  OF TRANS-PAY-TO-BANK-REC
071620200423              MOVE TRANS-NO    OF TRANS-REC
071630200423                    TO  TRANS-NO OF TRANS-PAY-TO-BANK-REC
071640200423
071650200423              READ TRANS-PAY-TO-BANK
071660200423              INVALID KEY
071670200423                   MOVE "TRN PAYBNK: VTR" TO WS-FILE-STATUS-FILE-NAME
071680200423                   MOVE "77"       TO REJECTION-CODE OF TRANS
071690200423                   GO TO VTR-EXIT
071700200423              END-READ
071710200423              INITIALIZE MFABNKACP
071720200423                         OF BANK-ACCOUNT-REC
071730200423              MOVE BANK-SEQ-NO OF TRANS-PAY-TO-BANK-REC
071740200423                           TO  BANK-SEQ-NO OF BANK-ACCOUNT-REC
071750200423              READ BANK-ACCOUNT
071760200423              INVALID KEY
071770200423                  MOVE "77"       TO REJECTION-CODE OF TRANS
071780200423                  GO TO VTR-EXIT
071790200423              END-READ
071800200423           END-IF.
071810200423
071820200423           IF SELL-TRANSACTION
071830200423           AND PAYMENT-TYPE-CODE OF TRANS = "C"
071840200423              INITIALIZE MFATRNCP
071850200423                OF TRANS-PAY-TO-CHEQUE-REC
071860200423              MOVE PLACEMENT-DATE  OF TRANS-REC
071870200423                    TO  PLACEMENT-DATE  OF TRANS-PAY-TO-CHEQUE-REC
071880200423              MOVE TRANS-NO    OF TRANS-REC
071890200423                    TO  TRANS-NO OF TRANS-PAY-TO-CHEQUE-REC
071900200423
071910200423              READ TRANS-PAY-TO-CHEQUE
071920200423              INVALID KEY
071930200423                   MOVE "TRN PAYCHQ: VTR" TO WS-FILE-STATUS-FILE-NAME
071940200423                   MOVE "77"       TO REJECTION-CODE OF TRANS
071950200423                   GO TO VTR-EXIT
071960200423              END-READ
071970200423           END-IF.
071980200423
071990200423      * RFS147796 - ENDS
072000200423
072010200423           IF GIC-INVESTMENT
072020200423             IF TRADE-DATE OF TRANS IS GREATER
072030200423             THAN WS-UPPER-LIMIT-DATE
072040200423RF8095       AND PASS-CDSC-CALCULATOR NOT EQUAL  TO "J"
072050200423      * RFS9530 - Begin Check against next Trade Date for SWO from
072060200423      *           MF to GIC/DII
072070200423              IF WS-NEXT-DATE-SWI-YES              AND
072080200423                 TRANS-TYPE-CODE OF TRANS = "SWI"
072090200423               IF TRADE-DATE OF TRANS > WS-UPPER-LIMIT-DAT2
072100200423                  MOVE "03"       TO REJECTION-CODE OF TRANS
072110200423                  GO TO VTR-EXIT
072120200423               END-IF
072130200423              ELSE
072140200423      * RFS9530 - End
072150200423      * RFS 12261 - begin
072160200423      *        GO TO VTR-EXIT
072170200423
072180200423      * RFS13839 - Begin
072190200423      *        IF INTEREST-TRANSACTION AND
072200200423      *           TRANS-STATUS-CODE OF TRANS IS EQUAL TO "CHQ"
072210200423               IF (INTEREST-TRANSACTION AND
072220200423                   TRANS-STATUS-CODE OF TRANS IS EQUAL TO "CHQ")
072230200423                  OR PASS-CDSC-CALCULATOR = "C"
072240200423      * RFS13839 - End
072250200423                  CONTINUE
072260200423               ELSE
072270200423                  MOVE "03"       TO REJECTION-CODE OF TRANS
072280200423                  GO TO VTR-EXIT
072290200423               END-IF
072300200423      * RFS 12261 - end
072310200423              END-IF                                                    RFS9530
072320200423             END-IF
072330200423           END-IF.
072340200423
072350200423      *END GIC MOD
072360200423
072370200423      * CHECK TO SEE IF THIS INVESTMENT IS RUNNING NOTIONAL
072380200423      * DISTRIBUTIONS
072390200423
072400200423           IF REDEMPTION-TRANSACTION AND PRODUCT-TYPE-CODE
072410200423           OF INVESTMENT = "LBS"
072420200423             PERFORM VALIDATE-LSIF-SPECIFIC-TX-ID
072430200423             IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
072440200423               GO TO VTR-EXIT
072450200423             END-IF
072460200423           END-IF.
072470200423
072480200423      *RFS 37427 - Start
072490200423      *If AAP/STF is set to A or S, reject MFR phantom transaction
072500200423      *if account investment is not active.
072510200423
072520200423           IF Man-Fee-Reb-Transaction AND
072530200423              (Sysparm-Aap-Stf-Acc-Sep = lt-A OR
072540200423               Sysparm-Aap-Stf-Acc-Sep =
072550200423                      lt-One-Active-Aap-Master-Acc) AND
072560200423              Aap-Investment
072570200423              PERFORM Get-Curr-Phantom-Status
072580200423              IF NOT Ws-Curr-Account-Inv-Status-Act
072590200423                 MOVE lt-A1 TO Rejection-Code OF Trans
072600200423                 GO TO Vtr-Exit
072610200423              END-IF
072620200423           END-IF.
072630200423      * RFS50058 - Begin: get data from original fundserv trade
072640200423           PERFORM GET-ORDER-ENTRY-MAIN
072650200423      * RFS50058 - End
072660200423      *RFS 37427 - End
072670200423           IF DISTRIBUTION-TRANSACTION
072680200423             GO TO VTR-0012
072690200423           END-IF.
072700200423
072710200423      *---------------------------------------------------------------
072720200423      * This Logic is to handle asset allocation transactions. In normal   's
072730200423      * mode they are bypassed.  They are only processed when an A is
072740200423      * passed to the transaction update program
072750200423      *---------------------------------------------------------------
072760200423      * RFS12308 - Begin: PRODUCT-TYPE-CODES file already read at
072770200423      * the very beginning of the validation Section.
072780200423      * RFS12308 - End
072790200423      *---------------------------------------------------------------
072800200423
072810200423           IF PASS-CDSC-CALCULATOR IS EQUAL "C"
072820200423             GO TO VTR-0012
072830200423           END-IF.
072840200423
072850200423      * RFS 17117 begin
072860200423           MOVE "N"            TO WS-TRADE-ON-HOLDING.
072870200423           IF PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES = "4"
072880200423              INITIALIZE FXAH-PARMS
072890200423              MOVE PLACEMENT-DATE OF TRANS
072900200423                               TO FXAH-PLACEMENT-DATE
072910200423              MOVE TRANS-NO OF TRANS
072920200423                               TO FXAH-TRANS-NO
072930200423              MOVE ENTERED-BY OF TRANS
072940200423                               TO FXAH-USER
072950200423              MOVE "G"         TO FXAH-OPER-FLAG
072960200423              CALL "FXAAHTRN" USING FXAH-PARMS
072970200423
072980200423              IF TRN-EXISTS
072990200423      * RFS14710 - Begin
073000200423                AND FXAH-USER NOT = LT-AASWITCH
073010200423                AND FXAH-USER NOT = LT-AAREBAL1
073020200423      * RFS14710 - End
073030200423      * RFS91768 - Begin
073040200423                AND FXAH-USER NOT = LT-AAREBAL2
073050200423      * RFS91768 - End
073060200423                 MOVE "Y"      TO WS-TRADE-ON-HOLDING.
073070200423      * RFS 17117 end
073080200423
073090200423      * RFS14710 - Begin
073100200423           MOVE "N"            TO WS-TRADE-ON-HOLDING-AASWITCH
073110200423           IF SWITCH-TRANSACTION AND
073120200423              (AAH-INVESTMENT-SW-OUT OR AAH-INVESTMENT-SW-IN)
073130200423                INITIALIZE FXAH-PARMS
073140200423                MOVE PLACEMENT-DATE OF TRANS TO FXAH-PLACEMENT-DATE
073150200423                MOVE TRANS-NO OF TRANS       TO FXAH-TRANS-NO
073160200423                MOVE LT-AASWITCH             TO FXAH-USER
073170200423                MOVE "G"                     TO FXAH-OPER-FLAG
073180200423                CALL "FXAAHTRN" USING FXAH-PARMS
073190200423
073200200423                IF TRN-EXISTS       AND
073210200423                  (FXAH-USER = LT-AASWITCH  OR
073220200423                   FXAH-USER = LT-AAREBAL1  OR
073230200423      * RFS91768 - Begin
073240200423                   FXAH-USER = LT-AAREBAL2)
073250200423      * RFS91768 - End
073260200423                  MOVE "Y"      TO WS-TRADE-ON-HOLDING-AASWITCH.
073270200423      * RFS14710 - End
073280200423
073290200423      *RFS 16522 Begin
073300200423      * If mode 'U',
073310200423      * If switch OUT transaction - and it is in TRANS-ASSET-ALLOC-HEADER, then
073320200423      * we need to put 'Y' to field WS-PROCESS-AAP-EXCEPTION
073330200423
073340200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "A" AND
073350200423           SWITCH-OUT-TRANSACTION AND
073360200423           PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES
073370200423           IS NOT EQUAL TO "3" AND
073380200423           PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES
073390200423           IS NOT EQUAL TO "4"
073400200423
073410200423               MOVE "Y"    TO WS-PROCESS-AAP-EXCEPTION
073420200423
073430200423               MOVE PLACEMENT-DATE OF TRANS
073440200423                                   TO PLACEMENT-DATE
073450200423                                   OF TRANS-ASSET-ALLOC-HEADER
073460200423
073470200423               MOVE TRANS-NO OF TRANS
073480200423                                   TO TRANS-NO
073490200423                                   OF TRANS-ASSET-ALLOC-HEADER
073500200423
073510200423               READ TRANS-ASSET-ALLOC-HEADER
073520200423                   INVALID KEY
073530200423                   MOVE "N"        TO WS-PROCESS-AAP-EXCEPTION
073540200423               END-READ
073550200423
073560200423           ELSE
073570200423               IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "A" AND
073580200423               SWITCH-IN-TRANSACTION AND
073590200423               PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES = "3"
073600200423                  MOVE "Y" TO WS-PROCESS-AAP-EXCEPTION
073610200423               ELSE
073620200423                  MOVE "N"    TO WS-PROCESS-AAP-EXCEPTION
073630200423               END-IF
073640200423           END-IF.
073650200423
073660200423      *RFS 16522 End
073670200423
073680200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "A"
073690200423      *RFS 16522 Begin
073700200423           AND WS-PROCESS-AAP-EXCEPTION = "N"
073710200423      *RFS 16522 End
073720200423      * RFS 15658 Begin
073730200423      *      IF PRODUCT-TYPE-RULE IS EQUAL TO "3" OR "4"
073740200423             IF PRODUCT-TYPE-RULE
073750200423                OF PRODUCT-TYPE-CODES IS EQUAL TO "3" OR "4"
073760200423      * RFS 15658 End
073770200423      * RFS 13471 - Begin (For the "FEE","DIR" .. - do not reject)
073780200423               IF TRANS-TYPE-CODE   OF TRANS = "FEE"        AND
073790200423      * RFS 13587 - Begin (Also do not reject if adjustment fee)
073800200423      *           MANAGMENT-FEE-ON
073810200423      * RFS 17019 Begin
073820200423                 (MANAGMENT-FEE-ON  OR
073830200423                  ADJUSTMENT-FEE-ON OR
073840200423                  SPEC-MOD-AUTH-MFEAMS)
073850200423      * RFS 17019 End
073860200423      * RFS 13587 - End
073870200423                 PERFORM GET-ACCOUNT-NO
073880200423                 IF WS-ACCOUNT-EXISTS = "Y"
073890200423                   PERFORM GET-CONTR-REDEM-CODE-RULE
073900200423      * RFS18779 - Begin
073910200423                   MOVE WS-CURR-CONTR-REDEM-CODE-RULE  TO
073920200423                        WS-CONTR-REDEM-CODE-FEE-FLAG
073930200423      * RFS18779 - End
073940200423                   IF WS-CONTR-REDEM-CODE-RULE-FEE
073950200423                     GO TO VTR-0012
073960200423                   END-IF
073970200423                 END-IF
073980200423               END-IF
073990200423      * RFS 13471 - End
074000200423      * RFS 17117 begin
074010200423               IF WS-TRADE-ON-HOLDING = "Y"
074020200423                  GO TO VTR-0012
074030200423               END-IF
074040200423      * RFS 17117 end
074050200423      * RFS20883 - Begin
074060200423               IF NOT SWITCH-TRANSACTION    AND
074070200423                  WS-GEN-TRADES-ON-HLD      AND
074080200423                  PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES = "4"
074090200423                    GO TO VTR-0012A
074100200423               END-IF
074110200423      * RFS20883 - End
074120200423      * RFS14710 - Begin
074130200423               IF WS-TRADE-ON-HOLDING-AASWITCH NOT = LT-Y
074140200423      * RFS14710 - End
074150200423                 MOVE "44"       TO REJECTION-CODE OF TRANS
074160200423                 GO TO VTR-EXIT
074170200423      * RFS14710 - Begin
074180200423               END-IF
074190200423      * RFS14710 - End
074200200423             END-IF
074210200423      * RFS14710 - Begin
074220200423             IF WS-TRADE-ON-HOLDING-AASWITCH NOT = LT-Y
074230200423      * RFS14710 - End
074240200423               GO TO VTR-0012
074250200423      * RFS14710 - Begin
074260200423             END-IF
074270200423      * RFS14710 - End
074280200423           END-IF.
074290200423
074300200423      * RFS20883 - Begin
074310200423       VTR-0012A.
074320200423      * RFS20883 - End
074330200423
074340200423      * RFS 17117 begin
074350200423           IF WS-TRADE-ON-HOLDING = "Y"
074360200423              GO TO VTR-0012
074370200423           END-IF.
074380200423      * RFS 17117 end
074390200423
074400200423      *RFS 16522 Begin
074410200423      * Asset Allocation Sequencing logic
074420200423      *RFS 16522 End
074430200423
074440200423           MOVE PLACEMENT-DATE OF TRANS
074450200423                               TO PLACEMENT-DATE
074460200423                               OF TRANS-ASSET-ALLOC-HEADER.
074470200423
074480200423           MOVE TRANS-NO OF TRANS
074490200423                               TO TRANS-NO
074500200423                               OF TRANS-ASSET-ALLOC-HEADER.
074510200423
074520200423           READ TRANS-ASSET-ALLOC-HEADER
074530200423           INVALID KEY
074540200423               MOVE "41"       TO REJECTION-CODE OF TRANS
074550200423               GO TO VTR-EXIT.
074560200423
074570200423           MOVE ALLOCATION-NO  OF TRANS-ASSET-ALLOC-HEADER
074580200423                               TO ALLOCATION-NO
074590200423                               OF ASSET-ALLOCATION-HEADER.
074600200423
074610200423           READ ASSET-ALLOCATION-HEADER WITH NO LOCK
074620200423           INVALID KEY
074630200423               MOVE "41"       TO REJECTION-CODE OF TRANS
074640200423               GO TO VTR-EXIT.
074650200423
074660200423           IF SWITCH-OUT-TRANSACTION AND
074670200423           LAST-ALLOC-PROCESSED OF ASSET-ALLOCATION-HEADER
074680200423           IS NOT EQUAL (PROCESS-SEQUENCE OF
074690200423           TRANS-ASSET-ALLOC-HEADER - 1)
074700200423               MOVE "42"       TO REJECTION-CODE OF TRANS
074710200423               GO TO VTR-EXIT
074720200423           END-IF
074730200423
074740200423           MOVE "R"            TO WRITE-ALLOCATION-HEADER.
074750200423      * RFS23020 Begin
074760200423           MOVE "Y"            TO WS-ASSET-ALLOC-HDR-FND.
074770200423      * RFS23020 End
074780200423
074790200423      * RFS19210 - Begin: Do validation only if AAP-STF-ACC-SEP= "A"
074800200423      *            and AAP-AAH investment
074810200423      * RFS17180 - Begin
074820200423      * RFS20263 - Begin
074830200423      *    IF SYSPARM-AAP-STF-ACC-SEP = LT-A   AND
074840200423           IF (SYSPARM-AAP-STF-ACC-SEP = LT-A OR
074850200423               SYSPARM-AAP-STF-ACC-SEP = LT-ONE-ACTIVE-AAP-MASTER-ACC)
074860200423                                               AND
074870200423      * RFS20263 - End
074880200423              AAP-AAH-INVESTMENT
074890200423             PERFORM SET-LAST-TRANSACTION-FLAG
074900200423             PERFORM SET-ALL-UNITS-TO-OTHER-PH
074910200423      *RFS112508 STARTS
074920200423      *RFS158477 STARTS
074930200423148978*      IF SELL-TRANSACTION
074940200423148978*      IF SELL-TRANSACTION AND SETTLED
074950200423      *         CONTINUE
074960200423      *      ELSE
074970200423      *RFS158477 ENDS
074980200423      *RFS112508 ENDS
074990200423             PERFORM VALIDATE-ACTIVE-PHANTOM
075000200423             IF REJECTION-CODE OF TRANS NOT = "00"
075010200423               GO TO VTR-EXIT.
075020200423      * RFS17180 - End
075030200423      * RFS19210 - End
075040200423
075050200423       VTR-0012.
075060200423      * RFS32873 - Begin
075070200423           MOVE DEALER-CODE OF TRANS         TO
075080200423                           DEALER-CODE OF DEALER-COMMISSIONS
075090200423           MOVE CURRENCY-DDS OF INVESTMENT   TO
075100200423                           CURRENCY-DDS OF DEALER-COMMISSIONS
075110200423
075120200423           READ DEALER-COMMISSIONS
075130200423           INVALID KEY
075140200423             INITIALIZE MFADEACMP OF DEALER-COMMISSIONS
075150200423           END-READ.
075160200423      * RFS32873 - End
075170200423
075180200423           MOVE INDUSTRY-FUND-CODE OF INVESTMENT
075190200423                               TO INDUSTRY-FUND-CODE OF TRANS.
075200200423
075210200423
075220200423           IF INVESTMENT-CODE OF INVESTMENT IS NOT EQUAL
075230200423           INVESTMENT-CODE OF INVESTMENT-CDSC-CALC-RULES
075240200423             MOVE "N"          TO WS-NO-CALC-RULES
075250200423             MOVE INVESTMENT-CODE OF INVESTMENT
075260200423                               TO INVESTMENT-CODE
075270200423                               OF INVESTMENT-CDSC-CALC-RULES
075280200423             READ INVESTMENT-CDSC-CALC-RULES
075290200423             INVALID KEY
075300200423               INITIALIZE MFAINVCRP
075310200423               MOVE INVESTMENT-CODE OF INVESTMENT
075320200423                               TO INVESTMENT-CODE
075330200423                               OF INVESTMENT-CDSC-CALC-RULES
075340200423               MOVE "Y"        TO WS-NO-CALC-RULES
075350200423               GO TO VTR-0011
075360200423             END-READ
075370200423           END-IF.
075380200423
075390200423           MOVE TRANSFER-FINANCER-OR-LIABILITY
075400200423                               OF INVESTMENT-CDSC-CALC-RULES
075410200423                               TO TRANSF-FIN-OR-LIAB.
075420200423
075430200423           MOVE CDSC-PAID-BY
075440200423                               OF INVESTMENT-CDSC-CALC-RULES
075450200423                               TO CDSC-IS-PAID-BY.
075460200423
075470200423           MOVE CDSC-METHOD
075480200423                               OF INVESTMENT-CDSC-CALC-RULES
075490200423                               TO CDSC-METHOD88.
075500200423      * RFS32873 - Begin
075510200423
075520200423           IF lncc_editCLWBCK                       AND
075530200423              account-lev-dsc                       AND
075540201223      *RFS180707 - Starts
075550201223              lnc_ACINDSCNo                         AND
075560201223      *RFS180707 - Ends
075570200423              CDSC-PAID-BY-DEALER                   AND
075580200423              CDSC-CALC-METHOD OF INVESTMENT = lncc_backEndLoad AND
075590200423              NOT COMMISSION-RECOVERY
07560020042332873 * defect #11 - begin
07561020042332873 *       COMMISSION-RECOVERY-ON
07562020042332873 * defect #11 - end
075630200423             EVALUATE TRUE
075640200423               WHEN SELL-TRANSACTION
075650200423                 SET lncc_clawbackLLOn   TO TRUE
075660200423               WHEN SWO-TRANSACTION
075670200423      * Check for the "X" if to-back-end-fund:
075680200423                 IF TO-BACK-END-LOAD
075690200423                   CALL "FXGETINVSW" USING
075700200423                     INVESTMENT-CODE OF WS-TRANS-REC-2
075710200423                     INVESTMENT-CODE OF WS-TRANS-REC-1
075720200423                     pc_GetinvswRec
075730200423                     pc_GetinvswRetnCode
075740200423                     pc_GetinvswRetnDescr
075750200423                   IF STANDARD-COMMISSION OF pc_GetinvswRec = lncc_X
075760200423                     SET lncc_clawbackLLOn   TO TRUE
075770200423                   END-IF
075780200423                 ELSE
075790200423                   SET lncc_clawbackLLOn   TO TRUE
075800200423                 END-IF
075810200423             END-EVALUATE
075820200423           END-IF.
075830200423
07584020042332873 ** defect #10 - begin
075850200423           IF lncc_editCLWBCK                       AND
075860200423              account-lev-dsc                       AND
075870201223      *RFS180707 - Starts
075880201223              lnc_ACINDSCNo                         AND
075890201223      *RFS180707 - Ends
075900200423              CDSC-PAID-BY-UNITHOLDER               AND
075910200423              CDSC-CALC-METHOD OF INVESTMENT = lncc_backEndLoad AND
075920200423              NOT COMMISSION-RECOVERY               AND
075930200423              SWO-TRANSACTION                       AND
075940200423              TO-BACK-END-LOAD
075950200423      * Check for the "X" if to-back-end-fund:
075960200423                 CALL "FXGETINVSW" USING
075970200423                     INVESTMENT-CODE OF WS-TRANS-REC-2
075980200423                     INVESTMENT-CODE OF WS-TRANS-REC-1
075990200423                     pc_GetinvswRec
076000200423                     pc_GetinvswRetnCode
076010200423                     pc_GetinvswRetnDescr
076020200423                 IF STANDARD-COMMISSION OF pc_GetinvswRec = lncc_X
076030200423                     SET lncc_clawbackBEOn   TO TRUE
076040200423                 END-IF
076050200423           END-IF.
076060200423      *RFS129787 - start
076070200423           IF SWITCH-OUT-TRANSACTION                            AND
076080200423              CDSC-CALC-METHOD OF INVESTMENT = lncc_backEndLoad AND
076090200423              TO-BACK-END-LOAD                                  AND
076100200423              NOT lncc_clawbackBEOn                             AND
076110200423              NOT lncc_clawbackLLOn
076120200423                  CALL "FXGETINVSW" USING
076130200423                      INVESTMENT-CODE OF WS-TRANS-REC-2
076140200423                      INVESTMENT-CODE OF WS-TRANS-REC-1
076150200423                      pc_GetinvswRec
076160200423                      pc_GetinvswRetnCode
076170200423                      pc_GetinvswRetnDescr
076180200423                  IF STANDARD-COMMISSION OF pc_GetinvswRec = lncc_X
076190200423                      SET lb_OptionXOn        TO TRUE
076200200423                  END-IF
076210200423           END-IF.
076220200423      *RFS129787 - end
07623020042332873 ** defect #10 - end
076240200423      * RFS32873 - End
076250200423      * RFS46125 - set up new flag indicating if it is Death claim switch
076260200423           IF SWITCH-OUT-TRANSACTION                            AND
076270200423              CDSC-CALC-METHOD OF INVESTMENT = lncc_backEndLoad AND
076280200423              TO-BACK-END-LOAD                                  AND
076290200423              lnc_origCodeDth
076300200423             SET lncc_deathClaims  TO TRUE
076310200423           END-IF.
076320200423      * RFS46125 - End
076330200423
076340200423        VTR-0011.
076350200423
076360200423           IF CDSC-CALC-METHOD OF INVESTMENT IS EQUAL TO "R"
076370200423             IF WS-NO-CALC-RULES = "Y"
076380200423               MOVE "45"       TO REJECTION-CODE OF TRANS
076390200423               GO TO VTR-EXIT
076400200423             END-IF
076410200423           END-IF.
076420200423
076430200423      *GIC MOD
076440200423
076450200423           IF PASS-CDSC-CALCULATOR = "Q"
076460200423             IF NOT GIC-DII-INVESTMENT
076470200423               MOVE "04"       TO REJECTION-CODE OF TRANS
076480200423               GO TO VTR-EXIT
076490200423             END-IF
076500200423           END-IF.
076510200423      *END GIC MOD
076520200423
076530200423R27609     MOVE "N" TO EC-WOR-FLAG.
076540200423           MOVE CDSC-CALC-METHOD OF INVESTMENT
076550200423                               TO FUND-LOAD.
076560200423           MOVE FIXED-OR-VARIABLE OF INVESTMENT-GROUP
076570200423                               TO FUND-TYPE-CODE.
076580200423      *RFS17685 Start
076590200423           IF BACKDATED-TRADE
076600200423             IF (DISTR-FREQ OF INVESTMENT-GROUP = "MO" AND
076610200423                TRADE-DATE OF TRANS > PDDA-LAST-MONTH-END) OR
076620200423                (DISTR-FREQ OF INVESTMENT-GROUP = "QT" AND
076630200423                TRADE-DATE OF TRANS > PDDA-LAST-QUARTER-END)
076640200423      * RFS 1027849 - Start
076650200423      * RFS 182531 - Start
076660200423      *         OR
076670200423      *         (DISTR-FREQ OF INVESTMENT-GROUP = "MO" AND
076680200423      *          TRADE-DATE OF TRANS <= PDDA-LAST-MONTH-END)
076690200423      *         OR
076700200423      *         (DISTR-FREQ OF INVESTMENT-GROUP = "QT" AND
076710200423      *          TRADE-DATE OF TRANS <= PDDA-LAST-QUARTER-END)
076720200423      * RFS 182531 - End
076730200423      * RFS 1027849 - End
076740200423
076750200423      * RFS 182531 - Start
076760200423                OR
076770200423                (DISTR-FREQ OF INVESTMENT-GROUP = "MO" AND
076780200423                 TRADE-DATE OF TRANS <= PDDA-LAST-MONTH-END)
076790200423                OR
076800200423                (DISTR-FREQ OF INVESTMENT-GROUP = "QT" AND
076810200423                 TRADE-DATE OF TRANS <= PDDA-LAST-QUARTER-END)
076820200423      * RFS 182531 - End
076830200423                  MOVE "C" TO BACKDATED-FLAG
076840200423R27609            IF NOT SPEC-MOD-AUTH-MMINTA AND
076850200423R27609               TRANS-ORIGIN-CODE OF TRANS = "WOR" AND
076860200423      * RFS 1027849 - Start
076870200423      * RFS 1016514 - Start
076880200423      *              EC-BUY-SELL-TRANSACTION
076890200423                     (EC-BUY-SELL-TRANSACTION OR
076900200423                     SWO-SWI-TRANSACTION)
076910200423      * RFS 1016514 - End
076920200423
076930200423      * RFS 1016514 - Start
076940200423R27609*              EC-BUY-SELL-TRANSACTION
076950200423      *              (EC-BUY-SELL-TRANSACTION OR
076960200423      *              SWO-SWI-TRANSACTION)
076970200423      * RFS 1016514 - End
076980200423      * RFS 1027849 - End
076990200423R27609               PERFORM CHK-AOT-REV
077000200423R27609            END-IF
077010200423             ELSE
077020200423                  MOVE "P" TO BACKDATED-FLAG
077030200423             END-IF
077040200423           END-IF.
077050200423      *RFS17685 End
077060200423
077070200423           IF HH-FEE-ACTIVE
077080200423             IF INVESTMENT-CODE OF TRANS IS NOT EQUAL
077090200423             INVESTMENT-CODE OF INVESTMENT-REDEM-FEE-SCHED
077100200423               MOVE INVESTMENT-CODE OF TRANS
077110200423                               TO INVESTMENT-CODE
077120200423                               OF INVESTMENT-REDEM-FEE-SCHED
077130200423               MOVE "Y"        TO WS-HH-RATES-APPLY
077140200423               READ INVESTMENT-REDEM-FEE-SCHED
077150200423               INVALID KEY
077160200423                 MOVE "N"      TO WS-HH-RATES-APPLY
077170200423               END-READ
077180200423             END-IF
077190200423           END-IF.
077200200423
077210200423           IF SWITCH-IN-TRANSACTION
077220200423             MOVE CDSC-CALC-METHOD OF INVESTMENT
077230200423                               TO TO-FUND-LOAD
077240200423             MOVE WS-HH-RATES-APPLY
077250200423                               TO TO-HHFEE-TYPE
077260200423           ELSE IF NOT SWITCH-OUT-TRANSACTION
077270200423      * RFS 16941 - Begin
077280200423               IF WS-SEL-BW-ENV
077290200423                   MOVE "R"        TO TO-FUND-LOAD
077300200423                   MOVE SPACE      TO TO-HHFEE-TYPE
077310200423               ELSE
077320200423                   MOVE SPACE      TO TO-FUND-LOAD
077330200423                                   TO-HHFEE-TYPE
077340200423               END-IF
077350200423      * RFS 16941 - End
077360200423           END-IF.
077370200423
077380200423           IF SWITCH-OUT-TRANSACTION
077390200423             MOVE CDSC-CALC-METHOD OF INVESTMENT
077400200423                               TO FROM-FUND-LOAD
077410200423             MOVE WS-HH-RATES-APPLY
077420200423                               TO FROM-HHFEE-TYPE
077430200423           ELSE IF NOT SWITCH-IN-TRANSACTION
077440200423             MOVE SPACE        TO FROM-FUND-LOAD
077450200423                                  FROM-HHFEE-TYPE
077460200423           END-IF.
077470200423
077480200423      *RFS182952 START
077490200423           IF BACK-END-LOAD AND ACCOUNT-LEV-DSC
077500201223      *RFS180707 - Starts
077510201223           AND lnc_ACINDSCNo
077520201223      *RFS180707 - Ends
077530200423              MOVE TRADE-DATE OF TRANS TO WS-TRADE-DATE
077540200423              MOVE INVESTMENT-CODE OF INVESTMENT TO WS-INVESTMENT-CODE
077550200423              PERFORM getInvestmentFinancer
077560200423              MOVE FINANCER-CODE OF INVESTMENT-FINANCER
077570200423                TO FINANCER-CODE OF FINANCER-CDSC-INSTRUCTIONS
077580200423              PERFORM readFinancerCdscInstructions
077590200423           END-IF.
077600200423      *RFS182952 END
077610201223      * RFS185174 - Start: set up flag FLDALF
077620201223           PERFORM getFLDALFFlag.
077630201223      * RFS185174 - End
077640200423      *RFS64348 - Begin
077650200423           IF lc_ModuleSRVFEEOn
077660200423              PERFORM GET-EFFECTIVE-DATE-RULE
077670200423              IF SWITCH-OUT-TRANSACTION
077680200423                 MOVE lc_effectiveDateRule TO
077690200423                      lc_FromFundEffectiveDateRule
077700200423              ELSE
077710200423                 MOVE lc_effectiveDateRule TO
077720200423                      lc_ToFundEffectiveDateRule
077730200423              END-IF
077740200423           END-IF.
077750200423      *RFS64348 - End
077760200423      * Switch transactions are permitted within locked in accounts
077770200423      * This logic removes the locked in from the account for this
077780200423      * transaction
077790200423
077800200423           MOVE GROSS-OR-NET OF TRANS
077810200423                               TO TRANS-GROSS-NET.
077820200423
077830200423           MOVE SPLIT-OPTION-CODE OF TRANS
077840200423                               TO TRANS-SPLIT-OPTION-CATAGORY.
077850200423
077860200423           IF (SWITCH-OUT-TRANSACTION)
077870200423      * RFS 15658 Begin
077880200423      *      IF (PRODUCT-TYPE-RULE IS EQUAL TO "3"
077890200423      *      OR  PRODUCT-TYPE-RULE IS EQUAL TO "4")
077900200423             IF (PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES = "3"
077910200423             OR  PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES = "4")
077920200423      * RFS 15658 End
077930200423               IF TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "ARA"
077940200423                 PERFORM POPULATE-INHERITANCE-AMOUNTS
077950200423                 IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
077960200423                   GO TO VTR-EXIT
077970200423                 END-IF
077980200423               END-IF
077990200423             END-IF
078000200423           END-IF.
078010200423      *---------------------------------------------------------
078020200423      *Trade date is invalid - not priced
078030200423      *---------------------------------------------------------
078040200423
078050200423      * For non income or capital gains transactions that
078060200423      * occur for money market funds there should be no unit amount
078070200423      * calculated -- the price is always 0 - RH
078080200423
078090200423           IF (CAPITAL-GAIN-TRANSACTION) AND
078100200423           FIXED-OR-VARIABLE OF INVESTMENT-GROUP = "F"
078110200423             MOVE ZEROES      TO UNIT-PRICE OF INVESTMENT-UNIT-PRICE
078120200423             GO TO VTR-0013
078130200423           END-IF.
078140200423
078150200423      * For notional distribution there should be no unit amount
078160200423      * calculated -- the price is always 0 - RH
078170200423
078180200423AA    * CHECK TO SEE IF THIS INVESTMENT IS RUNNING NOTIONAL
078190200423AA    * DISTRIBUTIONS
078200200423
078210200423AA         MOVE "S"      TO WS-NOTIONAL-DISTRIB.
078220200423AA         IF INCOME-TRANSACTION OR CAPITAL-GAIN-TRANSACTION
078230200423           OR CAPITAL-LOSS-TRANSACTION
078240200423AA             MOVE INVESTMENT-CODE OF INVESTMENT
078250200423AA                           TO INVESTMENT-CODE
078260200423AA                           OF INVESTMENT-NOTIONAL-DIST-DTLS
078270200423AA             READ INVESTMENT-NOTIONAL-DIST-DTLS
078280200423AA             NOT INVALID KEY
078290200423AA             MOVE NOTIONAL-DISTRIBUTION
078300200423AA                           OF INVESTMENT-NOTIONAL-DIST-DTLS
078310200423AA                           TO WS-NOTIONAL-DISTRIB
078320200423AA             END-READ
078330200423AA         END-IF.
078340200423
078350200423           IF WS-NOTIONAL-DISTRIB IS EQUAL "N" OR
078360200423           CAPITAL-LOSS-TRANSACTION
078370200423             MOVE ZEROES      TO UNIT-PRICE OF INVESTMENT-UNIT-PRICE
078380200423             GO TO VTR-0013
078390200423           END-IF.
078400200423
078410200423      *GIC MOD
078420200423
078430200423           IF GIC-DII-INVESTMENT
078440200423             MOVE 1.0000    TO UNIT-PRICE OF INVESTMENT-UNIT-PRICE
078450200423             GO TO VTR-0013
078460200423           END-IF.
078470200423
078480200423      *END GIC MOD
078490200423
078500200423           MOVE TRADE-DATE OF TRANS
078510200423                               TO TRADE-DATE OF INVESTMENT-UNIT-PRICE.
078520200423           MOVE INVESTMENT-CODE OF TRANS
078530200423                          TO INVESTMENT-CODE OF INVESTMENT-UNIT-PRICE.
078540200423
078550200423           IF (NOT DISTRIBUTION-TRANSACTION) OR INTEREST-TRANSACTION
078560200423           OR MAN-FEE-REB-TRANSACTION
078570200423             MOVE " "      TO DISTRIBUTION-FLAG OF INVESTMENT-UNIT-PRICE
078580200423           ELSE
078590200423             MOVE "Y"      TO DISTRIBUTION-FLAG OF INVESTMENT-UNIT-PRICE
078600200423           END-IF.
078610200423
078620200423      ** THIS LOGIC ADDED TO SO THAT MERGER TRANSACTION, NOTIONAL DIST,
078630200423      ** DISTRIBUTION REPURCHASE TRANSACTIONS ARE PROCESSED USING
078640200423      ** X DIVIDEND PRICE
078650200423
078660200423110607*    IF TRANS-ORIGIN-CODE OF TRANS = "MRG"          OR
078670200423110607*       TRANS-ORIGIN-CODE OF TRANS = "DSR"          OR
078680200423110607     IF TRANS-ORIGIN-CODE OF TRANS = "DSR"          OR
078690200423              TRANS-ORIGIN-CODE OF TRANS = "FCR"          OR
078700200423              TRANS-ORIGIN-CODE OF TRANS = "FCP"          OR
078710200423              TRANS-ORIGIN-CODE OF TRANS = "NDS"
078720200423
078730200423             MOVE "Y"                 TO DISTRIBUTION-FLAG
078740200423                                      OF INVESTMENT-UNIT-PRICE
078750200423
078760200423             READ INVESTMENT-UNIT-PRICE
078770200423             KEY IS EXTERNALLY-DESCRIBED-KEY
078780200423             INVALID KEY
078790200423               MOVE " "      TO DISTRIBUTION-FLAG
078800200423                             OF INVESTMENT-UNIT-PRICE
078810200423               MOVE TRADE-DATE OF TRANS
078820200423                             TO TRADE-DATE OF INVESTMENT-UNIT-PRICE
078830200423               MOVE INVESTMENT-CODE OF TRANS
078840200423                             TO INVESTMENT-CODE OF INVESTMENT-UNIT-PRICE
078850200423             NOT INVALID KEY
078860200423               GO TO VTR-0013
078870200423             END-READ
078880200423
078890200423           END-IF.
078900200423
078910200423           READ INVESTMENT-UNIT-PRICE
078920200423             KEY IS EXTERNALLY-DESCRIBED-KEY
078930200423             INVALID KEY
078940200423               MOVE "05"       TO REJECTION-CODE OF TRANS
078950200423               GO TO VTR-EXIT.
078960200423
078970200423           IF UNIT-PRICE OF INVESTMENT-UNIT-PRICE = 0
078980200423             MOVE "05"         TO REJECTION-CODE OF TRANS
078990200423             GO TO VTR-EXIT
079000200423           END-IF.
079010200423
079020200423      * RFS 92145 Start
079030200423           IF Man-Fee-Reb-Transaction AND NOT lb_MFRTransLoop
079040200423              AND Gross-Amt OF Trans = 0
079050200423              PERFORM CALCULATE-MFR-AMOUNT
079060200423           END-IF.
079070200423      * RFS 92145 End
079080200423
079090200423        VTR-0013.
079100200423           MOVE UNIT-PRICE OF INVESTMENT-UNIT-PRICE
079110200423                               TO UNIT-PRICE OF TRANS.
079120210216      * RFS185174.1 - Start: validate F,M,T For rule 1
079130210216           IF SWITCH-OUT-TRANSACTION
079140210216             PERFORM readInvestmentSwitchesControl
079150210216             IF FREE-AND-MATURED-RULE OF INVESTMENT-SWITCHES-CONTROL
079160210216                      = "1" AND NOT PLACED-NO-PRORATE-TYPE
079170210216               MOVE "79" TO REJECTION-CODE OF TRANS
079180210216                 GO TO VTR-EXIT
079190210216             END-IF
079200210216           END-IF.
079210210216      * RFS185174.1 - End
079220200423           IF PASS-CDSC-CALCULATOR = "C"
079230200423             GO TO VTR-0020
079240200423           END-IF.
079250200423      *---------------------------------------------------------
079260200423      *Dealer code is invalid
079270200423      *---------------------------------------------------------
079280200423           IF DEALER-CODE OF TRANS IS NOT EQUAL
079290200423           DEALER-CODE OF DEALER
079300200423             MOVE DEALER-CODE OF TRANS
079310200423                               TO DEALER-CODE OF DEALER
079320200423             READ DEALER
079330200423             INVALID KEY
079340200423               MOVE "07"       TO REJECTION-CODE OF TRANS
079350200423               MOVE SPACES     TO DEALER-CODE OF TRANS
079360200423               GO TO VTR-EXIT
079370200423             END-READ
079380200423           END-IF.
079390200423
079400200423      * RFS20311 Start
079410200423      * Perform dealer rep validations
079420200423           IF PURCHASE-TRANSACTION AND (NOT PURCHASE-ADJUSTMENT)
079430200423              AND (TRANS-ORIGIN-CODE OF TRANS IS NOT = "PAC")
079440200423              AND (WS-VALIDATE-REP-EXISTS = "Y" OR
079450200423                   WS-VALIDATE-REP-ACTIVE = "Y")
079460200423              MOVE DEALER-CODE     OF TRANS
079470200423                                   TO DEALER-CODE OF DEALER-REP
079480200423              MOVE DEALER-REP-CODE OF TRANS
079490200423                                   TO DEALER-REP-CODE OF DEALER-REP
079500200423              READ DEALER-REP
079510200423              INVALID KEY
079520200423      * Validate dealer-rep exists
079530200423                IF WS-VALIDATE-REP-EXISTS = "Y"
079540200423                  MOVE "R3" TO REJECTION-CODE OF TRANS
079550200423                  GO TO VTR-EXIT
079560200423                END-IF
079570200423              END-READ
079580200423      * Validate dealer-rep active
079590200423              IF WS-VALIDATE-REP-ACTIVE = "Y" AND
079600200423                 DEALER-REP-STATUS OF DEALER-REP IS NOT = "A"
079610200423R22008           AND TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "DCA"
079620200423                   MOVE "R2" TO REJECTION-CODE OF TRANS
079630200423                   GO TO VTR-EXIT
079640200423              END-IF
079650200423           END-IF.
079660200423      * RFS20311 End
079670200423
079680200423           IF DISTRIBUTION-TRANSACTION
079690200423129364        OR CAPITAL-LOSS-TRANSACTION
079700200423             GO TO VTR-0020
079710200423           END-IF.
079720200423
079730200423      *---------------------------------------------------------
079740200423      *Dealer status code does not permit trading
079750200423      *---------------------------------------------------------
079760200423           IF DEALER-STATUS-CODE OF DEALER IS NOT EQUAL
079770200423           DEALER-STATUS-CODE OF DEALER-STATUS
079780200423             MOVE DEALER-STATUS-CODE OF DEALER
079790200423                               TO DEALER-STATUS-CODE OF DEALER-STATUS
079800200423             READ DEALER-STATUS
079810200423             INVALID KEY
079820200423               MOVE "08"       TO REJECTION-CODE OF TRANS
079830200423               MOVE SPACES     TO DEALER-STATUS-CODE OF DEALER-STATUS
079840200423               GO TO VTR-EXIT
079850200423             END-READ
079860200423           END-IF.
079870200423
079880200423           IF AUTHORIZED-TO-TRADE OF DEALER-STATUS IS NOT EQUAL "Y"
079890200423             MOVE "08"       TO REJECTION-CODE OF TRANS
079900200423             GO TO VTR-EXIT
079910200423           END-IF.
079920200423
079930200423       VTR-0020.
079940200423      *---------------------------------------------------------
079950200423      * This section picks up the account and investor information
079960200423      * This information is required, with the exception of unconfirmed
079970200423      * wire orders, where the account number is optional
079980200423      *---------------------------------------------------------
079990200423
080000200423      *---------------------------------------------------------
080010200423      * Account is invalid
080020200423      *---------------------------------------------------------
080030200423      * RFS13471 - Begin
080040200423           PERFORM GET-ACCOUNT-NO
080050200423      * RFS40845 - Begin
080060200423           PERFORM get-account-type-rule
080070200423      * RFS40845 - End
080080200423      * RFS149211- Start
080090200423           IF PURCHASE-TRANSACTION AND UNCONFIRMED AND
080100200423             REJECTION-CODE OF TRANS IS EQUAL "09"
080110200423             MOVE "00"         TO REJECTION-CODE OF TRANS
080120200423             GO TO VTR-0030
080130200423           END-IF.
080140200423
080150200423           IF REJECTION-CODE OF TRANS IS EQUAL "09"
080160200423             GO TO VTR-EXIT
080170200423           END-IF.
080180200423      * RFS149211- End
080190200423      * RFS 114854 START
080200200423             MOVE INVESTOR-NO OF ACCOUNT TO INVESTOR-NO OF MFAIVRATP
080210200423             MOVE "TXWAV" TO INVESTOR-ATTRIBUTE-CODE OF MFAIVRATP
080220200423
080230200423                 READ INVESTOR-ATTRIBUTES
080240200423                 INVALID KEY
080250200423                 SET WS_TXWAV_NO TO TRUE
080260200423                 NOT INVALID KEY
080270200423                 SET WS_TXWAV_YES TO TRUE
080280200423                 END-READ
080290200423      * RFS 114854 END.
080300200423      * RFS13471 - End
080310200423
080320200423      * RFS149211 - Start
080330200423      *    IF PURCHASE-TRANSACTION AND UNCONFIRMED AND
080340200423      *      REJECTION-CODE OF TRANS IS EQUAL "09"
080350200423      *      MOVE "00"         TO REJECTION-CODE OF TRANS
080360200423      *      GO TO VTR-0030
080370200423      *    END-IF.
080380200423      *
080390200423      *    IF REJECTION-CODE OF TRANS IS EQUAL "09"
080400200423      *      GO TO VTR-EXIT
080410200423      *    END-IF.
080420200423      *
080430200423      * RFS149211 - End
080440200423R30134*** Validate Account Activity for SYSTEMATIC PLANS
080450200423           IF lc_Accact_Flag = LT-Y AND
080460200423              WS-ACCOUNT-EXISTS = LT-Y
080470200423              IF Stop-Activity OF Account = LT-Y AND
080480200423                 (AWD OR PAC OR AWR OR GRP OR DCA OR DSR OR TRK )
080490200423
080500200423      * 52265 - defect 2 fix - begins.
080510200423                MOVE lncc_N TO lc_Bypass
080520200423
080530200423                IF NOT SWITCH-OUT-TRANSACTION  AND
080540200423                   NOT SWITCH-IN-TRANSACTION
080550200423                   MOVE lncc_4 TO lc_Exemption_Rule
080560200423                   PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
080570200423                END-IF
080580200423
080590200423                IF SWITCH-OUT-TRANSACTION  OR
080600200423                   SWITCH-IN-TRANSACTION
080610200423                   IF (SWITCH-OUT-TRANSACTION  AND
080620200423                       ACCOUNT-NO OF TRANS IS EQUAL TO
080630200423                       ACCOUNT-NO OF WS-TRANS-REC-1) OR
080640200423                      (SWITCH-IN-TRANSACTION  AND
080650200423                       ACCOUNT-NO OF TRANS IS EQUAL TO
080660200423                       ACCOUNT-NO OF WS-TRANS-REC-2)
080670200423
080680200423                         MOVE lncc_14 TO lc_Exemption_Rule
080690200423                         PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
080700200423                   END-IF
080710200423                END-IF
080720200423
080730200423                 IF lc_Bypass = lncc_N
080740200423                 MOVE "18" TO Rejection-Code OF Trans
080750200423                 GO TO VTR-EXIT
080760200423                 END-IF
080770200423              END-IF
080780200423
080790200423              IF Stop-Purchase OF Account = LT-Y AND
08080020042334401            (PAC OR DCA OR AWR OR GRP OR TRK OR DSR) AND
08081020042334401            PURCHASE-TRANSACTION
080820200423
080830200423                MOVE lncc_N TO lc_Bypass
080840200423
080850200423                IF NOT SWITCH-IN-TRANSACTION
080860200423                   MOVE lncc_2 TO lc_Exemption_Rule
080870200423                   PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
080880200423                END-IF
080890200423
080900200423                IF SWITCH-IN-TRANSACTION
080910200423                   IF ACCOUNT-NO OF TRANS IS EQUAL TO
080920200423                      ACCOUNT-NO OF WS-TRANS-REC-2
080930200423
080940200423                         MOVE lncc_12 TO lc_Exemption_Rule
080950200423                         PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
080960200423                   END-IF
080970200423                END-IF
080980200423
080990200423                 IF lc_Bypass = lncc_N
081000200423                 MOVE "15" TO Rejection-Code OF Trans
081010200423                 GO TO VTR-EXIT
081020200423                 END-IF
081030200423              END-IF
081040200423
081050200423              IF Stop-Redem OF Account = LT-Y AND
08106020042334401            (AWD OR DCA ) AND REDEMPTION-TRANSACTION
081070200423
081080200423                MOVE lncc_N TO lc_Bypass
081090200423
081100200423                IF NOT SWITCH-OUT-TRANSACTION
081110200423                   MOVE lncc_3 TO lc_Exemption_Rule
081120200423                   PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
081130200423                END-IF
081140200423
081150200423                IF SWITCH-OUT-TRANSACTION
081160200423                   IF ACCOUNT-NO OF TRANS IS EQUAL TO
081170200423                      ACCOUNT-NO OF WS-TRANS-REC-1
081180200423
081190200423                         MOVE lncc_13 TO lc_Exemption_Rule
081200200423                         PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
081210200423                   END-IF
081220200423                END-IF
081230200423
081240200423                 IF lc_Bypass = lncc_N
081250200423                 MOVE  "16" TO Rejection-Code OF Trans
081260200423                 GO TO VTR-EXIT
081270200423                 END-IF
081280200423      * 52265 - defect 2 fix - ends.
081290200423              END-IF
081300200423R30134     END-IF.
081310200423
081320200423      * RFS18779 - Begin
081330200423           PERFORM GET-CONTR-REDEM-CODE-RULE
081340200423      * RFS18779 - End
081350200423
081360200423      * Switch transactions are permitted within locked in accounts
081370200423      * This logic removes the locked in from the account for this
081380200423      * transaction
081390200423
081400200423           IF (SWITCH-OUT-TRANSACTION) AND
081410200423           LOCKED-IN OF ACCOUNT IS EQUAL TO "Y" AND
081420200423      *RFS 180682 START
081430200423      *    ACCOUNT-NO OF TRANS IS EQUAL TO ACCOUNT-NO OF WS-TRANS-REC-1
081440200423           (ACCOUNT-NO OF TRANS IS EQUAL TO ACCOUNT-NO OF WS-TRANS-REC-1
081450200423      *Temporarily remove locked-in from the account for this transaction
081460200423      *if transaction is generated by auto-transfer process
081470200714      *     OR ENTERED-BY OF TRANS = "AUTTFR")
081480200714      *RFS 183812 START
081490200714            OR ENTERED-BY OF TRANS = lncc_YEAUTTFR
081500200714            OR ENTERED-BY OF TRANS = lncc_ONAUTTFR
081510200714            OR ENTERED-BY OF TRANS = lncc_MTAUTTFR)
081520200714      *RFS 183812 END
081530200423      *RFS 180682 END
081540200423             MOVE "N"          TO LOCKED-IN OF ACCOUNT
081550200423           END-IF.
081560200423
081570200423      *RFS 13306 BEGIN
081580200423           INITIALIZE MFAACCNMP OF ACCOUNT-NOM-REC.
081590200423      *RFS 13306 END
081600200423
081610200423      *RFS52816 - Begin
081620200423           INITIALIZE MFAACCTYP OF ACCOUNT-TYPE-NOMINEE-REC
081630200423      *RFS52816 - End
081640200423           IF PRODUCT-TYPE-CODE OF INVESTMENT NOT = "SEG" AND
081650200423           (NOT DISTRIBUTION-TRANSACTION OR
081660200423           NOMINEE OF ACCOUNT IS NOT EQUAL TO "Y")  AND
081670200423      * RFS 8058 BEGIN
081680200423           NOT ACCOUNT-TYPE-PCT-FREE
081690200423      * RFS 8058 END
081700200423             GO TO VTR-0022
081710200423           END-IF.
081720200423
081730200423      *RFS24191 - Begins
081740200423      **   IF ACCOUNT-NO OF ACCOUNT IS NOT EQUAL
081750200423      **   ACCOUNT-NO OF ACCOUNT-NOMINEE
081760200423      **     MOVE ACCOUNT-NO OF ACCOUNT
081770200423      **                     TO ACCOUNT-NO OF ACCOUNT-NOMINEE
081780200423      **     READ ACCOUNT-NOMINEE
081790200423      **     INVALID KEY
081800200423      *RFS 13306 begin
081810200423      **       INITIALIZE MFAACCNMP OF ACCOUNT-NOM-REC
081820200423      *RFS 13306 end
081830200423      **     END-READ
081840200423      **   END-IF.
081850200423
081860200423           PERFORM GET-ACCOUNT-NOMINEE.
081870200423      *RFS24191 - Ends
081880200423      * RFS52816 - Begin
081890200423           PERFORM get-account-type-nominee-rule
081900200423      * RFS52816 - End
081910200423
081920200423           IF PRODUCT-TYPE-CODE OF INVESTMENT NOT = "SEG" AND
081930200423           NOMINEE OF ACCOUNT IS NOT EQUAL TO "Y"
081940200423             GO TO VTR-0022
081950200423           END-IF.
081960200423
081970200423           IF NOMINEE-CODE OF ACCOUNT-NOMINEE IS
081980200423           NOT EQUAL NOMINEE-CODE OF NOMINEE-FILE
081990200423             MOVE NOMINEE-CODE OF ACCOUNT-NOMINEE
082000200423                             TO NOMINEE-CODE OF NOMINEE-FILE
082010200423             READ NOMINEE-FILE
082020200423             INVALID KEY
082030200423               INITIALIZE MFANOMP
082040200423             END-READ
082050200423           END-IF.
082060200423
082070200423       VTR-0022.
082080200423
082090200423      * RFS40845 - Begin
082100200423      *    RFS71433 - Begin
082110200423      *    IF lncc_GrntnfOn                    AND
082120200423      *       BUY-TRANSACTION                  AND
082130200423           IF BUY-TRANSACTION                  AND
082140200423      *    RFS71433 - End
082150200423              BACK-END-LOAD                    AND
082160200423              NOMINEE OF ACCOUNT NOT = lncc_Y  AND
082170200423      * RFS76541 - Begin: added conditions to include RDSP accounts
082180200423      * ---------------------------------------------------------------
082190200423      *       RESP-ACCOUNT                     AND
082200200423      *       lncc_currContrRedemRuleGrant
082210200423      * ---------------------------------------------------------------
082220200423             ((RESP-ACCOUNT AND lncc_currContrRedemRuleGrant)   OR
082230200423      *RFS108486 - Start
082240200423      *       (RDSP-ACCOUNT AND lncc_currRdsp_Grant_Bond))
082250200423              (RDSP-ACCOUNT AND lncc_currRdsp_Grant_Bond AND
082260200423                 lncc_GrntnfOn))
082270200423      *RFS108486 - End
082280200423      * RFS76541 - End
082290200423             SET lncc_grantTrade        TO TRUE
082300200423           END-IF
082310200423      * RFS40845 - End
08232020042334309      IF SELL-TRANSACTION                  AND
08233020042334309         NOMINEE OF ACCOUNT NOT = lncc_Y  AND
08234020042334309         RESP-ACCOUNT                     AND
08235020042334309         WS-CURR-CONTR-REDEM-RULE-EAP
08236020042334309
08237020042334309         MOVE PLACEMENT-DATE OF TRANS
08238020042334309           TO PLACEMENT-DATE OF TRANS-RESP-DETAILS
08239020042334309         MOVE TRANS-NO       OF TRANS
08240020042334309           TO TRANS-NO       OF TRANS-RESP-DETAILS
08241020042367639         MOVE SPACES TO REPORTED OF TRANS-RESP-DETAILS
08242020042334309         READ TRANS-RESP-DETAILS
08243020042334309           INVALID KEY
08244020042367639             MOVE PLACEMENT-DATE OF TRANS
08245020042367639               TO PLACEMENT-DATE OF TRANS-RESP-DETAILS
08246020042367639             MOVE TRANS-NO       OF TRANS
08247020042367639               TO TRANS-NO       OF TRANS-RESP-DETAILS
08248020042367639             MOVE "N"    TO REPORTED OF TRANS-RESP-DETAILS
08249020042367639             READ TRANS-RESP-DETAILS
08250020042367639              INVALID KEY
08251020042334309              INITIALIZE  MFATRNRFP
08252020042367639             END-READ
08253020042334309         END-READ
08254020042334309         IF BENEFICIARY-SPLIT-CODE OF TRANS-RESP-DETAILS = SPACES
08255020042334309            MOVE "TG"       TO REJECTION-CODE OF TRANS
08256020042334309            GO TO VTR-EXIT
08257020042334309         END-IF
082580200423      *    RFS84977 -Begin
082590200423           MOVE PLACEMENT-DATE OF TRANS
082600200423                           TO WS-FXRESPVAL-PLACEMENT-DATE
082610200423           MOVE TRANS-NO OF TRANS
082620200423                           TO WS-FXRESPVAL-TRANS-NO
082630200423           MOVE NET-AMT  OF TRANS
082640200423                           TO WS-FXRESPVAL-NET-AMT
082650200423           MOVE SPACES TO WS-FXRESPVAL-REJECTION-CODE
082660200423           CALL "FXRESPVAL" USING
082670200423                            WS-FXRESPVAL-PLACEMENT-DATE
082680200423                            WS-FXRESPVAL-TRANS-NO
082690200423                            WS-FXRESPVAL-NET-AMT
082700200423                            WS-FXRESPVAL-REJECTION-CODE
082710200423
082720200423           IF WS-FXRESPVAL-REJECTION-CODE NOT = Lncc_00
082730200423           MOVE WS-FXRESPVAL-REJECTION-CODE
082740200423                           TO REJECTION-CODE OF TRANS
082750200423           GO TO VTR-EXIT
082760200423           END-IF
082770200423      *    RFS84977 -End
08278020042334309         PERFORM VALIDATE-RESP-EAP-TRADE
08279020042334309         IF NOT VALID-RESP-EAP-TRADE
082800200423      *    RFS84977 -Begin
08281020042334309 *          MOVE "TG"       TO REJECTION-CODE OF TRANS
082820200423      *    RFS84977 -End
08283020042334309            GO TO VTR-EXIT
08284020042334309         END-IF
08285020042334309         MOVE PLACEMENT-DATE OF TRANS-RESP-DETAILS
08286020042334309           TO PLACEMENT-DATE OF TRANS-DIST-CNTRY-CODE
08287020042334309         MOVE TRANS-NO       OF TRANS-RESP-DETAILS
08288020042334309           TO TRANS-NO       OF TRANS-DIST-CNTRY-CODE
08289020042334309         READ TRANS-DIST-CNTRY-CODE
08290020042334309           INVALID KEY
08291020042334309            INITIALIZE MFATRDCCP OF TRANS-DIST-CNTRY-CODE-REC
08292020042334309            MOVE PLACEMENT-DATE OF TRANS-RESP-DETAILS
08293020042334309              TO PLACEMENT-DATE OF TRANS-DIST-CNTRY-CODE-REC
08294020042334309            MOVE TRANS-NO       OF TRANS-RESP-DETAILS
08295020042334309              TO TRANS-NO       OF TRANS-DIST-CNTRY-CODE-REC
08296020042334309             MOVE "W"  TO WRITE-TRANS-DIST-CNTRY-CODE
08297020042334309           NOT INVALID KEY
08298020042334309             MOVE "R"  TO WRITE-TRANS-DIST-CNTRY-CODE
08299020042334309         END-READ
08300020042334309         MOVE WS-ACC-BEN-CNTRY
08301020042334309           TO COUNTRY-CODE OF TRANS-DIST-CNTRY-CODE-REC
08302020042334309         MOVE WS-ACC-BEN-PROV
08303020042334309           TO PROVINCE-CODE OF TRANS-DIST-CNTRY-CODE-REC
08304020042334309      END-IF.
083050200423      *---------------------------------------------------------
083060200423      * Investor is invalid
083070200423      *---------------------------------------------------------
083080200423           IF INVESTOR-NO OF ACCOUNT IS
083090200423           NOT EQUAL INVESTOR-NO OF INVESTOR
083100200423             MOVE INVESTOR-NO OF ACCOUNT
083110200423                               TO INVESTOR-NO OF INVESTOR
083120200423             READ INVESTOR
083130200423             KEY IS EXTERNALLY-DESCRIBED-KEY
083140200423             INVALID KEY
083150200423               MOVE ZEROES     TO INVESTOR-NO OF INVESTOR
083160200423               MOVE "10"       TO REJECTION-CODE OF TRANS
083170200423               GO TO VTR-EXIT
083180200423             END-READ
083190200423           END-IF.
083200200423
08321020042380658      MOVE COUNTRY-CODE OF INVESTOR  TO Lc_TaxCountryCode.
083220200423
083230200423           MOVE PROVINCE-CODE OF INVESTOR
083240200423      *                        RFS 80658.7 - Begins
083250200423      *                        TO TAX-PROVINCE-CODE.
083260200423                               TO  TAX-PROVINCE-CODE
083270200423                                   Lc_TaxProvinceCode.
083280200423      *                        RFS 80658.7 - Ends
083290200423
083300200423       VTR-0030.
083310200423
083320200423      *---------------------------------------------------------
083330200423      * Account investment is invalid
083340200423      *---------------------------------------------------------
083350200423           MOVE ACCOUNT-NO OF TRANS
083360200423                               TO ACCOUNT-NO OF ACCOUNT-INVESTMENT.
083370200423           MOVE INVESTMENT-CODE OF TRANS
083380200423                               TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT.
083390200423
083400200423           READ ACCOUNT-INVESTMENT WITH NO LOCK
083410200423             INVALID KEY
083420200423             INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-REC
083430200423             MOVE ACCOUNT-NO OF TRANS
083440200423                               TO ACCOUNT-NO
083450200423                               OF ACCOUNT-INVESTMENT
083460200423             MOVE INVESTMENT-CODE OF TRANS
083470200423                               TO INVESTMENT-CODE
083480200423                               OF ACCOUNT-INVESTMENT
083490200423             MOVE "W"          TO WRITE-ACCOUNT-INVESTMENT
083500200423
083510200423      *RFS 23020 Begin
083520200423             MOVE "R"          TO WS-CAPITAL-GAIN-DISTR-OPTION
083530200423                                  WS-INCOME-DISTR-OPTION
083540200423             MOVE "N"          TO WS-PAYMENT-TYPE-CODE
083550210218      *RFS185788 STARTS
083560210308             MOVE ACCOUNT-NO OF TRANS      TO pn_DSTOPTAcctNo
083570210218             MOVE INVESTMENT-CODE OF TRANS TO pc_DSTOPTInvCode
083580210305             MOVE lncc_E                   TO pc_DSTOPTLangCode
083590210308                  CALL "SPDSTOPT" USING  pn_DSTOPTAcctNo
083600210305                                         pc_DSTOPTInvCode
083610210305                                         pc_DSTOPTLangCode
083620210305                                         pc_DSTOPTDistOption
083630210305                                         pc_DSTOPTMesgCode
083640210305                                         pc_DSTOPTMesgDesc
083650210305             IF  pc_DSTOPTsuccessful
083660210305              IF pc_DSTOPTDistOption = LT-C
083670210305                 MOVE  LT-C   TO WS-CAPITAL-GAIN-DISTR-OPTION
083680210305                                 WS-INCOME-DISTR-OPTION
083690210305                 MOVE  lncc_I TO WS-PAYMENT-TYPE-CODE
083700210305              END-IF
083710210305             END-IF
083720210218      *RFS185788 ENDS
083730200423             IF WS-EDIT-AAH-AADSOP     = "Y" AND
083740200423                WS-ASSET-ALLOC-HDR-FND = "Y" AND
083750200423                PURCHASE-TRANSACTION         AND
083760200423                PRODUCT-TYPE-RULE  OF PRODUCT-TYPE-CODES = "4"
083770200423                PERFORM GET-AAP-DIST-PAYMENT-METHOD
083780200423             END-IF
083790200423      *RFS 23020 End
083800200423
083810200423             IF GIC-DII-INVESTMENT
083820200423               MOVE 1.00         TO AVERAGE-UNIT-COST
083830200423                                 OF ACCOUNT-INVESTMENT
083840200423
083850200423               MOVE "Y"          TO CORRECT-AVE-UNIT-COST
083860200423                                 OF ACCOUNT-INVESTMENT
083870200423             END-IF
083880200423
083890200423             GO TO VTR-0040
083900200423
083910200423           END-READ.
083920200423
083930200423      **START RFS 4637
083940200423           MOVE CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
083950200423           TO WS-SAVE-CURR-UNIT-BAL.
083960200423      **END   RFS 4637
083970200423
083980200423           IF GIC-DII-INVESTMENT AND
083990200423           PASS-CDSC-CALCULATOR IS EQUAL TO "C"
084000200423           AND WS-INTEREST-GENERATED IS EQUAL "1"
084010200423             ADD WSA-INTEREST-AMT
084020200423                             TO CURR-UNIT-BAL
084030200423                             OF ACCOUNT-INVESTMENT
084040200423           END-IF.
084050200423
084060200423           MOVE "R"            TO WRITE-ACCOUNT-INVESTMENT.
084070200423
084080200423           IF REDUCTION-TRANSACTION
084090200423             PERFORM CALCULATE-AVAILABLE-BALANCE
084100200423
084110200423           END-IF.
084120200423
084130200423       VTR-0040.
084140200423      *    RFS71433 -Begin
084150200423            PERFORM getFinCdscInstructions.
084160200423      *    RFS71433 -End
084170200423      *RFS112133 begin
084180200423            MOVE 99999999 TO ln_CutOffGainDate.
084190200423            IF YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0
084200200423134626*        AND EFFECTIVE-DATE OF ACCOUNT-MISC-DETAILS-REC > 0
084210200423134626         AND EFFECTIV-DATE OF ACCOUNT-MISC-DETAILS-REC > 0
084220200423                COMPUTE ln_CutOffGainDate =
084230200423134626*          EFFECTIVE-DATE OF ACCOUNT-MISC-DETAILS-REC +
084240200423134626           EFFECTIV-DATE OF ACCOUNT-MISC-DETAILS-REC +
084250200423                (YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS * 10000)
084260200423                END-COMPUTE
084270200423            END-IF.
084280200423      *RFS112133 end
084290200423      * RFS 8066 BEGIN
084300200423
084310200423           IF SWITCH-OUT-TRANSACTION
084320200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
084330200423                             TO WS-FROM-ACCOUNT-TP1
084340200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
084350200423                             TO WS-FROM-ACCOUNT-TP2
08436020042392465        MOVE ACCOUNT-NO OF ACCOUNT TO WS-FROM-ACCOUNT-ASN
084370200423           END-IF.
084380200423
084390200423           IF SWITCH-IN-TRANSACTION
084400200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
084410200423                             TO WS-TO-ACCOUNT-TP1
084420200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
084430200423                             TO WS-TO-ACCOUNT-TP2
08444020042392465        MOVE ACCOUNT-NO OF ACCOUNT TO WS-TO-ACCOUNT-ASN
08445020042392465        MOVE INVESTMENT-CODE OF TRANS TO WS-TO-INV-CODE
084460200423           END-IF.
084470200423
084480200423           IF NOT SWITCH-IN-TRANSACTION AND NOT
084490200423           SWITCH-OUT-TRANSACTION
084500200423             MOVE SPACES TO WS-FROM-ACCOUNT-TYPE
084510200423             MOVE SPACES TO WS-TO-ACCOUNT-TYPE
084520200423           END-IF.
084530200423
084540200423      * RFS 8066 END
084550200423
084560200423      * RFS 16760 Begin (!!!)
084570200423      *---------------------------------------------------------------
084580200423      * Labour Sponsored clawback free unit split option code ('N') or
084590200423      * LSIF Rollover should make a mock run of LSIF unit redemption
084600200423      * in order to calculate clawback free units total
084610200423      *---------------------------------------------------------------
084620200423
084630200423           IF (PLACED-LBR-CLAWBACK-FREE OR LSIF-ROLLOVER)
084640200423           AND REDEMPTION-TRANSACTION
084650200423      *RFS 19900 Start
084660200423           AND (PENDING OR UNCONFIRMED)
084670200423      *RFS 19900 End
084680200423             MOVE "N" TO WS-TBL-UPDATE-LSIF-FILES
084690200423             PERFORM CALCULATE-LBR-SPNS-REDEM
084700200423             IF PLACED-LBR-CLAWBACK-FREE
084710200423                 MOVE WS-TBL-FREE-UNITS TO UNIT-AMT OF TRANS
084720200423             END-IF
084730200423           END-IF.
084740200423
084750200423      * RFS 16760 End
084760200423      * RFS 16919 Begin (!!!)
084770200423      * Labour Sponsored Fund Switches - Reject if not rollover
084780200423
084790200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
084800200423               IF SWO-TRANSACTION
084810200423                   IF NOT LSIF-ROLLOVER
084820200423                       MOVE "L2"         TO REJECTION-CODE OF TRANS
084830200423                       GO TO VTR-EXIT
084840200423                   END-IF
084850200423           END-IF.
084860200423
084870200423      * RFS 16919 End
084880200423
084890200423      * RFS 21253 Begin
084900200423
084910200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
084920200423               MOVE 'N'             TO WS-LSIF-DEEMED-DISTR
084930200423               IF DISTRIBUTION-TRANSACTION
084940200423                   MOVE INVESTMENT-CODE OF INVESTMENT
084950200423                   TO   INVESTMENT-CODE
084960200423                        OF INVESTMENT-NOTIONAL-DIST-DTLS
084970200423                   READ INVESTMENT-NOTIONAL-DIST-DTLS
084980200423                   INVALID KEY
084990200423                       GO TO VTR-0045
085000200423                   END-READ
085010200423               ELSE
085020200423                   GO TO VTR-0045
085030200423               END-IF
085040200423
085050200423               IF NOTIONAL-DISTRIBUTION
085060200423               OF INVESTMENT-NOTIONAL-DIST-DTLS = "N"
085070200423                   MOVE "Y" TO WS-LSIF-DEEMED-DISTR
085080200423               END-IF
085090200423
085100200423           END-IF.
085110200423
085120200423
085130200423
085140200423       VTR-0045.
085150200423
085160200423      * RFS 21253 End
085170200423      ** RFS168133 - Start **
085180200423           MOVE lncc_N TO lc_Bypass
085190200423                    lc_MatBuyTrade
085200200423           IF lnc_origCodeMat  AND
085210200423              BUY-TRANSACTION  AND
085220200423              BACK-END-LOAD
085230200423              MOVE "19"    TO lc_Exemption_Rule
085240200423              PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
085250200423              MOVE lc_Bypass TO lc_MatBuyTrade
085260200423           END-IF
085270200423      **RFS168133 - End   **
085280200423
085290200423      * This logic performs validation of cdsc records for: buys, switch-in's
085300200423      * The switch out triggers this logic in a sell buy situation.
085310200423
085320200423           IF (SWITCH-OUT-TRANSACTION) OR
085330200423      * RFS 18781 begin - Dino - modified statement below
085340200423      *     (PURCHASE-TRANSACTION AND NOT SWITCH-IN-TRANSACTION)
085350200423            (PURCHASE-TRANSACTION AND
085360200423            (NOT SWITCH-IN-TRANSACTION OR LSIF-ROLLOVER
08537020042332873 * defect #10 - begin
085380200423      * RFS46125 - Begin
08539020042332873 *      OR lncc_clawbackBEOn))
085400200423             OR lncc_clawbackBEOn
085410200423             OR lncc_deathClaims
085420201223      * RFS185174 - Start
085430210407      * RFS1111190 - Start: It should be not as Sell
085440210407      *      OR lncc_FLDALFYes
085450210407      * RFS1111190 - End
085460201223      * RFS185174 - End
085470200423129787* RFS146636 - Commented out:  OR lb_OptionXOn
085480200423                                 ))
085490200423      * RFS46125 - End
08550020042332873 * defect #10 - end
085510200423      * RFS 18781 end   - Dino - modified statement above
085520200423             PERFORM VALIDATE-CDSC-PURCHASE
085530200423
085540200423             IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
085550200423               GO TO VTR-EXIT
085560200423             END-IF
085570200423           END-IF.
085580200423
085590200423      *---------------------------------------------------------
085600200423      * An account investment record must exist in order to
085610200423      * process a redemption
085620200423      *---------------------------------------------------------
085630200423
085640200423           IF REDUCTION-TRANSACTION AND WRITE-ACCOUNT-INVESTMENT = "W"
085650200423             MOVE "11"         TO REJECTION-CODE OF TRANS
085660200423             GO TO VTR-EXIT
085670200423           END-IF.
085680200423      *---------------------------------------------------------
085690200423      * Purchase specific edits
085700200423      *---------------------------------------------------------
085710200423      *RFS 59842 Begin - Move from after "IF NOT PURCHASE-TRANSACTION" to before
085720200423      *RFS 54435 - begin
085730200423           IF lc_ModuleTFSAOn
085740200423              PERFORM Check-Acct-Types
085750200423              IF (TFSA-ACCOUNT-RULE OR
085760200423                 TFSA-NOMINEE-ACCOUNT-RULE)
08577020042359842 *          AND TRADE-DATE OF TRANS < lncc_TFSA-StartTrade
08578020042359842            AND TRADE-DATE OF TRANS < pi_TFSAEffectiveDate
085790200423                 MOVE "72"  TO REJECTION-CODE OF TRANS
085800200423                 GO TO VTR-EXIT
085810200423              END-IF
085820200423            END-IF.
085830200423      *RFS 54435 - end
085840200423      *RFS 59842 End
085850200423           IF NOT PURCHASE-TRANSACTION
085860200423             GO TO VTR-0080
085870200423           END-IF.
085880200423
085890200423      *RFS54431 - Begin
085900200423           IF WS-CURR-CONTR-REDEM-CODE-RULE = "1"
085910200423132742        OR WS-CURR-CONTR-REDEM-CODE-RULE = "4"
085920200423132742        OR WS-CURR-CONTR-REDEM-CODE-RULE = "5"
085930200423               PERFORM CHECK-ACCT-TYPES
085940200423               IF RDSP-ACCOUNT-RULE
085950200423                  MOVE ACCOUNT-NO OF TRANS
085960200423                    TO pi_RDSPCHKAccountNo
085970200423                  MOVE TRADE-DATE OF TRANS
085980200423                    TO pi_RDSPCHKTransactionDate
085990200423                  MOVE Trans-Origin-Code OF Trans TO WS-TRANS-ORIGIN-88
08600020042368035             MOVE WS-CURR-CONTR-REDEM-CODE-RULE
08601020042368035               TO pc_RDSPCHKContrRule
08602020042377989           IF SETTLED
08603020042377989             Move 0  TO pi_RDSPCHKTransactionAmt
08604020042377989           ELSE
086050200423                  IF GROSS-AMT OF TRANS NOT = 0
086060200423                     MOVE GROSS-AMT OF TRANS
086070200423                       TO pi_RDSPCHKTransactionAmt
086080200423                  ELSE
086090200423                    IF NET-AMT OF TRANS NOT = 0
086100200423                       MOVE NET-AMT OF TRANS
086110200423                         TO pi_RDSPCHKTransactionAmt
086120200423                    ELSE
086130200423                       COMPUTE pi_RDSPCHKTransactionAmt
086140200423                             = UNIT-AMT OF TRANS
086150200423                             * UNIT-PRICE OF INVESTMENT-UNIT-PRICE
086160200423                    END-IF
086170200423      *             RFS 54431.16 Begins
086180200423                    IF pi_RDSPCHKTransactionAmt = ZERO
086190200423                       AND SWITCH-IN-TRANSACTION
086200200423                       IF NET-AMT OF WS-TRANS-REC-2 NOT = ZERO
086210200423                          MOVE NET-AMT OF WS-TRANS-REC-2
086220200423                            TO pi_RDSPCHKTransactionAmt
086230200423                       ELSE
086240200423                          MOVE GROSS-AMT OF WS-TRANS-REC-2
086250200423                            TO pi_RDSPCHKTransactionAmt
086260200423                       END-IF
086270200423                    END-IF
086280200423      *             RFS 54431.16 Ends
086290200423                  END-IF
08630020042377989           END-IF
086310200423
086320200423                  SET pb_RDSPCHKAgeLimitFail      TO TRUE
086330200423                  SET pb_RDSPCHKResidencyFail     TO TRUE
086340200423                  SET pb_RDSPCHKContrLimitFail    TO TRUE
086350200423                  SET pb_RDSPCHKBatch             TO TRUE
086360200423      *RFS98866 - Start
086370200423                  MOVE ZERO TO Pi_RDSPCHKSDSPDAPTaxableAmt
086380200423                               Pi_RDSPCHKSDSPDAPTaxableMax
086390200423127070                         Pi_RDSPCHKSDSPTaxablePortion
086400200423                  MOVE SPACES TO Pc_RDSPCHKSDSPFlag
086410200423      *RFS98866 - End
086420200423
086430200423                  CALL "FXRDSPCHK" USING pi_RDSPCHKAccountNo
086440200423                                         pi_RDSPCHKTransactionAmt
086450200423                                         pi_RDSPCHKTransactionDate
086460200423                                         pc_RDSPCHKMode
08647020042368035                                    pc_RDSPCHKContrRule
086480200423                                         pc_RDSPCHKAgeLimit
086490200423                                         pc_RDSPCHKResidency
086500200423                                         pc_RDSPCHKContrLimit
086510200423                                         pc_RDSPCHKReturnCode
08652020042368035                                    pc_RDSPCHKErrorCode
08653020042368035                                    pc_RDSPCHKErrorType
08654020042368035                                    pc_RDSPCHKErrorMessage
086550200423R98866                                   pi_RDSPCHKSDSPDAPTaxableAmt
086560200423  |                                      pi_RDSPCHKSDSPDAPTaxableMax
086570200423R98866                                   pc_RDSPCHKSDSPFlag
086580200423127070                                   pi_RDSPCHKSDSPTaxablePortion
086590200423
086600200423                    IF pb_RDSPCHKContrLimitFail
086610200423                       MOVE "DS3" TO REJECTION-CODE OF TRANS
086620200423                       GO TO VTR-EXIT
086630200423                    END-IF
086640200423
086650200423      *             Wire Order will reject (not generate trades) for external or
086660200423      *             This is meant to reject systematic plans PAC/AWD/DCA etc. bu
086670200423      *             trades entered interactively with the user accepting the war
086680200423                    IF pb_RDSPCHKAgeLimitFail
086690200423                       AND NOT RDSP-SCREEN-INPUT
086700200423                       MOVE "DS2" TO REJECTION-CODE OF TRANS
086710200423                       GO TO VTR-EXIT
086720200423                    END-IF
086730200423
086740200423                    IF pb_RDSPCHKResidencyFail
086750200423                       MOVE "DS1" TO REJECTION-CODE OF TRANS
086760200423                       GO TO VTR-EXIT
086770200423                    END-IF
086780200423
086790200423               END-IF
086800200423           END-IF.
086810200423      *RFS54431 - End
086820200423
086830200423      * RFS  37754 - begin
086840200423           IF PURCHASE-ADJUSTMENT
086850200423             INITIALIZE MFATRNCMP OF TRANS-COMMISSION-REC
086860200423             GO TO VTR-0046
086870200423           END-IF.
086880200423
086890200423           MOVE PLACEMENT-DATE OF TRANS
086900200423                               TO PLACEMENT-DATE OF TRANS-COMMISSION.
086910200423
086920200423           MOVE TRANS-NO OF TRANS
086930200423                               TO TRANS-NO OF TRANS-COMMISSION.
086940200423
086950200423           READ TRANS-COMMISSION WITH NO LOCK
086960200423             INVALID KEY
086970200423             MOVE "37"     TO REJECTION-CODE OF TRANS
086980200423             GO TO VTR-EXIT.
086990200423
087000200423       VTR-0046.
087010200423      * RFS  37754 - end
087020200423           IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG"
087030210809      *RFS187471 Starts
087040210809              IF  lb_EditCodeTGDVSetupNo
087050210809              AND Account-no OF TRANS not = li_PrevAccountNo
087060210809                  IF INVESTMENT-CODE OF TRANS NOT =
087070210809                     INVESTMENT-CODE OF INVESTMENT-SEG
087080210809                     PERFORM GetInvSegAttributes thru
087090210809                             GISA-Exit
087100210809                  END-IF
087110210809                  PERFORM GetGDTHVSCV thru GDTHVSCV-Exit
087120210809              END-IF
087130210809      *RFS187471 End
087140200423      **** RFS 16060 Begin
087150200423               IF SWITCH-IN-TRANSACTION
087160200423      **** RFS 16229 Begin
087170200423               AND NOT SEG-OUT-PROCESSED
087180200423      **** RFS 16229 End
087190200423      **** RFS 15847 Begin
087200200423                   MOVE 'Y' TO WS-SEG-VALIDATION-MODE-FLAG
087210200423                   PERFORM REGET-SELL-BUY-TARGET
087220200423      **** RFS 16812 Begin
087230200423                   PERFORM DETERMINE-IF-SEGFUND-SWO
087240200423                   IF SWO-IS-A-SEGFUND
087250200423                       PERFORM PROCESS-SEG-SELL
087260200423                   ELSE
087270200423                       MOVE 'Y' TO WS-SEG-OUT-PROCESSED-FLAG
087280200423                   END-IF
087290200423      **** RFS 16812 End
087300200423                   PERFORM GET-SELL-BUY-TARGET
087310200423116449         IF lc_Policy = "A"
087320200423116449             PERFORM DEALER-LICENSE
087330200423116449             PERFORM DEALER-REP-LICENSE
087340200423116449         END-IF
087350200423                   PERFORM EVALUATE-SEG-CONTRACT-DETAILS
087360200423                   MOVE 'N' TO WS-SEG-VALIDATION-MODE-FLAG
087370200423      **** RFS 16245 Begin
087380200423                   MOVE INDUSTRY-FUND-CODE OF INVESTMENT
087390200423                   TO INDUSTRY-FUND-CODE OF TRANS
087400200423                   MOVE UNIT-PRICE OF INVESTMENT-UNIT-PRICE
087410200423                   TO UNIT-PRICE OF TRANS
087420200423      **** RFS 16245 End
087430200423      **** RFS 15847 End
087440200423               ELSE
087450200423                   PERFORM EVALUATE-SEG-CONTRACT-DETAILS
087460200423               END-IF
087470200423      **** RFS 16060 End
087480200423
087490200423             IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
087500200423               GO TO VTR-EXIT
087510200423             END-IF
087520200423      *RFS 103858 - Begin
087530200716185172       IF pc_CContractFlag NOT = "X"
087540200423             MOVE DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT TO
087550200423                  ln_tmpDepositMaturityDate
087560200423             IF ln_tmpDepositMaturityDate = 0  AND
087570200423                TRANS-TYPE-CODE OF TRANS = "BUY"
087580200423                MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT TO pi_AccountNo
087590200423                MOVE INVESTMENT-CODE OF TRANS TO pc_InvestmentCode
087600200423                MOVE TRADE-DATE OF TRANS TO pi_TradeDate
087610200423                MOVE MATURITY-DATE OF ACCOUNT-CONTRACT TO
087620200423                     pi_MaturityDate
087630200423                MOVE ln_tmpDepositMaturityDate TO pi_DepositMaturityDate
087640200423                CALL "FXCLCDEPMA" USING pi_AccountNo,
087650200423                                        pc_InvestmentCode,
087660200423                                        pi_TradeDate,
087670200423                                        pi_MaturityDate,
087680200423                                        pi_DepositMaturityDate
087690200423                MOVE pi_DepositMaturityDate TO ln_tmpDepositMaturityDate
087700200423             END-IF
087710200423             IF TRANS-TYPE-CODE OF TRANS = "BUY" AND
087720200423      *         DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT >=
087730200423                ln_tmpDepositMaturityDate >=
087740200423                TRADE-DATE OF TRANS
087750200423                MOVE TRADE-DATE OF TRANS TO ln_TradeDate
087760200423                MOVE ln_TradeDate TO WD-CCYYMMDD-2
087770200423      *         MOVE DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT TO
087780200423      *              ln_MaturityDate
087790200423                MOVE ln_tmpDepositMaturityDate TO WD-CCYYMMDD-3
087800200423                COMPUTE ln_depCommYearsToMaturity ROUNDED = FUNCTION
087810200423                       FIND-DURATION(WD-CCYYMMDD-2 WD-CCYYMMDD-3 YEARS)
087820200423                SET lncc_depCommYears TO TRUE
087830200423             END-IF
087840200716185172       END-IF
087850200423      *RFS 103858 - End
087860200423           END-IF.
087870200423      *RFS 121437 - Begins - Perform Seg licencing validation for GIC/DII
087880200423      *    IF GIC-DII-INVESTMENT                     AND
087890200423      *       PURCHASE-TRANSACTION                   AND
087900200423      *       lc_Policy = Lncc_A
087910200423      *          MOVE PROVINCE-CODE OF INVESTOR
087920200423      *            TO Lc_ValidateProvince
087930200423      *          MOVE DEALER-CODE OF TRANS
087940200423      *            TO Lc_ValidateDealer
087950200423      *          MOVE DEALER-REP-CODE OF TRANS
087960200423      *            TO Lc_ValidateDealerRep
087970200423      *          PERFORM VALIDATE-DEALER-LICENSE
087980200423      *          IF REJECTION-CODE OF TRANS = "58"
087990200423      *             GO TO VTR-EXIT
088000200423      *          END-IF
088010200423      *          PERFORM VALIDATE-DEALER-REP-LICENSE
088020200423      *          IF REJECTION-CODE OF TRANS = "58"
088030200423      *             GO TO VTR-EXIT
088040200423      *          END-IF
088050200423      *    END-IF.
088060200423      *RFS 121437 - Ends
088070200423      *RFS 16760 Begin
088080200423           IF PRODUCT-TYPE-CODE OF INVESTMENT = "LBS"
088090200423               IF SWITCH-IN-TRANSACTION
088100200423                   MOVE 'Y' TO WS-LBS-VALIDATION-MODE-FLAG
088110200423                   PERFORM POST-LBR-SPNS-UNITS
088120200423                   MOVE 'N' TO WS-LBS-VALIDATION-MODE-FLAG
088130200423               END-IF
088140200423
088150200423             IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
088160200423               GO TO VTR-EXIT
088170200423             END-IF
088180200423
088190200423           END-IF.
088200200423      *RFS 16760 End
088210200423      * RFS119916 - Start
088220200423           IF GIC-DII-INVESTMENT AND PURCHASE-TRANSACTION
088230200423              PERFORM CHECK-SEG-GIC-AGE-LIMIT THRU  SEG-GIC-AGE-EXIT
088240200423              IF REJECTION-CODE OF TRANS NOT = lncc_00
088250200423                 GO TO VTR-EXIT
088260200423              END-IF
088270200423           END-IF
088280200423      * RFS119916 - End
088290200423      *GIC MOD
088300200423           IF GIC-INVESTMENT
088310200423      * RFS119916 - Start
088320200423      * RFS113773 - Starts
088330200423      *       PERFORM CHECK-SEG-GIC-AGE-LIMIT THRU  SEG-GIC-AGE-EXIT
088340200423      *       IF REJECTION-CODE OF TRANS NOT = lncc_00
088350200423      *          GO TO VTR-EXIT
088360200423      *       END-IF
088370200423      * RFS113773 - Ends
088380200423      * RFS119916 - End
088390200423             PERFORM GET-GIC-CERTIFICATE
088400200423
088410200423             IF WS-GIC-CRT-FOUND IS NOT EQUAL "Y"
088420200423RF7593          IF  TRANSFER-IN-TRANSACTION        AND
088430200423RF7593              TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIM"
088440200423RF7593              GO TO VTR-0050
088450200423RF7593          END-IF
088460200423
088470200423              IF TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIM"
088480200423RF8095        OR TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIA"
088490200423               MOVE "G1"   TO REJECTION-CODE OF TRANS
088500200423               GO TO VTR-EXIT
088510200423              END-IF
088520200423              IF WS-GIC-CRT-FOUND = "N" AND WS-IGT-TXN-FOUND = "N"
088530200423AA               INITIALIZE MFAGITRP OF GIC-TRANS-RELATIONSHIP-PRI-REC
088540200423AA               MOVE "W"    TO WRITE-GIC-TRANS-RELATIONSHIP
088550200423                 MOVE PLACEMENT-DATE OF TRANS
088560200423                             TO PLACEMENT-DATE
088570200423                             OF GIC-TRANS-RELATIONSHIP-PRIMARY
088580200423                 MOVE TRANS-NO OF TRANS
088590200423                             TO TRANS-NO
088600200423                             OF GIC-TRANS-RELATIONSHIP-PRIMARY
088610200423                 MOVE "IGT"  TO CERT-TXN-RELATIONSHIP
088620200423                             OF GIC-TRANS-RELATIONSHIP-PRIMARY
088630200423              END-IF
088640200423             END-IF
088650200423           END-IF.
088660200423      *END GIC MOD
088670200423
088680200423RF7593 VTR-0050.
088690200423       VTR-0080.
088700200423      *RFS 16613 Begin
088710200423      *---------------------------------------------------------
088720200423      * Capital loss specific edits
088730200423      *---------------------------------------------------------
088740200423           IF NOT CAPITAL-LOSS-TRANSACTION
088750200423             GO TO VTR-0085
088760200423           END-IF.
088770200423           PERFORM GET-WIRE-ORDER-TARGET.
088780200423           IF REJECTION-CODE OF TRANS IS NOT EQUAL TO "00"
088790200423               GO TO VTR-EXIT
088800200423           END-IF.
088810200423       VTR-0085.
088820200423
088830200423      *RFS 16613 End
088840200423      *---------------------------------------------------------
088850200423      * Distribution specific edits
088860200423      *---------------------------------------------------------
088870200423           IF NOT DISTRIBUTION-TRANSACTION
088880200423             GO TO VTR-0100
088890200423           END-IF.
088900200423
088910200423      * RFS20722 Start
088920200423      * Identify the re-invested distributions as follows.
088930200423      *
088940200423      * The DISTR-OPTION-CODE is saved on the TRANS-DISTR-DETAILS
088950200423      * file but contains only the details of CPG and INC transactions.
088960200423      *
088970200423      * The PAYMENT-TYPE-CODE = "N" in MFATRNP file should be
088980200423      * selected instead due to following reasons.
088990200423      *
089000200423      * Anything other than "N" cannot be selected for PAYMENT-TYPE-CODE
089010200423      * in ACIDSDTL screen for re-invested CPG and INC distributions. Re-
089020200423      * purchase/re-directed distributions will have an "R" in PAYMENT-
089030200423      * TYPE-CODE. This will automatically eliminate the re-purchase/
089040200423      * re-directed distributions.
089050200423      *
089060200423      * For MM INT distributions, the PAYMENT-TYPE-CODE will have an
089070200423      * "N" if re-invested. The INT accrual adjustment transactions will
089080200423      * contain a value other than "N" therefore these transactions are
089090200423      * also be eliminated from selection for the new process.
089100200423      *
089110200423           MOVE PAYMENT-TYPE-CODE OF TRANS TO DISTRIB-OPTIONS-ALL
089120200423      * RFS20722 End
089130200423
089140200423           IF INTEREST-TRANSACTION OR
089150200423           GIC-DII-INVESTMENT
089160200423             GO TO VTR-0090
089170200423           END-IF.
089180200423
089190200423           IF MAN-FEE-REB-TRANSACTION
089200200423             MOVE "R"        TO DISTRIBUTION-OPTION-CODE
089210200423             GO TO VTR-0100
089220200423           END-IF.
089230200423
089240200423           PERFORM GET-WIRE-ORDER-TARGET.
089250200423           IF REJECTION-CODE OF TRANS IS EQUAL TO "00"
089260200423             MOVE TRANS-NO OF TRANS
089270200423             TO TRANS-NO OF TRANS-DISTR-DETAILS
089280200423             MOVE PLACEMENT-DATE OF TRANS
089290200423             TO PLACEMENT-DATE OF TRANS-DISTR-DETAILS
089300200423             READ TRANS-DISTR-DETAILS
089310200423               INVALID KEY
089320200423                 MOVE "30"     TO REJECTION-CODE OF TRANS
089330200423                 GO TO VTR-EXIT
089340200423           ELSE
089350200423             GO TO VTR-EXIT
089360200423           END-IF.
089370200423
089380200423           MOVE DISTR-OPTION-CODE OF TRANS-DISTR-DETAILS
089390200423                             TO DISTRIBUTION-OPTION-CODE.
089400200423      *RFS1014578-Starts
089410201223      *RFS180707 - Starts
089420201223      *    IF NOT(lncc_DscDolYes AND ACCOUNT-LEV-FREE-DOLLARS)
089430201223           IF NOT(lncc_DscDolYes AND
089440201223              (ACCOUNT-LEV-FREE-DOLLARS AND lnc_ACINDSCNo))
089450201223      *RFS180707 - Ends
089460200423              AND CASH-DISTRIB
089470200423              AND BACK-END-LOAD
089480200423
089490200423              MOVE TRADE-DATE OF TRANS TO WS-TRADE-DATE
089500200423              MOVE INVESTMENT-CODE OF INVESTMENT TO WS-INVESTMENT-CODE
089510200423              PERFORM getInvestmentFinancer
089520200423
089530200423      *    Get financer cdsc instructions.
089540200423              MOVE FINANCER-CODE OF INVESTMENT-FINANCER
089550200423                                 TO FINANCER-CODE
089560200423                                 OF FINANCER-CDSC-INSTRUCTIONS
089570200423              PERFORM readFinancerCdscInstructions
089580200423           END-IF.
089590200423      *RFS1014578-Ends
089600200423R26260* Begin
089610200423      * Validate non-notional distributions.  If there's no contract
089620200423      * exists for the account, reject the trade.
089630200423           IF Ws-Notional-Distrib = "S" OR "B"
089640200423              IF Product-Type-Code of Investment = "SEG"
08965020042337754            AND NOT (SPEC-MOD-AUTH-SEGSYSMAT-ON AND
08966020042337754                    CAPITAL-GAIN-TRANSACTION   AND
08967020042337754                    lnc_OrigCodeMat)
089680200423                 PERFORM Get-Contract-No-Info
089690200423                 IF lncc_ContractNotFound
089700200423                    MOVE "68" TO Rejection-Code of Trans
089710200423                 End-IF
089720200423              End-IF
089730200423           End-IF.
089740200423R26260* End
089750200423
089760200423           GO TO VTR-EXIT.
089770200423       VTR-0090.
089780200423
089790200423      *GIC MOD
089800200423           IF GIC-INVESTMENT
089810200423             PERFORM GET-GIC-CERTIFICATE
089820200423
089830200423             IF WS-GIC-CRT-FOUND IS NOT EQUAL "Y"
089840200423
089850200423RF7593          IF  TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIM" AND
089860200423RF7593              PASS-CDSC-CALCULATOR NOT EQUAL TO "G"
089870200423RF7593              GO TO VTR-0095
089880200423RF7593          END-IF
089890200423
089900200423               MOVE "G1"   TO REJECTION-CODE OF TRANS
089910200423               GO TO VTR-EXIT
089920200423             END-IF
089930200423             IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
089940200423               GO TO VTR-EXIT
089950200423             END-IF
089960200423140269* Defect #40142 - For GIM interest trans, check if there is
089970200423140269*  redemption transaction happened on the same process date. If
089980200423140269*  yes, need to recalculate the GIM interest amount.
089990200423      * RFS140269 - Begin
090000200423140269       MOVE "N"        TO lc_ReCalcINT
090010200423140269       IF lb_SkipGICSeqYes AND PASS-CDSC-CALCULATOR = "U"
090020200423140269          IF TRANS-ORIGIN-CODE OF TRANS IS EQUAL "GIM" AND
090030200423140269             (NOT BACKDATED-TRADE) AND
090040200423140269             INTEREST-TRANSACTION AND WS-GIC-CRT-FOUND = "Y"
090050200423140269               PERFORM CHK-REDEMPTION-TRANS THRU CRDT-EXIT
090060200423140269          END-IF
090070200423140269          IF (BACKDATED-TRADE AND PLACEMENT-DATE OF TRANS =
090080200423140269              PASS-PROCESS-DATE-9 AND
090090200423140269              INTEREST-TRANSACTION AND
090100200423140269              TRANS-ORIGIN-CODE OF TRANS = "GIM")  OR
090110200423140269             lc_ReCalcINT = "Y"
090120200423140269               PERFORM RE-EVALUATE-GIC-GROSS-AMT
090130200423140269          END-IF
090140200423140269       END-IF
090150200423      * RFS140269 - End
090160200423           END-IF.
090170200423      *END GIC MOD
090180200423140269* Defect #40142 - For DII interest payment at year end, recalculate
090190200423140269* interest amount if there is backdated transaction processed on
090200200423140269* the same process date.
090210200423140269       MOVE "N"        TO lc_ReCalcINT
090220200423140269       IF lb_SkipGICSeqYes AND PASS-CDSC-CALCULATOR = "U"
090230200423140269          IF DII-INVESTMENT AND INTEREST-TRANSACTION AND
090240200423140269             TRADE-DATE OF TRANS = WS-YEAR-END-DATE AND
090250200423140269             TRANS-ORIGIN-CODE OF TRANS IS EQUAL "DIR"
090260200423140269               PERFORM CHK-BACKDATED-TRANS THRU CBKT-EXIT
090270200423140269          END-IF
090280200423140269          IF lc_ReCalcINT = "Y"
090290200423140269             PERFORM RE-EVALUATE-GIC-GROSS-AMT
090300200423140269          END-IF
090310200423140269       END-IF.
090320200423140269*
090330200423RF7593 VTR-0095.
090340200423           IF WS-INTEREST-GENERATED IS NOT EQUAL TO "0"
090350200423             MOVE DISTR-OPTION-CODE OF TRANS-INTEREST-DETAILS
090360200423                               TO DISTRIBUTION-OPTION-CODE
090370200423             GO TO VTR-0100
090380200423           END-IF.
090390200423
090400200423           MOVE TRANS-NO OF TRANS
090410200423                           TO TRANS-NO OF TRANS-INTEREST-DETAILS.
090420200423           MOVE PLACEMENT-DATE OF TRANS
090430200423                           TO PLACEMENT-DATE OF TRANS-INTEREST-DETAILS.
090440200423
090450200423      * RFS21772 - Begin
090460200423           IF PASS-CDSC-CALCULATOR = "C"
090470200423               PERFORM FORMAT-TRANS-INTEREST-DETAILS
090480200423           ELSE
090490200423      * RFS21772 - End
090500200423           READ TRANS-INTEREST-DETAILS WITH NO LOCK
090510200423             INVALID KEY
090520200423             MOVE "30"     TO REJECTION-CODE OF TRANS
090530200423             GO TO VTR-EXIT.
090540200423
090550200423           MOVE DISTR-OPTION-CODE OF TRANS-INTEREST-DETAILS
090560200423                             TO DISTRIBUTION-OPTION-CODE.
090570200423
090580200423           PERFORM GET-INTEREST-ACCRUAL-RECORD.
090590200423
090600200423           IF WS-ACCRUAL-RECORD-FOUND IS NOT EQUAL "Y"
090610200423             GO TO VTR-0100
090620200423           END-IF.
090630200423
090640200423           IF (ACCRUAL-AMT
090650200423             OF ACCOUNT-INV-ACCRUALS +
090660200423             ACCRUAL-ADJUSTMENT-AMT
090670200423             OF TRANS-INTEREST-DETAILS IS LESS THAN 0)
090680200423             MOVE "31"     TO REJECTION-CODE OF TRANS
090690200423             GO TO VTR-EXIT
090700200423           END-IF.
090710200423
090720200423       VTR-0100.
090730200423      *---------------------------------------------------------
090740200423      * Reduction specific edits
090750200423      *---------------------------------------------------------
090760200423           IF NOT REDEMPTION-TRANSACTION
090770200423123672        AND NOT CAPITAL-LOSS-TRANSACTION
090780200423      *      51186 begins
090790200423             if lb_editCodeACINVGSetupYes
090800200423R64263*         call "FXACINVG" using investment-code of trans
090810200423R64263*                               account-no of trans
090820200423R64263*                               lc-returnCode
090830200423R64263          move spaces TO lc-returnCodeDesc
090840200423R64263          call "FXACINVG" using lnc-TRNPST
090850200423R64263                                account-no of trans
090860200423R64263                                investment-code of trans
090870200423R64263                                lc-returnCodeDesc
090880200423R64263                                lc-returnCode
090890200423                if lc-returnCode not equal spaces
090900200423                   move "S1" to REJECTION-CODE OF TRANS
090910200423                end-if
090920200423             end-if
090930200423      *      51186 ends
090940200423             GO TO VTR-EXIT
090950200423           END-IF.
090960200423      *GIC MOD
090970200423           IF GIC-INVESTMENT
090980200423
090990200423             PERFORM GET-GIC-CERTIFICATE
091000200423
091010200423             IF WS-GIC-CRT-FOUND IS NOT EQUAL "Y"
091020200423               MOVE "G1"   TO REJECTION-CODE OF TRANS
091030200423               GO TO VTR-EXIT
091040200423             END-IF
091050200423      * RFS12308 - Begin
091060200423             IF SWO-TRANSACTION             AND
091070200423                WS-ACCOUNT-ASSIGNED = LT-Y  AND
091080200423                GIC-INVESTMENT-SW-OUT       AND
091090200423                DII-INVESTMENT-SW-IN
091100200423                  MOVE LT-Y       TO WS-GIC-DII-ASSIGNED
091110200423             END-IF
091120200423      * RFS12308 - End
091130200423      * RFS140269 - Begin
091140200423140269* Recalculate amount on mature backdated SEL.
091150200423140269       IF lb_SkipGICSeqYes AND PASS-CDSC-CALCULATOR = "U"
091160200423140269          IF BACKDATED-TRADE AND PLACEMENT-DATE OF TRANS =
091170200423140269              PASS-PROCESS-DATE-9 AND
091180200423140269              REDEMPTION-TRANSACTION AND
091190200423140269              TRANS-ORIGIN-CODE OF TRANS = "GIM"
091200200423140269                PERFORM RE-EVALUATE-GIC-GROSS-AMT
091210200423140269          END-IF
091220200423140269       END-IF
091230200423      * RFS140269 - End
091240200423           END-IF.
091250200423      *END GIC MOD
091260200423
091270200423       VTR-0110.
091280200423      *---------------------------------------------------------------*
091290200423      * Validations for Pooled Funds
091300200423      *---------------------------------------------------------------*
091310200423      *RFS24190 - Begins
091320200423           MOVE SPACES  TO WS-POOLED-FUNCTION.
091330200423
091340200423           IF SPEC-MOD-AUTH-POLTAX
091350200423              IF  EDIT-NT2062
091360200423              AND POOLED-FUND
091370200423              AND (SELL-TRANSACTION OR SWITCH-OUT-TRANSACTION)
091380200423              AND WS-CURR-CONTR-REDEM-RULE-49
091390200423
091400200423                  PERFORM CHECK-NTAXT2062
091410200423                  MOVE "Y"  TO WS-POOLED-FUNCTION
091420200423              END-IF
091430200423
091440200423              IF  EDIT-NRGSEL
091450200423              AND POOLED-FUND
091460200423              AND (SELL-TRANSACTION OR SWITCH-OUT-TRANSACTION)
091470200423              AND WS-CURR-CONTR-REDEM-RULE-47
091480200423
091490200423                  PERFORM CHECK-NTAXREGSEL
091500200423                  MOVE "Y"  TO WS-POOLED-FUNCTION
091510200423              END-IF
091520200423
091530200423              IF  NTAXT2062-CALC
091540200423              AND NOT TFR-AT-COST-OCCURS
091550200423              AND WS-AUC-UNIT-COST-OK NOT = "Y"
091560200423                  IF (REJECTION-CODE OF TRANS = SPACES  OR  "00")
091570200423                  OR (WS-AUC-REJECTION-CODE = SPACES  OR  "00")
091580200423                     MOVE "53"  TO REJECTION-CODE OF TRANS
091590200423                  END-IF
091600200423                  GO TO VTR-EXIT
091610200423              END-IF
091620200423
091630200423              IF  EDIT-IRCPG
091640200423              AND POOLED-FUND
091650200423              AND CAPITAL-GAIN-TRANSACTION
091660200423                  MOVE "Y"  TO WS-POOLED-FUNCTION
091670200423              END-IF
091680200423           END-IF.
091690200423      *RFS24190 - Ends
091700200423
091710200423R43677*RFS 43677 - Begin
091720200423       VTR-0115.
091730200423162192*    Initialize Ws-Lnk-Maturity-NR-Flag.
091740200423
091750200423      *R53578 We make sure to get the acct type for both flag
091760200423           IF Sell-Transaction AND
09177020042353578 *       lc_ChargeNont = "Y" AND
091780200423              lnc_ContrRedemRuleLinkNote AND
09179020042380658 *       Country-Code of Investor NOT = "CAN"
09180020042380658         Lc_TaxCountryCode        NOT = "CAN"
091810200423              PERFORM Check-Lnk-Mat-Redem
091820200423           END-IF.
091830200423
091840200423R43677*RFS 43677 - End
091850200423
091860200423       VTR-EXIT.
091870200423           EXIT.
091880200423
091890200423      * RFS169270 - Starts
091900200423      * ----------------------
091910200423       ValidateACINVG SECTION.
091920200423      * ----------------------
091930200423       VAI-0000.
091940200423           INITIALIZE MFAACMDP OF ACCOUNT-MISC-DETAILS-REC.
091950200423
091960200423           MOVE ACCOUNT-NO OF TRANS
091970200423             TO ACCOUNT-NO OF ACCOUNT-MISC-DETAILS.
091980200423
091990200423           READ ACCOUNT-MISC-DETAILS
092000200423                WITH NO LOCK
092010200423           END-READ.
092020200423
092030200423           MOVE "Y" TO WRITE-ACCOUNT-MISC-DETAILS.
092040200423           INITIALIZE lc-returnCode.
092050200423
092060200423           CALL "FXACINVG" using lnc-TRNPST
092070200423                                 ACCOUNT-NO OF TRANS
092080200423                                 INVESTMENT-CODE OF TRANS
092090200423                                 lc-returnCodeDesc
092100200423                                 lc-returnCode.
092110200423
092120200423           IF ACCOUNT-INVESTMENT-GROUP OF
092130200423              ACCOUNT-MISC-DETAILS EQUAL SPACES
092140200423              IF lc-returnCode NOT EQUAL TO SPACES
092150200423                 MOVE "S54" TO REJECTION-CODE OF TRANS
092160200423                 MOVE " "   TO WRITE-ACCOUNT-MISC-DETAILS
092170200423              END-IF
092180200423           END-IF.
092190200423
092200200423           IF ACCOUNT-INVESTMENT-GROUP OF
092210200423              ACCOUNT-MISC-DETAILS NOT EQUAL SPACES
092220200423              IF lc-returnCode NOT EQUAL TO SPACES
092230200423                 MOVE "S55" TO REJECTION-CODE OF TRANS
092240200423                 MOVE " "   TO WRITE-ACCOUNT-MISC-DETAILS
092250200423              END-IF
092260200423           END-IF.
092270200423       VAI-EXIT.
092280200423           EXIT.
092290200423      * RFS169270 - Ends
092300200423
092310200423R26260* Begin
092320200423       GET-CONTRACT-NO-INFO SECTION.
092330200423       GCNI-0000.
092340200423           MOVE "N" TO lc_Contract.
092350200423           INITIALIZE MFAACCCIP OF Account-Contract-Invest2-Rec.
092360200423           MOVE Account-No OF Trans
092370200423             TO Account-No OF Account-Contract-Invest2-Rec.
092380200423           MOVE Zeros  TO Contract-No OF Account-Contract-Invest2-Rec.
092390200423           MOVE Spaces TO Investment-Code
092400200423                       OF Account-Contract-Invest2-Rec.
092410200423
092420200423           START Account-Contract-Investment2
092430200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
092440200423             INVALID KEY
092450200423             MOVE "N" TO lc_Contract
092460200423             GO TO GCNI-EXIT.
092470200423
092480200423       GCNI-READ.
092490200423
092500200423           READ Account-Contract-Investment2 NEXT RECORD
092510200423                AT END
092520200423                GO TO GCNI-EXIT.
092530200423
092540200423           IF Account-No OF Account-Contract-Invest2-Rec NOT =
092550200423              Account-No OF Trans
092560200423              GO TO GCNI-EXIT
092570200423           END-IF.
092580200423
092590200423           IF Investment-Code of Account-Contract-Invest2-Rec NOT =
092600200423              Investment-Code of Trans OR
092610200423              Curr-Unit-Bal of Account-Contract-Invest2-Rec <= 0
092620200423              GO TO GCNI-READ
092630200423           END-IF.
092640200423
092650200423           MOVE "Y" TO lc_Contract.
092660200423
092670200423       GCNI-EXIT.
092680200423           EXIT.
092690200423R26260* End
092700200423
092710200423      * RFS16941 - Begin
092720200423      * ----------------------------------
092730200423       REJECT-AND-CLOSE-TRF-FILES SECTION.
092740200423      * ----------------------------------
092750200423       RCTF-0000.
092760200423
092770200423           MOVE "TD"                TO REJECTION-CODE OF TRANS.
092780200423
092790200423           CLOSE                    BW-TRANS-CDSC-PUR-PRIMARY
092800200423                                    BW-TRANS-CDSC-PURCH-REDUCTION.
092810200423
092820200423           MOVE "D"                      TO WS-SETTRFBW-ACTION.
092830200423
092840200423           IF WS-SETTRFBW-MODE-O-ON
092850200423               CALL "SETTRFBW" USING
092860200423                                           WS-SETTRFBW-LIBRARY
092870200423                                           WS-SETTRFBW-ACTION
092880200423                                           WS-SETTRFBW-RETURN-CODE
092890200423           END-IF.
092900200423
092910200423           IF WS-SETTRFBW-RETURN-CODE IS NOT EQUAL " "
092920200423               MOVE "1"        TO WS-TRF-BW-ERR-FLAG
092930200423               MOVE "T9"       TO REJECTION-CODE OF TRANS
092940200423               DISPLAY "@@@ SETTRFBW FAILURE CODE: "
092950200423               WS-SETTRFBW-RETURN-CODE
092960200423           ELSE
092970200423               MOVE "N"        TO WS-SETTRFBW-MODE-O-FLAG
092980200423               MOVE "1"        TO WS-TRF-BW-ERR-FLAG
092990200423           END-IF.
093000200423
093010200423       RCTF-EXIT.
093020200423      * RFS16941 - End
093030200423
093040200423      * RFS13471 - Begin
093050200423      * ---------------------------------
093060200423       GET-ACCOUNT-NO SECTION.
093070200423      * ---------------------------------
093080200423       GAN-0000.
093090200423           IF ACCOUNT-NO OF TRANS IS NOT EQUAL
093100200423           ACCOUNT-NO OF ACCOUNT
093110200423171078     OR WS-ACCOUNT-EXISTS = " "
093120200423             MOVE ACCOUNT-NO OF TRANS
093130200423                               TO ACCOUNT-NO OF ACCOUNT
093140200423             READ ACCOUNT
093150200423             KEY IS EXTERNALLY-DESCRIBED-KEY
093160200423             INVALID KEY
093170200423               MOVE "09"       TO REJECTION-CODE OF TRANS
093180200423               MOVE "N"        TO WS-ACCOUNT-EXISTS
093190200423               MOVE 0          TO ACCOUNT-NO OF ACCOUNT
093200200423             NOT INVALID KEY
093210200423               MOVE "Y"        TO WS-ACCOUNT-EXISTS
093220200423             END-READ
093230200423      *RFS112133 begin
093240200423             INITIALIZE MFAACMDP OF ACCOUNT-MISC-DETAILS-REC
093250200423             IF WS-ACCOUNT-EXISTS = "Y"
093260200423               MOVE ACCOUNT-NO OF TRANS
093270200423                 TO ACCOUNT-NO OF ACCOUNT-MISC-DETAILS-REC
093280200423               READ ACCOUNT-MISC-DETAILS
093290200423122815              WITH NO LOCK
093300200423                 INVALID KEY
093310200423                 INITIALIZE MFAACMDP OF ACCOUNT-MISC-DETAILS-REC
093320200423               END-READ
093330200423             END-IF
093340200423      *RFS112133 end
093350200423           END-IF.
093360200423       GAN-EXIT.
093370200423           EXIT.
093380200423      * RFS40845 - Begin
093390200423      * ---------------------------------
093400200423       get-account-type-rule SECTION.
093410200423      * ---------------------------------
093420200423      * Get account type rule
093430200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT          TO
093440200423                ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE
093450200423           READ ACCOUNT-TYPE
093460200423             INVALID KEY
093470200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
093480200423             NOT INVALID KEY
093490200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE TO
093500200423                            WS-ACCOUNT-TYPE-CAT
093510200423           END-READ.
093520200423      * RFS40845 - End
093530200423      *RFS24191 - Begins
093540200423      * ---------------------------------
093550200423       GET-ACCOUNT-NOMINEE SECTION.
093560200423      * ---------------------------------
093570200423       GANM-0000.
093580200423           IF ACCOUNT-NO OF TRANS NOT = ACCOUNT-NO OF ACCOUNT-NOMINEE
093590200423             MOVE ACCOUNT-NO OF TRANS
093600200423               TO ACCOUNT-NO OF ACCOUNT-NOMINEE
093610200423             READ ACCOUNT-NOMINEE
093620200423               INVALID KEY
093630200423                 INITIALIZE MFAACCNMP OF ACCOUNT-NOM-REC
093640200423             END-READ
093650200423           END-IF.
093660200423       GANM-EXIT.
093670200423           EXIT.
093680200423      *RFS24191 - Ends
093690200423      * RFS52816 - Begin
093700200423      * ---------------------------------
093710200423       get-account-type-nominee-rule SECTION.
093720200423      * ---------------------------------
093730200423      * Get account type rule
093740200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE TO
093750200423                ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE-NOMINEE
093760200423           READ ACCOUNT-TYPE-NOMINEE
093770200423             INVALID KEY
093780200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE-NOMINEE-REC
093790200423                          WS-ACCOUNT-TYPE-NOMINEE-CAT
093800200423             NOT INVALID KEY
093810200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE-NOMINEE TO
093820200423                            WS-ACCOUNT-TYPE-NOMINEE-CAT
093830200423           END-READ.
093840200423      * RFS52816 - End
093850200423      * ---------------------------------
093860200423       GET-CONTR-REDEM-CODE-RULE SECTION.
093870200423      * ---------------------------------
093880200423       GCRCR-0000.
093890200423      * RFS18779 - Begin
093900200423      *    INITIALIZE WS-CONTR-REDEM-CODE-FEE-FLAG
093910200423           INITIALIZE WS-CURR-CONTR-REDEM-CODE-RULE
093920200423      * RFS18779 - End
093930200423      *
093940200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT        TO
093950200423                ACCOUNT-TYPE-CODE OF CONTR-REDEM-CODE-RULES
093960200423           MOVE CONTR-REDEM-CODE OF TRANS           TO
093970200423                CONTR-REDEM-CODE OF CONTR-REDEM-CODE-RULES
093980200423
093990200423           READ CONTR-REDEM-CODE-RULES
094000200423             INVALID KEY
094010200423      * RFS18779 - Begin
094020200423      *        INITIALIZE WS-CONTR-REDEM-CODE-FEE-FLAG
094030200423               INITIALIZE WS-CURR-CONTR-REDEM-CODE-RULE
094040200423      * RFS18779 - End
094050200423             NOT INVALID KEY
094060200423               MOVE CONTR-REDEM-CODE-RULE OF CONTR-REDEM-CODE-RULES TO
094070200423      * RFS18779 - Begin
094080200423      *                   WS-CONTR-REDEM-CODE-FEE-FLAG
094090200423                          WS-CURR-CONTR-REDEM-CODE-RULE
094100200423      * RFS18779 - End
094110200423           END-READ.
094120200423
094130200423       GCRCR-EXIT.
094140200423           EXIT.
094150200423      * RFS13471 - End
094160200423      * RFS16505 - Begin
094170200423      * ---------------------------------
094180200423       SET-DSC-CHARGEABLE-METHOD SECTION.
094190200423      * ---------------------------------
094200200423           IF SPEC-MOD-AUTH-DSCMET-ON                     AND
094210200423             NOT PLACED-FREE-UNITS                        AND
094220200423             NOT PLACED-MATURE-UNITS                      AND
094230200423             NOT PLACED-TOTAL-FREE-UNITS
094240200423               MOVE ACCOUNT-NO OF TRANS        TO LNK-ACCOUNT-NO
094250200423               MOVE TRANS-TYPE-CODE OF TRANS   TO LNK-TRANS-TYPE-CODE
094260200423               MOVE TRANS-ORIGIN-CODE OF TRANS TO LNK-TRANS-ORIGIN-CODE
094270200423112134         MOVE lc_Trans_Sub_Type          TO LNK-TRANS-SUBTYPE
094280200423               CALL "GETDSCMET" USING
094290200423                                LNK-GETDSCMET-PARAMETERS
094300200423               IF LNK-DSC-REDUCTION-METHOD-CHRG
094310200423                 MOVE LT-Y          TO WS-CHARGEABLE-FIRST
094320200423               END-IF
094330200423      * RFS112134 Start
094340200423               IF  LNK-DSC-REDUCTION-METHOD-WAIVE
094350200423                 MOVE LNK-DSC-REDUCTION-METHOD TO WS-CHARGEABLE-FIRST
094360200423               END-IF
094370200423      * RFS112134 End
094380200423           END-IF.
094390200423       SDCM-EXIT.
094400200423           EXIT.
094410200423      * RFS16505 - End
094420200423      /
094430200423       CALCULATE-DAF-AMOUNT SECTION.
094440200423      ******************************************************************
094450200423      *    C A L C U L A T E   D A F   A M O U N T   R O U T I N E     *
094460200423      ******************************************************************
094470200423
094480200423       CDA-0000.
094490200423           IF NOT INCOME-TRANSACTION
094500200423             GO TO CDA-0500
094510200423           END-IF.
094520200423
094530200423
094540200423           MOVE INVESTMENT-CODE OF TRANS
094550200423                             TO INVESTMENT-CODE
094560200423                             OF INVESTMENT-DAF-RATE.
094570200423
094580200423           MOVE TRADE-DATE OF TRANS
094590200423                             TO DISTR-PAYMENT-DATE
094600200423                             OF INVESTMENT-DAF-RATE.
094610200423
094620200423           READ INVESTMENT-DAF-RATE
094630200423           INVALID KEY
094640200423           GO TO CDA-EXIT.
094650200423
094660200423           IF DAF-RATE OF INVESTMENT-DAF-RATE IS EQUAL 0
094670200423             GO TO CDA-EXIT
094680200423           END-IF.
094690200423
094700200423           IF RECORD-DATE-BAL OF TRANS-DISTR-DETAILS = 0
094710200423             GO TO CDA-EXIT
094720200423           END-IF.
094730200423
094740200423           COMPUTE WS-DAF-AMOUNT ROUNDED = RECORD-DATE-BAL
094750200423           OF TRANS-DISTR-DETAILS *
094760200423           DAF-RATE OF INVESTMENT-DAF-RATE.
094770200423      * RFS 20515 - Start
094780200423           MOVE DAF-RATE OF INVESTMENT-DAF-RATE TO
094790200423                WS-DAF-RATE.
094800200423      * RFS 20515 - End
094810200423           MOVE "W"          TO WRITE-DAF.
094820200423
094830200423       CDA-0500.
094840200423
094850200423           IF NOT INTEREST-TRANSACTION
094860200423             GO TO CDA-EXIT
094870200423           END-IF.
094880200423
094890200423           MOVE INVESTMENT-CODE OF TRANS
094900200423                             TO INVESTMENT-CODE
094910200423                             OF INVESTMENT-DAF-RATE.
094920200423
094930200423           MOVE TRADE-DATE   OF TRANS
094940200423                             TO DISTR-PAYMENT-DATE
094950200423                             OF INVESTMENT-DAF-RATE.
094960200423
094970200423           READ INVESTMENT-DAF-RATE
094980200423           INVALID KEY
094990200423           GO TO CDA-EXIT.
095000200423
095010200423           IF DAF-RATE OF INVESTMENT-DAF-RATE IS EQUAL 0
095020200423             GO TO CDA-EXIT
095030200423           END-IF.
095040200423
095050200423
095060200423           COMPUTE WS-DAF-AMOUNT ROUNDED = GROSS-AMT OF TRANS
095070200423           * DAF-RATE OF INVESTMENT-DAF-RATE.
095080200423      * RFS 20515 - Start
095090200423           MOVE DAF-RATE OF INVESTMENT-DAF-RATE TO
095100200423                WS-DAF-RATE.
095110200423      * RFS 20515 - End
095120200423           MOVE "W"          TO WRITE-DAF.
095130200423
095140200423       CDA-EXIT.
095150200423           EXIT.
095160200423      /
095170200423       GET-TARGET-1 SECTION.
095180200423      ******************************************************************
095190200423      *    G E T   T A R G E T   1   R O U T I N E                     *
095200200423      ******************************************************************
095210200423
095220200423       GT1-0000.
095230200423           MOVE "N"            TO WS-TARGET-NOT-FOUND.
095240200423           MOVE PLACEMENT-DATE OF TRANS
095250200423                               TO PLACEMENT-DATE OF TRANS-TARGET.
095260200423
095270200423           MOVE TRANS-NO OF TRANS
095280200423                               TO TRANS-NO OF TRANS-TARGET.
095290200423
095300200423           MOVE ZEROES         TO PLACEMENT-DATE-2 OF TRANS-TARGET
095310200423                                  TRANS-NO-2 OF TRANS-TARGET.
095320200423
095330200423           START TRANS-TARGET
095340200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
095350200423             INVALID KEY
095360200423             MOVE "Y" TO WS-TARGET-NOT-FOUND
095370200423             GO TO GT1-EXIT.
095380200423
095390200423       GT1-0010.
095400200423            READ TRANS-TARGET NEXT RECORD
095410200423            WITH NO LOCK
095420200423              AT END
095430200423              MOVE "Y" TO WS-TARGET-NOT-FOUND
095440200423              GO TO GT1-EXIT.
095450200423
095460200423            IF PLACEMENT-DATE OF TRANS-TARGET IS NOT EQUAL
095470200423              PLACEMENT-DATE OF TRANS             OR
095480200423              TRANS-NO OF TRANS-TARGET IS NOT EQUAL
095490200423              TRANS-NO OF TRANS
095500200423              MOVE "Y" TO WS-TARGET-NOT-FOUND
095510200423              GO TO GT1-EXIT.
095520200423
095530200423            IF RELATIONSHIP-TYPE OF TRANS-TARGET IS NOT EQUAL
095540200423              WS-RELATIONSHIP-CODE
095550200423              GO TO GT1-0010.
095560200423       GT1-EXIT.
095570200423           EXIT.
095580200423      /
095590200423       GET-TARGET-2 SECTION.
095600200423      ******************************************************************
095610200423      *    G E T   T A R G E T   2   R O U T I N E                     *
095620200423      ******************************************************************
095630200423
095640200423       GT2-0000.
095650200423           MOVE "N"            TO WS-TARGET-NOT-FOUND.
095660200423           MOVE PLACEMENT-DATE OF TRANS
095670200423                               TO PLACEMENT-DATE-2 OF TRANS-TARGET-2.
095680200423           MOVE TRANS-NO OF TRANS
095690200423                               TO TRANS-NO-2 OF TRANS-TARGET-2.
095700200423           MOVE ZEROES         TO PLACEMENT-DATE OF TRANS-TARGET-2
095710200423                                  TRANS-NO OF TRANS-TARGET-2.
095720200423           START TRANS-TARGET-2
095730200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
095740200423             INVALID KEY
095750200423             MOVE "Y" TO WS-TARGET-NOT-FOUND
095760200423             GO TO GT2-EXIT.
095770200423
095780200423       GT2-0010.
095790200423            READ TRANS-TARGET-2 NEXT RECORD
095800200423              AT END
095810200423              MOVE "Y" TO WS-TARGET-NOT-FOUND
095820200423              GO TO GT2-EXIT.
095830200423
095840200423            IF PLACEMENT-DATE-2 OF TRANS-TARGET-2 IS NOT EQUAL
095850200423              PLACEMENT-DATE OF TRANS             OR
095860200423              TRANS-NO-2 OF TRANS-TARGET-2 IS NOT EQUAL
095870200423              TRANS-NO OF TRANS
095880200423              MOVE "Y" TO WS-TARGET-NOT-FOUND
095890200423              GO TO GT2-EXIT.
095900200423
095910200423            IF RELATIONSHIP-TYPE OF TRANS-TARGET-2 IS NOT EQUAL
095920200423              WS-RELATIONSHIP-CODE
095930200423              GO TO GT2-0010.
095940200423
095950200423       GT2-EXIT.
095960200423           EXIT.
095970200423      /
095980200423       EVALUATE-WIRE-ORDER-SELL-BUY SECTION.
095990200423      ******************************************************************
096000200423      *    E V A L U A T E   W I R E   O R D E R   S E L L / B U Y     *
096010200423      ******************************************************************
096020200423
096030200423       ESO-0000.
096040200423           PERFORM GET-SELL-BUY-TARGET.
096050200423           IF WS-TARGET-NOT-FOUND = "Y"
096060200423             MOVE "13"         TO REJECTION-CODE OF TRANS
096070200423             GO TO ESO-EXIT
096080200423           END-IF.
096090200423
096100200423           MOVE "00"           TO REJECTION-CODE OF WS-TRANS-REC-2.
096110200423
096120200423      * RFS9530 - Begin
096130200423           PERFORM SET-NEXT-DATE-SWI
096140200423      * RFS9530 - End
096150200423
096160200423      * RFS14898 - Begin
096170200423           PERFORM SET-SWITCH-TO-SAME-ACC-INV
096180200423      * RFS14898 - End
096190200423
096200200423      **** RFS 16445 Begin (comment out line)
096210200423      **** RFS 16229 Begin
096220200423      **** Initialize fields
096230200423      *      MOVE 'N'        TO WS-SEG-OUT-PROCESSED-FLAG
096240200423      **** RFS 16229 End
096250200423      **** RFS 16445 End
096260200423
096270200423      * If the buy side of the sell-buy does not edit clean then
096280200423      * reject both trades
096290200423
096300200423           PERFORM VALIDATE-TRADE.
096310200423           IF REJECTION-CODE OF TRANS-REC IS NOT EQUAL "00"
096320200423             PERFORM RECORD-UPDATES
096330200423
096340200423             MOVE "12"           TO REJECTION-CODE OF WS-TRANS-REC-2
096350200423           END-IF.
096360200423
096370200423           INITIALIZE WS-CURRENCIES.
096380200423           MOVE CURRENCY-DDS OF INVESTMENT
096390200423                               TO WS-IN-CURRENCY.
096400200423           MOVE PRODUCT-TYPE-CODE OF INVESTMENT
096410200423                               TO WS-IN-PRODUCT-TYPE
096420200423           MOVE TRADE-DATE OF TRANS
096430200423                               TO WS-IN-TRADE-DATE.
096440200423           PERFORM REGET-SELL-BUY-TARGET.
096450200423           MOVE REJECTION-CODE OF WS-TRANS-REC-2
096460200423                               TO REJECTION-CODE OF TRANS.
096470200423
096480200423       ESO-EXIT.
096490200423           EXIT.
096500200423      /
096510200423       GET-SELL-BUY-TARGET SECTION.
096520200423
096530200423RCH        MOVE "00 "          TO WS-REJECTION-CODE.
096540200423      ******************************************************************
096550200423      *    G E T   S E L L / B U Y   T A R G E T   R O U T I N E       *
096560200423      ******************************************************************
096570200423
096580200423       GST-0000.
096590200423
096600200423      * Evaluate to see if there is a target transactions
096610200423      * If a target is found, place it in trans, store old.
096620200423      * trade in trans-rec-2
096630200423
096640200423           MOVE "DSB"          TO WS-RELATIONSHIP-CODE.
096650200423
096660200423           PERFORM GET-TARGET-1.
096670200423
096680200423           IF WS-TARGET-NOT-FOUND = "Y"
096690200423             MOVE "WSB"          TO WS-RELATIONSHIP-CODE
096700200423             PERFORM GET-TARGET-1
096710200423
096720200423           END-IF.
096730200423
096740200423           IF WS-TARGET-NOT-FOUND = "Y"
096750200423             MOVE "DCA"          TO WS-RELATIONSHIP-CODE
096760200423             PERFORM GET-TARGET-1
096770200423
096780200423           END-IF.
096790200423
096800200423           IF WS-TARGET-NOT-FOUND = "Y"
096810200423             MOVE "SWP"          TO WS-RELATIONSHIP-CODE
096820200423             PERFORM GET-TARGET-1
096830200423
096840200423           END-IF.
096850200423
096860200423           IF WS-TARGET-NOT-FOUND = "Y"
096870200423             MOVE "13"         TO WS-REJECTION-CODE
096880200423             GO TO GST-EXIT
096890200423           END-IF.
096900200423
096910200423           MOVE TRANS-REC      TO WS-TRANS-REC-2.
096920200423
096930200423           MOVE PLACEMENT-DATE-2 OF TRANS-TARGET
096940200423                               TO PLACEMENT-DATE OF TRANS-PRIMARY.
096950200423           MOVE TRANS-NO-2 OF TRANS-TARGET
096960200423                               TO TRANS-NO OF TRANS-PRIMARY.
096970200423
096980200423           READ TRANS-PRIMARY WITH NO LOCK
096990200423             INVALID KEY
097000200423               MOVE "TRANS TARGET GET" TO WS-FILE-STATUS-FILE-NAME
09701020042358714          PERFORM LOG-FILE-STATUS-RD.
097020200423
097030200423
097040200423           MOVE TRANS-TYPE-CODE OF TRANS-PRIMARY
097050200423                               TO TRANS-CATAGORY.
097060200423           MOVE TRANS-STATUS-CODE OF TRANS-PRIMARY
097070200423                               TO TRANS-STATUS-CATAGORY.
097080200423      * RFS 10826 BEGIN
097090200423
097100200423           IF SWITCH-IN-TRANSACTION
097110200423             MOVE REVERSAL-CODE OF WS-TRANS-REC-2
097120200423                               TO REVERSAL-CODE OF TRANS-PRIMARY
097130200423             MOVE REVERSAL-CODE OF TRANS-PRIMARY
097140200423                               TO REVERSAL-CODE
097150200423                               OF REVERSAL-REASON
097160200423             READ REVERSAL-REASON
097170200423             INVALID KEY
097180200423               MOVE SPACES     TO WS-REVERSAL-CODE-RULES
097190200423             NOT INVALID KEY
097200200423               MOVE REVERSAL-RULE OF REVERSAL-REASON-REC
097210200423                               TO WS-REVERSAL-CODE-RULES
097220200423             END-READ
097230200423           END-IF
097240200423
097250200423      * RFS 10826 END
097260200423
097270200423           MOVE TRANS-PRIMARY-REC
097280200423                               TO TRANS-REC.
097290200423           MOVE "00"           TO REJECTION-CODE OF TRANS-REC.
097300200423           MOVE TRANS-REC      TO WS-TRANS-REC.
097310200423
097320200423       GST-EXIT.
097330200423           EXIT.
097340200423      /
097350200423      *RFS177665 - Starts
097360200423       GET-SAME-INV-STRUCTURE-CODE SECTION.
097370200423
097380200423       GSIS-0000.
097390200423           INITIALIZE lc_SameInvStructFlag
097400200423                      lc_FuncInvStructureCode
097410200423                      MFAISTFNP OF INVESTMENT-STRUCTURE-FUNC-REC.
097420200423
097430200423           MOVE lc_SWIInvestmentCode
097440200423             TO INVESTMENT-CODE
097450200423             OF INVESTMENT-STRUCTURE-FUNCTION.
097460200423           MOVE lc_FunctionCode
097470200423             TO FUNCTION-CODE
097480200423             OF INVESTMENT-STRUCTURE-FUNCTION.
097490200423
097500200423           START INVESTMENT-STRUCTURE-FUNCTION
097510200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
097520200423             INVALID KEY
097530200423             GO TO GSIS-EXIT
097540200423           END-START.
097550200423
097560200423       GSIS-0010.
097570200423           READ INVESTMENT-STRUCTURE-FUNCTION NEXT RECORD
097580200423             AT END
097590200423             GO TO GSIS-0020
097600200423           END-READ.
097610200423
097620200423           IF INVESTMENT-CODE OF INVESTMENT-STRUCTURE-FUNCTION
097630200423              IS NOT EQUAL TO lc_SWIInvestmentCode    OR
097640200423              FUNCTION-CODE OF INVESTMENT-STRUCTURE-FUNCTION
097650200423              IS NOT EQUAL TO lc_FunctionCode
097660200423              GO TO GSIS-EXIT
097670200423           END-IF.
097680200423
097690200423           MOVE INVESTMENT-STRUCTURE-CODE
097700200423             OF INVESTMENT-STRUCTURE-FUNCTION
097710200423             TO lc_FuncInvStructureCode.
097720200423
097730200423       GSIS-0020.
097740200423           INITIALIZE MFAISTFNP OF INVESTMENT-STRUCTURE-FUNC-REC.
097750200423
097760200423           MOVE lc_SWOInvestmentCode
097770200423             TO INVESTMENT-CODE
097780200423             OF INVESTMENT-STRUCTURE-FUNCTION.
097790200423           MOVE lc_FuncInvStructureCode
097800200423             TO INVESTMENT-STRUCTURE-CODE
097810200423             OF INVESTMENT-STRUCTURE-FUNCTION.
097820200423           MOVE lc_FunctionCode
097830200423             TO FUNCTION-CODE
097840200423             OF INVESTMENT-STRUCTURE-FUNCTION.
097850200423
097860200423           READ INVESTMENT-STRUCTURE-FUNCTION
097870200423                INVALID KEY
097880200423                GO TO GSIS-EXIT.
097890200423
097900200423           MOVE "Y"          TO lc_SameInvStructFlag.
097910200423       GSIS-EXIT.
097920200423           EXIT.
097930200423      *RFS177665 - Ends
097940200423
097950200423       REGET-SELL-BUY-TARGET SECTION.
097960200423      ******************************************************************
097970200423      *    R E G E T   S E L L / B U Y   T A R G E T   R O U T I N E   *
097980200423      ******************************************************************
097990200423
098000200423       RST-0000.
098010200423
098020200423      * Reset the transaction to the origional transaction
098030200423
098040200423           MOVE TRANS-REC         TO WS-TRANS-REC-1.
098050200423           MOVE WS-TRANS-REC-2    TO TRANS-REC.
098060200423           MOVE TRANS-REC      TO WS-TRANS-REC.
098070200423
098080200423           MOVE TRANS-TYPE-CODE OF TRANS
098090200423                               TO TRANS-CATAGORY.
098100200423           MOVE TRANS-STATUS-CODE OF TRANS
098110200423                               TO TRANS-STATUS-CATAGORY.
098120200423      *RFS 10826 BEGIN
098130200423           MOVE REVERSAL-CODE OF TRANS
098140200423                               TO REVERSAL-CODE
098150200423                               OF REVERSAL-REASON
098160200423           READ REVERSAL-REASON
098170200423           INVALID KEY
098180200423             MOVE SPACES     TO WS-REVERSAL-CODE-RULES
098190200423           NOT INVALID KEY
098200200423             MOVE REVERSAL-RULE OF REVERSAL-REASON-REC
098210200423                             TO WS-REVERSAL-CODE-RULES
098220200423           END-READ.
098230200423
098240200423      *RFS 10826 END
098250200423
098260200423       RST-EXIT.
098270200423           EXIT.
098280200423      /
098290200423       GET-WIRE-ORDER-TARGET SECTION.
098300200423      ******************************************************************
098310200423      *    G E T   W I R E   O R D E R   T A R G E T   R O U T I N E   *
098320200423      ******************************************************************
098330200423
098340200423       GWT-0000.
098350200423           MOVE "WDS"          TO WS-RELATIONSHIP-CODE.
098360200423           PERFORM GET-TARGET-2.
098370200423
098380200423           IF WS-TARGET-NOT-FOUND IS EQUAL TO "Y"
098390200423             GO TO GWT-EXIT
098400200423           END-IF.
098410200423
098420200423           MOVE PLACEMENT-DATE   OF TRANS-TARGET-2
098430200423                               TO PLACEMENT-DATE OF TRANS-PRIMARY
098440200423           MOVE TRANS-NO         OF TRANS-TARGET-2
098450200423                               TO TRANS-NO OF TRANS-PRIMARY.
098460200423           READ TRANS-PRIMARY WITH NO LOCK
098470200423             INVALID KEY
098480200423             MOVE "28"         TO REJECTION-CODE OF TRANS
098490200423             GO TO GWT-EXIT.
098500200423
098510200423           IF TRANS-STATUS-CODE OF TRANS-PRIMARY IS NOT EQUAL "HST"
098520200423           OR ACCOUNT-NO OF TRANS-PRIMARY IS NOT EQUAL
098530200423              ACCOUNT-NO OF TRANS
098540200423           OR INVESTMENT-CODE OF TRANS-PRIMARY IS NOT EQUAL
098550200423              INVESTMENT-CODE OF TRANS
098560200423             MOVE "28"         TO REJECTION-CODE OF TRANS
098570200423           END-IF.
098580200423
098590200423       GWT-EXIT.
098600200423           EXIT.
098610200423      /
098620200423       SET-SELL-BUY-PROCEEDS SECTION.
098630200423      ******************************************************************
098640200423      *    S E T   S E L L / B U Y   P R O C E E D S   R O U T I N E   *
098650200423      ******************************************************************
098660200423
098670200423       SSP-0000.
098680200423           IF WS-OUT-CURRENCY = WS-IN-CURRENCY
098690200423              MOVE WS-OUT-NET TO GROSS-AMT OF TRANS
098700200423              GO TO SSP-EXIT.
098710200423
098720200423      * RFS17813 - Begin
098730200423      *    IF WS-OUT-CURRENCY IS NOT EQUAL TO "CAD"
098740200423           IF WS-OUT-CURRENCY NOT = WS-BASE-CURRENCY
098750200423      * RFS17813 - End
098760200423             COMPUTE WS-OUT-NET-2 ROUNDED =
098770200423             WS-OUT-NET / WS-OUT-EXCHANGE-RATE
098780200423           ELSE
098790200423             MOVE WS-OUT-NET   TO WS-OUT-NET-2.
098800200423
098810200423           COMPUTE GROSS-AMT OF TRANS ROUNDED =
098820200423             WS-OUT-NET-2 * WS-IN-EXCHANGE-RATE.
098830200423
098840200423       SSP-EXIT.
098850200423           EXIT.
098860200423      /
098870200423       CALCULATE-GROSS-AMT SECTION.
098880200423      ******************************************************************
098890200423      *    C A L C U L A T E   G R O S S   A M O U N T   R O U T I N E *
098900200423      ******************************************************************
098910200423
098920200423       CGA-0000.
098930200423
098940200423      * If transaction was placed in shares than calculate
098950200423      * the net value of the units
098960200423
098970200423           MOVE ZEROES       TO WS-UNITS-REFRESH.
098980200423
098990200423           IF PLACED-UNITS
099000200423             COMPUTE NET-AMT OF TRANS ROUNDED =
099010200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
099020200423             MOVE NET-AMT OF TRANS
099030200423                               TO GROSS-AMT OF TRANS
099040200423             MOVE UNIT-AMT OF TRANS
099050200423                               TO WS-UNITS-REFRESH
099060200423           END-IF.
099070200423
099080200423           IF PLACED-ALL-UNITS
099090200423
099100200423             IF NOT GIC-INVESTMENT
099110200423      *13130 START
099120200423                 IF DII-INVESTMENT                     AND              RFS9932
099130200423                 (TRANS-ORIGIN-CODE OF TRANS = "AWE"   OR               RFS9932
099140200423                  TRANS-ORIGIN-CODE OF TRANS = "AWR"   OR
099150200423                  TRANS-ORIGIN-CODE OF TRANS = "AWC")                   RFS9932
099160200423      *RFS16152 - start
099170200423                    MOVE LT-Y   TO WS-DII-AWD
099180200423                    IF UNIT-AMT OF TRANS NOT EQUAL TO 0
099190200423                     CONTINUE
099200200423                    ELSE
099210200423                       IF GROSS-AMT OF TRANS = 0
099220200423                         MOVE WS-AVAILABLE-UNITS TO
099230200423                              UNIT-AMT OF TRANS
099240200423                         CONTINUE
099250200423                       ELSE
099260200423                         GO TO CGA-0005
099270200423                       END-IF
099280200423                    END-IF
099290200423      *RFS16152 - end
099300200423                 ELSE
099310200423                     MOVE WS-AVAILABLE-UNITS
099320200423                                   TO UNIT-AMT OF TRANS
099330200423      *RFS16152 - start
099340200423                     MOVE UNIT-AMT OF TRANS
099350200423                                   TO WS-UNITS-REFRESH
099360200423      *RFS16152 - end
099370200423                 END-IF
099380200423      *13130 END
099390200423             ELSE
099400200423               MOVE CURRENT-CERTIFICATE-BALANCE
099410200423               OF GIC-CERTIFICATE-DETAILS
099420200423                               TO UNIT-AMT OF TRANS
099430200423             END-IF
099440200423             COMPUTE NET-AMT OF TRANS ROUNDED =
099450200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
099460200423             MOVE NET-AMT OF TRANS
099470200423                               TO GROSS-AMT OF TRANS
099480200423             MOVE UNIT-AMT OF TRANS
099490200423                               TO WS-UNITS-REFRESH
099500200423           END-IF.
099510200423
099520200423      *RFS 8058 BEGIN
099530200423      *RFS16152 - start
099540200423       CGA-0005.
099550200423      *RFS16152 - end
099560200423
099570201223      *RFS180707 - Starts
099580201223      *    IF PLACED-FREE-UNITS AND NOT ACCOUNT-LEV-DSC
099590201223           IF PLACED-FREE-UNITS AND
099600201223           NOT (ACCOUNT-LEV-DSC AND lnc_ACINDSCNo)
099610201223      *RFS180707 - Ends
099620200423             MOVE "Y"          TO WS-CRC-0020-EXIT-POINT
099630200423             PERFORM CALCULATE-REDEMPTION-CDSC
099640200423             IF WS-AVAILABLE-UNITS IS GREATER THAN WS-CURR-UNITS-FREE
099650200423               MOVE WS-CURR-UNITS-FREE TO UNIT-AMT OF TRANS
099660200423             ELSE
099670200423               MOVE WS-AVAILABLE-UNITS TO UNIT-AMT OF TRANS
099680200423             END-IF
099690200423             COMPUTE NET-AMT OF TRANS ROUNDED =
099700200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
099710200423             MOVE NET-AMT OF TRANS
099720200423                               TO GROSS-AMT OF TRANS
099730200423180669       IF (li_HierGross  > 0  AND
099740200423180669          SPLIT-OPTION-CODE OF TRANS = "F" )
099750200423180669          MOVE li_HierGross  TO GROSS-AMT OF TRANS
099760200423180669          COMPUTE UNIT-AMT OF TRANS ROUNDED =
099770200423180669             (li_HierGross / UNIT-PRICE OF TRANS)
099780200423180669          MOVE li_HierGross  TO NET-AMT OF TRANS
099790200423180669       END-IF
099800200423             MOVE UNIT-AMT OF TRANS
099810200423                               TO WS-UNITS-REFRESH
099820200423           END-IF.
099830200423
099840200423           IF PLACED-FREE-UNITS AND ACCOUNT-LEV-DSC
099850201223      *RFS180707 - Starts
099860201223           AND lnc_ACINDSCNo
099870201223      *RFS180707 - Ends
099880200423             MOVE "Y"          TO WS-CRC-0020-EXIT-POINT
099890200423             PERFORM CALCULATE-REDEMPTION-CDSC
099900200423             COMPUTE UNIT-AMT OF TRANS ROUNDED = ((WS-CURR-UNITS-FREE *
099910200423             WS-CDSC-MARKET-VALUE-ACC) / WS-CDSC-ORIG-VALUE-ACC)
099920200423             / UNIT-PRICE OF TRANS
099930200423
099940200423             IF WS-AVAILABLE-UNITS IS LESS THAN UNIT-AMT OF TRANS
099950200423               MOVE WS-AVAILABLE-UNITS TO UNIT-AMT OF TRANS
099960200423               COMPUTE NET-AMT OF TRANS ROUNDED =
099970200423               UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
099980200423               MOVE NET-AMT OF TRANS
099990200423                               TO GROSS-AMT OF TRANS
100000200423180669          IF (li_HierGross  > 0  AND
100010200423180669              SPLIT-OPTION-CODE OF TRANS = "F" )
100020200423180669              MOVE li_HierGross  TO GROSS-AMT OF TRANS
100030200423180669             COMPUTE UNIT-AMT OF TRANS ROUNDED =
100040200423180669             (li_HierGross / UNIT-PRICE OF TRANS)
100050200423180669             MOVE li_HierGross  TO NET-AMT OF TRANS
100060200423180669          END-IF
100070200423             ELSE
100080200423
100090200423               COMPUTE NET-AMT OF TRANS ROUNDED =
100100200423               ((WS-CURR-UNITS-FREE *
100110200423               WS-CDSC-MARKET-VALUE-ACC) / WS-CDSC-ORIG-VALUE-ACC)
100120200423
100130200423               MOVE NET-AMT OF TRANS
100140200423                               TO GROSS-AMT OF TRANS
100150200423180669          IF (li_HierGross  > 0  AND
100160200423180669              SPLIT-OPTION-CODE OF TRANS = "F" )
100170200423180669              MOVE li_HierGross  TO GROSS-AMT OF TRANS
100180200423180669             COMPUTE UNIT-AMT OF TRANS ROUNDED =
100190200423180669             (li_HierGross / UNIT-PRICE OF TRANS)
100200200423180669             MOVE li_HierGross  TO NET-AMT OF TRANS
100210200423180669          END-IF
100220200423
100230200423             END-IF
100240200423
100250200423             MOVE UNIT-AMT OF TRANS
100260200423                               TO WS-UNITS-REFRESH
100270200423
100280200423           END-IF.
100290200423
100300200423      *RFS 8058 END
100310200423
100320200423      *RFS 8058 BEGIN
100330200423           IF (PLACED-MATURE-UNITS OR PLACED-TOTAL-FREE-UNITS)
100340201223      *RFS180707 - Starts
100350201223      *    AND NOT ACCOUNT-LEV-DSC
100360201223           AND NOT (ACCOUNT-LEV-DSC AND lnc_ACINDSCNo)
100370201223      *RFS180707 - Ends
100380200423             MOVE "Y"          TO WS-CRC-0020-EXIT-POINT
100390200423
100400200423      *-- RFS 33712 Begins -- *
100410200423             MOVE ZEROES TO ld-Curr-Units-Free-Hold
100420200423      *-- RFS 33712 Ends   -- *
100430200423
100440200423             PERFORM CALCULATE-REDEMPTION-CDSC
100450200423
100460200423      *-- RFS 33712 Begins -- *
100470200423             MOVE WS-CURR-UNITS-FREE TO ld-Curr-Units-Free-Hold
100480200423      *-- RFS 33712 Ends   -- *
100490200423
100500200423             IF WS-AVAILABLE-UNITS IS GREATER THAN WS-CURR-UNITS-BAL
100510200423               MOVE WS-CURR-UNITS-BAL  TO UNIT-AMT OF TRANS
100520200423             ELSE
100530200423               MOVE WS-AVAILABLE-UNITS TO UNIT-AMT OF TRANS
100540200423             END-IF
100550200423
100560200423             COMPUTE NET-AMT OF TRANS ROUNDED =
100570200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
100580200423             MOVE NET-AMT OF TRANS
100590200423                               TO GROSS-AMT OF TRANS
100600200423180669         IF (li_HierGross > 0  AND
100610200423180669           (SPLIT-OPTION-CODE OF TRANS = "F" OR
100620200423180669            SPLIT-OPTION-CODE OF TRANS = "M"))
100630200423180669              MOVE li_HierGross  TO GROSS-AMT OF TRANS
100640200423180669             COMPUTE UNIT-AMT OF TRANS ROUNDED =
100650200423180669             (li_HierGross / UNIT-PRICE OF TRANS)
100660200423180669             MOVE li_HierGross  TO NET-AMT OF TRANS
100670200423180669         END-IF
100680200423             MOVE UNIT-AMT OF TRANS
100690200423                               TO WS-UNITS-REFRESH
100700200423           END-IF.
100710200423
100720200423           IF (PLACED-MATURE-UNITS OR PLACED-TOTAL-FREE-UNITS)
100730200423           AND ACCOUNT-LEV-DSC
100740201223      *RFS180707 - Starts
100750201223           AND lnc_ACINDSCNo
100760201223      *RFS180707 - Ends
100770200423             MOVE "Y"          TO WS-CRC-0020-EXIT-POINT
100780200423             PERFORM CALCULATE-REDEMPTION-CDSC
100790200423             COMPUTE UNIT-AMT OF TRANS ROUNDED = ((WS-CURR-UNITS-BAL *
100800200423             WS-CDSC-MARKET-VALUE-ACC) / WS-CDSC-ORIG-VALUE-ACC)
100810200423             / UNIT-PRICE OF TRANS
100820200423
100830200423             IF WS-AVAILABLE-UNITS IS LESS THAN UNIT-AMT OF TRANS
100840200423               MOVE WS-AVAILABLE-UNITS TO UNIT-AMT OF TRANS
100850200423             END-IF
100860200423
100870200423             COMPUTE NET-AMT OF TRANS ROUNDED =
100880200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
100890200423             MOVE NET-AMT OF TRANS
100900200423                               TO GROSS-AMT OF TRANS
100910200423180669         IF (li_HierGross > 0  AND
100920200423180669           (SPLIT-OPTION-CODE OF TRANS = "F" OR
100930200423180669            SPLIT-OPTION-CODE OF TRANS = "M"))
100940200423180669              MOVE li_HierGross  TO GROSS-AMT OF TRANS
100950200423180669             COMPUTE UNIT-AMT OF TRANS ROUNDED =
100960200423180669             (li_HierGross / UNIT-PRICE OF TRANS)
100970200423180669             MOVE li_HierGross  TO NET-AMT OF TRANS
100980200423180669         END-IF
100990200423             MOVE UNIT-AMT OF TRANS
101000200423                               TO WS-UNITS-REFRESH
101010200423           END-IF.
101020200423      *RFS 8058 END
101030200423
101040200423           IF PLACED-PERCENT
101050200423             COMPUTE UNIT-AMT OF TRANS ROUNDED =
101060200423      * RFS44611 - Begin: use only available units for calculation %
101070200423      *      (CURR-UNIT-BAL OF ACCOUNT-INVESTMENT *
101080200423             (ln_AvailUnitsNotContr *
101090200423      * RFS44611 - End
101100200423             (PERCENT-AMT OF TRANS / 100))
101110200423             IF WS-AVAILABLE-UNITS IS LESS THAN UNIT-AMT OF TRANS
101120200423               MOVE WS-AVAILABLE-UNITS TO UNIT-AMT OF TRANS
101130200423             END-IF
101140200423             COMPUTE NET-AMT OF TRANS ROUNDED =
101150200423             UNIT-AMT OF TRANS * UNIT-PRICE OF TRANS
101160200423             MOVE NET-AMT OF TRANS
101170200423                               TO GROSS-AMT OF TRANS
101180200423             MOVE UNIT-AMT OF TRANS
101190200423                               TO WS-UNITS-REFRESH
101200200423           END-IF.
101210200423
101220200423      * If transaction was placed as net amount than
101230200423      * gross up net amount by commission if applicable
101240200423
101250200423           IF PURCHASE-TRANSACTION AND PLACED-NET
101260200423           AND NOT BACK-END-LOAD
101270200423             MOVE "Y"          TO WS-CAC-0005-EXIT-POINT
101280200423             PERFORM CALCULATE-COMMISSIONS
101290200423      * RFS117124 - Start
101300200423           IF REJECTION-CODE OF TRANS NOT EQUAL TO "00"
101310200423              GO TO CGA-EXIT
101320200423           END-IF
101330200423      * RFS117124 - End
101340200423             COMPUTE GROSS-AMT OF TRANS ROUNDED =
101350200423                               ((NET-AMT OF TRANS * 100) /
101360200423                                (100 - COMM-RATE
101370200423                                OF TRANS-COMMISSION))
101380200423           END-IF.
101390200423
101400200423      * If is subject to redemption fee then
101410200423      * gross up net by fee amount
101420200423
101430200423           IF REDEMPTION-TRANSACTION AND PLACED-NET
101440200423      * RFS18128 - Begin
101450200423           AND (NOT SWITCH-OUT-TRANSACTION)
101460200423      *    AND (NOT FEE-TRANSACTION)
101470200423      * RFS18128 - End
101480200423               PERFORM GET-REDEMPTION-FEE
101490200423               MOVE "G"      TO WS-TAX-DEDUCTION-TYPE
101500200423               MOVE "G"      TO WS-CDSC-DEDUCTION-TYPE
101510200423               MOVE "G"      TO WS-CLAWBACK-DEDUCTION-TYPE
101520200423
101530200423      * GIC MOD
101540200423               IF GIC-INVESTMENT
101550200423                 MOVE "G"    TO WS-REPMT-RFE-DEDUCTION-TYPE
101560200423                 MOVE "G"    TO WS-REDE-PLTY-DEDUCTION-TYPE
101570200423               ELSE
101580200423                 MOVE " "    TO WS-REPMT-RFE-DEDUCTION-TYPE
101590200423                 MOVE " "    TO WS-REDE-PLTY-DEDUCTION-TYPE
101600200423               END-IF
101610200423      * END GIC MOD
101620200423
101630200423      *HHMOD
101640200423               IF WS-HH-RATES-APPLICABLE AND NOT BACK-END-LOAD
101650200423                 MOVE "G"      TO WS-HH-REDFEE-DEDUCTION-TYPE
101660200423               ELSE
101670200423                 MOVE " "      TO WS-HH-REDFEE-DEDUCTION-TYPE
101680200423               END-IF
101690200423
101700200423               PERFORM ESTIMATE-GROSS-AMT
101710200423
101720200423           END-IF.
101730200423
101740200423       CGA-0010.
101750200423
101760200423           MOVE SPACES       TO WS-CDSC-DEDUCTION-TYPE
101770200423                                WS-TAX-DEDUCTION-TYPE
101780200423                                WS-CLAWBACK-DEDUCTION-TYPE
101790200423                                WS-HH-REDFEE-DEDUCTION-TYPE
101800200423                                WS-REPMT-RFE-DEDUCTION-TYPE
101810200423                                WS-REDE-PLTY-DEDUCTION-TYPE.
101820200423
101830200423           MOVE "0"          TO WS-TAX-CDSC-APPLICABLE
101840200423                                WS-TAX-LBS-APPLICABLE
101850200423                                WS-TAX-HH-REDFEE-APPLICABLE
101860200423                                WS-TAX-REPMT-RFE-APPLICABLE
101870200423                                WS-TAX-REDE-PLTY-APPLICABLE.
101880200423
101890200423           IF SWITCH-OUT-TRANSACTION
101900200423
101910200423             MOVE "G"        TO WS-TAX-DEDUCTION-TYPE
101920200423
101930200423             IF GIC-INVESTMENT
101940200423               MOVE "G"      TO WS-REPMT-RFE-DEDUCTION-TYPE
101950200423               MOVE "G"      TO WS-REDE-PLTY-DEDUCTION-TYPE
101960200423             END-IF
101970200423
101980200423             IF FROM-BACK-END-LOAD AND NOT TO-BACK-END-LOAD
101990200423               MOVE "G"      TO WS-CDSC-DEDUCTION-TYPE
102000200423             END-IF
102010200423
102020200423             IF FROM-BACK-END-LOAD AND TO-BACK-END-LOAD
102030200423               MOVE "D"      TO WS-CDSC-DEDUCTION-TYPE
102040200423             END-IF
102050200423
102060200423             IF WS-OUT-PRODUCT-TYPE IS EQUAL "LBS"
102070200423             AND INVESTMENT-CODE OF TRANS IS NOT EQUAL
102080200423             INVESTMENT-CODE OF WS-TRANS-REC-1
102090200423               MOVE "G"      TO WS-CLAWBACK-DEDUCTION-TYPE
102100200423             END-IF
102110200423
102120200423             IF WS-OUT-PRODUCT-TYPE IS EQUAL "LBS"
102130200423             AND INVESTMENT-CODE OF TRANS IS EQUAL
102140200423             INVESTMENT-CODE OF WS-TRANS-REC-1
102150200423               MOVE "D"      TO WS-CLAWBACK-DEDUCTION-TYPE
102160200423             END-IF
102170200423      **HHMOD
102180200423
102190200423             IF FROM-HHFEE AND TO-HHFEE
102200200423               IF (FROM-FRONT-END-LOAD AND TO-BACK-END-LOAD)
102210200423                 MOVE "G"
102220200423                             TO WS-HH-REDFEE-DEDUCTION-TYPE
102230200423               END-IF
102240200423               IF FROM-FRONT-END-LOAD AND TO-FRONT-END-LOAD
102250200423                 MOVE "D"
102260200423                             TO WS-HH-REDFEE-DEDUCTION-TYPE
102270200423               END-IF
102280200423             END-IF
102290200423
102300200423             IF FROM-HHFEE AND NOT TO-HHFEE AND
102310200423             (FROM-FRONT-END-LOAD)
102320200423                 MOVE "G"
102330200423                             TO WS-HH-REDFEE-DEDUCTION-TYPE
102340200423             END-IF
102350200423
102360200423             PERFORM ESTIMATE-GROSS-AMT
102370200423
102380200423             IF WS-CLAWBACK-DEDUCTION-TYPE = "D"
102390200423               MOVE "1"      TO WS-TAX-LBS-APPLICABLE
102400200423             END-IF
102410200423
102420200423             IF WS-CDSC-DEDUCTION-TYPE = "D"
102430200423               MOVE "1"      TO WS-TAX-CDSC-APPLICABLE
102440200423             END-IF
102450200423
102460200423             IF WS-HH-REDFEE-DEDUCTION-TYPE = "D"
102470200423               MOVE "1"      TO WS-TAX-HH-REDFEE-APPLICABLE
102480200423             END-IF
102490200423
102500200423             IF WS-TAX-LBS-APPLICABLE = "1" OR WS-TAX-CDSC-APPLICABLE
102510200423             = "1" OR WS-TAX-HH-REDFEE-APPLICABLE = "1"
102520200423               MOVE TRANS-REC TO WS-TRANS-REC-3
102530200423               COMPUTE UNIT-AMT OF WS-TRANS-REC-3 ROUNDED =
102540200423               WS-CURRENT-RANGE-VALUE-D / UNIT-PRICE OF TRANS
102550200423               MOVE WS-CURRENT-RANGE-VALUE-D
102560200423                             TO GROSS-AMT OF WS-TRANS-REC-3
102570200423                                NET-AMT OF WS-TRANS-REC-3
102580200423             END-IF
102590200423
102600200423           END-IF.
102610200423
102620200423           IF REDEMPTION-TRANSACTION
102630200423             IF PLACED-IN-UNITS
102631210927      *RFS1119590 Starts
102632210927               IF (ENTERED-BY OF TRANS IS EQUAL "WITHDHIERC"
102633210927                   AND NOT (GROSS-OR-NET OF TRANS IS EQUAL "N"
102634210927                   AND SPLIT-OPTION-CODE OF TRANS IS EQUAL "M" OR "F"))
102635210927                    OR ENTERED-BY OF TRANS IS NOT EQUAL "WITHDHIERC"
102636210927      *RFS1119590 Ends
102640200423               MOVE WS-UNITS-REFRESH
102650200423                             TO UNIT-AMT OF TRANS
102651210927      *RFS1119590 Starts
102652210927               END-IF
102653210927      *RFS1119590 Ends
102660200423             END-IF
102670200423           END-IF.
102680200423
102690200423       CGA-EXIT.
102700200423           EXIT.
102710200423      /
102720200423       GET-REDEMPTION-FEE SECTION.
102730200423      ******************************************************************
102740200423      *    G E T   R E D E M P T I O N   F E E   R O U T I N E         *
102750200423      ******************************************************************
102760200423
102770200423      *RFS 7152 start
102780200423       GRF-0000.
102790200423
102800200423      *RFS 13998, 13773 BEGIN
102810200423      *RFS 7721  BEGIN
102820200423
102830200423           MOVE 0              TO WS-REDEMPTION-FEE.
102840200423
102850200423      * RFS 112136 - begins.
102860200423           IF  TRANS-ORIGIN-CODE OF TRANS IS EQUAL "DTH"
102870200423             GO TO GRF-EXIT
102880200423           END-IF.
102890200423      * RFS 112136 - ends.
102900200423
102910200423           IF SWITCH-OUT-TRANSACTION
102920200423
102930200423               IF SPEC-MOD-AUTH-ALWBSWO AND SWO-TRANSACTION
102940200423               AND SWO-TRANSACTION
102950200423               AND (TRANS-ORIGIN-CODE OF TRANS IS EQUAL "DIR" OR
102960200423                    TRANS-ORIGIN-CODE OF TRANS IS EQUAL "WOR")
102970200423               AND (NOT WAIVE-ASL-CHARGES)
102980200423                   PERFORM ALLOWABLE-SWITCHES-LIMIT
102990200423               END-IF
103000200423           END-IF
103010200423
103020200423      *RFS 7721  END
103030200423      *RFS 13998, 13773 END
103040200423
103050200423           IF WS-IREDRT-EMPTY = "Y"
103060200423             GO TO GRF-0010
103070200423           END-IF.
103080200423
103090200423      *RFS 8419 BEGIN
103100200423      *RFS 9991 BEGIN
103110200423      *    IF TRANSFER-OUT-TRANSACTION
103120200423           IF SWITCH-OUT-TRANSACTION
103130200423      *RFS 9991 END
103140200423             GO TO GRF-0010
103150200423           END-IF.
103160200423      *RFS 8419 END
103170200423
103180200423           IF INVESTMENT-CODE OF TRANS IS NOT EQUAL
103190200423           INVESTMENT-CODE OF INVESTMENT-REDEM-RATE
103200200423
103210200423              MOVE INVESTMENT-CODE OF TRANS
103220200423                             TO INVESTMENT-CODE
103230200423                             OF INVESTMENT-REDEM-RATE
103240200423
103250200423              READ INVESTMENT-REDEM-RATE
103260200423              INVALID KEY
103270200423                MOVE ZERO    TO WS-INVESTMENT-REDEM-RATE
103280200423                MOVE SPACES  TO INVESTMENT-CODE
103290200423                             OF INVESTMENT-REDEM-RATE
103300200423                GO TO GRF-0010
103310200423              END-READ
103320200423           END-IF.
103330200423
103340200423           MOVE REDEM-RATE OF INVESTMENT-REDEM-RATE
103350200423                             TO WS-INVESTMENT-REDEM-RATE.
103360200423
103370200423           IF WS-INVESTMENT-REDEM-RATE = 0
103380200423             GO TO GRF-0010
103390200423           END-IF.
103400200423
103410200423           IF TRADE-DATE OF TRANS IS LESS THAN START-DATE
103420200423           OF INVESTMENT-REDEM-RATE OR
103430200423              TRADE-DATE OF TRANS IS GREATER THAN MATURITY-DATE
103440200423           OF INVESTMENT-REDEM-RATE
103450200423             MOVE ZERO       TO WS-INVESTMENT-REDEM-RATE
103460200423             GO TO GRF-0010
103470200423           END-IF.
103480200423
103490200423           COMPUTE WS-REDEMPTION-FEE ROUNDED =
103500200423           GROSS-AMT OF TRANS * (WS-INVESTMENT-REDEM-RATE / 100).
103510200423      *RFS 20515 Start
103520200423           MOVE WS-INVESTMENT-REDEM-RATE TO WS-REDF-RATE.
103530200423      *RFS 20515 End
103540200423           MOVE "W"          TO  WRITE-REDEMPTION-FEE.
103550200423           GO TO GRF-0020.
103560200423
103570200423       GRF-0010.
103580200423
103590200423           MOVE PLACEMENT-DATE OF TRANS
103600200423                               TO PLACEMENT-DATE OF TRANS-CHARGES.
103610200423           MOVE TRANS-NO OF TRANS
103620200423                               TO TRANS-NO OF TRANS-CHARGES.
103630200423           MOVE "REDF"         TO DEDUCTION-CODE OF TRANS-CHARGES.
103640200423
103650200423           READ TRANS-CHARGES WITH NO LOCK
103660200423             INVALID KEY
103670200423             GO TO GRF-EXIT.
103680200423
103690200423           MOVE CHARGE OF TRANS-CHARGES
103700200423                               TO WS-REDEMPTION-FEE.
103710200423
103720200423       GRF-0020.
103730200423
103740200423           MOVE WS-REDEMPTION-FEE
103750200423                             TO WS-GST-PST-TAX-BASIS.
103760200423
103770200423      ** Add the GST and PST to the Redemption Fee.  This is so
103780200423      ** they will be included in the Gross up calculations
103790200423
103800200423           PERFORM CALCULATE-GST-PST-AMOUNT.
103810200423
103820200423           IF NOT FEE-TRANSACTION
103830200423             COMPUTE WS-REDEMPTION-FEE = WS-REDEMPTION-FEE +
103840200423             WS-GST-AMOUNT + WS-PST-AMOUNT
103850200423             MOVE WS-GST-AMOUNT
103860200423                             TO WS-GST-AMOUNT2
103870200423             MOVE WS-PST-AMOUNT
103880200423                             TO WS-PST-AMOUNT2
103890200423             MOVE ZERO       TO WS-GST-AMOUNT
103900200423                                WS-PST-AMOUNT
103910200423           END-IF.
103920200423
103930200423      *RFS 7152 end
103940200423
103950200423       GRF-EXIT.
103960200423           EXIT.
103970200423      /
103980200423       GET-BATCH-AMOUNTS SECTION.
103990200423      ******************************************************************
104000200423      *    G E T   B A T C H   A M O U N T S   R O U T I N E           *
104010200423      ******************************************************************
104020200423
104030200423       GBA-0010.
104040200423
104050200423      ** Determine how this trade was placed
104060200423      ** If placed in dollars add dollars to batch
104070200423      ** If placed in units add unit amount to batch
104080200423
104090200423           IF WS-SAV-SPLIT-OPTION-CODE IS NOT EQUAL SPACES
104100200423           AND WS-INTEREST-GENERATED IS EQUAL TO "1"
104110200423             MOVE WS-SAV-SPLIT-OPTION-CODE
104120200423                               TO TRANS-SPLIT-OPTION-CATAGORY
104130200423           END-IF.
104140200423
104150200423           IF PENDING
104160200423             IF PLACED-DOLLARS
104170200423               IF PLACED-NET
104180200423                 IF REDUCTION-TRANSACTION
104190200423                   COMPUTE WS-BATCH-AMOUNT = NET-AMT OF TRANS * -1
104200200423                 ELSE
104210200423                   MOVE NET-AMT OF TRANS
104220200423                                 TO WS-BATCH-AMOUNT
104230200423                 END-IF
104240200423               ELSE
104250200423                 IF REDUCTION-TRANSACTION
104260200423                   COMPUTE WS-BATCH-AMOUNT = GROSS-AMT OF TRANS * -1
104270200423                 ELSE
104280200423      * RFS10655 - Begin
104290200423      * RFS 13213 - BEGIN - Revert back to SETTLEMENT-AMT
104300200423                   MOVE SETTLEMENT-AMT OF TRANS
104310200423      *            MOVE GROSS-AMT      OF TRANS
104320200423                                 TO WS-BATCH-AMOUNT
104330200423      * RFS 13213 - END
104340200423      * RFS10655 - End
104350200423                 END-IF
104360200423               END-IF
104370200423             END-IF
104380200423
104390200423             IF PLACED-UNITS
104400200423               IF REDUCTION-TRANSACTION
104410200423                 COMPUTE WS-BATCH-UNITS = UNIT-AMT OF TRANS * -1
104420200423               ELSE
104430200423                 MOVE UNIT-AMT OF TRANS
104440200423                                 TO WS-BATCH-UNITS
104450200423               END-IF
104460200423             END-IF
104470200423           END-IF.
104480200423
104490200423           IF SETTLED
104500200423             IF REDUCTION-TRANSACTION
104510200423               COMPUTE WS-BATCH-AMOUNT =
104520200423               SETTLEMENT-AMT OF TRANS * -1
104530200423             ELSE
104540200423               MOVE SETTLEMENT-AMT OF TRANS
104550200423                               TO WS-BATCH-AMOUNT
104560200423             END-IF
104570200423           END-IF.
104580200423
104590200423           IF WS-SAV-SPLIT-OPTION-CODE IS NOT EQUAL SPACES
104600200423           AND WS-INTEREST-GENERATED IS EQUAL TO "1"
104610200423             MOVE SPLIT-OPTION-CODE OF TRANS
104620200423                               TO TRANS-SPLIT-OPTION-CATAGORY
104630200423             MOVE SPACES       TO WS-SAV-SPLIT-OPTION-CODE
104640200423           END-IF.
104650200423
104660200423       GBA-EXIT.
104670200423           EXIT.
104680200423      /
104690200714      *RFS183812STARTS
104700200714       CALCULATE-BONUS-COMMISSION SECTION.
104710200714      ******************************************************************
104720200714      *    C A L C U L A T E   B O N U S   C O M M I S S I O N         *
104730200714      ******************************************************************
104740200714       CAC-0000.
104750200714                    MOVE WS-FROM-ACCOUNT-TP1 TO
104760200714                         ACCOUNT-TYPE-CODE    OF SEG-SWITCH-TRF-OPT
104770200714                    MOVE WS-FROM-ACCOUNT-TP2 TO
104780200714                         NOMINEE-ACCOUNT-TYPE OF SEG-SWITCH-TRF-OPT
104790200714                    MOVE TRANS-TYPE-CODE OF WS-TRANS-REC-2 TO
104800200714                         TRANS-TYPE-CODE      OF SEG-SWITCH-TRF-OPT
104810200714                    MOVE TRANS-ORIGIN-CODE OF WS-TRANS-REC-2 TO
104820200714                         TRANS-ORIGIN-CODE    OF SEG-SWITCH-TRF-OPT
104830200714                    MOVE CONTR-REDEM-CODE  OF WS-TRANS-REC-2 TO
104840200714                         CONTR-REDEM-CODE     OF SEG-SWITCH-TRF-OPT
104850200714                    READ SEG-SWITCH-TRF-OPT
104860200714                     INVALID KEY
104870200714                         GO TO CBC-EXIT
104880200714                     NOT INVALID KEY
104890200714                     IF BONUS-COMM-ELIGIBLE OF SEG-SWITCH-TRF-OPT = 'Y'
104900200714                        CONTINUE
104910200714                     ELSE
104920200714                        GO TO CBC-EXIT
104930200714                     END-IF
104940200714                     END-READ
104950200714
104960200714                     INITIALIZE  pn_INTRF-FromAccountNo,
104970200714                                 pc_INTRF-FromAccountTypeCode,
104980200714                                 pc_INTRF-FromNomineeAcctType,
104990200714                                 pc_INTRF-FromTransTypeCode,
105000200714                                 pc_INTRF-FromTransOriginCode,
105010200714                                 pc_INTRF-FromTransCtrRedemCode,
105020200714                                 pn_INTRF-FromTransTradeDate,
105030200714                                 pc_INTRF-ToAccountTypeCode,
105040200714                                 pc_INTRF-Investmentcode,
105050200714                                 pc_INTRF-Calledfromflag,
105060200714                                 pc_INTRF-IntactTrasferFlag,
105070200714                                 pn_INTRF-CommRate,
105080200714                                 pn_INTRF-RateRule,
105090200714                                 pn_INTRF-HoldingPrdPurchaseAmt,
105100200714                                 pc_INTRF-ReturnCode.
105110200714             MOVE ACCOUNT-NO OF WS-TRANS-REC-2        TO
105120200714                         pn_INTRF-FromAccountNo
105130200714             MOVE WS-FROM-ACCOUNT-TP1                 TO
105140200714                         pc_INTRF-FromAccountTypeCode
105150200714             MOVE WS-FROM-ACCOUNT-TP2                 TO
105160200714                         pc_INTRF-FromNomineeAcctType
105170200714             MOVE TRANS-TYPE-CODE OF WS-TRANS-REC-2   TO
105180200714                         pc_INTRF-FromTransTypeCode
105190200714             MOVE TRANS-ORIGIN-CODE OF WS-TRANS-REC-2 TO
105200200714                         pc_INTRF-FromTransOriginCode
105210200714             MOVE CONTR-REDEM-CODE OF WS-TRANS-REC-2  TO
105220200714                         pc_INTRF-FromTransCtrRedemCode
105230200714             MOVE TRADE-DATE OF WS-TRANS-REC-2        TO
105240200714                         pn_INTRF-FromTransTradeDate
105250200714             MOVE WS-TO-ACCOUNT-TP1                   TO
105260200714                         pc_INTRF-ToAccountTypeCode
105270200714             MOVE INVESTMENT-CODE OF WS-TRANS-REC-2   TO
105280200714                         pc_INTRF-Investmentcode
105290200714             MOVE lc-B                                TO
105300200714                         pc_INTRF-Calledfromflag
105310200714
105320200714              CALL "FXINTRFCOM"  USING pn_INTRF-FromAccountNo
105330200714                                       pc_INTRF-FromAccountTypeCode
105340200714                                       pc_INTRF-FromNomineeAcctType
105350200714                                       pc_INTRF-FromTransTypeCode
105360200714                                       pc_INTRF-FromTransOriginCode
105370200714                                       pc_INTRF-FromTransCtrRedemCode
105380200714                                       pn_INTRF-FromTransTradeDate
105390200714                                       pc_INTRF-ToAccountTypeCode
105400200714                                       pc_INTRF-Investmentcode
105410200714                                       pc_INTRF-Calledfromflag
105420200714                                       pc_INTRF-IntactTrasferFlag
105430200714                                       pn_INTRF-CommRate
105440200714                                       pn_INTRF-RateRule
105450200714                                       pn_INTRF-HoldingPrdPurchaseAmt
105460200714                                       pc_INTRF-ReturnCode
105470200714
105480200714                     IF pc_INTRF-ReturnCode = '00'
105490200714                      IF pc_INTRF-IntactTrasferFlag = 'Y'
105500200714                       IF pn_INTRF-RateRule   = ln-2  and
105510200714                          ENTERED-BY OF TRANS = lncc_YEAUTTFR
105520200714                          CONTINUE
105530200714                       ELSE
105540200714                         IF pn_INTRF-HoldingPrdPurchaseAmt      >=
105550200714                            gross-amt of trans
105560200714                            Move 0 TO COMM-AMT OF TRANS-COMMISSION
105570200714                            COMPUTE COMM-PAYABLE OF TRANS-COMMISSION =
105580200714                                  COMM-AMT OF TRANS-COMMISSION
105590200714                            MOVE lc-R TO WRITE-TRANS-COMMISSION
105600200714                         ELSE
105610200824                          COMPUTE COMM-AMT OF TRANS-COMMISSION
105620200824                          ROUNDED =  (Gross-amt of trans -
105630200714                            pn_INTRF-HoldingPrdPurchaseAmt)
105640200714                             * pn_INTRF-CommRate / 100
105650200714                         COMPUTE COMM-PAYABLE OF TRANS-COMMISSION =
105660200714                         COMM-AMT OF TRANS-COMMISSION -
105670200714                         SPONSOR-AMT OF TRANS-COMMISSION
105680200714                         MOVE lc-R TO WRITE-TRANS-COMMISSION
105690200714                         END-IF
105700200714                        END-IF
105710200714                      ELSE
105720200714                        CONTINUE
105730200714                      END-IF
105740200714                     ELSE
105750200714                        GO TO CBC-EXIT
105760200714                     END-IF.
105770200714       CBC-EXIT.
105780200714           EXIT.
105790200714      /
105800200714      *RFS183812ENDS
105810200423       CALCULATE-COMMISSIONS SECTION.
105820200423      ******************************************************************
105830200423      *    C A L C U L A T E   C O M M I S S I O N S   R O U T I N E   *
105840200423      ******************************************************************
105850200423
105860200423       CAC-0000.
105870200423           MOVE PLACEMENT-DATE OF TRANS
105880200423                               TO PLACEMENT-DATE OF TRANS-COMMISSION.
105890200423           MOVE TRANS-NO       OF TRANS
105900200423                               TO TRANS-NO       OF TRANS-COMMISSION.
105910200423           READ TRANS-COMMISSION WITH NO LOCK
105920200423             KEY IS EXTERNALLY-DESCRIBED-KEY
105930200423             INVALID KEY
105940200423             GO TO CAC-EXIT.
105950200423
105960200423           IF WS-CAC-0005-EXIT-POINT IS EQUAL "Y"
105970200423             MOVE "N"          TO WS-CAC-0005-EXIT-POINT
105980200423             GO TO CAC-EXIT
105990200423           END-IF.
106000200423
106010200423      ** Check cdsc file to determine if partnership commission
106020200423           IF FRONT-END-LOAD
106030200423             MOVE "Y"            TO WS-COMMISSION-DEDUCT
106040200423           ELSE
106050200423             MOVE "N"            TO WS-COMMISSION-DEDUCT
106060200423           END-IF.
106070200423
106080200423           IF ((NOT SWITCH-IN-TRANSACTION)) OR (FRONT-END-LOAD)
106090200423           OR (CDSC-PAID-BY-DEALER)
106100200423      * RFS 18781 begin
106110200423           OR LSIF-ROLLOVER
106120200423      * RFS 18781 end
106130200423      * RFS38021 - Start: Commission Recovery takes
106140200423      *   precedence over Paid by dealer functionality
106150200423             IF CDSC-PAID-BY-DEALER                             AND
106160200423               (COMMISSION-RECOVERY-ON AND COMMISSION-RECOVERY) AND
106170200423               SWITCH-IN-TRANSACTION                            AND
106180200423               TO-BACK-END-LOAD
106190200423                 MOVE COMM-RATE OF FINANCER-SCHED    TO
106200200423                              COMM-RATE OF TRANS-COMMISSION
106210200423                 GO TO CAC-0006
106220200423             END-IF
106230200423      * RFS38021 - End
106240200423             GO TO CAC-0006
106250200423           END-IF.
106260200423
106270200423      * RFS 10826 BEGIN
106280200423
106290200423           IF (COMMISSION-RECOVERY-ON AND COMMISSION-RECOVERY)
106300200423           AND SWITCH-IN-TRANSACTION
106310200423           AND TO-BACK-END-LOAD
106320200423               MOVE COMM-RATE OF FINANCER-SCHED
106330200423                             TO COMM-RATE OF TRANS-COMMISSION
106340200423               GO TO CAC-0006
106350200423           END-IF.
106360200423
106370200423      * RFS 10826 END
106380200423
106390200423           MOVE INVESTMENT-CODE OF WS-TRANS-REC-5
106400200423                               TO FROM-INVESTMENT
106410200423                               OF INVESTMENT-SWITCHES-CONTROL.
106420200423
106430200423           MOVE INVESTMENT-CODE OF TRANS-REC
106440200423                               TO TO-INVESTMENT
106450200423                               OF INVESTMENT-SWITCHES-CONTROL.
106460200423
106470200423           READ INVESTMENT-SWITCHES-CONTROL
106480200423             INVALID KEY
106490200423             GO TO CAC-0006.
106500200423
106510200423
106520200423           IF STANDARD-COMMISSION OF INVESTMENT-SWITCHES-CONTROL
106530200423      *RFS152940 - Start
106540200423      *    IS EQUAL TO "Y"
106550200423           IS EQUAL TO "Y"  OR "M"
106560200423      *RFS152940 - End
106570200423      * RFS32873 - Begin
106580200423                   OR lncc_X
106590200423      * RFS32873 - End
106600200423             GO TO CAC-0006
106610200423           END-IF.
106620200423      * RFS42622 - Begin: need to skip CDSC commission for ipMaturity
106630200423           IF lncc_ipMaturity        AND
106640200423              SWITCH-IN-TRANSACTION  AND
106650200423              TO-BACK-END-LOAD
106660200423             GO TO CAC-0006
106670200423           END-IF
106680200423      * RFS42622 - End
106690200423      * RFS46125 - Begin: need to skip CDSC commission for Death claims
106700200423      * RFS129787 - Start
106710200423      *    IF lncc_deathClaims       AND
106720200423           IF (lncc_deathClaims      OR
106730200423               lb_OptionXOn    )     AND
106740200423      * RFS129787 - End
106750200423              SWITCH-IN-TRANSACTION
106760200423             GO TO CAC-0006
106770200423           END-IF
106780200423      * RFS46125- End
106790200423
106800200423      * RFS181243 - Start
106810200423           IF lc_MatBuyTrade = lncc_Y
106820200423              GO TO CAC-0006
106830200423           END-IF
106840200423      * RFS181243 - End
106850200423           MOVE "Y"            TO WS-COMMISSION-CDSC.
106860200423
106870200423       CAC-0006.
106880200423      ** Calculate commission amount
106890200423      *
106900200423      * RFS10040 - Begin
106910200423      * RFS11025 - Begin
106920200423      * Moved these code from called    section for efficiency.
106930200423      *
106940200423      * RFS183352- Start
106950200423      * Get GIC Commission Calc Method
106960200423           IF GIC-INVESTMENT
106970200423              IF INVESTMENT-CODE OF TRANS  NOT =
106980200423                        INVESTMENT-CODE OF INVESTMENT-GIC-DETAILS
106990200423                 MOVE INVESTMENT-CODE OF TRANS TO
107000200423                         INVESTMENT-CODE OF INVESTMENT-GIC-DETAILS
107010200423                 READ INVESTMENT-GIC-DETAILS
107020200423                 INVALID KEY
107030200423                     INITIALIZE MFAGIIDLP OF INVESTMENT-GIC-DETAILS
107040200423                 NOT INVALID KEY
107050200423                     CONTINUE
107060200423                END-READ
107070200423              END-IF
107080200423           END-IF.
107090200423
107100200423
107110200423
107120200423      * RFS117124 - Start
107130200423           MOVE COMM-RATE OF TRANS-COMMISSION    TO WS-COMM-RATE
107140200423117124*    IF GIC-INVESTMENT AND lc_Policy = "A"
107150200423117124     IF GIC-INVESTMENT AND lc_InstrReq = "Y"
107160200423129525     IF TRANS-TYPE-CODE OF TRANS = "BUY" OR
107170200423129525        TRANS-TYPE-CODE OF TRANS = "TRI" OR
107180200423129525        TRANS-TYPE-CODE OF TRANS = "SWI"
107190200423
107200200423129525* Check if this is intact transfer by check SEG fund switch/
107210200423129525* transfer table (Certificate Detail flag) MFASGSTOP.  If it
107220200423129525* is intact transfer, do not contine to check GIC instruction
107230200423129525        IF WS-PASS-SWITCH-EDIT = "1"
107240200423129525           MOVE " "    TO lc_TrfCertDtl
107250200423129525           IF TRANS-TYPE-CODE OF TRANS = "TRI" OR
107260200423129525              TRANS-TYPE-CODE OF TRANS = "SWI"
107270200423129525              MOVE WS-FROM-ACCOUNT-TP1 TO
107280200423129525                   ACCOUNT-TYPE-CODE    OF SEG-SWITCH-TRF-OPT
107290200423129525              MOVE WS-FROM-ACCOUNT-TP2 TO
107300200423129525                   NOMINEE-ACCOUNT-TYPE OF SEG-SWITCH-TRF-OPT
107310200423129525              MOVE TRANS-TYPE-CODE OF WS-TRANS-REC-2 TO
107320200423129525                   TRANS-TYPE-CODE      OF SEG-SWITCH-TRF-OPT
107330200423129525              MOVE TRANS-ORIGIN-CODE OF WS-TRANS-REC-2 TO
107340200423129525                   TRANS-ORIGIN-CODE    OF SEG-SWITCH-TRF-OPT
107350200423129525              MOVE CONTR-REDEM-CODE  OF WS-TRANS-REC-2 TO
107360200423129525                   CONTR-REDEM-CODE     OF SEG-SWITCH-TRF-OPT
107370200423129525              READ SEG-SWITCH-TRF-OPT
107380200423129525               INVALID KEY
107390200423129525                 CONTINUE
107400200423129525               NOT INVALID KEY
107410200423129525                 MOVE TRANSFER-CERTIFICATEDTLS OF
107420200423129525                      SEG-SWITCH-TRF-OPT-REC TO
107430200423129525                      lc_TrfCertDtl
107440200423129525               END-READ
107450200423129525           END-IF
107460200423129525        END-IF
107470200423
107480200423              MOVE PLACEMENT-DATE OF TRANS
107490200423                                  TO pi_GICTPlacementDate
107500200423              MOVE TRANS-NO       OF TRANS
107510200423                                  TO pi_GICTTransNum
107520200423
107530200423139280*       INITIALIZE  pn_GICTerm
107540200423              INITIALIZE  pc_GICTRejectionCode
107550200423129525        INITIALIZE  lc_GICCommRejCode
107560200423
107570200423      * For GIC transaction with GIC instruction required flag = Y,
107580200423      * GIC instruction must exist.
107590200423      * RFS139280 - Start:skip SWI/TRI second pass
107600200423              IF SWITCH-IN-TRANSACTION AND WS-PASS-SWITCH-EDIT = "2"
107610200423               CONTINUE
107620200423              ELSE
107630200423               INITIALIZE  pn_GICTerm
107640200423      * RFS139280 - End
107650200423               CALL "FXGICTERM" USING pi_GICTPlacementDate,
107660200423                                     pi_GICTTransNum,
107670200423                                     pn_GICTerm,
107680200423                                     pc_GICTRejectionCode
107690200423139280        END-IF
107700200423
107710200423              IF pc_GICTRejectionCode NOT = SPACES
107720200423                 IF Trans-Type-Code OF Trans Not = "TRI" AND
107730200423                    Trans-Type-Code OF Trans Not = "SWI"
107740200423                     MOVE "G7" TO REJECTION-CODE OF TRANS
107750200423129525               MOVE "G7" TO lc_GICCommRejCode
107760200423                     GO TO CAC-EXIT
107770200423                 END-IF
107780200423
107790200423129525* Reject SWI/TRI transactions if transfer certificate flag = 'N'
107800200423129525* and no GIC instruction found and not mature transactions.
107810200423129525           IF lc_TrfCertDtl Not = "Y" AND
107820200423129525              (TRANS-TYPE-CODE OF TRANS = "TRI" OR "SWI") AND
107830200423129525              (TRANS-ORIGIN-CODE OF TRANS Not = "GIM" AND
107840200423129525               TRANS-ORIGIN-CODE OF TRANS Not = "MAT")
107850200423129525                 MOVE "G7" TO REJECTION-CODE OF TRANS
107860200423129525                 MOVE "G7" TO lc_GICCommRejCode
107870200423129525                 GO TO CAC-EXIT
107880200423129525           END-IF
107890200423
107900200423129525* Reject SWI/TRI transactions if transfer certificate flag = 'Y'
107910200423129525* and it is not GIC to GIC switch/transfer and no GIC instruction.
107920200423129525           IF lc_TrfCertDtl = "Y" AND
107930200423129525              (TRANS-TYPE-CODE OF TRANS = "TRI" OR "SWI") AND
107940200423129525              (TRANS-ORIGIN-CODE OF TRANS Not = "GIM" AND
107950200423129525               TRANS-ORIGIN-CODE OF TRANS Not = "MAT") AND
107960200423129525              (Investment-Type-Rule-SW-In Not =
107970200423129525               Investment-Type-Rule-SW-Out)
107980200423129525                 MOVE "G7" TO REJECTION-CODE OF TRANS
107990200423129525                 MOVE "G7" TO lc_GICCommRejCode
108000200423129525                 GO TO CAC-EXIT
108010200423129525           END-IF
108020200423              END-IF
108030200423
108040200423
108050200423      * For GIC Switch or Transfer transaction, calculate GIC Term
108060200423      * selected if GIC instruction not exist and commission rate <> 0
108070200423              INITIALIZE GMATDAT-PARMS
108080200423              IF (Trans-Type-Code OF Trans = "TRI" OR "SWI") AND
108090200423139280           WS-PASS-SWITCH-EDIT = "1"                   AND
108100200423129525           ((Trans-Origin-Code OF Trans = "GIM" OR "MAT") OR
108110200423129525            lc_TrfCertDtl = "Y") AND
108120200423                 WS-COMM-RATE NOT = 0 AND pn_GICTerm = 0
108130200423                 MOVE Account-No        OF Trans TO pn_AccountNo
108140200423                 MOVE Investment-Code   OF Trans TO pi_InvestmentCode
108150200423                 MOVE Trade-Date        OF Trans TO pi_IssueDate
108160200423                 MOVE Placement-Date    OF Trans TO pn_PlacementDate
108170200423                 MOVE Trans-No          OF Trans TO pn_TransNo
108180200423                 MOVE Trans-Type-Code   OF Trans TO pc_TransType
108190200423                 MOVE Trans-Origin-Code OF Trans TO pc_TransOrig
108200200423                 MOVE Contr-Redem-Code  OF Trans TO pc_ContrRedeemCode
108210200423
108220200423                 CALL "FXGMATDAT" USING GMATDAT-PARMS
108230200423
108240200423                 IF pi_NewTermSelected = 0
108250200423129525*            MOVE "G8" TO REJECTION-CODE OF TRANS
108260200423129525             MOVE "G7" TO REJECTION-CODE OF TRANS
108270200423129525             MOVE "G7" TO lc_GICCommRejCode
108280200423                   GO TO CAC-EXIT
108290200423                  ELSE
108300200423                   MOVE pi_NewTermSelected TO pn_GICTerm
108310200423                 END-IF
108320200423              END-IF
108330200423
108340200423129525*       IF pn_GICTerm = 0
108350200423129525*            MOVE "G8" TO REJECTION-CODE OF TRANS
108360200423129525*            MOVE "G7" TO REJECTION-CODE OF TRANS
108370200423129525*            MOVE "G7" TO lc_GICCommRejCode
108380200423129525*            GO TO CAC-EXIT
108390200423129525*        ELSE
108400200423                 COMPUTE ln_GICTerm = pn_GICTerm  * 1000
108410200423183352           IF  GIC-COMM-CALC-METHOD OF INVESTMENT-GIC-DETAILS
108420200423183352                                        = '1'
108430200423                 COMPUTE WS-COMM-RATE = ( ln_GICTermYears  +
108440200423                  (ln_GICTermDays / 365) ) *
108450200423                   COMM-RATE OF TRANS-COMMISSION
108460200423      * RFS183352-  START
108470200423                 END-IF
108480200423                 IF GIC-COMM-CALC-METHOD OF INVESTMENT-GIC-DETAILS
108490200423                                              = '2'
108500200423                   COMPUTE WS-COMM-RATE = COMM-RATE OF TRANS-COMMISSION
108510200423                 END-IF
108520200423      * RFS183352- End
108530200423
108540200423                 COMPUTE COMM-RATE OF TRANS-COMMISSION = WS-COMM-RATE
108550200423                 MOVE "R"            TO WRITE-TRANS-COMMISSION
108560200423129525*       END-IF
108570200423117124*    ELSE
108580200423117124*       MOVE COMM-RATE OF TRANS-COMMISSION    TO WS-COMM-RATE
108590200423129525     END-IF
108600200423           END-IF.
108610200423
108620200423      * RFS117124 - End
108630200423
108640200423           IF BACK-END-LOAD                            AND
108650200423              PRODUCT-TYPE-CODE OF INVESTMENT = LT-SEG
108660200423      *RFS103858 Begins
108670200423              IF lncc_depCommYears
108680200423                 PERFORM  call-Deposit-Maturity
108690200423                 IF pncc_depCommOk
108700200423                    MOVE pn_depCommRetnRate      TO WS-COMM-RATE
108710200423      *RFS135402 - Begins.
108720200423                    MOVE WS-COMM-RATE  TO COMM-RATE OF TRANS-COMMISSION
108730200423                    MOVE "R"           TO WRITE-TRANS-COMMISSION
108740200423      *RFS135402 - Ends.
108750200423                 END-IF
108760200423              END-IF
108770200423      *RFS103858 Ends
108780200423               PERFORM SET-COMM-RATE
108790200423           END-IF
108800200423      * RFS11025 - End
108810200423           COMPUTE COMM-AMT OF TRANS-COMMISSION ROUNDED =
108820200423           (GROSS-AMT OF TRANS *
108830200423                                 WS-COMM-RATE) / 100.
108840200423      *    COMPUTE COMM-AMT OF TRANS-COMMISSION ROUNDED =
108850200423      *    (GROSS-AMT OF TRANS *
108860200423      *    COMM-RATE OF TRANS-COMMISSION ) / 100.
108870200423      * RFS10040 - End
108880200423
108890200423           IF WS-COMMISSION-DEDUCT IS EQUAL TO "Y"
108900200423             MOVE COMM-AMT OF TRANS-COMMISSION
108910200423                            TO WS-COMMISSION-AMOUNT
108920200423           END-IF.
108930200423
108940200423      ** Calculate sponsor commissions
108950200423           MOVE COMM-SCHEDULE OF INVESTMENT
108960200423                       TO COMM-SCHEDULE OF COMM-SPONSOR-RATE-SCHED.
108970200423
108980200423           READ COMM-SPONSOR-RATE-SCHED
108990200423             KEY IS EXTERNALLY-DESCRIBED-KEY
109000200423             INVALID KEY
109010200423             GO TO CAC-0010.
109020200423
109030200423           IF SPONSOR-RATE-TYPE OF COMM-SPONSOR-RATE-SCHED NOT = "F"
109040200423               COMPUTE SPONSOR-AMT OF TRANS-COMMISSION ROUNDED =
109050200423                   (COMM-AMT OF TRANS-COMMISSION * SPONSOR-RATE
109060200423                        OF COMM-SPONSOR-RATE-SCHED) / 100
109070200423           ELSE
109080200423               IF NOT SWITCH-IN-TRANSACTION
109090200423                   COMPUTE SPONSOR-AMT OF TRANS-COMMISSION ROUNDED =
109100200423                       (GROSS-AMT OF TRANS * SPONSOR-RATE
109110200423                            OF COMM-SPONSOR-RATE-SCHED) / 100
109120200423               END-IF
109130200423           END-IF.
109140200423           MOVE SPONSOR-RATE OF COMM-SPONSOR-RATE-SCHED
109150200423                        TO SPONSOR-RATE OF TRANS-COMMISSION.
109160200423
109170200423
109180200423       CAC-0010.
109190200423      ** Calculate commission payable
109200200423
109210200423
109220200423           COMPUTE COMM-PAYABLE OF TRANS-COMMISSION =
109230200423                           COMM-AMT    OF TRANS-COMMISSION -
109240200423                           SPONSOR-AMT OF TRANS-COMMISSION.
109250200423
109260200423           MOVE "R"            TO WRITE-TRANS-COMMISSION.
109270200423      * RFS181243 - Start
109280200423           IF lc_MatBuyTrade = lncc_Y
109290200423              MOVE ZERO TO COMM-PAYABLE OF TRANS-COMMISSION
109300200423                           COMM-AMT     OF TRANS-COMMISSION
109310200423                           SPONSOR-AMT  OF TRANS-COMMISSION
109320200423                           COMM-RATE    OF TRANS-COMMISSION
109330200423                           WS-COMM-RATE
109340200423           END-IF.
109350200423      * RFS181243 - End
109360200423
109370200423       CAC-EXIT.
109380200423           EXIT.
109390200423      /
109400200423       CALCULATE-COMMISSION-CDSC SECTION.
109410200423      ******************************************************************
109420200423      *    C A L C U L A T E   C O M M I S S I O N   C D S C   R T N . *
109430200423      ******************************************************************
109440200423
109450200423       CCC-0000.
109460200423           IF WS-COMMISSION-CDSC IS NOT EQUAL TO "Y"
109470200423             GO TO CCC-EXIT
109480200423           END-IF.
109490201009      * RFS1104462 - Begin
109500201009           IF pc_INTRF-IntactTrasferFlag = lncc_Y
109510201009             GO TO CCC-EXIT
109520201009           END-IF.
109530201009      * RFS1104462 - End
109540200423
109550200423           IF TRANSFER-LIABILITY
109560200423             GO TO CCC-EXIT
109570200423           END-IF.
109580200423
109590200423      ** RFS171134 - Start **
109600200423           IF COMM-AMT OF TRANS-COMMISSION = 0
109610200423              GO TO CCC-EXIT
109620200423           END-IF.
109630200423      ** RFS171134 - End   **
109640200423
109650200423           MOVE TRANS-REC      TO WS-TRANS-REC-4.
109660200423           MOVE COMM-AMT OF TRANS-COMMISSION
109670200423                               TO NET-AMT OF TRANS.
109680200423           MOVE "N"            TO GROSS-OR-NET OF TRANS.
109690200423           MOVE "3"            TO WS-TAX-CDSC-APPLICABLE.
109700200423           MOVE "3"            TO WS-TAX-LBS-APPLICABLE.
109710200423           MOVE "3"            TO WS-TAX-HH-REDFEE-APPLICABLE.
109720200423           MOVE " "            TO WS-TAX-DEDUCTION-TYPE.
109730200423           MOVE " "            TO WS-TAX-REPMT-RFE-APPLICABLE.
109740200423           MOVE " "            TO WS-TAX-REDE-PLTY-APPLICABLE.
109750200423           MOVE "G"            TO WS-CDSC-DEDUCTION-TYPE.
109760200423           MOVE "G"            TO WS-CLAWBACK-DEDUCTION-TYPE.
109770200423           MOVE "G"            TO WS-HH-REDFEE-DEDUCTION-TYPE.
109780200423           MOVE " "            TO WS-REPMT-RFE-DEDUCTION-TYPE.
109790200423           MOVE " "            TO WS-REDE-PLTY-DEDUCTION-TYPE.
109800200423           PERFORM ESTIMATE-GROSS-AMT.
109810200423
109820200423           MOVE "N"            TO WS-TAX-OFF-SW.
109830200423           MOVE "3"            TO WS-TAX-CDSC-APPLICABLE.
109840200423           MOVE "3"            TO WS-TAX-LBS-APPLICABLE.
109850200423           MOVE "3"            TO WS-TAX-HH-REDFEE-APPLICABLE.
109860200423           MOVE " "            TO WS-TAX-REPMT-RFE-APPLICABLE.
109870200423           MOVE " "            TO WS-TAX-REDE-PLTY-APPLICABLE.
109880200423
109890200423           IF WS-HH-RATES-APPLICABLE AND NOT BACK-END-LOAD
109900200423             PERFORM CALCULATE-HH-REDEM-FEE
109910200423           END-IF.
109920200423
109930200423           PERFORM CALCULATE-REDEMPTION-CDSC.
109940200423
109950200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
109960200423      *RFS 16760 Begin
109970200423             MOVE "Y" TO WS-TBL-UPDATE-LSIF-FILES
109980200423      *RFS 16760 End
109990200423             PERFORM CALCULATE-LBR-SPNS-REDEM
110000200423           END-IF.
110010200423
110020200423      *RFS 14380 Begin
110030200423           IF SPEC-MOD-AUTH-ERFEE
110040200423               MOVE "Y" TO WS-TEP-UPDATE-ERF-FILES
110050200423               PERFORM POST-ERF-SELL-UNITS
110060200423           END-IF.
110070200423      *RFS 14380 End
110080200423
110090200423           MOVE "0"            TO WS-TAX-CDSC-APPLICABLE.
110100200423           MOVE "0"            TO WS-TAX-LBS-APPLICABLE.
110110200423           MOVE "0"            TO WS-TAX-HH-REDFEE-APPLICABLE.
110120200423           MOVE " "            TO WS-TAX-REPMT-RFE-APPLICABLE.
110130200423           MOVE " "            TO WS-TAX-REDE-PLTY-APPLICABLE.
110140200423
110150200423           MOVE TRANS-REC      TO WS-TRANS-REC-3.
110160200423           MOVE WS-TRANS-REC-4 TO TRANS-REC.
110170200423      * RFS137460 - Start: Commented out/rollbacked RFS134706
110180200423134706*    IF WS-COMMISSION-DEDUCT IS EQUAL TO "Y"
110190200423      * RFS137460 - End
110200200423           MOVE COMM-AMT OF TRANS-COMMISSION
110210200423                               TO WS-COMMISSION-AMOUNT
110220200423      * RFS137460 - Start: Commented out/rollbacked RFS134706
110230200423134706*    END-IF.
110240200423      * RFS137460 - End
110250200423           PERFORM CALCULATE-GROSS-NET.
110260200423
110270200423           COMPUTE UNIT-AMT OF TRANS = UNIT-AMT OF TRANS -
110280200423           UNIT-AMT OF WS-TRANS-REC-3.
110290200423
110300200423       CCC-EXIT.
110310200423           EXIT.
110320200423      /
110330200423       CALCULATE-TAX-AMOUNT SECTION.
110340200423      ******************************************************************
110350200423      *    C A L C U L A T E   T A X   A M O U N T   R O U T I N E     *
110360200423      ******************************************************************
110370200423
110380200423       CTA-0000.
110390200423
110400200423      * RFS15841 - Begin
110410200423      * ---------------------------------------------------------------
110420200423      *    IF TAX-ON-GROSS
110430200423      *      MOVE GROSS-AMT OF TRANS
110440200423      *                        TO WS-TAXABLE-AMOUNT
110450200423      *    ELSE
110460200423      *      MOVE NET-AMT OF TRANS
110470200423      *                        TO WS-TAXABLE-AMOUNT
110480200423      *    END-IF.
110490200423      * ---------------------------------------------------------------
110500200423           IF TAX-ON-GROSS
110510200423             IF WS-APPLY-NR-INTEREST
110520200423               MOVE WS-ALL-NR-INTEREST  TO WS-TAXABLE-AMOUNT
110530200423             ELSE
110540200423               MOVE GROSS-AMT OF TRANS  TO WS-TAXABLE-AMOUNT
110550200423             END-IF
110560200423           ELSE
110570200423             IF WS-APPLY-NR-INTEREST
110580200423               MOVE WS-NR-NET-AMT       TO WS-TAXABLE-AMOUNT
110590200423             ELSE
110600200423               MOVE NET-AMT OF TRANS    TO WS-TAXABLE-AMOUNT
110610200423             END-IF
110620200423           END-IF.
110630200423      * RFS15841 - End
110640200423      * RFS92482 - Start
110650200423      * RFS101772 - Start
110660200423      *    IF CASH-DISTRIB  AND Lc_TaxCountryCode  NOT = "CAN"
110670200423           IF (CASH-DISTRIB OR  REINVESTED-DISTRIB) AND
110680200423              Lc_TaxCountryCode  NOT = "CAN"
110690200423      * RFS101772 - End
110700200423
110710200423              PERFORM GET-ROC-RATE
110720200423
110730200423              IF  TRANS-TYPE-CODE OF ROC-TRANS-TYPES =
110740200423                  TRANS-TYPE-CODE OF TRANS
110750200423              AND DISTR-PAYMENT-DATE OF INVESTMENT-ROC-RATES =
110760200423                  TRADE-DATE OF TRANS
110770200423              AND lc_ROCFound = "Y"
110780200423              AND ROC-RATE OF INVESTMENT-ROC-RATES > 0
110790200423
110800200423                  MOVE  "Y"        TO lc_NonRes_Cal
110810200423                  MOVE ROC-RATE OF INVESTMENT-ROC-RATES
110820200423                                   TO ln_ROC_Percent
110830200423                  COMPUTE WS-TAXABLE-AMOUNT ROUNDED =
110840200423100957                GROSS-AMT OF TRANS * (1 - ln_ROC_Percent / 100)
110850200423100957*                   GROSS-AMT OF TRANS * (1 - ln_ROC_Percent)
110860200423
110870200423              END-IF
110880200423           END-IF
110890200423      * RFS92482 - End
11090020042380658      PERFORM ADJUST-RDSP-TAXABLE-AMT.
110910200423
110920200423           PERFORM GET-TAX-RATE.
110930200423
110940200423      * RFS15841 - Begin
110950200423      * ---------------------------------------------------------------
110960200423      * RFS 10635 BEGIN
110970200423      *    IF TAX-ON-GROSS
110980200423      *    IF TAX-ON-GROSS AND NOT NO-WITHHOLDING
110990200423      * RFS 10635 END
111000200423      *      COMPUTE WS-WORK-TAX-RATE = FEDERAL-TAX-RATE OF
111010200423      *      COUNTRY-WITHHOLDING-TAX / 100
111020200423      *      COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
111030200423      *     (GROSS-AMT OF TRANS * WS-WORK-TAX-RATE)
111040200423      *
111050200423      *      COMPUTE WS-WORK-TAX-RATE = PROVINCIAL-TAX-RATE OF
111060200423      *      COUNTRY-WITHHOLDING-TAX / 100
111070200423      *      COMPUTE WS-PROVINCIAL-TAX-AMOUNT ROUNDED =
111080200423      *     (GROSS-AMT OF TRANS * WS-WORK-TAX-RATE)
111090200423      *
111100200423      * RFS 10635 BEGIN
111110200423      *    ELSE
111120200423      *    ELSE IF NOT TAX-ON-GROSS AND NOT NO-WITHHOLDING
111130200423      * RFS 10635 END
111140200423      *      COMPUTE WS-WORK-TAX-RATE = FEDERAL-TAX-RATE OF
111150200423      *      COUNTRY-WITHHOLDING-TAX / 100
111160200423      *      COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
111170200423      *     (NET-AMT OF TRANS * WS-WORK-TAX-RATE)
111180200423      *
111190200423      *      COMPUTE WS-WORK-TAX-RATE = PROVINCIAL-TAX-RATE OF
111200200423      *      COUNTRY-WITHHOLDING-TAX / 100
111210200423      *      COMPUTE WS-PROVINCIAL-TAX-AMOUNT ROUNDED =
111220200423      *     (NET-AMT OF TRANS * WS-WORK-TAX-RATE)
111230200423      *    END-IF.
111240200423      * ---------------------------------------------------------------
111250200423           IF NOT NO-WITHHOLDING
111260200423114854     AND WS_TXWAV_NO
111270200423             COMPUTE WS-WORK-TAX-RATE = FEDERAL-TAX-RATE OF
111280200423                     COUNTRY-WITHHOLDING-TAX / 100
111290200423             COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
111300200423                    (WS-TAXABLE-AMOUNT * WS-WORK-TAX-RATE)
111310200423             COMPUTE WS-WORK-TAX-RATE = PROVINCIAL-TAX-RATE OF
111320200423                     COUNTRY-WITHHOLDING-TAX / 100
111330200423126482     IF NOT (RDSP-ACCOUNT AND WS-CURR-CONTR-REDEM-RULE-DAP)
111340200423             COMPUTE WS-PROVINCIAL-TAX-AMOUNT ROUNDED =
111350200423                    (WS-TAXABLE-AMOUNT * WS-WORK-TAX-RATE)
111360200423126482     ELSE
111370200423126482       COMPUTE WS-PROVINCIAL-TAX-AMOUNT ROUNDED =
111380200423126482             (li_AmountAboveProvDTCBPA * WS-WORK-TAX-RATE)
111390200423126482     END-IF
111400200423      *RFS29550 - Begins
111410200423             IF  SPEC-MOD-AUTH-USWT
111420200423             AND USWT-APPLY-TAX
111430200423      *RFS135318 - Begins
111440200423               AND NOT (RDSP-ACCOUNT
111450200423                        AND WS-CURR-CONTR-REDEM-RULE-AHA)
111460200423      *RFS135318 - Ends
111470200423                 COMPUTE WS-WORK-TAX-RATE = WS-USWT-TAX-RATE / 100
111480200423                 COMPUTE WS-US-WH-TAX-AMOUNT ROUNDED =
111490200423                        (WS-TAXABLE-AMOUNT * WS-WORK-TAX-RATE)
111500200423             ELSE
111510200423                 MOVE 0  TO WS-US-WH-TAX-AMOUNT
111520200423             END-IF
111530200423      *RFS29550 - Ends
111540200423
111550200423      *RFS24191 - Begins
111560200423             IF INCRATCPG-CALC
111570200423                PERFORM CALCULATE-INCRATCPG
111580200423             END-IF
111590200423      *RFS24191 - Ends
111600200423      *RFS24190 - Begins
111610200423             IF NTAXT2062-CALC
111620200423                PERFORM CALCULATE-NTAXT2062
111630200423             END-IF
111640200423
111650200423             IF NTAXREGSEL-CALC
111660200423                PERFORM CALCULATE-NTAXREGSEL
111670200423             END-IF
111680200423      *RFS24190 - Ends
111690200423
111700200423      * RFS92482 - Start
111710200423      * RFS101772 - Start
111720200423      *    IF  CASH-DISTRIB AND Lc_TaxCountryCode  NOT = "CAN"
111730200423           IF (CASH-DISTRIB OR  REINVESTED-DISTRIB) AND
111740200423              Lc_TaxCountryCode  NOT = "CAN"
111750200423      * RFS101772 - End
111760200423           AND lc_NonRes_Cal  = "Y"
111770200423               COMPUTE WS-WORK-TAX-RATE = FEDERAL-TAX-RATE OF
111780200423                       COUNTRY-WITHHOLDING-TAX / 100
111790200423               COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
111800200423                        WS-TAXABLE-AMOUNT * WS-WORK-TAX-RATE
111810200423               MOVE  "N"        TO lc_NonRes_Cal
111820200423           END-IF
111830200423      * RFS92482 - End
111840200423
111850200423      *RFS 21254 Begin
111860200423             IF WS-FEDERAL-TAX-AMOUNT < 0
111870200423                 MOVE 0 TO WS-FEDERAL-TAX-AMOUNT
111880200423             END-IF
111890200423             IF WS-PROVINCIAL-TAX-AMOUNT < 0
111900200423                 MOVE 0 TO WS-PROVINCIAL-TAX-AMOUNT
111910200423             END-IF
111920200423      *RFS 21254
111930200423R29550       IF WS-US-WH-TAX-AMOUNT < 0
111940200423R29550          MOVE 0  TO WS-US-WH-TAX-AMOUNT
111950200423R29550       END-IF
111960200423           END-IF
111970200423      * RFS15841 - End
111980200423
111990200423           IF WS-TRANS-ADDL-TAX-FOUND = "Y"
112000200423             IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "$"
112010200423      * RFS39003 - Start
112020200423               SET lb_SetAddFeeYes TO TRUE
112030200423      * RFS39003 - End
112040200423               IF ADD-REPLACE-TAX = "A"
112050200423                 ADD FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112060200423                             TO WS-FEDERAL-TAX-AMOUNT
112070200423                 ADD PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112080200423                             TO WS-PROVINCIAL-TAX-AMOUNT
112090200423               ELSE
112100200423                 MOVE FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112110200423                             TO WS-FEDERAL-TAX-AMOUNT
112120200423                 MOVE PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112130200423                             TO WS-PROVINCIAL-TAX-AMOUNT
112140200423               END-IF
112150200423             END-IF
112160200423           END-IF.
112170200423      * RFS 35045 - Start
112180200423           IF ADD-TAX-AMT-FLAG = "Y"
112190200423             IF INPUT-FEDERAL-TAX-AMT > 0
112200200423               ADD INPUT-FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112210200423                         TO WS-FEDERAL-TAX-AMOUNT
112220200423             END-IF
112230200423             IF INPUT-PROVINCIAL-TAX-AMT > 0
112240200423               ADD INPUT-PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
112250200423                         TO WS-PROVINCIAL-TAX-AMOUNT
112260200423             END-IF
112270200423           END-IF.
112280200423      * RFS 35045 - End
112290200423
112300200423       CTA-EXIT.
112310200423           EXIT.
112320200423      /
112330200423      * RFS183140 - Begin
112340200423       CALCULATE-LINKED-INTEREST SECTION.
112350200423      ******************************************************************
112360200423      *    CALCLNKINT routine to get interest amount                   *
112370200423      ******************************************************************
112380200423
112390200423       CLI-0000.
112400200423           IF Link-Maturity-NR  AND
112410200423              (MATURITY-DATE OF
112420200423              INVESTMENT-LINK-NOTES-REC <= TRADE-DATE OF TRANS)
112430200423              IF UNIT-AMT OF TRANS = 0
112440200423                 INITIALIZE pi_UnitAmt
112450200423                 COMPUTE pi_UnitAmt ROUNDED =
112460200423                             GROSS-AMT OF TRANS / UNIT-PRICE OF TRANS
112470200423                 COMPUTE Ws-Taxable-Amount ROUNDED =
112480200423                       ((UNIT-PRICE OF TRANS - Ws-AUC-Unit-Cost) *
112490200423                        pi_UnitAmt)
112500200423              ELSE
112510200423                 COMPUTE Ws-Taxable-Amount ROUNDED =
112520200423                       ((UNIT-PRICE OF TRANS - Ws-AUC-Unit-Cost) *
112530200423                        UNIT-AMT OF TRANS)
112540200423              END-IF
112550200423
112560200423              IF (WS-TAXABLE-AMOUNT IS EQUAL TO 0 OR
112570200423                  LESS THAN 0)
112580200423                 MOVE "@@"  To PROVINCE-CODE
112590200423                            OF COUNTRY-WITHHOLDING-TAX
112600200423              END-IF
112610200423           END-IF.
112620200423
112630200423           IF Link-Pre-Maturity AND
112640200423              Lc_TaxCountryCode NOT = lnc-Canada
112650200423              MOVE WS-TAXABLE-AMOUNT TO WS-LINKTAX-AMOUNT
112660200423              IF UNIT-AMT OF TRANS = 0
112670200423                 COMPUTE pi_UnitAmt ROUNDED =
112680200423                             GROSS-AMT OF TRANS / UNIT-PRICE OF TRANS
112690200423              ELSE
112700200423                 MOVE UNIT-AMT OF TRANS   TO  pi_UnitAmt
112710200423              END-IF
112720200423              MOVE NET-AMT OF TRANS    TO  pi_NetAmt
112730200423              COMPUTE pi_NetAmt = pi_NetAmt
112740200423                                + WS-EST-NR-TAX
112750200423
112760200423184858*       CALL "CALCLNKINT"  USING pi_process_mode
112770200423184858        CALL "CALCLNKINT"  USING pi_est_mode
112780200423                                       pi_FxtaxprpPlacementDate
112790200423                                       pi_FxtaxprpTransNo
112800200423                                       pi_UnitAmt
112810200423                                       pi_NetAmt
112820200423                                       pi_InterestAmt
112830200423                                       pi_RetnCode
112840200423
112850200423              MOVE pi_InterestAmt  TO WS-TAXABLE-AMOUNT
112860200423              IF (WS-TAXABLE-AMOUNT IS EQUAL TO 0 OR
112870200423                  LESS THAN 0)
112880200423                  MOVE "@@"  TO PROVINCE-CODE
112890200423                             OF COUNTRY-WITHHOLDING-TAX
112900200423              END-IF
112910200423           END-IF.
112920200423
112930200423       CLI-EXIT.
112940200423           EXIT.
112950200423      *RFS183140 - End
112960200423
112970200423       GET-TAX-RATE SECTION.
112980200423      ******************************************************************
112990200423      *    G E T   T A X   R A T E   R O U T I N E                     *
113000200423      ******************************************************************
113010200423
113020200423       GTR-0000.
113030200423           MOVE PLACEMENT-DATE OF TRANS
113040200423                             TO PLACEMENT-DATE
113050200423                             OF TRANS-ADDITIONAL-TAX
113060200423R33578                          pi_FxtaxprpPlacementDate.
113070200423           MOVE TRANS-NO     OF TRANS
113080200423                             TO TRANS-NO
113090200423                             OF TRANS-ADDITIONAL-TAX
113100200423R33578                          pi_FxtaxprpTransNo.
113110200423
113120200423           MOVE "Y"          TO WS-TRANS-ADDL-TAX-FOUND.
113130200423
113140200423           READ TRANS-ADDITIONAL-TAX
113150200423           INVALID KEY
113160200423             MOVE "N"        TO WS-TRANS-ADDL-TAX-FOUND
113170200423           END-READ.
113180200423
113190200423R24191     INITIALIZE MFACOUTXP OF COUNTRY-TAX.
113200200423
11321020042380658      PERFORM CHECK-RDSP-DAP.
11322020042380658 *    MOVE COUNTRY-CODE OF INVESTOR
11323020042380658      MOVE Lc_TaxCountryCode
113240200423                               TO COUNTRY-CODE
113250200423                               OF COUNTRY-WITHHOLDING-TAX
113260200423R24191                            COUNTRY-CODE
113270200423R24191                         OF COUNTRY-TAX
113280200423R33578                            pc_FxtaxprpIvrTaxCountry.
113290200423
113300200423           IF TAXABLE-PROVINCE
113310200423      * RFS 80658.7 - begins.
113320200423      *      MOVE PROVINCE-CODE OF INVESTOR
113330200423             MOVE Lc_TaxProvinceCode
113340200423      * RFS 80658.7 - ends.
113350200423                               TO PROVINCE-CODE
113360200423                               OF COUNTRY-WITHHOLDING-TAX
113370200423           ELSE
113380200423             MOVE SPACES       TO PROVINCE-CODE
113390200423                               OF COUNTRY-WITHHOLDING-TAX
113400200423           END-IF.
113410200423
113420200423R33578     MOVE PROVINCE-CODE OF INVESTOR
113430200423R33578       TO pc_FxtaxprpIvrTaxProv.
113440200423
11345020042334309      IF VALID-RESP-EAP-TRADE
11346020042334309         MOVE WS-ACC-BEN-CNTRY
11347020042334309           TO COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX
11348020042334309              COUNTRY-CODE OF COUNTRY-TAX
11349020042334309 *  Save the taxable province
11350020042334309         MOVE TAX-PROVINCE-CODE
11351020042334309           TO OLD-TAX-PROVINCE-CODE
11352020042334309         MOVE WS-ACC-BEN-PROV
11353020042334309           TO TAX-PROVINCE-CODE
11354020042334309              PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX
11355020042334309         IF NOT TAXABLE-PROVINCE
11356020042334309            MOVE SPACES
11357020042334309              TO PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX
11358020042334309         END-IF
11359020042334309      END-IF.
113600200423
113610200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
113620200423                               TO ACCOUNT-TYPE-CODE
113630200423                               OF COUNTRY-WITHHOLDING-TAX
113640200423R24191                            ACCOUNT-TYPE-CODE
113650200423R24191                         OF COUNTRY-TAX
113660200423R33578                            pc_FxtaxprpAcctType.
113670200423
113680200423      *Rfs42278
113690200423      *  This is to ensure the read to the Country-Withholding Tax
113700200423      *  table returns a zero when Charge WHT for Non-resident is
113710200423      *  set to "N"  for Linked Notes
113720200423      * R53578 Don't charge NRTax on Nom Registered regarless the flag
113730200423      *        Don't charge NRTax on Cash & Nom Cash When Flag is 'N'
113740200507            IF COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX Not = 'CAN'
113750200423                 AND  lb_LinkNoteSeton
113760200423                 AND  lb_LinkNoteYes
11377020042353578            AND  ( Nom-Acct-Type-Registered
113780200423  |                     OR ( (Acct-Type-Cash OR Nom-Acct-Type-Cash)
113790200423  |                        AND  lc_ChargeNont Not = "Y"
113800200423  |                        )
11381020042353578                 )
11382020042347816            AND  lnc_ContrRedemRuleLinkNote
113830200423                 MOVE "@@"  To PROVINCE-CODE
113840200423                            OF COUNTRY-WITHHOLDING-TAX
113850200423                 SET lb_LinkNoteNoNRTax TO TRUE
11386020042346784       END-IF.
113870200423      *Rfs42278
113880200423
113890200423           IF DISTRIBUTION-TRANSACTION
113900200423R24190     OR POOLED-FUNCTION
113910200423             IF NOMINEE OF ACCOUNT IS EQUAL "Y" AND
113920200423             ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE IS NOT EQUAL SPACES
113930200423               MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
113940200423                               TO ACCOUNT-TYPE-CODE
113950200423                               OF COUNTRY-WITHHOLDING-TAX
113960200423R24191                            ACCOUNT-TYPE-CODE
113970200423R24191                         OF COUNTRY-TAX
113980200423R33578                            pc_FxtaxprpAcctType
113990200423             END-IF
114000200423           END-IF.
114010200423
114020200423           MOVE CONTR-REDEM-CODE  OF TRANS
114030200423                               TO CONTR-REDEM-CODE
114040200423                               OF COUNTRY-WITHHOLDING-TAX
114050200423R33578                            pc_FxtaxprpContrRedemCd.
114060200423
114070200423           MOVE TRANS-TYPE-CODE   OF TRANS
114080200423                               TO TRANS-TYPE-CODE
114090200423                               OF COUNTRY-WITHHOLDING-TAX
114100200423R24191                            TRANS-TYPE-CODE
114110200423R24191                         OF COUNTRY-TAX.
114120200423
114130200423      *RFS24191 - Begins
114140200423           MOVE INVESTMENT-TYPE OF INVESTMENT-GROUP
114150200423             TO INVESTMENT-TYPE OF COUNTRY-WITHHOLDING-TAX
114160200423                INVESTMENT-TYPE OF COUNTRY-TAX.
114170200423
114180200423           MOVE FORM-CODE       OF INVESTMENT-GROUP
114190200423             TO FORM-CODE       OF COUNTRY-WITHHOLDING-TAX.
114200200423      *RFS24191 - Ends
114210200423
114220200423R43677* RFS 43677 - Begin
114230200423      * New rejection code was introduced for Linked Note maturity
114240200423      * processing to make sure that ACB is correct for the
114250200423      * Account/Investment before calculating the Taxable Amount
114260200423      * to figure out the Tax rate on NR.
114270200423      *RFS183140 - Begin
114280200423      *     IF Link-Maturity-NR
114290200423      *       COMPUTE Ws-Taxable-Amount ROUNDED =
114300200423      *               ((UNIT-PRICE OF TRANS - Ws-AUC-Unit-Cost) *
114310200423      *                 UNIT-AMT OF TRANS)
114320200423           IF Link-Maturity-NR AND
114330200423              (MATURITY-DATE OF
114340200423              INVESTMENT-LINK-NOTES-REC <= TRADE-DATE OF TRANS)
114350200423              IF UNIT-AMT OF TRANS = 0
114360200423                 INITIALIZE pi_UnitAmt
114370200423                 COMPUTE pi_UnitAmt ROUNDED =
114380200423                             GROSS-AMT OF TRANS / UNIT-PRICE OF TRANS
114390200423                 COMPUTE Ws-Taxable-Amount ROUNDED =
114400200423                       ((UNIT-PRICE OF TRANS - Ws-AUC-Unit-Cost) *
114410200423                        pi_UnitAmt)
114420200423              ELSE
114430200423                 COMPUTE Ws-Taxable-Amount ROUNDED =
114440200423                       ((UNIT-PRICE OF TRANS - Ws-AUC-Unit-Cost) *
114450200423                        UNIT-AMT OF TRANS)
114460200423              END-IF
114470200423      *RFS183140 - End
114480200423
114490200423              IF (WS-TAXABLE-AMOUNT IS EQUAL TO 0 OR
114500200423                  LESS THAN 0)
114510200423                 MOVE "@@"  To PROVINCE-CODE
114520200423                            OF COUNTRY-WITHHOLDING-TAX
114530200423              END-IF
114540200423           END-IF.
114550200423      *RFS183140 - Begin
114560200423           INITIALIZE pi_InterestAmt
114570200423                      pi_UnitAmt
114580200423                      pi_NetAmt
114590200423                      pi_RetnCode.
114600200423
114610200423           IF Link-Pre-Maturity AND
114620200423              Lc_TaxCountryCode NOT = lnc-Canada
114630200423
114640200423              IF UNIT-AMT OF TRANS = 0
114650200423                 COMPUTE pi_UnitAmt ROUNDED =
114660200423                             GROSS-AMT OF TRANS / UNIT-PRICE OF TRANS
114670200423              ELSE
114680200423                 MOVE UNIT-AMT OF TRANS   TO  pi_UnitAmt
114690200423              END-IF
114700200423              MOVE NET-AMT OF TRANS    TO  pi_NetAmt
114710200423
114720200423              CALL "CALCLNKINT"  USING pi_process_mode
114730200423                                       pi_FxtaxprpPlacementDate
114740200423                                       pi_FxtaxprpTransNo
114750200423                                       pi_UnitAmt
114760200423                                       pi_NetAmt
114770200423                                       pi_InterestAmt
114780200423                                       pi_RetnCode
114790200423
114800200423              MOVE pi_InterestAmt  TO WS-TAXABLE-AMOUNT
114810200423              IF (WS-TAXABLE-AMOUNT IS EQUAL TO 0 OR
114820200423                  LESS THAN 0)
114830200423                  MOVE "@@"  TO PROVINCE-CODE
114840200423                             OF COUNTRY-WITHHOLDING-TAX
114850200423              END-IF
114860200423           END-IF.
114870200423      *RFS183140 - End
114880200423R43677* RFS 43677 - End
114890200423      * RFS126482 - START
114900200423           IF NOT (RDSP-ACCOUNT AND WS-CURR-CONTR-REDEM-RULE-DAP)
114910200423      *    MOVE WS-TAXABLE-AMOUNT
114920200423      *                        TO TAXABLE-AMT
114930200423      *                        OF COUNTRY-WITHHOLDING-TAX
114940200423R33578*                           pn_FxtaxprpAwdAmount.
114950200423           MOVE WS-TAXABLE-AMOUNT TO TAXABLE-AMT OF
114960200423                                     COUNTRY-WITHHOLDING-TAX
114970200423                                     pn_FxtaxprpAwdAmount
114980200423           ELSE
114990200423           MOVE li_ForecastedTaxable TO TAXABLE-AMT OF
115000200423                                        COUNTRY-WITHHOLDING-TAX
115010200423           MOVE li_AmountAboveDTCBPA TO WS-TAXABLE-AMOUNT
115020200423           END-IF.
115030200423      * RFS126482 - END
115040200423      *RFS24191 - Begins
115050200423      * Inclusion Rate for Pooled Funds
115060200423           MOVE SPACES  TO WS-INCRATCPG-CALC.
115070200423
115080200423           IF SPEC-MOD-AUTH-POLTAX
115090200423              IF  EDIT-IRCPG
115100200423              AND POOLED-FUND
115110200423              AND CAPITAL-GAIN-TRANSACTION
115120200423                  PERFORM CHECK-INCRATCPG
115130200423              END-IF
115140200423           END-IF.
115150200423
115160200423111550     MOVE lncc_2 TO RATE-RULE OF COUNTRY-TAX
115170200423
115180200423           READ COUNTRY-TAX
115190200423             KEY IS EXTERNALLY-DESCRIBED-KEY
115200200423               INVALID KEY
115210200423                 MOVE ZEROS  TO TAXATION-RATE OF COUNTRY-TAX
115220200423           END-READ.
115230200423      *RFS24191 - Ends
115240200423
115250200423      ** IF THIS TRANSACTION IS NOT IN CANADIAN DOLLARS THEN
115260200423      ** APPLY THE DAILY EXCHANGE RATE TO THE TAXABLE AMOUNT
115270200423      ** BEFORE LOOKING IT UP OF THE TAX TABLE.
115280200423
115290200423           IF CURRENCY-DDS OF INVESTMENT IS EQUAL "CAD"
115300200423             GO TO GTR-0100
115310200423           END-IF.
115320200423
115330200423           MOVE CURRENCY-DDS OF INVESTMENT
115340200423                             TO CURRENCY-DDS OF EXCHANGE-RATE-HISTORY
115350200423           MOVE TRADE-DATE OF TRANS
115360200423                             TO TRADE-DATE OF EXCHANGE-RATE-HISTORY
115370200423           MOVE WS-EXCHANGE-RATE-TYPE2
115380200423                             TO EXCHANGE-RATE-TYPE
115390200423                             OF EXCHANGE-RATE-HISTORY.
115400200423
115410200423           READ EXCHANGE-RATE-HISTORY
115420200423           INVALID KEY
115430200423             INITIALIZE MFAEXRHMP OF EXCHANGE-RATE-HISTORY              RFS12420
115440200423           GO TO GTR-0100.
115450200423
115460200423           COMPUTE TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
115470200423           ROUNDED = TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX /
115480200423           EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY.
115490200423
115500200423      *RFS33578 - Begins
115510200423           COMPUTE pn_FxtaxprpAwdAmount ROUNDED =
115520200423                   pn_FxtaxprpAwdAmount /
115530200423                   EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY.
115540200423      *RFS33578 - Ends
115550200423
115560200423       GTR-0100.
115570200423
115580200423R33578     PERFORM CALL-FXTAXPRP.
115590200423
115600200423      * RFS12420 - Begin
115610200423           SET SW01-STS-OK            TO TRUE                           RFS8371
115620200423           IF SW-WITHH-RATES-ALL
115630200423               INITIALIZE TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
115640200423           END-IF.
115650200423      * RFS12420 - End
115660200423      * RFS117135 - Start: save the country and province
115670200423           MOVE COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX TO
115680200423                                            lc_tmpCountryCode
115690200423           MOVE PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX TO
115700200423                                            lc_tmpProvinceCode
115710200423      * RFS117135 - End
115720200423           START COUNTRY-WITHHOLDING-TAX
115730200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
115740200423             INVALID KEY
115750200423             MOVE ZERO          TO FEDERAL-TAX-RATE
115760200423                                OF COUNTRY-WITHHOLDING-TAX
115770200423             MOVE ZERO          TO PROVINCIAL-TAX-RATE
115780200423                                OF COUNTRY-WITHHOLDING-TAX
115790200423      * RFS12420 - Begin
115800200423             INITIALIZE         TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
115810200423             SET SW01-STS-END   TO TRUE                                 RFS8371
115820200423      * RFS12420 - End
115830200423             GO TO GTR-EXIT1
115840200423           END-START.
115850200423
115860200423      * RFS12420 - Begin
115870200423       GTR-LOOP.
115880200423      * RFS12420 - End
115890200423
115900200423           READ COUNTRY-WITHHOLDING-TAX NEXT RECORD
115910200423             AT END
115920200423             MOVE ZERO          TO FEDERAL-TAX-RATE
115930200423                                OF COUNTRY-WITHHOLDING-TAX
115940200423             MOVE ZERO          TO PROVINCIAL-TAX-RATE
115950200423                                OF COUNTRY-WITHHOLDING-TAX
115960200423      * RFS12420 - Begin
115970200423             INITIALIZE         TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
115980200423             SET SW01-STS-END   TO TRUE                                 RFS8371
115990200423      * RFS12420 - End
116000200423             GO TO GTR-EXIT1
116010200423           END-READ.
116020200423
116030200423      * RFS115495 - Fix QC32015 Start
116040200423115495*COPY CPBYPWHTAX.
116050200423           PERFORM BYPASS-WITHHOLD-TAX.
116060200423      * RFS115495 - Fix QC32015 End
116070200826      * RFS185892 - Starts
116080200826           If NOT ws_Skip-Withholding-TaxYes
116090200930               PERFORM VERIFY-INDST-EXIST  THRU VIE-EXIT
116100200929               IF lncc_INDSTExistYes
116110200826                   SET ws_Skip-Withholding-TaxYes TO TRUE
116120200929               END-IF
116130200826           END-IF.
116140200826      * RFS185892 -Ends
116150200423115495 GTR-CHECK.
116160200423
11617020042334309      IF
116180200423  |         ((NOT VALID-RESP-EAP-TRADE AND (
116190200423  |   *    IF COUNTRY-CODE OF INVESTOR IS NOT EQUAL
116200200423      *       RFS 80658 - Begins
11621020042334309 *       COUNTRY-CODE OF INVESTOR IS NOT EQUAL
116220200423              Lc_TaxCountryCode        IS NOT EQUAL
116230200423      *       RFS 80658 - Ends
116240200423             COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX
116250200423      *      RFS 80658.7 - Begins - Alter bad comparison
116260200423      *      OR PROVINCE-CODE OF INVESTOR IS NOT EQUAL
116270200423      *      TAX-PROVINCE-CODE
116280200423             OR (TAXABLE-PROVINCE AND
116290200423                 Lc_TaxProvinceCode       IS NOT EQUAL
116300200423                 TO PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX)
116310200423      *      RFS 80658.7 - Ends
11632020042334309        ))
11633020042334309        OR (VALID-RESP-EAP-TRADE AND (
11634020042334309        WS-ACC-BEN-CNTRY IS NOT EQUAL
11635020042334309        COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX )))
116360200423             OR ACCOUNT-TYPE-CODE OF ACCOUNT IS NOT EQUAL
116370200423             ACCOUNT-TYPE-CODE OF COUNTRY-WITHHOLDING-TAX
116380200423             OR CONTR-REDEM-CODE  OF TRANS IS NOT EQUAL
116390200423             CONTR-REDEM-CODE  OF COUNTRY-WITHHOLDING-TAX
116400200423             OR TRANS-TYPE-CODE   OF TRANS IS NOT EQUAL
116410200423             TRANS-TYPE-CODE   OF COUNTRY-WITHHOLDING-TAX
116420200423R24191       OR INVESTMENT-TYPE OF INVESTMENT-GROUP  NOT =
116430200423R24191          INVESTMENT-TYPE OF COUNTRY-WITHHOLDING-TAX
116440200423R24191       OR FORM-CODE       OF INVESTMENT-GROUP  NOT =
116450200423R24191          FORM-CODE       OF COUNTRY-WITHHOLDING-TAX
116460200423      * RFS128279 - Start
116470200423125987*      OR lc_Bypass = "Y"
116480200423             OR ws_Skip-Withholding-TaxYes
116490200423      * RFS128279 - End
116500200423
116510200423             MOVE ZERO          TO FEDERAL-TAX-RATE
116520200423                                OF COUNTRY-WITHHOLDING-TAX
116530200423             MOVE ZERO          TO PROVINCIAL-TAX-RATE
116540200423                                OF COUNTRY-WITHHOLDING-TAX
116550200423R24191       MOVE ZEROS         TO TAXATION-RATE
116560200423R24191                          OF COUNTRY-TAX
116570200423      * RFS117135 - Start
116580200423             MOVE lc_tmpCountryCode  TO
116590200423                            COUNTRY-CODE  OF COUNTRY-WITHHOLDING-TAX
116600200423             MOVE lc_tmpProvinceCode TO
116610200423                            PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX
116620200423      * RFS117135 - End
116630200423      * RFS12420 - Begin
116640200423             INITIALIZE         TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
116650200423             SET SW01-STS-END   TO TRUE                                 RFS8371
116660200423      * RFS12420 - End
116670200423           END-IF.
116680200423      * RFS111550 - Start
116690200423115869*    IF Lc_TaxCountryCode NOT = lnc-Canada AND
116700200423117135     IF NOT SW01-STS-END
116710200423           IF ((Lc_TaxCountryCode NOT = lnc-Canada AND
116720200423               NOT VALID-RESP-EAP-TRADE)           OR
116730200423              (WS-ACC-BEN-CNTRY  NOT = lnc-Canada AND
116740200423               VALID-RESP-EAP-TRADE))             AND
116750200423              TRADE-DATE        OF TRANS >= lnci_20130101
116760200423              IF INCRATCPG-CALC OR
116770200423                 NOT lb_LinkNoteNoNRTax
116780200423                 PERFORM CALL-FXNONTRTY
116790200423115869*          IF lb_TaxTreatyNO AND FEDERAL-TAX-RATE
116800200423115869           IF lb_TaxTreatyNO AND (FEDERAL-TAX-RATE
116810200423                       OF COUNTRY-WITHHOLDING-TAX <  pi_NonTreatyTax
116820200423115869              OR FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
116830200423115869                 = 0 )
116840200423                    MOVE pi_NonTreatyTax TO FEDERAL-TAX-RATE
116850200423                                  OF COUNTRY-WITHHOLDING-TAX
116860200423                 END-IF
116870200423              END-IF
116880200423           END-IF.
116890200423      * RFS111550 - End
116900200423
116910200423       GTR-EXIT1.
116920200423
11693020042334309 * put back the taxable province code
11694020042334309      IF VALID-RESP-EAP-TRADE
11695020042334309         MOVE OLD-TAX-PROVINCE-CODE
11696020042334309           TO TAX-PROVINCE-CODE
11697020042334309      END-IF.
116980200423      *RFS33578 - Begins
116990200423           IF  lb_QcWhTaxFunctionYes
117000200423           AND NOT SW-WITHH-RATES-ALL
117010200423               MOVE ln_QcWhTxAwdProvTaxRate
117020200423                 TO PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
117030200423           END-IF.
117040200423      *RFS33578 - Ends
117050200423
117060200423R35045     MOVE "N" TO ADD-TAX-AMT-FLAG.
117070200423
117080200423           IF WS-TRANS-ADDL-TAX-FOUND = "Y"
117090200423             IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "%"
117100200423               IF ADD-REPLACE-TAX = "A"
117110200423      * RFS39003 - Start
117120200423                 SET lb_SetAddFeeYes TO TRUE
117130200423      * RFS39003 - End
117140200423                 ADD FEDERAL-TAX-PERCENT OF TRANS-ADDITIONAL-TAX
117150200423                             TO FEDERAL-TAX-RATE
117160200423                             OF COUNTRY-WITHHOLDING-TAX
117170200423                 ADD PROVINCIAL-TAX-PERCENT OF TRANS-ADDITIONAL-TAX
117180200423                             TO PROVINCIAL-TAX-RATE
117190200423                             OF COUNTRY-WITHHOLDING-TAX
117200200423               ELSE
117210200423                 MOVE FEDERAL-TAX-PERCENT OF TRANS-ADDITIONAL-TAX
117220200423                             TO FEDERAL-TAX-RATE
117230200423                             OF COUNTRY-WITHHOLDING-TAX
117240200423                 MOVE PROVINCIAL-TAX-PERCENT OF TRANS-ADDITIONAL-TAX
117250200423                             TO PROVINCIAL-TAX-RATE
117260200423                             OF COUNTRY-WITHHOLDING-TAX
117270200423R35045           IF INPUT-FEDERAL-TAX-AMT > 0 OR
117280200423R35045              INPUT-PROVINCIAL-TAX-AMT > 0
117290200423R35045              MOVE "Y" TO ADD-TAX-AMT-FLAG
117300200423R35045           END-IF
117310200423               END-IF
117320200423             END-IF
117330200423           END-IF.
117340200423
117350200423           MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
117360200423                                TO WS-FEDERAL-TAX-RATE-2.
117370200423           MOVE PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
117380200423                                TO WS-PROVINCIAL-TAX-RATE-2.
117390200423
117400200423      *RFS24191 - Begins
117410200423           IF INCRATCPG-CALC
117420200423           OR NTAXT2062-CALC
117430200423           OR NTAXREGSEL-CALC
117440200423              MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
117450200423                TO WS-FED-POOLED-TAX-RATE-2
117460200423              MOVE TAXATION-RATE OF COUNTRY-TAX
117470200423                TO WS-INCLUSION-RATE-2
117480200423           ELSE
117490200423              MOVE ZEROS
117500200423                TO WS-FED-POOLED-TAX-RATE-2
117510200423                   WS-INCLUSION-RATE-2
117520200423           END-IF.
117530200423      *RFS24191 - Ends
117540200423
117550200423      * RFS12420 - Begin
117560200423           IF SW-WITHH-RATES-ALL
117570200423             IF SW01-STS-END        AND                                 RFS8371
117580200423                WS-IND-RATE > 0
117590200423               CONTINUE
117600200423             ELSE
117610200423               ADD 1            TO WS-IND-RATE
117620200423               IF CURRENCY-DDS OF INVESTMENT IS EQUAL "CAD"  OR
117630200423                  EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY = ZERO
117640200423                 COMPUTE WS1-TAXABLE-AMT-TO(WS-IND-RATE) ROUNDED =
117650200423                    TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
117660200423               ELSE
117670200423                 COMPUTE WS1-TAXABLE-AMT-TO(WS-IND-RATE) ROUNDED =
117680200423                    TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX /
117690200423                    EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
117700200423               END-IF
117710200423
117720200423               MOVE WS-FEDERAL-TAX-RATE-2                     TO
117730200423                               WS1-FEDERAL-TAX-RATE(WS-IND-RATE)
117740200423               MOVE WS-PROVINCIAL-TAX-RATE-2                  TO
117750200423                               WS1-PROVINCIAL-TAX-RATE(WS-IND-RATE)
117760200423      * RFS32914 - Start
117770200423      ***  Set ln_TaxAmtTopGross value as a maximum for
117780200423      ***  WS-CURRENT-RANGE-MINIMUM in the Estimation Gross Amount.
117790200423      ***  This will let to pick up lower rate from two possible rates.
117800200423      ***  Sample: $11,000.00 Net amount can be calculated as:
117810200423      ***  1.20% from $13,750.00 or
117820200423      ***  2.30% from $15,714.28.
117830200423           IF GROSS-OR-NET OF TRANS IS EQUAL "N"
117840200423           AND ln_TaxAmtTopGross < WS1-TAXABLE-AMT-TO(WS-IND-RATE)
117850200423           AND lb_SetTopNo
117860200423             COMPUTE ln_WorkNetRate = (100 / (100 -
117870200423             (WS-FEDERAL-TAX-RATE-2 + WS-PROVINCIAL-TAX-RATE-2)))
117880200423                COMPUTE ln_TaxAmtTopGross ROUNDED =
117890200423                ( NET-AMT OF TRANS-REC * ln_WorkNetRate)
117900200423             IF CURRENCY-DDS OF INVESTMENT IS EQUAL "CAD"  OR
117910200423                EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY = ZERO
117920200423               IF ln_TaxAmtTopGross  NOT >
117930200423               WS1-TAXABLE-AMT-TO(WS-IND-RATE)
117940200423                SET lb_SetTopYes   TO TRUE
117950200423               END-IF
117960200423             ELSE
117970200423               IF ln_TaxAmtTopGross NOT >
117980200423               WS1-TAXABLE-AMT-TO(WS-IND-RATE) *
117990200423                EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
118000200423                SET lb_SetTopYes   TO TRUE
118010200423               END-IF
118020200423             END-IF
118030200423           END-IF
118040200423      * RFS32914 - End
118050200423      *RFS24191 - Begins
118060200423               IF INCRATCPG-CALC
118070200423               OR NTAXT2062-CALC
118080200423               OR NTAXREGSEL-CALC
118090200423                  MOVE WS-FED-POOLED-TAX-RATE-2
118100200423                    TO WS1-FED-POOLED-TAX-RATE(WS-IND-RATE)
118110200423                  MOVE WS-INCLUSION-RATE-2
118120200423                    TO WS1-INCLUSION-RATE(WS-IND-RATE)
118130200423               ELSE
118140200423                  MOVE ZEROS
118150200423                    TO WS1-FED-POOLED-TAX-RATE(WS-IND-RATE)
118160200423                       WS1-INCLUSION-RATE(WS-IND-RATE)
118170200423               END-IF
118180200423      *RFS24191 - Ends
118190200423               IF NOT SW01-STS-END                                      RFS8371
118200200423                   GO TO GTR-LOOP
118210200423               END-IF
118220200423             END-IF
118230200423           END-IF.
118240200423      * RFS12420 - End
118250200423
118260200423      *RFS29550 - Begins
118270200423           IF ACCOUNT-NO       OF TRANS   NOT = WS-USWT-ACCOUNT-NO
118280200423           OR INVESTOR-NO      OF ACCOUNT NOT = WS-USWT-INVESTOR-NO
118290200423R30190**   OR NOMINEE-CODE     OF ACCOUNT-NOMINEE  NOT =
118300200423R30190**                                        WS-USWT-NOMINEE-CODE
118310200423R30190**   OR DEALER-CODE      OF TRANS  NOT = WS-USWT-DEALER-CODE
118320200423R30190     OR PLACEMENT-DATE   OF TRANS  NOT = WS-USWT-PLACEMENT-DATE
118330200423R30190     OR TRANS-NO         OF TRANS  NOT = WS-USWT-TRANS-NO
118340200423R30190     OR ACCOUNT-TYPE-CODE OF ACCOUNT  NOT =
118350200423R30190        WS-USWT-ACCOUNT-TYPE-CODE
118360200423R30190     OR CONTR-REDEM-CODE OF TRANS  NOT = WS-USWT-CONTR-REDEM-CODE
118370200423           OR TRANS-TYPE-CODE  OF TRANS  NOT = WS-USWT-TRANS-TYPE-CODE
118380200423           OR TRADE-DATE       OF TRANS  NOT = WS-USWT-TRADE-DATE
118390200423
118400200423              MOVE 0       TO WS-USWT-TAX-RATE
118410200423              MOVE SPACES  TO WS-USWT-APPLY-TAX
118420200423
118430200423              IF SPEC-MOD-AUTH-USWT
118440200423                 IF NOMINEE OF ACCOUNT = "Y"
118450200423                    PERFORM GET-ACCOUNT-NOMINEE
118460200423                 ELSE
118470200423                    MOVE SPACES  TO ACCOUNT-NOM-REC
118480200423                 END-IF
118490200423
118500200423                 MOVE ACCOUNT-NO    OF TRANS    TO WS-USWT-ACCOUNT-NO
118510200423                 MOVE INVESTOR-NO   OF ACCOUNT  TO WS-USWT-INVESTOR-NO
118520200423R30190**         MOVE NOMINEE-CODE  OF ACCOUNT-NOMINEE
118530200423R30190**           TO WS-USWT-NOMINEE-CODE
118540200423R30190**         MOVE DEALER-CODE   OF TRANS    TO WS-USWT-DEALER-CODE
118550200423R30190           MOVE PLACEMENT-DATE  OF TRANS
118560200423R30190             TO WS-USWT-PLACEMENT-DATE
118570200423R30190           MOVE TRANS-NO        OF TRANS  TO WS-USWT-TRANS-NO
118580200423R30190           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
118590200423R30190             TO WS-USWT-ACCOUNT-TYPE-CODE
118600200423R30190           MOVE CONTR-REDEM-CODE OF TRANS
118610200423R30190             TO WS-USWT-CONTR-REDEM-CODE
118620200423                 MOVE TRANS-TYPE-CODE OF TRANS
118630200423                   TO WS-USWT-TRANS-TYPE-CODE
118640200423                 MOVE TRADE-DATE    OF TRANS    TO WS-USWT-TRADE-DATE
118650200423                 MOVE SPACES  TO WS-USWT-RETURN-CODE
118660200423
118670200423                 CALL "FGUSBWHTX"  USING WS-USWT-ACCOUNT-NO
118680200423                                         WS-USWT-INVESTOR-NO
118690200423R30190**                                 WS-USWT-NOMINEE-CODE
118700200423R30190**                                 WS-USWT-DEALER-CODE
118710200423R30190                                   WS-USWT-PLACEMENT-DATE
118720200423R30190                                   WS-USWT-TRANS-NO
118730200423R30190                                   WS-USWT-ACCOUNT-TYPE-CODE
118740200423R30190                                   WS-USWT-CONTR-REDEM-CODE
118750200423                                         WS-USWT-TRANS-TYPE-CODE
118760200423                                         WS-USWT-TRADE-DATE
118770200423                                         WS-USWT-TAX-RATE
118780200423                                         WS-USWT-APPLY-TAX
118790200423                                         WS-USWT-RETURN-CODE
118800200423              END-IF
118810200423           END-IF.
118820200423      *RFS29550 - Ends
118830200423       GTR-EXIT.
118840200423           EXIT.
118850200423      *RFS45991 - Start
118860200423       GET-ADDL-TAX-AMT SECTION.
118870200423           MOVE PLACEMENT-DATE OF TRANS
118880200423             TO PLACEMENT-DATE OF TRANS-CHARGES.
118890200423           MOVE TRANS-NO OF TRANS  TO TRANS-NO       OF TRANS-CHARGES.
118900200423           MOVE "FEDT"             TO DEDUCTION-CODE OF TRANS-CHARGES.
118910200423           READ TRANS-CHARGES WITH NO LOCK
118920200423           INVALID KEY
118930200423             INITIALIZE WS-FEDERAL-TAX-AMOUNT-2
118940200423           NOT INVALID KEY
118950200423              MOVE CHARGE OF TRANS-CHARGES TO WS-FEDERAL-TAX-AMOUNT-2
118960200423           END-READ
118970200423
118980200423           MOVE PLACEMENT-DATE OF TRANS
118990200423             TO PLACEMENT-DATE OF TRANS-CHARGES.
119000200423           MOVE TRANS-NO OF TRANS  TO TRANS-NO       OF TRANS-CHARGES.
119010200423           MOVE "PRVT"             TO DEDUCTION-CODE OF TRANS-CHARGES.
119020200423           READ TRANS-CHARGES WITH NO LOCK
119030200423           INVALID KEY
119040200423             INITIALIZE WS-PROVINCIAL-TAX-AMOUNT-2
119050200423           NOT INVALID KEY
119060200423              MOVE CHARGE OF TRANS-CHARGES TO WS-PROVINCIAL-TAX-AMOUNT-2
119070200423           END-READ.
119080200423       GATA-EXIT.
119090200423            EXIT.
119100200423      *RFS45991 - End
119110200423      /
119120200423       CALCULATE-GST-PST-AMOUNT SECTION.
119130200423
119140200423           MOVE  ZERO           TO WS-GST-AMOUNT.
119150200423           MOVE  ZERO           TO WS-PST-AMOUNT.
119160200929
119170200929      *RFS185892 - Start
119180200930           PERFORM VERIFY-INDST-EXIST  THRU VIE-EXIT
119190200929           IF lncc_INDSTExistYes
119200200929              GO TO CGPA-EXIT
119210200929           END-IF
119220200929      *RFS185892 - End
119230200423           IF (NOT FEE-TRANSACTION) AND WS-REDEMPTION-FEE
119240200423           IS EQUAL 0
119250200423             GO TO CGPA-EXIT
119260200423           END-IF.
119270200423
119280200423           MOVE PLACEMENT-DATE OF TRANS
119290200423                             TO PLACEMENT-DATE
119300200423                             OF TRANS-SALES-TAX-DETAILS.
119310200423           MOVE TRANS-NO OF TRANS
119320200423                             TO TRANS-NO
119330200423                             OF TRANS-SALES-TAX-DETAILS.
119340200423
119350200423           READ TRANS-SALES-TAX-DETAILS
119360200423           INVALID KEY
119370200423             GO TO CGPA-EXIT
119380200423           END-READ.
119390200423
11940020042380658 *    MOVE COUNTRY-CODE OF INVESTOR
11941020042380658      MOVE Lc_TaxCountryCode
119420200423                             TO COUNTRY-CODE
119430200423                             OF TRANS-TYPE-SALES-TAX.
119440200423           MOVE PROVINCE-CODE OF INVESTOR
119450200423                             TO PROVINCE-CODE
119460200423                             OF TRANS-TYPE-SALES-TAX.
119470200423           MOVE TRANS-TYPE-CODE OF TRANS
119480200423                             TO TRANS-TYPE-CODE
119490200423                             OF TRANS-TYPE-SALES-TAX.
119500200423           MOVE SALES-TAX-CODE OF TRANS-SALES-TAX-DETAILS
119510200423                             TO SALES-TAX-CODE
119520200423                             OF TRANS-TYPE-SALES-TAX.
119530200423
119540200423           READ TRANS-TYPE-SALES-TAX
119550200423           INVALID KEY
119560200423             GO TO CGPA-EXIT
119570200423           END-READ.
119580200423
119590200423           COMPUTE WS-GST-AMOUNT ROUNDED = WS-GST-PST-TAX-BASIS
119600200423           * (FEDERAL-TAX-PERCENT OF TRANS-TYPE-SALES-TAX / 100).
119610200423
119620200423           IF COMPOUND-TAX OF TRANS-TYPE-SALES-TAX = "Y"
119630200423             COMPUTE WS-PST-AMOUNT ROUNDED = (WS-GST-PST-TAX-BASIS
119640200423             + WS-GST-AMOUNT) * (PROVINCIAL-TAX-PERCENT
119650200423             OF TRANS-TYPE-SALES-TAX / 100)
119660200423           ELSE
119670200423             COMPUTE WS-PST-AMOUNT ROUNDED = (WS-GST-PST-TAX-BASIS)
119680200423             * (PROVINCIAL-TAX-PERCENT OF TRANS-TYPE-SALES-TAX / 100)
119690200423           END-IF.
119700200423      * RFS20515 - Start
119710200423           MOVE FEDERAL-TAX-PERCENT OF TRANS-TYPE-SALES-TAX TO
119720200423                WS-GST-RATE.
119730200423           MOVE PROVINCIAL-TAX-PERCENT OF TRANS-TYPE-SALES-TAX TO
119740200423                WS-PST-RATE.
119750200423      * RFS20515 - End
119760200423
119770200423       CGPA-EXIT.
119780200423           EXIT.
119790200423      /
119800200929      *RFS185892 - Start
119810200929       VERIFY-INDST-EXIST SECTION.
119820200929           INITIALIZE lc_INDSTExistFlag
119830200929           INITIALIZE MFAACCATP OF ACCOUNT-ATTRIBUTES-REC
119840200929           MOVE ACCOUNT-NO OF TRANS  TO ACCOUNT-NO
119850200929                                     OF ACCOUNT-ATTRIBUTES
119860200929           MOVE "INDST"              TO ACCOUNT-ATTRIBUTE-CODE
119870200929                                     OF ACCOUNT-ATTRIBUTES
119880200929           READ ACCOUNT-ATTRIBUTES
119890200929           INVALID KEY
119900200929             CONTINUE
119910200929           NOT INVALID KEY
119920200929             SET lncc_INDSTExistYes TO TRUE
119930200929           END-READ.
119940200929
119950200929       VIE-EXIT.
119960200929           EXIT.
119970200929      *RFS185892 - End
119980200929      /
119990200423       CALCULATE-GROSS-NET SECTION.
120000200423      ******************************************************************
120010200423      *    C A L C U L A T E   G R O S S / N E T   R O U T I N E       *
120020200423      ******************************************************************
120030200423
120040200423       CGN-0000.
120050200423
120060200423      * Deduct commissions, taxes
120070200423
120080200423           MOVE NET-AMT OF TRANS
120090200423                               TO WS-NET-AMOUNT.
120100200423
120110200423           COMPUTE NET-AMT OF TRANS = GROSS-AMT OF TRANS -
120120200423                                      WS-REDEMPTION-FEE -
120130200423                                      WS-COMMISSION-AMOUNT -
120140200423                                      WS-FEDERAL-TAX-AMOUNT -
120150200423                                      WS-PROVINCIAL-TAX-AMOUNT -
120160200423R29550                                WS-US-WH-TAX-AMOUNT -
120170200423                                      WS-DAF-AMOUNT -
120180200423                                      WS-FEDERAL-CLAWBACK -
120190200423                                      WS-PROVINCIAL-CLAWBACK -
120200200423      * RFS 14380 Begin
120210200423                                      WS-ERF-CHARGE -
120220200423      * RFS 14380 End
120230200423      * RFS 139288Begin
120240200423                                      WS-INSURANCE-FEE -
120250200423      * RFS 139288End
120260200423      * RFS 19058 Begin
120270200423                                      SPONSOR-AMT OF TRANS-COMMISSION -
120280200423      * RFS 19058 End
120290200423                                      WS-GST-AMOUNT -
120300200423                                      WS-PST-AMOUNT -
120310200423                                      WS-HH-RED-AMT -
120320200423                                      WSA-RED-PENALTY -
120330200423                                      WSA-REPMT-RED-FEE.
120340200423
120350200423      ** IF CDSC IS NOT PAID BY THE UNIT HOLDER - DO NOT
120360200423      ** DEDUCT FROM GROSS
120370200423
120380200423           IF CDSC-PAID-BY-UNITHOLDER
120390200423             COMPUTE NET-AMT OF TRANS =
120400200423             NET-AMT OF TRANS - WS-CDSC-AMOUNT
120410200423           END-IF.
120420200423
120430200423R21254*RFS 21254 Begin
120440200423   ¦  *    IF NET-AMT OF TRANS IS NEGATIVE
120450200423   ¦  *      MOVE "11"       TO REJECTION-CODE OF TRANS
120460200423   ¦  *      PERFORM ROLLBACK-CDSC-LSIF-RECORDS
120470200423   ¦  *      GO TO CGN-EXIT
120480200423   ¦  *    END-IF.
120490200423   ¦
120500200423170676     INITIALIZE lc_ClawbackAdjustedFlag.
120510200423   ¦       IF NET-AMT OF TRANS IS NEGATIVE
120520200423   ¦          IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
120530200423   ¦             COMPUTE WS-TEMP-NET-AMT = NET-AMT OF TRANS
120540200423   ¦                                     + WS-FEDERAL-CLAWBACK
120550200423   ¦             IF WS-TEMP-NET-AMT >= 0
120560200423170676              SET lncc_ClawbackAdjusted TO TRUE
120570200423   ¦                COMPUTE WS-TEMP-NET-AMT = NET-AMT OF TRANS * -1
120580200423   ¦                MOVE ZEROES      TO       NET-AMT OF TRANS
120590200423   ¦                COMPUTE WS-FEDERAL-CLAWBACK = WS-FEDERAL-CLAWBACK
120600200423   ¦                                            - WS-TEMP-NET-AMT
120610200423   ¦                COMPUTE WS-TOTAL-CLAWBACK   =   WS-TOTAL-CLAWBACK
120620200423   ¦                                            - WS-TEMP-NET-AMT
120630200423   ¦             ELSE
120640200423   ¦                MOVE "11"       TO REJECTION-CODE OF TRANS
120650200423   ¦                PERFORM ROLLBACK-CDSC-LSIF-RECORDS
120660200423   ¦                GO TO CGN-EXIT
120670200423   ¦             END-IF
120680200423   ¦          ELSE
120690210405      *1110228-STARTS
120700210405                IF li_WithHierRecCount > 0
120710210405                   MOVE "80"       TO REJECTION-CODE OF TRANS
120720210405                ELSE
120730210405      *1110228-ENDS
120740200423   ¦               MOVE "11"       TO REJECTION-CODE OF TRANS
120750210405      *1110228-STARTS
120760210405                END-IF
120770210405      *1110228-ENDS
120780200423   ¦               PERFORM ROLLBACK-CDSC-LSIF-RECORDS
120790200423   ¦               GO TO CGN-EXIT
120800200423   ¦          END-IF
120810200423   v       END-IF.
120820200423R21254*RFS 21254 End
120830200423
120840200423           IF PLACED-NET
120850200423             COMPUTE WS-VARIANCE-AMOUNT =
120860200423             NET-AMT OF TRANS - WS-NET-AMOUNT
120870200423
120880200423             IF WS-VARIANCE-AMOUNT IS NOT EQUAL TO ZERO
120890200423               MOVE WS-NET-AMOUNT TO NET-AMT OF TRANS
120900200423               IF WS-FEDERAL-TAX-AMOUNT IS NOT EQUAL TO ZERO
120910200423                 ADD WS-VARIANCE-AMOUNT TO WS-FEDERAL-TAX-AMOUNT
120920200423               ELSE IF WS-PROVINCIAL-TAX-AMOUNT IS NOT EQUAL TO ZERO
120930200423                 ADD WS-VARIANCE-AMOUNT TO WS-PROVINCIAL-TAX-AMOUNT
120940200423R29550         ELSE IF WS-US-WH-TAX-AMOUNT  NOT =  0
120950200423R29550           ADD WS-VARIANCE-AMOUNT TO WS-US-WH-TAX-AMOUNT
120960200423      * RFS 14380 Begin
120970200423               ELSE IF WS-ERF-CHARGE IS NOT EQUAL TO ZERO
120980200423                 ADD WS-VARIANCE-AMOUNT TO WS-ERF-CHARGE
120990200423      * RFS 14380 End
121000200423      * RFS 139288Begin
121010200423               ELSE IF WS-INSURANCE-FEE NOT EQUAL TO ZERO
121020200423                 ADD WS-VARIANCE-AMOUNT TO WS-INSURANCE-FEE
121030200423      * RFS 139288End
121040200423      * RFS 19058 Begin
121050200423               ELSE IF SPONSOR-AMT OF TRANS-COMMISSION
121060200423                 IS NOT EQUAL TO ZERO
121070200423                 ADD WS-VARIANCE-AMOUNT
121080200423                    TO SPONSOR-AMT OF TRANS-COMMISSION
121090200423      * RFS 19058 End
121100200423               ELSE IF WS-PST-AMOUNT IS NOT EQUAL TO ZERO
121110200423                 ADD WS-VARIANCE-AMOUNT TO WS-PST-AMOUNT
121120200423               ELSE IF WS-GST-AMOUNT IS NOT EQUAL TO ZERO
121130200423                 ADD WS-VARIANCE-AMOUNT TO WS-GST-AMOUNT
121140200423               ELSE IF WS-CDSC-AMOUNT IS NOT EQUAL TO ZERO
121150200423                 ADD WS-VARIANCE-AMOUNT TO WS-CDSC-AMOUNT
121160200423               ELSE IF WS-FEDERAL-CLAWBACK IS NOT EQUAL TO ZERO
121170200423                 ADD WS-VARIANCE-AMOUNT TO WS-FEDERAL-CLAWBACK
121180200423               ELSE IF WS-PROVINCIAL-CLAWBACK IS NOT EQUAL TO ZERO
121190200423                 ADD WS-VARIANCE-AMOUNT TO WS-PROVINCIAL-CLAWBACK
121200200423               ELSE IF WS-COMMISSION-AMOUNT IS NOT EQUAL TO ZERO
121210200423                 ADD WS-VARIANCE-AMOUNT TO WS-COMMISSION-AMOUNT
121220200423               ELSE IF WS-DAF-AMOUNT IS NOT EQUAL TO ZERO
121230200423                 ADD WS-VARIANCE-AMOUNT TO WS-DAF-AMOUNT
121240200423               END-IF
121250200423             END-IF
121260200423           END-IF.
121270200423
121280200423      * If this is a contracting wire order, calculate settlement
121290200423      * amount
121300200423
121310200423           IF PURCHASE-TRANSACTION
121320200423             IF NOT SETTLED
121330200423               IF SETTLED-GROSS-OR-NET OF TRANS = "N"
121340200423                 COMPUTE SETTLEMENT-AMT OF TRANS =
121350200423                             (GROSS-AMT OF TRANS -
121360200423                               COMM-PAYABLE OF TRANS-COMMISSION)
121370200423               ELSE
121380200423                 MOVE GROSS-AMT OF TRANS
121390200423                               TO SETTLEMENT-AMT OF TRANS
121400200423               END-IF
121410200423             END-IF
121420200423           ELSE IF REDEMPTION-TRANSACTION
121430200423             IF NOT SETTLED
121440200423               IF SETTLED-GROSS-OR-NET OF TRANS = "N"
121450200423                 COMPUTE SETTLEMENT-AMT OF TRANS =
121460200423                             (NET-AMT OF TRANS -
121470200423                               COMM-PAYABLE OF TRANS-COMMISSION)
121480200423               ELSE
121490200423                 MOVE NET-AMT OF TRANS
121500200423                               TO SETTLEMENT-AMT OF TRANS
121510200423               END-IF
121520200423           ELSE
121530200423             MOVE NET-AMT OF TRANS
121540200423                               TO SETTLEMENT-AMT OF TRANS
121550200423           END-IF.
121560200423
121570200423           IF  DISTRIBUTION-TRANSACTION
121580200423               MOVE NET-AMT
121590200423                    OF TRANS-REC       TO  SETTLEMENT-AMT
121600200423                                           OF TRANS-REC.
121610200423
121620200423       CGN-EXIT.
121630200423           EXIT.
121640200423      /
121650200423       CALCULATE-UNITS-TRANSACTED SECTION.
121660200423      ******************************************************************
121670200423      *    C A L C U L A T E   U N I T S   T R A N S A C T E D   R T N *
121680200423      ******************************************************************
121690200423
121700200423       CUT-0000.
121710200423           MOVE UNIT-PRICE OF INVESTMENT-UNIT-PRICE
121720200423                               TO UNIT-PRICE OF TRANS.
121730200423
121740200423           IF ADDITION-TRANSACTION
121750200423             IF NOT PLACED-IN-UNITS
121760200423               COMPUTE UNIT-AMT OF TRANS ROUNDED =
121770200423                                 NET-AMT OF TRANS /
121780200423                                 UNIT-PRICE OF TRANS
121790200423             END-IF
121800200423           END-IF.
121810200423
121820200423      ** There will be a value in ws-out-units in the event that
121830200423      ** the gross and net on the out side are equal and the gross amount on
121840200423      ** the in side are equal
121850200423
121860200423           IF SWITCH-IN-TRANSACTION AND WS-OUT-UNITS IS NOT EQUAL 0
121870200423           AND GROSS-AMT OF TRANS IS EQUAL TO NET-AMT OF TRANS
121880200423             MOVE WS-OUT-UNITS TO UNIT-AMT OF TRANS
121890200423           END-IF.
121900200423
121910200423           IF REDUCTION-TRANSACTION
121920200423      *      IF NOT PLACED-IN-UNITS
121930200423      *RFS 16152 - START
121940200423             IF (NOT PLACED-IN-UNITS) OR
121950200423                 WS-DII-AWD = LT-Y
121960200423      *RFS 16152 - END
121970200423               COMPUTE UNIT-AMT OF TRANS ROUNDED =
121980200423                               GROSS-AMT OF TRANS /
121990200423                               UNIT-PRICE OF TRANS
122000200423      * RFS50058 - Begin: replace units with actual units from fundserv
122010200423               IF ln_logUnitAmt     > 0     AND
122020200423                 UNIT-AMT OF TRANS  > 0     AND
122030200423                 SELL-TRANSACTION
122040200423                MOVE ln_logUnitAmt      TO UNIT-AMT OF TRANS
122050200423               END-IF
122060200423      * RFS50058 - End
122070200423
122080200423               IF (UNIT-AMT OF TRANS - WS-AVAILABLE-UNITS) = .001
122090200423                  MOVE WS-AVAILABLE-UNITS
122100200423                             TO UNIT-AMT OF TRANS
122110200423               END-IF
122120200423
12213020042339466          IF (UNIT-AMT OF TRANS - WS-AVAILABLE-UNITS) = -.001  AND
122140200423144361                ( (lc_originCodeARA)     OR    (
12215020042339466             (lnc_origCodeMat OR lnc_origCodeDth)              AND
12216020042339466              SPEC-MOD-AUTH-SEGSYSMAT-ON
122170200423144361                 )   )
12218020042339466             MOVE WS-AVAILABLE-UNITS
12219020042339466                        TO UNIT-AMT OF TRANS
12220020042339466          END-IF
122210200423             END-IF
122220200423
122230200423           IF WS-FUTURE-AWD = LT-Y                                      RFS11631
122240200423      * RFS12308 - Begin
122250200423                                          OR
122260200423              WS-GIC-DII-ASSIGNED = LT-Y
122270200423      * RFS12308 - End
122280200423128793        OR GIC-INVESTMENT
122290200423             CONTINUE                                                   RFS11631
122300200423           ELSE                                                         RFS11631
122310200423      * RFS5512 - Begin
122320200423             COMPUTE WS-TEMP-BAL =
122330200423                     WS-AVAILABLE-UNITS - UNIT-AMT OF TRANS
122340200423
122350200423      *RFS92465 - Begins
122360200423             MOVE PLACEMENT-DATE OF TRANS
122370200423               TO PLACEMENT-DATE OF TRANS-REDEMPTION-DETAILS
122380200423
122390200423             MOVE TRANS-NO OF TRANS
122400200423               TO TRANS-NO OF TRANS-REDEMPTION-DETAILS
122410200423
122420200423             READ TRANS-REDEMPTION-DETAILS
122430200423             INVALID
122440200423                MOVE "N" TO lc_MoveAssFlag
122450200423             NOT INVALID
122460200423                MOVE MOVE-ASN-FLAG OF TRANS-REDEMPTION-DETAILS
122470200423                     TO lc_MoveAssFlag
122480200423             END-READ
122490200423
122500200423             IF SWITCH-OUT-TRANSACTION
122510200423      *RFS 180682 START
122520200423      *TRANS-TYPE-CODE OF TRANS is temporarily updated in
122530200423      *PROCESS-SELL SECTION.
122540200423      *So lc_OriginTransType which is saved in PROCESS-SELL SECTION
122550200423      *also needs to be validated while carrying over assignments.
122560200423             OR (lc_OriginTransType = "TRO"
122570200423                 OR lc_OriginTransType = "SWO")
122580200423      *RFS 180682 END
122590200423               IF lb_MoveAssFlagYes AND
122600200423                  (WS-TEMP-BAL - ln_PAC_UnitAss <= 0 )
122610200828      *rfs1103110 only set lb_AssCarOvr_Yes when there is an assignment
122620200828                  AND WS-ASSIGNED-UNITS > 0
122630200828      *rfs1103110 end
122640200423                   SET lb_AssCarOvr_Yes To TRUE
122650200423                   ADD WS-ASSIGNED-UNITS TO WS-TEMP-BAL
122660200423                                            WS-AVAILABLE-UNITS3
122670200423                   MOVE WS-AVAILABLE-UNITS3 TO WS-AVAILABLE-UNITS
122680200423                   IF WS-AVAILABLE-UNITS IS LESS THAN 0
122690200423                      MOVE 0 TO WS-AVAILABLE-UNITS
122700200423                   END-IF
122710200423               END-IF
122720200423      * RFS136379 - Begin
122730200423135532*      END-IF
122740200423136379       END-IF
122750200423      * RFS136379 - End
122760200423      *RFS92465 - End
122770200423
122780200423             IF WS-PASS-SWITCH-EDIT = "1"               AND
122790200423                SW-CHECK-REMAINING-BAL                  AND
122800200423                WS-TEMP-BAL NOT = ZEROES                AND
122810200423                (WS-TEMP-BAL >= WS-REMAINING-BAL-THRESHOLD-MIN AND
122820200423                 WS-TEMP-BAL <= WS-REMAINING-BAL-THRESHOLD)
122830200423               SET SW-CHANGE-SPLIT-OPTION    TO TRUE
122840200423             ELSE
122850200423      * RFS5512 - End
122860200423               IF (WS-AVAILABLE-UNITS
122870200423                 - UNIT-AMT OF TRANS) IS NEGATIVE
122880200423                 MOVE "11"       TO REJECTION-CODE OF TRANS
122890200423                 GO TO CUT-EXIT
122900200423               END-IF
122910200423      * RFS5512 - Begin
122920200423             END-IF
122930200423      * RFS5512 - End
122940200423      * RFS136379 - Begin
122950200423135532*      END-IF
122960200423      * RFS136379 - END
122970200423           END-IF                                                       RFS11631
122980200423
122990200423      *GIC MOD
123000200423             IF GIC-INVESTMENT
123010200423               IF (CURRENT-CERTIFICATE-BALANCE OF
123020200423               GIC-CERTIFICATE-DETAILS - UNIT-AMT OF TRANS)
123030200423               IS NEGATIVE
123040200423                 MOVE "G2"       TO REJECTION-CODE OF TRANS
123050200423                 GO TO CUT-EXIT
123060200423               END-IF
123070200423             END-IF
123080200423      *END GIC MOD
123090200423           END-IF.
123100200423
123110200423      ** Do not edit for zero units if this is a money market
123120200423      ** year end capital gains declaration or a notional
123130200423      ** distribution
123140200423
123150200423           IF CAPITAL-GAIN-TRANSACTION AND FIXED-OR-VARIABLE
123160200423           OF INVESTMENT-GROUP IS EQUAL TO "F"
123170200423             GO TO CUT-EXIT
123180200423           END-IF.
123190200423
123200200423           IF WS-NOTIONAL-DISTRIB IS EQUAL TO "N" OR
123210200423           CAPITAL-LOSS-TRANSACTION
123220200423             GO TO CUT-EXIT
123230200423           END-IF.
123240200423
123250200423           IF REDEMPTION-ADJUSTMENT
12326020042345781        PERFORM MINIMUM-AMT-VALIDATION
123270200423             GO TO CUT-EXIT
123280200423           END-IF.
123290200423
123300200423           IF INCOME-TRANSACTION AND WRITE-DAF = "W"
123310200423             GO TO CUT-EXIT
123320200423           END-IF.
123330200423
123340200423           IF WS-FUTURE-AWD = LT-Y                                      RFS11631
123350200423      * RFS16152 - Start
123360200423                                          OR
123370200423              WS-DII-AWD = LT-Y
123380200423      * RFS16152 - End
123390200423             CONTINUE                                                   RFS11631
123400200423           ELSE                                                         RFS11631
123410200423             IF UNIT-AMT OF TRANS IS EQUAL TO 0
123420200423             AND (NOT INTEREST-TRANSACTION)
12343020042392465        AND (NOT lb_MoveAssFlagYes)
123440210607      *RFS1113795 START - Reject based on withdrawal hierarchy setup
123450210607               IF li_WithHierRecCount > 0
123460210607                 MOVE lncc_81    TO REJECTION-CODE OF TRANS-REC
123470210607               ELSE
123480210607      *RFS1113795 END
123490200423                 MOVE "11"       TO REJECTION-CODE OF TRANS-REC
123500210607113795         END-IF
123510200423                 GO TO CUT-EXIT
123520200423             END-IF.
123530200423      *RFS117763 - Start
12354020042345781 *    IF REDEMPTION-TRANSACTION
123550200423           IF REDEMPTION-TRANSACTION OR PURCHASE-TRANSACTION
123560200423      *RFS117763 -  End
123570200423      * RFS136120 - Start: do not validate if it is already done before
123580200423             IF SWITCH-IN-TRANSACTION AND WS-PASS-SWITCH-EDIT = "2"
123590200423               CONTINUE
123600200423             ELSE
123610200423      * RFS136120 - End
123620200423  ¦          PERFORM MINIMUM-AMT-VALIDATION
123630200423117763         MOVE REJECTION-CODE OF TRANS-REC
123640200423117763                             TO lc_PurchRejectionCode
12365020042345781      END-IF.
123660200423
123670200423       CUT-EXIT.
123680200423           EXIT.
123690200423      /
123700200423       CHECK-WO-UNITS-AVAIL SECTION.
123710200423       CWUA-0000.
123720200423           IF WS-FUTURE-AWD = LT-Y                                      RFS11631
123730200423             CONTINUE                                                   RFS11631
123740200423           ELSE                                                         RFS11631
123750200423             IF (WS-AVAILABLE-UNITS
123760200423               - UNIT-AMT OF TRANS) IS NEGATIVE
123770200423               MOVE "11"       TO REJECTION-CODE OF TRANS
123780200423               GO TO CWUA-EXIT
123790200423             END-IF.
123800200423
123810200423       CWUA-EXIT.
123820200423           EXIT.
123830200423      /
123840200423      *RFS45781 Starts
123850200423      *RFS 102778 - Starts
123860200423      *New Copy Book Added for the MINIMUM-AMT-VALIDATION SECTION
123870200423        COPY CPMINMAXVL.
123880200423      *RFS 102778 - Ends
123890200423      *RFS45781 Ends
123900200423
123910200423      /
123920200423       CHANGE-TRANS-STATUS SECTION.
123930200423      ******************************************************************
123940200423      *    C H A N G E   T R A N S A C T I O N   S T A T U S   R T N . *
123950200423      ******************************************************************
123960200423
123970200423       CTS-0000.
123980200423
123990200423      * This routine is used to determine the transaction status.
124000200423      * If transaction has a status of "PND/VER" and no rejection code
124010200423      * has been placed on the trade then transaction can be posted
124020200423      * to history with a status of "HST"
124030200423      * If trade is a wire order with a status of "UNC" and no
124040200423      * rejection code has been placed on the trade then transaction
124050200423      * will be changed to "CON"
124060200423      * If trade is a wire order with a status of "SET" and no
124070200423      * rejection code has been placed on the trade then transaction
124080200423      * will be changed to "HST"
124090200423      *
124100200423      * RFS15425 - Begin
124110200423           SET SW-CHANGE-TRANS-STATUS  TO TRUE
124120200423      * RFS15425 - End
124130200423
124140200423      * RFS22072 - Begin
124150200423      * Save TRANS-STATUS-CODE to be able to resore it if transaction
124160200423      * will be rejected.
124170200423           MOVE TRANS-STATUS-CODE OF TRANS TO WS-TRANS-STATUS-CODE-SAV
124180200423      * RFS22072 - End
124190200423
124200200423           IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
124210200423             GO TO CTS-EXIT
124220200423           END-IF.
124230200423
124240200423      *****
124250200423      *****    Special Logic for transactions being updated with a
124260200423      *****    status of historic.
124270200423      *****
124280200423      * RFS9932 - Start
124290200423      * For "Future AWD" do not change TRANS-STATUS-CODE
124300200423           IF WS-FUTURE-AWD = LT-Y
124310200423               GO TO CTS-0010
124320200423           END-IF
124330200423      * RFS9932 - End
124340200423
124350200423           IF  NOT PENDING
124360200423           AND NOT SETTLED
124370200423               GO TO CTS-0010.
124380200423
124390200423           MOVE "HST"                  TO  TRANS-STATUS-CODE
124400200423                                           OF TRANS-REC.
124410200423           PERFORM SET-TRANS-DLY-SEQ.
124420200423      *RFS114676 Start.
124430200423      *RFS1020345 Start.
124440200423      *    IF PURCHASE-TRANSACTION  AND
124450200423      *       TRANS-ORIGIN-CODE  OF TRANS-REC = "WOR" AND PENDING
124460200423              PERFORM ReadRandomTransBroker
124470200423      *    END-IF.
124480200423      *RFS1020345 End.
124490200423      *RFS114676 End.
124500200423           IF  TRANS-ORIGIN-CODE
124510200423               OF TRANS-REC   IS EQUAL TO  "PAA"
124520200423           OR  TRANS-ORIGIN-CODE
124530200423               OF TRANS-REC   IS EQUAL TO  "PAC"
124540200423114676     OR  (PURCHASE-TRANSACTION  AND PROGRAM-CODE
124550200423114676         OF TRANS-BROKER  IS EQUAL TO lnc_EFTProgramCd)
124560200423      * RFS53706 - Begin - Comment out
124570200423RF6785*    OR  TRANS-ORIGIN-CODE
124580200423RF6785*        OF TRANS-REC   IS EQUAL TO  "ITX"
124590200423      * RFS53706 - End
124600200423               PERFORM DAILY-ASSIGNMENT-GENERATION.
124610200423
124620200423       CTS-0010.
124630200423           IF UNCONFIRMED
124640200423             MOVE "CON"       TO TRANS-STATUS-CODE OF TRANS
124650200423           END-IF.
124660200423
124670200423           MOVE TRANS-STATUS-CODE OF TRANS
124680200423                               TO TRANS-STATUS-CATAGORY.
124681210928      *RFS186588 - Starts
124684210916           IF lncc_TRNSEQOn
124686210928              SET lc_WriteMFATRNSEQPYes TO TRUE
124687210928      *       INITIALIZE li_Process_Date
124688210928      *       MOVE PASS-PROCESS-DATE-9 TO li_Process_Date
124689210928      *       CALL 'FXTRNPRSEQ' USING  li_Process_Date
124690210928      *                                Placement-Date OF Trans
124691210928      *                                Trans-No       OF Trans
124692210928      *                                Trans-Status-Code OF Trans
124695210916           END-IF.
124696210916      *RFS186588 - Ends
124697200423
124700200423       CTS-EXIT.
124710200423           EXIT.
124720200423      /
124730200423       SET-TRANS-DLY-SEQ  SECTION.
124740200423      ******************************************************************
124750200423      *    S E T   T R A N S A C T I O N   D A I L Y   S E Q U E N C E *
124760200423      ******************************************************************
124770200423
124780200423       STDS-0000.
124790200423           INITIALIZE MFATRDPSP OF TRANS-DAILY-PROC-SEQ.
124800200423           MOVE "W"            TO WRITE-TRANS-DLY-SEQ.
124810200423           MOVE PLACEMENT-DATE OF TRANS
124820200423                               TO PLACEMENT-DATE
124830200423                               OF TRANS-DAILY-PROC-SEQ.
124840200423           MOVE TRANS-NO       OF TRANS
124850200423                               TO TRANS-NO OF TRANS-DAILY-PROC-SEQ.
124860200423           MOVE PASS-PROCESS-DATE-9
124870200423                               TO PROCESS-DATE
124880200423                               OF TRANS-DAILY-PROC-SEQ.
124890200423
124900200423      * RFS9530 - Begin
124910200423           IF WS-NEXT-DATE-SWI-YES                    AND               RFS9530
124920200423              TRANS-TYPE-CODE OF TRANS = "SWI"
124930200423             MOVE WS-UPPER-LIMIT-DAT2   TO
124940200423                                  PROCESS-DATE OF TRANS-DAILY-PROC-SEQ
124950200423             MOVE "SWI#"             TO CONTROL-CODE OF CONTROL-FILE
124960200423             MOVE "CONTR FILE SWI"   TO WS-TEMP-STR                     RFS9530
124970200423             PERFORM READ-CONTROL-FILE                                  RFS9530
124980200423             MOVE NEXT-NUMBER OF CONTROL-FILE TO                        RFS9530
124990200423                                 PROC-SEQ-NO OF TRANS-DAILY-PROC-SEQ    RFS9530
125000200423             ADD 1                   TO NEXT-NUMBER OF CONTROL-FILE     RFS9530
125010200423             PERFORM REWRITE-CONTROL-FILE                               RFS9530
125020200423           ELSE                                                         RFS9530
125030200423      *RFS1000550 START - Update record from file. Not WS variable
125040200423      *      MOVE WS-CONTROL-COUNT
125050200423      *                       TO PROC-SEQ-NO OF TRANS-DAILY-PROC-SEQ
125060200423      *      ADD 1            TO WS-CONTROL-COUNT
125070200423             MOVE "PSQ#"           TO CONTROL-CODE OF CONTROL-FILE
125080200423             MOVE "CONTR FILE PSQ" TO WS-TEMP-STR
125090200423             PERFORM READ-CONTROL-FILE
125100200423             MOVE NEXT-NUMBER OF CONTROL-FILE TO
125110200423                  PROC-SEQ-NO OF TRANS-DAILY-PROC-SEQ
125120200423             ADD 1                 TO NEXT-NUMBER OF CONTROL-FILE
125130200423             PERFORM REWRITE-CONTROL-FILE
125140200423      *RFS1000550 END
125150200423           END-IF.                                                      RFS9530
125160200423      * RFS9530 - End
125170200423
125180200423       STDS-EXIT.
125190200423           EXIT.
125200200423      /
125210200423       DAILY-ASSIGNMENT-GENERATION SECTION.
125220200423
125230200423      ******************************************************************
125240200423      *    D A I L Y   A S S I G N M E N T   G E N E R A T I O N       *
125250200423      ******************************************************************
125260200423      *****
125270200423      *****    This routine will generate the assignment records from
125280200423      *****    processed P.A.C. transactions.  This was a Powerhouse QTP
125290200423      *****    program which wass executed after this program.  But, due
125300200423      *****    to the timing, it had to be included here.  The original
125310200423      *****    Powerhouse QTP program as DLYASNGN.
125320200423      *****
125330200423
125340200423       DAG-0000.
125350200423
125360200423      *****
125370200423      *****    Initially, read the last Account Assignment record, for
125380200423      *****    the account being processed, to retrieve the next
125390200423      *****    available Assignment Sequence Number.  If no records are
125400200423      *****    found, default to 1.
125410200423      *****
125420200423
125430200423           MOVE 1                      TO  WS-ASSIGN-SEQ-NO.
125440200423
125450200423           INITIALIZE MFAACCASP
125460200423                      OF ACCOUNT-ASSIGN-PAC-REC.
125470200423           MOVE ACCOUNT-NO
125480200423                OF TRANS-REC           TO  ACCOUNT-NO
125490200423                                           OF ACCOUNT-ASSIGN-PAC-REC.
125500200423           MOVE 999                    TO  ASSIGN-SEQ-NO
125510200423                                           OF ACCOUNT-ASSIGN-PAC-REC.
125520200423           START ACCOUNT-ASSIGNMENT-PAC
125530200423               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
125540200423               INVALID KEY
125550200423                   GO TO DAG-0010.
125560200423
125570200423           READ ACCOUNT-ASSIGNMENT-PAC PRIOR
125580200423                                       AT  END
125590200423               GO TO DAG-0030.
125600200423
125610200423           GO TO DAG-0020.
125620200423
125630200423       DAG-0010.
125640200423           READ ACCOUNT-ASSIGNMENT-PAC LAST
125650200423                                       AT  END
125660200423               GO TO DAG-0030.
125670200423
125680200423       DAG-0020.
125690200423           IF  ACCOUNT-NO
125700200423               OF ACCOUNT-ASSIGN-PAC-REC
125710200423                          IS NOT EQUAL TO  ACCOUNT-NO
125720200423                                           OF TRANS-REC
125730200423               GO TO DAG-0030.
125740200423
125750200423           IF  ASSIGN-SEQ-NO
125760200423               OF ACCOUNT-ASSIGN-PAC-REC
125770200423                          IS GREATER THAN  998
125780200423               MOVE "ACCT ASSGN: DAG"  TO  WS-FILE-STATUS-FILE-NAME
12579020042358714          PERFORM LOG-FILE-STATUS-RD
125800200423               GO TO DAG-EXIT.
125810200423
125820200423           ADD ASSIGN-SEQ-NO
125830200423               OF ACCOUNT-ASSIGN-PAC-REC
125840200423                                       TO  WS-ASSIGN-SEQ-NO.
125850200423
125860200423       DAG-0030.
125870200423
125880200423      *****
125890200423      *****    Read the Transaction Pay To Bank record to retrieve the
125900200423      *****    Bank Sequence Number.
125910200423      *****
125920200423
125930200423           INITIALIZE MFATRNBP
125940200423                      OF TRANS-PAY-TO-BANK-REC.
125950200423           MOVE PLACEMENT-DATE
125960200423                OF TRANS-REC           TO  PLACEMENT-DATE
125970200423                                           OF TRANS-PAY-TO-BANK-REC.
125980200423           MOVE TRANS-NO
125990200423                OF TRANS-REC           TO  TRANS-NO
126000200423                                           OF TRANS-PAY-TO-BANK-REC.
126010200423           READ TRANS-PAY-TO-BANK
126020200423               INVALID KEY
126030200423                   MOVE "TRN PAYBNK: DAG" TO WS-FILE-STATUS-FILE-NAME
12604020042358714              PERFORM LOG-FILE-STATUS-RD
126050200423                   GO TO DAG-EXIT.
126060200423      *****
126070200423      *****    Read the Bank Account record to retrieve the Bank Number.
126080200423      *****
126090200423
126100200423           INITIALIZE MFABNKACP
126110200423                      OF BANK-ACCOUNT-REC.
126120200423           MOVE BANK-SEQ-NO
126130200423                OF TRANS-PAY-TO-BANK-REC
126140200423                                       TO  BANK-SEQ-NO
126150200423                                           OF BANK-ACCOUNT-REC.
126160200423           READ BANK-ACCOUNT
126170200423               INVALID KEY
126180200423                   MOVE "BANK ACCNT: DAG" TO WS-FILE-STATUS-FILE-NAME
12619020042358714              PERFORM LOG-FILE-STATUS-RD
126200200423                   GO TO DAG-EXIT.
126210200423      *****
126220200423      *****    Read the Bank record to retrieve the Schedule Code.
126230200423      *****
126240200423
126250200423           INITIALIZE MFABNKP
126260200423                      OF BANK-REC.
126270200423           MOVE BANK-NO
126280200423                OF BANK-ACCOUNT-REC    TO  BANK-NO
126290200423                                           OF BANK-REC.
126300200423           READ BANK
126310200423               INVALID KEY
126320200423                   MOVE "BANK:       DAG" TO WS-FILE-STATUS-FILE-NAME
12633020042358714              PERFORM LOG-FILE-STATUS-RD
126340200423                   GO TO DAG-EXIT.
126350200423      *****
126360200423      *****    Read the Bank Schedule record to retrieve the PAC Hold
126370200423      *****    Back Number of Days.  If the record is not found, default
126380200423      *****    the days to zeroes.  If the PAC Hold Back Number of Days
126390200423      *****    is zero, the PAC Assignment Generation is not required.
126400200423      *****
126410200423
126420200423           INITIALIZE MFABNKSCP
126430200423                      OF BANK-SCHEDULE-REC.
126440200423           MOVE SCHEDULE-CODE
126450200423                OF BANK-REC            TO  SCHEDULE-CODE
126460200423                                           OF BANK-SCHEDULE-REC.
126470200423           READ BANK-SCHEDULE
126480200423               INVALID KEY
126490200423                   MOVE 10             TO  PAC-HOLD-BACK-DAYS
126500200423                                           OF BANK-SCHEDULE-REC.
126510200423
126520200423           IF  PAC-HOLD-BACK-DAYS
126530200423               OF BANK-SCHEDULE-REC
126540200423                              IS EQUAL TO  ZEROES
126550200423               GO TO DAG-EXIT.
126560200423      *****
126570200423      *****    Using the transaction process date and the bank schedule
126580200423      *****    PAC hold back days, determine the business day the hold
126590200423      *****    back assignment will end.
126600200423      *****
126610200423
126620200423           INITIALIZE DR-G2J-PARMS.
126630200423           MOVE PLACEMENT-DATE
126640200423                OF TRANS-REC           TO  DGP-GREGORIAN.
126650200423           CALL    "DRG2J"          USING  DR-G2J-PARMS.
126660200423           CANCEL  "DRG2J".
126670200423
126680200423           INITIALIZE DR-J2G-PARMS.
126690200423           ADD PAC-HOLD-BACK-DAYS
126700200423               OF BANK-SCHEDULE-REC    TO  DGP-JULIAN
126710200423                                   GIVING  DJP-JULIAN.
126720200423           CALL    "DRJ2G"          USING  DR-J2G-PARMS.
126730200423           CANCEL  "DRJ2G".
126740200423
126750200423           INITIALIZE MFABUSDAP
126760200423                      OF BUSINESS-DAYS-REC.
126770200423           MOVE DJP-GREGORIAN          TO  BUSINESS-DAY
126780200423                                           OF BUSINESS-DAYS-REC.
126790200423           START BUSINESS-DAYS
126800200423               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
126810200423               INVALID KEY
126820200423                   MOVE "BUS DAY:    DAG" TO WS-FILE-STATUS-FILE-NAME
12683020042358714              PERFORM LOG-FILE-STATUS-RD
126840200423                   GO TO DAG-EXIT.
126850200423
126860200423       DAG-0040.
126870200423           READ BUSINESS-DAYS NEXT     AT  END
126880200423               MOVE "BUS DAY 2:  DAG"  TO  WS-FILE-STATUS-FILE-NAME
12689020042358714          PERFORM LOG-FILE-STATUS-RD
126900200423               GO TO DAG-EXIT.
126910200423
126920200423           IF  ALLOW-TRADING
126930200423               OF BUSINESS-DAYS-REC
126940200423                          IS NOT EQUAL TO  "Y"
126950200423               GO TO DAG-0040.
126960200423      *****
126970200423      *****    This modification is placed here so that assignments
126980200423      *****    will not be created for end dates equal today or less
126990200423      *****    RFS: 5588 - Ralph
127000200423
127010200423           IF BUSINESS-DAY
127020200423           OF BUSINESS-DAYS-REC IS NOT GREATER THAN
127030200423           PASS-PROCESS-DATE-9
127040200423             GO TO DAG-EXIT
127050200423           END-IF.
127060200423      *****
127070200423      *****    Format the Account Assignment record to be added.
127080200423      *****
127090200423
127100200423           MOVE "Y"                    TO  WS-MFAACCASP-WSW.
127110200423
127120200423           INITIALIZE MFAACCASP
127130200423                      OF WS-ACCOUNT-ASSIGN-PAC-REC.
127140200423           MOVE ACCOUNT-NO
127150200423                OF TRANS-REC           TO  ACCOUNT-NO
127160200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127170200423           MOVE WS-ASSIGN-SEQ-NO       TO  ASSIGN-SEQ-NO
127180200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127190200423           MOVE "B"                    TO  ASSIGNMENT-TYPE
127200200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127210200423           MOVE "A"                    TO  ASSIGNMENT-STATUS
127220200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127230200423           MOVE PASS-PROCESS-DATE-9    TO  CREATION-DATE
127240200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127250200423           MOVE "N"                    TO  ENTIRE-ACCOUNT
127260200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127270200423           MOVE UNIT-AMT
127280200423                OF TRANS-REC           TO  UNITS
127290200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127300200423           MOVE "SYS-GEN   "           TO  CREATED-BY
127310200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127320200423           MOVE INVESTMENT-CODE
127330200423                OF TRANS-REC           TO  INVESTMENT-CODE
127340200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127350200423           MOVE PLACEMENT-DATE
127360200423                OF TRANS-REC           TO  START-DATE
127370200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127380200423           MOVE BUSINESS-DAY
127390200423                OF BUSINESS-DAYS-REC   TO  END-DATE
127400200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127410200423           MOVE "HDO"                  TO  BRANCH-CODE
127420200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127430200423           MOVE "N"                    TO  DOCUMENTS-RECVD
127440200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127450200423           MOVE MANAGEMENT-CO-CATAGORY TO  INSTITUTION-CODE
127460200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127470200423           MOVE "N"                    TO  LETTER-SENT
127480200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127490200423           MOVE PASS-PROCESS-DATE-9    TO  DATE-ISSUED
127500200423                                           OF WS-ACCOUNT-ASSIGN-PAC-REC.
127510200423      *****
127520200423      *****    Format the Transaction Assignment record to be added.
127530200423      *****
127540200423
127550200423           MOVE "Y"                    TO  WS-MFATRNASP-WSW.
127560200423
127570200423           INITIALIZE MFATRNASP
127580200423                      OF WS-TRANS-ASSIGN-PAC-REC.
127590200423           MOVE ACCOUNT-NO
127600200423                OF TRANS-REC           TO  ACCOUNT-NO
127610200423                                           OF WS-TRANS-ASSIGN-PAC-REC.
127620200423           MOVE ASSIGN-SEQ-NO
127630200423                OF WS-ACCOUNT-ASSIGN-PAC-REC
127640200423                                       TO  ASSIGN-SEQ-NO
127650200423                                           OF WS-TRANS-ASSIGN-PAC-REC.
127660200423           MOVE PLACEMENT-DATE
127670200423                OF TRANS-REC           TO  PLACEMENT-DATE
127680200423                                           OF WS-TRANS-ASSIGN-PAC-REC.
127690200423           MOVE TRANS-NO
127700200423                OF TRANS-REC           TO  TRANS-NO
127710200423                                           OF WS-TRANS-ASSIGN-PAC-REC.
127720200423           MOVE UNIT-AMT
127730200423                OF TRANS-REC           TO  UNITS-PURCHASED
127740200423                                           OF WS-TRANS-ASSIGN-PAC-REC.
127750200423
127760200423       DAG-EXIT.
127770200423           EXIT.
127780200423      /
127790200423       POST-INVESTMENT-UNITS SECTION.
127800200423      ******************************************************************
127810200423      *    P O S T   I N V E S T M E N T   U N I T S   R O U T I N E   *
127820200423      ******************************************************************
127830200423
127840200423       PIU-0000.
127850200423           IF NOT HISTORY AND NOT CONTRACTED AND NOT SETTLED
127860200423             GO TO PIU-EXIT
127870200423           END-IF.
127880200423
127890200423           IF CONTRACTED AND PURCHASE-TRANSACTION
127900200423             MOVE " "          TO WRITE-ACCOUNT-INVESTMENT
127910200423             MOVE " "          TO WRITE-ACCOUNT-CONTRACT-INV
127920200423             MOVE " "          TO WRITE-ACCOUNT-CONT-ANNT
127930200423             GO TO PIU-EXIT
127940200423           END-IF.
127950200423
127960200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "R"
127970200423             GO TO PIU-0020
127980200423           END-IF.
127990200423
128000200423           MOVE ZEROES TO      CURR-UNIT-BAL
128010200423                               OF ACCOUNT-INVESTMENT
128020200423                               CERT-UNITS
128030200423                               OF ACCOUNT-INVESTMENT
128040200423                               NON-CERT-UNITS
128050200423                               OF ACCOUNT-INVESTMENT
128060200423                               OUTSTANDING-REDEMPTION-BALANCE
128070200423                               OF ACCOUNT-INVESTMENT
128080200423                               AVERAGE-UNIT-COST
128090200423                               OF ACCOUNT-INVESTMENT
128100200423                               DATE-OF-AVERAGE-UNIT-COST
128110200423                               OF ACCOUNT-INVESTMENT
128120200423                               AVERAGE-UNIT-COST-BASIS
128130200423                               OF ACCOUNT-INVESTMENT
128140200423                               LIFE-TO-DATE-PURCH
128150200423                               OF ACCOUNT-INVESTMENT
128160200423                               LIFE-TO-DATE-REDEM
128170200423                               OF ACCOUNT-INVESTMENT
128180200423                               YEAR-TO-DATE-PURCHASES
128190200423                               OF ACCOUNT-INVESTMENT
128200200423                               YEAR-TO-DATE-REDEM
128210200423                               OF ACCOUNT-INVESTMENT
128220200423                               LAST-FINANCIAL-ACTIVITY
128230200423                               OF ACCOUNT-INVESTMENT
128240200423                               CREATION-DATE
128250200423                               OF ACCOUNT-INVESTMENT.
128260200423
128270200423           MOVE "Y"            TO CORRECT-AVE-UNIT-COST
128280200423                               OF ACCOUNT-INVESTMENT.
128290200423
128300200423           MOVE ACCOUNT-NO OF TRANS
128310200423                               TO ACCOUNT-NO OF ACCOUNT-INVESTMENT.
128320200423
128330200423           MOVE INVESTMENT-CODE OF TRANS
128340200423                               TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT.
128350200423
128360200423      *RFS 23020 Begin
128370200423      **   MOVE "R"            TO CAPITAL-GAIN-DISTR-OPTION
128380200423      **                          OF ACCOUNT-INVESTMENT
128390200423      **                          INCOME-DISTR-OPTION
128400200423      **                          OF ACCOUNT-INVESTMENT.
128410200423      **   MOVE "N"            TO PAYMENT-TYPE-CODE
128420200423      **                          OF ACCOUNT-INVESTMENT.
128430200423           MOVE WS-CAPITAL-GAIN-DISTR-OPTION
128440200423                               TO CAPITAL-GAIN-DISTR-OPTION
128450200423                                  OF ACCOUNT-INVESTMENT.
128460200423           MOVE WS-INCOME-DISTR-OPTION
128470200423                               TO INCOME-DISTR-OPTION
128480200423                                  OF ACCOUNT-INVESTMENT.
128490200423           MOVE WS-PAYMENT-TYPE-CODE
128500200423                               TO PAYMENT-TYPE-CODE
128510200423                                  OF ACCOUNT-INVESTMENT.
128520200423      *RFS 23020 End
128530200423
1285402004237911       IF GIC-DII-INVESTMENT
1285502004237911       MOVE "N"            TO CAPITAL-GAIN-DISTR-OPTION
1285602004237911                              OF ACCOUNT-INVESTMENT
1285702004237911                              INCOME-DISTR-OPTION
1285802004237911                              OF ACCOUNT-INVESTMENT
1285902004237911       END-IF.
128600200423
128610200423       PIU-0020.
128620200423
128630200423      *---------------------------------------------------------
128640200423      * Post history trades to account investment - purchase
128650200423      *
128660200423      *---------------------------------------------------------
128670200423           IF PURCHASE-TRANSACTION AND HISTORY
128680200423      * RFS92504 - Start.
128690200423           IF  TRANS-ORIGIN-CODE OF TRANS = lncc_MRG
128700200423           AND lc_MoveCRT = lncc_Y
128710200423
128720200423             MOVE lncc_Y          TO lc_CertRecStatus
128730200423             MOVE lncc_N          TO lc_CertEOF
128740200423             MOVE ZEROES          TO ln_TotCertSWI
128750200423             MOVE ACCOUNT-NO OF WS-TRANS-REC-2
128760200423                                  TO ACCOUNT-NO OF CERTIFICATE-REC
128770200423             MOVE INVESTMENT-CODE OF WS-TRANS-REC-2
128780200423                                  TO INVESTMENT-CODE OF CERTIFICATE-REC
128790200423
128800200423             START Certificate
128810200423                KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
128820200423                INVALID KEY
128830200423                MOVE lncc_N       TO lc_CertRecStatus
128840200423             END-START
128850200423
128860200423             PERFORM Move-Acc-Inv-Certificates THRU Move-Acc-Inv-Exit
128870200423                                  UNTIL lb_CertNotFound OR lb_CertEOF
128880200423             COMPUTE CERT-UNITS OF ACCOUNT-INVESTMENT =
128890200423                     CERT-UNITS OF ACCOUNT-INVESTMENT + ln_TotCertSWI
128900200423
128910200423             COMPUTE NON-CERT-UNITS OF ACCOUNT-INVESTMENT =
128920200423                 NON-CERT-UNITS OF ACCOUNT-INVESTMENT - ln_TotCertSWI
128930200423           END-IF
128940200423      * RFS92504 - End.
128950200423             ADD GROSS-AMT OF TRANS
128960200423                       TO YEAR-TO-DATE-PURCHASES OF ACCOUNT-INVESTMENT
128970200423                          LIFE-TO-DATE-PURCH     OF ACCOUNT-INVESTMENT
128980200423             ADD UNIT-AMT OF TRANS
128990200423                       TO CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
129000200423                          NON-CERT-UNITS OF ACCOUNT-INVESTMENT
129010200423      *GIC MOD
129020200423             IF GIC-INVESTMENT
129030200423             AND WS-GIC-CRT-FOUND = "Y"
129040200423140269* Do not update certificate balance since it is already updated
129050200423140269* by calling JOBGICMAT in 'UPD' mode to create new renewal cert.
129060200423140269       AND NOT (PASS-CDSC-CALCULATOR = "U" AND lb_SkipGICSeqYes
129070200423140269                AND TRANS-TYPE-CODE OF TRANS = "TRI"
129080200423140269                AND TRANS-ORIGIN-CODE OF TRANS = "GIM")
129090200423               ADD UNIT-AMT OF TRANS
129100200423                       TO CURRENT-CERTIFICATE-BALANCE
129110200423                       OF GIC-CERTIFICATE-DETAILS
129120200423               MOVE "R"     TO WRITE-GIC-CERT-DETAILS
129130200423             END-IF
129140200423      *END GIC MOD
129150200423           END-IF.
129160200423
129170200423      *---------------------------------------------------------
129180200423      * Post history trades to account investment - distribution
129190200423      *
129200200423      *---------------------------------------------------------
129210200423           IF DISTRIBUTION-TRANSACTION AND HISTORY AND
129220200423           NOT (CASH-DISTRIB)
12923020042337754      AND NOT (SPEC-MOD-AUTH-SEGSYSMAT-ON AND
12924020042337754               CAPITAL-GAIN-TRANSACTION   AND
12925020042337754               lnc_OrigCodeMat)
129260200423             ADD UNIT-AMT OF TRANS
129270200423                       TO CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
129280200423                          NON-CERT-UNITS OF ACCOUNT-INVESTMENT
129290200423             ADD GROSS-AMT OF TRANS
129300200423                       TO YEAR-TO-DATE-PURCHASES OF ACCOUNT-INVESTMENT
129310200423                          LIFE-TO-DATE-PURCH     OF ACCOUNT-INVESTMENT
129320200423
129330200423      *GIC MOD
129340200423             IF GIC-INVESTMENT
129350200423              IF PASS-CDSC-CALCULATOR NOT = "J"                         RFS10636
129360200423               ADD UNIT-AMT OF TRANS
129370200423                       TO CURRENT-CERTIFICATE-BALANCE
129380200423                       OF GIC-CERTIFICATE-DETAILS
129390200423              END-IF                                                    RFS10636
129400200423               MOVE "R"     TO WRITE-GIC-CERT-DETAILS
129410200423             END-IF
129420200423      *END GIC MOD
129430200423
129440200423           END-IF.
129450200423
129460200423           IF DISTRIBUTION-TRANSACTION AND HISTORY AND
129470200423           CASH-DISTRIB
129480200423             MOVE ZEROES       TO UNIT-AMT OF TRANS
129490200423           END-IF.
129500200423
129510200423      *---------------------------------------------------------
129520200423      * Post history trades to account investment - redemption
129530200423      *
129540200423      *---------------------------------------------------------
129550200423           IF REDEMPTION-TRANSACTION AND HISTORY
129560200423             ADD GROSS-AMT OF TRANS
129570200423                            TO YEAR-TO-DATE-REDEM OF ACCOUNT-INVESTMENT
129580200423                            LIFE-TO-DATE-REDEM OF ACCOUNT-INVESTMENT
129590200423      * RFS92504 - Start.
129600200423             IF  TRANS-ORIGIN-CODE OF TRANS = lncc_MRG
129610200423             AND WS-CERT-UNITS > 0
129620200423
129630200423                 COMPUTE NON-CERT-UNITS OF ACCOUNT-INVESTMENT =
129640200423                   NON-CERT-UNITS OF ACCOUNT-INVESTMENT + WS-CERT-UNITS
129650200423
129660200423                 COMPUTE CERT-UNITS OF ACCOUNT-INVESTMENT =
129670200423                     CERT-UNITS OF ACCOUNT-INVESTMENT - WS-CERT-UNITS
129680200423
129690200423                 MOVE lncc_Y TO lc_MoveCRT
129700200423
129710200423             END-IF
129720200423      * RFS92504 - End.
129730200423             SUBTRACT UNIT-AMT OF TRANS
129740200423                            FROM CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
129750200423                            NON-CERT-UNITS OF ACCOUNT-INVESTMENT
129760200423      *GIC MOD
129770200423
129780200423             IF GIC-INVESTMENT
129790200423               SUBTRACT UNIT-AMT OF TRANS
129800200423                            FROM CURRENT-CERTIFICATE-BALANCE
129810200423                       OF GIC-CERTIFICATE-DETAILS
129820200423
129830200423               IF CURRENT-CERTIFICATE-BALANCE
129840200423               OF GIC-CERTIFICATE-DETAILS = 0
129850200423                 MOVE WS-CERT-STATUS-CODE-CLOSE
129860200423                            TO CERT-STATUS-CODE
129870200423                            OF GIC-CERTIFICATE-DETAILS
129880200423      * RFS10618 - Begin
129890200423                 MOVE PASS-PROCESS-DATE-9           TO
129900200423                   CERTIFICATE-STATUS-DATE OF GIC-CERTIFICATE-DETAILS
129910200423      * RFS10618 - End
129920200423      *RFS7390 BEGIN
129930200423                 IF NOT TRANSFER-OUT-TRANSACTION
1299402004237858               MOVE WS-CLOSING-REASON
1299502004237858                        TO CLOSING-REASON-CODE
1299602004237858                        OF GIC-CERTIFICATE-DETAILS
129970200423                 ELSE
1299802004237858               MOVE WS-CLOSING-REASON-TRO
1299902004237858                        TO CLOSING-REASON-CODE
1300002004237858                        OF GIC-CERTIFICATE-DETAILS
130010200423                 END-IF
130020200423      *RFS7390 END
130030200423               END-IF
130040200423
130050200423               MOVE "R"     TO WRITE-GIC-CERT-DETAILS
130060200423
130070200423             END-IF
130080200423
130090200423      *END GIC MOD
130100200423
130110200423      * If this is a settled wire order - subtract from otr
130120200423             IF TRANS-STATUS-CODE OF WS-TRANS-REC = "SET"
130130200423               SUBTRACT UNIT-AMT OF TRANS
130140200423                            FROM OUTSTANDING-REDEMPTION-BALANCE
130150200423                            OF ACCOUNT-INVESTMENT
130160200423      *RFS160618-START
130170200423             IF OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT < 0
130180200423               MOVE 0 TO OUTSTANDING-REDEMPTION-BALANCE
130190200423                            OF ACCOUNT-INVESTMENT
130200200423             END-IF
130210200423      *RFS160618-END
130220200423
130230200423             END-IF
130240200423           END-IF.
130250200423
130260200423      *---------------------------------------------------------
130270200423      * Post contracted orders - redemption
130280200423      *
130290200423      *---------------------------------------------------------
130300200423           IF REDEMPTION-TRANSACTION AND CONTRACTED
130310200423             ADD UNIT-AMT OF TRANS
130320200423                               TO OUTSTANDING-REDEMPTION-BALANCE
130330200423                               OF ACCOUNT-INVESTMENT
130340200423           END-IF.
130350200423
130360200423           IF CONTRACTED
130370200423             GO TO PIU-0050
130380200423           END-IF.
130390200423
130400200423           MOVE CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
130410200423                               TO CLOSING-UNIT-BAL OF TRANS.
130420200423
1304302004239982       IF GIC-DII-INVESTMENT
1304402004239982          IF CURR-UNIT-BAL OF ACCOUNT-INVESTMENT NOT EQUAL TO 0
1304502004239982             MOVE 1.00         TO AVERAGE-UNIT-COST
1304602004239982                               OF ACCOUNT-INVESTMENT
1304702004239982          ELSE
1304802004239982             MOVE 0            TO AVERAGE-UNIT-COST
1304902004239982                               OF ACCOUNT-INVESTMENT
1305002004239982          END-IF
1305102004239982       END-IF.
130520200423
130530200423       PIU-0050.
130540200423      * RFS9530 - Begin
130550200423           IF WS-NEXT-DATE-SWI-YES              AND
130560200423              TRANS-TYPE-CODE OF TRANS = "SWI"
130570200423             MOVE WS-UPPER-LIMIT-DAT2       TO
130580200423                     LAST-FINANCIAL-ACTIVITY OF ACCOUNT-INVESTMENT
130590200423             IF CREATION-DATE OF ACCOUNT-INVESTMENT IS EQUAL 0
130600200423               MOVE WS-UPPER-LIMIT-DAT2     TO
130610200423                     CREATION-DATE OF ACCOUNT-INVESTMENT
130620200423             END-IF
130630200423           ELSE
130640200423      * RFS9530 - End
130650200423             MOVE PASS-PROCESS-DATE-9
130660200423                               TO LAST-FINANCIAL-ACTIVITY
130670200423                               OF ACCOUNT-INVESTMENT
130680200423             IF CREATION-DATE OF ACCOUNT-INVESTMENT IS EQUAL 0
130690200423               MOVE PASS-PROCESS-DATE-9
130700200423                               TO CREATION-DATE OF ACCOUNT-INVESTMENT
130710200423             END-IF.
130720200423
130730200423       PIU-EXIT.
130740200423           EXIT.
130750200423      /
130760200423      * RFS92504 - Start.
130770200423       Move-Acc-Inv-Certificates SECTION.
130780200423      *----------------------------------------------------------------
130790200423      * Move the certificates details.
130800200423      *----------------------------------------------------------------
130810200423
130820200423               READ Certificate NEXT
130830200423                 AT END
130840200423                   MOVE lncc_Y      TO lc_CertEOF
130850200423               END-READ
130860200423               IF  ACCOUNT-NO OF WS-TRANS-REC-2 NOT =
130870200423                                         ACCOUNT-NO OF CERTIFICATE-REC
130880200423                OR INVESTMENT-CODE OF WS-TRANS-REC-2 NOT =
130890200423                                   INVESTMENT-CODE OF CERTIFICATE-REC
130900200423                   MOVE lncc_N      TO lc_CertRecStatus
130910200423               END-IF
130920200423               IF  lc_CertRecStatus = lncc_Y
130930200423                AND lc_CertEOF      = lncc_N
130940200423                 IF (Cert-Status-Code OF Certificate-Rec =
130950200423                   lncc_I OR lncc_S)
130960200423                  AND Cert-Units OF Certificate-Rec > 0
130970200423                  PERFORM Create-MRGI-Certificate THRU Create-MRGI-Exit
130980200423                  PERFORM Cancel-MRGO-Certificate THRU Cancel-MRGO-Exit
130990200423                 END-IF
131000200423               END-IF.
131010200423
131020200423       Move-Acc-Inv-Exit.
131030200423           EXIT.
131040200423      /
131050200423       Create-MRGI-Certificate.
131060200423           INITIALIZE Certificate-Primary-Rec.
131070200423           MOVE SPACES                         TO lc_NewCertNo.
131080200423           MOVE ZEROES                         TO ln_NewCertNo
131090200423                                                  ln_NewCertNo1
131100200423                                                  ln_Length.
131110200423           MOVE Account-No OF Trans-Rec        TO
131120200423                                 Account-no OF Certificate-Primary-Rec.
131130200423           MOVE Investment-Code OF Trans-Rec   TO
131140200423                            Investment-Code OF Certificate-Primary-Rec
131150200423                            Investment-Code OF Investment-Upd.
131160200423
131170200423           READ Investment-Upd NO LOCK
131180200423             INVALID KEY
131190200423             GO TO Create-MRGI-Exit
131200200423           END-READ.
131210200423
131220200423           MOVE Cert-No-Next OF Investment-Upd-Rec
131230200423                                               TO
131240200423                                    lc_NewCertNo
131250200423                                    Cert-No OF Certificate-Primary-Rec.
131260200423           INSPECT lc_NewCertNo TALLYING ln_Length
131270200423                  FOR CHARACTERS BEFORE INITIAL SPACE.
131280200423           MOVE ln_NewCertNo(1:ln_Length)      TO ln_NewCertNo1
131290200423           COMPUTE ln_NewCertNo1 = ln_NewCertNo1 + 1.
131300200423           MOVE ln_NewCertNo1                  TO ln_NewCertNo
131310200423           INSPECT lc_NewCertNo REPLACING LEADING ZERO BY SPACE
131320200423           MOVE FUNCTION TRIM(lc_NewCertNo)    TO lc_NewCertNo
131330200423           MOVE lc_NewCertNo                   TO
131340200423                                    Cert-No-Next OF Investment-Upd-Rec
131350200423
131360200423           REWRITE Investment-Upd-Rec
131370200423             INVALID KEY
131380200423              CONTINUE
131390200423           END-REWRITE.
131400200423
131410200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
131420200423              MOVE "MFAINVP " TO WS-FILE-STATUS-FILE-NAME
131430200423              SET lncc_Err303  TO  TRUE
131440200423              PERFORM LOG-FILE-STATUS
131450200423           END-IF.
131460200423
131470200423           Initialize ln_CertUnitsSWI.
131480200423           COMPUTE ln_CertUnitsSWI = (Unit-Price OF WS-Trans-Rec-2 *
131490200423                   Cert-Units OF Certificate-Rec)/
131500200423                   Unit-Price OF Trans-Rec.
131510200423           MOVE ln_CertUnitsSWI                TO
131520200423                                 Cert-Units OF Certificate-Primary-Rec.
131530200423           MOVE Cert-No OF Certificate-Rec     TO
131540200423                               Orig-Cert-No OF Certificate-Primary-Rec.
131550200423           MOVE Investment-Code OF Certificate-Rec
131560200423                                               TO
131570200423                   Orig-Investment OF Certificate-Primary-Rec.
131580200423           MOVE Process-Date OF Trans-Rec      TO
131590200423                        Status-Changed-Date OF Certificate-Primary-Rec.
131600200423           MOVE Issue-Date OF Certificate-Rec  TO
131610200423                                 Issue-Date OF Certificate-Primary-Rec.
131620200423           MOVE Cert-Status-Code OF Certificate-Rec
131630200423                                               TO
131640200423                           Cert-Status-Code OF Certificate-Primary-Rec.
131650200423           MOVE Alternate-Delivery OF Certificate-Rec
131660200423                                               TO
131670200423                         Alternate-Delivery OF Certificate-Primary-Rec.
131680200423           MOVE Addr-No OF Certificate-Rec     TO
131690200423                                    Addr-No OF Certificate-Primary-Rec.
131700200423           MOVE Issued-To-Name OF Certificate-Rec
131710200423                                               TO
131720200423                             Issued-To-Name OF Certificate-Primary-Rec.
131730200423           MOVE Cert-Reason-Descr OF Certificate-Rec
131740200423                                               TO
131750200423                          Cert-Reason-Descr OF Certificate-Primary-Rec.
131760200423           MOVE Cert-Printed OF Certificate-Rec
131770200423                                               TO
131780200423                               Cert-Printed OF Certificate-Primary-Rec.
131790200423           MOVE Cert-Activity-Reported OF Certificate-Rec
131800200423                                               TO
131810200423                     Cert-Activity-Reported OF Certificate-Primary-Rec.
131820200423
131830200423           WRITE Certificate-Primary-Rec
131840200423             INVALID KEY
131850200423              CONTINUE
131860200423           END-WRITE.
131870200423
131880200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
131890200423              MOVE "MFACRTP" TO WS-FILE-STATUS-FILE-NAME
131900200423              SET lncc_Err304  TO  TRUE
131910200423              PERFORM LOG-FILE-STATUS
131920200423           END-IF.
131930200423
131940200423           COMPUTE ln_TotCertSWI = ln_TotCertSWI + ln_CertUnitsSWI.
131950200423       Create-MRGI-Exit.
131960200423           EXIT.
131970200423      /
131980200423       Cancel-MRGO-Certificate.
131990200423
132000200423           MOVE LT-C                           TO
132010200423                          Cert-Status-Code OF Certificate-Rec.
132020200423           MOVE Process-Date OF Trans-Rec      TO
132030200423                        Status-Changed-Date OF Certificate-Rec.
132040200423           REWRITE Certificate-Rec
132050200423             INVALID KEY
132060200423              CONTINUE
132070200423           END-REWRITE.
132080200423
132090200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
132100200423              MOVE "MFACRTLA" TO WS-FILE-STATUS-FILE-NAME
132110200423              SET lncc_Err305  TO  TRUE
132120200423              PERFORM LOG-FILE-STATUS
132130200423           END-IF.
132140200423       Cancel-MRGO-Exit.
132150200423           EXIT.
132160200423      /
132170200423      * RFS92504 - End.
132180200423       CALCULATE-AVAILABLE-BALANCE SECTION.
132190200423
132200200423      ******************************************************************
132210200423      *    C A L C U L A T E   A V A I L A B L E   B A L A N C E       *
132220200423      ******************************************************************
132230200423
132240200423       CAB-0000.
132250200423
132260200423128793     IF  NOT GIC-INVESTMENT
132270200423           MOVE ZEROES TO WS-ASSIGNED-UNITS
132280200423128793     END-IF
132290200423128793     MOVE ZEROES TO WS-AVAILABLE-UNITS
13230020042392465                     WS-AVAILABLE-UNITS3
132310200423                          WS-AVAILABLE-UNITS2.
132320200423      * RFS44611 - Begin
132330200423           INITIALIZE ln_AvailUnitsNotContr
132340200423      * RFS44611 - End
132350200423      * RFS16693 - Begin
132360200423           MOVE CERT-UNITS OF ACCOUNT-INVESTMENT TO WS-CERT-UNITS
132370200423      * RFS16693 - End
132380200423
132390200423      *RFS 8751 BEGIN
132400200423           SET PACIDX          TO 1.
132410200423           SET PACIDX          DOWN BY 1.
132420200423           SET PACMAX          TO PACIDX.
132430200423      *RFS 8751 END
132440200423
132450200423           IF PASS-CDSC-CALCULATOR = "C"
132460200423      * RFS13839 - Begin
132470200423              AND PASS-ASSIGNMENT-CERTIFICATE-Y
132480200423      * RFS13839 - End
132490200423      * RFS16693 - Begin
132500200423             MOVE ZEROES  TO WS-CERT-UNITS
132510200423      * RFS16693 - End
132520200423             GO TO CAB-0100
132530200423           END-IF.
132540200423
132550200423      *RFS 7277 BEGIN
132560200423           IF REDEMPTION-ADJUSTMENT
132570200423           AND TRANS-ORIGIN-CODE OF TRANS = "CNS"
132580200423             GO TO CAB-0100
132590200423           END-IF.
132600200423      *RFS 7277 END
132610200423
132620200423      *RFS ???? BEGIN
132630200423           IF TRANSFER-OUT-TRANSACTION
132640200423           AND TRANS-ORIGIN-CODE OF TRANS = "GIM"
132650200423             GO TO CAB-0100
132660200423           END-IF.
132670200423      *RFS ???? END
132680200423
132690200423           IF LOCKED-IN OF ACCOUNT IS EQUAL TO "Y"
132700200423      * RFS20143 Begin
132710200423      * RFS43334 Begin
132720200423      *****   IF SPEC-MOD-AUTH-MFEAMS
132730200423      *****   AND TRANS-TYPE-CODE OF TRANS = "FEE"
132740200423
132750200423      * RFS 52265 - begins.
132760200423              MOVE lncc_N TO lc_Bypass
132770200423              MOVE lncc_1 TO lc_Exemption_Rule
132780200423              PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
132790200423      * RFS 52265 - ends.
132800200423
132810200423              IF ((SPEC-MOD-AUTH-MFEAMS AND
132820200423                TRANS-TYPE-CODE OF TRANS = "FEE") OR
132830200423      * RFS45131 Begin
132840200423                (lnc_OrigCodeDth AND SPEC-MOD-AUTH-SEGSYSMAT-ON) OR
132850200423      * RFS45131 End
13286020042352265           (lnc_OrigCodeMat AND SPEC-MOD-AUTH-SEGSYSMAT-ON) OR
132870200423      * RFS43334 End
13288020042352265           (lc_Bypass = lncc_Y))
132890200423                 CONTINUE
132900200423              ELSE
132910200423      * RFS20143 End
132920200423             MOVE CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
132930200423                               TO WS-ASSIGNED-UNITS
132940200423             GO TO CAB-0100
132950200423      * RFS20143 Begin
132960200423              END-IF
132970200423      * RFS20143 End
132980200423           END-IF.
132990200423128793     IF GIC-INVESTMENT  AND WS-ASSIGNED-UNITS  > 0
133000200423 |            GO TO CAB-0100
133010200423128793     END-IF.
133020200423
133030200423           MOVE ACCOUNT-NO OF ACCOUNT-INVESTMENT
133040200423                               TO ACCOUNT-NO OF ACCOUNT-ASSIGNMENT.
133050200423           MOVE LOW-VALUES     TO INVESTMENT-CODE OF ACCOUNT-ASSIGNMENT.
133060200423
133070200423           START ACCOUNT-ASSIGNMENT
133080200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
133090200423             INVALID KEY
133100200423             GO TO CAB-0100.
133110200423
133120200423       CAB-0010.
133130200423
133140200423           READ ACCOUNT-ASSIGNMENT NEXT RECORD
133150200423             AT END
133160200423128793       IF DII-INVESTMENT
133170200423  |             IF WS-ASSIGNED-UNITSNCDIC > WS-ASSIGNED-UNITSCDIC
133180200423  |                MOVE WS-ASSIGNED-UNITSNCDIC TO
133190200423  |                     WS-ASSIGNED-UNITS
133200200423  |                COMPUTE WS-ASSIGNED-UNITSDIIC =
133210200423  |                WS-ASSIGNED-UNITSNCDIC + WS-ASSIGNED-UNITSCDIC
133220200423  |             ELSE
133230200423  |                MOVE WS-ASSIGNED-UNITSCDIC TO
133240200423  |                     WS-ASSIGNED-UNITS
133250200423  |                COMPUTE WS-ASSIGNED-UNITSDIIC =
133260200423  |                WS-ASSIGNED-UNITSNCDIC + WS-ASSIGNED-UNITSCDIC
133270200423  |             END-IF
133280200423128793       END-IF
133290200423             GO TO CAB-0100.
133300200423
133310200423           IF ACCOUNT-NO OF ACCOUNT-ASSIGNMENT IS NOT EQUAL
133320200423             ACCOUNT-NO OF ACCOUNT-INVESTMENT
133330200423128793       IF DII-INVESTMENT
133340200423  |             IF WS-ASSIGNED-UNITSNCDIC > WS-ASSIGNED-UNITSCDIC
133350200423  |                MOVE WS-ASSIGNED-UNITSNCDIC TO
133360200423  |                     WS-ASSIGNED-UNITS
133370200423  |                COMPUTE WS-ASSIGNED-UNITSDIIC =
133380200423  |                WS-ASSIGNED-UNITSNCDIC + WS-ASSIGNED-UNITSCDIC
133390200423  |             ELSE
133400200423  |                MOVE WS-ASSIGNED-UNITSCDIC TO
133410200423  |                     WS-ASSIGNED-UNITS
133420200423  |                COMPUTE WS-ASSIGNED-UNITSDIIC =
133430200423  |                WS-ASSIGNED-UNITSNCDIC + WS-ASSIGNED-UNITSCDIC
133440200423  |             END-IF
133450200423128793       END-IF
133460200423             GO TO CAB-0100
133470200423           END-IF.
133480200423
133490200423           MOVE ASSIGNMENT-TYPE OF ACCOUNT-ASSIGNMENT
133500200423                               TO ASSIGNMENT-TYPE-CODE.
133510200423
13352020042392465      MOVE ASSIGN-AMT OF ACCOUNT-ASSIGNMENT
13353020042392465                      TO ln_Assigned_Amt.
133540200423
133550200423      *RFS 19771 BEGIN
133560200423           IF SWITCH-OUT-TRANSACTION
133570200423           AND TRANS-ORIGIN-CODE OF TRANS = "ARA"
133580200423           AND ENTIRE-ACCOUNT OF ACCOUNT-ASSIGNMENT IS EQUAL "Y"
133590200423             GO TO CAB-0100
133600200423           END-IF.
133610200423      *RFS 19771 END
133620200423
133630200423      * RFS 52265 - begins.
133640200423           IF ENTIRE-ACCOUNT OF ACCOUNT-ASSIGNMENT IS EQUAL "Y"  AND
133650200423              ASSIGNMENT-STATUS OF ACCOUNT-ASSIGNMENT IS EQUAL "A"
133660200423              AND NOT SWITCH-OUT-TRANSACTION
133670200423
133680200423                 MOVE lncc_N TO lc_Bypass
133690200423                 MOVE lncc_5 TO lc_Exemption_Rule
133700200423                 PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
133710200423
133720200423                 IF lc_Bypass = lncc_Y
133730200423                        GO TO CAB-0100
133740200423                 END-IF
133750200423           END-IF.
133760200423
133770200423      * RFS 52265 - defect 1 - begins.
133780200423           IF SWITCH-OUT-TRANSACTION
133790200423              IF ENTIRE-ACCOUNT OF ACCOUNT-ASSIGNMENT IS EQUAL "Y"  AND
133800200423                 ASSIGNMENT-STATUS OF ACCOUNT-ASSIGNMENT IS EQUAL "A"
133810200918                 AND ACCOUNT-NO OF TRANS IS EQUAL TO
133820200423                     ACCOUNT-NO OF WS-TRANS-REC-1
133830200423      * RFS 52265 - defect 1 - ends.
133840200423
133850200423                 MOVE lncc_N TO lc_Bypass
133860200423                 MOVE lncc_15 TO lc_Exemption_Rule
133870200423                 PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
133880200423
133890200423                 IF lc_Bypass = lncc_Y
133900200423103437*             GO TO CAB-0100
133910200423103437              GO TO CAB-0010
133920200423                 END-IF
133930200423              END-IF
133940200423           END-IF.
133950200423      * RFS 52265 - ends.
133960200423
133970200423           IF ENTIRE-ACCOUNT OF ACCOUNT-ASSIGNMENT IS EQUAL "Y"
133980200423               IF ASSIGNMENT-STATUS OF ACCOUNT-ASSIGNMENT IS EQUAL "A"
133990200918185176         AND ENTERED-BY OF TRANS NOT = "SEGCOGRST"
134000200423      * RFS17019 Begin
134010200423                   IF SPEC-MOD-AUTH-MFEAMS
134020200423                   AND TRANS-TYPE-CODE OF TRANS = "FEE"
134030200423                       CONTINUE
134040200423                   ELSE
134050200423      * RFS17019 End
134060200423      * RFS12308 - Begin
134070200423                       MOVE LT-Y       TO WS-ACCOUNT-ASSIGNED
134080200423      * RFS12308 - End
134090200423                       MOVE CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
134100200423                       TO WS-ASSIGNED-UNITS
134110200423                       GO TO CAB-0100
134120200423      * RFS17019 Begin
134130200423                   END-IF
134140200423      * RFS17019 End
134150200423               ELSE
134160200423                   GO TO CAB-0010
134170200423               END-IF
134180200423           END-IF.
134190200423
134200200423           IF INVESTMENT-CODE OF ACCOUNT-ASSIGNMENT IS NOT EQUAL
134210200423             TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT
134220200423             GO TO CAB-0010
134230200423           END-IF.
134240200423
134250200423           IF ASSIGNMENT-STATUS OF ACCOUNT-ASSIGNMENT IS NOT EQUAL "A"
134260200423             GO TO CAB-0010
134270200423           END-IF.
134280200423
134290200423      *RFS176274 START
134300200423           IF SWITCH-OUT-TRANSACTION AND
134310200423             TRANS-ORIGIN-CODE OF TRANS = 'MAT' AND
134320200423             INVESTMENT-CODE OF ACCOUNT-ASSIGNMENT =
134330200423             INVESTMENT-CODE OF TRANS
134340200423              MOVE lncc_N TO lc_Bypass
134350200423              MOVE lncc_6 TO lc_Exemption_Rule
134360200423              PERFORM SEARCH-TRANS-TYPE-EXEMPTIONS
134370200423              IF lc_Bypass = lncc_Y
134380200423                 GO TO CAB-0010
134390200423              END-IF
134400200423           END-IF.
134410200423      *RFS176274 END
134420200423
134430200423      * RFS 52265 - begins.
134440200423           IF NOT SWITCH-OUT-TRANSACTION
134450200423              MOVE lncc_N TO lc_Bypass
134460200423              MOVE lncc_6 TO lc_Exemption_Rule
134470200423              PERFORM  SEARCH-TRANS-TYPE-EXEMPTIONS
134480200423
134490200423              IF lc_Bypass = lncc_Y
134500200423                 GO TO CAB-0100
134510200423              END-IF
134520200423           END-IF.
134530200423      * RFS 52265 - ends.
134540200423
134550200423           IF SWITCH-OUT-TRANSACTION
134560200423             IF PAC-ASSIGNMENT
134570200423               SET PACIDX UP BY 1
134580200423      * RFS49699 - Array logging logic
134590200423               IF PACIDX           > WS-ARRAY11-MAX-USED
134600200423                   MOVE PACIDX                 TO WS-ARRAY11-MAX-USED
134610200423               END-IF
134620200423
134630200423      * RFS49699 - End
134640200423               MOVE ACCOUNT-ASSIGNMENT-REC
134650200423                                 TO WS-ACCOUNT-ASSIGNMENT(PACIDX)
13466020042392465          COMPUTE ln_PAC_UnitAss = ln_PAC_UnitAss
13467020042392465                  + UNITS OF ACCOUNT-ASSIGNMENT
13468020042392465                  + (ln_Assigned_Amt / Unit-Price of TRANS)
134690200423               GO TO CAB-0010
134700200423             END-IF
134710200423           END-IF.
134720200423
134730200423      * RFS92465 -Begin
134740200423           IF ln_Assigned_Amt > 0
134750200423               COMPUTE ln_AssignedUnit_Conv ROUNDED =
134760200423                (ln_Assigned_Amt / Unit-Price of TRANS)
134770200423
134780200423128793     IF NOT DII-INVESTMENT
134790200423               COMPUTE WS-ASSIGNED-UNITS = WS-ASSIGNED-UNITS +
134800200423                        ln_AssignedUnit_Conv
134810200423128793     END-IF
134820200423      * RFS128793 - START
134830200423           IF DII-INVESTMENT
134840200423            IF ASSIGNMENT-TYPE OF ACCOUNT-ASSIGNMENT = "W"
134850200423            COMPUTE WS-ASSIGNED-UNITSCDIC = WS-ASSIGNED-UNITSCDIC +
134860200423                                      ln_AssignedUnit_Conv
134870200423            ELSE
134880200423            COMPUTE WS-ASSIGNED-UNITSNCDIC = WS-ASSIGNED-UNITSNCDIC +
134890200423                                      ln_AssignedUnit_Conv
134900200423            END-IF
134910200423           END-IF
134920200423      * RFS128793 - END
134930200423           END-IF.
134940200423      * RFS92465 -End
134950200423      * RFS135532 - START
134960200423      * RFS138756 Start - Uncommet lines commented out in retrofits
134970200423
134980200423      * RFS135532 - START
134990200423142003* Do not count assignment unit again if it is already counted based on
135000200423142003* assignment amount.  Only count assignment unit when assignment amount
135010200423142003* is not involve. Otherwise it will double count assigned units.
135020200423142003     IF ln_Assigned_Amt = 0
135030200423128793     IF NOT DII-INVESTMENT
135040200423           COMPUTE WS-ASSIGNED-UNITS = WS-ASSIGNED-UNITS +
135050200423                                       UNITS OF ACCOUNT-ASSIGNMENT
135060200423142003*128793     END-IF.
135070200423142003     END-IF
135080200423      * RFS128793 - START
135090200423           IF DII-INVESTMENT
135100200423            IF ASSIGNMENT-TYPE OF ACCOUNT-ASSIGNMENT = "W"
135110200423            COMPUTE WS-ASSIGNED-UNITSCDIC = WS-ASSIGNED-UNITSCDIC +
135120200423                                      UNITS OF ACCOUNT-ASSIGNMENT
135130200423            ELSE
135140200423            COMPUTE WS-ASSIGNED-UNITSNCDIC = WS-ASSIGNED-UNITSNCDIC +
135150200423                                      UNITS OF ACCOUNT-ASSIGNMENT
135160200423            END-IF
135170200423142003     END-IF
135180200423           END-IF.
135190200423      * RFS128793 - END
135200200423      * RFS138756 - END
135210200423      * RFS135532 - END
135220200423           GO TO CAB-0010.
135230200423
135240200423       CAB-0100.
135250200423      * RFS44611 - Begin: Calculate Contracted units
135260200423           COMPUTE ln_AvailUnitsNotContr =
135270200423                   CURR-UNIT-BAL                  OF ACCOUNT-INVESTMENT
135280200423                 - OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT
135290200423      * RFS44611 - End
135300200423
135310200423             IF NOT UNCONFIRMED
135320200423      * RFS92504 - Start.
135330200423                IF  TRANS-ORIGIN-CODE OF TRANS = lncc_MRG
135340200423                 AND TRANS-TYPE-CODE OF TRANS = lncc_SWO
135350200423                 COMPUTE WS-AVAILABLE-UNITS =
135360200423                 CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
135370200423                 - WS-ASSIGNED-UNITS
135380200423                 - OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT
135390200423                ELSE
135400200423      * RFS92504 - End.
135410200423                  COMPUTE WS-AVAILABLE-UNITS =
135420200423                  CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
135430200423                  - WS-ASSIGNED-UNITS
135440200423                 - OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT
135450200423      * RFS16693 - Begin
135460200423      *        - CERT-UNITS OF ACCOUNT-INVESTMENT
135470200423                 - WS-CERT-UNITS
135480200423      * RFS16693 - End
13549020042392504           END-IF
135500200423
13551020042392465          MOVE WS-AVAILABLE-UNITS TO WS-AVAILABLE-UNITS3
135520200423
135530200423               IF SETTLED
135540200423                 ADD UNIT-AMT OF TRANS
135550200423                             TO WS-AVAILABLE-UNITS
135560200423      * RFS44611 - Begin
135570200423                                ln_AvailUnitsNotContr
135580200423      * RFS44611 - End
135590200423               END-IF
135600200423
135610200423               IF WS-AVAILABLE-UNITS IS LESS THAN 0
135620200423                 MOVE 0 TO WS-AVAILABLE-UNITS
135630200423               END-IF
135640200423
135650200423             END-IF.
135660200423
135670200423      *RFS 12084 - REMOVE LINES WHICH SUBTRACT WS-ASSIGNED-UNIT &
135680200423      *            CERT-UNITS OF ACCOUNT-INVESTMENT DONE IN RFS 10635
135690200423      *          - NEXT LINES EQUAL LOGIC BEFORE 10635
135700200423
135710200423             IF UNCONFIRMED
135720200423               COMPUTE WS-AVAILABLE-UNITS =
135730200423               CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
135740200423      *                                                                ---------
135750200423               - OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT
135760200423
135770200423      *RFS 12084 - END
135780200423
135790200423               COMPUTE WS-AVAILABLE-UNITS2 =
135800200423               CURR-UNIT-BAL OF ACCOUNT-INVESTMENT
135810200423               - WS-ASSIGNED-UNITS
135820200423               - OUTSTANDING-REDEMPTION-BALANCE OF ACCOUNT-INVESTMENT
135830200423      * RFS16693 - Begin
135840200423      *        - CERT-UNITS OF ACCOUNT-INVESTMENT
135850200423               - WS-CERT-UNITS
135860200423      * RFS16693 - End
135870200423
135880200423               IF WS-AVAILABLE-UNITS2 IS LESS THAN 0
135890200423                 MOVE 0 TO WS-AVAILABLE-UNITS2
135900200423               END-IF
135910200423
135920200423               IF WS-AVAILABLE-UNITS IS LESS THAN 0
135930200423                 MOVE 0 TO WS-AVAILABLE-UNITS
135940200423               END-IF
135950200423
135960200423             END-IF.
135970200423      * RFS44611 - Begin: Make sure units not less than 0.0
135980200423             IF ln_AvailUnitsNotContr < 0
135990200423               MOVE 0 to ln_AvailUnitsNotContr
136000200423             END-IF.
136010200423      * RFS44611 - End
136020200423       CAB-EXIT.
136030200423           EXIT.
136040200423      /
136050200423       SET-OUT-PAC-ASSIGNMENT SECTION.
136060200423
136070200423      ******************************************************************
136080200423      *    S E T   O U T   P A C   A S S I G N M E N T   R O U T I N E *
136090200423      ******************************************************************
136100200423
136110200423       SOPA-0000.
136120200423103437** When MoveAssFlag is ON let the Fx take care of Pac Assign
136130200423  |        IF lb_MoveAssFlagYes
136140200423  |           SET PACIDX TO 0
136150200423103437     END-IF
136160200423           IF PACIDX IS EQUAL 0
136170200423             GO TO SOPA-EXIT
136180200423           END-IF.
136190200423
136200200423           SET PACMAX TO PACIDX.
136210200423
136220200423           SET PACIDX TO 1.
136230200423           SET PACIDX DOWN BY 1.
136240200423
136250200423       SOPA-0010.
136260200423           SET PACIDX UP BY 1.
136270200423
136280200423           IF PACIDX IS GREATER THAN PACMAX
136290200423             GO TO SOPA-0020
136300200423           END-IF.
136310200423
136320200423           MOVE "R"            TO WRITE-ACCOUNT-ASSIGNMENT.
136330200423           SUBTRACT UNITS OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
136340200423                               FROM WS-AVAILABLE-UNITS.
136350200423
136360200423           GO TO SOPA-0010.
136370200423
136380200423       SOPA-0020.
136390200423           IF WS-AVAILABLE-UNITS IS NOT LESS THAN UNIT-AMT OF TRANS
136400200423             SET PACIDX        TO 1
136410200423             SET PACIDX        DOWN BY 1
136420200423             SET PACMAX        TO PACIDX
136430200423             SET PACIDX2       TO PACIDX
136440200423             GO TO SOPA-EXIT
136450200423           END-IF.
136460200423
136470200423           SET PACIDX TO 1.
136480200423           SET PACIDX DOWN BY 1.
136490200423
136500200423           SUBTRACT WS-AVAILABLE-UNITS FROM UNIT-AMT OF TRANS
136510200423           GIVING WS-AVAILABLE-UNITS.
136520200423
136530200423       SOPA-0030.
136540200423           SET PACIDX  UP BY 1.
136550200423           SET PACIDX2 TO PACIDX.
136560200423
136570200423      * RFS49699 - Array logging logic
136580200423           IF PACIDX2  > WS-ARRAY12-MAX-USED
136590200423               MOVE PACIDX2                TO WS-ARRAY12-MAX-USED
136600200423           END-IF.
136610200423      * RFS49699 - End
136620200423           IF PACIDX IS GREATER THAN PACMAX
136630200423             GO TO SOPA-EXIT
136640200423           END-IF.
136650200423           MOVE UNIT-AMT
136660200423                OF TRANS-REC           TO  WS-FRM-ASGN-AMOUNT (PACIDX2).
136670200423           MOVE ASSIGNMENT-STATUS
136680200423                OF WS-ACCOUNT-ASSIGNMENT (PACIDX)
136690200423                                       TO  WS-FRM-ASGN-STATUS (PACIDX2).
136700200423           MOVE UNITS
136710200423                OF WS-ACCOUNT-ASSIGNMENT (PACIDX)
136720200423                                       TO  WS-FRM-ASGN-UNITS (PACIDX2).
136730200423
136740200423           SUBTRACT WS-AVAILABLE-UNITS FROM UNITS
136750200423                               OF WS-ACCOUNT-ASSIGNMENT(PACIDX).
136760200423           IF  UNITS
136770200423               OF WS-ACCOUNT-ASSIGNMENT (PACIDX)
136780200423                      IS NOT GREATER THAN  ZEROES
136790200423               SUBTRACT UNITS
136800200423                        OF WS-ACCOUNT-ASSIGNMENT (PACIDX)
136810200423                                     FROM  ZEROES
136820200423                                   GIVING  WS-AVAILABLE-UNITS
136830200423               MOVE "C"                TO  ASSIGNMENT-STATUS
136840200423                                           OF WS-ACCOUNT-ASSIGNMENT
136850200423                                              (PACIDX)
136860200423             ELSE
136870200423               MOVE WS-AVAILABLE-UNITS TO  WS-FRM-ASGN-UNITS (PACIDX2)
136880200423               MOVE ZEROES             TO  WS-AVAILABLE-UNITS
136890200423               SET PACMAX              TO  PACIDX2
136900200423               GO TO SOPA-EXIT.
136910200423
136920200423           GO TO SOPA-0030.
136930200423
136940200423       SOPA-EXIT.
136950200423           EXIT.
136960200423      /
136970200423       SET-IN-PAC-ASSIGNMENT SECTION.
136980200423
136990200423      ******************************************************************
137000200423      *    S E T   I N   P A C   A S S I G N M E N T   R O U T I N E   *
137010200423      ******************************************************************
137020200423
137030200423       SIPA-0000.
137040200423           MOVE 0              TO WS-ASSIGN-START-NO.
137050200423
137060200423           IF PACMAX IS EQUAL 0
137070200423             GO TO SIPA-EXIT
137080200423           END-IF.
137090200423
137100200423           SET PACIDX TO 1.
137110200423           SET PACIDX DOWN BY 1.
137120200423
137130200423           MOVE ACCOUNT-NO OF TRANS
137140200423                               TO ACCOUNT-NO OF ACCOUNT-ASSIGNMENT.
137150200423           MOVE 0              TO ASSIGN-SEQ-NO OF ACCOUNT-ASSIGNMENT.
137160200423           START ACCOUNT-ASSIGNMENT-D
137170200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
137180200423             INVALID KEY
137190200423             GO TO SIPA-0030.
137200200423
137210200423           READ ACCOUNT-ASSIGNMENT-D NEXT RECORD
137220200423             AT END
137230200423             GO TO SIPA-0030.
137240200423
137250200423           IF ACCOUNT-NO OF ACCOUNT-ASSIGNMENT IS NOT EQUAL
137260200423           TO ACCOUNT-NO OF TRANS
137270200423             GO TO SIPA-0030
137280200423           END-IF.
137290200423
137300200423       SIPA-0030.
137310200423           SET PACIDX UP BY 1.
137320200423           SET PACIDX2 TO PACIDX.
137330200423           IF PACIDX IS GREATER THAN PACMAX
137340200423             GO TO SIPA-EXIT
137350200423           END-IF.
137360200423
137370200423           MOVE "W"            TO WRITE-ACCOUNT-ASSIGNMENT.
137380200423           ADD 1 TO WS-ASSIGN-START-NO.
137390200423
137400200423           MOVE WS-FRM-ASGN-STATUS (PACIDX2)
137410200423                                       TO  ASSIGNMENT-STATUS
137420200423                                           OF WS-ACCOUNT-ASSIGNMENT
137430200423                                              (PACIDX).
137440200423           COMPUTE UNITS
137450200423                   OF WS-ACCOUNT-ASSIGNMENT (PACIDX) ROUNDED
137460200423                                        =  (UNIT-AMT
137470200423                                            OF TRANS-REC
137480200423                                        *   WS-FRM-ASGN-UNITS (PACIDX2))
137490200423                                        /  WS-FRM-ASGN-AMOUNT (PACIDX2).
137500200423           MOVE ACCOUNT-NO OF TRANS
137510200423                               TO ACCOUNT-NO
137520200423                               OF WS-ACCOUNT-ASSIGNMENT(PACIDX).
137530200423           MOVE INVESTMENT-CODE OF TRANS
137540200423                               TO INVESTMENT-CODE
137550200423                               OF WS-ACCOUNT-ASSIGNMENT(PACIDX).
137560200423           MOVE WS-ASSIGN-START-NO
137570200423                               TO ASSIGN-SEQ-NO
137580200423                               OF WS-ACCOUNT-ASSIGNMENT(PACIDX).
137590200423           GO TO SIPA-0030.
137600200423
137610200423       SIPA-EXIT.
137620200423           EXIT.
137630200423      /
137640200423       POST-BATCH-AMOUNTS SECTION.
137650200423
137660200423      ******************************************************************
137670200423      *    P O S T   B A T C H   A M O U N T S   R O U T I N E         *
137680200423      ******************************************************************
137690200423
137700200423       PBA-0000.
137710200423
137720200423      *
137730200423      * Only orders that belong to a batch will be posted
137740200423      *
137750200423
137760200423           IF PASS-CDSC-CALCULATOR = "C"
137770200423           OR  WS-PASS-SWITCH-EDIT IS EQUAL "1"
137780200423             GO TO PBA-EXIT
137790200423           END-IF
137800200423
137810200423           IF BATCH-DATE OF TRANS = 0
137820200423             GO TO PBA-EXIT
137830200423           END-IF.
137840200423
137850200423           IF REJECTION-CODE OF TRANS IS NOT EQUAL "00"
137860200423             GO TO PBA-EXIT
137870200423           END-IF.
137880200423      * RFS48390 - Begin: continue the process for SYSAOT trades
137890200423      *    IF SWITCH-IN-TRANSACTION
137900200423      *      GO TO PBA-EXIT
137910200423      *    END-IF.
137920200423      * RFS48390 - End
137930200423
137940200423      * RFS15425 - Begin
137950200423           IF WS-FUTURE-AWD = LT-Y                                      RFS11631
137960200423             GO TO PBA-EXIT
137970200423           END-IF.
137980200423      * RFS15425 - End
137990200423
138000200423      * RFS51753 - Begin: use read read-only file to avoid the lock
138010200423      *    READ BATCH-HEADER
138020200423      *    INVALID KEY
138030200423      *    GO TO PBA-EXIT.
138040200423           MOVE BATCH-HEADER-REC TO BATCH-HEADER-RD-REC
138050200423           READ BATCH-HEADER-RD
138060200423             INVALID KEY
138070200423               GO TO PBA-EXIT
138080200423             NOT INVALID KEY
138090200423               MOVE BATCH-HEADER-RD-REC TO BATCH-HEADER-REC
138100200423           END-READ
138110200423      * RFS51753 - End
138120200423
138130200423      * RFS48390 - Begin: continue the process for SWI/SYSAOT trades
138140200423           IF SWITCH-IN-TRANSACTION
138150200423            IF BATCH-TYPE-CODE OF BATCH-HEADER = lncc_SYSAOT        AND
138160200423            BATCH-CREATED-BY OF BATCH-HEADER = lncc_createdBySYSAOT AND
138170200423            HISTORY
138180200423             CONTINUE
138190200423            ELSE
138200200423             GO TO PBA-EXIT
138210200423            END-IF
138220200423           END-IF.
138230200423      * RFS48390 - End
138240200423      * RFS51753 - Begin: Read the batch file in update mode
138250200423           READ BATCH-HEADER
138260200423             INVALID KEY
138270200423               GO TO PBA-EXIT
138280200423           END-READ.
138290200423      * RFS51753 - End
138300200423      * RFS45141 - Begin: For SYSAOT trades do reset/recalculate Batch amounts-
138310200423      *   the reason we need this because in previous calculation
138320200423      *   (get-batch-amounts) all values were zeroes.
138330200423      *RFS114676 Start.
138340200423      *    IF BATCH-TYPE-CODE OF BATCH-HEADER = lncc_SYSAOT         AND
138350200423      *     BATCH-CREATED-BY OF BATCH-HEADER = lncc_createdBySYSAOT AND
138360200423      *     HISTORY
138370200423            IF ((BATCH-TYPE-CODE OF BATCH-HEADER = lncc_SYSAOT AND
138380200423            BATCH-CREATED-BY OF BATCH-HEADER = lncc_createdBySYSAOT) OR
138390200423            (BATCH-TYPE-CODE OF BATCH-HEADER = lncc_SYEFTB AND
138400200423            BATCH-CREATED-BY OF BATCH-HEADER = lncc_createdBySYEFTB))
138410200423            AND HISTORY
138420200423      *RFS114676 End
138430200423      * Run the routine to get batch amounts if it didn't run yet
138440200423      * (RFS45141.1)
138450200423             IF WS-BATCH-AMOUNT = 0    AND
138460200423                WS-BATCH-UNITS  = 0
138470200423      * Change to PND to make sure get-batch-amounts pick up the trade
138480200423              MOVE TRANS-STATUS-CATAGORY  TO lc_saveTransStatusCode
138490200423              MOVE lncc_PND               TO TRANS-STATUS-CATAGORY
138500200423              PERFORM get-batch-amounts
138510200423      * Restore the original value
138520200423              MOVE lc_saveTransStatusCode TO TRANS-STATUS-CATAGORY
138530200423             END-IF
138540200423             ADD WS-BATCH-AMOUNT TO TRANS-DOLLAR-AMT OF BATCH-HEADER
138550200423             ADD WS-BATCH-UNITS  TO TRANS-UNIT-AMT   OF BATCH-HEADER
138560200423           END-IF
138570200423      * RFS45141 - End
138580200423
138590200423           ADD WS-BATCH-AMOUNT
138600200423                               TO PROCESSED-DOLLAR-AMT OF BATCH-HEADER.
138610200423
138620200423           ADD WS-BATCH-UNITS
138630200423                               TO PROCESSED-UNIT-AMT OF BATCH-HEADER.
138640200423
138650200423           ADD 1               TO PROCESSED-TRANSACTIONS OF BATCH-HEADER.
138660200423
138670200423      * GIC MOD
138680200423           IF PASS-CDSC-CALCULATOR = "Q"
138690200423             PERFORM EVALUATE-BATCH-STATUS
138700200423           END-IF.
138710200423      * END GIC MOD
138720200423           MOVE "R"            TO WRITE-BATCH-HEADER.
138730200423
138740200423      ** MULTI LOCK MOD
138750200423
138760200423
138770200423           REWRITE BATCH-HEADER-REC
138780200423           INVALID KEY
13879020042358714         MOVE "MFABCHHDP" TO WS-FILE-STATUS-FILE-NAME
13880020042358714         SET lncc_Err003  TO  TRUE
13881020042358714         PERFORM LOG-FILE-STATUS
138820200423           GO TO PBA-EXIT.
138830200423
13884020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
13885020042358714         MOVE "MFABCHHDP" TO WS-FILE-STATUS-FILE-NAME
13886020042358714         SET lncc_Err004  TO  TRUE
13887020042358714         PERFORM LOG-FILE-STATUS
13888020042358714      END-IF.
138890200423
138900200423      ** MULTI LOCK MOD END
138910200423
138920200423       PBA-EXIT.
138930200423           EXIT.
138940200423      /
138950200423      * GIC MOD
138960200423       EVALUATE-BATCH-STATUS SECTION.
138970200423
138980200423      ******************************************************************
138990200423      *    E V A L U A T E   B A T C H   S T A T U S   R O U T I N E   *
139000200423      ******************************************************************
139010200423
139020200423           MOVE BATCH-TYPE-CODE OF BATCH-HEADER
139030200423                               TO BATCH-TYPE-CODE OF BATCH-TYPE-CODES.
139040200423
139050200423           READ BATCH-TYPE-CODES
139060200423             INVALID KEY
139070200423             GO TO EBS-EXIT.
139080200423
139090200423       EBS-0000.
139100200423           MOVE ALL "N"        TO T-BAL-SWITCHES.
139110200423
139120200423      * IF SHARE BALANCING NOT REQUIRED THAN OVERRIDE
139130200423
139140200423           IF BAL-SHARES OF BATCH-TYPE-CODES = "N"
139150200423           MOVE "Y" TO T-BAL-SW2
139160200423           MOVE "Y" TO T-BAL-SW5
139170200423           END-IF.
139180200423
139190200423      * IF DOLLAR BALANCING NOT REQUIRED THAN OVERRIDE
139200200423
139210200423           IF BAL-DOLLARS OF BATCH-TYPE-CODES = "N"
139220200423           MOVE "Y" TO T-BAL-SW3
139230200423           MOVE "Y" TO T-BAL-SW6
139240200423           END-IF.
139250200423
139260200423      * IF HASH-BALANCING NOT REQUIRED THAN OVERRIDE
139270200423
139280200423           IF BAL-HASH OF BATCH-TYPE-CODES = "N"
139290200423           MOVE "Y" TO T-BAL-SW4
139300200423           END-IF.
139310200423
139320200423      * DETERMINE PENDING OR PROCESSED STATUS
139330200423
139340200423           IF PROCESSED-TRANSACTIONS OF BATCH-HEADER
139350200423           IS NOT EQUAL 0
139360200423           MOVE "Y" TO T-BAL-SW1
139370200423           END-IF.
139380200423
139390200423      * DETERMINE IF UNITS ENTERED = BALANCE
139400200423
139410200423           IF T-BAL-SW2 = "N"
139420200423             IF BATCH-UNIT-AMT OF BATCH-HEADER =
139430200423                TRANS-UNIT-AMT OF BATCH-HEADER AND
139440200423              ((BATCH-DOLLAR-AMT OF BATCH-HEADER IS NOT EQUAL 0) OR
139450200423               (BATCH-UNIT-AMT OF BATCH-HEADER IS NOT EQUAL TO 0))
139460200423              MOVE "Y" TO T-BAL-SW1
139470200423             END-IF
139480200423           END-IF.
139490200423
139500200423      * DETERMINE IF DOLLAR ENTERED = BALANCE
139510200423
139520200423           IF T-BAL-SW3 = "N"
139530200423             IF BATCH-DOLLAR-AMT OF BATCH-HEADER =
139540200423                TRANS-DOLLAR-AMT OF BATCH-HEADER AND
139550200423              ((BATCH-DOLLAR-AMT OF BATCH-HEADER IS NOT EQUAL 0) OR
139560200423               (BATCH-UNIT-AMT OF BATCH-HEADER IS NOT EQUAL 0))
139570200423                MOVE "Y" TO T-BAL-SW3
139580200423             END-IF
139590200423           END-IF.
139600200423
139610200423      * DETERMINE IF CROSS TOTALS ARE MATCHED
139620200423
139630200423           IF T-BAL-SW4 = "N"
139640200423             IF MATCH-TOTAL-TRANSACTIONS OF BATCH-HEADER =
139650200423                MATCH-MATCHED-TRANSACTIONS OF BATCH-HEADER AND
139660200423             ((BATCH-DOLLAR-AMT OF BATCH-HEADER IS NOT EQUAL 0) OR
139670200423             (BATCH-UNIT-AMT OF BATCH-HEADER IS NOT EQUAL 0))
139680200423                MOVE "Y" TO T-BAL-SW3
139690200423             END-IF
139700200423           END-IF.
139710200423
139720200423      * DETERMINE IF PROCESSED UNITS = BALANCE UNITS
139730200423
139740200423           IF T-BAL-SW5 = "N"
139750200423             IF BATCH-UNIT-AMT OF BATCH-HEADER =
139760200423                PROCESSED-UNIT-AMT OF BATCH-HEADER
139770200423                MOVE "Y" TO T-BAL-SW5
139780200423             END-IF
139790200423           END-IF.
139800200423
139810200423      * DETERMINE IF PROCESSED DOLLAR = BALANCE DOLLARS
139820200423
139830200423           IF T-BAL-SW6 = "N"
139840200423             IF BATCH-DOLLAR-AMT OF BATCH-HEADER  =
139850200423                PROCESSED-DOLLAR-AMT OF BATCH-HEADER
139860200423                MOVE "Y" TO T-BAL-SW6
139870200423             END-IF
139880200423           END-IF.
139890200423
139900200423      * DETERMINE IF PROCESSED TRANS = PLACED TRANS
139910200423
139920200423           IF T-BAL-SW7 = "N"
139930200423             IF PROCESSED-TRANSACTIONS OF BATCH-HEADER =
139940200423                MATCH-TOTAL-TRANSACTIONS OF BATCH-HEADER
139950200423                MOVE "Y" TO T-BAL-SW6
139960200423             END-IF
139970200423           END-IF.
139980200423
139990200423      * SET BATCH FORCED FLAG
140000200423
140010200423           MOVE BATCH-FORCE-FLAG OF BATCH-HEADER
140020200423                               TO T-BAL-SW8.
140030200423
140040200423      * DETERMINE PROCESSED STATUS
140050200423
140060200423           IF T-BAL-SW1 = "Y"
140070200423             IF T-BAL-SWITCH-2-6 = "YYYYYY"
140080200423             MOVE "CLSD"       TO BATCH-STATUS OF BATCH-HEADER
140090200423             ELSE
140100200423             MOVE "SUSP"       TO BATCH-STATUS OF BATCH-HEADER
140110200423             END-IF
140120200423           END-IF.
140130200423
140140200423      * DETERMINE PENDING STATUS
140150200423
140160200423           IF T-BAL-SW1 = "N"
140170200423             IF T-BAL-SWITCH-2-3 = "YYY"
140180200423             MOVE "PEND"       TO BATCH-STATUS OF BATCH-HEADER
140190200423             ELSE
140200200423             MOVE "OPEN"       TO BATCH-STATUS OF BATCH-HEADER
140210200423             END-IF
140220200423           END-IF.
140230200423
140240200423      * DETERMINE IF STATUS HAS BEEN FORCED
140250200423
140260200423           IF BATCH-STATUS OF BATCH-HEADER = "OPEN" AND T-BAL-SW8 = "Y"
140270200423             MOVE "FPEN"       TO BATCH-STATUS OF BATCH-HEADER
140280200423           END-IF.
140290200423
140300200423           IF BATCH-STATUS OF BATCH-HEADER = "SUSP" AND T-BAL-SW8 = "Y"
140310200423             MOVE "FCLO"       TO BATCH-STATUS OF BATCH-HEADER
140320200423           END-IF.
140330200423
140340200423      *  UNDO FORCED FLAG IF BALANCED
140350200423
140360200423           IF ((BATCH-FORCE-FLAG OF BATCH-HEADER = "Y") AND
140370200423               (BATCH-STATUS OF BATCH-HEADER = "PEND" OR
140380200423                BATCH-STATUS OF BATCH-HEADER = "CLSD"))
140390200423                MOVE "N"       TO BATCH-FORCE-FLAG OF BATCH-HEADER
140400200423           END-IF.
140410200423       EBS-EXIT.
140420200423           EXIT.
140430200423      * END GIC MOD
140440200423      /
140450200423       RECORD-UPDATES SECTION.
140460200423
140470200423      ******************************************************************
140480200423      *    R E C O R D   U P D A T E S   R O U T I N E                 *
140490200423      ******************************************************************
140500200423
140510200423      * RFS92145 - Exit MFR loop when redemption trade is rejected.
140520200423           IF lb_MFRTransLoop  AND Redemption-Transaction AND
140530200423              REJECTION-CODE OF TRANS IS NOT EQUAL "00"
140540200423              INITIALIZE lc_MFRTransLoop
140550200423           END-IF.
140560200423      * RFS92145 End
140570200423
140580200423      * RFS13839 - Begin
140590200423      * ---------------------------------------------------------------
140600200423      *    IF PASS-CDSC-CALCULATOR = "C"
140610200423      *    OR  WS-PASS-SWITCH-EDIT IS EQUAL "1"
140620200423      *       GO TO REU-EXIT
140630200423      *    END-IF.
140640200423      * ---------------------------------------------------------------
140650200423           IF  WS-PASS-SWITCH-EDIT IS EQUAL "1"
140660200423              GO TO REU-EXIT
140670200423           END-IF
140680200423
140690200423      * RFS21772 - Begin
140700200423           IF SW-CALC-NO-UPDATES
140710200423      * RFS32409 - Start
140720200423            OR lnc_calcSoa
140730200423      * RFS32409 - End
140740200423              GO TO REU-EXIT
140750200423           END-IF
140760200423      * RFS21772 - End
140770200423
140780200423           IF PASS-CDSC-CALCULATOR = "C"
140790200423      * RFS50832 - Begin
140800200423            OR lnc_calcSoaUpd
140810200423      * RFS50832 - End
140820200423              PERFORM UPD-FOR-CALCULATOR
140830200423              GO TO REU-EXIT
140840200423           END-IF
140850200423      * RFS13839 - End
140860200423
140870200423140269     INITIALIZE li_RePurPlacement
140880200423140269                li_RePurTransNo
140890200423167010                ln_GICMATPlaceDate
140900200423167010                ln_GICMATTransno
140910200423      *RFS 8470 - BEGIN
140920200423      * ---------------------------------------------------------------
140930200423      * RFS11813 - Begin
140940200423      *    MOVE "N"          TO WS-PROCESS-GIC-INT-FIRST.
140950200423      *
140960200423      *    IF GIC-INVESTMENT AND PASS-CDSC-CALCULATOR = "Q"
140970200423      *    AND REJECTION-CODE OF TRANS IS EQUAL TO "00 "
140980200423      *      PERFORM EVAL-CHQ-LOGIC
140990200423      *      IF WS-PROCESS-GIC-INT-FIRST = "Y"
141000200423      *        GO TO REU-EXIT
141010200423      *      END-IF
141020200423      *    END-IF.
141030200423      *
141040200423      * Variable WS-PROCESS-GIC-INT-FIRST could be "Y" for non-GIC
141050200423      * transaction. In this case skip update process.
141060200423      * (Ex: SWI is DII and WS-PROCESS-GIC-INT-FIRST was set to "Y"
141070200423      * by SWO from GIC e.i.interest should be generated first)
141080200423      * Flag WS-PROCESS-GIC-INT-FIRST is resetting at every next
141090200423      * reading.
141100200423      *
141110200423           IF PASS-CDSC-CALCULATOR    = "Q"        AND
141120200423              REJECTION-CODE OF TRANS = "00 "
141130200423               PERFORM EVAL-CHQ-LOGIC
141140200423               IF WS-PROCESS-GIC-INT-FIRST = "Y"
141150200423                   GO TO REU-EXIT
141160200423               END-IF
141170200423           END-IF.
141180200423      * RFS11813 - End
141190200423      * ---------------------------------------------------------------
141200200423
141210200423      *RFS 8470 - END
141220200423
141230200423      *Get the next process number for this account investment
141240200423
141250200423           MOVE ACCOUNT-NO OF TRANS
141260200423                               TO ACCOUNT-NO OF
141270200423                               ACCOUNT-INVESTMENT-PROC-COUNT.
141280200423           MOVE INVESTMENT-CODE OF TRANS
141290200423                               TO INVESTMENT-CODE OF
141300200423                               ACCOUNT-INVESTMENT-PROC-COUNT.
141310200423
141320200423           MOVE "R"            TO WRITE-PROCESSED-COUNT.
141330200423
141340200423           READ ACCOUNT-INVESTMENT-PROC-COUNT
141350200423             INVALID KEY
141360200423             INITIALIZE MFAACIPCP
141370200423             MOVE ACCOUNT-NO OF TRANS
141380200423                               TO ACCOUNT-NO OF
141390200423                               ACCOUNT-INVESTMENT-PROC-COUNT
141400200423             MOVE INVESTMENT-CODE OF TRANS
141410200423                               TO INVESTMENT-CODE OF
141420200423                               ACCOUNT-INVESTMENT-PROC-COUNT
141430200423             MOVE "W"          TO WRITE-PROCESSED-COUNT.
141440200423
141450200423           ADD  1              TO TRANS-PROC-SEQ-NO OF
141460200423                               ACCOUNT-INVESTMENT-PROC-COUNT.
141470200423
141480200423           MOVE TRANS-PROC-SEQ-NO OF ACCOUNT-INVESTMENT-PROC-COUNT
141490200423                               TO TRANS-PROC-SEQ-NO OF TRANS.
141500200423
141510200423      *This routine is responsible for all updates to the database
141520200423
141530200423      *Write transaction record
141540200423      * ALWAYS UPDATE THROUGH THE PRIMARY
141550200423
141560200423           MOVE "R"                  TO WRITE-TRANS.
141570200423
141580200423           MOVE TRANS-NO OF TRANS
141590200423                                     TO TRANS-NO OF TRANS-PRIMARY.
141600200423           MOVE PLACEMENT-DATE OF TRANS
141610200423                                     TO PLACEMENT-DATE OF TRANS-PRIMARY.
141620200423
141630200423           READ TRANS-PRIMARY WITH NO LOCK
141640200423             INVALID KEY
141650200423               MOVE "W"        TO WRITE-TRANS.
141660200423
141670200423      *RFS56471 Starts - Ensure to exclude from Statements all SPIA Inv
141680200423      **SRQ11 All Transactions on SPIA Inv are excluded from statements and Conf
14169020042387517      IF lc_ModuleSEGSPIAOn
14170020042387517      PERFORM CheckIfInvIsSPIAInv
141710200423           IF lb_SPIAInvestYes
14172020042387517 **     AND (TRANS-TYPE-CODE OF TRANS = "BUY" OR "SWI" OR "TRI")
141730200423              MOVE "Y" TO HIDDEN-TRANS OF TRANS
141740200423                          HIDDEN-TRANS OF WS-TRANS-REC
141750200423                          SUPPRESS-CONFIRMATION OF TRANS
141760200423                          SUPPRESS-CONFIRMATION OF WS-TRANS-REC
141770200423           END-IF
14178020042387517      END-IF
141790200423      *RFS56471 end
141800200423
141810200423           MOVE REJECTION-CODE OF TRANS
141820200423                               TO WS-REJECTION-CODE.
141830200423
141840200423           IF WS-REJECTION-CODE IS EQUAL TO "00"
141850200423             MOVE TRANS-REC    TO WS-TRANS-REC-5
141860200423           ELSE
141870200423      * RFS5512 - Begin
141880200423      * If Transaction is rejected then restore Orig Split Option Code
141890200423             IF SW-CHANGE-SPLIT-OPTION               AND
141900200423                REDEMPTION-TRANSACTION
141910200423               MOVE WS-ORIG-SPLIT-OPTION-CODE TO
141920200423                            SPLIT-OPTION-CODE OF WS-TRANS-REC
141930200423             END-IF
141940200423      * RFS5512 - End
141950200423             MOVE WS-TRANS-REC TO TRANS-REC
141960200423             MOVE WS-REJECTION-CODE  TO REJECTION-CODE OF TRANS
141970200423           END-IF.
141980200423
141990200423      * RFS9530 - Begin
142000200423           IF WS-NEXT-DATE-SWI-YES              AND
142010200423              TRANS-TYPE-CODE OF TRANS = "SWI"
142020200423             MOVE WS-UPPER-LIMIT-DAT2
142030200423                               TO PROCESS-DATE OF TRANS
142040200423           ELSE
142050200423      * RFS9530 - End
142060200423           MOVE PASS-PROCESS-DATE-9
142070200423                               TO PROCESS-DATE OF TRANS.
142080200423
142090200423           MOVE TRANS-REC      TO TRANS-PRIMARY-REC.
142100200423
142110200423      * rfs 24192 - start
142120200423           IF WS-NDSNRR-GENERATED = "1"                  AND
142130200423              REJECTION-CODE OF TRANS-PRIMARY NOT = "00" AND
142140200423              PLACEMENT-DATE OF TRANS-PRIMARY     =
142150200423              PLACEMENT-DATE OF WS-NRR-SEL-TRANS         AND
142160200423              TRANS-NO       OF TRANS-PRIMARY     =
142170200423              TRANS-NO       OF WS-NRR-SEL-TRANS
142180200423
142190200423              PERFORM GENERATE-NR-TAX-SELL-ERROR
142200200423              MOVE "0"       TO WS-NDSNRR-GENERATED
142210200423              MOVE "N"       TO WS-NDSNRR-NO-READ
142220200423              GO TO REU-EXIT
142230200423           END-IF.
142240200423      * rfs 24192 - end
142250200423
142260200423           IF WRITE-TRANS            IS EQUAL TO "W"
142270200423             WRITE TRANS-PRIMARY-REC
142280200423                   INVALID KEY
142290200423                       CONTINUE
142300200423               END-WRITE
142310200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
142320200423               MOVE "TRANSACTION" TO WS-FILE-STATUS-FILE-NAME
14233020042358714          SET lncc_Err005  TO  TRUE
142340200423               PERFORM LOG-FILE-STATUS
142350200423      * R50475 - Beg
142360200423      *      ELSE
142370200423      *        IF lb_EditCodeALDSetupYes and
142380200423      *           SWITCH-OUT-TRANSACTION
142390200423      *          MOVE TRANS-PRIMARY-REC TO
142400200423      *               WS-TRANS-SWO-REC
142410200423      *        END-IF
142420200423      * R50475 - End
142430200423           END-IF.
142440200423
142450200423           IF WRITE-TRANS            IS EQUAL TO "R"
142460200423             REWRITE TRANS-PRIMARY-REC
142470200423                   INVALID KEY
142480200423                       CONTINUE
142490200423               END-REWRITE
142500200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
142510200423               MOVE "TRANSACTION" TO WS-FILE-STATUS-FILE-NAME
14252020042358714          SET lncc_Err006  TO  TRUE
142530200423               PERFORM LOG-FILE-STATUS
142540200423             END-IF
142550200423           END-IF.
142560200423
142570200423
142580200423           IF WRITE-PROCESSED-COUNT IS EQUAL TO "R"
142590200423             REWRITE ACCOUNT-INV-PROC-COUNT-REC
142600200423                   INVALID KEY
142610200423                       CONTINUE
142620200423               END-REWRITE
142630200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
142640200423               MOVE "PROC COUNT " TO WS-FILE-STATUS-FILE-NAME
14265020042358714          SET lncc_Err007  TO  TRUE
142660200423               PERFORM LOG-FILE-STATUS
142670200423
142680200423             END-IF
142690200423           END-IF.
142700200423
142710200423           IF WRITE-PROCESSED-COUNT IS EQUAL TO "W"
142720200423             WRITE ACCOUNT-INV-PROC-COUNT-REC
142730200423                   INVALID KEY
142740200423                       CONTINUE
142750200423               END-WRITE
142760200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
142770200423               MOVE "PROC COUNT " TO WS-FILE-STATUS-FILE-NAME
14278020042358714          SET lncc_Err008  TO  TRUE
142790200423               PERFORM LOG-FILE-STATUS
142800200423             END-IF
142810200423           END-IF.
142820200423
142830200423           IF WS-REJECTION-CODE IS NOT EQUAL TO "00"
142840200423             GO TO REU-EXIT
142850200423           END-IF.
142860200423
142870200423      *GIC MOD
142880200423      * RFS 112135 - Begin
142890200423           IF  GIC-DII-INVESTMENT AND SWITCH-OUT-TRANSACTION
142900200423136840*    AND PASS-CDSC-CALCULATOR = "Q"
142910200423              initialize pc_rjCode, Pc_WaiveFlag
142920200423119972                            , Pc_CertiFlag
142930200423              MOVE "S"            TO pc_Mode
142940200423              MOVE PLACEMENT-DATE OF TRANS
142950200423                                  TO pi_PlacementDte
142960200423              MOVE TRANS-NO       OF TRANS
142970200423                                  TO pi_TransNum
142980200423              MOVE PROCESS-DATE   OF TRANS
142990200423                                  TO pi_ProcessDate
143000200423137833        MOVE li_AccrualAmt  TO pi_AccrualAmt
143010200423
143020200423              CALL "FXTRFVAL" USING pc_Mode ,
143030200423                                    pi_PlacementDte ,
143040200423                                    pi_TransNum ,
143050200423                                    pi_ProcessDate ,
143060200423137833                              pi_AccrualAmt,
143070200423                                    Pc_WaiveFlag,
143080200423119972                              Pc_CertiFlag,
143090200423                                    pc_rjCode
143100200423           END-IF.
143110200423      * RFS 112135 - End
143120200423           IF GIC-DII-INVESTMENT
143130200423             PERFORM UPD-ACCT-FINANCIAL
143140200423      *    RFS84977.0 - Begin
143150200423           END-IF.
143160200423      *    RFS84977.0 - End
143170200423      *RFS9346 - BEGIN
143180200423      *    RFS84977 -Begin
143190200423      *      PERFORM UPD-RESP-FINANCIAL
143200200423127489*    IF NOT DISTRIBUTION-TRANSACTION
143210200423   |       IF (NOT DISTRIBUTION-TRANSACTION)
143220200423127489        AND RESP-ACCOUNT
143230200423             PERFORM UPD-RESP-FINANCIAL
143240200423      *    RFS84977.0 - Begin
143250200423      *    END-IF
143260200423      *    RFS84977.0 - End
143270200423      *    RFS84977 -End
143280200423      *RFS9346 - END
143290200423           END-IF.
143300200423
143310200423
143320200423      *END GIC MOD
143330200423      *Write exchange-rate
143340200423
143350200423           IF WRITE-EXCHANGE-RATE = "W"
143360200423             WRITE TRANS-EXCHANGE-RATE-REC
143370200423                   INVALID KEY
143380200423                       CONTINUE
143390200423               END-WRITE
143400200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
143410200423               MOVE "TXN EXCH RT" TO WS-FILE-STATUS-FILE-NAME
14342020042358714          SET lncc_Err009  TO  TRUE
143430200423               PERFORM LOG-FILE-STATUS
143440200423             END-IF
143450200423           END-IF.
143460200423
143470200423      *Write daily trans process sequence record
143480200423
143490200423           IF WRITE-TRANS-DLY-SEQ IS EQUAL TO "W"
143500200423             WRITE TRANS-DAILY-PROC-SEQ-REC
143510200423                   INVALID KEY
143520200423                       CONTINUE
143530200423               END-WRITE
143540200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
143550200423               MOVE "DAILY SEQ  " TO WS-FILE-STATUS-FILE-NAME
14356020042358714          SET lncc_Err010  TO  TRUE
143570200423               PERFORM LOG-FILE-STATUS
143580200423             END-IF
143590200423           END-IF.
143591210928      *RFS186588 - Starts - defect for 2-sided trades being logged twice
143592210928           IF lc_WriteMFATRNSEQPYes
143594210928              INITIALIZE li_Process_Date
143595210928              MOVE PASS-PROCESS-DATE-9 TO li_Process_Date
143596210928              CALL 'FXTRNPRSEQ' USING  li_Process_Date
143597210928                                       Placement-Date OF Trans
143598210928                                       Trans-No       OF Trans
143599210928                                       Trans-Status-Code OF Trans
143600210928           END-IF.
143601210928      *RFS186588 - Ends
143602200423
143610200423      ** BYPASS WRITE OF DEDUCTIONS FOR ADJUSTMENTS
143620200423      * RFS12271 - Begin ( Comment the code )
143630200423      *    IF PURCHASE-ADJUSTMENT OR REDEMPTION-ADJUSTMENT
143640200423      *       GO TO REU-0050
143650200423      *    END-IF.
143660200423      * RFS12271 - End
143670200423
143680200423      *Write trans interest details record
143690200423
143700200423           IF WRITE-TRANS-INTEREST-DETAILS IS EQUAL TO "W"
143710200423             WRITE TRANS-INTEREST-DETAILS-REC
143720200423                   INVALID KEY
143730200423                       CONTINUE
143740200423               END-WRITE
143750200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
143760200423               MOVE "TRANS INT DETAILS" TO WS-FILE-STATUS-FILE-NAME
14377020042358714          SET lncc_Err011  TO  TRUE
143780200423               PERFORM LOG-FILE-STATUS
143790200423             END-IF
143800200423           END-IF.
143810200423
143820200423           IF WRITE-TRANS-INTEREST-DETAILS IS EQUAL TO "R"
143830200423             REWRITE TRANS-INTEREST-DETAILS-REC
143840200423                   INVALID KEY
143850200423                       CONTINUE
143860200423               END-REWRITE
143870200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
143880200423               MOVE "TRANS INT DETAILS" TO WS-FILE-STATUS-FILE-NAME
14389020042358714          SET lncc_Err012  TO  TRUE
143900200423               PERFORM LOG-FILE-STATUS
143910200423             END-IF
143920200423           END-IF.
143930200423
143940200423      *  RFS18568 BEGIN
143950200423           IF WRITE-TRANS-PAY-TO-CHEQUE IS EQUAL TO "W"
143960200423             WRITE TRANS-PAY-TO-CHEQUE-REC
143970200423                   INVALID KEY
143980200423                       CONTINUE
143990200423               END-WRITE
144000200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144010200423               MOVE "TRANS PAY TO CHQ " TO WS-FILE-STATUS-FILE-NAME
14402020042358714          SET lncc_Err013  TO  TRUE
144030200423               PERFORM LOG-FILE-STATUS
144040200423             END-IF
144050200423           END-IF.
144060200423
144070200423           IF WRITE-TRANS-PAY-TO-BANK-2 IS EQUAL TO "W"
144080200423             WRITE TRANS-PAY-TO-BANK-2-REC
144090200423                   INVALID KEY
144100200423                       CONTINUE
144110200423               END-WRITE
144120200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144130200423               MOVE "TRANS PAY TO BNK2" TO WS-FILE-STATUS-FILE-NAME
14414020042358714          SET lncc_Err014  TO  TRUE
144150200423               PERFORM LOG-FILE-STATUS
144160200423             END-IF
144170200423           END-IF.
144180200423      *  RFS18568 END
144190200423
144200200423      * RFS17685 Start
144210200423      * Write the TRANS and TRANS-INTEREST-DETAILS record for interest
144220200423      * adjustment transaction.
144230200423           IF WRITE-INTEREST-ADJ-TRANS IS EQUAL TO "W"
144240200423             MOVE WS-INTEREST-ADJ-TRANS TO TRANS-PRIMARY-REC
144250200423             WRITE TRANS-PRIMARY-REC
144260200423                 INVALID KEY
144270200423                     CONTINUE
144280200423             END-WRITE
144290200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144300200423               MOVE "INT ADJ TRANS" TO WS-FILE-STATUS-FILE-NAME
14431020042358714          SET lncc_Err015  TO  TRUE
144320200423               PERFORM LOG-FILE-STATUS
144330200423             END-IF
144340200423             MOVE " " TO WRITE-INTEREST-ADJ-TRANS
144350200423           END-IF.
144360200423           IF WRITE-TRANS-INTEREST-ADJ-DTLS IS EQUAL TO "W"
144370200423             MOVE WS-TRANS-INTEREST-ADJ-DETAILS TO
144380200423                  TRANS-INTEREST-DETAILS-REC
144390200423             WRITE TRANS-INTEREST-DETAILS-REC
144400200423                   INVALID KEY
144410200423                       CONTINUE
144420200423               END-WRITE
144430200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144440200423               MOVE "TRANS INT ADJ DETAILS" TO WS-FILE-STATUS-FILE-NAME
14445020042358714          SET lncc_Err016  TO  TRUE
144460200423               PERFORM LOG-FILE-STATUS
144470200423             END-IF
144480200423             MOVE " " TO WRITE-TRANS-INTEREST-ADJ-DTLS
144490200423           END-IF.
144500200423      * RFS17685 End
144510200423
144520200423      *Write trans-redemption details
144530200423
144540200423           IF WRITE-TRANS-REDEM-DETAILS IS EQUAL TO "W"
144550200423             WRITE TRANS-REDEM-DETAILS-REC
144560200423                   INVALID KEY
144570200423                       CONTINUE
144580200423               END-WRITE
144590200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144600200423               MOVE "TRANS RDM DETAILS" TO WS-FILE-STATUS-FILE-NAME
14461020042358714          SET lncc_Err017  TO  TRUE
144620200423               PERFORM LOG-FILE-STATUS
144630200423             END-IF
144640200423           END-IF.
144650200423
144660200423           IF WRITE-TRANS-REDEM-DETAILS IS EQUAL TO "R"
144670200423             REWRITE TRANS-REDEM-DETAILS-REC
144680200423                   INVALID KEY
144690200423                       CONTINUE
144700200423               END-REWRITE
144710200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144720200423               MOVE "TRANS RDM DETAILS" TO WS-FILE-STATUS-FILE-NAME
14473020042358714          SET lncc_Err018  TO  TRUE
144740200423               PERFORM LOG-FILE-STATUS
144750200423             END-IF
144760200423           END-IF.
144770200423
144780200423      *Write txn redfee details
144790200423           IF WRITE-TXN-REDFEE-CALC-DT IS EQUAL TO "W"
144800200423             WRITE TRANS-REDFEE-CALC-DETAILS-REC
144810200423                   INVALID KEY
144820200423                       CONTINUE
144830200423               END-WRITE
144840200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144850200423               MOVE "TXN RDM DETAILS" TO WS-FILE-STATUS-FILE-NAME
14486020042358714          SET lncc_Err019  TO  TRUE
144870200423               PERFORM LOG-FILE-STATUS
144880200423             END-IF
144890200423           END-IF.
144900200423
144910200423           IF WRITE-TXN-REDFEE-CALC-DT IS EQUAL TO "R"
144920200423             REWRITE TRANS-REDFEE-CALC-DETAILS-REC
144930200423                   INVALID KEY
144940200423                       CONTINUE
144950200423               END-REWRITE
144960200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
144970200423               MOVE "TXN RDM DETAILS" TO WS-FILE-STATUS-FILE-NAME
14498020042358714          SET lncc_Err020  TO  TRUE
144990200423               PERFORM LOG-FILE-STATUS
145000200423             END-IF
145010200423           END-IF.
145020200423
145030200423      *Write txn redfee dep xfr details
145040200423           IF WRITE-TRANS-RED-DEP-XFR  IS EQUAL TO "W"
145050200423             WRITE TRANS-REDFEE-DEP-XFR-REC
145060200423                   INVALID KEY
145070200423                       CONTINUE
145080200423               END-WRITE
145090200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145100200423               MOVE "TXN RDM XF DTLS" TO WS-FILE-STATUS-FILE-NAME
14511020042358714          SET lncc_Err021  TO  TRUE
145120200423               PERFORM LOG-FILE-STATUS
145130200423             END-IF
145140200423           END-IF.
145150200423
145160200423           IF WRITE-TRANS-RED-DEP-XFR  IS EQUAL TO "R"
145170200423             REWRITE TRANS-REDFEE-DEP-XFR-REC
145180200423                   INVALID KEY
145190200423                       CONTINUE
145200200423               END-REWRITE
145210200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145220200423               MOVE "TXN RDM XF DTLS" TO WS-FILE-STATUS-FILE-NAME
14523020042358714          SET lncc_Err022  TO  TRUE
145240200423               PERFORM LOG-FILE-STATUS
145250200423             END-IF
145260200423           END-IF.
145270200423
145280200423      *Write acct investment basis
145290200423           IF WRITE-ACCT-INVEST-BASIS  IS EQUAL TO "W"
145300200423             WRITE ACCT-INVEST-REDFEE-BASIS-AMT-R
145310200423                   INVALID KEY
145320200423                       CONTINUE
145330200423               END-WRITE
145340200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145350200423               MOVE "ACCT INV BASIS" TO WS-FILE-STATUS-FILE-NAME
14536020042358714          SET lncc_Err023  TO  TRUE
145370200423               PERFORM LOG-FILE-STATUS
145380200423             END-IF
145390200423           END-IF.
145400200423
145410200423           IF WRITE-ACCT-INVEST-BASIS  IS EQUAL TO "R"
145420200423             REWRITE ACCT-INVEST-REDFEE-BASIS-AMT-R
145430200423                   INVALID KEY
145440200423                       CONTINUE
145450200423             END-REWRITE
145460200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145470200423               MOVE "ACCT INV BASIS" TO WS-FILE-STATUS-FILE-NAME
14548020042358714          SET lncc_Err024  TO  TRUE
145490200423               PERFORM LOG-FILE-STATUS
145500200423             END-IF
145510200423           END-IF.
145520200423
145530200423      *Write commission records
145540200423
145550200423           IF WRITE-TRANS-COMMISSION IS EQUAL TO "W"
145560200423             WRITE TRANS-COMMISSION-REC
145570200423                   INVALID KEY
145580200423                       CONTINUE
145590200423               END-WRITE
145600200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145610200423               MOVE "TRANS COMMISSION" TO WS-FILE-STATUS-FILE-NAME
14562020042358714          SET lncc_Err025  TO  TRUE
145630200423               PERFORM LOG-FILE-STATUS
145640200423             END-IF
145650200423           END-IF.
145660200423
145670200423           IF WRITE-TRANS-COMMISSION IS EQUAL TO "R"
145680200423             REWRITE TRANS-COMMISSION-REC
145690200423                   INVALID KEY
145700200423                       CONTINUE
145710200423               END-REWRITE
145720200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
145730200423               MOVE "TRANS COMMISSION" TO WS-FILE-STATUS-FILE-NAME
14574020042358714          SET lncc_Err026  TO  TRUE
145750200423               PERFORM LOG-FILE-STATUS
145760200423             END-IF
145770200423           END-IF.
145780200423
145790200423      * RFS32873 - Begin
145800200423           IF lncc_writeRewBonusComm
145810200423             WRITE lfh_clawbackBonusCommRec
145820200423               INVALID KEY
145830200423                 REWRITE lfh_clawbackBonusCommRec
145840200423                 INVALID KEY
14585020042358714              CONTINUE
14586020042358714 *            MOVE "Clawback Bonus Commission"
14587020042358714 *                     TO WS-FILE-STATUS-FILE-NAME
14588020042358714 *            PERFORM LOG-FILE-STATUS
145890200423                 END-REWRITE
14590020042358714            IF WS-FILE-STATUS IS NOT EQUAL TO "00"
14591020042358714               MOVE "MFACLWBCP"
14592020042358714                       TO WS-FILE-STATUS-FILE-NAME
14593020042358714               SET lncc_Err027  TO  TRUE
14594020042358714               PERFORM LOG-FILE-STATUS
14595020042358714            END-IF
145960200423             END-WRITE
14597020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
14598020042358714           MOVE "MFACLWBCP" TO  WS-FILE-STATUS-FILE-NAME
14599020042358714           SET lncc_Err028  TO  TRUE
14600020042358714           PERFORM LOG-FILE-STATUS
14601020042358714        END-IF
146020200423           END-IF
146030200423      * RFS32873 - End
146040200423      *RFS 8058 BEGIN
146050200423      *Write account level ds details
146060200423
146070200423      * RFS13839 - Begin (Update was moved to separate section)
146080200423           PERFORM UPD-TRANS-ACCOUNT-LV-DS-DTLS
146090200423      * RFS13839 - End
146100200423
146110200423      *Write account level free-details
146120200423
146130200423      * RFS13839 - Begin (Update was moved to separate section)
146140200423           PERFORM UPD-ACCOUNT-LEVEL-FREE
146150200423      * RFS13839 - End
146160200423
146170200423      *RFS 8058 END
146180200423
146190200423      *RFS 8066 BEGIN
146200200423      *Write account level qualified
146210200423
146220200423           IF WRITE-ACC-QUAL  IS EQUAL "W"
146230200423
146240200423             WRITE ACCOUNT-LV-QUALIFIED-REC
146250200423                   INVALID KEY
146260200423                       CONTINUE
146270200423               END-WRITE
146280200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
146290200423               MOVE "AC LV QUAL" TO WS-FILE-STATUS-FILE-NAME
14630020042358714          SET lncc_Err029  TO  TRUE
146310200423               PERFORM LOG-FILE-STATUS
146320200423             END-IF
146330200423           END-IF.
146340200423
146350200423           IF WRITE-ACC-QUAL IS EQUAL "R"
146360200423             REWRITE ACCOUNT-LV-QUALIFIED-REC
146370200423                   INVALID KEY
146380200423                       CONTINUE
146390200423               END-REWRITE
146400200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
146410200423               MOVE "AC LV QUAL" TO WS-FILE-STATUS-FILE-NAME
14642020042358714          SET lncc_Err030  TO  TRUE
146430200423               PERFORM LOG-FILE-STATUS
146440200423             END-IF
146450200423           END-IF.
146460200423
146470200423      *RFS 8066 END
146480200423
146490200423      * RFS14090 - Begin
146491210927      * RFS1120696 - Start: added condition for FLDALF
146500210922      *    IF ACCOUNT-LEV-DSC AND SWITCH-IN-TRANSACTION
146510201223      *RFS180707 -Starts
146520210922      *    AND lnc_ACINDSCNo
146530201223      *RFS180707 - Ends
146531210922           IF ( ACCOUNT-LEV-DSC AND SWITCH-IN-TRANSACTION
146532210922      *RFS180707 -Starts
146533210922           AND lnc_ACINDSCNo )
146534210922      *RFS180707 - Ends
146535210922            OR (lncc_FLDALFYes AND SWITCH-IN-TRANSACTION )
146536210922      * RFS1120696 - End
146540200423             PERFORM CHECK-ROLLBACK-ACCT-LEV-FREE
146550200423           END-IF.
146560200423      * RFS14090 - End
146570200423      *Write cdsc purchase record
146580200423
146590200423      * RFS13839 - Begin (Update was moved to separate section)
146600200423           PERFORM UPD-TRANS-CDSC-PUR-PRIMARY
146610200423      * RFS13839 - End
146620200423
146630200423           IF NOT CLOCK-SUPPORT
146640200423             GO TO REU-0040
146650200423           END-IF.
146660200423
146670200423           IF WRITE-TRANS-CDSC-CLOCK    IS EQUAL TO "W"
146680200423             WRITE TRANS-CDSC-CLOCK-PRI-REC
146690200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
146700200423               MOVE "TRANS CDSC CLOCK" TO WS-FILE-STATUS-FILE-NAME
14671020042358714          SET lncc_Err031  TO  TRUE
146720200423               PERFORM LOG-FILE-STATUS
146730200423
146740200423             END-IF
146750200423           END-IF.
146760200423
146770200423           IF WRITE-TRANS-CDSC-CLOCK IS EQUAL TO "R"
146780200423             REWRITE TRANS-CDSC-CLOCK-PRI-REC
146790200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
146800200423               MOVE "TRANS CDSC CLOCK" TO WS-FILE-STATUS-FILE-NAME
14681020042358714          SET lncc_Err032  TO  TRUE
146820200423               PERFORM LOG-FILE-STATUS
146830200423
146840200423             END-IF
146850200423           END-IF.
146860200423
146870200423       REU-0040.
146880200423
146890200423      *Write trans target
146900200423
146910200423           IF WRITE-TRANS-TARGET IS EQUAL TO "W"
146920200423             WRITE TRANS-TARGET-REC
146930200423                   INVALID KEY
146940200423                       CONTINUE
146950200423               END-WRITE
146960200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
146970200423               MOVE "TRANS TGT DETAILS" TO WS-FILE-STATUS-FILE-NAME
14698020042358714          SET lncc_Err033  TO  TRUE
146990200423               PERFORM LOG-FILE-STATUS
147000200423             END-IF
147010200423           END-IF.
147020200423
147030200423           IF WRITE-TRANS-TARGET IS EQUAL TO "R"
147040200423             REWRITE TRANS-TARGET-REC
147050200423                   INVALID KEY
147060200423                       CONTINUE
147070200423               END-REWRITE
147080200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
147090200423               MOVE "TRANS TGT DETAILS" TO WS-FILE-STATUS-FILE-NAME
14710020042358714          SET lncc_Err034  TO  TRUE
147110200423               PERFORM LOG-FILE-STATUS
147120200423             END-IF
147130200423           END-IF.
14714020042334309
14715020042334309      IF VALID-RESP-EAP-TRADE AND
14716020042334309         WRITE-TRANS-DIST-CNTRY-CODE IS EQUAL TO "W"
14717020042334309        WRITE TRANS-DIST-CNTRY-CODE-REC
14718020042334309              INVALID KEY
14719020042334309                  CONTINUE
14720020042334309          END-WRITE
14721020042334309        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
14722020042334309          MOVE "TRANS DIST CNTRY CD"
14723020042334309                          TO WS-FILE-STATUS-FILE-NAME
14724020042334309          PERFORM LOG-FILE-STATUS
14725020042334309        END-IF
14726020042334309      END-IF.
14727020042334309
14728020042334309      IF VALID-RESP-EAP-TRADE AND
14729020042334309         WRITE-TRANS-DIST-CNTRY-CODE IS EQUAL TO "R"
14730020042334309        REWRITE TRANS-DIST-CNTRY-CODE-REC
14731020042334309              INVALID KEY
14732020042334309                  CONTINUE
14733020042334309          END-REWRITE
14734020042334309        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
14735020042334309          MOVE "TRANS DIST CNTRY CD"
14736020042334309                          TO WS-FILE-STATUS-FILE-NAME
14737020042334309          PERFORM LOG-FILE-STATUS
14738020042334309        END-IF
14739020042334309      END-IF.
147400200423
147410200423      *Write transaction charges
147420200423      *Check for the existence of the deduction records to determine
147430200423      *if to write or rewrite
147440200423
147450200423      *Check commission record existence
147460200423
147470200423            IF COMM-AMT OF TRANS-COMMISSION IS NOT EQUAL 0
147480200423               MOVE PLACEMENT-DATE OF TRANS
147490200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
147500200423               MOVE TRANS-NO       OF TRANS
147510200423                                  TO TRANS-NO OF TRANS-CHARGES
147520200423               MOVE "COMM"    TO DEDUCTION-CODE OF TRANS-CHARGES
147530200423               MOVE "R"           TO WRITE-COMMISSION
147540200423               READ TRANS-CHARGES WITH NO LOCK
147550200423                 INVALID KEY
147560200423                 MOVE "W"         TO WRITE-COMMISSION
147570200423            END-IF.
147580200423
147590200423      *Check sponsor record existence
147600200423
147610200423            IF SPONSOR-AMT OF TRANS-COMMISSION IS NOT EQUAL 0
147620200423               MOVE PLACEMENT-DATE OF TRANS
147630200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
147640200423               MOVE TRANS-NO       OF TRANS
147650200423                                  TO TRANS-NO OF TRANS-CHARGES
147660200423               MOVE "SPNS"    TO DEDUCTION-CODE OF TRANS-CHARGES
147670200423               MOVE "R"           TO WRITE-SPONSOR
147680200423               READ TRANS-CHARGES WITH NO LOCK
147690200423                 INVALID KEY
147700200423                 MOVE "W"         TO WRITE-SPONSOR
147710200423            END-IF.
147720200423
147730200423      *Check fedtax record existence
147740200423
147750200423            IF WS-FEDERAL-TAX-AMOUNT IS NOT EQUAL 0
147760200423               MOVE PLACEMENT-DATE OF TRANS
147770200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
147780200423               MOVE TRANS-NO       OF TRANS
147790200423                                  TO TRANS-NO OF TRANS-CHARGES
147800200423               MOVE "FEDT"    TO DEDUCTION-CODE OF TRANS-CHARGES
147810200423               MOVE "R"           TO WRITE-FEDTAX
147820200423               READ TRANS-CHARGES WITH NO LOCK
147830200423                 INVALID KEY
147840200423                 MOVE "W"         TO WRITE-FEDTAX
147850200423      *RFS24191 - Begins
147860200423               END-READ
147870200423
147880200423               MOVE PLACEMENT-DATE OF TRANS
147890200423                 TO PLACEMENT-DATE OF TRANS-INCLUSION-RATE
147900200423               MOVE TRANS-NO       OF TRANS
147910200423                 TO TRANS-NO       OF TRANS-INCLUSION-RATE
147920200423               MOVE "R"  TO WRITE-TRANS-INCL-RATE
147930200423
147940200423               READ TRANS-INCLUSION-RATE WITH NO LOCK
147950200423                 INVALID KEY
147960200423                   MOVE "W"  TO WRITE-TRANS-INCL-RATE
147970200423               END-READ
147980200423      *RFS24191 - Ends
147990200423
148000200423      *RFS24190 - Begins
148010200423               MOVE PLACEMENT-DATE OF TRANS
148020200423                 TO PLACEMENT-DATE OF TRANS-UNIT-COST
148030200423               MOVE TRANS-NO       OF TRANS
148040200423                 TO TRANS-NO       OF TRANS-UNIT-COST
148050200423               MOVE "R"  TO WRITE-TRANS-UNIT-COST
148060200423
148070200423               READ TRANS-UNIT-COST WITH NO LOCK
148080200423                 INVALID KEY
148090200423                   MOVE "W"  TO WRITE-TRANS-UNIT-COST
148100200423               END-READ
148110200423      *RFS24190 - Ends
148120200423            END-IF.
148130200423
148140200423      *Check prvtax record existence
148150200423
148160200423            IF WS-PROVINCIAL-TAX-AMOUNT IS NOT EQUAL 0
148170200423               MOVE PLACEMENT-DATE OF TRANS
148180200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
148190200423               MOVE TRANS-NO       OF TRANS
148200200423                                  TO TRANS-NO OF TRANS-CHARGES
148210200423               MOVE "PRVT"    TO DEDUCTION-CODE OF TRANS-CHARGES
148220200423               MOVE "R"           TO WRITE-PRVTAX
148230200423               READ TRANS-CHARGES WITH NO LOCK
148240200423                 INVALID KEY
148250200423                 MOVE "W"         TO WRITE-PRVTAX
148260200423            END-IF.
148270200423
148280200423      *Check GST record existence
148290200423
148300200423            IF WS-GST-AMOUNT IS NOT EQUAL 0
148310200423               MOVE PLACEMENT-DATE OF TRANS
148320200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
148330200423               MOVE TRANS-NO       OF TRANS
148340200423                                  TO TRANS-NO OF TRANS-CHARGES
148350200423               MOVE "GST"         TO DEDUCTION-CODE OF TRANS-CHARGES
148360200423               MOVE "R"           TO WRITE-GST
148370200423               READ TRANS-CHARGES WITH NO LOCK
148380200423                 INVALID KEY
148390200423                 MOVE "W"         TO WRITE-GST
148400200423            END-IF.
148410200423
148420200423      *Check prv sales tax record existence
148430200423
148440200423            IF WS-PST-AMOUNT IS NOT EQUAL 0
148450200423               MOVE PLACEMENT-DATE OF TRANS
148460200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
148470200423               MOVE TRANS-NO       OF TRANS
148480200423                                  TO TRANS-NO OF TRANS-CHARGES
148490200423               MOVE "PST"         TO DEDUCTION-CODE OF TRANS-CHARGES
148500200423               MOVE "R"           TO WRITE-PST
148510200423               READ TRANS-CHARGES WITH NO LOCK
148520200423                 INVALID KEY
148530200423                 MOVE "W"         TO WRITE-PST
148540200423            END-IF.
148550200423
148560200423      *Check nontax record existence
148570200423
148580200423            IF WS-FEDERAL-TAX-AMOUNT IS NOT EQUAL 0
148590200423               MOVE PLACEMENT-DATE OF TRANS
148600200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
148610200423               MOVE TRANS-NO       OF TRANS
148620200423                                  TO TRANS-NO OF TRANS-CHARGES
148630200423               MOVE "NONT"    TO DEDUCTION-CODE OF TRANS-CHARGES
148640200423               MOVE "R"           TO WRITE-NONTAX
148650200423               READ TRANS-CHARGES WITH NO LOCK
148660200423                 INVALID KEY
148670200423                 MOVE "W"         TO WRITE-NONTAX
148680200423            END-IF.
148690200423
148700200423      *Check for Link Notes Investment NONT waiver
148710200423
148720200423      *RFS29550 - Begins
148730200423      *Check US Withholding Tax record existence
148740200423
148750200423            IF WS-US-WH-TAX-AMOUNT NOT = 0
148760200423               MOVE PLACEMENT-DATE OF TRANS
148770200423                 TO PLACEMENT-DATE OF TRANS-CHARGES
148780200423               MOVE TRANS-NO       OF TRANS
148790200423                 TO TRANS-NO       OF TRANS-CHARGES
148800200423               MOVE "USWT"         TO DEDUCTION-CODE OF TRANS-CHARGES
148810200423               MOVE "R"            TO WRITE-USWT
148820200423               READ TRANS-CHARGES WITH NO LOCK
148830200423                 INVALID KEY
148840200423                 MOVE "W"         TO WRITE-USWT
148850200423               END-READ
148860200423            END-IF.
148870200423      *RFS29550 - Ends
148880200423
148890200423      *Check federal clawback existence
148900200423
148910200423            IF WS-FEDERAL-CLAWBACK   IS NOT EQUAL 0
148920200423               MOVE PLACEMENT-DATE OF TRANS
148930200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
148940200423               MOVE TRANS-NO       OF TRANS
148950200423                                  TO TRANS-NO OF TRANS-CHARGES
148960200423               MOVE "FEDC"        TO DEDUCTION-CODE OF TRANS-CHARGES
148970200423               MOVE "R"           TO WRITE-FEDCLW
148980200423               READ TRANS-CHARGES WITH NO LOCK
148990200423                 INVALID KEY
149000200423                 MOVE "W"         TO WRITE-FEDCLW
149010200423            END-IF.
149020200423
149030200423      *Check provincial clawback existence
149040200423
149050200423
149060200423            IF WS-PROVINCIAL-CLAWBACK   IS NOT EQUAL 0
149070200423               MOVE PLACEMENT-DATE OF TRANS
149080200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
149090200423               MOVE TRANS-NO       OF TRANS
149100200423                                  TO TRANS-NO OF TRANS-CHARGES
149110200423               MOVE "PRVC"        TO DEDUCTION-CODE OF TRANS-CHARGES
149120200423               MOVE "R"           TO WRITE-PRVCLW
149130200423               READ TRANS-CHARGES WITH NO LOCK
149140200423                 INVALID KEY
149150200423                 MOVE "W"         TO WRITE-PRVCLW
149160200423            END-IF.
149170200423
149180200423      *RFS 14380 BEGIN
149190200423      *Check ERF charge existence
149200200423
149210200423            IF WS-ERF-CHARGE   IS NOT EQUAL 0
149220200423               MOVE PLACEMENT-DATE OF TRANS
149230200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
149240200423               MOVE TRANS-NO       OF TRANS
149250200423                                  TO TRANS-NO OF TRANS-CHARGES
149260200423               MOVE "ERED"        TO DEDUCTION-CODE OF TRANS-CHARGES
149270200423               MOVE "R"           TO WRITE-ERF
149280200423               READ TRANS-CHARGES WITH NO LOCK
149290200423                 INVALID KEY
149300200423                 MOVE "W"         TO WRITE-ERF
149310200423            END-IF.
149320200423      *RFS 14380 END
149330200423      *RFS 139288BEGIN
149340200423      *Check Insurance charge existence
149350200423
149360200423            IF WS-INSURANCE-FEE   NOT EQUAL 0
149370200423               MOVE PLACEMENT-DATE OF TRANS
149380200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
149390200423               MOVE TRANS-NO       OF TRANS
149400200423                                  TO TRANS-NO OF TRANS-CHARGES
149410200423               MOVE "ANIN"        TO DEDUCTION-CODE OF TRANS-CHARGES
149420200423               MOVE "R"           TO WRITE-INSURANCE-FEE
149430200423               READ TRANS-CHARGES WITH NO LOCK
149440200423                 INVALID KEY
149450200423                 MOVE "W"         TO WRITE-INSURANCE-FEE
149460200423            END-IF.
149470200423      *RFS 139288END
149480200423      *Check CDSC record existence
149490200423            IF WS-CDSC-AMOUNT IS NOT EQUAL 0
149500200423               MOVE PLACEMENT-DATE OF TRANS
149510200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
149520200423               MOVE TRANS-NO       OF TRANS
149530200423                                  TO TRANS-NO OF TRANS-CHARGES
149540200423               MOVE "CDSC"    TO DEDUCTION-CODE OF TRANS-CHARGES
149550200423               MOVE "R"           TO WRITE-CDSC
149560200423               READ TRANS-CHARGES WITH NO LOCK
149570200423                 INVALID KEY
149580200423                 MOVE "W"         TO WRITE-CDSC
149590200423            END-IF.
149600200423      *Check HH REDFEE
149610200423            IF WS-HH-RED-AMT IS NOT EQUAL TO 0
149620200423               MOVE PLACEMENT-DATE OF TRANS
149630200423                                  TO PLACEMENT-DATE OF TRANS-CHARGES
149640200423               MOVE TRANS-NO       OF TRANS
149650200423                                  TO TRANS-NO OF TRANS-CHARGES
149660200423               MOVE "HRDF"    TO DEDUCTION-CODE OF TRANS-CHARGES
149670200423               MOVE "R"           TO WRITE-HRDF-FEE
149680200423               READ TRANS-CHARGES WITH NO LOCK
149690200423                 INVALID KEY
149700200423                 MOVE "W"         TO WRITE-HRDF-FEE
149710200423            END-IF.
149720200423
149730200423      *Commission charges
149740200423
149750200423           IF WRITE-TRANS-COMMISSION IS NOT EQUAL " "
149760200423           AND NOT REDEMPTION-TRANSACTION
149770200423             IF COMM-AMT OF TRANS-COMMISSION IS NOT EQUAL 0
149780200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
149790200423               MOVE PLACEMENT-DATE OF TRANS
149800200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
149810200423               MOVE TRANS-NO       OF TRANS
149820200423                               TO TRANS-NO OF TRANS-CHARGES
149830200423               MOVE "COMM"    TO DEDUCTION-CODE OF TRANS-CHARGES
149840200423               MOVE COMM-AMT OF TRANS-COMMISSION
149850200423                               TO CHARGE OF TRANS-CHARGES
149860200423               MOVE COMM-RATE OF TRANS-COMMISSION
149870200423                               TO RATE OF TRANS-CHARGES
149880200423               IF WRITE-COMMISSION = "W"
149890200423                 WRITE TRANS-CHARGES-REC
149900200423                           INVALID KEY
149910200423                               CONTINUE
149920200423                       END-WRITE
149930200423               ELSE
149940200423                 REWRITE TRANS-CHARGES-REC
149950200423                           INVALID KEY
149960200423                               CONTINUE
149970200423                       END-REWRITE
149980200423               END-IF
149990200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
150000200423                 MOVE "TRANS COMMISSION CHARGES"
150010200423                               TO WS-FILE-STATUS-FILE-NAME
15002020042358714          SET lncc_Err035  TO  TRUE
150030200423                 PERFORM LOG-FILE-STATUS
150040200423
150050200423               END-IF
150060200423             END-IF
150070200423      *Sponsor charges
150080200423             IF SPONSOR-AMT OF TRANS-COMMISSION IS NOT EQUAL 0
150090200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
150100200423               MOVE PLACEMENT-DATE OF TRANS
150110200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
150120200423               MOVE TRANS-NO       OF TRANS
150130200423                               TO TRANS-NO OF TRANS-CHARGES
150140200423               MOVE "SPNS"    TO DEDUCTION-CODE OF TRANS-CHARGES
150150200423               MOVE SPONSOR-AMT OF TRANS-COMMISSION
150160200423                               TO CHARGE OF TRANS-CHARGES
150170200423               MOVE SPONSOR-RATE OF TRANS-COMMISSION
150180200423                               TO RATE OF TRANS-CHARGES
150190200423               IF WRITE-SPONSOR  = "W"
150200200423                 WRITE TRANS-CHARGES-REC
150210200423                           INVALID KEY
150220200423                               CONTINUE
150230200423                       END-WRITE
150240200423               ELSE
150250200423                 REWRITE TRANS-CHARGES-REC
150260200423                           INVALID KEY
150270200423                               CONTINUE
150280200423                       END-REWRITE
150290200423               END-IF
150300200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
150310200423                 MOVE "TRANS SPONSOR CHARGES"
150320200423                               TO WS-FILE-STATUS-FILE-NAME
15033020042358714            SET lncc_Err036  TO  TRUE
150340200423                 PERFORM LOG-FILE-STATUS
150350200423               END-IF
150360200423             END-IF
150370200423           END-IF.
150380200423      *Federal or Non Resident Tax
150390200423             IF WS-FEDERAL-TAX-AMOUNT IS NOT EQUAL 0
150400200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
150410200423               MOVE PLACEMENT-DATE OF TRANS
150420200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
150430200423               MOVE TRANS-NO       OF TRANS
150440200423                               TO TRANS-NO OF TRANS-CHARGES
150450200423               MOVE WS-FEDERAL-TAX-AMOUNT
150460200423                               TO CHARGE OF TRANS-CHARGES
150470200423               MOVE WS-FEDERAL-TAX-RATE-2
150480200423                               TO RATE OF TRANS-CHARGES
150490200423      *RFS24191 - Begins
150500200423               IF INCRATCPG-CALC
150510200423R24190         OR NTAXT2062-CALC
150520200423R24190         OR NTAXREGSEL-CALC
150530200423                  MOVE WS-FED-INCL-RATE-2
150540200423                    TO RATE OF TRANS-CHARGES
150550200423               END-IF
150560200423      *RFS24191 - Ends
150570200423               MOVE COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX
150580200423                               TO COUNTRY-CODE OF TRANS-CHARGES
150590200423               MOVE PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX
150600200423                               TO PROVINCE-CODE OF TRANS-CHARGES
150610200423               IF COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX = "CAN"
150620200423                 MOVE "FEDT"    TO DEDUCTION-CODE OF TRANS-CHARGES
150630200423               ELSE
150640200423                 MOVE "NONT"    TO DEDUCTION-CODE OF TRANS-CHARGES
150650200423               END-IF
150660200423
150670200423               IF (DEDUCTION-CODE OF TRANS-CHARGES = "FEDT"
150680200423               AND WRITE-FEDTAX = "W")
150690200423               OR (DEDUCTION-CODE OF TRANS-CHARGES = "NONT"
150700200423               AND WRITE-NONTAX = "W")
150710200423
150720200423                 WRITE TRANS-CHARGES-REC
150730200423                       INVALID KEY
150740200423                           CONTINUE
150750200423                   END-WRITE
150760200423               ELSE
150770200423                 REWRITE TRANS-CHARGES-REC
150780200423                       INVALID KEY
150790200423                           CONTINUE
150800200423                   END-REWRITE
150810200423               END-IF
150820200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
150830200423                 MOVE "FEDERAL/NON RES CHARGES"
150840200423                               TO WS-FILE-STATUS-FILE-NAME
15085020042358714            SET lncc_Err037  TO  TRUE
150860200423                 PERFORM LOG-FILE-STATUS
150870200423               END-IF
150880200423
150890200423      *RFS24191 - Begins
150900200423               IF INCRATCPG-CALC
150910200423                  IF WS-INCLUSION-RATE-2  NOT =  0
150920200423                     MOVE PLACEMENT-DATE OF TRANS
150930200423                       TO PLACEMENT-DATE OF TRANS-INCLUSION-RATE
150940200423                     MOVE TRANS-NO       OF TRANS
150950200423                       TO TRANS-NO       OF TRANS-INCLUSION-RATE
150960200423                     MOVE WS-INCLUSION-RATE-2
150970200423                       TO INCLUSION-RATE OF TRANS-INCLUSION-RATE
150980200423
150990200423                     IF WRITE-TRANS-INCL-RATE = "W"
151000200423                        WRITE TRANS-INCLUSION-RATE-REC
151010200423                          INVALID KEY
151020200423                            CONTINUE
151030200423                        END-WRITE
151040200423                     ELSE
151050200423                        REWRITE TRANS-INCLUSION-RATE-REC
151060200423                          INVALID KEY
151070200423                            CONTINUE
151080200423                        END-REWRITE
151090200423                     END-IF
151100200423
151110200423                     IF WS-FILE-STATUS  NOT =  "00"
151120200423                        MOVE "FED/NON RES INCL RATE"
151130200423                          TO WS-FILE-STATUS-FILE-NAME
15114020042358714                   SET lncc_Err038  TO  TRUE
151150200423                        PERFORM LOG-FILE-STATUS
151160200423                     END-IF
151170200423                  END-IF
151180200423               END-IF
151190200423      *RFS24191 - Ends
151200200423      *RFS24190 - Begins
151210200423               IF NTAXT2062-CALC
151220200423                  MOVE PLACEMENT-DATE    OF TRANS
151230200423                    TO PLACEMENT-DATE    OF TRANS-UNIT-COST
151240200423                  MOVE TRANS-NO          OF TRANS
151250200423                    TO TRANS-NO          OF TRANS-UNIT-COST
151260200423                  MOVE WS-AUC-UNIT-COST
151270200423                    TO AVERAGE-UNIT-COST OF TRANS-UNIT-COST
151280200423
151290200423                  IF WRITE-TRANS-UNIT-COST = "W"
151300200423                     WRITE TRANS-UNIT-COST-REC
151310200423                       INVALID KEY
151320200423                         CONTINUE
151330200423                     END-WRITE
151340200423                  ELSE
151350200423                     REWRITE TRANS-UNIT-COST-REC
151360200423                       INVALID KEY
151370200423                         CONTINUE
151380200423                     END-REWRITE
151390200423                  END-IF
151400200423
151410200423                  IF WS-FILE-STATUS  NOT =  "00"
151420200423                     MOVE "FED/NON RES T2062 COST"
151430200423                       TO WS-FILE-STATUS-FILE-NAME
15144020042358714                SET lncc_Err039  TO  TRUE
151450200423                     PERFORM LOG-FILE-STATUS
151460200423                  END-IF
151470200423               END-IF
151480200423      *RFS24190 - Ends
151490200423             END-IF
151500200423
151510200423      *Provincial Tax
151520200423
151530200423             IF WS-PROVINCIAL-TAX-AMOUNT IS NOT EQUAL 0
151540200423               MOVE PLACEMENT-DATE OF TRANS
151550200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
151560200423               MOVE TRANS-NO       OF TRANS
151570200423                               TO TRANS-NO OF TRANS-CHARGES
151580200423               MOVE WS-PROVINCIAL-TAX-AMOUNT
151590200423                               TO CHARGE OF TRANS-CHARGES
151600200423               MOVE WS-PROVINCIAL-TAX-RATE-2
151610200423                               TO RATE OF TRANS-CHARGES
151620200423               MOVE COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX
151630200423                               TO COUNTRY-CODE OF TRANS-CHARGES
151640200423               MOVE PROVINCE-CODE OF COUNTRY-WITHHOLDING-TAX
151650200423                               TO PROVINCE-CODE OF TRANS-CHARGES
151660200423               MOVE "PRVT"     TO DEDUCTION-CODE OF TRANS-CHARGES
151670200423               IF WRITE-PRVTAX = "W"
151680200423                 WRITE TRANS-CHARGES-REC
151690200423                       INVALID KEY
151700200423                           CONTINUE
151710200423                   END-WRITE
151720200423               ELSE
151730200423                 REWRITE TRANS-CHARGES-REC
151740200423                       INVALID KEY
151750200423                           CONTINUE
151760200423                   END-REWRITE
151770200423               END-IF
151780200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
151790200423                 MOVE "PROVINCIAL TAX CHARGES"
151800200423                               TO WS-FILE-STATUS-FILE-NAME
15181020042358714            SET lncc_Err040  TO  TRUE
151820200423                 PERFORM LOG-FILE-STATUS
151830200423               END-IF
151840200423             END-IF
151850200423
151860200423      *RFS29550 - Begins
151870200423      *US Withholding Tax
151880200423
151890200423             IF WS-US-WH-TAX-AMOUNT NOT = 0
151900200423               MOVE PLACEMENT-DATE OF TRANS
151910200423                 TO PLACEMENT-DATE OF TRANS-CHARGES
151920200423               MOVE TRANS-NO       OF TRANS
151930200423                 TO TRANS-NO       OF TRANS-CHARGES
151940200423               MOVE WS-US-WH-TAX-AMOUNT
151950200423                 TO CHARGE         OF TRANS-CHARGES
151960200423               MOVE WS-USWT-TAX-RATE
151970200423                 TO RATE           OF TRANS-CHARGES
151980200423               MOVE COUNTRY-CODE   OF COUNTRY-WITHHOLDING-TAX
151990200423                 TO COUNTRY-CODE   OF TRANS-CHARGES
152000200423               MOVE PROVINCE-CODE  OF COUNTRY-WITHHOLDING-TAX
152010200423                 TO PROVINCE-CODE  OF TRANS-CHARGES
152020200423               MOVE "USWT"         TO DEDUCTION-CODE OF TRANS-CHARGES
152030200423               IF WRITE-USWT = "W"
152040200423                  WRITE TRANS-CHARGES-REC
152050200423                    INVALID KEY
152060200423                      CONTINUE
152070200423                  END-WRITE
152080200423               ELSE
152090200423                  REWRITE TRANS-CHARGES-REC
152100200423                    INVALID KEY
152110200423                      CONTINUE
152120200423                  END-REWRITE
152130200423               END-IF
152140200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
152150200423                  MOVE "US WH TAX CHARGES" TO WS-FILE-STATUS-FILE-NAME
15216020042358714             SET lncc_Err041  TO  TRUE
152170200423                  PERFORM LOG-FILE-STATUS
152180200423               END-IF
152190200423             END-IF
152200200423      *RFS29550 - Ends
152210200423      *Federal clawback
152220200423             IF WS-FEDERAL-CLAWBACK   IS NOT EQUAL 0
152230200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
152240200423               MOVE PLACEMENT-DATE OF TRANS
152250200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
152260200423               MOVE TRANS-NO       OF TRANS
152270200423                               TO TRANS-NO OF TRANS-CHARGES
152280200423               MOVE WS-FEDERAL-CLAWBACK
152290200423                               TO CHARGE OF TRANS-CHARGES
152300200423               MOVE 0
152310200423                               TO RATE OF TRANS-CHARGES
152320200423               MOVE "FEDC"     TO DEDUCTION-CODE OF TRANS-CHARGES
152330200423               IF  WRITE-FEDCLW = "W"
152340200423                 WRITE TRANS-CHARGES-REC
152350200423                       INVALID KEY
152360200423                           CONTINUE
152370200423                   END-WRITE
152380200423               ELSE
152390200423                 REWRITE TRANS-CHARGES-REC
152400200423                       INVALID KEY
152410200423                           CONTINUE
152420200423                   END-REWRITE
152430200423               END-IF
152440200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
152450200423                 MOVE "FEDERAL CLAWBACK" TO WS-FILE-STATUS-FILE-NAME
15246020042358714            SET lncc_Err042  TO  TRUE
152470200423                 PERFORM LOG-FILE-STATUS
152480200423               END-IF
152490200423             END-IF
152500200423
152510200423170676       IF lncc_ClawbackAdjusted
152520200423  |
152530200423  |              INITIALIZE li_FXUPDCLW-Pl-Dte,
152540200423  |                         li_FXUPDCLW-Trn-No,
152550200423  |                         li_FXUPDCLW-Ut-Pr
152560200423  |
152570200423  |
152580200423  |              MOVE PLACEMENT-DATE OF TRANS TO
152590200423  |              li_FXUPDCLW-Pl-Dte
152600200423  |
152610200423  |              MOVE TRANS-NO OF TRANS TO
152620200423  |              li_FXUPDCLW-Trn-No
152630200423  |
152640200423  |              MOVE UNIT-PRICE OF TRANS TO
152650200423  |              li_FXUPDCLW-Ut-Pr
152660200423  |
152670200423  |
152680200423  |             CALL "FXUPDCLW"  USING li_FXUPDCLW-Pl-Dte
152690200423  |                                    li_FXUPDCLW-Trn-No
152700200423  |                                    li_FXUPDCLW-Ut-Pr
152710200423  |                                    WS-FEDERAL-CLAWBACK
152720200423170676       END-IF
152730200423      *Provincial clawback
152740200423             IF WS-PROVINCIAL-CLAWBACK   IS NOT EQUAL 0
152750200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
152760200423               MOVE PLACEMENT-DATE OF TRANS
152770200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
152780200423               MOVE TRANS-NO       OF TRANS
152790200423                               TO TRANS-NO OF TRANS-CHARGES
152800200423               MOVE WS-PROVINCIAL-CLAWBACK
152810200423                               TO CHARGE OF TRANS-CHARGES
152820200423               MOVE 0
152830200423                               TO RATE OF TRANS-CHARGES
152840200423               MOVE "PRVC"     TO DEDUCTION-CODE OF TRANS-CHARGES
152850200423               IF  WRITE-PRVCLW = "W"
152860200423                 WRITE TRANS-CHARGES-REC
152870200423                       INVALID KEY
152880200423                           CONTINUE
152890200423                   END-WRITE
152900200423               ELSE
152910200423                 REWRITE TRANS-CHARGES-REC
152920200423                       INVALID KEY
152930200423                           CONTINUE
152940200423                   END-REWRITE
152950200423               END-IF
152960200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
152970200423                 MOVE "PROVINCIAL CLAWBACK" TO WS-FILE-STATUS-FILE-NAME
15298020042358714            SET lncc_Err043  TO  TRUE
152990200423                 PERFORM LOG-FILE-STATUS
153000200423               END-IF
153010200423             END-IF
153020200423
153030200423      *RFS 14380 BEGIN
153040200423      *ERF Charge
153050200423
153060200423             IF WS-ERF-CHARGE         IS NOT EQUAL 0
153070200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
153080200423               MOVE PLACEMENT-DATE OF TRANS
153090200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
153100200423               MOVE TRANS-NO       OF TRANS
153110200423                               TO TRANS-NO OF TRANS-CHARGES
153120200423               MOVE WS-ERF-CHARGE
153130200423                               TO CHARGE OF TRANS-CHARGES
153140200423               MOVE 0
153150200423                               TO RATE OF TRANS-CHARGES
153160200423               MOVE "ERED"     TO DEDUCTION-CODE OF TRANS-CHARGES
153170200423               IF  WRITE-ERF = "W"
153180200423                 WRITE TRANS-CHARGES-REC
153190200423                       INVALID KEY
153200200423                           CONTINUE
153210200423                   END-WRITE
153220200423               ELSE
153230200423                 REWRITE TRANS-CHARGES-REC
153240200423                       INVALID KEY
153250200423                           CONTINUE
153260200423                   END-REWRITE
153270200423               END-IF
153280200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
153290200423                 MOVE "ERF CHARGE" TO WS-FILE-STATUS-FILE-NAME
15330020042358714            SET lncc_Err044  TO  TRUE
153310200423                 PERFORM LOG-FILE-STATUS
153320200423               END-IF
153330200423             END-IF
153340200423      *RFS 14380 END
153350200423      *RFS 139288BEGIN
153360200423      *Insurance Charge
153370200423
153380200423             IF WS-INSURANCE-FEE      IS NOT EQUAL 0
153390200423               INITIALIZE MFATRNCHP OF TRANS-CHARGES
153400200423               MOVE PLACEMENT-DATE OF TRANS
153410200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
153420200423               MOVE TRANS-NO       OF TRANS
153430200423                               TO TRANS-NO OF TRANS-CHARGES
153440200423               MOVE WS-INSURANCE-FEE
153450200423                               TO CHARGE OF TRANS-CHARGES
153460200423               MOVE 0
153470200423                               TO RATE OF TRANS-CHARGES
153480200423               MOVE "ANIN"     TO DEDUCTION-CODE OF TRANS-CHARGES
153490200423               IF  WRITE-INSURANCE-FEE = "W"
153500200423                 WRITE TRANS-CHARGES-REC
153510200423                       INVALID KEY
153520200423                           CONTINUE
153530200423                   END-WRITE
153540200423               ELSE
153550200423                 REWRITE TRANS-CHARGES-REC
153560200423                       INVALID KEY
153570200423                           CONTINUE
153580200423                   END-REWRITE
153590200423               END-IF
153600200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
153610200423                 MOVE "INSURANCE FEE" TO WS-FILE-STATUS-FILE-NAME
153620200423                 SET lncc_Err307  TO  TRUE
153630200423                 PERFORM LOG-FILE-STATUS
153640200423               END-IF
153650200423             END-IF
153660200423      *RFS 139288END
153670200423      *CDSC Deduction
153680200423
153690200423             IF WS-CDSC-AMOUNT IS NOT EQUAL 0
153700200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
153710200423               MOVE PLACEMENT-DATE OF TRANS
153720200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
153730200423               MOVE TRANS-NO       OF TRANS
153740200423                               TO TRANS-NO OF TRANS-CHARGES
153750200423               MOVE WS-CDSC-AMOUNT
153760200423                               TO CHARGE OF TRANS-CHARGES
153770200423               MOVE "CDSC"     TO DEDUCTION-CODE OF TRANS-CHARGES
153780200423      * RFS 20515 Start
153790200423               MOVE WS-CDSC-RATE TO RATE OF TRANS-CHARGES
153800200423      * RFS 20515 End
153810200423               IF WRITE-CDSC = "W"
153820200423      * RFS 20515 Start
153830200423      *RFS 15584 - Start
153840200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
153850200423      *RFS 15584 - End
153860200423      * RFS 20515 End
153870200423                 WRITE TRANS-CHARGES-REC
153880200423                       INVALID KEY
153890200423                           CONTINUE
153900200423                   END-WRITE
153910200423               ELSE
153920200423                 REWRITE TRANS-CHARGES-REC
153930200423                       INVALID KEY
153940200423                           CONTINUE
153950200423                   END-REWRITE
153960200423               END-IF
153970200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
153980200423                 MOVE "CDSC CHARGES" TO WS-FILE-STATUS-FILE-NAME
15399020042358714            SET lncc_Err045  TO  TRUE
154000200423                 PERFORM LOG-FILE-STATUS
154010200423               END-IF
154020200423             END-IF
154030200423
154040200423      *DAF  Deduction
154050200423
154060200423             IF WS-DAF-AMOUNT IS NOT EQUAL 0
154070200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
154080200423               MOVE PLACEMENT-DATE OF TRANS
154090200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
154100200423               MOVE TRANS-NO       OF TRANS
154110200423                               TO TRANS-NO OF TRANS-CHARGES
154120200423               MOVE WS-DAF-AMOUNT
154130200423                               TO CHARGE OF TRANS-CHARGES
154140200423               MOVE "DAF "     TO DEDUCTION-CODE OF TRANS-CHARGES
154150200423      *RFS 20515 - Start
154160200423               MOVE WS-DAF-RATE TO RATE OF TRANS-CHARGES
154170200423      *RFS 20515 - End
154180200423               IF WRITE-DAF  = "W"
154190200423      *RFS 20515 - Start
154200200423      *RFS 15584 - Start
154210200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
154220200423      *RFS 15584 - End
154230200423      *RFS 20515 - End
154240200423                 WRITE TRANS-CHARGES-REC
154250200423                       INVALID KEY
154260200423                           CONTINUE
154270200423                   END-WRITE
154280200423               ELSE
154290200423                 REWRITE TRANS-CHARGES-REC
154300200423                       INVALID KEY
154310200423                           CONTINUE
154320200423                   END-REWRITE
154330200423               END-IF
154340200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
154350200423                 MOVE "DAF CHARGES" TO WS-FILE-STATUS-FILE-NAME
15436020042358714            SET lncc_Err046  TO  TRUE
154370200423                 PERFORM LOG-FILE-STATUS
154380200423               END-IF
154390200423             END-IF
154400200423
154410200423      *Redemption Fee Deduction
154420200423
154430200423             IF WS-REDEMPTION-FEE IS NOT EQUAL TO 0
154440200423             AND WRITE-REDEMPTION-FEE IS NOT EQUAL TO " "
154450200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
154460200423               MOVE PLACEMENT-DATE OF TRANS
154470200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
154480200423               MOVE TRANS-NO       OF TRANS
154490200423                               TO TRANS-NO OF TRANS-CHARGES
154500200423               MOVE WS-REDEMPTION-FEE
154510200423                               TO CHARGE OF TRANS-CHARGES
154520200423               MOVE "REDF"     TO DEDUCTION-CODE OF TRANS-CHARGES
154530200423      *RFS 20515 Start
154540200423               MOVE WS-REDF-RATE TO RATE OF TRANS-CHARGES
154550200423      *RFS 20515 End
154560200423               IF WRITE-REDEMPTION-FEE IS EQUAL TO "W"
154570200423      *RFS 20515 Start
154580200423      *RFS 15584 - Start
154590200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
154600200423      *RFS 15584 - End
154610200423      *RFS 20515 End
154620200423                 WRITE TRANS-CHARGES-REC
154630200423                       INVALID KEY
154640200423                           CONTINUE
154650200423                   END-WRITE
154660200423               ELSE
154670200423                 REWRITE TRANS-CHARGES-REC
154680200423                       INVALID KEY
154690200423                           CONTINUE
154700200423                   END-REWRITE
154710200423               END-IF
154720200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
154730200423                 MOVE "REDEM FEE CHG" TO WS-FILE-STATUS-FILE-NAME
15474020042358714            SET lncc_Err047  TO  TRUE
154750200423                 PERFORM LOG-FILE-STATUS
154760200423               END-IF
154770200423             END-IF
154780200423
154790200423      *RFS 7721  BEGIN
154800200423             IF  SWO-TRANSACTION
154810200423             AND WS-ASL-REDF IS NOT EQUAL TO 0
154820200423             AND WS-ASL-FLAG EQUAL TO "C"
154830200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
154840200423               MOVE PLACEMENT-DATE OF TRANS
154850200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
154860200423               MOVE TRANS-NO       OF TRANS
154870200423                               TO TRANS-NO OF TRANS-CHARGES
154880200423               MOVE "REDF"     TO DEDUCTION-CODE OF TRANS-CHARGES
154890200423               READ TRANS-CHARGES WITH NO LOCK
154900200423                 INVALID KEY
154910200423                   MOVE PLACEMENT-DATE OF TRANS
154920200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
154930200423                   MOVE TRANS-NO       OF TRANS
154940200423                               TO TRANS-NO OF TRANS-CHARGES
154950200423                   MOVE "REDF"     TO DEDUCTION-CODE OF TRANS-CHARGES
154960200423                   MOVE WS-ASL-REDF TO CHARGE OF TRANS-CHARGES
154970200423                   MOVE WS-ASL-REDF-RATE TO RATE OF TRANS-CHARGES
154980200423                   WRITE TRANS-CHARGES-REC
154990200423                       INVALID KEY
155000200423                           CONTINUE
155010200423                   END-WRITE
155020200423                 NOT INVALID KEY
155030200423                   MOVE WS-ASL-REDF TO CHARGE OF TRANS-CHARGES
155040200423                   MOVE WS-ASL-REDF-RATE TO RATE OF TRANS-CHARGES
155050200423                   REWRITE TRANS-CHARGES-REC
155060200423                       INVALID KEY
155070200423                           CONTINUE
155080200423                   END-REWRITE
155090200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
155100200423                 MOVE "REDEM FEE CHG" TO WS-FILE-STATUS-FILE-NAME
15511020042358714            SET lncc_Err048  TO  TRUE
155120200423                 PERFORM LOG-FILE-STATUS
155130200423               END-IF
155140200423               MOVE 0 TO WS-ASL-REDF
155150200423             END-IF
155160200423      *RFS 7721  END
155170200423
155180200423      *HH REDEMPTION FEE
155190200423
155200200423             IF WS-HH-RED-AMT IS NOT EQUAL TO 0
155210200423             AND WRITE-HRDF-FEE IS NOT EQUAL TO " "
155220200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
155230200423               MOVE PLACEMENT-DATE OF TRANS
155240200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
155250200423               MOVE TRANS-NO       OF TRANS
155260200423                               TO TRANS-NO OF TRANS-CHARGES
155270200423               MOVE WS-HH-RED-AMT
155280200423                               TO CHARGE OF TRANS-CHARGES
155290200423               MOVE "HRDF"     TO DEDUCTION-CODE OF TRANS-CHARGES
155300200423      *RFS 20515 Start
155310200423               MOVE WS-HRDF-RATE TO RATE OF TRANS-CHARGES
155320200423      *RFS 20515 End
155330200423               IF WRITE-HRDF-FEE IS EQUAL TO "W"
155340200423      *RFS 20515 Start
155350200423      *RFS 15584 - Start
155360200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
155370200423      *RFS 15584 - End
155380200423      *RFS 20515 End
155390200423                 WRITE TRANS-CHARGES-REC
155400200423                       INVALID KEY
155410200423                           CONTINUE
155420200423                   END-WRITE
155430200423               ELSE
155440200423                 REWRITE TRANS-CHARGES-REC
155450200423                       INVALID KEY
155460200423                           CONTINUE
155470200423                   END-REWRITE
155480200423               END-IF
155490200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
155500200423                 MOVE "HH RED FEE CHG" TO WS-FILE-STATUS-FILE-NAME
15551020042358714            SET lncc_Err049  TO  TRUE
155520200423                 PERFORM LOG-FILE-STATUS
155530200423               END-IF
155540200423             END-IF
155550200423
155560200423      *REPMT REDEMPTION FEE
155570200423
155580200423             IF WSA-REPMT-RED-FEE  IS NOT EQUAL TO 0
155590200423             AND WRITE-REPMT-RED-FEE IS NOT EQUAL TO " "
155600200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
155610200423               MOVE PLACEMENT-DATE OF TRANS
155620200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
155630200423               MOVE TRANS-NO       OF TRANS
155640200423                               TO TRANS-NO OF TRANS-CHARGES
155650200423               MOVE WSA-REPMT-RED-FEE
155660200423                               TO CHARGE OF TRANS-CHARGES
155670200423               MOVE "RRPA"     TO DEDUCTION-CODE OF TRANS-CHARGES
155680200423      *RFS 20515 - Start
155690200423                 MOVE 0        TO RATE OF TRANS-CHARGES
155700200423      *RFS 20515 - End
155710200423               IF WRITE-REPMT-RED-FEE IS EQUAL TO "W"
155720200423      *RFS 20515 - Start
155730200423      *RFS 15584 - Start
155740200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
155750200423      *RFS 15584 - End
155760200423      *RFS 20515 - End
155770200423                 WRITE TRANS-CHARGES-REC
155780200423                       INVALID KEY
155790200423                           CONTINUE
155800200423                   END-WRITE
155810200423               ELSE
155820200423                 REWRITE TRANS-CHARGES-REC
155830200423                       INVALID KEY
155840200423                           CONTINUE
155850200423                   END-REWRITE
155860200423               END-IF
155870200423
155880200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
155890200423                 MOVE "ERF CHG" TO WS-FILE-STATUS-FILE-NAME
15590020042358714            SET lncc_Err050  TO  TRUE
155910200423                 PERFORM LOG-FILE-STATUS
155920200423               END-IF
155930200423             END-IF
155940200423
155950200423      *REDEMPTION PENALTY
155960200423
155970200423             IF WSA-RED-PENALTY IS NOT EQUAL TO 0
155980200423             AND WRITE-RED-PENALTY   IS NOT EQUAL TO " "
155990200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
156000200423               MOVE PLACEMENT-DATE OF TRANS
156010200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
156020200423               MOVE TRANS-NO       OF TRANS
156030200423                               TO TRANS-NO OF TRANS-CHARGES
156040200423               MOVE WSA-RED-PENALTY
156050200423                               TO CHARGE OF TRANS-CHARGES
156060200423               MOVE "RPTY"     TO DEDUCTION-CODE OF TRANS-CHARGES
156070200423      *RFS 20515 - Start
156080200423                 MOVE 0        TO RATE OF TRANS-CHARGES
156090200423      *RFS 20515 - End
156100200423               IF WRITE-RED-PENALTY IS EQUAL TO "W"
156110200423      *RFS 20515 - Start
156120200423      *RFS 15584 - Start
156130200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
156140200423      *RFS 15584 - End
156150200423      *RFS 20515 - End
156160200423                 WRITE TRANS-CHARGES-REC
156170200423                       INVALID KEY
156180200423                           CONTINUE
156190200423                   END-WRITE
156200200423               ELSE
156210200423                 REWRITE TRANS-CHARGES-REC
156220200423                       INVALID KEY
156230200423                           CONTINUE
156240200423                   END-REWRITE
156250200423               END-IF
156260200423
156270200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
156280200423                 MOVE "PTY CHG" TO WS-FILE-STATUS-FILE-NAME
15629020042358714            SET lncc_Err051  TO  TRUE
156300200423                 PERFORM LOG-FILE-STATUS
156310200423               END-IF
156320200423             END-IF
156330200423
156340200423      *GST  Deduction
156350200423
156360200423             IF WS-GST-AMOUNT IS NOT EQUAL 0
156370200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
156380200423               MOVE PLACEMENT-DATE OF TRANS
156390200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
156400200423               MOVE TRANS-NO       OF TRANS
156410200423                               TO TRANS-NO OF TRANS-CHARGES
156420200423               MOVE WS-GST-AMOUNT
156430200423                               TO CHARGE OF TRANS-CHARGES
156440200423               MOVE "GST "     TO DEDUCTION-CODE OF TRANS-CHARGES
156450200423      *RFS 20515 - Start
156460200423               MOVE WS-GST-RATE TO RATE OF TRANS-CHARGES
156470200423      *RFS 20515 - End
156480200423               IF WRITE-GST  = "W"
156490200423      *RFS 20515 - Start
156500200423      *RFS 15584 - Start
156510200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
156520200423      *RFS 15584 - End
156530200423      *RFS 20515 - End
156540200423                 WRITE TRANS-CHARGES-REC
156550200423                       INVALID KEY
156560200423                           CONTINUE
156570200423                   END-WRITE
156580200423               ELSE
156590200423                 REWRITE TRANS-CHARGES-REC
156600200423                       INVALID KEY
156610200423                           CONTINUE
156620200423                   END-REWRITE
156630200423               END-IF
156640200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
156650200423                 MOVE "GST CHARGES" TO WS-FILE-STATUS-FILE-NAME
15666020042358714            SET lncc_Err052  TO  TRUE
156670200423                 PERFORM LOG-FILE-STATUS
156680200423               END-IF
156690200423             END-IF.
156700200423      *PST  Deduction
156710200423             IF WS-PST-AMOUNT IS NOT EQUAL 0
156720200423137579         INITIALIZE MFATRNCHP OF TRANS-CHARGES
156730200423               MOVE PLACEMENT-DATE OF TRANS
156740200423                               TO PLACEMENT-DATE OF TRANS-CHARGES
156750200423               MOVE TRANS-NO       OF TRANS
156760200423                               TO TRANS-NO OF TRANS-CHARGES
156770200423               MOVE WS-PST-AMOUNT
156780200423                               TO CHARGE OF TRANS-CHARGES
156790200423               MOVE "PST "     TO DEDUCTION-CODE OF TRANS-CHARGES
156800200423      *RFS 20515 - Start
156810200423               MOVE WS-PST-RATE TO RATE OF TRANS-CHARGES
156820200423      *RFS 20515 - End
156830200423               IF WRITE-PST  = "W"
156840200423      *RFS 20515 - Start
156850200423      *RFS 15584 - Start
156860200423      *          MOVE 0        TO RATE OF TRANS-CHARGES
156870200423      *RFS 15584 - End
156880200423      *RFS 20515 - End
156890200423                 WRITE TRANS-CHARGES-REC
156900200423                       INVALID KEY
156910200423                           CONTINUE
156920200423                   END-WRITE
156930200423               ELSE
156940200423                 REWRITE TRANS-CHARGES-REC
156950200423                       INVALID KEY
156960200423                           CONTINUE
156970200423                   END-REWRITE
156980200423               END-IF
156990200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
157000200423                 MOVE "PST CHARGES" TO WS-FILE-STATUS-FILE-NAME
15701020042358714            SET lncc_Err053  TO  TRUE
157020200423                 PERFORM LOG-FILE-STATUS
157030200423               END-IF
157040200423             END-IF.
157050200423
157060200423      *Write old CDSC reduction record
157070200423
157080200423           IF WRITE-ACCT-INV-DIST-ACCUM IS EQUAL TO "W" OR "R"
157090200423             MOVE PLACEMENT-DATE OF TRANS
157100200423                               TO PLACEMENT-DATE
157110200423                               OF TRANS-OLD-CDSC-REDUCTION
157120200423             MOVE TRANS-NO       OF TRANS
157130200423                               TO TRANS-NO
157140200423                               OF TRANS-OLD-CDSC-REDUCTION
157150200423             WRITE TRANS-OLD-CDSC-REDUCTION-REC
157160200423                   INVALID KEY
157170200423                       CONTINUE
157180200423               END-WRITE
157190200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
157200200423               MOVE "OLD CDSC REDUCTION" TO WS-FILE-STATUS-FILE-NAME
15721020042358714          SET lncc_Err054  TO  TRUE
157220200423               PERFORM LOG-FILE-STATUS
157230200423             END-IF
157240200423           END-IF.
157250200423
157260200423
157270200423      *Update asset allocation header
157280200423
157290200423           IF WRITE-ALLOCATION-HEADER IS EQUAL TO "R"
157300200423             IF HISTORY
157310200423               ADD 1             TO LAST-ALLOC-PROCESSED
157320200423             END-IF
157330200423             IF LAST-ALLOC-PROCESSED OF
157340200423             ASSET-ALLOCATION-HEADER IS EQUAL TOTAL-ALLOC-TO-PROCESS
157350200423             OF ASSET-ALLOCATION-HEADER
157360200423               MOVE "C"        TO ALLOCATION-STATUS-CODE
157370200423                               OF ASSET-ALLOCATION-HEADER
157380200423             END-IF
157390200423             REWRITE ASSET-ALLOCATION-HEADER-REC
157400200423                   INVALID KEY
157410200423                       CONTINUE
157420200423               END-REWRITE
157430200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
157440200423               MOVE "ASS ALLOC HD" TO WS-FILE-STATUS-FILE-NAME
15745020042358714          SET lncc_Err055  TO  TRUE
157460200423               PERFORM LOG-FILE-STATUS
157470200423             END-IF
157480200423           END-IF.
157490200423
157500200423       REU-0050.
157510200423      * RFS17180 - Begin
157520200423           IF WS-SET-TO-ACTIVE = LT-Y
157530200423             PERFORM SET-INVESTMENT-TO-ACTIVE
157540200423           END-IF
157550200423      * RFS17180 - End
157560200423      *Write account investment
157570200423
157580200423      * RFS23020 - Begin
157590200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "W"
157600200423              IF WS-EDIT-AAH-AADSOP     = "Y" AND
157610200423                 WS-ASSET-ALLOC-HDR-FND = "Y" AND
157620200423                 PURCHASE-TRANSACTION         AND
157630200423                 PRODUCT-TYPE-RULE  OF PRODUCT-TYPE-CODES = "4"
157640200423                 EVALUATE PAYMENT-TYPE-CODE OF ACCOUNT-INVESTMENT
157650200423                   WHEN "C"
157660200423                       PERFORM UPD-INVESTMENT-DISTRIB-CHEQUE
157670200423                   WHEN "E"
157680200423                       PERFORM UPD-INVESTMENT-DISTRIB-EFT
157690200423                   WHEN "R"
157700200423                       PERFORM UPD-ACCOUNT-INVESTMENT-DSRP
157710200423                 END-EVALUATE
157720200423              END-IF
157730200423           END-IF.
157740200423      * RFS23020 - End
157750200423
157760200423      * RFS42278 - Begin
157770200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "W"
157780200423              IF lb_LinkNoteSeton         AND
157790200423                 lb_LinkNoteYes
157800200423                 PERFORM UPD-ACCOUNT-INV-MATURITY
157810200423              END-IF
157820200423           END-IF.
157830200423      * RFS42278 - End
157840200423
157850200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "W"
157860200423             WRITE ACCOUNT-INVESTMENT-REC
157870200423                   INVALID KEY
157880200423                       CONTINUE
157890200423               END-WRITE
157900200423
157910200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
157920200423               MOVE "ACCOUNT-INVESTMENT" TO WS-FILE-STATUS-FILE-NAME
15793020042358714          SET lncc_Err056  TO  TRUE
157940200423               PERFORM LOG-FILE-STATUS
157950200423             END-IF
157960200423           END-IF.
157970200423
157980200423
157990200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "R"
158000200423             REWRITE ACCOUNT-INVESTMENT-REC
158010200423                   INVALID KEY
158020200423                       CONTINUE
158030200423               END-REWRITE
158040200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
158050200423               MOVE "ACCOUNT-INVESTMENT" TO WS-FILE-STATUS-FILE-NAME
15806020042358714          SET lncc_Err057  TO  TRUE
158070200423               PERFORM LOG-FILE-STATUS
158080200423             END-IF
158090200423           END-IF.
158100200423
158110200423      * RFS23802 - Begin
158120200423           IF WS-DEL-ACTIVE-AAP = LT-Y
158130200423      * RFS25821 - Begin
158140200423              AND NOT WS-SET-TO-ACTIVE
158150200423      * RFS25821 - End
158160200423              PERFORM DELETE-ACTIVE-AAP-STATUS
158170200423           END-IF
158180200423      * RFS23802 - End
158190200423
158200200423      *Write account investment distrib summary
158210200423
158220200423           IF WRITE-ACCT-INV-DIST-ACCUM IS EQUAL TO "W"
158230200423             WRITE ACCT-INVEST-ACCUM-DIST-REC
158240200423                   INVALID KEY
158250200423                       CONTINUE
158260200423               END-WRITE
158270200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
158280200423               MOVE "ACCT DIST SUMMARY " TO WS-FILE-STATUS-FILE-NAME
15829020042358714          SET lncc_Err058  TO  TRUE
158300200423               PERFORM LOG-FILE-STATUS
158310200423             END-IF
158320200423           END-IF.
158330200423
158340200423           IF WRITE-ACCT-INV-DIST-ACCUM IS EQUAL TO "R"
158350200423             REWRITE ACCT-INVEST-ACCUM-DIST-REC
158360200423                   INVALID KEY
158370200423                       CONTINUE
158380200423               END-REWRITE
158390200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
158400200423               MOVE "ACCT DIST SUMMARY " TO WS-FILE-STATUS-FILE-NAME
15841020042358714          SET lncc_Err059  TO  TRUE
158420200423               PERFORM LOG-FILE-STATUS
158430200423             END-IF
158440200423           END-IF.
158450200423
158460200423      *Write account investment accruals
158470200423
158480200423           IF WRITE-ACCOUNT-INV-ACCRUALS IS EQUAL TO "W"
158490200423             WRITE ACCOUNT-INV-ACCRUALS-REC
158500200423                   INVALID KEY
158510200423                       CONTINUE
158520200423               END-WRITE
158530200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
158540200423               MOVE "ACCT INV ACCRUALS " TO WS-FILE-STATUS-FILE-NAME
15855020042358714          SET lncc_Err060  TO  TRUE
158560200423               PERFORM LOG-FILE-STATUS
158570200423             END-IF
158580200423           END-IF.
158590200423
158600200423           IF WRITE-ACCOUNT-INV-ACCRUALS IS EQUAL TO "R"
158610200423             REWRITE ACCOUNT-INV-ACCRUALS-REC
158620200423                   INVALID KEY
158630200423                       CONTINUE
158640200423               END-REWRITE
158650200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
158660200423               MOVE "ACCT INV ACCRUALS " TO WS-FILE-STATUS-FILE-NAME
15867020042358714          SET lncc_Err061  TO  TRUE
158680200423               PERFORM LOG-FILE-STATUS
158690200423             END-IF
158700200423           END-IF.
158710200423
158720200423122815     PERFORM CALL-FXACCACB.
158730200423      *Update GIC int adjustment details
158740200423       REU-0080.
158750200423
158760200423           IF NOT GIC-INVESTMENT
158770200423      *RFS119972 - Start
158780200423              OR  (GIC-INVESTMENT AND SWITCH-IN-TRANSACTION AND
158790200423                   Pc_CertiFlag = "Y")
158800200423      *RFS119972 - End
158810200423             GO TO REU-0084
158820200423           END-IF.
158830200423
158840200423           IF WS-INTEREST-GENERATED IS NOT EQUAL "2"
158850200423             GO TO REU-0082
158860200423           END-IF.
158870200423
158880200423           MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
158890200423                             TO CERTIFICATE-ID-NO
158900200423                             OF GIC-INT-ADJUST-REASON-DETAILS.
158910200423           MOVE ZEROES       TO EFFECTIV-DATE
158920200423                             OF GIC-INT-ADJUST-REASON-DETAILS.
158930200423           MOVE LOW-VALUES   TO INT-ADJUSTMENT-REASON-CODE
158940200423                             OF GIC-INT-ADJUST-REASON-DETAILS.
158950200423           START GIC-INT-ADJUST-REASON-DETAILS
158960200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
158970200423           INVALID KEY
158980200423             GO TO REU-0082
158990200423           END-START.
159000200423
159010200423       REU-0081.
159020200423
159030200423           READ GIC-INT-ADJUST-REASON-DETAILS NEXT RECORD
159040200423           AT END
159050200423             GO TO REU-0082
159060200423           END-READ.
159070200423
159080200423           IF CERTIFICATE-ID-NO OF GIC-INT-ADJUST-REASON-DETAILS
159090200423           IS NOT EQUAL CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
159100200423             GO TO REU-0082
159110200423           END-IF.
159120200423
159130200423           IF PLACEMENT-DATE OF GIC-INT-ADJUST-REASON-DETAILS
159140200423           IS NOT EQUAL 0
159150200423             GO TO REU-0081
159160200423           END-IF.
159170200423      * RFS40418 - Begin: Update through new declared table
159180200423      * -------------------------------------------------------------
159190200423      *    MOVE PLACEMENT-DATE OF TRANS
159200200423      *                      TO PLACEMENT-DATE
159210200423      *                      OF GIC-INT-ADJUST-REASON-DETAILS.
159220200423      *    MOVE TRANS-NO OF TRANS
159230200423      *                      TO TRANS-NO
159240200423      *                      OF GIC-INT-ADJUST-REASON-DETAILS.
159250200423      *    REWRITE GIC-INT-ADJUST-REASON-DETAIL-R
159260200423      *    INVALID KEY
159270200423      *      CONTINUE
159280200423      *    END-REWRITE.
159290200423      * -------------------------------------------------------------
159300200423           MOVE GIC-INT-ADJUST-REASON-DETAIL-R TO
159310200423                               GIC-INT-ADJUST-REASON-DETUPD-R
159320200423           READ GIC-INT-ADJUST-REASON-DETUPD
159330200423             INVALID KEY
159340200423               CONTINUE
159350200423             NOT INVALID KEY
159360200423               MOVE PLACEMENT-DATE OF TRANS    TO
159370200423                      PLACEMENT-DATE OF GIC-INT-ADJUST-REASON-DETUPD
159380200423               MOVE TRANS-NO OF TRANS          TO
159390200423                      TRANS-NO       OF GIC-INT-ADJUST-REASON-DETUPD
159400200423               REWRITE GIC-INT-ADJUST-REASON-DETUPD-R
159410200423                 INVALID KEY
159420200423                   CONTINUE
159430200423               END-REWRITE
15944020042358714          IF WS-FILE-STATUS IS NOT EQUAL TO "00"
15945020042358714           MOVE "MFAGIARDP" TO WS-FILE-STATUS-FILE-NAME
15946020042358714           SET lncc_Err062  TO  TRUE
15947020042358714           PERFORM LOG-FILE-STATUS
15948020042358714          END-IF
159490200423           END-READ
159500200423      * RFS40418 - End
159510200423
159520200423           GO TO REU-0081.
159530200423
159540200423       REU-0082.
159550200423      *Write GIC Red Details
159560200423
159570200423           IF WRITE-GIC-RED-DETAILS   IS EQUAL TO "W"
159580200423             WRITE TRANS-GIC-REDEMPTION-DETAILS-R
159590200423                   INVALID KEY
159600200423                       CONTINUE
159610200423               END-WRITE
159620200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
159630200423               MOVE "TXN GIC RD DTLS" TO WS-FILE-STATUS-FILE-NAME
15964020042358714          SET lncc_Err063  TO  TRUE
159650200423               PERFORM LOG-FILE-STATUS
159660200423             END-IF
159670200423           END-IF.
159680200423
159690200423           IF WRITE-GIC-RED-DETAILS   IS EQUAL TO "R"
159700200423             REWRITE TRANS-GIC-REDEMPTION-DETAILS-R
159710200423                   INVALID KEY
159720200423                       CONTINUE
159730200423               END-REWRITE
159740200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
159750200423               MOVE "TXN GIC RD DTLS" TO WS-FILE-STATUS-FILE-NAME
15976020042358714          SET lncc_Err064  TO  TRUE
159770200423               PERFORM LOG-FILE-STATUS
159780200423             END-IF
159790200423           END-IF.
159800200423
159810200423      *Write GIC Certificate
159820200423
159830200423           IF WRITE-GIC-CERT-DETAILS   IS EQUAL TO "W"
159840200423             WRITE GIC-CERTIFICATE-DETAILS-REC
159850200423                   INVALID KEY
159860200423                       CONTINUE
159870200423               END-WRITE
159880200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
159890200423               MOVE "GIC CERT" TO WS-FILE-STATUS-FILE-NAME
15990020042358714          SET lncc_Err065  TO  TRUE
159910200423               PERFORM LOG-FILE-STATUS
159920200423             END-IF
159930200423           END-IF.
159940200423
159950200423           IF WRITE-GIC-CERT-DETAILS   IS EQUAL TO "R"
159960200423             REWRITE GIC-CERTIFICATE-DETAILS-REC
159970200423                   INVALID KEY
159980200423                       CONTINUE
159990200423               END-REWRITE
160000200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160010200423               MOVE "GIC CERT" TO WS-FILE-STATUS-FILE-NAME
16002020042358714          SET lncc_Err066  TO  TRUE
160030200423               PERFORM LOG-FILE-STATUS
160040200423             END-IF
160050200423           END-IF.
160060200423
160070200423      *Write GIC Trans relationship
160080200423
160090200423           IF WRITE-GIC-TRANS-RELATIONSHIP IS EQUAL TO "W"
160100200423             WRITE GIC-TRANS-RELATIONSHIP-PRI-REC
160110200423                   INVALID KEY
160120200423                       CONTINUE
160130200423               END-WRITE
160140200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160150200423               MOVE "GIC TX RELAT" TO WS-FILE-STATUS-FILE-NAME
16016020042358714          SET lncc_Err067  TO  TRUE
160170200423               PERFORM LOG-FILE-STATUS
160180200423             END-IF
160190200423           END-IF.
160200200423
160210200423           IF WRITE-GIC-TRANS-RELATIONSHIP IS EQUAL TO "R"
160220200423             REWRITE GIC-TRANS-RELATIONSHIP-PRI-REC
160230200423                   INVALID KEY
160240200423                       CONTINUE
160250200423               END-REWRITE
160260200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160270200423               MOVE "GIC TX RELAT" TO WS-FILE-STATUS-FILE-NAME
16028020042358714          SET lncc_Err068  TO  TRUE
160290200423               PERFORM LOG-FILE-STATUS
160300200423             END-IF
160310200423           END-IF.
160320200423
160330200423       REU-0084.
160340200423
160350200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS NOT EQUAL "SEG"
160360200423             GO TO REU-0086
160370200423           END-IF.
160380200423
160390200423      * RFS 13306 Begin
160400200423
160410200423      *Write Trans Contract Target
160420200423
160430200423           IF (WRITE-TRANS-CONTRACT-TARGET
160440200423               = "R" OR "R2" OR "W" OR "W2")
160450200423           AND HISTORY
160460200423
160470200423             IF WRITE-TRANS-CONTRACT-TARGET = "W"
160480200423               WRITE TRANS-CONTRACT-TARGET-REC
160490200423               FROM WS-TRANS-CONTRACT-TARGET
160500200423               INVALID KEY
160510200423                 CONTINUE
160520200423               END-WRITE
160530200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160540200423                 MOVE "TRNS CONT TARG" TO WS-FILE-STATUS-FILE-NAME
16055020042358714            SET lncc_Err069  TO  TRUE
160560200423                 PERFORM LOG-FILE-STATUS
160570200423               END-IF
160580200423             END-IF
160590200423
160600200423             IF WRITE-TRANS-CONTRACT-TARGET = "R"
160610200423               REWRITE TRANS-CONTRACT-TARGET-REC
160620200423               FROM WS-TRANS-CONTRACT-TARGET
160630200423               INVALID KEY
160640200423                 CONTINUE
160650200423               END-REWRITE
160660200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160670200423                 MOVE "TRNS CONT TARG" TO WS-FILE-STATUS-FILE-NAME
16068020042358714            SET lncc_Err070  TO  TRUE
160690200423                 PERFORM LOG-FILE-STATUS
160700200423               END-IF
160710200423             END-IF
160720200423
160730200423             IF WRITE-TRANS-CONTRACT-TARGET = "W2"
160740200423                 PERFORM VARYING WS-TCT2 FROM WS-TCT2 BY -1
160750200423                 UNTIL WS-TCT2 <= 0
160760200423
160770200423                     MOVE WS-TRANS-CONTRACT-TARGET-2(WS-TCT2)
160780200423                     TO   WS-TRANS-CONTRACT-TARGET
160790200423
160800200423                     WRITE TRANS-CONTRACT-TARGET-REC
160810200423                     FROM WS-TRANS-CONTRACT-TARGET
160820200423                           INVALID KEY
160830200423                       CONTINUE
160840200423                     END-WRITE
160850200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
160860200423                       MOVE "TRNS CONT TARG"
160870200423                                       TO WS-FILE-STATUS-FILE-NAME
16088020042358714                  SET lncc_Err071  TO  TRUE
160890200423                       PERFORM LOG-FILE-STATUS
160900200423                     END-IF
160910200423                 END-PERFORM
160920200423             END-IF
160930200423
160940200423             IF WRITE-TRANS-CONTRACT-TARGET = "R2"
160950200423                 PERFORM VARYING WS-TCT2 FROM WS-TCT2 BY -1
160960200423                 UNTIL WS-TCT2 <= 0
160970200423
160980200423                     MOVE WS-TRANS-CONTRACT-TARGET-2(WS-TCT2)
160990200423                     TO   WS-TRANS-CONTRACT-TARGET
161000200423
161010200423                     REWRITE TRANS-CONTRACT-TARGET-REC
161020200423                     FROM WS-TRANS-CONTRACT-TARGET
161030200423                     INVALID KEY
161040200423                       CONTINUE
161050200423                     END-REWRITE
161060200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
161070200423                       MOVE "TRNS CONT TARG"
161080200423                                       TO WS-FILE-STATUS-FILE-NAME
16109020042358714                  SET lncc_Err072  TO  TRUE
161100200423                       PERFORM LOG-FILE-STATUS
161110200423                     END-IF
161120200423                 END-PERFORM
161130200423             END-IF
161140200423
161150200423           END-IF.
161160200423
161170200423      *Write trans contract details
161180200423
161190200423           IF (WRITE-TRANS-CONTRACT = "R" OR "R2" OR "W" OR "W2")
161200200423           AND HISTORY
161210200423
16122020042340942        IF pb_GLWBVldInitPurchaseYes AND
16123020042346707         ((pc-GLWACalcRule = lnci_Rule1 AND
16124020042340942           Trade-Date OF Trans >= Eligible-Date
16125020042340942                                  OF Ws-Account-Contract
16126020042346707           ) OR
161270200603      *RFS185169 STARTS
161280200605               (pc-GWACalculationRule = lnci_Rule6 AND
161290200605                Trade-Date OF Trans  >= Eligible-Date
161300200605                                      OF Ws-Account-Benefits
161310200605                ) OR
161320200605      *RFS185169 ENDS
161330200423      *RFS 139007 - START
161340200423      *RFS129478 - Start
161350200423      *RFS 134535 - Starts
16136020042346707 *          pc-GLWACalcRule = lnci_Rule2)
161370200423129478*          pc-GLWACalcRule = lnci_Rule2
161380200423129478*          OR pc-GLWACalcRule = lnci_Rule3)
161390200423                pc-GLWACalcRule = lnci_Rule2 OR
161400200423139007*         pc-GLWACalcRule = lnci_Rule4 OR
161410200423134535*         pc-GLWACalcRule = lnci_Rule5  )
161420200423134535*         pc-GLWACalcRule = lnci_Rule5 OR
161430200423      * RFS 141298 STARTS
161440200423134535*         pc-GLWACalcRule = lnci_Rule3)
161450200423                pc-GWACalculationRule = lnci_Rule3)
161460200423      * RFS 141298 ENDS
161470200423      *RFS 134535 - Ends
161480200423      *RFS129478 - End
161490200423      *RFS 139007 - END
16150020042340942           PERFORM CalculateGWAAmount
16151020042340942           COMPUTE Guar-Withdrawal-Amount OF
16152020042340942                   Ws-Trans-Contract-Details
16153020042340942                 = ln_GWAAmount
16154020042340942        END-IF
161550200423
161560200423             IF (WRITE-TRANS-CONTRACT = "W")
161570200423
161580200423               MOVE UNIT-AMT OF TRANS
161590200423                         TO ORIG-UNIT-BAL
161600200423                         OF WS-TRANS-CONTRACT-DETAILS
161610200423
161620200423               WRITE TRANS-CONTRACT-DETAILS-REC
161630200423               FROM WS-TRANS-CONTRACT-DETAILS
161640200423               INVALID KEY
161650200423                 CONTINUE
161660200423               END-WRITE
161670200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
161680200423                 MOVE "TRANS CONTRACT" TO WS-FILE-STATUS-FILE-NAME
16169020042358714            SET lncc_Err073  TO  TRUE
161700200423                 PERFORM LOG-FILE-STATUS
161710200423               END-IF
161720200423             END-IF
161730200423
161740200423             IF WRITE-TRANS-CONTRACT = "R"
161750200423
161760200423               MOVE UNIT-AMT OF TRANS
161770200423                         TO ORIG-UNIT-BAL
161780200423                         OF WS-TRANS-CONTRACT-DETAILS
161790200423
161800200423               REWRITE TRANS-CONTRACT-DETAILS-REC
161810200423               FROM WS-TRANS-CONTRACT-DETAILS
161820200423               INVALID KEY
161830200423                 CONTINUE
161840200423               END-REWRITE
161850200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
161860200423                 MOVE "TRANS CONTRACT" TO WS-FILE-STATUS-FILE-NAME
16187020042358714            SET lncc_Err074  TO  TRUE
161880200423                 PERFORM LOG-FILE-STATUS
161890200423               END-IF
161900200423             END-IF
161910200423
161920200423
161930200423             IF WRITE-TRANS-CONTRACT = "W2"
161940200423                 MOVE WS-TCD2        TO WS-TCD2-TOTAL
161950200423      * RFS49699 - Array logging logic
161960200423                 IF WS-TCD2          > WS-ARRAY2-MAX-USED
161970200423                     MOVE WS-TCD2                TO WS-ARRAY2-MAX-USED
161980200423                 END-IF
161990200423      * RFS49699 - End
162000200423      *RFS 18686 Begin
162010200423                 MOVE 0            TO WS-SEG-IN-UNITS-ACCUMULATED
162020200423
162030200423      *          PERFORM VARYING WS-TCD2 FROM WS-TCD2 BY -1
162040200423      *          UNTIL WS-TCD2 <= 0
162050200423
162060200423                 PERFORM VARYING WS-TCD2 FROM 1 BY 1
162070200423                 UNTIL WS-TCD2 > WS-TCD2-TOTAL
162080200423                     IF WS-TCD2 IS NOT EQUAL WS-TCD2-TOTAL
162090200423                         COMPUTE ORIG-UNIT-BAL OF
162100200423                         WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2) ROUNDED =
162110200423                             WS-SEG-ARRAY-OUT-PERC(WS-TCD2) *
162120200423                             UNIT-AMT OF TRANS
162130200423                         COMPUTE WS-SEG-IN-UNITS-ACCUMULATED =
162140200423                                 WS-SEG-IN-UNITS-ACCUMULATED
162150200423                                 + ORIG-UNIT-BAL OF
162160200423                                 WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2)
162170200423                     ELSE
162180200423                         COMPUTE ORIG-UNIT-BAL
162190200423                           OF WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2) =
162200200423                           UNIT-AMT OF TRANS
162210200423                         - WS-SEG-IN-UNITS-ACCUMULATED
162220200423                     END-IF
162230200423      *RFS 18686 End
162240200423
162250200423                     MOVE WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2)
162260200423                     TO   WS-TRANS-CONTRACT-DETAILS
162270200423
162280200423                     WRITE TRANS-CONTRACT-DETAILS-REC
162290200423                     FROM WS-TRANS-CONTRACT-DETAILS
162300200423                           INVALID KEY
162310200423                       CONTINUE
162320200423                     END-WRITE
162330200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
162340200423                       MOVE "TRNS CON DTL 2"
162350200423                                       TO WS-FILE-STATUS-FILE-NAME
16236020042358714                  SET lncc_Err075  TO  TRUE
162370200423                       PERFORM LOG-FILE-STATUS
162380200423                     END-IF
162390200423                 END-PERFORM
162400200423             END-IF
162410200423
162420200423             IF WRITE-TRANS-CONTRACT = "R2"
162430200423                 MOVE WS-TCD2        TO WS-TCD2-TOTAL
162440200423      * RFS49699 - Array logging logic
162450200423                 IF WS-TCD2          > WS-ARRAY2-MAX-USED
162460200423                     MOVE WS-TCD2                TO WS-ARRAY2-MAX-USED
162470200423                 END-IF
162480200423      * RFS49699 - End
162490200423      *RFS 18686 Begin
162500200423                 MOVE 0            TO WS-SEG-IN-UNITS-ACCUMULATED
162510200423
162520200423      *          PERFORM VARYING WS-TCD2 FROM WS-TCD2 BY -1
162530200423      *          UNTIL WS-TCD2 <= 0
162540200423
162550200423                 PERFORM VARYING WS-TCD2 FROM 1 BY 1
162560200423                 UNTIL WS-TCD2 > WS-TCD2-TOTAL
162570200423
162580200423                     IF WS-TCD2 IS NOT EQUAL WS-TCD2-TOTAL
162590200423                         COMPUTE WS-SEG-IN-UNITS ROUNDED =
162600200423                            (WS-SEG-ARRAY-OUT-PERC(WS-TCD2) *
162610200423                             UNIT-AMT OF TRANS)
162620200423                         COMPUTE ORIG-UNIT-BAL OF
162630200423                           WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2) =
162640200423                           ORIG-UNIT-BAL OF
162650200423                           WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2) +
162660200423                           WS-SEG-IN-UNITS
162670200423                         COMPUTE WS-SEG-IN-UNITS-ACCUMULATED =
162680200423                                 WS-SEG-IN-UNITS-ACCUMULATED
162690200423                                 + ORIG-UNIT-BAL OF
162700200423                                 WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2)
162710200423                     ELSE
162720200423                         COMPUTE ORIG-UNIT-BAL
162730200423                           OF WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2) =
162740200423                           UNIT-AMT OF TRANS
162750200423                         - WS-SEG-IN-UNITS-ACCUMULATED
162760200423                     END-IF
162770200423      *RFS 18686 End
162780200423
162790200423                     MOVE WS-TRANS-CONTRACT-DETAILS-2(WS-TCD2)
162800200423                     TO   WS-TRANS-CONTRACT-DETAILS
162810200423
162820200423                     REWRITE TRANS-CONTRACT-DETAILS-REC
162830200423                     FROM WS-TRANS-CONTRACT-DETAILS
162840200423                     INVALID KEY
162850200423                       CONTINUE
162860200423                     END-REWRITE
162870200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
162880200423                       MOVE "TRNS CON DTL 2"
162890200423                                       TO WS-FILE-STATUS-FILE-NAME
16290020042358714                  SET lncc_Err076  TO  TRUE
162910200423                       PERFORM LOG-FILE-STATUS
162920200423                     END-IF
162930200423                 END-PERFORM
162940200423             END-IF
162950200423
162960200423           END-IF.
162970200423
162980200423      *Write account contract investment
162990200423
163000200423           IF (WRITE-ACCOUNT-CONTRACT-INV = "R" OR "R2" OR "W" OR "W2")
163010200423           AND HISTORY
163020200423
163030200423             IF (WRITE-ACCOUNT-CONTRACT-INV = "W")
163040200423
163050200423               ADD UNIT-AMT OF TRANS
163060200423                         TO CURR-UNIT-BAL
163070200423                         OF WS-ACCOUNT-CONTRACT-INVESTMENT
163080200423
163090200423               WRITE ACCOUNT-CONTRACT-INVEST-REC
163100200423               FROM WS-ACCOUNT-CONTRACT-INVESTMENT
163110200423               INVALID KEY
163120200423                 CONTINUE
163130200423               END-WRITE
163140200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
163150200423                 MOVE "ACCT CONT INV " TO WS-FILE-STATUS-FILE-NAME
16316020042358714            SET lncc_Err077  TO  TRUE
163170200423                 PERFORM LOG-FILE-STATUS
163180200423               END-IF
163190200423             END-IF
163200200423
163210200423             IF (WRITE-ACCOUNT-CONTRACT-INV = "R")
163220200423
163230200423               ADD UNIT-AMT OF TRANS
163240200423                         TO CURR-UNIT-BAL
163250200423                         OF WS-ACCOUNT-CONTRACT-INVESTMENT
163260200423
163270200423               REWRITE ACCOUNT-CONTRACT-INVEST-REC
163280200423               FROM WS-ACCOUNT-CONTRACT-INVESTMENT
163290200423               INVALID KEY
163300200423                 CONTINUE
163310200423               END-REWRITE
163320200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
163330200423                 MOVE "ACCT CONT INV " TO WS-FILE-STATUS-FILE-NAME
16334020042358714            SET lncc_Err078  TO  TRUE
163350200423                 PERFORM LOG-FILE-STATUS
163360200423               END-IF
163370200423             END-IF
163380200423
163390200423      *RFS 15719 Begin
163400200423             IF WRITE-ACCOUNT-CONTRACT-INV = "W2"
163410200423             OR WRITE-ACCOUNT-CONTRACT-INV = "R2"
163420200423                 MOVE WS-ACI2    TO WS-ACI2-TOTAL
163430200423      * RFS49699 - Array logging logic
163440200423                 IF WS-ACI2          > WS-ARRAY3-MAX-USED
163450200423                     MOVE WS-ACI2                TO WS-ARRAY3-MAX-USED
163460200423                 END-IF
163470200423      * RFS49699 - End
163480200423      *RFS 18686 Begin
163490200423                 MOVE 0            TO WS-SEG-IN-UNITS-ACCUMULATED
163500200423
163510200423      *          PERFORM VARYING WS-ACI2 FROM WS-ACI2 BY -1
163520200423      *          UNTIL WS-ACI2 <= 0
163530200423                 PERFORM VARYING WS-ACI2 FROM 1 BY 1
163540200423                 UNTIL WS-ACI2 > WS-ACI2-TOTAL
163550200423                     IF WS-WRITE-REWRITE-ACI2(WS-ACI2) = "W"
163560200423                         IF WS-ACI2 IS NOT EQUAL WS-ACI2-TOTAL
163570200423                             COMPUTE CURR-UNIT-BAL OF
163580200423                             WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
163590200423                             ROUNDED = WS-SEG-ARRAY-OUT-PERC(WS-ACI2) *
163600200423                             UNIT-AMT OF TRANS
163610200423                             COMPUTE WS-SEG-IN-UNITS-ACCUMULATED =
163620200423                             WS-SEG-IN-UNITS-ACCUMULATED
163630200423                             + CURR-UNIT-BAL OF
163640200423                             WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
163650200423                         ELSE
163660200423                             COMPUTE CURR-UNIT-BAL
163670200423                             OF WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2) =
163680200423                             (UNIT-AMT OF TRANS
163690200423                             - WS-SEG-IN-UNITS-ACCUMULATED)
163700200423                         END-IF
163710200423      *RFS 18686 End
163720200423                         MOVE WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
163730200423                         TO   WS-ACCOUNT-CONTRACT-INVESTMENT
163740200423
163750200423                         WRITE ACCOUNT-CONTRACT-INVEST-REC
163760200423                         FROM WS-ACCOUNT-CONTRACT-INVESTMENT
163770200423                               INVALID KEY
163780200423                           CONTINUE
163790200423                         END-WRITE
163800200423                         IF WS-FILE-STATUS IS NOT EQUAL TO "00"
163810200423                           MOVE "ACCT CON INV 2"
163820200423                                           TO WS-FILE-STATUS-FILE-NAME
16383020042358714                      SET lncc_Err079  TO  TRUE
163840200423                           PERFORM LOG-FILE-STATUS
163850200423                         END-IF
163860200423                     ELSE
163870200423      *RFS 18686 Begin
163880200423                         IF WS-ACI2 IS NOT EQUAL WS-ACI2-TOTAL
163890200423                             COMPUTE WS-SEG-IN-UNITS ROUNDED =
163900200423                             (WS-SEG-ARRAY-OUT-PERC(WS-ACI2) *
163910200423                              UNIT-AMT OF TRANS)
163920200423                             COMPUTE CURR-UNIT-BAL OF
163930200423                             WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2) =
163940200423                             CURR-UNIT-BAL OF
163950200423                             WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2) +
163960200423                             WS-SEG-IN-UNITS
163970200423                             COMPUTE WS-SEG-IN-UNITS-ACCUMULATED =
163980200423                             WS-SEG-IN-UNITS-ACCUMULATED
163990200423      *RFS 19058 Begin - Negative units problem fixed
164000200423                             + WS-SEG-IN-UNITS
164010200423      *                      + CURR-UNIT-BAL OF
164020200423      *                      WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
164030200423      *RFS 19058 End
164040200423                         ELSE
164050200423                             COMPUTE CURR-UNIT-BAL
164060200423                             OF WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2) =
164070200423                             CURR-UNIT-BAL
164080200423                             OF WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
164090200423                             + (UNIT-AMT OF TRANS
164100200423                             - WS-SEG-IN-UNITS-ACCUMULATED)
164110200423                         END-IF
164120200423      *RFS 18686 End
164130200423                         MOVE WS-ACCOUNT-CONTRACT-INVEST-2(WS-ACI2)
164140200423                         TO   WS-ACCOUNT-CONTRACT-INVESTMENT
164150200423
164160200423                         REWRITE ACCOUNT-CONTRACT-INVEST-REC
164170200423                         FROM WS-ACCOUNT-CONTRACT-INVESTMENT
164180200423                         INVALID KEY
164190200423                           CONTINUE
164200200423                         END-REWRITE
164210200423                         IF WS-FILE-STATUS IS NOT EQUAL TO "00"
164220200423                           MOVE "ACCT CON INV 2"
164230200423                                           TO WS-FILE-STATUS-FILE-NAME
16424020042358714                      SET lncc_Err080  TO  TRUE
164250200423                           PERFORM LOG-FILE-STATUS
164260200423                         END-IF
164270200423                     END-IF
164280200423                 END-PERFORM
164290200423             END-IF
164300200423
164310200423      *RFS 15719 End
164320200423
164330200423      *Write account contract
164340200423
164350200423           IF (WRITE-ACCOUNT-CONTRACT = "R" OR "R2" OR "W" OR "W2")
164360200423           AND HISTORY
164370200423
164380200423      ***87517 Commented out perform below as being done above **
16439020042356471        IF lc_ModuleSEGSPIAOn
16440020042387517 *         PERFORM CheckIfInvIsSPIAInv
164410200423  |             IF lb_SPIAInvestYes AND
164420200423  |                Investment-Series OF Ws-Account-Contract = SPACES
164430200423  |                MOVE Investment-Series OF INVESTMENT-SEG
164440200423  |                  TO Investment-Series OF Ws-Account-Contract
164450200423  |             END-IF
16446020042356471        END-IF
164470200423
16448020042340942        IF pb_GLWBVldInitPurchaseYes AND
16449020042346707         ((pc-GLWACalcRule = lnci_Rule1 AND
16450020042340942           Trade-Date OF Trans >= Eligible-Date
16451020042340942                                  OF Ws-Account-Contract
16452020042346707           ) OR
164530200605      *RFS185169 STARTS
164540200605               (pc-GWACalculationRule = lnci_Rule6 AND
164550200605                Trade-Date OF Trans  >= Eligible-Date
164560200605                                      OF Ws-Account-Benefits
164570200605                ) OR
164580200605      *RFS185169 ENDS
164590200423      *RFS 134535 - Starts
16460020042346707 *         pc-GLWACalcRule = lnci_Rule2)
164610200423                pc-GLWACalcRule = lnci_Rule2 OR
164620200423141298*         pc-GLWACalcRule = lnci_Rule3)
164630200423141298          pc-GWACalculationRule = lnci_Rule3)
164640200423      *RFS 134535 - Ends
16465020042340942           PERFORM CalculateGWAAmount
16466020042340942           COMPUTE Guar-Withdrawal-Amount OF Ws-Account-Contract
16467020042340942                 = Guar-Withdrawal-Amount OF Ws-Account-Contract
16468020042340942                 + ln_GWAAmount
164690200423147066          SET UPDOriginalLWANo TO TRUE
164700200423      * RFS139007 - Start
164710200423                IF pc-GWACalculationRule = lnci_Rule4
164720200423                   SET pb_DefaultAnnuit TO TRUE
164730200423                   MOVE Account-No OF Trans TO pi_AnnuitAccountNo
164740200423                   CALL "FXACCANUIT" USING pc_AnnuitFlag,
164750200423                                           pi_AnnuitAccountNo,
164760200423                                           pi_AnnuitContractNo,
164770200423                                           pi_AnnSequenceNo,
164780200423                                           pc_AnnuitantStatus,
164790200423                                           pi_DateOfBirth,
164800200423                                           pc_FirstName,
164810200423                                           pc_LastName,
164820200423                                           pi_socialInsuranceNo,
164830200423                                           pc_sex,
164840200423                                           pc_AnnuitReturnCode
164850200423                   IF pi_DateOfBirth > 0
164860200423      *RFS140386 - START
164870200423      *               PERFORM CalcAnnuitantAge
164880200423                      Initialize li_TempDate
164890200423                                 li_AnnuitantAge
164900200423                      MOVE Trade-Date OF TRANS TO li_TempDate
164910200423                      COMPUTE li_TempDateYr    =  li_TempDateYear - 1
164920200423                      MOVE LT-LAST-MMDD        TO li_TempDateMMDD
164930200423                      COMPUTE li_AnnuitantAge  =  (li_TemporaryDate -
164940200423                                          pi_DateOfBirth ) / 10000
164950200423      *RFS140386 - END
164960200423                   ELSE
164970200423                      INITIALIZE li_AnnuitantAge
164980200423                   END-IF
164990200423                   IF  li_AnnuitantAge >= pc-LGWACrossoverAge
165000200423                       COMPUTE Lifetime-Withdrawal-Amount
165010200423                           OF Ws-Account-Contract
165020200423                         = Lifetime-Withdrawal-Amount
165030200423                           OF Ws-Account-Contract
165040200423                         + ln_GWAAmount
165050200423147066                 Set UPDOriginalLWAYes to TRUE
165060200423                   END-IF
165070200423                END-IF
165080200423      * RFS139007 - End
165090200423      * RFS52816 - Begin: increase original-gwa
165100200423      * RFS80602 - Begin: changed the logic to include LIF accounts,
165110200423      *   keep old logic (use lncc_RIFGLWOn) for Mominee-accounts.
165120200423      * ---------------------------------------------------------------
165130200423      *         IF lncc_RIFGLWOn          AND
165140200423      * RFS52816.11 - Begin: put the conditions in brackets
165150200423      *          (RRIF-ACCOUNT            OR
165160200423      *           RRIF-NOMINEE-ACCOUNT)
165170200423      * RFS52816.11 - End
165180200423      * ---------------------------------------------------------------
165190200423                IF (lncc_RIFGLWOn  AND RRIF-NOMINEE-ACCOUNT ) OR
165200200423                  RRIF-ACCOUNT            OR
165210200423                  LIF-ACCOUNT
165220200423      *RFS 104600 - Starts
165230200423                                          OR
165240200423                  ( lncc_NOMRULOn         AND
165250200423                  ( RRIF-NOMINEE-ACCOUNT  OR
165260200423                  LIF-NOMINEE-ACCOUNT ) )
165270200423      *RFS141298 - Begins
165280200423                                          OR
165290200423            pc-GWACalculationRule = lnci_Rule3
165300200423      *RFS144671- Start
165310200423            OR pc-GWACalculationRule = lnci_Rule4
165320200423            OR pc-GWACalculationRule = lnci_Rule5
165330200423      *RFS144671 - End
165340200423      *RFS141298 - Ends
165350200423      * RFS 104600 - Ends
165360200423      * RFS80602 - End
165370200423                 COMPUTE Original-Gwa OF Ws-Account-Contract =
165380200423                        Original-Gwa  OF Ws-Account-Contract
165390200423                      + ln_GWAAmount
165400200423      * RFS137082 - Begin
165410200423147066           If UPDOriginalLWAYes
165420200423                 COMPUTE Prev-Guar-Withdrawal-Amount
165430200423                         OF Ws-Account-Contract =
165440200423                         Prev-Guar-Withdrawal-Amount
165450200423                         OF Ws-Account-Contract +
165460200423      * RFS144671 - Start
165470200423                         ln_GWAAmount
165480200423147066           End-if
165490200423      *                  Lifetime-Withdrawal-Amount
165500200423      *                  OF Ws-Account-Contract
165510200423      * RFS144671 - End
165520200423      * RFS137082 - End
165530200423      * RFS104600 Begin
165540200423                 If lncc_NOMRULOn AND
165550200423                    (RRIF-NOMINEE-ACCOUNT  OR
165560200423                    LIF-NOMINEE-ACCOUNT)
165570200423                    PERFORM Create-Audit-Log
165580200423                 End-If
165590200423      * RFS104600 End
16560020042361637            PERFORM GET-RRIF-MIN-WITHDRAWAL
16561020042386430            IF NOT lncc_RIFGLWOn
165620200423  |                 MOVE Gwa-Rif-Minimum OF Ws-Account-Contract
165630200423  |                   TO ln_MinWithdrawalAmt
16564020042386430            END-IF
16565020042361637            IF Original-Gwa OF Ws-Account-Contract >
165660200423      * RFS80602 - Begin: use new variable for RRIF/LIF
165670200423                    ln_MinWithdrawalAmt
16568020042361637 *             Min-Withdrawal-Amt OF ACCOUNT-RRIF
165690200423      * RFS80602 - End
16570020042361637               MOVE Original-Gwa OF Ws-Account-Contract
16571020042361637                 TO Guar-Withdrawal-Amount OF Ws-Account-Contract
16572020042361637            ELSE
165730200423      * RFS80602 - Begin: use new variable for RRIF/LIF
16574020042361637 *             MOVE Min-Withdrawal-Amt OF ACCOUNT-RRIF
165750200423                    MOVE ln_MinWithdrawalAmt
165760200423      * RFS80602 - End
16577020042361637                 TO Guar-Withdrawal-Amount OF Ws-Account-Contract
16578020042361637            END-IF
165790200423      * RFS137082 - Start
165800200423                 IF  pc-GWACalculationRule = lnci_Rule4
165810200423                 AND li_AnnuitantAge >= pc-LGWACrossoverAge
165820200423                    IF Prev-Guar-Withdrawal-Amount
165830200423                       OF Ws-Account-Contract >
165840200423                       ln_MinWithdrawalAmt
165850200423                       MOVE Prev-Guar-Withdrawal-Amount OF
165860200423                            Ws-Account-Contract
165870200423144671*                  TO Guar-Withdrawal-Amount
165880200423144671                   TO Lifetime-Withdrawal-Amount
165890200423                            OF Ws-Account-Contract
165900200423                    ELSE
165910200423                       MOVE ln_MinWithdrawalAmt
165920200423                         TO Lifetime-Withdrawal-Amount
165930200423                         OF Ws-Account-Contract
165940200423                    END-IF
165950200423                 END-IF
165960200423      * RFS137082 - End
165970200423                END-IF
165980200423      * RFS52816 - End
16599020042340942        END-IF
166000200423
166010200423             IF WRITE-ACCOUNT-CONTRACT = "W"
166020200423               WRITE ACCOUNT-CONTRACT-REC
166030200423               FROM WS-ACCOUNT-CONTRACT
166040200423               INVALID KEY
166050200423                 CONTINUE
166060200423               END-WRITE
166070200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
166080200423                 MOVE "ACCT CONTRACT " TO WS-FILE-STATUS-FILE-NAME
16609020042358714            SET lncc_Err081  TO  TRUE
166100200423                 PERFORM LOG-FILE-STATUS
166110200423               END-IF
166120200423118920         IF pc_MatdateChangeIndicator NOT = SPACES
166130200423107679         PERFORM W-R-UPDATELOG
166140200423118920         END-IF
166150200423      *RFS52779 Starts
166160200423               IF ANNUITANT-TYPE-CODE OF WS-ACCOUNT-CONT-ANNT-JL = "J"
166170200423                WRITE ACCOUNT-CONT-ANNT-REC
166180200423                FROM WS-ACCOUNT-CONT-ANNT-JL
166190200423                INVALID KEY
166200200423                  CONTINUE
166210200423                END-WRITE
166220200423                IF WS-FILE-STATUS IS NOT EQUAL TO "00"
166230200423                  MOVE "ACCT CONTRACT ANNUITANT "
166240200423                                  TO WS-FILE-STATUS-FILE-NAME
16625020042358714             SET lncc_Err082  TO  TRUE
166260200423                  PERFORM LOG-FILE-STATUS
166270200423                END-IF
16628020042350474          END-IF
166290200423      *RFS52779 Ends
166300200423             END-IF
166310200423
166320200423             IF WRITE-ACCOUNT-CONTRACT = "R"
166330200423               REWRITE ACCOUNT-CONTRACT-REC
166340200423               FROM WS-ACCOUNT-CONTRACT
166350200423               INVALID KEY
166360200423                 CONTINUE
166370200423               END-REWRITE
166380200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
166390200423                 MOVE "ACCT CONTRACT " TO WS-FILE-STATUS-FILE-NAME
16640020042358714            SET lncc_Err083  TO  TRUE
166410200423                 PERFORM LOG-FILE-STATUS
166420200423               END-IF
166430200423118920         IF pc_MatdateChangeIndicator NOT = SPACES
166440200423107679         PERFORM W-R-UPDATELOG
166450200423118920         END-IF
166460200423             END-IF
166470200423
166480200423             IF WRITE-ACCOUNT-CONTRACT = "W2"
166490200423                 PERFORM VARYING WS-ACC2 FROM WS-ACC2 BY -1
166500200423                 UNTIL WS-ACC2 <= 0
166510200423
166520200423                     MOVE WS-ACCOUNT-CONTRACT-2(WS-ACC2)
166530200423                     TO   WS-ACCOUNT-CONTRACT
166540200423
166550200423                     WRITE ACCOUNT-CONTRACT-REC
166560200423                     FROM WS-ACCOUNT-CONTRACT
166570200423                           INVALID KEY
166580200423                       CONTINUE
166590200423                     END-WRITE
166600200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
166610200423                       MOVE "ACCT CONT 2   "
166620200423                                       TO WS-FILE-STATUS-FILE-NAME
16663020042358714                  SET lncc_Err084  TO  TRUE
166640200423                       PERFORM LOG-FILE-STATUS
166650200423                     END-IF
166660200423118920         IF pc_MatdateChangeIndicator NOT = SPACES
166670200423107679           PERFORM W-R-UPDATELOG
166680200423118920         END-IF
166690200423                 END-PERFORM
166700200423             END-IF
166710200423
166720200423             IF WRITE-ACCOUNT-CONTRACT = "R2"
166730200423                 PERFORM VARYING WS-ACC2 FROM WS-ACC2 BY -1
166740200423                 UNTIL WS-ACC2 <= 0
166750200423
166760200423                     MOVE WS-ACCOUNT-CONTRACT-2(WS-ACC2)
166770200423                     TO   WS-ACCOUNT-CONTRACT
166780200423
166790200423                     REWRITE ACCOUNT-CONTRACT-REC
166800200423                     FROM WS-ACCOUNT-CONTRACT
166810200423                     INVALID KEY
166820200423                       CONTINUE
166830200423                     END-REWRITE
166840200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
166850200423                       MOVE "ACCT CONT 2   "
166860200423                                       TO WS-FILE-STATUS-FILE-NAME
16687020042358714                  SET lncc_Err085  TO  TRUE
166880200423                       PERFORM LOG-FILE-STATUS
166890200423                     END-IF
166900200423118920              IF  pc_MatdateChangeIndicator NOT = SPACES
166910200423107679               PERFORM W-R-UPDATELOG
166920200423118920              END-IF
166930200423                 END-PERFORM
166940200423             END-IF
166950200423
166960200423           END-IF.
166970200423
166980200423      *RFS185169 Starts
166990200602
167000200602      *Write Account Benefits
167010200602      *-------------COPIED FROM ACCOUNT CONTRACT CODE-------------*
167020200602           IF (WRITE-ACCOUNT-BENEFITS = "W" OR "R")
167030200814186430     AND lc_GlwbInvestment = "Y"
167040200602           AND HISTORY
167050200602
167060200605             IF lc_ModuleSEGSPIAOn
167070200605                IF lb_SPIAInvestYes AND
167080200605                   Investment-Series OF Ws-Account-Benefits = SPACES
167090200605                   MOVE Investment-Series OF INVESTMENT-SEG
167100200605                     TO Investment-Series OF Ws-Account-Benefits
167110200605                END-IF
167120200605             END-IF
167130200602
167140200605             IF pb_GLWBVldInitPurchaseYes AND
167150200605              ((pc-GLWACalcRule = lnci_Rule1 AND
167160200605                Trade-Date OF Trans >= Eligible-Date
167170200605                                       OF Ws-Account-Benefits
167180200605                ) OR
167190200605               (pc-GWACalculationRule = lnci_Rule6 AND
167200200605                Trade-Date OF Trans >= Eligible-Date
167210200605                                       OF Ws-Account-Benefits
167220200605                ) OR
167230200602                pc-GLWACalcRule = lnci_Rule2 OR
167240200605                pc-GWACalculationRule = lnci_Rule3)
167250200605                PERFORM CalculateGWAAmount
167260200605                COMPUTE Guar-Withdrawal-Amount OF Ws-Account-Benefits
167270200605                      = Guar-Withdrawal-Amount OF Ws-Account-Benefits
167280200605                      + ln_GWAAmount
167290200605
167300200602                IF (lncc_RIFGLWOn  AND RRIF-NOMINEE-ACCOUNT ) OR
167310200602                  RRIF-ACCOUNT            OR
167320200602                  LIF-ACCOUNT
167330200602                                          OR
167340200602                  ( lncc_NOMRULOn         AND
167350200602                  ( RRIF-NOMINEE-ACCOUNT  OR
167360200602                  LIF-NOMINEE-ACCOUNT ) )
167370200602                                          OR
167380200605                    pc-GWACalculationRule = lnci_Rule3
167390200605                 OR pc-GWACalculationRule = lnci_Rule4
167400200605                 OR pc-GWACalculationRule = lnci_Rule5
167410200605                 COMPUTE Original-Gwa OF Ws-Account-Benefits =
167420200605                         Original-Gwa OF Ws-Account-Benefits
167430200605                       + ln_GWAAmount
167440200605
167450200605                 IF lncc_NOMRULOn AND
167460200602                    (RRIF-NOMINEE-ACCOUNT  OR
167470200605                     LIF-NOMINEE-ACCOUNT)
167480200605                     PERFORM UpdateAccountBenefitsChangeLog
167490200602                 End-If
167500200605                 PERFORM GET-RRIF-MIN-WITHDRAWAL
167510200605                 IF NOT lncc_RIFGLWOn
167520200605                    MOVE Gwa-Rif-Minimum OF Ws-Account-Benefits
167530200605                      TO ln_MinWithdrawalAmt
167540200605                 END-IF
167550200605                 IF Original-Gwa OF Ws-Account-Benefits >
167560200602                    ln_MinWithdrawalAmt
167570200605                    MOVE Original-Gwa OF Ws-Account-Benefits
167580200605                      TO Guar-Withdrawal-Amount OF Ws-Account-Benefits
167590200605                 ELSE
167600200602                    MOVE ln_MinWithdrawalAmt
167610200605                      TO Guar-Withdrawal-Amount OF Ws-Account-Benefits
167620200605                 END-IF
167630200602                END-IF
167640200814186430        END-IF
167650200605             END-IF.
167660200603      *-------------COPIED FROM ACCOUNT CONTRACT CODE-------------*
167670200602
167680200507           IF WRITE-ACCOUNT-BENEFITS = "W"
167690200814186430         AND lc_GlwbInvestment = "Y"
167700201202110566*    MOVE ZEROES TO MFAACLBENP-ID OF WS-ACCOUNT-BENEFITS
167710200503
167720200814      * RFS186430 - Begin
167730200814      *       INITIALIZE MFAACLBENP OF    ACCOUNT-BENEFITS1-REC
167740200814      *       READ ACCOUNT-BENEFITS1 LAST
167750200814      *         AT END
167760200814      *            MOVE ZEROES TO MFAACLBENP-ID
167770200814      *                        OF ACCOUNT-BENEFITS1-REC
167780200814      *       END-READ
167790200814      *       IF WS-FILE-STATUS IS NOT = "00"
167800200814      *          MOVE "ACCT BENEFITS1 READ LAST"
167810200814      *                     TO WS-FILE-STATUS-FILE-NAME
167820200814      *          SET lncc_Err086  TO  TRUE
167830200814      *          PERFORM LOG-FILE-STATUS
167840200814      *       END-IF
167850200814      *       COMPUTE MFAACLBENP-ID OF WS-ACCOUNT-BENEFITS      =
167860200814      *               MFAACLBENP-ID OF    ACCOUNT-BENEFITS1-REC + 1
167870200814
167880201202110566*       INITIALIZE pc_FXGETMX_TableName
167890201202110566*                  pi_FXGETMX_MaxRowID
167900201202110566*                  pc_FXGETMX_ReturnCde
167910200814
167920201202110566*       MOVE lncc_MFAACLBENP TO pc_FXGETMX_TableName
167930200814
167940201202110566*       CALL "FXGETMAXID" USING pc_FXGETMX_TableName
167950201202110566*                               pi_FXGETMX_MaxRowID
167960201202110566*                               pc_FXGETMX_ReturnCde
167970201202110566*       IF pc_FXGETMX_ReturnCde = "00"
167980201202110566*          COMPUTE MFAACLBENP-ID OF WS-ACCOUNT-BENEFITS =
167990201202110566*                   pi_FXGETMX_MaxRowID + 1
168000201202110566*       END-IF
168010200814      * RFS186430 - End
168020201202      * RFS1105663 - Start
168030201202
168040201202              CALL "FXCRTACBEN" USING WS-ACCOUNT-BENEFITS
168050201202
168060201202      * RFS1105663 - End
168070201202
168080201202110566*       WRITE ACCOUNT-BENEFITS-REC FROM
168090201202110566*          WS-ACCOUNT-BENEFITS
168100201202110566*       INVALID KEY
168110201202110566*          CONTINUE
168120201202110566*       END-WRITE
168130201202110566*       IF WS-FILE-STATUS IS NOT EQUAL TO "00"
168140201202110566*          MOVE "ACCT BENEFITS WRITE"
168150201202110566*                     TO WS-FILE-STATUS-FILE-NAME
168160201202110566*          SET lncc_Err086  TO  TRUE
168170201202110566*           PERFORM LOG-FILE-STATUS
168180201202110566*        END-IF
168190201202             END-IF.
168200200502
168210200423
168220200507           IF WRITE-ACCOUNT-BENEFITS = "R" AND
168230200423              lc_GlwbInvestment = "Y"
168240200423              REWRITE ACCOUNT-BENEFITS-REC FROM
168250200423                   WS-ACCOUNT-BENEFITS
168260200423              INVALID KEY
168270200423                 CONTINUE
168280200423              END-REWRITE
168290200423              IF WS-FILE-STATUS IS NOT EQUAL TO "00"
168300200423                 MOVE "ACCT BENEFITS REWRITE"
168310200423                            TO WS-FILE-STATUS-FILE-NAME
168320200423                 SET lncc_Err087  TO  TRUE
168330200423                 PERFORM LOG-FILE-STATUS
168340200423              END-IF
168350200423            END-IF.
168360200507            MOVE SPACES TO WRITE-ACCOUNT-BENEFITS.
168370200605      *RFS185169 Ends
168380200423
168390200423      *Write account contract annuitant
168400200423
168410200423           IF (WRITE-ACCOUNT-CONT-ANNT = "R" OR "R2" OR "W" OR "W2")
168420200423           AND HISTORY
168430200423
168440200423             IF WRITE-ACCOUNT-CONT-ANNT = "W"
168450200423               WRITE ACCOUNT-CONT-ANNT-REC
168460200423               FROM WS-ACCOUNT-CONT-ANNT
168470200423               INVALID KEY
168480200423                 CONTINUE
168490200423               END-WRITE
168500200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
168510200423                 MOVE "ACCT CONTRACT ANNUITANT "
168520200423                                 TO WS-FILE-STATUS-FILE-NAME
16853020042358714            SET lncc_Err086  TO  TRUE
168540200423                 PERFORM LOG-FILE-STATUS
168550200423               END-IF
168560200423             END-IF
168570200423
168580200423             IF WRITE-ACCOUNT-CONT-ANNT = "R"
168590200423               REWRITE ACCOUNT-CONT-ANNT-REC
168600200423               FROM WS-ACCOUNT-CONT-ANNT
168610200423               INVALID KEY
168620200423                 CONTINUE
168630200423               END-REWRITE
168640200423               IF WS-FILE-STATUS IS NOT EQUAL TO "00"
168650200423                 MOVE "ACCT CONTRACT ANNUITANT"
168660200423                                 TO WS-FILE-STATUS-FILE-NAME
16867020042358714            SET lncc_Err087  TO  TRUE
168680200423                 PERFORM LOG-FILE-STATUS
168690200423               END-IF
168700200423             END-IF
168710200423
168720200423             IF WRITE-ACCOUNT-CONT-ANNT = "W2"
168730200423                 PERFORM VARYING WS-ACA2 FROM WS-ACA2 BY -1
168740200423                 UNTIL WS-ACA2 <= 0
168750200423
168760200423                     MOVE WS-ACCOUNT-CONT-ANNT-2(WS-ACA2)
168770200423                     TO   WS-ACCOUNT-CONT-ANNT
168780200423
168790200423                     WRITE ACCOUNT-CONT-ANNT-REC
168800200423                     FROM WS-ACCOUNT-CONT-ANNT
168810200423                           INVALID KEY
168820200423                       CONTINUE
168830200423                     END-WRITE
168840200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
168850200423                       MOVE "ACCT CONTRACT ANNUITANT "
168860200423                                       TO WS-FILE-STATUS-FILE-NAME
16887020042358714                  SET lncc_Err088  TO  TRUE
168880200423                       PERFORM LOG-FILE-STATUS
168890200423                     END-IF
168900200423                 END-PERFORM
168910200423             END-IF
168920200423
168930200423             IF WRITE-ACCOUNT-CONT-ANNT = "R2"
168940200423                 PERFORM VARYING WS-ACA2 FROM WS-ACA2 BY -1
168950200423                 UNTIL WS-ACA2 <= 0
168960200423
168970200423                     MOVE WS-ACCOUNT-CONT-ANNT-2(WS-ACA2)
168980200423                     TO   WS-ACCOUNT-CONT-ANNT
168990200423
169000200423                     REWRITE ACCOUNT-CONT-ANNT-REC
169010200423                     FROM WS-ACCOUNT-CONT-ANNT
169020200423                     INVALID KEY
169030200423                       CONTINUE
169040200423                     END-REWRITE
169050200423                     IF WS-FILE-STATUS IS NOT EQUAL TO "00"
169060200423                       MOVE "ACCOUNT CONTRACT ANNUITANT "
169070200423                                       TO WS-FILE-STATUS-FILE-NAME
16908020042358714                  SET lncc_Err089  TO  TRUE
169090200423                       PERFORM LOG-FILE-STATUS
169100200423                     END-IF
169110200423                 END-PERFORM
169120200423             END-IF
169130200423
169140200423           END-IF.
169150200423
169160200423      *RFS 13306 END
169170200423
169180200423           IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG"
169190200423           AND REDEMPTION-TRANSACTION
169200200423           AND ((HISTORY AND WIRE-ORDER-FLAG OF TRANS IS NOT EQUAL "Y")
169210200423           OR   (CONTRACTED))
169220200423             PERFORM PROCESS-SEG-SELL
169230200423           END-IF.
169240200423
169250200423           IF PRODUCT-TYPE-CODE OF INVESTMENT = "SEG"
169260200423           AND REDEMPTION-TRANSACTION
169270200423           AND (HISTORY AND WIRE-ORDER-FLAG OF TRANS IS EQUAL "Y")
169280200423             PERFORM PROCESS-SEG-WO-SELL
169290200423           END-IF.
169300200423      *RFS1017341 START
169310200423           IF SEG-TRANSFER-ANNUITANT AND SWITCH-IN-TRANSACTION
169320200423             AND HISTORY
169330200423             AND (WS-SEG-OUT-ACCOUNT-NO NOT = WS-SEG-IN-ACCOUNT-NO)
169340200423             MOVE ACCOUNT-NO OF TRANS
169350200423               TO ACCOUNT-NO OF ACCOUNT-ANNUITANT-DEFAULT
169360200423             MOVE "P" TO DEFAULT-FLAG OF ACCOUNT-ANNUITANT-DEFAULT
169370200423             READ ACCOUNT-ANNUITANT-DEFAULT
169380200423             INVALID KEY
169390200423               MOVE WS-SEG-OUT-ACCOUNT-NO TO li_OutAccountNo
169400200423               CALL "TRFSGVAL" USING li_OutAccountNo
169410200423                                     PASS-PROCESS-DATE-X
169420200423             END-READ
169430200423           END-IF.
169440200423      *RFS1017341 END
169450200423
169460200423       REU-0086.
169470200423
169480200423      *RFS86395-Begin
169490200423           SET lc-TrnaspRecordNo TO True
169500200423
169510200423           IF BUY-TRANSACTION
169520200423101074     AND (TRANS-ORIGIN-CODE OF TRANS = "DIR"  OR
169530200423101074          TRANS-ORIGIN-CODE OF TRANS = "WOR")
169540200423                 PERFORM Get-trans-assignment
169550200423           End-If.
169560200423
169570200423           IF lc-TrnaspRecordYes
169580200423                 PERFORM Generate-account-assignment
169590200423106558           PERFORM Generate-account-Loan
169600200423
169610200423                 INITIALIZE WS-MFAACCASP-WSW
169620200423                            WS-MFATRNASP-WSW
169630200423106558                      WS-MFAACCLNP-WSW
169640200423           End-If.
169650200423      *RFS86395-End
169660200423
169670200423      *RFS 16941 Begin - Write TRANS-ENV-REDEM-XREF if SELL
169680200423
169690200423           IF WS-SEL-BW-ENV
169700200423              INITIALIZE TRANS-ENV-REDEM-XREF-REC
169710200423              MOVE PLACEMENT-DATE OF TRANS
169720200423              TO PLACEMENT-DATE   OF TRANS-ENV-REDEM-XREF
169730200423              MOVE TRANS-NO       OF TRANS
169740200423              TO   TRANS-NO       OF TRANS-ENV-REDEM-XREF
169750200423              MOVE ZEROES
169760200423              TO PLACEMENT-DATE-2 OF TRANS-ENV-REDEM-XREF
169770200423              MOVE TRANS-NO       OF TRANS
169780200423              TO   TRANS-NO-2     OF TRANS-ENV-REDEM-XREF
169790200423              MOVE 'ZZZ'
169800200423              TO   MANAGEMENT-COMPANY-CODE
169810200423                                  OF TRANS-ENV-REDEM-XREF
169820200423              MOVE 0
169830200423              TO   ACCOUNT-NO     OF TRANS-ENV-REDEM-XREF
169840200423              MOVE SPACES
169850200423              TO   INVESTMENT-CODE OF TRANS-ENV-REDEM-XREF
169860200423              MOVE 0
169870200423              TO   NET-AMT        OF TRANS-ENV-REDEM-XREF
169880200423              WRITE TRANS-ENV-REDEM-XREF-REC
169890200423              INVALID KEY
169900200423                  CONTINUE
169910200423              END-WRITE
16992020042358714         IF WS-FILE-STATUS IS NOT EQUAL TO "00"
16993020042358714           MOVE "MFAENVRXP" TO WS-FILE-STATUS-FILE-NAME
16994020042358714           SET lncc_Err090  TO  TRUE
16995020042358714           PERFORM LOG-FILE-STATUS
16996020042358714         END-IF
169970200423           END-IF.
169980200423
169990200423      *    Update TRANS-ENV-REDEM-XREF if BUY
170000200423
170010200423           IF WS-BUY-BW-ENV
170020200423               MOVE WS-FXENVPUR-PLACEMENT-DATE
170030200423               TO   FXER-PLACEMENT-DATE
170040200423               MOVE WS-FXENVPUR-TRANS-NO
170050200423               TO   FXER-TRANS-NO
170060200423               MOVE WS-FXENVPUR-PLACEMENT-DATE-2
170070200423               TO   FXER-PLACEMENT-DATE-2
170080200423               MOVE WS-FXENVPUR-TRANS-NO-2
170090200423               TO   FXER-TRANS-NO-2
170100200423               MOVE WS-FXENVPUR-COMPANY-CODE
170110200423               TO   FXER-MANAGEMENT-COMPANY-CODE
170120200423
170130200423               MOVE "ENVRXP"
170140200423               TO   FXER-FILE-TO-PROCESS
170150200423               MOVE "R"
170160200423               TO   FXER-ACTION-CODE
170170200423
170180200423               CALL "FXENVRED" USING FXER-PARMS
170190200423               IF FXER-RETURN-CODE EQUAL ' '
170200200423                   CONTINUE
170210200423               ELSE
170220200423                   MOVE "TRANS-ENV-REDEM-XREF "
170230200423                                   TO WS-FILE-STATUS-FILE-NAME
17024020042358714              PERFORM LOG-FILE-STATUS-RD
170250200423               END-IF
170260200423
170270200423               MOVE PLACEMENT-DATE OF TRANS
170280200423               TO   PLACEMENT-DATE-2 OF FXER-ENVRXP-REC
170290200423               MOVE TRANS-NO       OF TRANS
170300200423               TO   TRANS-NO-2       OF FXER-ENVRXP-REC
170310200423
170320200423               CALL "RTVCMPCD" USING WS-MANAGEMENT-COMPANY
170330200423               CANCEL "RTVCMPCD"
170340200423
170350200423               MOVE WS-MANAGEMENT-COMPANY
170360200423               TO   MANAGEMENT-COMPANY-CODE OF FXER-ENVRXP-REC
170370200423
170380200423               MOVE ACCOUNT-NO OF TRANS
170390200423               TO   ACCOUNT-NO OF FXER-ENVRXP-REC
170400200423               MOVE INVESTMENT-CODE OF TRANS
170410200423               TO   INVESTMENT-CODE OF FXER-ENVRXP-REC
170420200423               MOVE NET-AMT         OF TRANS
170430200423               TO   NET-AMT         OF FXER-ENVRXP-REC
170440200423               MOVE "ENVRXP"
170450200423               TO   FXER-FILE-TO-PROCESS
170460200423               MOVE "W"
170470200423               TO   FXER-ACTION-CODE
170480200423
170490200423               CALL "FXENVRED" USING FXER-PARMS
170500200423               IF FXER-RETURN-CODE EQUAL ' '
170510200423                   CONTINUE
170520200423               ELSE
170530200423                   MOVE "TRANS-ENV-REDEM-XREF "
170540200423                                   TO WS-FILE-STATUS-FILE-NAME
17055020042358714              PERFORM LOG-FILE-STATUS-RD
170560200423               END-IF
170570200423
170580200423      *    Update TRANS-ENV-PURCH-XREF if BUY
170590200423
170600200423               MOVE PLACEMENT-DATE OF TRANS
170610200423               TO   PLACEMENT-DATE          OF TRANS-ENV-PURCH-XREF
170620200423
170630200423               MOVE TRANS-NO       OF TRANS
170640200423               TO   TRANS-NO                OF TRANS-ENV-PURCH-XREF
170650200423
170660200423               READ TRANS-ENV-PURCH-XREF
170670200423               INVALID KEY
170680200423                   MOVE "TRANS-ENV-PURCH-XREF "
170690200423                                   TO WS-FILE-STATUS-FILE-NAME
17070020042358714              PERFORM LOG-FILE-STATUS-RD
170710200423               END-READ
170720200423
170730200423               MOVE ACCOUNT-NO OF WS-TRANS-REC-5-SAV
170740200423               TO   ACCOUNT-NO OF TRANS-ENV-PURCH-XREF
170750200423
170760200423               MOVE INVESTMENT-CODE OF WS-TRANS-REC-5-SAV
170770200423               TO   INVESTMENT-CODE OF TRANS-ENV-PURCH-XREF
170780200423
170790200423               MOVE NET-AMT         OF WS-TRANS-REC-5-SAV
170800200423               TO   NET-AMT         OF TRANS-ENV-PURCH-XREF
170810200423
170820200423               REWRITE TRANS-ENV-PURCH-XREF-REC
170830200423               INVALID KEY
17084020042358714              CONTINUE
17085020042358714 *            MOVE "TRANS-ENV-PURCH-XREF "
17086020042358714 *                            TO WS-FILE-STATUS-FILE-NAME
17087020042358714 *            PERFORM LOG-FILE-STATUS
170880200423               END-REWRITE
17089020042358714         IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17090020042358714           MOVE "MFAENVPXP" TO WS-FILE-STATUS-FILE-NAME
17091020042358714           SET lncc_Err091  TO  TRUE
17092020042358714           PERFORM LOG-FILE-STATUS
17093020042358714         END-IF
170940200423           END-IF.
170950200423
170960200423      *RFS 16941 End
170970200423
170980200423           IF HISTORY AND WIRE-ORDER-NO  OF TRANS IS NOT EQUAL " "
170990200423             MOVE "D"          TO WRITE-TRANS-WO-LOCATOR
171000200423             MOVE PLACEMENT-DATE OF TRANS
171010200423                               TO PLACEMENT-DATE OF TRANS-WO-LOCATOR
171020200423             MOVE TRANS-NO OF TRANS
171030200423                               TO TRANS-NO OF TRANS-WO-LOCATOR
171040200423             READ TRANS-WO-LOCATOR WITH NO LOCK
171050200423               INVALID KEY
171060200423               MOVE " "        TO WRITE-TRANS-WO-LOCATOR
171070200423           END-IF.
171080200423
171090200423           IF WRITE-TRANS-WO-LOCATOR = "D"
171100200423             DELETE TRANS-WO-LOCATOR RECORD
171110200423                   INVALID KEY
171120200423                       CONTINUE
171130200423               END-DELETE
171140200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
171150200423             MOVE "WO LOCATOR " TO WS-FILE-STATUS-FILE-NAME
17116020042358714        SET lncc_Err092  TO  TRUE
171170200423             PERFORM LOG-FILE-STATUS
171180200423           END-IF.
171190200423
171200200423      *Reduce PAC Assignment Amounts
171210200423
171220200423           IF WRITE-ACCOUNT-ASSIGNMENT = " "
171230200423             GO TO REU-0300
171240200423           END-IF.
171250200423
171260200423           IF WRITE-ACCOUNT-ASSIGNMENT = "W"
171270200423             GO TO REU-0200
171280200423           END-IF.
171290200423
171300200423           SET PACIDX TO 1.
171310200423           SET PACIDX DOWN BY 1.
171320200423
171330200423       REU-0090.
171340200423           SET PACIDX UP BY 1.
171350200423           IF PACIDX IS GREATER THAN PACMAX
171360200423             GO TO REU-0300
171370200423           END-IF.
171380200423
171390200423           MOVE WS-ACCOUNT-ASSIGNMENT(PACIDX)
171400200423                               TO ACCOUNT-ASSIGNMENT-PRIMARY-REC.
171410200423           READ ACCOUNT-ASSIGNMENT-PRIMARY WITH NO LOCK
171420200423               INVALID KEY
171430200423                   CONTINUE
171440200423           END-READ.
171450200423
171460200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
171470200423             MOVE "ACCOUNT ASS" TO WS-FILE-STATUS-FILE-NAME
17148020042358714        PERFORM LOG-FILE-STATUS-RD
171490200423           END-IF.
171500200423
171510200423           MOVE WS-ACCOUNT-ASSIGNMENT(PACIDX)
171520200423                               TO ACCOUNT-ASSIGNMENT-PRIMARY-REC.
171530200423
171540200423           REWRITE ACCOUNT-ASSIGNMENT-PRIMARY-REC
171550200423               INVALID KEY
171560200423                   CONTINUE
171570200423           END-REWRITE.
171580200423
171590200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
171600200423             MOVE "ACCOUNT ASS" TO WS-FILE-STATUS-FILE-NAME
17161020042358714        SET lncc_Err093  TO  TRUE
171620200423             PERFORM LOG-FILE-STATUS
171630200423           END-IF.
171640200423
171650200423           MOVE PLACEMENT-DATE OF TRANS
171660200423                               TO PLACEMENT-DATE OF TRANS-ASSIGNMENT.
171670200423           MOVE TRANS-NO       OF TRANS
171680200423                               TO TRANS-NO OF TRANS-ASSIGNMENT.
171690200423           MOVE ACCOUNT-NO OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
171700200423                               TO ACCOUNT-NO OF TRANS-ASSIGNMENT.
171710200423           MOVE ASSIGN-SEQ-NO OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
171720200423                               TO ASSIGN-SEQ-NO OF TRANS-ASSIGNMENT.
171730200423           MOVE 0              TO UNITS-PURCHASED OF TRANS-ASSIGNMENT.
171740200423           SET PACIDX2         TO PACIDX.
171750200423           MOVE WS-FRM-ASGN-UNITS (PACIDX2)
171760200423                                       TO  UNITS-SOLD
171770200423                                           OF TRANS-ASSIGNMENT-REC.
171780200423
171790200423           WRITE TRANS-ASSIGNMENT-REC
171800200423               INVALID KEY
171810200423                   CONTINUE
171820200423           END-WRITE.
171830200423
171840200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
171850200423             MOVE "TRANS ASS"  TO WS-FILE-STATUS-FILE-NAME
17186020042358714        SET lncc_Err094  TO  TRUE
171870200423             PERFORM LOG-FILE-STATUS
171880200423           END-IF.
171890200423           GO TO REU-0090.
171900200423
171910200423       REU-0200.
171920200423           SET PACIDX TO 1.
171930200423           SET PACIDX DOWN BY 1.
171940200423
171950200423       REU-0250.
171960200423           SET PACIDX UP BY 1.
171970200423           IF PACIDX IS GREATER THAN PACMAX
171980200423             GO TO REU-0300
171990200423           END-IF.
172000200423
172010200423       REU-0251.
172020200423           MOVE WS-ACCOUNT-ASSIGNMENT(PACIDX)
172030200423                               TO ACCOUNT-ASSIGNMENT-PRIMARY-REC.
172040200423           WRITE ACCOUNT-ASSIGNMENT-PRIMARY-REC
172050200423               INVALID KEY
172060200423                   CONTINUE
172070200423           END-WRITE.
172080200423
172090200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
172100200423             ADD 1             TO ASSIGN-SEQ-NO
172110200423                               OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
17212020042358714        MOVE "MFAACCASP" TO WS-FILE-STATUS-FILE-NAME
17213020042358714        SET lncc_Err095  TO  TRUE
17214020042358714        PERFORM LOG-FILE-STATUS
172150200423             GO TO REU-0251
172160200423           END-IF.
172170200423
172180200423           MOVE PLACEMENT-DATE OF TRANS
172190200423                               TO PLACEMENT-DATE OF TRANS-ASSIGNMENT.
172200200423           MOVE TRANS-NO       OF TRANS
172210200423                               TO TRANS-NO OF TRANS-ASSIGNMENT.
172220200423           MOVE ACCOUNT-NO OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
172230200423                               TO ACCOUNT-NO OF TRANS-ASSIGNMENT.
172240200423           MOVE ASSIGN-SEQ-NO OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
172250200423                               TO ASSIGN-SEQ-NO OF TRANS-ASSIGNMENT.
172260200423           MOVE 0              TO UNITS-SOLD OF TRANS-ASSIGNMENT.
172270200423           MOVE UNITS OF WS-ACCOUNT-ASSIGNMENT(PACIDX)
172280200423                               TO UNITS-PURCHASED OF TRANS-ASSIGNMENT.
172290200423
172300200423           WRITE TRANS-ASSIGNMENT-REC
172310200423               INVALID KEY
172320200423                   CONTINUE
172330200423           END-WRITE.
172340200423
17235020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17236020042358714         MOVE "MFATRNASP" TO WS-FILE-STATUS-FILE-NAME
17237020042358714         SET lncc_Err096  TO  TRUE
17238020042358714         PERFORM LOG-FILE-STATUS
17239020042358714      END-IF.
172400200423
172410200423           GO TO REU-0250.
172420200423
172430200423       REU-0300.
172440200423
172450200423      *****
172460200423      *****    If A PAC Account Assignment record is to be created,
172470200423      *****    write it.  If the record already exists, increment the
172480200423      *****    Assignment Sequence Number and try again.  Please note
172490200423      *****    that if this field changes, the other related records
172500200423      *****    must also be updated.
172510200423      *****
172520200423
172530200423           IF  WS-MFAACCASP-WSW
172540200423                          IS NOT EQUAL TO  "Y"
172550200423               GO TO REU-0320.
172560200423
172570200423       REU-0310.
172580200423           MOVE WS-ACCOUNT-ASSIGN-PAC-REC
172590200423                                       TO
172600200423                                       ACCOUNT-ASSIGNMENT-PRIMARY-REC.
172610200423           WRITE ACCOUNT-ASSIGNMENT-PRIMARY-REC
172620200423               INVALID KEY
172630200423                   CONTINUE.
172640200423
172650200423           IF  WS-FILE-STATUS IS NOT EQUAL TO  "00"
172660200423               ADD 1  TO  ASSIGN-SEQ-NO    OF WS-ACCOUNT-ASSIGN-PAC-REC
172670200423               MOVE ASSIGN-SEQ-NO OF WS-ACCOUNT-ASSIGN-PAC-REC
172680200423                                       TO  ASSIGN-SEQ-NO
172690200423                                           OF WS-TRANS-ASSIGN-PAC-REC
17270020042358714          MOVE "MFAACCASP" TO WS-FILE-STATUS-FILE-NAME
17271020042358714          SET lncc_Err097  TO  TRUE
17272020042358714          PERFORM LOG-FILE-STATUS
172730200423               GO TO REU-0310.
172740200423
172750200423       REU-0320.
172760200423       REU-0330.
172770200423
172780200423      *****
172790200423      *****    If a PAC Transaction Assignment record is to be created,
172800200423      *****    write it.
172810200423      *****
172820200423
172830200423           IF  WS-MFATRNASP-WSW
172840200423                          IS NOT EQUAL TO  "Y"
172850200423               GO TO REU-0340.
172860200423
172870200423           MOVE WS-TRANS-ASSIGN-PAC-REC
172880200423                                       TO  TRANS-ASSIGNMENT-REC.
172890200423           WRITE TRANS-ASSIGNMENT-REC
172900200423               INVALID KEY
172910200423                   CONTINUE.
172920200423
172930200423           IF  WS-FILE-STATUS
172940200423                          IS NOT EQUAL TO  "00"
172950200423               MOVE "TRAN ASSGN: REU"  TO  WS-FILE-STATUS-FILE-NAME
17296020042358714          SET lncc_Err098  TO  TRUE
172970200423               PERFORM LOG-FILE-STATUS.
172980200423
172990200423       REU-0340.
173000200423      * RFS 10575 BEGIN
173010200423      * RFS18779 - Begin
173020200423      *    IF CONTR-REDEM-CODE OF TRANS(1:3) = "IFP" OR "TAX"
173030200423           IF WS-CURR-CONTR-REDEM-RULE-TAX      OR
173040200423              WS-CURR-CONTR-REDEM-RULE-IFP
173050200423      * Rfs42278 Start
173060200423              OR lnc_ContrRedemRuleLinkNote
173070200423      * Rfs42278 End
173080200423
173090200423      * RFS18779 - End
173100200423             PERFORM UPDATE-ACCOUNT-RRIF-LIF
173110200423           END-IF.
173120200423      * RFS 10575 END
173130200423
173140200423      *    RFS 44202 Begins
173150200423      *RFS59853 - Start
17316020042344202b*    IF (SELL-TRANSACTION OR SWITCH-OUT-TRANSACTION)
173170200423R73715*    IF BUY-TRANSACTION
173180200423R73715     IF (BUY-TRANSACTION OR SWITCH-IN-TRANSACTION)
173190200423      *RFS59853 - End
173200200423  |           AND WS-CURR-CONTR-REDEM-RULE-ROLL
173210200423  |           AND HISTORY
173220200423  |           AND LIF-ACCOUNT
173230200423R73715*       AND PROVINCE-ON
173240200423R59853*          PERFORM Calc-Inv-Return-Relq
173250200423R59853*          PERFORM Update-Account-Lif-Buy                         R73715
173260200423R73715           PERFORM Upd-Inv-Return-Recv
17327020042344202e     END-IF.
173280200423      *    RFS 44202 Ends
173290200423
173300200423       REU-0350.
173310200423           CONTINUE.
173320200423
173330200423      * RFS 7721  BEGIN
173340200423           IF WS-ASL-FLAG EQUAL "R"
173350200423             REWRITE ACCOUNT-INV-SWITCH-COUNTER-REC
17336020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17337020042358714           MOVE "MFAACISCP" TO WS-FILE-STATUS-FILE-NAME
17338020042358714           SET lncc_Err099  TO  TRUE
17339020042358714           PERFORM LOG-FILE-STATUS
17340020042358714        END-IF
173410200423             WRITE   ACCNT-INV-SWO-CNTER-TRANS-REC
17342020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17343020042358714           MOVE "MFAAISCTP" TO WS-FILE-STATUS-FILE-NAME
17344020042358714           SET lncc_Err100  TO  TRUE
17345020042358714           PERFORM LOG-FILE-STATUS
17346020042358714        END-IF
173470200423           END-IF.
173480200423
173490200423           IF WS-ASL-FLAG EQUAL "W"
173500200423             WRITE ACCOUNT-INV-SWITCH-COUNTER-REC
17351020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17352020042358714           MOVE "MFAACISCP" TO WS-FILE-STATUS-FILE-NAME
17353020042358714           SET lncc_Err101  TO  TRUE
17354020042358714           PERFORM LOG-FILE-STATUS
17355020042358714        END-IF
173560200423             WRITE ACCNT-INV-SWO-CNTER-TRANS-REC
17357020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
17358020042358714           MOVE "MFAAISCTP" TO WS-FILE-STATUS-FILE-NAME
17359020042358714           SET lncc_Err102  TO  TRUE
17360020042358714           PERFORM LOG-FILE-STATUS
17361020042358714        END-IF
173620200423           END-IF.
173630200423      * RFS 7721  END
173640200423      *RFS64348 - Begin
173650200423      * RFS50475 - Beg
173660200423      *    If lb_EditCodeALDSetupYes and HISTORY and
173670200423      *       UNIT-AMT OF TRANS > 0
173680200423      *      EVALUATE TRUE
173690200423del   *       WHEN EC-BUY-SELL-TRANSACTION AND BACK-END-LOAD            50475.4
173700200423add   *       WHEN BACK-END-LOAD AND NOT SWITCH-TRANSACTION             50475.4
173710200423      *         initialize WS-TRANS-SWO-REC
173720200423      *         call "UPDPURUN" using TRANS-REC, WS-TRANS-SWO-REC,
173730200423      *                              FUND-LOAD, FUND-LOAD-D
173740200423del   *       WHEN SWITCH-IN-TRANSACTION                                50475.6
173750200423add   *       WHEN SWITCH-IN-TRANSACTION AND                            50475.6
173760200423      *            (FROM-BACK-END-LOAD OR TO-BACK-END-LOAD)
173770200423      *         call "UPDPURUN" using WS-TRANS-SWO-REC, TRANS-REC,
173780200423      *                              FROM-FUND-LOAD, TO-FUND-LOAD
173790200423      *       WHEN SWITCH-OUT-TRANSACTION
173800200423      *         move TRANS-REC TO WS-TRANS-SWO-REC
173810200423      *      END-EVALUATE
173820200423      *    End-if.
173830200423      * RFS50475 - End
173840200423112945* Added flag for Edit code ALDTTF and screen code SRVPUP
173850200423112945* to populate PUP and RUP records for SRVHLD to use it.
173860200423103858* Added flag for Edit code GENPUP and screen code TRNPST
173870200423103858* to populate PUP and RUP records for SRVHLD to use it.
173880200423           IF (lb_EditCodeALDSetupYes
173890200423112945     OR  lb_EditCodeALDTTSetupYes
173900200423103858     OR  lb_EditCodeGENPUPSetupYes
173910200423      *RFS161542 - Starts
173920200423      *    OR  lc_ModuleSRVFEEOn)
173930200423           OR  lc_ModuleSRVFEEOn
173940200423           OR  lc_EditCodePURDTEOn)
173950200423      *RFS161542 - Ends
173960200423           AND HISTORY
173970200423           AND UNIT-AMT OF TRANS > 0
173980200423             EVALUATE TRUE
173990200423              WHEN (BACK-END-LOAD OR
174000200423171012             (NOT BACK-END-LOAD AND
174010200423171012             lc_EditCodePURDTEOn)    OR
174020200423112945             lb_EditCodeALDTTSetupYes OR
174030200423                   Lc_ToFundEffectiveDateRule NOT = SPACES)
174040200423                                 AND NOT SWITCH-TRANSACTION
174050200423                INITIALIZE WS-TRANS-SWO-REC
174060200423                CALL "UPDPURUN" using TRANS-REC, WS-TRANS-SWO-REC,
174070200423                                      FUND-LOAD, FUND-LOAD-D,
174080200423                                      lc_ModuleSRVFEEFlag,
174090200423                                      lc_FromFundEffectiveDateRule,
174100200423                                      lc_ToFundEffectiveDateRule
174110200423              WHEN SWITCH-IN-TRANSACTION AND
174120200423                   (FROM-BACK-END-LOAD OR TO-BACK-END-LOAD
174130200423171012          OR ((NOT FROM-BACK-END-LOAD OR NOT TO-BACK-END-LOAD)
174140200423171012               AND lc_EditCodePURDTEOn)
174150200423112945          OR lb_EditCodeALDTTSetupYes
174160200423                OR Lc_fromFundEffectiveDateRule NOT = SPACES
174170200423                OR Lc_toFundEffectiveDateRule   NOT = SPACES)
174180200423                CALL "UPDPURUN" using WS-TRANS-SWO-REC, TRANS-REC,
174190200423                                      FROM-FUND-LOAD,   TO-FUND-LOAD,
174200200423                                      lc_ModuleSRVFEEFlag,
174210200423                                      lc_FromFundEffectiveDateRule,
174220200423                                      lc_ToFundEffectiveDateRule
174230200423              WHEN SWITCH-OUT-TRANSACTION
174240200423                MOVE TRANS-REC TO WS-TRANS-SWO-REC
174250200423             END-EVALUATE
174260200423           END-IF.
174270200423      * RFS64348 - End
174280200423      * RFS92145 Start
174290200423      * Reduce MFR Eligible Units by unit-amt and recalculate MFR Amt.
174300200423
174310200423           IF Redemption-Transaction AND NOT lb_MFRTransLoop
174320200423              IF CLOSING-UNIT-BAL OF TRANS > 0
174330200423                 AND CURR-UNIT-BAL OF ACCOUNT-INVESTMENT > 0
174340200423                 AND NOT Placed-All-Units
174350200423                 MOVE lncc_N TO lc_FullRedemption
174360200423                 PERFORM PROCESS-MFR-ACCRUAL
174370200423                 INITIALIZE lc_MFRTransLoop
174380200423              END-IF
174390200423           END-IF.
174400200423      * RFS92145 End
174410200423      * RFS140269 - Begin
174420200706      *RFS184842 - start
174430200706140269*    IF GIC-INVESTMENT AND PASS-CDSC-CALCULATOR = "U" AND
174440200706140269*       TRANS-STATUS-CODE OF TRANS = "HST" AND lb_SkipGICSeqYes
174450200706140269     IF (GIC-INVESTMENT AND PASS-CDSC-CALCULATOR = "U" AND
174460200706140269        TRANS-STATUS-CODE OF TRANS = "HST" AND lb_SkipGICSeqYes)
174470200706              OR( DII-INVESTMENT AND PASS-CDSC-CALCULATOR = "U" AND
174480201202      *RFS1106077 Starts
174490201202                  TRANS-ORIGIN-CODE OF TRANS = "GIM" AND
174500201202                  lb_SkipGICSeqYes AND
174510201202      *RFS1106077 Ends
174520200706                     TRANS-STATUS-CODE OF TRANS = "HST" )
174530200706      *RFS184842 - end
174540200423140269          PERFORM SET-GIC-MISC-FIELDS
174550200423140269          IF WS-GIC-CRT-MAT-BUY = "Y" OR
174560200423140269             WS-GIC-CRT-INT-BUY = "Y" OR
174570200423140269             WS-GIC-CRT-MAT = "Y" OR WS-GIC-CRT-INT = "Y" OR
174580200423140269             WS-GIC-CRT-CERT = "Y" OR
174590200423140269             WS-GIC-MAT-UPD = "Y"
174600200423140269               PERFORM CREATE-UPD-GIC-TRADES
174610200423140269          END-IF
174620200423140269     END-IF.
174630200423      * RFS140269 - End
174640200423      * RFS169270 - Starts
174650200423           IF REJECTION-CODE OF TRANS-REC IS EQUAL "00"      AND
174660200423              PURCHASE-TRANSACTION AND (NOT PURCHASE-ADJUSTMENT) AND
174670200423              lb_EditCodeACINVGSetupYes                          AND
174680200423              lc_Policy NOT = "A"                                AND
174690200423              WRITE-ACCOUNT-MISC-DETAILS IS EQUAL TO  "Y"
174700200423              MOVE INVESTMENT-CODE OF TRANS-REC TO lc_InvCdACINVG
174710200423              MOVE SPACES                       TO lc_InvStrucACINVG
174720200423              CALL "FXINRSTRF" USING   lc_InvCdACINVG
174730200423                                       lc_ACINVG
174740200423                                       lc_InvStrucACINVG
174750200423                                       lc_DeclareINRSTRF
174760200423              INITIALIZE MFAACMDP OF ACCOUNT-MISC-DETAILS-REC
174770200423              MOVE ACCOUNT-NO OF TRANS-REC
174780200423                TO ACCOUNT-NO OF ACCOUNT-MISC-DETAILS-REC
174790200423              READ ACCOUNT-MISC-DETAILS
174800200423                   WITH NO LOCK
174810200423              INVALID KEY
174820200423                   MOVE "W" TO WRITE-ACCOUNT-MISC-DETAILS
174830200423              NOT INVALID KEY
174840200423                   MOVE "R" TO WRITE-ACCOUNT-MISC-DETAILS
174850200423              END-READ
174860200423             IF lc_InvStrucACINVG NOT = SPACES        AND
174870200423                ACCOUNT-INVESTMENT-GROUP
174880200423                  OF ACCOUNT-MISC-DETAILS-REC = SPACES
174890200423                MOVE ACCOUNT-NO OF TRANS-REC
174900200423                  TO ACCOUNT-NO    OF ACCOUNT-MISC-DETAILS-REC
174910200423                MOVE TRADE-DATE OF TRANS-REC
174920200423                  TO EFFECTIV-DATE OF ACCOUNT-MISC-DETAILS-REC
174930200423                MOVE lc_InvStrucACINVG TO ACCOUNT-INVESTMENT-GROUP
174940200423                  OF ACCOUNT-MISC-DETAILS-REC
174950200423                IF WRITE-ACCOUNT-MISC-DETAILS = "W"
174960200423                   WRITE ACCOUNT-MISC-DETAILS-REC
174970200423                      INVALID KEY
174980200423                      CONTINUE
174990200423                   END-WRITE
175000200423                   IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175010200423                      MOVE "MFAACMDP" TO WS-FILE-STATUS-FILE-NAME
175020200423                      SET lncc_Err308 TO TRUE
175030200423                      PERFORM LOG-FILE-STATUS
175040200423                   END-IF
175050200423                END-IF
175060200423                IF WRITE-ACCOUNT-MISC-DETAILS = "R"
175070200423                   REWRITE ACCOUNT-MISC-DETAILS-REC
175080200423                      INVALID KEY
175090200423                      CONTINUE
175100200423                   END-REWRITE
175110200423                   IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175120200423                      MOVE "MFAACMDP" TO WS-FILE-STATUS-FILE-NAME
175130200423                      SET lncc_Err309 TO TRUE
175140200423                      PERFORM LOG-FILE-STATUS
175150200423                   END-IF
175160200423                END-IF
175161210914      *RFS1117962 - Starts
175162210914185455*           PERFORM RecalculateRiderResetDate
175163210914                  PERFORM RecalculateRiderResetDate
175164210914                          thru RRRD-Exit
175165210914      *RFS1117962 - End
175180200423             END-IF
175190200423           END-IF.
175200200703      * RFS169270 - Ends
175210200423       REU-EXIT.
175220200423           EXIT.
175230200423      * RFS13839 - Begin
175240200423       UPD-FOR-CALCULATOR SECTION.
175250200423       UFC-0000.
175260200423           PERFORM UPD-TRANS-ACCOUNT-LV-DS-DTLS
175270200423           PERFORM UPD-ACCOUNT-LEVEL-FREE
175280200423           PERFORM UPD-TRANS-CDSC-PUR-PRIMARY
175290200423      *** RFS21612 begin
175300200423           PERFORM UPD-ACCOUNT-INVESTMENT.
175310200423      *** RFS21612 end
175320200423      *** RFS170891 begin
175330200423           PERFORM UPD-MFATRNP.
175340200423      *** RFS170891 end
175350200423       UFC-EXIT.
175360200423           EXIT.
175370200423       UPD-TRANS-ACCOUNT-LV-DS-DTLS SECTION.
175380200423       UTALDD-0000.
175390200423           IF WRITE-TRANS-ACC-LV-D IS EQUAL "W"
175400200423             WRITE TRANS-ACCOUNT-LV-D-REC
175410200423                   INVALID KEY
175420200423                       CONTINUE
175430200423               END-WRITE
175440200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175450200423               MOVE "TRANS AC LV DSC" TO WS-FILE-STATUS-FILE-NAME
17546020042358714          SET lncc_Err103  TO  TRUE
175470200423               PERFORM LOG-FILE-STATUS
175480200423             END-IF
175490200423           END-IF.
175500200423
175510200423           IF WRITE-TRANS-ACC-LV-D IS EQUAL "R"
175520200423             REWRITE TRANS-ACCOUNT-LV-D-REC
175530200423                   INVALID KEY
175540200423                       CONTINUE
175550200423               END-REWRITE
175560200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175570200423               MOVE "TRANS AC LV DSC" TO WS-FILE-STATUS-FILE-NAME
17558020042358714          SET lncc_Err104  TO  TRUE
175590200423               PERFORM LOG-FILE-STATUS
175600200423             END-IF
175610200423           END-IF.
175620200423       UTALDD-EXIT.
175630200423           EXIT.
175640200423      * ---------------------------------
175650200423       UPD-ACCOUNT-LEVEL-FREE SECTION.
175660200423      * ---------------------------------
175670200423       UALF-0000.
175680200423           IF WRITE-ACC-LV-FR IS EQUAL "W"
175690200423             WRITE ACCOUNT-LEVEL-FREE-REC
175700200423                   INVALID KEY
175710200423                       CONTINUE
175720200423               END-WRITE
175730200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175740200423               MOVE "TRANS AC LV FRE" TO WS-FILE-STATUS-FILE-NAME
17575020042358714          SET lncc_Err105  TO  TRUE
175760200423               PERFORM LOG-FILE-STATUS
175770200423             END-IF
175780200423           END-IF.
175790200423
175800200423           IF WRITE-ACC-LV-FR IS EQUAL "R"
175810200423             REWRITE ACCOUNT-LEVEL-FREE-REC
175820200423                   INVALID KEY
175830200423                       CONTINUE
175840200423               END-REWRITE
175850200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
175860200423               MOVE "TRANS AC LV FRE" TO WS-FILE-STATUS-FILE-NAME
17587020042358714          SET lncc_Err106  TO  TRUE
175880200423               PERFORM LOG-FILE-STATUS
175890200423             END-IF
175900200423           END-IF.
175910200423       UALF-EXIT.
175920200423           EXIT.
175930200423      * ---------------------------------
175940200423       UPD-TRANS-CDSC-PUR-PRIMARY SECTION.
175950200423      * ---------------------------------
175960200423       UTCPR-0000.
175970200423           IF WRITE-TRANS-CDSC-PURCHASE IS EQUAL TO "W"
175980200423      *RFS112133 begin
175990200423           AND NOT
176000200423           ( EXTERNAL-LOAD-TYPE-CODE
176010200423                 OF INVESTMENT-MISC-DETAIL-REC = "NL"
176020200423             AND ACCOUNT-LEV-FREE-DOLLARS
176030200423             AND ACCOUNT-LEV-DSC
176040201223      *RFS180707 - Starts
176050201223             AND lnc_ACINDSCNo
176060201223      *RFS180707 - Ends
176070200423             AND YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0
176080200423           )
176090200423      *RFS112133 end
176100200423      * RFS47719 - Begin
176110200423             PERFORM CALCULATE-MATURITY-DATE
176120200423      * RFS47719 - End
176130200423      *    RFS71433 -Begin
176140200423             SET lncc_freeDollUpdate    TO TRUE
176150200423             SET lncc_freeDollTypeBuy   TO TRUE
176160200423             PERFORM upd-purch-acc-inv-fin-Free-dol
176170200423             PERFORM initFreeUnitsPurPrimary
176180200423             Perform UpdTransPurFreeUnits
176190200423      *    RFS71433 -End
176200200423             WRITE TRANS-CDSC-PUR-PRIMARY-REC
176210200423                   INVALID KEY
176220200423                       CONTINUE
176230200423               END-WRITE
176240200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
176250200423               MOVE "TRANS CDSC PURCHASE" TO WS-FILE-STATUS-FILE-NAME
17626020042358714          SET lncc_Err107  TO  TRUE
176270200423               PERFORM LOG-FILE-STATUS
176280200423             END-IF
176290200423           END-IF.
176300200423           IF WRITE-TRANS-CDSC-PURCHASE IS EQUAL TO "R"
176310200423      *RFS112133 begin
176320200423           AND NOT
176330200423           ( EXTERNAL-LOAD-TYPE-CODE
176340200423                 OF INVESTMENT-MISC-DETAIL-REC = "NL"
176350200423             AND ACCOUNT-LEV-FREE-DOLLARS
176360200423             AND ACCOUNT-LEV-DSC
176370201223      *RFS180707 - Starts
176380201223             AND lnc_ACINDSCNo
176390201223      *RFS180707 -Ends
176400200423             AND YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0
176410200423           )
176420200423      *RFS112133 end
176430200423      * RFS47719 - Begin
176440200423             PERFORM CALCULATE-MATURITY-DATE
176450200423      * RFS47719 - End
176460200423      *    RFS71433 -Begin
176470200423             SET lncc_freeDollUpdate    TO TRUE
176480200423             SET lncc_freeDollTypeBuy   TO TRUE
176490200423             PERFORM upd-purch-acc-inv-fin-Free-dol
176500200423             PERFORM initFreeUnitsPurPrimary
176510200423      *    RFS71433.1 -Begin
176520200423      *      Perform UpdTransPurFreeUnits
176530200423      *    RFS71433.1 -End
176540200423      *    RFS71433 -End
176550200423             REWRITE TRANS-CDSC-PUR-PRIMARY-REC
176560200423                   INVALID KEY
176570200423                       CONTINUE
176580200423               END-REWRITE
176590200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
176600200423               MOVE "TRANS CDSC PURCHASE" TO WS-FILE-STATUS-FILE-NAME
17661020042358714          SET lncc_Err108  TO  TRUE
176620200423               PERFORM LOG-FILE-STATUS
176630200423             END-IF
176640200423           END-IF.
176650200423       UTCPR-EXIT.
176660200423           EXIT.
176670200423      * RFS13839 - End
176680200423      * RFS21612 - BEGIN
176690200423      * ---------------------------------
176700200423       UPD-ACCOUNT-INVESTMENT SECTION.
176710200423      * ---------------------------------
176720200423       UAIR-0000.
176730200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "W"
176740200423             WRITE ACCOUNT-INVESTMENT-REC
176750200423                   INVALID KEY
176760200423                       CONTINUE
176770200423               END-WRITE
176780200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
176790200423               MOVE "ACCOUNT-INVESTMENT" TO WS-FILE-STATUS-FILE-NAME
17680020042358714          SET lncc_Err109  TO  TRUE
176810200423               PERFORM LOG-FILE-STATUS
176820200423             END-IF
176830200423           END-IF.
176840200423
176850200423           IF WRITE-ACCOUNT-INVESTMENT IS EQUAL TO "R"
176860200423             REWRITE ACCOUNT-INVESTMENT-REC
176870200423                   INVALID KEY
176880200423                       CONTINUE
176890200423               END-REWRITE
176900200423             IF WS-FILE-STATUS IS NOT EQUAL TO "00"
176910200423               MOVE "ACCOUNT-INVESTMENT" TO WS-FILE-STATUS-FILE-NAME
17692020042358714          SET lncc_Err110  TO  TRUE
176930200423               PERFORM LOG-FILE-STATUS
176940200423             END-IF
176950200423           END-IF.
176960200423       UAIR-EXIT.
176970200423           EXIT.
176980200423      * RFS21612 - END
176990200423
177000200423      * RFS170891 - Start
177010200423      * ---------------------------------
177020200423       UPD-MFATRNP SECTION.
177030200423      * ---------------------------------
177040200423           MOVE TRANS-REC    TO WS-TRANS-REC.
177050200423           MOVE WS-TRANS-REC TO TRANS-PRIMARY-REC.
177060200423           READ TRANS-PRIMARY
177070200423             NOT INVALID KEY
177080200423                MOVE WS-TRANS-REC TO TRANS-PRIMARY-REC
177090200423                REWRITE TRANS-PRIMARY-REC
177100200423                CONTINUE
177110200423             INVALID KEY
177120200423                MOVE WS-TRANS-REC TO TRANS-PRIMARY-REC
177130200423                WRITE TRANS-PRIMARY-REC
177140200423           END-READ.
177150210531      *RFS186729 STARTS
177160210531           IF lncc_FileStatus30
177170210531              MOVE "MFATRNP" TO WS-FILE-STATUS-FILE-NAME
177180210531              PERFORM LOG-FILE-STATUS
177190210531           END-IF.
177200210531      *RFS186729 ENDS
177210200423       UMS-EXIT.
177220200423           EXIT.
177230200423
177240200423      * RFS170891 - End
177250200423
177260200423      * RFS19210 - Begin
177270200423      * RFS17180 - Begin
177280200423      * ---------------------------------
177290200423       SET-INVESTMENT-TO-ACTIVE SECTION.
177300200423      * ---------------------------------
177310200423           INITIALIZE COMM-PARMS
177320200423           MOVE ACCOUNT-NO OF TRANS  TO COMM-ACCOUNT-NO OF COMM-PARMS
177330200423           MOVE WS-CURR-PHANTOM            TO
177340200423                COMM-INVESTMENT-CODE OF COMM-PARMS
177350200423           SET COMM-ACCOUNT-INV-STATUS-ACT TO TRUE
177360200423           SET COMM-ACTION-CHG-TO-ACT      TO TRUE
177370200423           PERFORM CALL-FXAAAINV
177380200423           IF NOT RETN-OK OF COMM-CPAAAINV-PARAMETERS
177390200423             DISPLAY "Set Investment to Active failed. RETN-CODE = "
177400200423               RETN-CODE OF COMM-CPAAAINV-PARAMETERS
177410200423             PERFORM SET-INVESTMENT-DSP
177420200423           ELSE
177430200423             DISPLAY "Set to Active succeed "
177440200423             PERFORM SET-INVESTMENT-DSP
177450200423           END-IF.
177460200423       SITA-EXIT.
177470200423            EXIT.
177480200423      * ---------------------------------
177490200423       SET-INVESTMENT-DSP SECTION.
177500200423      * ---------------------------------
177510200423           MOVE ACCOUNT-NO OF TRANS       TO DSP-ACCOUNT-NO
177520200423           MOVE PLACEMENT-DATE OF TRANS   TO DSP-PLACEMENT-DATE
177530200423           MOVE TRANS-NO       OF TRANS   TO DSP-TRANS-NO
177540200423           DISPLAY "Acc N "    DSP-ACCOUNT-NO
177550200423                   "Inv Code " INVESTMENT-CODE OF TRANS
177560200423                   "Phantom "  WS-CURR-PHANTOM
177570200423                   "Key "      DSP-PLACEMENT-DATE
177580200423                   " "         DSP-TRANS-NO.
177590200423       SID-EXIT.
177600200423           EXIT.
177610200423      * RFS19210 - End
177620200423      * RFS17180 - End
177630200423      /
177640200423       POST-CDSC-RED-LIABILITY SECTION.
177650200423      ******************************************************************
177660200423      *    P O S T   C D S C   R E D E M P T I O N   L I A B I L I T Y *
177670200423      ******************************************************************
177680200423       PCRL-0000.
177690200423           IF NOT TRANSFER-LIABILITY
177700200423             MOVE ZEROES       TO LIABILITY-OUT
177710200423                               OF TRANS-CDSC-PURCH-REDUCTION
177720200423                                  LIABILITY-REDUCED-BY
177730200423                               OF TRANS-CDSC-PURCH-REDUCTION
177740200423             GO TO PCRL-EXIT
177750200423           END-IF.
177760200423      ** IF THE LIABILITY IS EXPIRED - NOTHING TO TRANSFER
177770200423           IF LIABILITY-EXPIRED OF TRANS-CDSC-PURCHASE = "Y"
177780200423             MOVE ZEROES      TO LIABILITY-OUT
177790200423             OF TRANS-CDSC-PURCH-REDUCTION
177800200423             GO TO PCRL-EXIT
177810200423           END-IF.
177820200423      ** IF THE LIABILITY IS 0 OR NEGATIVE - NOTHING TO TRANSFER
177830200423           IF LIABILITY-IN OF TRANS-CDSC-PURCHASE IS NOT GREATER THAN 0
177840200423             MOVE ZEROES      TO LIABILITY-OUT
177850200423             OF TRANS-CDSC-PURCH-REDUCTION
177860200423                                 LIABILITY-REDUCED-BY
177870200423             OF TRANS-CDSC-PURCH-REDUCTION
177880200423             GO TO PCRL-EXIT
177890200423           END-IF.
177900200423      ** GET THE ORIGINAL FINANCER DETAILS AND SUB-ADVISOR RATES
177910200423           MOVE FINANCER-CODE OF TRANS-CDSC-PURCHASE
177920200423                               TO FINANCER-CODE
177930200423                               OF FINANCER-SUB-ADVISOR.
177940200423
177950200423           MOVE ZEROES         TO WS-ADVISOR-PCT-PER-ANNUM.
177960200423
177970200423           MOVE SPACES         TO SUB-ADVISOR-CODE
177980200423                               OF FINANCER-SUB-ADVISOR.
177990200423           START FINANCER-SUB-ADVISOR
178000200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
178010200423             INVALID KEY
178020200423             GO TO PCRL-0105.
178030200423       PCRL-0103.
178040200423      ** ADD PER ANNUM AMOUNTS TOGEATHER FOR ALL SUB-ADVISORS
178050200423           READ FINANCER-SUB-ADVISOR NEXT RECORD
178060200423             AT END
178070200423             GO TO PCRL-0105.
178080200423           IF FINANCER-CODE OF FINANCER-SUB-ADVISOR IS NOT EQUAL
178090200423           FINANCER-CODE OF TRANS-CDSC-PURCHASE
178100200423             GO TO PCRL-0105
178110200423           END-IF.
178120200423           COMPUTE WS-ADVISOR-PCT-PER-ANNUM =
178130200423           WS-ADVISOR-PCT-PER-ANNUM +
178140200423           ADVISOR-PCT-PER-ANNUM OF FINANCER-SUB-ADVISOR.
178150200423
178160200423           GO TO PCRL-0103.
178170200423
178180200423       PCRL-0105.
178190200423      ** NOW THAT WE HAVE THE SUB-ADVISOR-RATES, CALCULATE HOW **
178200200423      ** MUCH HAS BEEN REALIZED BY THE SUB-ADVISORS            **
178210200423      ** HOW MANY UNITS ??
178220200423           COMPUTE WS-LIABILITY-UNITS-APPLICABLE =
178230200423           (CHRG-UNITS-TAKEN-DOWN OF TRANS-CDSC-PURCH-REDUCTION +
178240200423           FREE-UNITS-TAKEN-DOWN OF TRANS-CDSC-PURCH-REDUCTION).
178250200423
178260200423      ** WHAT IS THE LIABILITY PER UNIT???
178270200423           COMPUTE WS-LIABILITY-PER-UNIT ROUNDED =
178280200423           (LIABILITY-IN OF TRANS-CDSC-PURCHASE /
178290200423            ORIG-UNIT-BAL OF TRANS-CDSC-PURCHASE).
178300200423
178310200423      ** CALCULATE THE RELATIVE LIABILITY BEING MOVED OUT
178320200423           COMPUTE WS-LIABILITY-APPLICABLE ROUNDED =
178330200423           (WS-LIABILITY-PER-UNIT * WS-LIABILITY-UNITS-APPLICABLE).
178340200423
178350200423      * CALCULATE THE DAYS THE LIABILITY WAS HELD
178360200423           MOVE EXCHANGE-AGE-DATE OF TRANS-CDSC-PURCHASE
178370200423                               TO WS-FROM-DATE.
178380200423           MOVE AGE-DATE OF TRANS-CDSC-PURCH-REDUCTION
178390200423                               TO WS-TO-DATE.
178400200423           PERFORM CALCULATE-DAY-RANGE.
178410200423      * CALCULATE HOW MUCH OF THE FEES WERE RECOVERED
178420200423      * ON THIS LIABILITY
178430200423      *
178440200423           COMPUTE WS-FEES-RECOVERED ROUNDED =
178450200423           (((WS-LIABILITY-UNITS-APPLICABLE *
178460200423             UNIT-PRICE OF TRANS-CDSC-PURCHASE) *
178470200423           (WS-ADVISOR-PCT-PER-ANNUM / 100) / 365))               *
178480200423           DAYS-DIFFERENCE.
178490200423      * STORE HOW MUCH THE TOTAL LIABILITY TAKEN OUT WAS
178500200423      * REDUCE LIABILITY BY USED + SOLD
178510200423           MOVE WS-LIABILITY-APPLICABLE
178520200423                             TO LIABILITY-REDUCED-BY
178530200423                             OF TRANS-CDSC-PURCH-REDUCTION
178540200423           COMPUTE LIABILITY-OUT OF TRANS-CDSC-PURCH-REDUCTION =
178550200423           WS-LIABILITY-APPLICABLE - WS-FEES-RECOVERED.
178560200423
178570200423           ADD WS-LIABILITY-APPLICABLE
178580200423                             TO LIABILITY-OUT
178590200423                             OF TRANS-CDSC-PURCHASE.
178600200423       PCRL-EXIT.
178610200423           EXIT.
178620200423       POST-SWITCH-LIABILITY SECTION.
178630200423      ******************************************************************
178640200423      *    P O S T   S W I T C H   L I A B I L I T Y   R O U T I N E   *
178650200423      ******************************************************************
178660200423       PSL-0000.
178670200423           IF NOT TRANSFER-LIABILITY
178680200423             PERFORM INITIALIZE-LIABILITY-PORTION
178690200423
178700200423             GO TO PSL-EXIT
178710200423           END-IF.
178720200423      ***  GET TARGET FINANCER
178730200423           MOVE INVESTMENT-CODE OF TRANS
178740200423                             TO WS-INVESTMENT-CODE.
178750200423           MOVE TRADE-DATE OF TRANS
178760200423                             TO WS-TRADE-DATE.
178770200423
178780200423           MOVE "Y"          TO WS-USE-DEFAULT-RATE.
178790200423
178800200423           PERFORM GET-FINANCER-DETAILS.
178810200423
178820200423           MOVE "N"          TO WS-USE-DEFAULT-RATE.
178830200423           IF COMMISSION-PAID OF TRANS-CDSC-PUR-PRIMARY IS NOT EQUAL
178840200423           TO "Y"
178850200423             GO TO PSL-0020
178860200423           END-IF.
178870200423      * MOVE THE LIABILITY TO THE TARGET PURCHASE
178880200423           MOVE ZEROES         TO LIABILITY-OUT OF
178890200423                               TRANS-CDSC-PUR-PRIMARY.
178900200423
178910200423           MOVE LIABILITY-OUT OF TRANS-CDSC-PURCH-REDUCTION
178920200423                               TO LIABILITY-IN OF
178930200423                               TRANS-CDSC-PUR-PRIMARY.
178940200423
178950200423           MOVE TRADE-DATE OF TRANS
178960200423                               TO EXCHANGE-AGE-DATE
178970200423                               OF TRANS-CDSC-PUR-PRIMARY.
178980200423      ** IF THE LIABILITY IS GREATER THAN WHAT THE LIABILITY
178990200423      ** WOULD HAVE BEEN IN THE EVENT OF THESE BEING NEW UNITS
179000200423      ** THEN USE THE LESSER OF THE TWO
179010200423
179020200423      ** FIRST GET THE ORIGINAL COMMISSION RATE PAID ON THE UNITS
179030200423      ** BY READING THE ORIGINAL COMMISSION RATE
179040200423           IF ORIGINAL-TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
179050200423           IS EQUAL TO 0
179060200423             MOVE ZEROES       TO COMM-RATE OF TRANS-COMMISSION-2
179070200423             GO TO PSL-0019
179080200423           END-IF.
179090200423
179100200423           MOVE ORIGINAL-TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
179110200423                              TO TRANS-NO OF TRANS-COMMISSION-2.
179120200423           MOVE ORIGINAL-PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY
179130200423                              TO PLACEMENT-DATE OF TRANS-COMMISSION-2.
179140200423
179150200423           READ TRANS-COMMISSION-2
179160200423             INVALID KEY
179170200423             MOVE ZERO        TO COMM-RATE OF TRANS-COMMISSION-2.
179180200423       PSL-0019.
179190200423           COMPUTE WS-ORIGINAL-LIABILITY ROUNDED =
179200200423           (CURR-UNITS-CHRG OF TRANS-CDSC-PUR-PRIMARY *
179210200423           UNIT-PRICE OF TRANS)                     *
179220200423           (COMM-RATE OF TRANS-COMMISSION-2 / 100).
179230200423
179240200423           IF WS-ORIGINAL-LIABILITY IS LESS THAN
179250200423           LIABILITY-IN OF TRANS-CDSC-PUR-PRIMARY
179260200423             MOVE WS-ORIGINAL-LIABILITY
179270200423                               TO LIABILITY-IN
179280200423                               OF TRANS-CDSC-PUR-PRIMARY
179290200423           END-IF.
179300200423      ** TRANSFER LIABILITY TO THE TARGET FINANCER
179310200423      ** NOTE: FINANCER AND CDSC SCHEDULES REMAIN THE SAME
179320200423      **       AND FINANCER REMAINS THE SAME IF TARGET FUND DOES
179330200423      **       NOT PAY COMMISSION
179340200423           IF COMM-RATE OF FINANCER-SCHED IS NOT EQUAL 0
179350200423             MOVE FINANCER-CODE OF INVESTMENT-FINANCER
179360200423                                 TO FINANCER-CODE OF
179370200423                                 TRANS-CDSC-PUR-PRIMARY
179380200423           END-IF.
179390200423           GO TO PSL-EXIT.
179400200423       PSL-0020.
179410200423
179420200423      ** CREATE LIABILITY FOR UNPAID COMMISSION RECORDS
179430200423      ** FORMAT LIABILITY RECORD PORTION **
179440200423
179450200423           PERFORM INITIALIZE-LIABILITY-PORTION.
179460200423
179470200423      ** IF GOING TO A ZERO COMMISSION INVESTMENT NO LIABILITY
179480200423      ** IS INCURRED - TRANSFER THE WHOLE RECORD TO THE TARGET
179490200423      ** FINANCER
179500200423
179510200423           IF COMM-RATE OF FINANCER-SCHED IS EQUAL 0
179520200423               MOVE ZEROES             TO  AGE-DATE
179530200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
179540200423               MOVE ZEROES             TO  UNIT-PRICE
179550200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
179560200423             MOVE FINANCER-CODE OF INVESTMENT-FINANCER
179570200423                             TO FINANCER-CODE OF TRANS-CDSC-PURCHASE
179580200423             MOVE FINANCER-SCHEDULE OF FINANCER-SCHED
179590200423                             TO FINANCER-SCHEDULE OF TRANS-CDSC-PURCHASE
179600200423             MOVE CDSC-SCHEDULE OF FINANCER-SCHED
179610200423                             TO CDSC-SCHEDULE OF TRANS-CDSC-PURCHASE
179620200423             GO TO PSL-EXIT
179630200423           END-IF.
179640200423
179650200423      ** SETUP AGE DATE AND COST   **
179660200423
179670200423           MOVE UNIT-PRICE OF TRANS
179680200423                             TO UNIT-PRICE OF TRANS-CDSC-PUR-PRIMARY.
179690200423
179700200423           MOVE TRADE-DATE OF TRANS
179710200423                             TO AGE-DATE   OF TRANS-CDSC-PUR-PRIMARY.
179720200423
179730200423           COMPUTE LIABILITY-IN OF TRANS-CDSC-PUR-PRIMARY ROUNDED =
179740200423           (CURR-UNITS-CHRG OF TRANS-CDSC-PUR-PRIMARY *
179750200423           UNIT-PRICE OF TRANS-CDSC-PUR-PRIMARY) *
179760200423           (COMM-RATE OF FINANCER-SCHED / 100).
179770200423
179780200423           ADD LIABILITY-IN OF TRANS-CDSC-PUR-PRIMARY
179790200423                              TO COMM-AMT OF TRANS-COMMISSION
179800200423                                 COMM-PAYABLE OF TRANS-COMMISSION.
179810200423
179820200423           MOVE "R"           TO WRITE-TRANS-COMMISSION.
179830200423
179840200423           MOVE DEALER-CODE OF TRANS
179850200423                              TO DEALER-CODE OF TRANS-CDSC-PUR-PRIMARY.
179860200423
179870200423           MOVE DEALER-REP-CODE OF TRANS
179880200423                              TO DEALER-REP-CODE
179890200423                              OF TRANS-CDSC-PUR-PRIMARY.
179900200423
179910200423           MOVE TRADE-DATE    OF TRANS
179920200423                              TO EXCHANGE-AGE-DATE
179930200423                              OF TRANS-CDSC-PUR-PRIMARY
179940200423                                 AGE-DATE
179950200423                              OF TRANS-CDSC-PUR-PRIMARY.
179960200423
179970200423           MOVE "Y"           TO COMMISSION-PAID
179980200423                              OF TRANS-CDSC-PUR-PRIMARY
179990200423
180000200423      ** SETUP THE FINANCER INFORMATION
180010200423
180020200423           MOVE FINANCER-CODE OF INVESTMENT-FINANCER
180030200423                              TO FINANCER-CODE OF
180040200423                              TRANS-CDSC-PUR-PRIMARY.
180050200423
180060200423           MOVE FINANCER-SCHEDULE OF FINANCER-SCHED
180070200423                              TO FINANCER-SCHEDULE OF
180080200423                              TRANS-CDSC-PUR-PRIMARY.
180090200423
180100200423           MOVE CDSC-SCHEDULE OF FINANCER-SCHED
180110200423                              TO CDSC-SCHEDULE OF
180120200423                              TRANS-CDSC-PUR-PRIMARY.
180130200423
180140200423           MOVE PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY
180150200423                              TO ORIGINAL-PLACEMENT-DATE OF
180160200423                              TRANS-CDSC-PUR-PRIMARY.
180170200423
180180200423           MOVE TRANS-NO      OF TRANS-CDSC-PUR-PRIMARY
180190200423                              TO ORIGINAL-TRANS-NO       OF
180200200423                              TRANS-CDSC-PUR-PRIMARY.
180210200423
180220200423           MOVE CDSC-SEQ-NO   OF TRANS-CDSC-PUR-PRIMARY
180230200423                              TO ORIGINAL-CDSC-SEQ-NO    OF
180240200423                              TRANS-CDSC-PUR-PRIMARY.
180250200423       PSL-EXIT.
180260200423           EXIT.
180270200423      /
180280200423       POST-CDSC-PURCHASE-LIABILITY SECTION.
180290200423
180300200423      ******************************************************************
180310200423      *    P O S T   C D S C   P U R C H A S E   L I A B I L I T Y     *
180320200423      ******************************************************************
180330200423
180340200423       PCPL-0000.
180350200423           IF NOT TRANSFER-LIABILITY
180360200423             PERFORM INITIALIZE-LIABILITY-PORTION
180370200423             GO TO PCPL-EXIT
180380200423           END-IF.
180390200423
180400200423      ** CREATE LIABILITY FOR UNPAID COMMISSION RECORDS
180410200423      ** FORMAT LIABILITY RECORD PORTION **
180420200423
180430200423           PERFORM INITIALIZE-LIABILITY-PORTION.
180440200423
180450200423      ** IF GOING TO A ZERO COMMISSION INVESTMENT NO LIABILITY
180460200423      ** IS INCURRED
180470200423
180480200423           IF COMM-AMT OF TRANS-COMMISSION IS EQUAL TO 0
180490200423               MOVE ZEROES             TO  AGE-DATE
180500200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
180510200423               MOVE ZEROES             TO  UNIT-PRICE
180520200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
180530200423             GO TO PCPL-EXIT
180540200423           END-IF.
180550200423
180560200423      ** SETUP AGE DATE AND COST   **
180570200423
180580200423           MOVE UNIT-PRICE OF TRANS
180590200423                             TO UNIT-PRICE OF TRANS-CDSC-PUR-PRIMARY.
180600200423           MOVE TRADE-DATE OF TRANS
180610200423                             TO AGE-DATE   OF TRANS-CDSC-PUR-PRIMARY.
180620200423           MOVE COMM-AMT OF TRANS-COMMISSION
180630200423                             TO LIABILITY-IN
180640200423                             OF TRANS-CDSC-PUR-PRIMARY.
180650200423           MOVE DEALER-CODE OF TRANS
180660200423                              TO DEALER-CODE OF TRANS-CDSC-PUR-PRIMARY.
180670200423           MOVE DEALER-REP-CODE OF TRANS
180680200423                              TO DEALER-REP-CODE
180690200423                              OF TRANS-CDSC-PUR-PRIMARY.
180700200423           MOVE TRADE-DATE    OF TRANS
180710200423                              TO EXCHANGE-AGE-DATE
180720200423                              OF TRANS-CDSC-PUR-PRIMARY
180730200423                                 AGE-DATE
180740200423                              OF TRANS-CDSC-PUR-PRIMARY.
180750200423           MOVE "Y"           TO COMMISSION-PAID
180760200423                              OF TRANS-CDSC-PUR-PRIMARY
180770200423           MOVE PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY
180780200423                              TO ORIGINAL-PLACEMENT-DATE OF
180790200423                              TRANS-CDSC-PUR-PRIMARY.
180800200423           MOVE TRANS-NO      OF TRANS-CDSC-PUR-PRIMARY
180810200423                              TO ORIGINAL-TRANS-NO       OF
180820200423                              TRANS-CDSC-PUR-PRIMARY.
180830200423           MOVE CDSC-SEQ-NO   OF TRANS-CDSC-PUR-PRIMARY
180840200423                              TO ORIGINAL-CDSC-SEQ-NO    OF
180850200423                              TRANS-CDSC-PUR-PRIMARY.
180860200423       PCPL-EXIT.
180870200423           EXIT.
180880200423      /
180890200423       POST-CDSC-DISTRIB-LIABILITY SECTION.
180900200423
180910200423      ******************************************************************
180920200423      *    P O S T   C D S C   D I S T R I B .   L I A B I L I T Y     *
180930200423      ******************************************************************
180940200423
180950200423       PCDL-0000.
180960200423           PERFORM INITIALIZE-LIABILITY-PORTION.
180970200423           IF NOT TRANSFER-LIABILITY
180980200423             GO TO PCDL-EXIT
180990200423           END-IF.
181000200423
181010200423           IF REINVEST-DISTR-AS OF TRANS-CDSC-PUR-PRIMARY = "F"
181020200423               MOVE ZEROES             TO  AGE-DATE
181030200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
181040200423               MOVE ZEROES             TO  UNIT-PRICE
181050200423                                           OF TRANS-CDSC-PUR-PRIMARY-REC
181060200423             MOVE "Y"        TO LIABILITY-EXPIRED
181070200423                             OF TRANS-CDSC-PUR-PRIMARY
181080200423                                COMMISSION-PAID
181090200423                             OF TRANS-CDSC-PUR-PRIMARY
181100200423           ELSE
181110200423             MOVE "N"        TO LIABILITY-EXPIRED
181120200423                             OF TRANS-CDSC-PUR-PRIMARY
181130200423             MOVE "N"        TO COMMISSION-PAID
181140200423                             OF TRANS-CDSC-PUR-PRIMARY
181150200423           END-IF.
181160200423
181170200423       PCDL-EXIT.
181180200423           EXIT.
181190200423      /
181200200423       INITIALIZE-LIABILITY-PORTION SECTION.
181210200423
181220200423      ******************************************************************
181230200423      *    I N I T I A L I Z E   L I A B I L I T Y   P O R T I O N     *
181240200423      ******************************************************************
181250200423
181260200423       ILP-0000.
181270200423           MOVE 0             TO LIABILITY-OUT
181280200423                              OF TRANS-CDSC-PUR-PRIMARY
181290200423                                 LIABILITY-IN
181300200423                              OF TRANS-CDSC-PUR-PRIMARY
181310200423                                 EXCHANGE-AGE-DATE
181320200423                              OF TRANS-CDSC-PUR-PRIMARY
181330200423                                 ORIGINAL-PLACEMENT-DATE
181340200423                              OF TRANS-CDSC-PUR-PRIMARY
181350200423                                 ORIGINAL-TRANS-NO
181360200423                              OF TRANS-CDSC-PUR-PRIMARY
181370200423                                 ORIGINAL-CDSC-SEQ-NO
181380200423                              OF TRANS-CDSC-PUR-PRIMARY.
181390200423           MOVE "N"           TO LIABILITY-EXPIRED
181400200423                              OF TRANS-CDSC-PUR-PRIMARY
181410200423                                 COMMISSION-PAID
181420200423                              OF TRANS-CDSC-PUR-PRIMARY.
181430200423           MOVE SPACES        TO DEALER-CODE
181440200423                              OF TRANS-CDSC-PUR-PRIMARY
181450200423                                 DEALER-REP-CODE
181460200423                              OF TRANS-CDSC-PUR-PRIMARY.
181470200423       ILP-EXIT.
181480200423           EXIT.
181490200423      /
181500200423       CHANGE-WIRE-ORDER-CDSC-STATUS SECTION.
181510200423
181520200423      ******************************************************************
181530200423      *    C H A N G E   W I R E   O R D E R   C D S C   S T A T U S   *
181540200423      ******************************************************************
181550200423
181560200423       PWCS-0000.
181570200423
181580200423     ** NOTE ON CDSC STATUS
181590200423     ** THERE ARE 3 STATUS CODES - A - THIS CDSC RECORD IS ACTIVE AND
181600200423     **                                CAN BE USED BY A REDEMPTION
181610200423     **                            X - CDSC UNITS HAVE BEEN EXHAUSTED
181620200423     **                            O - THESE ARE OTR UNITS POSTED TO CDSC FILE
181630200423     **                                THAT WILL HAVE THEIR STATUS CHANGED TO
181640200423     **                                'A' UPON SETTLEMENT
181650200423
181660200423           IF NOT BACK-END-LOAD AND NOT OLD-BACK-END-LOAD
181670200423             GO TO PWCS-EXIT
181680200423           END-IF.
181690200423
181700200423      * Get the CDSC purchase record - error if not found
181710200423
181720200423           MOVE PLACEMENT-DATE OF TRANS
181730200423                TO PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY.
181740200423
181750200423           MOVE TRANS-NO OF TRANS
181760200423                TO TRANS-NO OF TRANS-CDSC-PUR-PRIMARY.
181770200423
181780200423           MOVE ZEROES
181790200423                TO CDSC-SEQ-NO OF TRANS-CDSC-PUR-PRIMARY
181800200423                   PARENT-TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
181810200423                   PARENT-PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY
181820200423                   PARENT-CDSC-SEQ-NO OF TRANS-CDSC-PUR-PRIMARY.
181830200423
181840200423           START TRANS-CDSC-PUR-PRIMARY
181850200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
181860200423             INVALID KEY
181870200423             DISPLAY "CDSC RE-POST RECORD NOT FOUND ",
181880200423                     ACCOUNT-NO OF TRANS,
181890200423                     INVESTMENT-CODE OF TRANS,
181900200423                     PLACEMENT-DATE OF TRANS,
181910200423                     TRANS-NO OF TRANS
181920200423             GO TO PWCS-EXIT.
181930200423
181940200423       PWCS-0010.
181950200423           READ TRANS-CDSC-PUR-PRIMARY  NEXT RECORD
181960200423           WITH NO LOCK
181970200423             AT END
181980200423             GO TO PWCS-EXIT.
181990200423
182000200423           IF (PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY IS NOT EQUAL
182010200423             PLACEMENT-DATE OF TRANS) OR
182020200423             (TRANS-NO      OF TRANS-CDSC-PUR-PRIMARY IS NOT EQUAL
182030200423             TRANS-NO     OF TRANS)
182040200423             GO TO PWCS-EXIT.
182050200423
182060200423           MOVE "A"            TO CDSC-STATUS OF TRANS-CDSC-PUR-PRIMARY.
182070200423
182080200423      * RFS13839 - Begin
182090200423      *    IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
182100200423      *    AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
182110200423           IF  WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
182120200423      * RFS13839 - End
182130200423      *    RFS71433 -Begin
182140200423      *    RFS71433.1 -Begin
182150200423      *      Perform UpdTransPurFreeUnits
182160200423      *    RFS71433.1 -End
182170200423      *    RFS71433 -End
182180200423             REWRITE TRANS-CDSC-PUR-PRIMARY-REC
182190200423                   INVALID KEY
182200200423                       CONTINUE
182210200423               END-REWRITE
18222020042358714          IF WS-FILE-STATUS IS NOT EQUAL TO "00"
18223020042358714           MOVE "MFATRNCPP" TO WS-FILE-STATUS-FILE-NAME
18224020042358714           SET lncc_Err111  TO  TRUE
18225020042358714           PERFORM LOG-FILE-STATUS
18226020042358714          END-IF
182270200423           END-IF.
182280200423
182290200423           GO TO PWCS-0010.
182300200423
182310200423       PWCS-EXIT.
182320200423           EXIT.
182330200423      /
182340200423       COPY CPCALDR.
182350200423      /
182360200423      * MULTI LOCK MOD
182370200423       COPY CPDSCLCK5.
182380200423      * MULTI LOCK MOD END
182390200423      /
182400200423      * MULTI LOCK MOD END
182410200423      /
182420200423       POST-EXCLUDED-DISTRIB-UNITS SECTION.
182430200423
182440200423      ******************************************************************
182450200423      *    P O S T   E X C L U D E D   D I S T R I B .   U N I T S     *
182460200423      ******************************************************************
182470200423
182480200423       PEDU-0000.
182490200423             IF NOT EXCLUDE-DISTRIBUTIONS
182500200423               GO TO PEDU-EXIT
182510200423             END-IF.
182520200423
182530200423           MOVE ACCOUNT-NO OF TRANS
182540200423                               TO ACCOUNT-NO OF
182550200423                               ACCT-INVEST-ACCUM-DIST.
182560200423           MOVE INVESTMENT-CODE OF TRANS
182570200423                               TO INVESTMENT-CODE OF
182580200423                               ACCT-INVEST-ACCUM-DIST.
182590200423           READ ACCT-INVEST-ACCUM-DIST WITH NO LOCK
182600200423             INVALID KEY
182610200423             MOVE "W"          TO WRITE-ACCT-INV-DIST-ACCUM.
182620200423
182630200423           IF WRITE-ACCT-INV-DIST-ACCUM IS EQUAL TO "W"
182640200423             MOVE ACCOUNT-NO OF TRANS
182650200423                               TO ACCOUNT-NO OF
182660200423                               ACCT-INVEST-ACCUM-DIST
182670200423             MOVE INVESTMENT-CODE OF TRANS
182680200423                               TO INVESTMENT-CODE OF
182690200423                               ACCT-INVEST-ACCUM-DIST
182700200423             MOVE ZEROES       TO UNIT-AMT OF
182710200423                               ACCT-INVEST-ACCUM-DIST
182720200423           ELSE
182730200423             MOVE "R"          TO WRITE-ACCT-INV-DIST-ACCUM
182740200423           END-IF.
182750200423
182760200423           IF DISTRIBUTION-TRANSACTION
182770200423             ADD UNIT-AMT OF TRANS
182780200423                               TO UNIT-AMT
182790200423                               OF ACCT-INVEST-ACCUM-DIST
182800200423           END-IF.
182810200423
182820200423           ADD WS-EXCLUDE-FREE-UNITS
182830200423                               TO UNIT-AMT
182840200423                               OF ACCT-INVEST-ACCUM-DIST.
182850200423
182860200423           MOVE ZEROES         TO WS-EXCLUDE-FREE-UNITS.
182870200423
182880200423       PEDU-EXIT.
182890200423            EXIT.
182900200423      /
182910200423       POST-INTEREST-BALANCE SECTION.
182920200423
182930200423      ******************************************************************
182940200423      *    P O S T   I N T E R E S T   B A L A N C E   R O U T I N E   *
182950200423      ******************************************************************
182960200423
182970200423       PIB-0000.
182980200423           PERFORM GET-INTEREST-ACCRUAL-RECORD.
182990200423           IF WS-ACCRUAL-RECORD-FOUND IS NOT EQUAL TO "Y"
183000200423             MOVE "W"          TO WRITE-ACCOUNT-INV-ACCRUALS
183010200423             GO TO PIB-0010
183020200423           END-IF.
183030200423
183040200423           MOVE "R"            TO WRITE-ACCOUNT-INV-ACCRUALS.
183050200423           GO TO PIB-0020.
183060200423
183070200423       PIB-0010.
183080200423
183090200423           INITIALIZE MFAACCIAP.
183100200423
183110200423           MOVE ACCOUNT-NO OF TRANS
183120200423                            TO ACCOUNT-NO OF ACCOUNT-INV-ACCRUALS.
183130200423           MOVE INVESTMENT-CODE OF TRANS
183140200423                            TO INVESTMENT-CODE OF ACCOUNT-INV-ACCRUALS.
183150200423
183160200423       PIB-0020.
183170200423
183180200423           ADD ACCRUAL-ADJUSTMENT-AMT OF TRANS-INTEREST-DETAILS
183190200423                            TO ADJUSTMENTS OF ACCOUNT-INV-ACCRUALS.
183200200423           ADD ACCRUAL-ADJUSTMENT-AMT OF TRANS-INTEREST-DETAILS
183210200423                            TO ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS.
183220200423
183230200423       PIB-EXIT.
183240200423           EXIT.
183250200423      /
183260200423       GENERATE-INTEREST-TRADE SECTION.
183270200423
183280200423      ******************************************************************
183290200423      *    G E N E R A T E   I N T E R E S T   T R A D E   R T N .     *
183300200423      ******************************************************************
183310200423
183320200423       GIT-0000.
183330200423137833     INITIALIZE li_AccrualAmt.
183340200423           IF NOT GIC-INVESTMENT
183350200423             IF CURR-UNIT-BAL OF ACCOUNT-INVESTMENT IS NOT EQUAL 0
183360200423               GO TO GIT-EXIT
183370200423             END-IF
183380200423           ELSE
183390200423             IF CURRENT-CERTIFICATE-BALANCE
183400200423             OF GIC-CERTIFICATE-DETAILS IS NOT EQUAL 0
183410200423               GO TO GIT-EXIT
183420200423             END-IF
183430200423           END-IF.
183440200423
183450200423           PERFORM GET-INTEREST-ACCRUAL-RECORD.
183460200423
183470200423      * If this transaction exhausts the investment, change split option
183480200423      * to all gross
183490200423
183500200423           MOVE SPLIT-OPTION-CODE OF WS-TRANS-REC
183510200423                             TO WS-SAV-SPLIT-OPTION-CODE.
183520200423
183530200423           MOVE WS-TRANS-REC TO TRANS-PRIMARY-REC.
183540200423138770* Do not read trans file and update in calculator mode.
183550200423138770     IF PASS-CDSC-CALCULATOR = "C" AND
183560200423138770        ACCOUNT-LEV-FREE-DOLLARS AND
183570201223      *RFS180707 - Starts
183580201223              lnc_ACINDSCNo AND
183590201223      *RFS180707 - Ends
183600200423138770        SPLIT-OPTION-CODE OF WS-TRANS-REC = "A" AND
183610200423138770        GIC-INVESTMENT
183620200423138770          GO TO GIT-0010
183630200423138770     END-IF.
183640200423
183650200423           READ TRANS-PRIMARY WITH NO LOCK
183660200423           INVALID KEY
183670200423             DISPLAY "ERROR READING PRIMARY IN INT ROUTINE"
183680200423             GO TO GIT-EXIT
183690200423           END-READ.
183700200423
183710200423           MOVE "A"           TO SPLIT-OPTION-CODE OF TRANS-PRIMARY.
183720200423
183730200423           REWRITE TRANS-PRIMARY-REC
183740200423           INVALID KEY
183750200423             DISPLAY "ERROR UPDATING PRIMARY IN INT ROUTINE"
18376020042358714         MOVE "MFATRNP" TO WS-FILE-STATUS-FILE-NAME
18377020042358714         SET lncc_Err112  TO  TRUE
18378020042358714         PERFORM LOG-FILE-STATUS
183790200423             GO TO GIT-EXIT
183800200423           END-REWRITE.
183810200423
18382020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
18383020042358714         MOVE "MFATRNP" TO WS-FILE-STATUS-FILE-NAME
18384020042358714         SET lncc_Err113  TO  TRUE
18385020042358714         PERFORM LOG-FILE-STATUS
18386020042358714      END-IF.
183870200423
183880200423138770 GIT-0010.
183890200423           MOVE "A"          TO SPLIT-OPTION-CODE OF WS-TRANS-REC.
183900200423           MOVE "G"          TO GROSS-OR-NET OF WS-TRANS-REC.
183910200423
183920200423           IF WS-ACCRUAL-RECORD-FOUND IS NOT EQUAL TO "Y"
183930200423              GO TO GIT-EXIT
183940200423           END-IF.
183950200423
183960200423      * RFS11194 - Begin
183970200423           IF GIC-INVESTMENT
183980200423               PERFORM GET-GIC-INT-ADJUST-REASON-DET
183990200423               COMPUTE ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS ROUNDED =
184000200423                    ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS + WS-TEMP-AMT
184010200423           END-IF
184020200423      * RFS11194 - End
184030200423
184040200423           IF ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS IS EQUAL 0
184050200423              GO TO GIT-EXIT
184060200423           END-IF.
184070200423
184080200423      *RFS 7390 BEGIN
184090200423           MOVE "Y"          TO WS-STD-GIC-INT.
184100200423           IF GIC-INVESTMENT
184110200423             MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
184120200423                             TO ACCOUNT-TYPE-CODE
184130200423                             OF CONTR-REDEM-CODE-RULES
184140200423
184150200423             MOVE CONTR-REDEM-CODE OF TRANS-REC
184160200423                             TO CONTR-REDEM-CODE
184170200423                             OF CONTR-REDEM-CODE-RULES
184180200423             READ CONTR-REDEM-CODE-RULES
184190200423             INVALID KEY
184200200423               MOVE SPACES   TO CONTR-REDEM-CODE-RULE
184210200423                             OF CONTR-REDEM-CODE-RULES
184220200423             END-READ
184230200423             IF CONTR-REDEM-CODE-RULE OF CONTR-REDEM-CODE-RULES
184240200423137833*      IS EQUAL "40"
184250200423137833       IS EQUAL "40" OR lc_TrfCertDtl = "Y"
184260200423               MOVE "N"      TO WS-STD-GIC-INT
184270200423             END-IF
184280200423           END-IF.
184290200423      *RFS 7390 END
184300200423           MOVE TRANS-REC   TO WS-INTEREST-TRANS.
184310200423           MOVE SPACES      TO BATCH-CODE OF WS-INTEREST-TRANS.
184320200423           MOVE ZEROES      TO BATCH-DATE OF WS-INTEREST-TRANS.
184330200423           MOVE "INT"       TO TRANS-TYPE-CODE OF WS-INTEREST-TRANS.
184340200423           MOVE "DIR"       TO TRANS-ORIGIN-CODE OF WS-INTEREST-TRANS.
184350200423
184360200423      * RFS 112136 - begins.
184370200423           IF PASS-CDSC-CALCULATOR IS EQUAL TO "X"
184380200423              MOVE "DTH"   TO TRANS-ORIGIN-CODE OF WS-INTEREST-TRANS
184390200423           END-IF.
184400200423      * RFS 112136 - ends.
184410200423      * RFS 126805 - Starts
184420200423      * RFS 124507 - begins.
184430200423      *    IF PASS-CDSC-CALCULATOR IS EQUAL TO "W"
184440200423      *       MOVE "MAT"   TO TRANS-ORIGIN-CODE OF WS-INTEREST-TRANS
184450200423      *    END-IF.
184460200423      * RFS 124507 - ends.
184470200423      * RFS 126805 - Ends.
184480200423      *RFS 7390 BEGIN
184490200423           IF WS-STD-GIC-INT IS EQUAL "Y"
184500200423      *RFS17685 Start
184510200423R27609       IF (SPEC-MOD-AUTH-MMINTA OR EC) AND
184520200423R27609          MM-ADJ-RED-TRANSACTION AND
184530200423                BACKDATED-TRADE AND BACKDATED-TO-CUR-MONTH
184540200423                  COMPUTE GROSS-AMT OF WS-INTEREST-TRANS ROUNDED =
184550200423                          (ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS +
184560200423                          LK-ACCRUAL-AMT) * 1
184570200423             ELSE
184580200423      *RFS17685 End
184590200423             COMPUTE GROSS-AMT OF WS-INTEREST-TRANS ROUNDED =
184600200423             ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS * 1
184610200423      *RFS17685 Start
184620200423             END-IF
184630200423      *RFS17685 End
184640200423             MOVE GROSS-AMT OF WS-INTEREST-TRANS
184650200423                            TO NET-AMT OF WS-INTEREST-TRANS
184660200423           ELSE
184670200423             MOVE ZEROES    TO NET-AMT OF WS-INTEREST-TRANS
184680200423                               GROSS-AMT OF WS-INTEREST-TRANS
184690200423             MOVE "Y"       TO HIDDEN-TRANS OF WS-INTEREST-TRANS
184700200423                               SUPPRESS-CONFIRMATION
184710200423                               OF WS-INTEREST-TRANS
184720200423           END-IF
184730200423      *RFS 7390 END
184740200423           MOVE ZEROES      TO PERCENT-AMT OF WS-INTEREST-TRANS.
184750200423           MOVE ZEROES      TO UNIT-AMT OF WS-INTEREST-TRANS.
184760200423           MOVE ZEROES      TO UNIT-PRICE OF WS-INTEREST-TRANS.
184770200423           MOVE ZEROES      TO CLOSING-UNIT-BAL OF WS-INTEREST-TRANS.
184780200423           MOVE ZEROES      TO TRANS-PROC-SEQ-NO OF WS-INTEREST-TRANS.
184790200423           MOVE "00"        TO REJECTION-CODE OF WS-INTEREST-TRANS.
184800200423           MOVE "G"         TO GROSS-OR-NET OF WS-INTEREST-TRANS.
184810200423           MOVE ZEROES      TO TRANS-SEQ-NO OF WS-INTEREST-TRANS.
184820200423           MOVE SPACES      TO WIRE-ORDER-NO OF WS-INTEREST-TRANS.
184830200423           MOVE ZEROES      TO SETTLEMENT-DATE OF WS-INTEREST-TRANS.
184840200423           MOVE "G"         TO SETTLED-GROSS-OR-NET OF WS-INTEREST-TRANS.
184850200423           MOVE ZEROES      TO SETTLEMENT-AMT OF WS-INTEREST-TRANS.
184860200423           MOVE "DIST"      TO CONTR-REDEM-CODE OF WS-INTEREST-TRANS.
184870200423           MOVE "PND"       TO TRANS-STATUS-CODE OF WS-INTEREST-TRANS.
184880200423           MOVE "N"         TO HIDDEN-TRANS OF WS-INTEREST-TRANS.
184890200423           MOVE ZEROES      TO AVERAGE-UNIT-COST OF WS-INTEREST-TRANS.
184900200423           MOVE ZEROES      TO RESULTANT-AVERAGE-UNIT-COST
184910200423                            OF WS-INTEREST-TRANS.
184920200423           MOVE "$"         TO SPLIT-OPTION-CODE OF WS-INTEREST-TRANS.
184930200423           MOVE "N"         TO RECEIPTED OF WS-INTEREST-TRANS.
184940200423           MOVE SPACES      TO RECEIPT-NUMBER OF WS-INTEREST-TRANS.
184950200423           MOVE SPACES      TO INSTITUTION-CODE OF WS-INTEREST-TRANS.
184960200423           MOVE SPACES      TO BRANCH-CODE OF WS-INTEREST-TRANS.
184970200423           MOVE SPACES      TO REVERSAL-CODE OF WS-INTEREST-TRANS.
184980200423           MOVE SPACES      TO PAYMENT-TYPE-CODE OF WS-INTEREST-TRANS.
184990200423           MOVE "N"         TO REVERSE OF WS-INTEREST-TRANS.
185000200423           MOVE "N"         TO ADJUST OF WS-INTEREST-TRANS.
185010200423      *RFS17685 Start
185020200423      * The automatic interest adjustment transaction for the backdated
185030200423      * trade is not processed yet. So this amount is not reflected in
185040200423      * the ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS therefore should be
185050200423      * deducted. (LK-ACCRUAL-AMT is negative for the SEL trans)
185060200423
185070200423R27609     IF (SPEC-MOD-AUTH-MMINTA OR EC) AND MM-ADJ-RED-TRANSACTION
185080200423R27609        AND BACKDATED-TRADE AND BACKDATED-TO-CUR-MONTH
185090200423              COMPUTE ACCRUAL-AMT OF WS-TRANS-INTEREST-DETAILS =
185100200423                ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS + LK-ACCRUAL-AMT
185110200423           ELSE
185120200423      *RFS17685 End
185130200423           MOVE ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS
185140200423                            TO ACCRUAL-AMT
185150200423                            OF WS-TRANS-INTEREST-DETAILS
185160200423      *RFS17685 Start
185170200423           END-IF.
185180200423      *RFS17685 End
185190200423           MOVE ZEROES      TO ACCRUAL-ADJUSTMENT-AMT
185200200423                            OF WS-TRANS-INTEREST-DETAILS.
185210200423
185220200423           MOVE FIRST-ACCRUAL-DATE    OF ACCOUNT-INV-ACCRUALS
185230200423                            TO START-DATE
185240200423                            OF WS-TRANS-INTEREST-DETAILS.
185250200423      *RFS17685 Start
185260200423      * The END-DATE should be the TRADE-DATE for backdated trades.
185270200423R27609     IF (SPEC-MOD-AUTH-MMINTA OR EC) AND MM-ADJ-RED-TRANSACTION
185280200423R27609        AND BACKDATED-TRADE AND BACKDATED-TO-CUR-MONTH
18529020042328282        IF ACCRUE-ON-BUY-OR-SELL-DAY OF INVESTMENT = "C"
18530020042328282           MOVE TRADE-DATE OF TRANS
18531020042328282             TO BUSINESS-DAY OF BUSINESS-DAYS
18532020042328282           PERFORM GET-PRV-BUSINESS-DAY THRU GPBD-EXIT
18533020042328282           MOVE BUSINESS-DAY OF BUSINESS-DAYS
18534020042328282             TO END-DATE OF WS-TRANS-INTEREST-DETAILS
18535020042328282        ELSE
185360200423                MOVE TRADE-DATE        OF TRANS
185370200423                                       TO END-DATE
185380200423                                       OF WS-TRANS-INTEREST-DETAILS
18539020042328282        END-IF
185400200423           ELSE
185410200423      *RFS17685 End
185420200423           MOVE LAST-ACCRUAL-DATE OF ACCOUNT-INV-ACCRUALS
185430200423                            TO END-DATE
185440200423                            OF WS-TRANS-INTEREST-DETAILS
185450200423      *RFS17685 Start
185460200423           END-IF.
185470200423      *RFS17685 End
185480200423
185490200423           MOVE LAST-ACCRUED-ON-UNIT-BALANCE OF ACCOUNT-INV-ACCRUALS
185500200423                            TO BASED-ON-UNITS
185510200423                            OF WS-TRANS-INTEREST-DETAILS.
185520200423
185530200423           MOVE "R"         TO  DISTR-OPTION-CODE
185540200423                            OF WS-TRANS-INTEREST-DETAILS.
185550200423
185560200423           MOVE PASS-PROCESS-DATE-9
185570200423                            TO PLACEMENT-DATE OF WS-INTEREST-TRANS.
185580200423
185590200423           MOVE PLACEMENT-DATE OF WS-INTEREST-TRANS
185600200423                            TO PLACEMENT-DATE
185610200423                            OF WS-TRANS-INTEREST-DETAILS.
185620200423
185630200423       GIT-0500.
185640200423138770* Do not read trans file and update in calculator mode.
185650200423138770     IF PASS-CDSC-CALCULATOR = "C" AND
185660200423138770        ACCOUNT-LEV-FREE-DOLLARS AND
185670201223      *RFS180707 - Starts
185680201223              lnc_ACINDSCNo AND
185690201223      *RFS180707 - Ends
185700200423138770        SPLIT-OPTION-CODE OF WS-TRANS-REC = "A" AND
185710200423138770        GIC-INVESTMENT
185720200423138770          GO TO GIT-0600
185730200423138770     END-IF.
185740200423
185750200423           MOVE "INT#"      TO CONTROL-CODE OF CONTROL-FILE.
185760200423      * RFS20711 - Begin
185770200423           MOVE "CONTROL FILE INT"   TO WS-TEMP-STR
185780200423           PERFORM READ-CONTROL-FILE                                    RFS9530
185790200423      * RFS20711 - End
185800200423
185810200423           MOVE NEXT-NUMBER OF CONTROL-FILE
185820200423                            TO TRANS-NO OF WS-INTEREST-TRANS
185830200423                            TRANS-NO OF WS-TRANS-INTEREST-DETAILS.
185840200423
185850200423           ADD 1            TO NEXT-NUMBER OF CONTROL-FILE.
185860200423
185870200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
185880200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
185890200423      * RFS20711 - Begin (Replaced "REWRITE" with "PERFORM ...")
185900200423             PERFORM REWRITE-CONTROL-FILE                               RFS9530
185910200423      * RFS20711 - End
185920200423           END-IF.
185930200423
185940200423      * This logic to insure that the update does not by accident      n
185950200423      * overlay a transaction
185960200423
185970200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
185980200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
185990200423
186000200423             MOVE PLACEMENT-DATE OF WS-INTEREST-TRANS
186010200423                            TO PLACEMENT-DATE
186020200423                            OF TRANS-PRIMARY
186030200423             MOVE TRANS-NO OF WS-INTEREST-TRANS
186040200423                            TO TRANS-NO
186050200423                            OF TRANS-PRIMARY
186060200423             READ TRANS-PRIMARY WITH NO LOCK
186070200423               NOT INVALID KEY
186080200423               GO TO GIT-0500
186090200423             END-READ
186100200423           END-IF.
186110200423
186120200423138770 GIT-0600.
186130200423           INITIALIZE WRITE-SWITCHES.
186140200423           MOVE "N"                    TO  WS-MFAACCASP-WSW.
186150200423           MOVE "N"                    TO  WS-MFAACCASPA-WSW.
186160200423           MOVE "N"                    TO  WS-MFAIVRCLP-WSW.
186170200423           MOVE "N"                    TO  WS-MFATRNASP-WSW.
186180200423106558     MOVE "N"                    TO  WS-MFAACCLNP-WSW.
186190200423
186200200423      * RFS18568 Begin
186210200423      * This routine is used to set the distribution option and
186220200423      * payment type for account investments which have the
186230200423      * income distribution option set to cash.
186240200423      * Executed if Screen-Edit-Allowed record exists.
186250200423           IF   WS-EDIT-CSH-DST-PAY-MTHD = "Y"
186260200423            AND INCOME-DISTR-OPTION OF ACCOUNT-INVESTMENT = "C"
186270200423                PERFORM CASH-DIST-PAYMENT-METHOD
186280200423           END-IF.
186290200423      * RFS18568 End
186300200423
186310200423           MOVE "W"            TO WRITE-TRANS-INTEREST-DETAILS
186320200423                                  WRITE-TRANS-TARGET.
186330200423
186340200423      *GIC MOD
186350200423           IF NOT GIC-DII-INVESTMENT
186360200423             MOVE "R"            TO WRITE-ACCOUNT-INV-ACCRUALS
186370200423           END-IF.
186380200423      *END GIC MOD
186390200423
186400200423           MOVE "Y"            TO WS-NO-READ.
186410200423           MOVE "3"            TO WS-INTEREST-GENERATED.
186420200423
186430200423      *RFS17685 Start
186440200423      * Computation of payout amount should take the adjusted interest
186450200423      * amount into sonsideration. And also the same amount should be
186460200423      * left in the ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS file so that
186470200423      * when the automatic adj transaction goes into HST, it will make
186480200423      * this zero.
186490200423
186500200423R27609     IF (SPEC-MOD-AUTH-MMINTA OR EC) AND MM-ADJ-RED-TRANSACTION
186510200423R27609        AND BACKDATED-TRADE AND BACKDATED-TO-CUR-MONTH
186520200423                COMPUTE PAYOUTS OF ACCOUNT-INV-ACCRUALS =
186530200423                  (ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS +
186540200423                  LK-ACCRUAL-AMT) * -1
186550200423                COMPUTE ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS =
186560200423                        LK-ACCRUAL-AMT * -1
186570200423           ELSE
186580200423      *RFS17685 End
186590200423           COMPUTE PAYOUTS OF ACCOUNT-INV-ACCRUALS =
186600200423           ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS * -1
186610200423           MOVE ZERO           TO ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS
186620200423      *RFS17685 Start
186630200423           END-IF.
186640200423      *RFS17685 End
186650200423
186660200423           MOVE PLACEMENT-DATE OF TRANS
186670200423                            TO PLACEMENT-DATE OF TRANS-TARGET.
186680200423           MOVE TRANS-NO       OF TRANS
186690200423                            TO TRANS-NO OF TRANS-TARGET.
186700200423
186710200423           MOVE PLACEMENT-DATE OF WS-INTEREST-TRANS
186720200423                            TO PLACEMENT-DATE-2 OF TRANS-TARGET.
186730200423           MOVE TRANS-NO       OF WS-INTEREST-TRANS
186740200423                            TO TRANS-NO-2 OF TRANS-TARGET.
186750200423           MOVE "REI"       TO RELATIONSHIP-TYPE OF TRANS-TARGET.
186760200423
186770200423           IF GIC-INVESTMENT
186780200423             MOVE PLACEMENT-DATE OF WS-INTEREST-TRANS
186790200423                            TO PLACEMENT-DATE
186800200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186810200423             MOVE TRANS-NO OF WS-INTEREST-TRANS
186820200423                            TO TRANS-NO
186830200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186840200423             MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
186850200423                            TO CERTIFICATE-ID-NO
186860200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186870200423             MOVE "INT"     TO CERT-TXN-RELATIONSHIP
186880200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186890200423             MOVE TRADE-DATE OF WS-INTEREST-TRANS
186900200423                            TO TRADE-DATE
186910200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186920200423             MOVE "Y"       TO CERT-ACTIVE-FLAG
186930200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186940200423             MOVE " "       TO GIC-FILED
186950200423                            OF GIC-TRANS-RELATIONSHIP-PRIMARY
186960200423             MOVE "W"       TO WRITE-GIC-TRANS-RELATIONSHIP
186970200423137833       COMPUTE li_AccrualAmt = ACCRUAL-AMT OF
186980200423137833                               WS-TRANS-INTEREST-DETAILS
186990200423           END-IF.
187000200423
187010200423
187020200423       GIT-EXIT.
187030200423           EXIT.
187040200423
18705020042328282 * ---------------------------------------------------------------
18706020042371045  GET-PRV-BUSINESS-DAY SECTION.
18707020042328282 * ---------------------------------------------------------------
18708020042328282 * Get previous busness day
18709020042328282      START BUSINESS-DAYS
18710020042328282         KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
18711020042328282         INVALID KEY
18712020042328282           GO TO GPBD-EXIT
18713020042328282      END-START.
18714020042328282
18715020042328282  GPBD-0010.
18716020042328282
18717020042328282      READ BUSINESS-DAYS PRIOR RECORD
18718020042328282        AT END
18719020042328282          GO TO GPBD-EXIT
18720020042328282      END-READ.
18721020042328282
18722020042328282      IF ALLOW-TRADING OF BUSINESS-DAYS IS NOT EQUAL TO "Y"
18723020042328282        GO TO GPBD-0010
18724020042328282      END-IF.
18725020042328282
18726020042328282  GPBD-EXIT.
18727020042328282      EXIT.
187280200423      /
187290200423      *RFS17685 Start
187300200423      /
187310200423       GENERATE-INTEREST-ADJUSTMENT SECTION.
187320200423
187330200423      ******************************************************************
187340200423      *    G E N E R A T E   I N T E R E S T  A D J U S T M E N E T RTN*
187350200423      ******************************************************************
187360200423
187370200423       GIA-0000.
187380200423      * Call the MM backdated interest calculator to calculate accrued
187390200423      * interest for the backdated trade.
187400200423
187410200423           MOVE ACCOUNT-NO      OF TRANS
187420200423                                TO LK-ACCOUNT-NO.
187430200423           MOVE INVESTMENT-CODE OF TRANS
187440200423                                TO LK-INVESTMENT-CODE.
187450200423      * RFS 1027849 - Start
187460200423182531*    MOVE TRADE-DATE OF TRANS
187470200423182531*                         TO LK-TRADE-DATE.
187480200423      * RFS 182531 - Start
187490200423      *    MOVE TRADE-DATE OF TRANS
187500200423      *                         TO LK-TRADE-DATE.
187510200423      *    MOVE 99 TO li_AddPeriod.
187520200423      *    IF DISTR-FREQ OF INVESTMENT-GROUP = "MO"
187530200423      *       MOVE PDDA-MONTH-STR-DATE   TO li_Start_DateC
187540200423      *       IF  TRADE-DATE OF TRANS <= PDDA-LAST-MONTH-END
187550200423      *       AND PDDA-MONTH-END IS NOT EQUAL TO "Y"
187560200423      *          MOVE 1 TO li_AddPeriod
187570200423      *       ELSE IF  TRADE-DATE OF TRANS < PDDA-MONTH-STR-DATE
187580200423      *            AND PDDA-MONTH-END IS EQUAL TO "Y"
187590200423      *          MOVE 0 TO li_AddPeriod
187600200423      *       END-IF
187610200423      *       END-IF
187620200423      *    END-IF.
187630200423      *    IF DISTR-FREQ OF INVESTMENT-GROUP = "QT"
187640200423      *       MOVE PDDA-QUARTER-STR-DATE TO li_Start_DateC
187650200423      *       IF  TRADE-DATE OF TRANS <= PDDA-LAST-QUARTER-END
187660200423      *       AND PDDA-QUARTER-END IS NOT EQUAL TO "Y"
187670200423      *          MOVE 3 TO li_AddPeriod
187680200423      *       ELSE IF  TRADE-DATE OF TRANS < PDDA-QUARTER-STR-DATE
187690200423      *            AND PDDA-QUARTER-END IS EQUAL TO "Y"
187700200423      *          MOVE 0 TO li_AddPeriod
187710200423      *       END-IF
187720200423      *       END-IF
187730200423      *    END-IF.
187740200423      *
187750200423      *    IF li_AddPeriod = 99
187760200423      *       MOVE TRADE-DATE OF TRANS TO LK-TRADE-DATE
187770200423      *    ELSE
187780200423      *       MOVE 1 TO li_StartDateDD
187790200423      *       MOVE li_Start_DateC   TO li_Start_Date
187800200423      *                                li_Start_DateD
187810200423      *       MOVE FUNCTION ADD-DURATION
187820200423      *           (li_Start_DateD MONTHS li_AddPeriod) TO li_Start_Date
187830200423      *       MOVE li_Start_Date TO LK-TRADE-DATE
187840200423      *    END-IF.
187850200423      * RFS 182531 - End
187860200423      * RFS 1027849 - End
187870200423
187880200423      * RFS 182531 - Start
187890200423           MOVE 99 TO li_AddPeriod.
187900200423           IF DISTR-FREQ OF INVESTMENT-GROUP = "MO"
187910200423              MOVE PDDA-MONTH-STR-DATE   TO li_Start_DateC
187920200423              IF  TRADE-DATE OF TRANS <= PDDA-LAST-MONTH-END
187930200423              AND PDDA-MONTH-END IS NOT EQUAL TO "Y"
187940200423                 MOVE 1 TO li_AddPeriod
187950200423              ELSE IF  TRADE-DATE OF TRANS < PDDA-MONTH-STR-DATE
187960200423                   AND PDDA-MONTH-END IS EQUAL TO "Y"
187970200423                 MOVE 0 TO li_AddPeriod
187980200423              END-IF
187990200423              END-IF
188000200423           END-IF.
188010200423           IF DISTR-FREQ OF INVESTMENT-GROUP = "QT"
188020200423              MOVE PDDA-QUARTER-STR-DATE TO li_Start_DateC
188030200423              IF  TRADE-DATE OF TRANS <= PDDA-LAST-QUARTER-END
188040200423              AND PDDA-QUARTER-END IS NOT EQUAL TO "Y"
188050200423                 MOVE 3 TO li_AddPeriod
188060200423              ELSE IF  TRADE-DATE OF TRANS < PDDA-QUARTER-STR-DATE
188070200423                   AND PDDA-QUARTER-END IS EQUAL TO "Y"
188080200423                 MOVE 0 TO li_AddPeriod
188090200423              END-IF
188100200423              END-IF
188110200423           END-IF.
188120200507
188130200507      * RFS 1021726 - Start
188140200507           INITIALIZE LK-INTADJINFO.
188150200507      * RFS 1021726 - End
188160200423           IF li_AddPeriod = 99
188170200423              MOVE TRADE-DATE OF TRANS TO LK-TRADE-DATE
188180200507           ELSE
188190200507      * RFS 1021726 - Start
188200200507              MOVE "PRVPER"            TO LK-INTADJINFO
188210200507      * RFS 1021726 - End
188220200423              MOVE 1 TO li_StartDateDD
188230200423              MOVE li_Start_DateC   TO li_Start_Date
188240200423                                       li_Start_DateD
188250200423              MOVE FUNCTION ADD-DURATION
188260200423                  (li_Start_DateD MONTHS li_AddPeriod) TO li_Start_Date
188270200423              MOVE li_Start_Date TO LK-TRADE-DATE
188280200423           END-IF.
188290200423      * RFS 182531 - End
188300200423           MOVE PASS-PROCESS-DATE-9
188310200423                                TO LK-PROCESS-DATE.
188320200423           MOVE UNIT-AMT        OF TRANS
188330200423                                TO LK-UNIT-AMT.
188340200423           MOVE TRANS-TYPE-CODE OF TRANS
188350200423                                TO LK-TRANS-TYPE-CODE.
188360200423           MOVE "N"             TO LK-REVERSAL.
188370200423           MOVE ZEROES          TO LK-ACCRUAL-AMT.
188380200423      * rfs 26666 - start
188390200423           MOVE ZEROES          TO LK-INT-AMT.
188400200423      * rfs 26666 - end
188410200423
188420200423           CALL "FXMMACCR" USING FXMMACCR-PARMS.
188430200423           CANCEL "FXMMACCR".
188440200423
188450200423           IF LK-ACCRUAL-AMT IS EQUAL 0
188460200423            GO TO GIA-EXIT
188470200423           END-IF.
188480200423
188490200423      * Populate the interest accrual adjustment transaction.
188500200423           MOVE TRANS-REC   TO WS-INTEREST-ADJ-TRANS.
188510200423           MOVE SPACES      TO BATCH-CODE
188520200423                            OF WS-INTEREST-ADJ-TRANS.
188530200423           MOVE ZEROES      TO BATCH-DATE
188540200423                            OF WS-INTEREST-ADJ-TRANS.
188550200423           MOVE PASS-PROCESS-DATE-9 TO PLACEMENT-DATE
188560200423                            OF WS-INTEREST-ADJ-TRANS.
188570200423           MOVE PASS-PROCESS-DATE-9 TO TRADE-DATE
188580200423                            OF WS-INTEREST-ADJ-TRANS.
188590200423           MOVE DEALER-CODE OF ACCOUNT TO DEALER-CODE
188600200423                            OF WS-INTEREST-ADJ-TRANS.
188610200423           MOVE DEALER-REP-CODE OF ACCOUNT TO DEALER-REP-CODE
188620200423                            OF WS-INTEREST-ADJ-TRANS.
188630200423           MOVE PAYMENT-TYPE-CODE OF ACCOUNT-INVESTMENT TO
188640200423                            PAYMENT-TYPE-CODE OF WS-INTEREST-ADJ-TRANS.
188650200423           MOVE "INT"       TO TRANS-TYPE-CODE
188660200423                            OF WS-INTEREST-ADJ-TRANS.
188670200423           MOVE "DIR"       TO TRANS-ORIGIN-CODE
188680200423                            OF WS-INTEREST-ADJ-TRANS.
188690200423           MOVE ZEROES      TO GROSS-AMT
188700200423                            OF WS-INTEREST-ADJ-TRANS.
188710200423           MOVE ZEROES      TO NET-AMT
188720200423                            OF WS-INTEREST-ADJ-TRANS.
188730200423           MOVE ZEROES      TO PERCENT-AMT
188740200423                            OF WS-INTEREST-ADJ-TRANS.
188750200423           MOVE ZEROES      TO UNIT-AMT
188760200423                            OF WS-INTEREST-ADJ-TRANS.
188770200423           MOVE ZEROES      TO UNIT-PRICE
188780200423                            OF WS-INTEREST-ADJ-TRANS.
188790200423           MOVE ZEROES      TO CLOSING-UNIT-BAL
188800200423                            OF WS-INTEREST-ADJ-TRANS.
188810200423           MOVE ZEROES      TO TRANS-PROC-SEQ-NO
188820200423                            OF WS-INTEREST-ADJ-TRANS.
188830200423           MOVE ZEROES      TO TRANS-SEQ-NO
188840200423                            OF WS-INTEREST-ADJ-TRANS.
188850200423           MOVE "00"        TO REJECTION-CODE
188860200423                            OF WS-INTEREST-ADJ-TRANS.
188870200423           MOVE "G"         TO GROSS-OR-NET
188880200423                            OF WS-INTEREST-ADJ-TRANS.
188890200423           MOVE SPACES      TO WIRE-ORDER-NO
188900200423                            OF WS-INTEREST-ADJ-TRANS.
188910200423           MOVE ZEROES      TO SETTLEMENT-DATE
188920200423                            OF WS-INTEREST-ADJ-TRANS.
188930200423           MOVE SPACES      TO SETTLED-GROSS-OR-NET
188940200423                            OF WS-INTEREST-ADJ-TRANS.
188950200423           MOVE ZEROES      TO SETTLEMENT-AMT
188960200423                            OF WS-INTEREST-ADJ-TRANS.
188970200423           MOVE "DIST"      TO CONTR-REDEM-CODE
188980200423                            OF WS-INTEREST-ADJ-TRANS.
188990200423           MOVE "PND"       TO TRANS-STATUS-CODE
189000200423                            OF WS-INTEREST-ADJ-TRANS.
189010200423           MOVE "Y"         TO HIDDEN-TRANS
189020200423                            OF WS-INTEREST-ADJ-TRANS.
189030200423           MOVE "Y"         TO SUPPRESS-CONFIRMATION
189040200423                            OF WS-INTEREST-ADJ-TRANS.
189050200423           MOVE "Y"         TO ORIGINAL-DOCUMENTS-RECVD
189060200423                            OF WS-INTEREST-ADJ-TRANS.
189070200423           MOVE ZEROES      TO AVERAGE-UNIT-COST
189080200423                            OF WS-INTEREST-ADJ-TRANS.
189090200423           MOVE ZEROES      TO RESULTANT-AVERAGE-UNIT-COST
189100200423                            OF WS-INTEREST-ADJ-TRANS.
189110200423           MOVE "$"         TO SPLIT-OPTION-CODE
189120200423                            OF WS-INTEREST-ADJ-TRANS.
189130200423           MOVE "N"         TO RECEIPTED
189140200423                            OF WS-INTEREST-ADJ-TRANS.
189150200423           MOVE SPACES      TO RECEIPT-NUMBER
189160200423                            OF WS-INTEREST-ADJ-TRANS.
189170200423           MOVE SPACES      TO INSTITUTION-CODE
189180200423                            OF WS-INTEREST-ADJ-TRANS.
189190200423           MOVE SPACES      TO BRANCH-CODE
189200200423                            OF WS-INTEREST-ADJ-TRANS.
189210200423           MOVE SPACES      TO REVERSAL-CODE
189220200423                            OF WS-INTEREST-ADJ-TRANS.
189230200423           MOVE SPACES      TO PAYMENT-TYPE-CODE
189240200423                            OF WS-INTEREST-ADJ-TRANS.
189250200423           MOVE "N"         TO REVERSE
189260200423                            OF WS-INTEREST-ADJ-TRANS.
189270200423           MOVE "Y"         TO ADJUST
189280200423                            OF WS-INTEREST-ADJ-TRANS.
189290200423
189300200423       GIA-0100.
189310200423      * Following code is to retrieve the TRANS-NO and to make sure not
189320200423      * to overlay a existing transaction.
189330200423
189340200423           MOVE "TRN#"      TO CONTROL-CODE OF CONTROL-FILE.
189350200423
189360200423           READ CONTROL-FILE
189370200423             INVALID KEY
189380200423               MOVE "CONTROL FILE TRN" TO WS-FILE-STATUS-FILE-NAME
18939020042358714          PERFORM LOG-FILE-STATUS-RD.
189400200423
189410200423
189420200423           MOVE NEXT-NUMBER OF CONTROL-FILE
189430200423                            TO TRANS-NO OF WS-INTEREST-ADJ-TRANS
189440200423                            TRANS-NO OF WS-TRANS-INTEREST-ADJ-DETAILS.
189450200423
189460200423           ADD 1            TO NEXT-NUMBER OF CONTROL-FILE.
189470200423
189480200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
189490200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
189500200423           REWRITE CONTROL-FILE-REC
189510200423             INVALID KEY
18952020042358714          CONTINUE
18953020042358714 *        MOVE "CONTROL FILE TRN" TO WS-FILE-STATUS-FILE-NAME
18954020042358714 *        PERFORM LOG-FILE-STATUS
18955020042358714      END-REWRITE
18956020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
18957020042358714         MOVE "MFACTLP" TO WS-FILE-STATUS-FILE-NAME
18958020042358714         SET lncc_Err114  TO  TRUE
18959020042358714         PERFORM LOG-FILE-STATUS
18960020042358714      END-IF
189610200423
189620200423           END-IF.
189630200423
189640200423
189650200423      * This logic to insure that the update does not by accident      n
189660200423      * overlay a transaction
189670200423
189680200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
189690200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
189700200423
189710200423             MOVE PLACEMENT-DATE OF WS-INTEREST-ADJ-TRANS
189720200423                            TO PLACEMENT-DATE
189730200423                            OF TRANS-PRIMARY
189740200423             MOVE TRANS-NO OF WS-INTEREST-ADJ-TRANS
189750200423                            TO TRANS-NO
189760200423                            OF TRANS-PRIMARY
189770200423             READ TRANS-PRIMARY WITH NO LOCK
189780200423               NOT INVALID KEY
189790200423               GO TO GIA-0100
189800200423             END-READ
189810200423           END-IF.
189820200423
189830200423      * Populate the TRANS-INTEREST-ADJ-DETAILS record.
189840200423           INITIALIZE WS-TRANS-INTEREST-ADJ-DETAILS.
189850200423           MOVE PLACEMENT-DATE OF WS-INTEREST-ADJ-TRANS TO
189860200423                PLACEMENT-DATE OF WS-TRANS-INTEREST-ADJ-DETAILS.
189870200423           MOVE TRANS-NO       OF WS-INTEREST-ADJ-TRANS TO
189880200423                TRANS-NO       OF WS-TRANS-INTEREST-ADJ-DETAILS.
189890200423           MOVE LK-ACCRUAL-AMT TO ACCRUAL-ADJUSTMENT-AMT
189900200423                               OF WS-TRANS-INTEREST-ADJ-DETAILS.
189910200423           MOVE ZEROES         TO ACCRUAL-AMT
189920200423                               OF WS-TRANS-INTEREST-ADJ-DETAILS.
189930200423           MOVE UNIT-AMT       OF TRANS TO
189940200423                BASED-ON-UNITS OF WS-TRANS-INTEREST-ADJ-DETAILS.
18995020042328282      IF ACCRUE-ON-BUY-OR-SELL-DAY OF INVESTMENT = "O"
18996020042328282         MOVE TRADE-DATE OF TRANS
18997020042328282           TO BUSINESS-DAY OF BUSINESS-DAYS
18998020042328282         PERFORM GET-NEXT-PROCESS-DATE
18999020042328282         MOVE BUSINESS-DAY OF BUSINESS-DAYS  TO
19000020042328282           START-DATE     OF WS-TRANS-INTEREST-ADJ-DETAILS
19001020042328282      ELSE
190020200423           MOVE TRADE-DATE     OF TRANS TO
190030200423                START-DATE     OF WS-TRANS-INTEREST-ADJ-DETAILS
19004020042328282      END-IF.
190050200423           MOVE PASS-PROCESS-DATE-9     TO
190060200423                END-DATE       OF WS-TRANS-INTEREST-ADJ-DETAILS.
190070200423           MOVE INCOME-DISTR-OPTION OF ACCOUNT-INVESTMENT TO
190080200423                DISTR-OPTION-CODE OF WS-TRANS-INTEREST-ADJ-DETAILS.
190090200423
190100200423           MOVE "W" TO WRITE-TRANS-INTEREST-ADJ-DTLS
190110200423                       WRITE-INTEREST-ADJ-TRANS.
190120200423
190130200423       GIA-EXIT.
190140200423           EXIT.
190150200423      *RFS17685 End
190160200423       GET-INTEREST-ACCRUAL-RECORD SECTION.
190170200423
190180200423      ******************************************************************
190190200423      *    G E T   I N T E R E S T   A C C R U A L   R E C O R D       *
190200200423      ******************************************************************
190210200423
190220200423       GIAR-0000.
190230200423      * GIC MOD
190240200423           IF GIC-DII-INVESTMENT
190250200423             GO TO GIAR-0200
190260200423           END-IF.
190270200423      * END GIC MOD
190280200423           MOVE "N"            TO WS-ACCRUAL-RECORD-FOUND.
190290200423
190300200423           MOVE ACCOUNT-NO OF TRANS
190310200423                               TO ACCOUNT-NO OF ACCOUNT-INV-ACCRUALS.
190320200423           MOVE INVESTMENT-CODE OF TRANS
190330200423                             TO INVESTMENT-CODE OF ACCOUNT-INV-ACCRUALS.
190340200423           READ ACCOUNT-INV-ACCRUALS WITH NO LOCK
190350200423             INVALID KEY
190360200423             GO TO GIAR-EXIT.
190370200423
190380200423           MOVE "Y"            TO WS-ACCRUAL-RECORD-FOUND.
190390200423           GO TO GIAR-EXIT.
190400200423
190410200423      * GIC MOD
190420200423       GIAR-0200.
190430200423
190440200423           MOVE "N"            TO WS-ACCRUAL-RECORD-FOUND.
190450200423           INITIALIZE MFAACCIAP.
190460200423           INITIALIZE WSA-PARMS
190470200423      *RFS10008 - start
190480200423                      WSB-PARMS.                                        RFS10008
190490200423      *RFS10008 - start
190500200423
190510200423      *RFS131445 - Start
190520200423           IF TRANS-ORIGIN-CODE OF TRANS = "DTH"
190530200423137627        MOVE ACCOUNT-NO OF TRANS  TO pn_DthAccount
190540200423137627        MOVE SPACE                TO pc_RtnDthPDy
190550200423137627        Call "FXDTHPDY"     USING pn_DthAccount
190560200423137627                                  pc_RtnDthPDy
190570200423137627        CANCEL "FXDTHPDY"
190580200423137627        IF pc_RtnDthPDy = "Y"
190590200423              GO TO GIAR-EXIT
190600200423137627        END-IF
190610200423           END-IF.
190620200423      *RFS131445 - Ends
190630200423
190640200423           MOVE ACCOUNT-NO OF TRANS
190650200423                               TO WSA-ACCOUNT-NO.
190660200423           MOVE INVESTMENT-CODE OF TRANS
190670200423                               TO WSA-INVESTMENT-CODE.
190680200423           MOVE TRADE-DATE OF TRANS
190690200423                               TO WSA-TRADE-DATE.
190700200423
190710200423           IF GIC-INVESTMENT
190720200423             MOVE CERTIFICATE-ID-NO
190730200423                               OF GIC-CERTIFICATE-DETAILS
190740200423                               TO WSA-CERT-ID-NO
190750200423           END-IF.
190760200423
190770200423           MOVE GROSS-AMT OF TRANS
190780200423                               TO WSA-GROSS-AMT.
190790200423RF8464     MOVE GROSS-AMT OF TRANS
190800200423RF8464                         TO WS-ORIGINAL-GROSS.
190810200423113783     MOVE 0 TO WS-GIC-INT-AMT.
190820200423
190830200423      * Get the accrued int
190840200423           MOVE "IE"            TO WSA-MODE.
190850200423           CALL "INTCLC" USING WSA-PARMS.
190860200423           CANCEL "INTCLC".
190870200423
190880200423112136     IF WSA-INTEREST-AMT <  0
190890200423112136        MOVE ZEROS TO WSA-INTEREST-AMT
190900200423112136     END-IF.
190910200423
190920200423           IF WSA-INTEREST-AMT IS EQUAL 0
190930200423            GO TO GIAR-EXIT
190940200423           END-IF.
190950200423
190960200423           MOVE WSA-INTEREST-AMT
190970200423                               TO ACCRUAL-AMT OF ACCOUNT-INV-ACCRUALS.
190980200423
190990200423113783     MOVE WSA-INTEREST-AMT TO WS-GIC-INT-AMT.
191000200423           MOVE "Y"            TO WS-ACCRUAL-RECORD-FOUND.
191010200423
191020200423      * END GIC MOD
191030200423
191040200423       GIAR-EXIT.
191050200423           EXIT.
191060200423      /
191070200423       VALIDATE-CDSC-PURCHASE SECTION.
191080200423
191090200423      ******************************************************************
191100200423      *    V A L I D A T E   C D S C   P U R C H A S E   R O U T I N E *
191110200423      ******************************************************************
191120200423
191130200423       VCP-0000.
191140200423
191150200423      * RFS 10826 BEGIN
191160200423           MOVE "N"            TO WS-USE-DEFAULT-RATE.
191170200423      * RFS 10826 END
191180200423
191190200423           IF PURCHASE-TRANSACTION AND BACK-END-LOAD
191200200423             MOVE PLACEMENT-DATE OF TRANS
191210200423                               TO WS-PLACEMENT-DATE
191220200423             MOVE TRANS-NO OF TRANS
191230200423                               TO WS-TRANS-NO
191240200423             MOVE TRADE-DATE OF TRANS
191250200423                               TO WS-TRADE-DATE
191260200423             MOVE INVESTMENT-CODE OF TRANS
191270200423                               TO WS-INVESTMENT-CODE
191280200423      * RFS10608 - Begin
191290200423             MOVE ACCOUNT-NO      OF TRANS
191300200423                               TO WS-ACCOUNT-NO
191310200423             MOVE DEALER-CODE     OF TRANS
191320200423                               TO WS-DEALER-CODE
191330200423      * RFS10608 - End
191340200423             GO TO VCP-0005
191350200423           END-IF.
191360200423
191370200423           IF (NOT FROM-BACK-END-LOAD)
191380200423           AND TO-BACK-END-LOAD
191390200423             MOVE PLACEMENT-DATE OF WS-TRANS-REC-1
191400200423                               TO WS-PLACEMENT-DATE
191410200423             MOVE TRANS-NO OF WS-TRANS-REC-1
191420200423                               TO WS-TRANS-NO
191430200423             MOVE TRADE-DATE OF WS-TRANS-REC-1
191440200423                               TO WS-TRADE-DATE
191450200423             MOVE INVESTMENT-CODE OF WS-TRANS-REC-1
191460200423                               TO WS-INVESTMENT-CODE
191470200423      * RFS10608 - Begin
191480200423             MOVE ACCOUNT-NO  OF WS-TRANS-REC-1
191490200423                               TO WS-ACCOUNT-NO
191500200423             MOVE DEALER-CODE OF WS-TRANS-REC-1
191510200423                               TO WS-DEALER-CODE
191520200423      * RFS10608 - End
191530200423             GO TO VCP-0005
191540200423           END-IF.
191550200423
191560200423      * RFS 10826 BEGIN
191570200423           IF (((COMMISSION-RECOVERY AND COMMISSION-RECOVERY-ON)
191580200423      * RFS32873 - Begin
191590200423      * RFS46125 - Begin: set up new financer for death claims
191600200423      *     OR lncc_clawbackLLOn )
191610200423            OR lncc_clawbackLLOn
191620200423129787      OR lb_OptionXOn
191630200423            OR lncc_deathClaims
191640201223      * RFS185174 - Start
191650210407      * RFS1111190 - Start: SWO/SWI should be Sell
191660210407      *     OR lncc_FLDALFYes
191670210407      * RFS1111190 - End
191680201223      * RFS185174 - End
191690200423      *RFS 126462 - begins.
191700200423            OR (lncc_SwitchOutNL AND
191710200423                YEARS-FOR-GAIN OF FINANCER-CDSC-INSTRUCTIONS > 0)
191720200423      *RFS 126462 - ends.
191730200423               )
191740200423      * RFS46125 - End
191750200423           AND  (FROM-BACK-END-LOAD AND TO-BACK-END-LOAD)) OR
191760200423      * RFS 8066  BEGIN
191770200423           (RESET-ACCTP-SWITCH-ON AND (WS-FROM-ACCOUNT-TYPE
191780200423           IS NOT EQUAL WS-TO-ACCOUNT-TYPE) AND
191790200423           (FROM-BACK-END-LOAD AND TO-BACK-END-LOAD))
191800200423      * RFS 8066  END
191810200423             MOVE PLACEMENT-DATE OF WS-TRANS-REC-1
191820200423                               TO WS-PLACEMENT-DATE
191830200423             MOVE TRANS-NO OF WS-TRANS-REC-1
191840200423                               TO WS-TRANS-NO
191850200423             MOVE TRADE-DATE OF WS-TRANS-REC-1
191860200423                               TO WS-TRADE-DATE
191870200423             MOVE INVESTMENT-CODE OF WS-TRANS-REC-1
191880200423                               TO WS-INVESTMENT-CODE
191890200423             MOVE ACCOUNT-NO  OF WS-TRANS-REC-1
191900200423                               TO WS-ACCOUNT-NO
191910200423             MOVE DEALER-CODE OF WS-TRANS-REC-1
191920200423                               TO WS-DEALER-CODE
191930200423             MOVE "Y"        TO WS-USE-DEFAULT-RATE
191940200423             GO TO VCP-0005
191950200423           END-IF.
191960200423      * RFS 10826 END
191970200423
191980200423      * RFS42622 - Begin: added logic to do set up for mat trade
191990200423           IF lnc_origCodeMat            AND
192000200423              SPEC-MOD-AUTH-SEGSYSMAT-ON AND
192010200423              (FROM-BACK-END-LOAD AND TO-BACK-END-LOAD)
192020200423             MOVE PLACEMENT-DATE OF WS-TRANS-REC-1 TO ln_placementDate
192030200423             MOVE TRANS-NO       OF WS-TRANS-REC-1 TO ln_transNo
192040200423             PERFORM read-trans-commission
192050200423             IF ln_CommRate > 0
192060200423               SET lncc_ipMaturity    TO TRUE
192070200423               MOVE PLACEMENT-DATE OF WS-TRANS-REC-1  TO
192080200423                                      WS-PLACEMENT-DATE
192090200423               MOVE TRANS-NO OF WS-TRANS-REC-1        TO
192100200423                                      WS-TRANS-NO
192110200423               MOVE TRADE-DATE OF WS-TRANS-REC-1      TO
192120200423                                      WS-TRADE-DATE
192130200423               MOVE INVESTMENT-CODE OF WS-TRANS-REC-1 TO
192140200423                                      WS-INVESTMENT-CODE
192150200423               MOVE ACCOUNT-NO  OF WS-TRANS-REC-1     TO
192160200423                                      WS-ACCOUNT-NO
192170200423               MOVE DEALER-CODE OF WS-TRANS-REC-1     TO
192180200423                                      WS-DEALER-CODE
192190200423               MOVE "Y"          TO WS-USE-DEFAULT-RATE
192200200423               GO TO VCP-0005
192210200423             END-IF
192220200423           END-IF.
192230200423      * RFS42622 - End
192240200423
192250200423           GO TO VCP-EXIT.
192260200423
192270200423       VCP-0005.
192280200423
192290200423           IF PURCHASE-ADJUSTMENT
192300200423             INITIALIZE MFATRNCMP OF TRANS-COMMISSION-REC
192310200423             MOVE "Y"          TO WS-USE-DEFAULT-RATE
192320200423             GO TO VCP-0008
192330200423           END-IF.
192340200423
192350200423           MOVE WS-PLACEMENT-DATE
192360200423                               TO PLACEMENT-DATE OF TRANS-COMMISSION.
192370200423           MOVE WS-TRANS-NO
192380200423                               TO TRANS-NO OF TRANS-COMMISSION.
192390200423
192400200423
192410200423           READ TRANS-COMMISSION WITH NO LOCK
192420200423             INVALID KEY
192430200423             MOVE "37"         TO REJECTION-CODE OF TRANS
192440200423             GO TO VCP-EXIT.
192450200423
192460200423
192470200423       VCP-0008.
192480200423      * 100971 Begin
192490200423           PERFORM GET-CDSC-ORIGINAL-DETAILS.
192500200423           If  Financer-Age-Date-Rule
192510200423                                   of Trans-CDSC-Original-Details = "A"
192520200423               Move Age-date of Trans-CDSC-Original-Details To
192530200423                                Ws-Trade-Date
192540200423           End-If.
192550200423      * 100971 End
192560200423           PERFORM GET-FINANCER-DETAILS.
192570200423           IF WS-FINANCER-SCHEDULE-ERROR = "Y"
192580200423             GO TO VCP-ERROR
192590200423           END-IF.
192600200423
192610200423      *RFS1008937-Starts
192620200423           IF  BUY-TRANSACTION
192630200423           AND ACCOUNT-LEV-DSC
192640201223      *RFS180707 - Starts
192650201223           AND lnc_ACINDSCNo
192660201223      *RFS180707 -Ends
192670200423           AND lb_NL
192680200423           AND NOT lb_CommRecovSchedCodeSpace
192690200423               GO TO VCP-EXIT
192700200423           END-IF.
192710200423
192720200423           IF  SWITCH-OUT-TRANSACTION
192730200423           AND ACCOUNT-LEV-DSC
192740201223      *RFS180707 - Starts
192750201223           AND lnc_ACINDSCNo
192760201223      *RFS180707 - Ends
192770200423           AND lb_FROM-NL
192780200423           AND NOT lb_FromCommRecovSchedCodeSpace
192790200423               GO TO VCP-EXIT
192800200423           END-IF.
192810200423
192820200423           IF  SWITCH-IN-TRANSACTION
192830200423           AND ACCOUNT-LEV-DSC
192840201223      *RFS180707 - Starts
192850201223           AND lnc_ACINDSCNo
192860201223      *RFS180707 - Ends
192870200423           AND lb_TO-NL
192880200423           AND NOT lb_ToCommRecovSchedCodeSpace
192890200423               GO TO VCP-EXIT
192900200423           END-IF.
192910200423      *RFS1008937-Ends
192920200423           MOVE WS-PLACEMENT-DATE
192930200423                               TO PLACEMENT-DATE
192940200423                               OF TRANS-CDSC-PUR-PRIMARY.
192950200423           MOVE WS-TRANS-NO
192960200423                               TO TRANS-NO
192970200423                               OF TRANS-CDSC-PUR-PRIMARY.
192980200423           MOVE ZEROES         TO CDSC-SEQ-NO
192990200423                               OF TRANS-CDSC-PUR-PRIMARY.
193000200423           START TRANS-CDSC-PUR-PRIMARY
193010200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
193020200423             INVALID KEY
193030200423      *RFS 16941 Begin
193040200423                 IF NOT WS-BUY-BW-ENV
193050200423                     PERFORM CREATE-TRANS-CDSC-PURCHASE                 RFS10608
193060200423                     IF SW-TEMP-FAIL                                    RFS10608
193070200423                         GO TO VCP-ERROR                                RFS10608
193080200423                     ELSE
193090200423                         GO TO VCP-0020
193100200423                     END-IF                                             RFS10608
193110200423                 ELSE
193120200423                     GO TO VCP-EXIT
193130200423                 END-IF
193140200423      *RFS 16941 End
193150200423           END-START                                                    RFS10608
193160200423
193170200423           READ TRANS-CDSC-PUR-PRIMARY NEXT RECORD
193180200423           WITH NO LOCK
193190200423             AT END
193200200423      *RFS 16941 Begin
193210200423               IF NOT WS-BUY-BW-ENV
193220200423                   PERFORM CREATE-TRANS-CDSC-PURCHASE                   RFS10608
193230200423                   IF SW-TEMP-FAIL                                      RFS10608
193240200423                       GO TO VCP-ERROR                                  RFS10608
193250200423                   ELSE
193260200423                       GO TO VCP-0020
193270200423                   END-IF                                               RFS10608
193280200423               ELSE
193290200423                   GO TO VCP-EXIT
193300200423               END-IF
193310200423      *RFS 16941 End
193320200423           END-READ                                                     RFS10608
193330200423
193340200423      * RFS10608 - Begin
193350200423
193360200423           IF PLACEMENT-DATE OF TRANS-CDSC-PUR-PRIMARY
193370200423           IS NOT EQUAL WS-PLACEMENT-DATE
193380200423           OR
193390200423           TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
193400200423           IS NOT EQUAL WS-TRANS-NO
193410200423      *RFS 16941 Begin
193420200423               IF NOT WS-BUY-BW-ENV
193430200423                   PERFORM CREATE-TRANS-CDSC-PURCHASE
193440200423                   IF SW-TEMP-FAIL
193450200423                       GO TO VCP-ERROR
193460200423                   ELSE
193470200423                       GO TO VCP-0020
193480200423                   END-IF
193490200423               ELSE
193500200423                   GO TO VCP-EXIT
193510200423               END-IF
193520200423      *RFS 16941 End
193530200423           END-IF.
193540200423
193550200423       VCP-0020.
193560200423      * RFS10608 - End
193570200423      * RFS38704 - Begin: skip validation for non-update mode
193580200423      *  (sometimes come here for SWI trades in edit mode)
193590200423           IF  WS-PASS-SWITCH-EDIT = lnc_One       AND
193600200423            (SWITCH-IN-TRANSACTION   OR
193610200423      * RFS42622 - Begin: added SWO and TRO transactions to skip
193620200423      *   the rejection for edit mode.
193630200423             SWITCH-OUT-TRANSACTION)
193640200423             GO TO VCP-EXIT
193650200423           END-IF.
193660200423      * RFS38704 - End
193670200423
193680200423127385* Begin - bypass if it's for no-load and no free
193690200423127385     If Account-lev-dsc
193700201223      *RFS180707 - Starts
193710201223              And lnc_ACINDSCNo
193720201223      *RFS180707 - Ends
193730200423   |          And Years-for-gain of Financer-cdsc-instructions > 0
193740200423   |          And External-load-type-code
193750200423   |                of Investment-misc-detail-rec = "NL"
193760200423   |          And ln_accountTypePercentFree = 0
193770200423   |          And BUY-Transaction
193780200423   |          Go To Vcp-exit
193790200423127385     End-if.
193800200423127385* End
193810200423
193820200423           IF FINANCER-CODE OF TRANS-CDSC-PUR-PRIMARY
193830200423           IS NOT EQUAL TO WS-FINANCER-CODE
193840200423             GO TO VCP-ERROR
193850200423           END-IF.
193860200423
193870200423           IF FINANCER-SCHEDULE OF TRANS-CDSC-PUR-PRIMARY
193880200423           IS NOT EQUAL TO WS-FINANCER-SCHEDULE
193890200423             GO TO VCP-ERROR
193900200423           END-IF.
193910200423
193920200423           IF CDSC-SCHEDULE OF TRANS-CDSC-PUR-PRIMARY
193930200423           IS NOT EQUAL TO WS-CDSC-SCHEDULE
193940200423             GO TO VCP-ERROR
193950200423           END-IF.
193960200423
193970200423      * RFS10608 - Begin
193980200423
193990200423           PERFORM GET-CDSC-ORIGINAL-DETAILS
194000200423
194010200423           IF WS-PURCHASE-DETAIL = LT-Y
194020200423             MOVE AGE-DATE OF TRANS-CDSC-ORIGINAL-DETAILS
194030200423                             TO AGE-DATE OF TRANS-CDSC-PUR-PRIMARY
194040200423      * RFS47719 - Begin
194050200423             PERFORM CALCULATE-MATURITY-DATE
194060200423      * RFS47719 - End
194070200423      *    RFS71433 -Begin
194080200423      *    RFS71433.1 -Begin
194090200423      *      Perform UpdTransPurFreeUnits
194100200423      *    RFS71433.1 -End
194110200423      *    RFS71433 -End
194120200423             REWRITE TRANS-CDSC-PUR-PRIMARY-REC
194130200423             INVALID KEY
194140200423               INITIALIZE MFATRNCPP OF TRANS-CDSC-PUR-PRIMARY-REC
194150200423               GO TO VCP-ERROR
194160200423             END-REWRITE
19417020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
19418020042358714           MOVE "MFATRNCPP" TO WS-FILE-STATUS-FILE-NAME
19419020042358714           SET lncc_Err115  TO  TRUE
19420020042358714           PERFORM LOG-FILE-STATUS
19421020042358714        END-IF
194220200423           END-IF
194230200423      * RFS10608 - End
194240200423
194250200423           GO TO VCP-EXIT.
194260200423
194270200423       VCP-ERROR.
194280200423           MOVE "38"           TO REJECTION-CODE OF TRANS
194290200423                                  WS-REJECTION-CODE.
194300200423       VCP-EXIT.
194310200423           EXIT.
194320200423      /
194330200423      * RFS42622 - Begin: read trans-commission
194340200423      * -----------------------------------------
194350200423       read-trans-commission SECTION.
194360200423      * -----------------------------------------
194370200423           MOVE ln_placementDate TO PLACEMENT-DATE OF TRANS-COMMISSION
194380200423           MOVE ln_transNo       TO TRANS-NO OF TRANS-COMMISSION
194390200423           READ TRANS-COMMISSION WITH NO LOCK
194400200423             INVALID KEY
194410200423               INITIALIZE ln_commRate
194420200423             NOT INVALID KEY
194430200423               MOVE comm-rate OF TRANS-COMMISSION TO
194440200423                    ln_commRate
194450200423           END-READ.
194460200423      * RFS42622 - End
194470200423
194480200423       GET-OFFSET-EXCHANGE-RATE SECTION.
194490200423
194500200423      ******************************************************************
194510200423      *    G E T   O F F S E T   E X C H A N G E   R A T E   R T N .   *
194520200423      ******************************************************************
194530200423
194540200423       GOER-0000.
194550200423
194560200423      **************************************
194570200423      ** GET THE SWITCH OUT EXCHANGE RATE **
194580200423      **************************************
194590200423           MOVE "Y"          TO WS-SPOT-RATE-EXISTS.
194600200423           MOVE TRANS-TARGET-REC
194610200423                             TO TRANS-TARGET-SPOT-RATE-REC.
194620200423           READ TRANS-TARGET-SPOT-RATE
194630200423           INVALID KEY
194640200423           MOVE "N"          TO WS-SPOT-RATE-EXISTS.
194650200423
194660200423      * RFS17813 - Begin
194670200423      *    IF WS-OUT-CURRENCY IS EQUAL TO "CAD"
194680200423           IF WS-OUT-CURRENCY = WS-BASE-CURRENCY
194690200423      * RFS17813 - End
194700200423             MOVE 1.0          TO EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
194710200423             GO TO GOER-0009
194720200423           END-IF.
194730200423
194740200423           MOVE WS-IN-TRADE-DATE
194750200423                               TO TRADE-DATE OF EXCHANGE-RATE-HISTORY.
194760200423           MOVE WS-OUT-CURRENCY
194770200423                               TO CURRENCY-DDS OF EXCHANGE-RATE-HISTORY.
194780200423           MOVE WS-EXCHANGE-RATE-TYPE1
194790200423                               TO EXCHANGE-RATE-TYPE
194800200423                               OF EXCHANGE-RATE-HISTORY.
194810200423
194820200423           IF WS-SPOT-RATE-EXISTS IS EQUAL TO "Y"
194830200423             MOVE EXCHANGE-RATE OF TRANS-TARGET-SPOT-RATE
194840200423                               TO EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
194850200423             GO TO GOER-0009
194860200423           END-IF.
194870200423
194880200423           READ EXCHANGE-RATE-HISTORY
194890200423             KEY IS EXTERNALLY-DESCRIBED-KEY
194900200423             INVALID KEY
194910200423               MOVE "06"       TO REJECTION-CODE OF TRANS
194920200423               GO TO GOER-EXIT.
194930200423
194940200423       GOER-0009.
194950200423           MOVE EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
194960200423                               TO WS-OUT-EXCHANGE-RATE.
194970200423
194980200423      **************************************
194990200423      ** GET THE SWITCH IN EXCHANGE RATE **
195000200423      **************************************
195010200423
195020200423      * RFS17813 - Begin
195030200423      *    IF WS-IN-CURRENCY IS EQUAL TO "CAD"
195040200423           IF WS-IN-CURRENCY = WS-BASE-CURRENCY
195050200423      * RFS17813 - End
195060200423             MOVE 1.0          TO EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
195070200423             GO TO GOER-0011
195080200423           END-IF.
195090200423
195100200423           MOVE WS-IN-TRADE-DATE
195110200423                               TO TRADE-DATE OF EXCHANGE-RATE-HISTORY.
195120200423           MOVE WS-IN-CURRENCY
195130200423                               TO CURRENCY-DDS OF EXCHANGE-RATE-HISTORY.
195140200423           MOVE WS-EXCHANGE-RATE-TYPE1A
195150200423                               TO EXCHANGE-RATE-TYPE
195160200423                               OF EXCHANGE-RATE-HISTORY.
195170200423
195180200423           IF WS-SPOT-RATE-EXISTS IS EQUAL TO "Y"
195190200423             MOVE EXCHANGE-RATE OF TRANS-TARGET-SPOT-RATE
195200200423                               TO EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
195210200423             GO TO GOER-0011
195220200423           END-IF.
195230200423
195240200423           READ EXCHANGE-RATE-HISTORY
195250200423             KEY IS EXTERNALLY-DESCRIBED-KEY
195260200423             INVALID KEY
195270200423               MOVE "06"       TO REJECTION-CODE OF TRANS
195280200423               GO TO GOER-EXIT.
195290200423
195300200423       GOER-0011.
195310200423           MOVE EXCHANGE-RATE OF EXCHANGE-RATE-HISTORY
195320200423                               TO WS-IN-EXCHANGE-RATE.
195330200423
195340200423       GOER-EXIT.
195350200423           EXIT.
195360200423      /
195370200423       SET-TXN-EXCHANGE-RATE SECTION.
195380200423
195390200423      ******************************************************************
195400200423      *    S E T   T R A N S A C T I O N   E X C H A N G E   R A T E   *
195410200423      ******************************************************************
195420200423
195430200423       STE-0000.
195440200423
195450200423      **************************************
195460200423      ** CHECK TO SEE IF EXCHANGE RATE    **
195470200423      ** SHOULD BE STORED                 **
195480200423      **************************************
195490200423
195500200423           MOVE " "          TO WRITE-EXCHANGE-RATE.
195510200423
195520200423           IF SWITCH-IN-TRANSACTION
195530200423             GO TO STE-0050
195540200423           END-IF.
195550200423
195560200423      * STORE THE EXCHANGE RATE USED WITH THE TRANSACTION
195570200423
195580200423      * RFS17813 - Begin
195590200423      *    IF WS-OUT-CURRENCY IS EQUAL "CAD"
195600200423           IF WS-OUT-CURRENCY = WS-BASE-CURRENCY
195610200423      * RFS17813 - End
195620200423             GO TO STE-EXIT
195630200423           END-IF.
195640200423
195650200423           IF WS-OUT-CURRENCY IS EQUAL TO WS-IN-CURRENCY
195660200423             GO TO STE-EXIT
195670200423           END-IF.
195680200423
195690200423           INITIALIZE MFATREXRP OF TRANS-EXCHANGE-RATE.
195700200423
195710200423           MOVE WS-OUT-CURRENCY TO CURRENCY-DDS
195720200423                                OF TRANS-EXCHANGE-RATE.
195730200423           MOVE WS-OUT-EXCHANGE-RATE
195740200423                               TO EXCHANGE-RATE
195750200423                               OF TRANS-EXCHANGE-RATE.
195760200423
195770200423           MOVE PLACEMENT-DATE OF TRANS
195780200423                               TO PLACEMENT-DATE
195790200423                               OF TRANS-EXCHANGE-RATE.
195800200423
195810200423           MOVE TRANS-NO OF TRANS
195820200423                               TO TRANS-NO
195830200423                               OF TRANS-EXCHANGE-RATE.
195840200423
195850200423           MOVE "W"            TO WRITE-EXCHANGE-RATE.
195860200423           GO TO STE-EXIT.
195870200423
195880200423       STE-0050.
195890200423
195900200423      * STORE THE EXCHANGE RATE USED WITH THE TRANSACTION
195910200423
195920200423      * RFS17813 - Begin
195930200423      *    IF WS-IN-CURRENCY IS EQUAL "CAD"
195940200423           IF WS-IN-CURRENCY = WS-BASE-CURRENCY
195950200423      * RFS17813 - End
195960200423             GO TO STE-EXIT
195970200423           END-IF.
195980200423
195990200423           IF WS-OUT-CURRENCY IS EQUAL TO WS-IN-CURRENCY
196000200423             GO TO STE-EXIT
196010200423           END-IF.
196020200423
196030200423           INITIALIZE MFATREXRP OF TRANS-EXCHANGE-RATE.
196040200423
196050200423           MOVE WS-IN-CURRENCY TO CURRENCY-DDS
196060200423                               OF TRANS-EXCHANGE-RATE.
196070200423           MOVE WS-IN-EXCHANGE-RATE
196080200423                               TO EXCHANGE-RATE
196090200423                               OF TRANS-EXCHANGE-RATE.
196100200423
196110200423           MOVE PLACEMENT-DATE OF TRANS
196120200423                               TO PLACEMENT-DATE
196130200423                               OF TRANS-EXCHANGE-RATE.
196140200423
196150200423           MOVE TRANS-NO OF TRANS
196160200423                               TO TRANS-NO
196170200423                               OF TRANS-EXCHANGE-RATE.
196180200423           MOVE "W"            TO WRITE-EXCHANGE-RATE.
196190200423
196200200423       STE-EXIT.
196210200423           EXIT.
196220200423      /
196230200423       POPULATE-INHERITANCE-AMOUNTS SECTION.
196240200423
196250200423      ******************************************************************
196260200423      *    P O P U L A T E   I N H E R I T A N C E   A M O U N T S     *
196270200423      ******************************************************************
196280200423
196290200423       PIA-0000.
196300200423
196310200423      *Note:  Not all transactions have inheritance amounts.
196320200423      *There are two ways to tell:
196330200423      * 1. Switch out is all share
196340200423      * 2. No inheritance records exist
196350200423
196360200423
196370200423           IF PLACED-ALL-UNITS
196380200423             GO TO PIA-EXIT
196390200423           END-IF.
196400200423
196410200423      * RFS 17117 begin
196420200423           IF WS-TRADE-ON-HOLDING = "Y"
196430200423      * RFS14710 - Begin
196440200423              OR WS-TRADE-ON-HOLDING-AASWITCH = LT-Y
196450200423      * RFS14710 - End
196460200423              GO TO PIA-EXIT
196470200423           END-IF.
196480200423      * RFS 17117 end
196490200423
196500200423           MOVE "Y"            TO WS-INVALID-PIA-START.
196510200423
196520200423           MOVE PLACEMENT-DATE OF TRANS
196530200423                               TO PLACEMENT-DATE
196540200423                               OF TRANS-ALLOCATION-POINTER.
196550200423
196560200423           MOVE TRANS-NO OF TRANS
196570200423                               TO TRANS-NO
196580200423                               OF TRANS-ALLOCATION-POINTER.
196590200423
196600200423           MOVE ZEROES         TO PLACEMENT-DATE-2
196610200423                               OF TRANS-ALLOCATION-POINTER.
196620200423
196630200423           MOVE ZEROES         TO TRANS-NO-2
196640200423                               OF TRANS-ALLOCATION-POINTER.
196650200423
196660200423           START TRANS-ALLOCATION-POINTER
196670200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
196680200423           INVALID KEY
196690200423           GO TO PIA-EVALUATE.
196700200423
196710200423
196720200423       PIA-NEXT.
196730200423           READ TRANS-ALLOCATION-POINTER NEXT RECORD
196740200423           AT END
196750200423           MOVE ZEROES       TO PLACEMENT-DATE-2
196760200423                             OF TRANS-ALLOCATION-POINTER
196770200423                                TRANS-NO-2
196780200423                             OF TRANS-ALLOCATION-POINTER
196790200423           GO TO PIA-EVALUATE.
196800200423
196810200423           IF PLACEMENT-DATE OF TRANS-ALLOCATION-POINTER
196820200423           IS NOT EQUAL PLACEMENT-DATE OF TRANS
196830200423           OR TRANS-NO OF TRANS-ALLOCATION-POINTER
196840200423           IS NOT EQUAL TRANS-NO OF TRANS
196850200423             GO TO PIA-EVALUATE
196860200423           END-IF.
196870200423
196880200423           MOVE PLACEMENT-DATE-2 OF TRANS-ALLOCATION-POINTER
196890200423                             TO PLACEMENT-DATE
196900200423                             OF TRANS-PRIMARY-2.
196910200423           MOVE TRANS-NO-2 OF TRANS-ALLOCATION-POINTER
196920200423                             TO TRANS-NO
196930200423                             OF TRANS-PRIMARY-2.
196940200423
196950200423           READ TRANS-PRIMARY-2
196960200423           INVALID KEY
196970200423           MOVE "43"         TO REJECTION-CODE OF TRANS
196980200423           GO TO PIA-EXIT.
196990200423
197000200423           IF TRANS-STATUS-CODE OF TRANS-PRIMARY-2
197010200423           IS NOT EQUAL TO "HST"
197020200423             MOVE "42"       TO REJECTION-CODE OF TRANS
197030200423           GO TO PIA-EXIT.
197040200423
197050200423      *Leave the invalid start on until the first valid record
197060200423      *has been found
197070200423
197080200423           MOVE "N"          TO WS-INVALID-PIA-START.
197090200423
197100200423           COMPUTE WS-UNITS-TO-MOVE ROUNDED =
197110200423           UNIT-AMT OF TRANS-PRIMARY-2 * (PERCENT-ALLOCATION
197120200423           OF TRANS-ALLOCATION-POINTER / 100).
197130200423
197140200423           ADD  WS-UNITS-TO-MOVE
197150200423                               TO UNIT-AMT OF TRANS.
197160200423           GO TO PIA-NEXT.
197170200423
197180200423       PIA-EVALUATE.
197190200423
197200200423      *There is a problem is not inheritance records exist
197210200423      *and no amounts are indicated
197220200423
197230200423           IF WS-INVALID-PIA-START IS EQUAL TO "Y"
197240200423             IF GROSS-AMT OF TRANS IS EQUAL 0
197250200423             AND NET-AMT OF TRANS IS EQUAL 0
197260200423             AND UNIT-AMT OF TRANS IS EQUAL  0
197270200423               MOVE "46"         TO REJECTION-CODE OF TRANS
197280200423             END-IF
197290200423             GO TO PIA-EXIT
197300200423           END-IF.
197310200423
197320200423      **************************************
197330200423      ** This logic is in place to allow for rounding
197340200423      ** differences on asset allocation transactions
197350200423      ** At the end of the allocation pointer chain add any
197360200423      ** rounding differences into the last transaction
197370200423      **************************************
197380200423
197390200423
197400200423           IF (PLACEMENT-DATE-2 OF TRANS-ALLOCATION-POINTER NOT EQUAL
197410200423           PLACEMENT-DATE OF TRANS-PRIMARY-2)
197420200423      * RFS 8897 - Start                                                 RFS8897
197430200423      *                                       AND                        RFS8897
197440200423                                              OR                         RFS8897
197450200423      * RFS 8897 - End                                                   RFS8897
197460200423           (TRANS-NO-2 OF TRANS-ALLOCATION-POINTER NOT EQUAL
197470200423           TRANS-NO OF TRANS-PRIMARY-2)
197480200423             GO TO PIA-0050
197490200423           ELSE
197500200423             GO TO PIA-EXIT
197510200423           END-IF.
197520200423
197530200423       PIA-0050.
197540200423           MOVE ZEROES       TO WS-TOTAL-UNIT-ALLOCATION.
197550200423           MOVE UNIT-AMT OF TRANS-PRIMARY-2
197560200423                             TO WS-UNITS-TO-ALLOCATE.
197570200423
197580200423           MOVE PLACEMENT-DATE OF TRANS-PRIMARY-2
197590200423                                TO WS-LAST-PLACEMENT-DATE
197600200423                                   PLACEMENT-DATE-2
197610200423                                OF TRANS-ALLOCATION-POINTER-A.
197620200423           MOVE TRANS-NO OF TRANS-PRIMARY-2
197630200423                                TO WS-LAST-TRANS-NO
197640200423                                   TRANS-NO-2
197650200423                                OF TRANS-ALLOCATION-POINTER-A.
197660200423           START TRANS-ALLOCATION-POINTER-A
197670200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
197680200423           INVALID KEY
197690200423           GO TO PIA-EXIT.
197700200423
197710200423       PIA-0056.
197720200423           READ TRANS-ALLOCATION-POINTER-A NEXT RECORD
197730200423           AT END
197740200423           GO TO PIA-0060.
197750200423
197760200423           IF (PLACEMENT-DATE-2 OF TRANS-ALLOCATION-POINTER-A
197770200423           IS NOT EQUAL WS-LAST-PLACEMENT-DATE) OR
197780200423           (TRANS-NO-2 OF TRANS-ALLOCATION-POINTER-A
197790200423           IS NOT EQUAL WS-LAST-TRANS-NO)
197800200423             GO TO PIA-0060
197810200423           END-IF.
197820200423
197830200423           MOVE PLACEMENT-DATE OF TRANS-ALLOCATION-POINTER-A
197840200423                             TO PLACEMENT-DATE
197850200423                             OF TRANS-PRIMARY-2-REC.
197860200423
197870200423           MOVE TRANS-NO OF TRANS-ALLOCATION-POINTER-A
197880200423                             TO TRANS-NO
197890200423                             OF TRANS-PRIMARY-2-REC.
197900200423
197910200423           READ TRANS-PRIMARY-2
197920200423             INVALID KEY
197930200423             GO TO PIA-EXIT.
197940200423
197950200423           ADD UNIT-AMT OF TRANS-PRIMARY-2-REC
197960200423                             TO WS-TOTAL-UNIT-ALLOCATION.
197970200423
197980200423           GO TO PIA-0056.
197990200423
198000200423       PIA-0060.
198010200423
198020200423           ADD WS-UNITS-TO-MOVE
198030200423                             TO WS-TOTAL-UNIT-ALLOCATION.
198040200423
198050200423           SUBTRACT WS-TOTAL-UNIT-ALLOCATION
198060200423           FROM     WS-UNITS-TO-ALLOCATE
198070200423           GIVING   WS-TOTAL-UNIT-ALLOCATION.
198080200423
198090200423           ADD WS-TOTAL-UNIT-ALLOCATION
198100200423                            TO UNIT-AMT OF TRANS.
198110200423
198120200423       PIA-EXIT.
198130200423           EXIT.
198140200423      /
198150200423      * RFS 58714 - begins.
198160200423       LOG-FILE-STATUS-RD SECTION.
198170200423      **-------------------------------------------------------------***
198180200423      * This routine was created to separate the logging of the start/ *
198190200423      * read errors from write/rewrite/delete I-O erros. For the later,*
198200200423      * the original LOG-FILE-STATUS routine will be used.             *
198210200423      **-------------------------------------------------------------***
198220200423           MOVE SPACES         TO WS-ERROR-LINE.
198230200423           STRING "AN ERROR HAS OCCURRED ON FILE"
198240200423                               DELIMITED BY SIZE
198250200423                  " "          DELIMITED BY SIZE
198260200423                  WS-FILE-STATUS-FILE-NAME
198270200423                               DELIMITED BY "  "
198280200423                  ". THE FILE STATUS VALUE IS "
198290200423                               DELIMITED BY SIZE
198300200423                  WS-FILE-STATUS
198310200423                               DELIMITED BY SIZE
198320200423                               INTO WS-ERROR-LINE.
198330200423           DISPLAY WS-ERROR-LINE.
198340200423
198350200423       LOG-FILE-STATUS SECTION.
198360200423      **-------------------------------------------------------------***
198370200423      * This routine was modified to capture the I-O errors for all    *
198380200423      * writes/rewrites/deletes in MFAIOERRP file. For the starts/reads*
198390200423      * the LOG-FILE-STATUS-RD is used with its original logic.        *
198400200423      **-------------------------------------------------------------***
198410210531      *RFS186729 STARTS
198420210531           IF   lncc_FileStatus30     AND lncc_SFMSGWOff AND
198430210531                ((WS-FILE-STATUS-FILE-NAME  = "MFATRNP" OR "MFAINVP" OR
198440210531                  "MFATRNTGP" OR "MFATRNCHP" OR "MFAACCIVP") OR
198450210531                   lncc_FileNameStatus30)
198460210531              DISPLAY "TRNPST-FILE STATUS 30:" WS-FILE-STATUS-FILE-NAME
198470210531              DISPLAY "Error Code: " lc_Error_Code
198480210531              DISPLAY "Account Number: " ACCOUNT-NO OF TRANS
198490210531              DISPLAY "Investment Code: " INVESTMENT-CODE OF TRANS
198500210531              DISPLAY "Placement Date: "  PLACEMENT-DATE OF TRANS
198510210531              DISPLAY "Transaction Number: " TRANS-NO OF TRANS
198520210531              CALL LT-PGM-DUMMY
198530210531           ELSE
198540210531      *RFS186729 ENDS
198550200423           INITIALIZE   pc_IO_Errors_Parms.
198560200423           MOVE "TRNPST"                        TO  pc_Program_Name.
198570200423           MOVE lc_Error_Code                   TO  pc_Error_Code.
198580200423           MOVE WS-FILE-STATUS                  TO  pc_File_Status.
198590200423           MOVE SPACES                          TO  pc_SQL_State.
198600200423           MOVE WS-FILE-STATUS-FILE-NAME        TO  pc_Error_Desc.
198610200423           STRING  lc_Placement_Date DELIMITED BY SIZE
198620200423                   " "               DELIMITED BY SIZE
198630200423                   lc_Trans_No       DELIMITED BY SIZE
198640200423           INTO pc_Data_Field.
198650200423
198660200423           call "IOERR"  using  pc_Program_Name
198670200423                                pc_Error_Code
198680200423                                pc_File_Status
198690200423                                pc_SQL_State
198700200423                                pc_Error_Desc
198710200423                                pc_Data_Field.
198720200423      * RFS 58714 - ends.
198730200423      /
198740200423      ******************************************************************
198750200423      *    P O S T   L A B O U R   S P O N S O R   U N I T S           *
198760200423      ******************************************************************
198770200423       POST-LBR-SPNS-UNITS SECTION.
198780200423
198790200423           IF WS-PASS-SWITCH-EDIT IS EQUAL "1"
198800200423             GO TO PLS-EXIT
198810200423           END-IF.
198820200423
198830200423      *RFS 21253 Begin
198840200423           IF WS-LSIF-DEEMED-DISTR = 'Y'
198850200423             GO TO PLS-EXIT
198860200423           END-IF.
198870200423      *RFS 21253 End
198880200423
198890200423      *RFS 16760 Begin
198900200423           IF WS-LBS-VALIDATION-MODE-FLAG = "Y"
198910200423               CONTINUE
198920200423           ELSE
198930200423      *RFS 18781 Begin
198940200423      *        IF NOT HISTORY
198950200423               IF NOT HISTORY AND NOT CONTRACTED
198960200423      *RFS 18781 End.
198970200423                   GO TO PLS-EXIT
198980200423               END-IF
198990200423           END-IF.
199000200423      *RFS 16760 End
199010200423
199020200423           IF PRODUCT-TYPE-CODE OF INVESTMENT IS NOT EQUAL "LBS"
199030200423             GO TO PLS-EXIT
199040200423           END-IF.
199050200423
199060200423      *RFS 19110 Begin
199070200423           IF TRANSFER-IN-TRANSACTION AND NOT LSIF-ROLLOVER
199080200423             GO TO PLS-0009
199090200423           END-IF.
199100200423      *RFS 19110 End
199110200423
199120200423
199130200423      *RFS 19110 Begin
199140200423       PLS-0009.
199150200423      *RFS 19110 End
199160200423
199170200423      * RFS 15658 begins
199180200423      * If the investor-no is not the same for 'SWI' and 'SWO' than the
199190200423      * foreign-content-eligible flag on the Trans-buy-LSIF file is
199200200423      * set to 'N'. This means that these units will not be
199210200423      * included in the calculation of the additional LSIF foreign
199220200423      * content limit.
199230200423
199240200423           IF TRANS-TYPE-CODE OF TRANS = "BUY"
199250200423               MOVE "Y" TO WS-FOREIGN-CONTENT-ELIGIBLE
199260200423           ELSE
199270200423               IF TRANS-TYPE-CODE OF TRANS = "SWI" OR "TRI"
199280200423
199290200423                   MOVE ACCOUNT-NO       OF WS-TRANS-REC-2
199300200423                   TO   ACCOUNT-NO       OF ACCOUNT-2
199310200423
199320200423                   READ ACCOUNT-2
199330200423                     KEY IS EXTERNALLY-DESCRIBED-KEY
199340200423                     INVALID KEY
199350200423                       MOVE "N" TO WS-FOREIGN-CONTENT-ELIGIBLE
199360200423                       GO TO PLS-0015
199370200423                   END-READ
199380200423
199390200423                   IF INVESTOR-NO OF ACCOUNT IS NOT EQUAL TO
199400200423                      INVESTOR-NO OF ACCOUNT-2
199410200423
199420200423                       MOVE "N" TO WS-FOREIGN-CONTENT-ELIGIBLE
199430200423
199440200423                   ELSE
199450200423
199460200423                       MOVE INVESTMENT-CODE OF WS-TRANS-REC-2 TO
199470200423                            INVESTMENT-CODE OF INVESTMENT-2
199480200423
199490200423                       READ INVESTMENT-2
199500200423                         KEY IS EXTERNALLY-DESCRIBED-KEY
199510200423                         INVALID KEY
199520200423                           MOVE "N" TO WS-FOREIGN-CONTENT-ELIGIBLE
199530200423                           GO TO PLS-0015
199540200423                       END-READ
199550200423
199560200423                       IF   PRODUCT-TYPE-CODE OF INVESTMENT   = "LBS"
199570200423                       AND  PRODUCT-TYPE-CODE OF INVESTMENT-2 = "LBS"
199580200423                           MOVE "Y" TO WS-FOREIGN-CONTENT-ELIGIBLE
199590200423                       ELSE
199600200423                           MOVE "N" TO WS-FOREIGN-CONTENT-ELIGIBLE
199610200423                       END-IF
199620200423                   END-IF
199630200423               END-IF
199640200423           END-IF.
199650200423      * RFS 15658 ends
199660200423
199670200423       PLS-0015.
199680200423
199690200423      *If this is a buy type transaction OR it is a switch or transfer
199700200423      *from a non labor sponsored fund - execute logic to post as new
199710200423
199720200423      *RFS 16919 Begin - Post as new if LSIF rollover.
199730200423
199740200423           IF LSIF-ROLLOVER
199750200423             GO TO PLS-0020
199760200423           END-IF.
199770200423
199780200423      *RFS 16919 End
199790200423
199800200423           IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BUY" OR "INC" OR
199810200423           "CPG" OR "INT" OR "BAJ" OR "MFR"
199820200423             GO TO PLS-0020
199830200423           END-IF.
199840200423
199850200423           IF TRANS-TYPE-CODE OF TRANS = "SWI" OR "TRI"
199860200423           AND (INVESTMENT-CODE OF TRANS
199870200423           IS NOT EQUAL INVESTMENT-CODE OF WS-TRANS-REC-2)
199880200423             GO TO PLS-0020
199890200423           ELSE
199900200423             GO TO PLS-0040
199910200423           END-IF.
199920200423
199930200423           GO TO PLS-EXIT.
199940200423
199950200423       PLS-0020.
199960200423
199970200423           INITIALIZE MFATBLP OF TRANS-BUY-LSIF-PRIMARY
199980200423           MOVE PLACEMENT-DATE OF TRANS
199990200423                             TO PLACEMENT-DATE
200000200423                             OF TRANS-BUY-LSIF-PRIMARY.
200010200423           MOVE TRANS-NO OF TRANS
200020200423                             TO TRANS-NO OF TRANS-BUY-LSIF-PRIMARY.
200030200423
200040200423           MOVE 1            TO LSIF-SEQ-NO OF TRANS-BUY-LSIF-PRIMARY.
200050200423
200060200423           MOVE TRADE-DATE OF TRANS
200070200423                             TO TRADE-DATE OF TRANS-BUY-LSIF-PRIMARY.
200080200423
200090200423           MOVE ACCOUNT-NO OF TRANS
200100200423                             TO ACCOUNT-NO OF TRANS-BUY-LSIF-PRIMARY.
200110200423
200120200423           MOVE TRANS-TYPE-CODE OF TRANS
200130200423                             TO TRANS-TYPE-CODE
200140200423                             OF TRANS-BUY-LSIF-PRIMARY.
200150200423
200160200423           MOVE INVESTMENT-CODE OF TRANS
200170200423                             TO INVESTMENT-CODE
200180200423                             OF TRANS-BUY-LSIF-PRIMARY.
200190200423
200200200423           MOVE UNIT-AMT OF TRANS
200210200423                             TO ORIG-UNIT-BAL
200220200423                             OF TRANS-BUY-LSIF-PRIMARY
200230200423                                CURR-UNIT-BAL
200240200423                             OF TRANS-BUY-LSIF-PRIMARY.
20025020042380658 *    MOVE COUNTRY-CODE OF INVESTOR
20026020042380658      MOVE Lc_TaxCountryCode
200270200423                             TO COUNTRY-CODE
200280200423                             OF TRANS-BUY-LSIF-PRIMARY.
200290200423
200300200423           MOVE PROVINCE-CODE OF INVESTOR
200310200423                              TO PROVINCE-CODE
200320200423                              OF TRANS-BUY-LSIF-PRIMARY.
200330200423
200340200423           MOVE "N"             TO WS-FED-JURISDICTION-EXIST
200350200423                                   WS-PRV-JURISDICTION-EXIST
200360200423                                   WS-FED-JURISDICTION-ISSUE
200370200423                                   WS-PRV-JURISDICTION-ISSUE.
200380200423
200390200423      * RFS26557 Start
200400200423
200410200423           MOVE "N"
200420200423             TO WS-FED-TAX-CREDIT-PARMS-EXIST
200430200423                WS-PRV-TAX-CREDIT-PARMS-EXIST.
200440200423           MOVE SPACES
200450200423             TO WS-FED-BOX-ID
200460200423                WS-PRV-BOX-ID.
200470200423           MOVE 0
200480200423             TO WS-FED-PRINT-DATE
200490200423                WS-PRV-PRINT-DATE.
200500200423
200510200423      * Set the defaults as follows.
20052020042328482**    MOVE "N"
20053020042328482**      TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY.
200540200423R27851     MOVE TRADE-DATE OF TRANS
200550200423R27851       TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY.
200560200423
20057020042328482** Use the Trade Year as a default Tax Year.
20058020042328482      MOVE TRADE-DATE OF TRANS TO WS-WK-TRADE-DATE.
20059020042328482      MOVE WS-WKT-YEAR TO TAX-YEAR OF TRANS-BUY-LSIF-PRIMARY.
200600200423
20061020042328482** Initialize LSIF-STATUS to blank.
20062020042328482      MOVE SPACES TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY.
200630200423
20064020042328482** Set LSIF-STATUS to 'N' for distribution transactions.
20065020042328482      IF TRANS-TYPE-CODE OF TRANS-BUY-LSIF-PRIMARY =
20066020042328482         "INC" OR "CPG" OR "INT" OR "MFR"
20067020042328482         MOVE "N" TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
20068020042328482      ELSE
20069020042328482         PERFORM GET-LSIF-TAX-CREDITS-ALLOWED
20070020042328482      END-IF.
200710200423
20072020042328482 * If the LSIF-STATUS is changed to "N" then bypass the logic to
20073020042328482 * determine if the LSIF-STATUS should be 'P', 'F' or 'B'.
20074020042328482      IF LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "N"
20075020042328482         IF WS-LBS-VALIDATION-MODE-FLAG = 'Y' OR
20076020042328482            REJECTION-CODE OF TRANS IS NOT EQUAL "00"
20077020042328482            GO TO PLS-EXIT
20078020042328482         END-IF
20079020042328482         GO TO PLS-0030
20080020042328482      ELSE
20081020042328482         MOVE "N" TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
20082020042328482      END-IF.
200830200423
200840200423      *****************************************************************
200850200423      * Read the LSIF-TAX-CREDIT-PARMS with investor's province code.
200860200423      * There maybe multiple records.
200870200423      *****************************************************************
200880200423
200890200423       PLS-0022-PROV-START.
200900200423
20091020042380658 *    MOVE COUNTRY-CODE  OF INVESTOR
20092020042380658      MOVE Lc_TaxCountryCode
200930200423           TO   COUNTRY-CODE OF LSIF-TAX-CREDIT-PARMS.
200940200423
200950200423           MOVE PROVINCE-CODE OF INVESTOR
200960200423           TO PROVINCE-CODE   OF LSIF-TAX-CREDIT-PARMS.
200970200423
200980200423           MOVE ZEROES
200990200423           TO   END-DATE     OF LSIF-TAX-CREDIT-PARMS.
201000200423
201010200423           START LSIF-TAX-CREDIT-PARMS
201020200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
201030200423           INVALID KEY
201040200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201050200423             DISPLAY "@@@P1 MISSING LSIF-TAX-CREDIT-PARMS FOR PROVINCE"
201060200423             GO TO PLS-0022-FED-START
201070200423           END-START.
201080200423
201090200423       PLS-0022-PROV-READ.
201100200423
201110200423           READ LSIF-TAX-CREDIT-PARMS NEXT RECORD
201120200423           AT END
201130200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201140200423             DISPLAY "@@@P1 MISSING LSIF-TAX-CREDIT-PARMS FOR PROVINCE"
201150200423             GO TO PLS-0022-FED-START
201160200423           END-READ.
201170200423
201180200423           IF (COUNTRY-CODE OF LSIF-TAX-CREDIT-PARMS
20119020042380658 *    IS NOT EQUAL COUNTRY-CODE  OF INVESTOR)     OR
20120020042380658      IS NOT EQUAL Lc_TaxCountryCode        )     OR
201210200423           (PROVINCE-CODE   OF LSIF-TAX-CREDIT-PARMS
201220200423           IS NOT EQUAL PROVINCE-CODE OF INVESTOR)
201230200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201240200423             DISPLAY "@@@P1 MISSING LSIF-TAX-CREDIT-PARMS FOR PROVINCE"
201250200423             GO TO PLS-0022-FED-START
201260200423           END-IF.
201270200423
201280200423      * For each record, find a record in the FORM-REQUEST-CONTR-REDEM.
201290200423      * using FORM-CODE of LSIF-TAX-CREDIT-PARMS
201300200423      * using CONTR-REDEM-CODE of TRANS
201310200423
201320200423           MOVE FORM-CODE OF LSIF-TAX-CREDIT-PARMS
201330200423           TO   FORM-CODE OF FORM-REQUEST-CONTR-REDEM.
201340200423
201350200423           MOVE CONTR-REDEM-CODE OF TRANS
201360200423           TO   CONTR-REDEM-CODE OF FORM-REQUEST-CONTR-REDEM.
201370200423
201380200423           READ FORM-REQUEST-CONTR-REDEM
201390200423           INVALID KEY
201400200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201410200423             DISPLAY "@@@P2 MISSING FORM-REQUEST-CONTR-REDEM FOR PROV"
201420200423             GO TO PLS-0022-PROV-READ
201430200423           END-READ.
201440200423
201450200423           IF BOX-ID OF FORM-REQUEST-CONTR-REDEM = "4"
201460200423
201470200423              MOVE BOX-ID OF FORM-REQUEST-CONTR-REDEM
201480200423                TO WS-PRV-BOX-ID
201490200423              MOVE FORM-CODE OF FORM-REQUEST-CONTR-REDEM
201500200423                TO FORM-CODE OF FORM-REQUEST
201510200423              MOVE REQUEST-CODE OF FORM-REQUEST-CONTR-REDEM
201520200423                TO REQUEST-CODE OF FORM-REQUEST
201530200423
201540200423              READ FORM-REQUEST
201550200423              INVALID KEY
201560200423                DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201570200423                DISPLAY "@@@P3 MISSING FORM-REQUEST"
201580200423              NOT INVALID KEY
201590200423                MOVE PRINT-DATE OF FORM-REQUEST
201600200423                  TO WS-PRV-PRINT-DATE
201610200423              END-READ
201620200423              IF WS-PRV-PRINT-DATE = 0
201630200423                DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201640200423                DISPLAY "@@@P3 MISSING PROVINCIAL PRINT DATE"
201650200423                MOVE "L7" TO REJECTION-CODE OF TRANS
201660200423                GO TO PLS-EXIT
201670200423              END-IF
201680200423           END-IF.
201690200423
201700200423           MOVE "Y"
201710200423             TO WS-PRV-TAX-CREDIT-PARMS-EXIST.
201720200423
201730200423      *****************************************************************
201740200423      * Read the LSIF-TAX-CREDIT-PARMS with "FED" as the province code.
201750200423      * There maybe multiple records.
201760200423      *****************************************************************
201770200423
201780200423       PLS-0022-FED-START.
201790200423
20180020042380658 *    MOVE COUNTRY-CODE  OF INVESTOR
20181020042380658      MOVE Lc_TaxCountryCode
201820200423           TO   COUNTRY-CODE OF LSIF-TAX-CREDIT-PARMS.
201830200423
201840200423           MOVE "FED"
201850200423           TO PROVINCE-CODE   OF LSIF-TAX-CREDIT-PARMS.
201860200423
201870200423           MOVE ZEROES
201880200423           TO   END-DATE     OF LSIF-TAX-CREDIT-PARMS.
201890200423
201900200423           START LSIF-TAX-CREDIT-PARMS
201910200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
201920200423           INVALID KEY
201930200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
201940200423             DISPLAY "@@@P4 MISSING LSIF-TAX-CREDIT-PARMS FOR FEDERAL"
201950200423             GO TO PLS-0024
201960200423           END-START.
201970200423
201980200423       PLS-0022-FED-READ.
201990200423
202000200423           READ LSIF-TAX-CREDIT-PARMS NEXT RECORD
202010200423           AT END
202020200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202030200423             DISPLAY "@@@P4 MISSING LSIF-TAX-CREDIT-PARMS FOR FEDERAL"
202040200423             GO TO PLS-0024
202050200423           END-READ.
202060200423
202070200423           IF (COUNTRY-CODE OF LSIF-TAX-CREDIT-PARMS
20208020042380658 *    IS NOT EQUAL COUNTRY-CODE  OF INVESTOR)     OR
20209020042380658      IS NOT EQUAL Lc_TaxCountryCode        )     OR
202100200423           (PROVINCE-CODE   OF LSIF-TAX-CREDIT-PARMS
202110200423           IS NOT EQUAL "FED")
202120200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202130200423             DISPLAY "@@@P4 MISSING LSIF-TAX-CREDIT-PARMS FOR FEDERAL"
202140200423             GO TO PLS-0024
202150200423           END-IF.
202160200423
202170200423      * For each record, find a record in the FORM-REQUEST-CONTR-REDEM.
202180200423      * using FORM-CODE of LSIF-TAX-CREDIT-PARMS
202190200423      * using CONTR-REDEM-CODE of TRANS
202200200423
202210200423           MOVE FORM-CODE OF LSIF-TAX-CREDIT-PARMS
202220200423           TO   FORM-CODE OF FORM-REQUEST-CONTR-REDEM.
202230200423
202240200423           MOVE CONTR-REDEM-CODE OF TRANS
202250200423           TO   CONTR-REDEM-CODE OF FORM-REQUEST-CONTR-REDEM.
202260200423
202270200423           READ FORM-REQUEST-CONTR-REDEM
202280200423           INVALID KEY
202290200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202300200423             DISPLAY "@@@P5 MISSING FORM-REQUEST-CONTR-REDEM FOR FED"
202310200423             GO TO PLS-0022-FED-READ
202320200423           END-READ.
202330200423
202340200423           IF BOX-ID OF FORM-REQUEST-CONTR-REDEM = "4"
202350200423
202360200423              MOVE BOX-ID OF FORM-REQUEST-CONTR-REDEM
202370200423                TO WS-FED-BOX-ID
202380200423              MOVE FORM-CODE OF FORM-REQUEST-CONTR-REDEM
202390200423                TO FORM-CODE OF FORM-REQUEST
202400200423              MOVE REQUEST-CODE OF FORM-REQUEST-CONTR-REDEM
202410200423                TO REQUEST-CODE OF FORM-REQUEST
202420200423
202430200423              READ FORM-REQUEST
202440200423              INVALID KEY
202450200423                DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202460200423                DISPLAY "@@@P6 MISSING FORM-REQUEST"
202470200423              NOT INVALID KEY
202480200423                MOVE PRINT-DATE OF FORM-REQUEST
202490200423                  TO WS-FED-PRINT-DATE
202500200423              END-READ
202510200423              IF WS-FED-PRINT-DATE = 0
202520200423                DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202530200423                DISPLAY "@@@P3 MISSING FEDERAL PRINT DATE"
202540200423                MOVE "L7" TO REJECTION-CODE OF TRANS
202550200423                GO TO PLS-EXIT
202560200423              END-IF
202570200423           END-IF.
202580200423
202590200423           MOVE "Y"
202600200423             TO WS-FED-TAX-CREDIT-PARMS-EXIST.
202610200423
202620200423       PLS-0024.
202630200423
202640200423      *****************************************************************
202650200423      * If only PROVINCIAL tax credit parms is found.
202660200423      *****************************************************************
202670200423           IF WS-PRV-TAX-CREDIT-PARMS-EXIST = "Y" AND
202680200423              WS-FED-TAX-CREDIT-PARMS-EXIST = "N"
202690200423
202700200423      * Set the contribution date as follows.
202710200423      * If BOX-ID of FORM-REQUEST-CONTR-REDEM = "4"
202720200423      *    Set TAX-YEAR to TRADE-DATE -1
202730200423      *    If TRADE-DATE of TRANS <= PRINT-DATE, then use TRADE-DATE
202740200423      *    If TRADE-DATE of TRANS >  PRINT-DATE, then use PRINT-DATE
202750200423      * Else the defaults
202760200423
202770200423             IF WS-PRV-BOX-ID = "4"
202780200423               IF TRADE-DATE OF TRANS <= WS-PRV-PRINT-DATE
202790200423                  MOVE TRADE-DATE OF TRANS
202800200423                    TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
202810200423               ELSE
202820200423                  MOVE PRINT-DATE OF FORM-REQUEST
202830200423                    TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
202840200423               END-IF
202850200423             END-IF
202860200423
202870200423      * Set the LSIF Status as follows.
202880200423             MOVE PROVINCE-CODE OF INVESTOR
202890200423               TO WS-PROVINCE-CODE
202900200423             PERFORM GET-LSIF-JURISDICTION
202910200423             IF WS-JURISDICTION-EXIST = "N"
202920200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
202930200423               DISPLAY "@@@P7 MISSING LSIF-JURISDICTION FOR PROV"
202940200423               MOVE "L1" TO REJECTION-CODE OF TRANS
202950200423               GO TO PLS-EXIT
202960200423             END-IF
202970200423             IF WS-JURISDICTION-ISSUE = "Y"
202980200423                MOVE "P"  TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
202990200423             ELSE
203000200423                MOVE TRADE-DATE OF TRANS
203010200423                  TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203020200423             END-IF
203030200423           END-IF.
203040200423
203050200423      *****************************************************************
203060200423      * If only FEDERAL tax credit parms is found.
203070200423      *****************************************************************
203080200423           IF WS-PRV-TAX-CREDIT-PARMS-EXIST = "N" AND
203090200423              WS-FED-TAX-CREDIT-PARMS-EXIST = "Y"
203100200423
203110200423      * Set the contribution date as follows.
203120200423      * If BOX-ID of FORM-REQUEST-CONTR-REDEM = "4"
203130200423      *    Set TAX-YEAR to TRADE-DATE -1
203140200423      *    If TRADE-DATE of TRANS <= PRINT-DATE, then use TRADE-DATE
203150200423      *    If TRADE-DATE of TRANS >  PRINT-DATE, then use PRINT-DATE
203160200423      * Else the defaults
203170200423
203180200423             IF WS-FED-BOX-ID = "4"
203190200423               IF TRADE-DATE OF TRANS <= WS-FED-PRINT-DATE
203200200423                  MOVE TRADE-DATE OF TRANS
203210200423                    TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203220200423               ELSE
203230200423                  MOVE PRINT-DATE OF FORM-REQUEST
203240200423                    TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203250200423               END-IF
203260200423             END-IF
203270200423
203280200423      * Set the LSIF Status as follows.
203290200423             MOVE "FED"
203300200423               TO WS-PROVINCE-CODE
203310200423             PERFORM GET-LSIF-JURISDICTION
203320200423             IF WS-JURISDICTION-EXIST = "N"
203330200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
203340200423               DISPLAY "@@@P7 MISSING LSIF-JURISDICTION FOR FED"
203350200423             END-IF
203360200423             IF WS-JURISDICTION-ISSUE = "Y"
203370200423                MOVE "F"  TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
203380200423             ELSE
203390200423                MOVE TRADE-DATE OF TRANS
203400200423                  TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203410200423             END-IF
203420200423           END-IF.
203430200423
203440200423      *****************************************************************
203450200423      * If both PROVINCIAL and FEDERAL tax credit parms are found,
203460200423      * then TRNPST needs to determine which of the three dates,
203470200423      * provincial Date To Print, federal Date To Print or the trade
203480200423      * date of the purchase, will be selected to be the contribution
203490200423      * date for the purchase.
203500200423      *****************************************************************
203510200423           IF WS-PRV-TAX-CREDIT-PARMS-EXIST = "Y" AND
203520200423              WS-FED-TAX-CREDIT-PARMS-EXIST = "Y"
203530200423
203540200423      * If the trade date of the purchase is the oldest of the 3 dates
203550200423      * then it will be used as a contribution.
203560200423              IF TRADE-DATE OF TRANS <= WS-PRV-PRINT-DATE AND
203570200423                 WS-PRV-PRINT-DATE   >  0                 AND
203580200423                 TRADE-DATE OF TRANS <= WS-FED-PRINT-DATE AND
203590200423                 WS-FED-PRINT-DATE   >  0
203600200423
203610200423                 MOVE TRADE-DATE OF TRANS
203620200423                   TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203630200423
203640200423                 PERFORM GET-BOTH-LSIF-JURISDICTIONS
203650200423
203660200423              ELSE
203670200423                IF TRADE-DATE OF TRANS >  WS-PRV-PRINT-DATE         AND
203680200423                   WS-PRV-PRINT-DATE   >  0                         AND
203690200423                 ((TRADE-DATE OF TRANS <= WS-FED-PRINT-DATE         AND
203700200423                   WS-FED-PRINT-DATE   >  0 )                       OR
203710200423                  (WS-FED-PRINT-DATE   <= WS-PRV-PRINT-DATE         AND
203720200423                   WS-FED-PRINT-DATE   >  0))
203730200423
203740200423                   MOVE WS-PRV-PRINT-DATE
203750200423                     TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
203760200423
203770200423      * Retrieve PROVINCIAL jurisdiction record.
203780200423                   MOVE PROVINCE-CODE OF INVESTOR
203790200423                     TO WS-PROVINCE-CODE
203800200423                   PERFORM GET-LSIF-JURISDICTION
203810200423      * If PROV record not found, reject the transaction.
203820200423                   IF WS-JURISDICTION-EXIST = "N"
203830200423                     DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
203840200423                     DISPLAY "@@@P10 MISSING LSIF-JURISDICTION "
203850200423                     MOVE "L1" TO REJECTION-CODE OF TRANS
203860200423                     GO TO PLS-EXIT
203870200423                   END-IF
203880200423                   IF WS-JURISDICTION-EXIST = "Y" AND
203890200423                      WS-JURISDICTION-ISSUE = "Y"
203900200423                        MOVE "P"
203910200423                          TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
203920200423      * Retrieve FEDERAL jurisdiction record.
203930200423                        MOVE "FED"
203940200423                          TO WS-PROVINCE-CODE
203950200423                        PERFORM GET-LSIF-JURISDICTION
203960200423                        IF WS-JURISDICTION-EXIST = "Y" AND
203970200423                           WS-JURISDICTION-ISSUE = "Y"
203980200423                             MOVE "B"
203990200423                               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204000200423                        END-IF
204010200423      ***********
204020200423                   ELSE
204030200423                     IF TRADE-DATE OF TRANS >  WS-FED-PRINT-DATE
204040200423                       MOVE WS-FED-PRINT-DATE
204050200423                         TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
204060200423
204070200423      * Retrieve FEDERAL jurisdiction record.
204080200423                        MOVE "FED"
204090200423                          TO WS-PROVINCE-CODE
204100200423                        PERFORM GET-LSIF-JURISDICTION
204110200423                        IF WS-JURISDICTION-EXIST = "Y" AND
204120200423                           WS-JURISDICTION-ISSUE = "Y"
204130200423                             MOVE "F"
204140200423                               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204150200423
204160200423      * Retrieve PROVINCIAL jurisdiction record.
204170200423                           MOVE PROVINCE-CODE OF INVESTOR
204180200423                             TO WS-PROVINCE-CODE
204190200423                           PERFORM GET-LSIF-JURISDICTION
204200200423      * If PROV record not found, reject the transaction.
204210200423                           IF WS-JURISDICTION-EXIST = "N"
204220200423                             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
204230200423                             DISPLAY "@@@P11 MISSING LSIF-JURISDICTION"
204240200423                             MOVE "L1" TO REJECTION-CODE OF TRANS
204250200423                            GO TO PLS-EXIT
204260200423                           END-IF
204270200423                           IF WS-JURISDICTION-EXIST = "Y" AND
204280200423                              WS-JURISDICTION-ISSUE = "Y"
204290200423                               MOVE "B"
204300200423                               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204310200423                           END-IF
204320200423                        END-IF
204330200423      ***********
204340200423                     ELSE
204350200423                       MOVE TRADE-DATE OF TRANS
204360200423                         TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
204370200423
204380200423                       PERFORM GET-BOTH-LSIF-JURISDICTIONS
204390200423                     END-IF
204400200423                   END-IF
204410200423                ELSE
204420200423                  IF TRADE-DATE OF TRANS >  WS-FED-PRINT-DATE       AND
204430200423                     WS-FED-PRINT-DATE   >  0                       AND
204440200423                   ((TRADE-DATE OF TRANS <= WS-PRV-PRINT-DATE       AND
204450200423                     WS-PRV-PRINT-DATE   >  0 )                     OR
204460200423                    (WS-PRV-PRINT-DATE   <= WS-FED-PRINT-DATE       AND
204470200423                     WS-PRV-PRINT-DATE   >  0))
204480200423
204490200423                     MOVE WS-FED-PRINT-DATE
204500200423                       TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
204510200423
204520200423      * Retrieve FEDERAL jurisdiction record.
204530200423                     MOVE "FED"
204540200423                       TO WS-PROVINCE-CODE
204550200423                     PERFORM GET-LSIF-JURISDICTION
204560200423                     IF WS-JURISDICTION-EXIST = "Y" AND
204570200423                        WS-JURISDICTION-ISSUE = "Y"
204580200423                          MOVE "F"
204590200423                            TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204600200423      * Retrieve PROVINCIAL jurisdiction record.
204610200423                          MOVE PROVINCE-CODE OF INVESTOR
204620200423                            TO WS-PROVINCE-CODE
204630200423                          PERFORM GET-LSIF-JURISDICTION
204640200423      * If PROV record not found, reject the transaction.
204650200423                          IF WS-JURISDICTION-EXIST = "N"
204660200423                            DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
204670200423                            DISPLAY "@@@P11 MISSING LSIF-JURISDICTION"
204680200423                            MOVE "L1" TO REJECTION-CODE OF TRANS
204690200423                           GO TO PLS-EXIT
204700200423                          END-IF
204710200423                          IF WS-JURISDICTION-EXIST = "Y" AND
204720200423                             WS-JURISDICTION-ISSUE = "Y"
204730200423                               MOVE "B"
204740200423                               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204750200423                          END-IF
204760200423      ***********
204770200423                     ELSE
204780200423                       IF TRADE-DATE OF TRANS >  WS-PRV-PRINT-DATE
204790200423                         MOVE WS-PRV-PRINT-DATE
204800200423                         TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
204810200423
204820200423      * Retrieve PROVINCIAL jurisdiction record.
204830200423                         MOVE PROVINCE-CODE OF INVESTOR
204840200423                           TO WS-PROVINCE-CODE
204850200423                         PERFORM GET-LSIF-JURISDICTION
204860200423      * If PROV record not found, reject the transaction.
204870200423                         IF WS-JURISDICTION-EXIST = "N"
204880200423                           DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
204890200423                           DISPLAY "@@@P11 MISSING LSIF-JURISDICTION"
204900200423                           MOVE "L1" TO REJECTION-CODE OF TRANS
204910200423                           GO TO PLS-EXIT
204920200423                         END-IF
204930200423                         IF WS-JURISDICTION-EXIST = "Y" AND
204940200423                            WS-JURISDICTION-ISSUE = "Y"
204950200423                              MOVE "P"
204960200423                              TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
204970200423
204980200423      * Retrieve FEDERAL jurisdiction record.
204990200423                              MOVE "FED"
205000200423                              TO WS-PROVINCE-CODE
205010200423                              PERFORM GET-LSIF-JURISDICTION
205020200423                              IF WS-JURISDICTION-EXIST = "Y" AND
205030200423                                 WS-JURISDICTION-ISSUE = "Y"
205040200423                               MOVE "B"
205050200423                               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
205060200423                              END-IF
205070200423                         END-IF
205080200423      ***********
205090200423                       ELSE
205100200423                         MOVE TRADE-DATE OF TRANS
205110200423                         TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
205120200423
205130200423                         PERFORM GET-BOTH-LSIF-JURISDICTIONS
205140200423                       END-IF
205150200423                     END-IF
205160200423                  ELSE
205170200423
205180200423R27851              MOVE TRADE-DATE OF TRANS
205190200423R27851                TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
205200200423
205210200423                    PERFORM GET-BOTH-LSIF-JURISDICTIONS
205220200423
205230200423                  END-IF
205240200423                END-IF
205250200423              END-IF
205260200423           END-IF.
205270200423
205280200423      * One last check of file LSIF-TAX-CREDITS-ALLOWED before we
205290200423      * stop evaluating how the LSIF-STATUS should be set.
20530020042328482**Move this paragraph to upper level to enhance the performance.
20531020042328482**    IF LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY IS NOT EQUAL "N"
20532020042328482**      PERFORM GET-LSIF-TAX-CREDITS-ALLOWED
20533020042328482**    END-IF.
205340200423
205350200423      * If the LSIF-STATUS is changed to "N" then move the trade date
205360200423      * to contribution date.
20537020042328482**Move this paragraph to upper level enhance the performance.
20538020042328482**    IF LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "N"
20539020042328482**      MOVE TRADE-DATE OF TRANS
20540020042328482**        TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
20541020042328482**      MOVE TRADE-DATE OF TRANS
20542020042328482**        TO WS-WK-TRADE-DATE
20543020042328482**      MOVE WS-WKT-YEAR
20544020042328482**        TO TAX-YEAR          OF TRANS-BUY-LSIF-PRIMARY
20545020042328482**    END-IF.
205460200423
20547020042328482      IF LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "B" AND
20548020042328482         (WS-PRV-BOX-ID IS NOT = WS-FED-BOX-ID AND
20549020042328482         (WS-PRV-BOX-ID = "4" OR WS-FED-BOX-ID = "4"))
20550020042328482           DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
20551020042328482           DISPLAY "@@@P9 BOX ID MISMATCH           "
20552020042328482           MOVE "L7" TO REJECTION-CODE OF TRANS
20553020042328482      END-IF.
205540200423      * Set the Tax Year as follows.
20555020042328482      IF (WS-PRV-BOX-ID = "4"   AND
20556020042328482         (LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "P" OR
20557020042328482          LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "B")) OR
20558020042328482         (WS-FED-BOX-ID = "4"   AND
20559020042328482         (LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "F" OR
20560020042328482          LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY = "B"))
20561020042328482         MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
20562020042328482           TO WS-WK-TRADE-DATE
20563020042328482         COMPUTE WS-WKT-YEAR = WS-WKT-YEAR - 1
20564020042328482         MOVE WS-WKT-YEAR
20565020042328482          TO TAX-YEAR OF TRANS-BUY-LSIF-PRIMARY
20566020042328482      END-IF.
205670200423
205680200423           IF WS-LBS-VALIDATION-MODE-FLAG = 'Y' OR
205690200423              REJECTION-CODE OF TRANS IS NOT EQUAL "00"
205700200423               GO TO PLS-EXIT
205710200423           END-IF.
205720200423
205730200423      * RFS26557 End
205740200423
205750200423       PLS-0030.
205760200423      *RFS 20265 End
205770200423
205780200423      * RFS 18191 End
205790200423
205800200423      * RFS 15658 begins
205810200423           MOVE WS-FOREIGN-CONTENT-ELIGIBLE TO
205820200423                FOREIGN-CONTENT-ELIGIBLE OF TRANS-BUY-LSIF-PRIMARY.
205830200423      * RFS 15658 ends
205840200423      * RFS 16760 begins
205850200423           MOVE PROVINCE-CODE OF INVESTOR   TO
205860200423                PROVINCE-CODE            OF TRANS-BUY-LSIF-PRIMARY.
205870200423
205880200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
205890200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
205900200423           AND WS-LBS-VALIDATION-MODE-FLAG IS NOT EQUAL "Y"
205910200423      * RFS 16760 ends
205920200423      * RFS 18486 Begin
205930200423      * Before writing TRANS-BUY-LSIF, we will perform a section which
205940200423      * will check if a record exists in TRANS-BUY-LSIF with the same
205950200423      * key, if so, we will simply rewrite the record using fields
205960200423      * from both records as specified (Master RFS 18447).
205970200423
205980200423               MOVE "N" TO WS-TBL-ALREADY-EXISTS
205990200423               PERFORM CHECK-IF-TRANS-BUY-LSIF-EXISTS
206000200423
206010200423               IF TBL-ALREADY-EXISTS
206020200423                   REWRITE TRANS-BUY-LSIF-PRI-REC
206030200423                     INVALID KEY
20604020042358714                  CONTINUE
20605020042358714 *                MOVE "LBS BUY"  TO WS-FILE-STATUS-FILE-NAME
20606020042358714 *                PERFORM LOG-FILE-STATUS
206070200423                   END-REWRITE
20608020042358714              IF WS-FILE-STATUS IS NOT EQUAL TO "00"
20609020042358714                 MOVE "MFATBLP" TO WS-FILE-STATUS-FILE-NAME
20610020042358714                 SET lncc_Err116  TO  TRUE
20611020042358714                 PERFORM LOG-FILE-STATUS
20612020042358714              END-IF
206130200423               ELSE
206140200423                   WRITE TRANS-BUY-LSIF-PRI-REC
206150200423                     INVALID KEY
20616020042358714                  CONTINUE
20617020042358714 *                MOVE "LBS BUY" TO WS-FILE-STATUS-FILE-NAME
20618020042358714 *                PERFORM LOG-FILE-STATUS
206190200423                   END-WRITE
20620020042358714              IF WS-FILE-STATUS IS NOT EQUAL TO "00"
20621020042358714                 MOVE "MFATBLP" TO WS-FILE-STATUS-FILE-NAME
20622020042358714                 SET lncc_Err117  TO  TRUE
20623020042358714                 PERFORM LOG-FILE-STATUS
20624020042358714              END-IF
206250200423               END-IF
206260200423           END-IF.
206270200423      * RFS 18486 End
206280200423
206290200423           GO TO PLS-EXIT.
206300200423
206310200423       PLS-0040.
206320200423      * RFS 20265 Begin
206330200423           IF WS-LBS-VALIDATION-MODE-FLAG = 'Y'
206340200423               GO TO PLS-EXIT
206350200423           END-IF.
206360200423      * RFS 20265 End
206370200423           MOVE ZEROES       TO WS-LSIF-SWI-SEQ.
206380200423
206390200423           MOVE PLACEMENT-DATE OF WS-TRANS-REC-5
206400200423                             TO PLACEMENT-DATE
206410200423                             OF TRANS-SELL-LSIF-PRIMARY.
206420200423           MOVE TRANS-NO OF WS-TRANS-REC-5
206430200423                             TO TRANS-NO
206440200423                             OF TRANS-SELL-LSIF-PRIMARY.
206450200423           MOVE ZEROES       TO LSIF-SEQ-NO
206460200423                             OF TRANS-SELL-LSIF-PRIMARY.
206470200423
206480200423
206490200423           START TRANS-SELL-LSIF-PRIMARY
206500200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
206510200423           INVALID KEY
206520200423               MOVE "LBS SL ST" TO WS-FILE-STATUS-FILE-NAME
20653020042358714          PERFORM LOG-FILE-STATUS-RD
206540200423               GO TO PLS-EXIT
206550200423           END-START.
206560200423
206570200423       PLS-0050.
206580200423
206590200423           READ TRANS-SELL-LSIF-PRIMARY NEXT RECORD
206600200423           WITH NO LOCK
206610200423           AT END
206620200423             GO TO PLS-EXIT
206630200423           END-READ.
206640200423
206650200423           IF PLACEMENT-DATE OF TRANS-SELL-LSIF-PRIMARY
206660200423           IS NOT EQUAL PLACEMENT-DATE OF WS-TRANS-REC-5 OR
206670200423           TRANS-NO OF TRANS-SELL-LSIF-PRIMARY
206680200423           IS NOT EQUAL TRANS-NO OF WS-TRANS-REC-5
206690200423             GO TO PLS-EXIT
206700200423           END-IF.
206710200423
206720200423           IF LSIF-WAIVE-CLAWBACK-FED OF TRANS-SELL-LSIF-PRIMARY
206730200423           IS NOT EQUAL "T"
206740200423             GO TO PLS-0050
206750200423           END-IF.
206760200423
206770200423           MOVE PLACEMENT-DATE-2 OF TRANS-SELL-LSIF-PRIMARY
206780200423                              TO PLACEMENT-DATE
206790200423                              OF TRANS-BUY-LSIF-PRIMARY.
206800200423
206810200423           MOVE TRANS-NO-2    OF TRANS-SELL-LSIF-PRIMARY
206820200423                              TO TRANS-NO
206830200423                              OF TRANS-BUY-LSIF-PRIMARY.
206840200423
206850200423           MOVE LSIF-SEQ-NO-2 OF TRANS-SELL-LSIF-PRIMARY
206860200423                              TO LSIF-SEQ-NO
206870200423                              OF TRANS-BUY-LSIF-PRIMARY.
206880200423
206890200423           READ TRANS-BUY-LSIF-PRIMARY
206900200423           WITH NO LOCK
206910200423           INVALID KEY
206920200423               MOVE "LBS SW PR" TO WS-FILE-STATUS-FILE-NAME
20693020042358714          PERFORM LOG-FILE-STATUS-RD
206940200423               GO TO PLS-EXIT
206950200423           END-READ.
206960200423
20697020042318781      INITIALIZE WS-TRANS-BUY-LSIF-REC.
206980200423
206990200423           MOVE TRANS-BUY-LSIF-PRI-REC
207000200423                             TO WS-TRANS-BUY-LSIF-REC.
207010200423
207020200423           INITIALIZE MFATBLP OF TRANS-BUY-LSIF-PRIMARY.
207030200423
207040200423           MOVE PLACEMENT-DATE OF TRANS
207050200423                             TO PLACEMENT-DATE
207060200423                             OF TRANS-BUY-LSIF-PRIMARY.
207070200423           MOVE TRANS-NO OF TRANS
207080200423                             TO TRANS-NO
207090200423                             OF TRANS-BUY-LSIF-PRIMARY.
207100200423
207110200423           ADD 1             TO WS-LSIF-SWI-SEQ.
207120200423
207130200423           MOVE WS-LSIF-SWI-SEQ
207140200423                             TO LSIF-SEQ-NO
207150200423                             OF TRANS-BUY-LSIF-PRIMARY.
207160200423
207170200423           IF PLACEMENT-DATE-2 OF WS-TRANS-BUY-LSIF-REC
207180200423           IS NOT EQUAL 0
207190200423             MOVE PLACEMENT-DATE-2 OF WS-TRANS-BUY-LSIF-REC
207200200423                             TO PLACEMENT-DATE-2
207210200423                             OF TRANS-BUY-LSIF-PRIMARY
207220200423             MOVE TRANS-NO-2 OF WS-TRANS-BUY-LSIF-REC
207230200423                             TO TRANS-NO-2
207240200423                             OF TRANS-BUY-LSIF-PRIMARY
207250200423             MOVE LSIF-SEQ-NO-2 OF WS-TRANS-BUY-LSIF-REC
207260200423                             TO LSIF-SEQ-NO-2
207270200423                             OF TRANS-BUY-LSIF-PRIMARY
207280200423           ELSE
207290200423             MOVE PLACEMENT-DATE OF WS-TRANS-BUY-LSIF-REC
207300200423                             TO PLACEMENT-DATE-2
207310200423                             OF TRANS-BUY-LSIF-PRIMARY
207320200423             MOVE TRANS-NO   OF WS-TRANS-BUY-LSIF-REC
207330200423                             TO TRANS-NO-2
207340200423                             OF TRANS-BUY-LSIF-PRIMARY
207350200423             MOVE LSIF-SEQ-NO OF WS-TRANS-BUY-LSIF-REC
207360200423                             TO LSIF-SEQ-NO-2
207370200423                             OF TRANS-BUY-LSIF-PRIMARY
207380200423           END-IF.
207390200423
207400200423           MOVE TRADE-DATE OF WS-TRANS-BUY-LSIF-REC
207410200423                             TO TRADE-DATE
207420200423                             OF TRANS-BUY-LSIF-PRIMARY.
207430200423           MOVE ACCOUNT-NO OF TRANS
207440200423                             TO ACCOUNT-NO
207450200423                             OF TRANS-BUY-LSIF-PRIMARY.
207460200423           MOVE TRANS-TYPE-CODE OF TRANS
207470200423                             TO TRANS-TYPE-CODE
207480200423                             OF TRANS-BUY-LSIF-PRIMARY.
207490200423           MOVE INVESTMENT-CODE OF TRANS
207500200423                             TO INVESTMENT-CODE
207510200423                             OF TRANS-BUY-LSIF-PRIMARY.
207520200423           MOVE UNITS-REDUCED OF TRANS-SELL-LSIF-PRIMARY
207530200423                             TO ORIG-UNIT-BAL
207540200423                             OF TRANS-BUY-LSIF-PRIMARY
207550200423                                CURR-UNIT-BAL
207560200423                             OF TRANS-BUY-LSIF-PRIMARY.
207570200423      * RFS 18781 - begin
207580200423           MOVE COUNTRY-CODE      OF WS-TRANS-BUY-LSIF-REC
207590200423             TO COUNTRY-CODE      OF TRANS-BUY-LSIF-PRIMARY.
207600200423           MOVE PROVINCE-CODE     OF WS-TRANS-BUY-LSIF-REC
207610200423             TO PROVINCE-CODE     OF TRANS-BUY-LSIF-PRIMARY.
207620200423           MOVE CONTRIBUTION-DATE OF WS-TRANS-BUY-LSIF-REC
207630200423             TO CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY.
207640200423           MOVE TAX-YEAR          OF WS-TRANS-BUY-LSIF-REC
207650200423             TO TAX-YEAR          OF TRANS-BUY-LSIF-PRIMARY.
207660200423           MOVE LSIF-STATUS       OF TRANS-SELL-LSIF-PRIMARY
207670200423             TO LSIF-STATUS       OF TRANS-BUY-LSIF-PRIMARY.
207680200423      * RFS 18781 - end
207690200423      *RFS 16760 begins
207700200423      **** Must get TRANS-BUY-LSIF that the Sell originated -
207710200423      **** which contains the PROVINCE-CODE that should populate the
207720200423      **** new TRANS-BUY-LSIF record.
207730200423
207740200423      * RFS 18781 - begin- Dino - Commented code below, it is redundant because
207750200423      * of the change above for the same RFS. Also, MOVE LSIF-SEQ-NO-2 statement
207760200423      * is incorrect, should be TO LSIF-SEQ-NO instead of TO LSIF-SEQ-NO-2.
207770200423
207780200423      *    MOVE PLACEMENT-DATE-2 OF TRANS-SELL-LSIF-PRIMARY
207790200423      *    TO   PLACEMENT-DATE   OF TRANS-BUY-LSIF2.
207800200423
207810200423      *    MOVE TRANS-NO-2       OF TRANS-SELL-LSIF-PRIMARY
207820200423      *    TO   TRANS-NO         OF TRANS-BUY-LSIF2.
207830200423
207840200423      *    MOVE LSIF-SEQ-NO-2    OF TRANS-SELL-LSIF-PRIMARY
207850200423      *    TO   LSIF-SEQ-NO-2    OF TRANS-BUY-LSIF2.
207860200423
207870200423
207880200423      *    READ TRANS-BUY-LSIF2
207890200423      *    INVALID KEY
207900200423      *        MOVE "TBL2 READ"  TO WS-FILE-STATUS-FILE-NAME
207910200423      *        PERFORM LOG-FILE-STATUS
207920200423      *        MOVE " " TO PROVINCE-CODE OF TRANS-BUY-LSIF-PRIMARY
207930200423      *        GO TO PLS-0060
207940200423      *    END-READ.
207950200423
207960200423      *    MOVE COUNTRY-CODE  OF TRANS-BUY-LSIF2
207970200423      *    TO   COUNTRY-CODE  OF TRANS-BUY-LSIF-PRIMARY.
207980200423
207990200423      *    MOVE PROVINCE-CODE OF TRANS-BUY-LSIF2
208000200423      *    TO PROVINCE-CODE OF TRANS-BUY-LSIF-PRIMARY.
208010200423      * RFS 18781 end
208020200423
208030200423       PLS-0060.
208040200423      *RFS 16760 ends
208050200423
208060200423      *RFS 15658 begins
208070200423           MOVE WS-FOREIGN-CONTENT-ELIGIBLE TO
208080200423                FOREIGN-CONTENT-ELIGIBLE OF TRANS-BUY-LSIF-PRIMARY.
208090200423      *RFS 15658 ends
208100200423
208110200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
208120200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
208130200423      *RFS 16760 Begins
208140200423           AND WS-LBS-VALIDATION-MODE-FLAG IS NOT EQUAL "Y"
208150200423      *RFS 16760 ends
208160200423             WRITE TRANS-BUY-LSIF-PRI-REC
208170200423             INVALID KEY
208180200423                 MOVE "LBS SW PR"  TO WS-FILE-STATUS-FILE-NAME
20819020042358714            SET lncc_Err118  TO  TRUE
208200200423                 PERFORM LOG-FILE-STATUS
208210200423                 GO TO PLS-EXIT
208220200423             END-WRITE
20823020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
20824020042358714           MOVE "MFATBLP" TO WS-FILE-STATUS-FILE-NAME
20825020042358714           SET lncc_Err119  TO  TRUE
20826020042358714           PERFORM LOG-FILE-STATUS
20827020042358714        END-IF
208280200423           END-IF.
208290200423
208300200423           GO TO PLS-0050.
208310200423
208320200423       PLS-EXIT.
208330200423           EXIT.
208340200423      /
208350200423      *RFS 14380 Begin
208360200423      ******************************************************************
208370200423      *    P O S T   E R F  P U R C H A S E  U N I T S                 *
208380200423      ******************************************************************
208390200423       POST-ERF-PURCHASE-UNITS SECTION.
208400200423
208410200423      *RFS 20811 Begin
208420200423      ****************************************************************
208430200423      **** IMPORTANT: ENSURE ANY CHANGES MADE TO THE ERF LOGIC IS ALSO
208440200423      **** APPLIED TO THE GENERFRC PROGRAM IF APPLICABLE.
208450200423      ****************************************************************
208460200423      *RFS 20811 End                                                    because
208470200423
208480200423       PEPU-0000.
208490200423
208500200423           IF WS-PASS-SWITCH-EDIT IS EQUAL "1"
208510200423             GO TO PEPU-EXIT
208520200423           END-IF.
208530200423
208540200423           IF WS-ERF-VALIDATION-MODE-FLAG = "Y"
208550200423               CONTINUE
208560200423           ELSE
208570200423               IF NOT HISTORY
208580200423                   GO TO PEPU-EXIT
208590200423               END-IF
208600200423           END-IF.
208610200423
208620200423           IF NOT SPEC-MOD-AUTH-ERFEE
208630200423             GO TO PEPU-EXIT
208640200423           END-IF.
208650200423
208660200423       PEPU-0010.
208670200423
208680200423      * Get ERF schedule code for this investment
208690200423
208700200423           MOVE INVESTMENT-CODE OF TRANS
208710200423                            TO INVESTMENT-CODE
208720200423                            OF INVESTMENT-ERF-SCHEDULE.
208730200423
208740200423           READ INVESTMENT-ERF-SCHEDULE
208750200423             INVALID KEY
208760200423             MOVE "INV ERF SCHEDULE" TO WS-FILE-STATUS-FILE-NAME
20877020042358714          PERFORM LOG-FILE-STATUS-RD
208780200423               DISPLAY "@@@ No INVESTMENT-ERF-SCHEDULE"
208790200423               MOVE SPACES TO ERF-SCHEDULE-CODE
208800200423               OF TRANS-ERF-PURCHASE-PRIMARY
208810200423               GO TO PEPU-EXIT
208820200423           END-READ
208830200423
208840200423           MOVE ERF-SCHEDULE-CODE OF INVESTMENT-ERF-SCHEDULE
208850200423           TO   ERF-SCHEDULE-CODE OF ERF-SCHEDULE.
208860200423
208870200423           READ ERF-SCHEDULE
208880200423           INVALID KEY
208890200423             MOVE ZEROES     TO WS-ERF-CHARGE
208900200423             DISPLAY "@@@ No ERF schedule"
208910200423             GO TO PEPU-EXIT
208920200423           END-READ.
208930200423
208940200423      * If creating new age dates - GO TO PEPU-0020
208950200423      * If carrying over age dates - GO TO PEPU-0040
208960200423
208970200423           IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BUY" OR "INC" OR
208980200423           "CPG" OR "INT" OR "BAJ" OR "MFR"
208990200423             GO TO PEPU-0020
209000200423           END-IF.
209010200423
209020200423      *RFS184348 - Begins
209030200423           IF ENTERED-BY OF TRANS = "AUTOSW"
209040200423              GO TO PEPU-0040
209050200423           END-IF
209060200423      *RFS184348 - End
209070200423           IF TRANSFER-IN-TRANSACTION
209080200423      *RFS177665 - Starts
209090200423              OR ( SWI-TRANSACTION AND lc_SameInvStructFlag = "Y" )
209100200423              IF lc_ERFSwoExistFlag = "N"
209110200423               GO TO PEPU-0020
209120200423              ELSE
209130200423      *RFS177665 - Ends
209140200423               GO TO PEPU-0040
209150200423177665        END-IF
209160200423           ELSE
209170200423               IF SWITCH-IN-TRANSACTION
209180200423               AND CHARGE-CODE OF ERF-SCHEDULE = "B"
209190200423               AND TRANS-ORIGIN-CODE OF TRANS NOT EQUAL "MRG"
209200200423                 GO TO PEPU-0020
209210200423               ELSE
209220200423                 GO TO PEPU-0040
209230200423               END-IF
209240200423           END-IF.
209250200423
209260200423       PEPU-0020.
209270200423
209280200423      *This section is where the transaction's age date is set to
209290200423      *today's trade date (age dates are not carried forward). Section
209300200423      *PEPU-0040 is used for other transactions where the units have
209310200423      *been transferred and age dates must be carried forward.
209320200423
209330200423           INITIALIZE MFATRNEPP OF TRANS-ERF-PURCHASE-PRIMARY
209340200423           MOVE PLACEMENT-DATE OF TRANS
209350200423                             TO PLACEMENT-DATE
209360200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209370200423           MOVE TRANS-NO OF TRANS
209380200423                             TO TRANS-NO OF TRANS-ERF-PURCHASE-PRIMARY.
209390200423
209400200423           MOVE 1            TO ERF-SEQ-NO
209410200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209420200423
209430200423      *RFS24922 Start
209440200423      * For BAJ transactions the MFATRNEPP record was created at the
209450200423      * transaction was placed through TRNBADJ screen in order to save
209460200423      * the user entered ERF-APPLICABLE flag.
209470200423           IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BAJ"
209480200423             READ TRANS-ERF-PURCHASE-PRIMARY
209490200423               INVALID KEY
209500200423               MOVE "TRANS ERF PURCH" TO WS-FILE-STATUS-FILE-NAME
20951020042358714            PERFORM LOG-FILE-STATUS-RD
209520200423                 DISPLAY "@@@ No TRANS-ERF-PURCH for BAJ"
209530200423                 GO TO PEPU-EXIT
209540200423             END-READ
209550200423           END-IF.
209560200423      *RFS24922 End
209570200423
209580200423           MOVE TRADE-DATE OF TRANS
209590200423                             TO TRADE-DATE
209600200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209610200423           MOVE UNIT-AMT OF TRANS
209620200423                             TO CURR-UNIT-BAL
209630200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209640200423
209650200423           MOVE "A"          TO ERF-STATUS
209660200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209670200423
209680200423           MOVE ACCOUNT-NO OF TRANS
209690200423                             TO ACCOUNT-NO
209700200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209710200423
209720200423           MOVE INVESTMENT-CODE OF TRANS
209730200423                             TO INVESTMENT-CODE
209740200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
209750200423
209760200423           MOVE ZEROES       TO PLACEMENT-DATE-2
209770200423                                OF TRANS-ERF-PURCHASE-PRIMARY
209780200423                                TRANS-NO-2
209790200423                                OF TRANS-ERF-PURCHASE-PRIMARY
209800200423                                ERF-SEQ-NO-2
209810200423                                OF TRANS-ERF-PURCHASE-PRIMARY.
209820200423
209830200423           MOVE ERF-SCHEDULE-CODE  OF ERF-SCHEDULE
209840200423                                TO ERF-SCHEDULE-CODE
209850200423                                OF TRANS-ERF-PURCHASE-PRIMARY.
209860200423
209870200423           MOVE UNIT-PRICE OF TRANS
209880200423                                TO UNIT-PRICE
209890200423                                OF TRANS-ERF-PURCHASE-PRIMARY.
209900200423
209910200423      * RFS 28264 - begins.
209920200423      *    IF FREE-TRANSACTIONS OF ERF-SCHEDULE = "N"
209930200423      *    OR (FREE-TRANSACTIONS OF ERF-SCHEDULE = "D"
209940200423           IF Free-Transactions OF Erf-Schedule = lncc_N
209950200423           OR (Free-Transactions OF Erf-Schedule = lncc_D
209960200423      * RFS 28264 - ends.
209970200423               AND NOT DISTRIBUTION-TRANSACTION)
209980200423                MOVE UNIT-AMT OF TRANS
209990200423                                TO CURR-UNITS-CHRG
210000200423                                OF TRANS-ERF-PURCHASE-PRIMARY
210010200423           ELSE
210020200423                MOVE UNIT-AMT OF TRANS
210030200423                                TO CURR-UNITS-FREE
210040200423                                OF TRANS-ERF-PURCHASE-PRIMARY
210050200423           END-IF.
210060200423
210070200423      * RFS92475 - Start.
210080200423           IF lb_editCodeSTTFSetupYes
210090200423                SET CRRIDX TO 1
210100200423                SEARCH Fee-Exclusions-Array VARYING CRRIDX
210110200423                  AT END
210120200423                       CONTINUE
210130200423                  WHEN lc_Fee-Acct-Type-Code(CRRIDX)   =
210140200423                       Account-type-code OF ACCOUNT
210150200423                  AND  lc_Fee-Contr-Redem-Rule(CRRIDX) =
210160200423                       Contr-Redem-Code-Rule OF CONTR-REDEM-CODE-RULES
210170200423                  AND  lc_Fee-Charge-Code(CRRIDX)      =
210180200423                       lncc_ERED
210190200423                          MOVE UNIT-AMT OF TRANS TO CURR-UNITS-FREE
210200200423                                        OF TRANS-ERF-PURCHASE-PRIMARY
210210200423                          MOVE ZEROS             TO CURR-UNITS-CHRG
210220200423                                        OF TRANS-ERF-PURCHASE-PRIMARY
210230200423                END-SEARCH
210240200423              END-IF
210250200423      * RFS92475 - End.
210260200423      * RFS 28264 - begins.
210270200423      *---------------------------------------------------------------*
210280200423      * Waive ERF Charges if ERF Applicable was set to "N" for "BAJ"
210290200423      * transaction at the time of the adjustment (fix to RFS 24922).
210300200423      *---------------------------------------------------------------*
210310200423           IF (Free-Transactions of Erf-Schedule NOT = lncc_A) AND
210320200423              (Purchase-Adjustment  AND
210330200423               Erf-Applicable  of Trans-Erf-Purchase-Primary = lncc_N)
210340200423                MOVE 0                 TO Curr-Units-Chrg
210350200423                                          of Trans-Erf-Purchase-Primary
210360200423                MOVE Unit-Amt of Trans TO Curr-Units-Free
210370200423                                          of Trans-Erf-Purchase-Primary
210380200423           END-IF.
210390200423      * RFS 28264 - ends.
210400200423
210410200423           MOVE UNIT-AMT OF TRANS
210420200423                             TO ORIG-UNIT-BAL
210430200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
210440200423
210450200423           MOVE TRADE-DATE OF TRANS
210460200423                             TO AGE-DATE
210470200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
210480200423
210490200423      *RFS24922 Start
210500200423      * Do not set the ERF-APPLICABLE flag here for BAJ as it has been
210510200423      * entered during the TRNBADJ screen.
210520200423      *    IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BUY" OR "BAJ" OR "MFR"
210530200423           IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BUY" OR "MFR"
210540200423      *RFS24922 End
210550200423      *RFS 25060 Begin
210560200423               OR "SWI"
210570200423      *RFS 25060 End
210580200423               MOVE "Y"   TO ERF-APPLICABLE
210590200423               OF TRANS-ERF-PURCHASE-PRIMARY
210600200423           ELSE
210610200423      *RFS24922 Start
210620200423             IF TRANS-TYPE-CODE OF TRANS IS NOT EQUAL "BAJ"
210630200423      *RFS24922 End
210640200423               MOVE "N"   TO ERF-APPLICABLE
210650200423               OF TRANS-ERF-PURCHASE-PRIMARY
210660200423      *RFS24922 Start
210670200423             END-IF
210680200423      *RFS24922 End
210690200423           END-IF.
210700200423
210710200423      *RFS177665 - Starts
210720200423           IF  TRANS-TYPE-CODE OF TRANS IS EQUAL "SWI"
210730200423           AND lc_SameInvStructFlag = "Y"
210740200423           AND lc_ERFSwoExistFlag = "N"
210750200423               MOVE "N"   TO ERF-APPLICABLE
210760200423               OF TRANS-ERF-PURCHASE-PRIMARY
210770200423           END-IF.
210780200423      *RFS177665 - Ends
210790200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
210800200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
210810200423           AND WS-ERF-VALIDATION-MODE-FLAG IS NOT EQUAL "Y"
210820200423
210830200423      *RFS24922 Start
210840200423           IF TRANS-TYPE-CODE OF TRANS IS EQUAL "BAJ"
210850200423             REWRITE TRANS-ERF-PURCHASE-PRI-REC
210860200423               INVALID KEY
21087020042358714            CONTINUE
21088020042358714 *          MOVE "ERF BUY" TO WS-FILE-STATUS-FILE-NAME
21089020042358714 *          PERFORM LOG-FILE-STATUS
21090020042358714        END-REWRITE
21091020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
21092020042358714           MOVE "MFATRNEPP" TO WS-FILE-STATUS-FILE-NAME
21093020042358714           SET lncc_Err120  TO  TRUE
21094020042358714           PERFORM LOG-FILE-STATUS
21095020042358714        END-IF
210960200423           ELSE
210970200423      *RFS24922 End
210980200423
210990200423           WRITE TRANS-ERF-PURCHASE-PRI-REC
211000200423             INVALID KEY
21101020042358714          CONTINUE
21102020042358714 *        MOVE "ERF BUY" TO WS-FILE-STATUS-FILE-NAME
21103020042358714 *        PERFORM LOG-FILE-STATUS
21104020042358714        END-WRITE
21105020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
21106020042358714           MOVE "MFATRNEPP" TO WS-FILE-STATUS-FILE-NAME
21107020042358714           SET lncc_Err121  TO  TRUE
21108020042358714           PERFORM LOG-FILE-STATUS
21109020042358714        END-IF
211100200423      *RFS24922 Start
211110200423           END-IF
211120200423      *RFS24922 End
211130200423           END-IF.
211140200423
211150200423           GO TO PEPU-EXIT.
211160200423
211170200423       PEPU-0040.
211180200423
211190200423      *This section is where the transaction's age date is carried
211200200423      *forward from an original transaction. Section PEPU-0020 is used
211210200423      *to create TRANS-ERF-BUY records with new age dates.
211220200423      *Note: WS-TRANS-REC-5 holds the redemption side of the transfer.
211230200423
211240200423      *RFS 23477 Begin
211250200423           MOVE ZEROES       TO WS-CURR-UNIT-BAL-ACCUMULATOR.
211260200423      *RFS 23477 End
211270200423
211280200423           MOVE ZEROES       TO WS-ERF-SWI-SEQ.
211290200423
211300200423           MOVE PLACEMENT-DATE OF WS-TRANS-REC-5
211310200423                             TO PLACEMENT-DATE
211320200423                             OF TRANS-ERF-SELL.
211330200423           MOVE TRANS-NO OF WS-TRANS-REC-5
211340200423                             TO TRANS-NO
211350200423                             OF TRANS-ERF-SELL.
211360200423           MOVE ZEROES       TO ERF-SEQ-NO
211370200423                             OF TRANS-ERF-SELL.
211380200423
211390200423
211400200423           START TRANS-ERF-SELL
211410200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
211420200423           INVALID KEY
211430200423               MOVE "ERF SL ST" TO WS-FILE-STATUS-FILE-NAME
21144020042358714          PERFORM LOG-FILE-STATUS-RD
211450200423               GO TO PEPU-EXIT
211460200423           END-START.
211470200423
211480200423       PEPU-0050.
211490200423
211500200423           READ TRANS-ERF-SELL NEXT RECORD
211510200423           WITH NO LOCK
211520200423           AT END
211530200423      *RFS 23477 Begin
211540200423             PERFORM UPDATE-LAST-TEP-RECORD
211550200423      *RFS 23477 End
211560200423             GO TO PEPU-EXIT
211570200423           END-READ.
211580200423
211590200423           IF PLACEMENT-DATE OF TRANS-ERF-SELL
211600200423           IS NOT EQUAL PLACEMENT-DATE OF WS-TRANS-REC-5 OR
211610200423           TRANS-NO OF TRANS-ERF-SELL
211620200423           IS NOT EQUAL TRANS-NO OF WS-TRANS-REC-5
211630200423      *RFS 23477 Begin
211640200423             PERFORM UPDATE-LAST-TEP-RECORD
211650200423      *RFS 23477 End
211660200423             GO TO PEPU-EXIT
211670200423           END-IF.
211680200423
211690200423           MOVE PLACEMENT-DATE-2 OF TRANS-ERF-SELL
211700200423                              TO PLACEMENT-DATE
211710200423                              OF TRANS-ERF-PURCHASE-PRIMARY.
211720200423
211730200423           MOVE TRANS-NO-2    OF TRANS-ERF-SELL
211740200423                              TO TRANS-NO
211750200423                              OF TRANS-ERF-PURCHASE-PRIMARY.
211760200423
211770200423           MOVE ERF-SEQ-NO-2 OF TRANS-ERF-SELL
211780200423                              TO ERF-SEQ-NO
211790200423                              OF TRANS-ERF-PURCHASE-PRIMARY.
211800200423
211810200423           READ TRANS-ERF-PURCHASE-PRIMARY
211820200423           WITH NO LOCK
211830200423           INVALID KEY
211840200423               MOVE "ERF SW PR" TO WS-FILE-STATUS-FILE-NAME
21185020042358714          PERFORM LOG-FILE-STATUS-RD
211860200423               GO TO PEPU-EXIT
211870200423           END-READ.
211880200423
211890200423           MOVE TRANS-ERF-PURCHASE-PRI-REC
211900200423                             TO WS-TRANS-ERF-PURCHASE-REC.
211910200423
211920200423           INITIALIZE MFATRNEPP OF TRANS-ERF-PURCHASE-PRIMARY.
211930200423
211940200423           MOVE PLACEMENT-DATE OF TRANS
211950200423                             TO PLACEMENT-DATE
211960200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
211970200423           MOVE TRANS-NO OF TRANS
211980200423                             TO TRANS-NO
211990200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212000200423
212010200423           ADD 1             TO WS-ERF-SWI-SEQ.
212020200423
212030200423           MOVE WS-ERF-SWI-SEQ
212040200423                             TO ERF-SEQ-NO
212050200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212060200423
212070200423           MOVE AGE-DATE   OF WS-TRANS-ERF-PURCHASE-REC
212080200423                             TO TRADE-DATE
212090200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212100200423
212110200423      * Must convert original buy units to new unit price
212120200423      * Use NET/GROSS as factor (from original BUY)
212130200423
212140200423           COMPUTE WS-ERF-NET-GROSS-FACTOR ROUNDED =
212150200423                   NET-AMT   OF WS-TRANS-REC-5 /
212160200423                   GROSS-AMT OF WS-TRANS-REC-5.
212170200423
212180200423           MOVE UNIT-PRICE        OF TRANS
212190200423                             TO UNIT-PRICE
212200200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212210200423
212220200423      *    MOVE UNIT-PRICE        OF WS-TRANS-ERF-PURCHASE-REC
212230200423      *                      TO UNIT-PRICE
212240200423      *                      OF TRANS-ERF-PURCHASE-PRIMARY.
212250200423
212260200423           COMPUTE CURR-UNITS-FREE
212270200423                   OF TRANS-ERF-PURCHASE-PRIMARY ROUNDED =
212280200423                 ((FREE-UNITS-TAKEN-DOWN OF TRANS-ERF-SELL *
212290200423                   WS-ERF-NET-GROSS-FACTOR                 *
212300200423                   UNIT-PRICE OF            WS-TRANS-REC-5)
212310200423                 / UNIT-PRICE            OF TRANS).
212320200423
212330200423           COMPUTE CURR-UNITS-CHRG
212340200423                   OF TRANS-ERF-PURCHASE-PRIMARY ROUNDED =
212350200423                 ((CHRG-UNITS-TAKEN-DOWN OF TRANS-ERF-SELL *
212360200423                   WS-ERF-NET-GROSS-FACTOR                 *
212370200423                   UNIT-PRICE            OF WS-TRANS-REC-5)
212380200423                /  UNIT-PRICE            OF TRANS).
212390200423
212400200423           COMPUTE CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY =
212410200423           CURR-UNITS-FREE OF TRANS-ERF-PURCHASE-PRIMARY +
212420200423           CURR-UNITS-CHRG OF TRANS-ERF-PURCHASE-PRIMARY.
212430200423
212440200423      *RFS 23477 Begin
212450200423           COMPUTE WS-CURR-UNIT-BAL-ACCUMULATOR =
212460200423                   WS-CURR-UNIT-BAL-ACCUMULATOR
212470200423                 + CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY.
212480200423      *RFS 23477 End
212490200423
212500200423           MOVE CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY
212510200423           TO   ORIG-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY.
212520200423
212530200423           MOVE "A"          TO ERF-STATUS
212540200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212550200423
212560200423           MOVE ACCOUNT-NO OF TRANS
212570200423                             TO ACCOUNT-NO
212580200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212590200423           MOVE INVESTMENT-CODE OF TRANS
212600200423                             TO INVESTMENT-CODE
212610200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
212620200423
212630200423           IF PLACEMENT-DATE-2 OF WS-TRANS-ERF-PURCHASE-REC
212640200423           IS NOT EQUAL 0
212650200423             MOVE PLACEMENT-DATE-2 OF WS-TRANS-ERF-PURCHASE-REC
212660200423                             TO PLACEMENT-DATE-2
212670200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212680200423             MOVE TRANS-NO-2 OF WS-TRANS-ERF-PURCHASE-REC
212690200423                             TO TRANS-NO-2
212700200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212710200423             MOVE ERF-SEQ-NO-2 OF WS-TRANS-ERF-PURCHASE-REC
212720200423                             TO ERF-SEQ-NO-2
212730200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212740200423           ELSE
212750200423             MOVE PLACEMENT-DATE OF WS-TRANS-ERF-PURCHASE-REC
212760200423                             TO PLACEMENT-DATE-2
212770200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212780200423             MOVE TRANS-NO   OF WS-TRANS-ERF-PURCHASE-REC
212790200423                             TO TRANS-NO-2
212800200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212810200423             MOVE ERF-SEQ-NO OF WS-TRANS-ERF-PURCHASE-REC
212820200423                             TO ERF-SEQ-NO-2
212830200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212840200423           END-IF.
212850200423
212860200423      *RFS177665 - Starts
212870200423      *    MOVE ERF-SCHEDULE-CODE OF WS-TRANS-ERF-PURCHASE-REC
212880200423      *                      TO ERF-SCHEDULE-CODE
212890200423      *                      OF TRANS-ERF-PURCHASE-PRIMARY.
212900200423           IF  SWI-TRANSACTION
212910200423           AND lc_SameInvStructFlag = "Y"
212920200423               MOVE ERF-SCHEDULE-CODE  OF ERF-SCHEDULE
212930200423                             TO ERF-SCHEDULE-CODE
212940200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212950200423           ELSE
212960200423               MOVE ERF-SCHEDULE-CODE OF WS-TRANS-ERF-PURCHASE-REC
212970200423                             TO ERF-SCHEDULE-CODE
212980200423                             OF TRANS-ERF-PURCHASE-PRIMARY
212990200423           END-IF.
213000200423      *RFS177665 - Ends
213010200423
213020200423           MOVE AGE-DATE OF WS-TRANS-ERF-PURCHASE-REC
213030200423                             TO AGE-DATE
213040200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
213050200423
213060200423           MOVE ERF-APPLICABLE OF WS-TRANS-ERF-PURCHASE-REC
213070200423                             TO ERF-APPLICABLE
213080200423                             OF TRANS-ERF-PURCHASE-PRIMARY.
213090200423
213100200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
213110200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
213120200423           AND WS-ERF-VALIDATION-MODE-FLAG IS NOT EQUAL "Y"
213130200423             WRITE TRANS-ERF-PURCHASE-PRI-REC
213140200423             INVALID KEY
213150200423                 MOVE "ERF SW PR" TO WS-FILE-STATUS-FILE-NAME
21316020042358714            SET lncc_Err122  TO  TRUE
213170200423                 PERFORM LOG-FILE-STATUS
213180200423                 GO TO PEPU-EXIT
213190200423             END-WRITE
21320020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
21321020042358714           MOVE "MFATRNEPP" TO WS-FILE-STATUS-FILE-NAME
21322020042358714           SET lncc_Err123  TO  TRUE
21323020042358714           PERFORM LOG-FILE-STATUS
21324020042358714        END-IF
213250200423           END-IF.
213260200423
213270200423           GO TO PEPU-0050.
213280200423
213290200423       PEPU-EXIT.
213300200423           EXIT.
213310200423      *RFS 23477 Begin
213320200423      /
213330200423      ******************************************************************
213340200423      *    U P D A T E   L A S T   T E P   R E C O R D                 *
213350200423      ******************************************************************
213360200423       UPDATE-LAST-TEP-RECORD SECTION.
213370200423
213380200423       ULTR-0000.
213390200423
213400200423           COMPUTE WS-CURR-UNIT-BAL-MISSING =
213410200423           UNIT-AMT OF TRANS - WS-CURR-UNIT-BAL-ACCUMULATOR.
213420200423
213430200423           IF WS-CURR-UNIT-BAL-MISSING = 0
213440200423               GO TO ULTR-EXIT
213450200423           END-IF.
213460200423
213470200423      * Update the last purchase record with the difference.           *
213480200423           MOVE PLACEMENT-DATE OF TRANS
213490200423                               TO PLACEMENT-DATE
213500200423                               OF TRANS-ERF-PURCHASE-PRIMARY.
213510200423
213520200423           MOVE TRANS-NO       OF TRANS
213530200423                               TO TRANS-NO
213540200423                               OF TRANS-ERF-PURCHASE-PRIMARY.
213550200423
213560200423           MOVE WS-ERF-SWI-SEQ
213570200423                               TO ERF-SEQ-NO
213580200423                               OF TRANS-ERF-PURCHASE-PRIMARY.
213590200423
213600200423           READ TRANS-ERF-PURCHASE-PRIMARY
213610200423           INVALID KEY
213620200423               MOVE "ERF UPDATE" TO WS-FILE-STATUS-FILE-NAME
21363020042358714          PERFORM LOG-FILE-STATUS-RD
213640200423               GO TO ULTR-EXIT
213650200423           END-READ.
213660200423
213670200423           COMPUTE CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY =
213680200423                   CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY
213690200423                 + WS-CURR-UNIT-BAL-MISSING.
213700200423
213710200423           MOVE CURR-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY
213720200423           TO   ORIG-UNIT-BAL OF TRANS-ERF-PURCHASE-PRIMARY.
213730200423
213740200423           IF CURR-UNITS-FREE OF TRANS-ERF-PURCHASE-PRIMARY > 0
213750200423               COMPUTE CURR-UNITS-FREE OF TRANS-ERF-PURCHASE-PRIMARY =
213760200423                       CURR-UNITS-FREE OF TRANS-ERF-PURCHASE-PRIMARY
213770200423                     + WS-CURR-UNIT-BAL-MISSING
213780200423           ELSE
213790200423               COMPUTE CURR-UNITS-CHRG OF TRANS-ERF-PURCHASE-PRIMARY =
213800200423                       CURR-UNITS-CHRG OF TRANS-ERF-PURCHASE-PRIMARY
213810200423                     + WS-CURR-UNIT-BAL-MISSING
213820200423           END-IF.
213830200423
213840200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
213850200423           AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
213860200423           AND WS-ERF-VALIDATION-MODE-FLAG IS NOT EQUAL "Y"
213870200423             REWRITE TRANS-ERF-PURCHASE-PRI-REC
213880200423             INVALID KEY
213890200423                 MOVE "ERF SW PR" TO WS-FILE-STATUS-FILE-NAME
21390020042358714            SET lncc_Err124  TO  TRUE
213910200423                 PERFORM LOG-FILE-STATUS
213920200423                 GO TO ULTR-EXIT
213930200423             END-REWRITE
21394020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
21395020042358714           MOVE "MFATRNEPP" TO WS-FILE-STATUS-FILE-NAME
21396020042358714           SET lncc_Err125  TO  TRUE
21397020042358714           PERFORM LOG-FILE-STATUS
21398020042358714        END-IF
213990200423           END-IF.
214000200423
214010200423       ULTR-EXIT.
214020200423           EXIT.
214030200423      /
214040200423      *RFS 23477 End
214050200423      /
214060200423      ******************************************************************
214070200423      *    P O S T  E R F  S E L L  U N I T S                          *
214080200423      ******************************************************************
214090200423       POST-ERF-SELL-UNITS SECTION.
214100200423
214110200423      *RFS 20811 Begin
214120200423      ****************************************************************
214130200423      **** IMPORTANT: ENSURE ANY CHANGES MADE TO THE ERF LOGIC IS ALSO
214140200423      **** APPLIED TO THE GENERFRC PROGRAM IF APPLICABLE.
214150200423      ****************************************************************
214160200423      *RFS 20811 End                                                    because
214170200423
214180200423       PESU-0000.
214190200423
214200200423           MOVE ZERO         TO WS-ERF-SELL-SEQ
214210200423                                WS-TEP-CURR-UNITS-FREE.
214220200423      *RFS 30055 Start                                                  because
214230200423      * RFS32409 - Start: do not update if it is Soa calculator
214240200423           IF lnc_calcSoa
214250200423      * RFS50832 - Begin
214260200423            OR lnc_calcSoaUpd
214270200423      * RFS50832 - End
214280200423             MOVE WAIVE-ERF OF TRANS-REDEMPTION-DETAILS TO
214290200423                                     WS-WAIVE-ERF-FLAG
214300200423             CONTINUE
214310200423           ELSE
214320200423      * RFS32409 - End
214330200423           MOVE "N"          TO WS-WAIVE-ERF-FLAG.
214340200423      *RFS 30055 End                                                    because
214350200423
214360200423           IF (NOT HISTORY AND NOT CONTRACTED)
214370200423             AND PASS-CDSC-CALCULATOR IS NOT EQUAL "C"
214380200423             GO TO PESU-EXIT
214390200423           END-IF.
214400200423
214410200423      * Get TRANS-REDEMPTION-DETAILS to see if ERF is waived.
214420200423
214430200423      *RFS177665 - Starts
214440200423           INITIALIZE lc_SWOInvestmentCode
214450200423                      lc_SWIInvestmentCode
214460200423                      lc_FunctionCode
214470200423                      lc_SameInvStructFlag
214480200423                      lc_ERFSwoExistFlag.
214490200423
214500200423           IF TRANS-TYPE-CODE OF TRANS = "SWO"
214510200423                MOVE "N" TO lc_SameInvStructFlag
214520200423                MOVE "ERFSWCAOVR" TO lc_FunctionCode
214530200423                MOVE "Y" TO lc_ERFSwoExistFlag
214540200423                MOVE INVESTMENT-CODE OF TRANS-REC
214550200423                     TO lc_SWOInvestmentCode
214560200423                MOVE INVESTMENT-CODE OF WS-TRANS-REC-1
214570200423                     TO lc_SWIInvestmentCode
214580200423                PERFORM GET-SAME-INV-STRUCTURE-CODE
214590200423           END-IF.
214600200423      *RFS177665 - Ends
214610200423
214620200423           MOVE PLACEMENT-DATE OF TRANS
214630200423           TO   PLACEMENT-DATE OF TRANS-REDEMPTION-DETAILS.
214640200423
214650200423           MOVE TRANS-NO       OF TRANS
214660200423           TO   TRANS-NO       OF TRANS-REDEMPTION-DETAILS.
214670200423      * RFS32409 - Start: do not update if it is Soa calculator
214680200423           IF lnc_calcSoa
214690200423      * RFS50832 - Begin
214700200423            OR lnc_calcSoaUpd
214710200423      * RFS50832 - End
214720200423             CONTINUE
214730200423           ELSE
214740200423      * RFS32409 - End
214750200423           MOVE SPACES
214760200423           TO   WAIVE-ERF      OF TRANS-REDEMPTION-DETAILS.
214770200423
214780200423      * RFS32409 - Start: do not read if it is Soa calculator
214790200423           IF lnc_calcSoa
214800200423      * RFS50832 - Begin
214810200423            OR lnc_calcSoaUpd
214820200423      * RFS50832 - End
214830200423             CONTINUE
214840200423           ELSE
214850200423      * RFS32409 - End
214860200423           READ TRANS-REDEMPTION-DETAILS
214870200423           INVALID KEY
214880200423      * rfs 24192 - start
214890200423            IF WS-NDSNRR-GENERATED = "1"          AND
214900200423               PLACEMENT-DATE OF TRANS =
214910200423               PLACEMENT-DATE OF WS-NRR-SEL-TRANS AND
214920200423               TRANS-NO       OF TRANS =
214930200423               TRANS-NO       OF WS-NRR-SEL-TRANS
214940200423               MOVE WS-NRR-TRANS-REDEM-DTLS
214950200423                 TO TRANS-REDEMPTION-DETAILS-REC
214960200423            ELSE
214970200423      * rfs 24192 - end
214980200423             MOVE "N"        TO WS-WAIVE-ERF-FLAG
214990200423      *      DISPLAY "@@@ No TRANS-REDEMPTION-DETAILS"
215000200423             GO TO PESU-0004
215010200423      * rfs 24192 - start
215020200423            END-IF
215030200423      * rfs 24192 - end
215040200423           END-READ.
215050200423
215060200423           IF WAIVE-ERF OF TRANS-REDEMPTION-DETAILS = "Y"
215070200423177665        OR lc_SameInvStructFlag = "Y"
215080200423184348        OR ENTERED-BY OF TRANS = "AUTOSW"
215090200423               MOVE "Y" TO WS-WAIVE-ERF-FLAG
215100200423           END-IF.
215110200423
215120200423       PESU-0004.
215130200423
215140200423           MOVE ZERO         TO WS-ERF-CHARGE.
215150200423      *-----------------
215160200423      * RFS 33712 Begins
215170200423      *-----------------
215180200423      *    MOVE UNIT-AMT OF TRANS
215190200423      *                      TO WS-ERF-UNITS-TO-REDEEM.
215200200423
215210200423           MOVE lnc-No  TO lc-ERF-Free-On-T.
215220200423
215230200423           MOVE INVESTMENT-CODE OF TRANS
215240200423                TO INVESTMENT-CODE OF INVESTMENT-ERF-SCHEDULE.
215250200423           PERFORM Get-ERF-Schedule-Code.
215260200423           IF lncc-Notfound
215270200423      *RFS177665 - Starts
215280200423              IF lc_SameInvStructFlag = "Y"
215290200423                 MOVE "N"   TO  lc_ERFSwoExistFlag
215300200423              END-IF
215310200423      *RFS177665 - Ends
215320200423             GO TO PESU-EXIT
215330200423           END-IF.
215340200423
215350200423           MOVE ERF-SCHEDULE-CODE OF INVESTMENT-ERF-SCHEDULE
215360200423           TO   ERF-SCHEDULE-CODE OF ERF-SCHEDULE.
215370200423           PERFORM Get-ERF-Schedule.
215380200423           IF lncc-Notfound
215390200423             GO TO PESU-EXIT
215400200423           END-IF.
215410200423
215420200423           MOVE WAIVE-FOR-CDSC-FREE OF ERF-SCHEDULE TO
215430200423                      lc-Waive-For-CDSC-Free.
215440200423
215450200423           IF  lncc-Waive-For-CDSC-Free
215460200423           AND SPLIT-OPTION-CODE OF TRANS = lnc-T
215470200423               MOVE lnc-Yes TO lc-ERF-Free-On-T
215480200423               MOVE ld-Curr-Units-Free-Hold TO WS-ERF-UNITS-TO-REDEEM
215490200423           ELSE
215500200423               MOVE UNIT-AMT OF TRANS
215510200423                             TO WS-ERF-UNITS-TO-REDEEM
215520200423           END-IF.
215530200423      *-----------------
215540200423      * RFS 33712 Ends
215550200423      *-----------------
215560200423
215570200423           MOVE ZERO         TO WS-TEP-ARRAY-CTR.
215580200423           INITIALIZE        WS-TRANS-ERF-PURCHASE-ARRAY.
215590200423      * RFS 20200 Start
215600200423           MOVE 150          TO WS-TEP-MAX.
215610200423      * RFS 20200 End
215620200423
215630200423       PESU-0005.
215640200423
215650200423           MOVE ACCOUNT-NO OF TRANS
215660200423                             TO ACCOUNT-NO OF TRANS-ERF-PURCHASE.
215670200423           MOVE INVESTMENT-CODE OF TRANS
215680200423                             TO INVESTMENT-CODE OF TRANS-ERF-PURCHASE.
215690200423           MOVE ZEROES       TO TRADE-DATE OF TRANS-ERF-PURCHASE.
215700200423
215710200423           START TRANS-ERF-PURCHASE
215720200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
215730200423           INVALID KEY
215740200423               MOVE "ERF STR" TO WS-FILE-STATUS-FILE-NAME
21575020042358714          PERFORM LOG-FILE-STATUS-RD
215760200423               GO TO PESU-EXIT
215770200423           END-START.
215780200423
215790200423       PESU-0010.
215800200423
215810200423           READ TRANS-ERF-PURCHASE NEXT RECORD
215820200423           AT END
215830200423               GO TO PESU-0012
215840200423           END-READ.
215850200423
215860200423           IF ACCOUNT-NO OF TRANS-ERF-PURCHASE IS NOT EQUAL
215870200423           ACCOUNT-NO OF TRANS   OR
215880200423           INVESTMENT-CODE OF TRANS-ERF-PURCHASE IS NOT EQUAL
215890200423           INVESTMENT-CODE OF TRANS
215900200423               GO TO PESU-0012
215910200423           END-IF.
215920200423
215930200423           IF ERF-STATUS OF TRANS-ERF-PURCHASE IS NOT EQUAL "A"
215940200423             GO TO PESU-0010
215950200423           END-IF.
215960200423
215970200423      *    Write each TRANS-ERF-LSIF to array after calculating        k codes
215980200423      *    ERF free units (for use in second pass searching
215990200423      *    for chargeable TRANS-ERF-PURCHASE records if units still
216000200423      *    required to fulfill TRANS total.
216010200423
216020200423           ADD 1 TO WS-TEP-ARRAY-CTR.
216030200423      * RFS 20200 Start
216040200423           IF WS-TEP-ARRAY-CTR = WS-TEP-MAX
216050200423             COMPUTE WS-TEP-MAX = WS-TEP-MAX + 150
216060200423           END-IF.
216070200423      * RFS 20200 End
216080200423
216090200423      *    Initialize all numeric fields within this array occurence
216100200423
216110200423           MOVE TRANS-ERF-PURCHASE-REC
216120200423           TO WS-TEP-ARRAY(WS-TEP-ARRAY-CTR).
216130200423
216140200423      * 1) Get ERF-SCHEDULE-CODE record for schedule code stored
216150200423      *    on original BUY transaction being exhausted.
216160200423      *    Yields: CALC-METHOD         (B)ook or (M)arket price)
216170200423      *            WAIVE-FOR-CDSC-FREE (Y/N)
216180200423      *            FREE-TRANSACTIONS   (D)ist (N)one (A)ll
216190200423      *            CHARGE-CODE         (S)ells only (B)oth sells/switch
216200200423      *            SWITCH-RULE         (R)etain age/schedule (N)ew
216210200423
216220200423           MOVE ERF-SCHEDULE-CODE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
216230200423           TO   ERF-SCHEDULE-CODE OF ERF-SCHEDULE.
216240200423
216250200423      *-----------------
216260200423      * RFS 33712 Begins
216270200423      *-----------------
216280200423      *    READ ERF-SCHEDULE
216290200423      *    INVALID KEY
216300200423      *      MOVE ZEROES     TO WS-ERF-CHARGE
216310200423      *      DISPLAY "@@@ No ERF schedule"
216320200423      *      GO TO PESU-EXIT
216330200423      *    END-READ.
216340200423
216350200423           PERFORM Get-ERF-Schedule.
216360200423           IF lncc-Notfound
216370200423             GO TO PESU-EXIT
216380200423           END-IF.
216390200423      *-----------------
216400200423      * RFS 33712 Ends
216410200423      *-----------------
216420200423
216430200423           MOVE ZEROES         TO
216440200423           WS-TES-FREE-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
216450200423           WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR).
216460200423
216470200423      * -- RFS33712 Begins
216480200423           MOVE Zeroes TO
216490200423                ld-Tes-Chrg-Units-Taken-Dwn-Fr(WS-TEP-ARRAY-CTR).
216500200423      * -- RFS33712 Ends
216510200423
216520200423      * Update TRANS-ERF-PURCHASE and write TRANS-ERF-SELL only
216530200423      * if ERF free units available for the TRANS-ERF-PURCHASE
216540200423      * record being evaluated.
216550200423
216560200423      * RFS 28264 - begins.
216570200423      *---------------------------------------------------------------*
216580200423      * The condition below is to waive ERF Charges for the entire
216590200423      * redemption and NOT individual ERF Purchase records. In order to
216600200423      * waive selected ERF Purchase records, the units have to be moved
216610200423      * to the Free Units column in the MFATRNEPP table AT THE TIME OF
216620200423      * PURCHASE.
216630200423      *---------------------------------------------------------------*
216640200423      * RFS 28264 - ends.
216650200423
216660200423      * RFS92475 - Start.
216670200423           IF lb_editCodeSTTFSetupYes
216680200423
216690200423              Initialize li_FXCHKERFPlacementDate
216700200423              Initialize li_FXCHKERFTransNo
216710200423              Initialize lc_FXCHKERFReturnCode
216720200423
216730200423              MOVE PLACEMENT-DATE OF TRANS
216740200423                                  TO li_FXCHKERFPlacementDate
216750200423              MOVE TRANS-NO       OF TRANS
216760200423                                  TO li_FXCHKERFTransNo
216770200423
216780200423              CALL "FXCHKERF" USING li_FXCHKERFPlacementDate
216790200423                                    li_FXCHKERFTransNo
216800200423                                    lc_FXCHKERFReturnCode
216810200423           END-IF
216820200423      * RFS92475 - End.
216830200423
216840200423           IF CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) > 0
216850200423           OR (WAIVE-FOR-CDSC-FREE OF ERF-SCHEDULE = "Y" AND
216860200423               SPLIT-OPTION-CODE OF TRANS = "F")
216870200423           OR (CHARGE-CODE       OF ERF-SCHEDULE = "S" AND
216880200423               SWITCH-OUT-TRANSACTION)
216890200423           OR (TRANS-ORIGIN-CODE OF TRANS = "MRG")
216900200423           OR (TRANS-ORIGIN-CODE OF TRANS = "FCP")
216910200423           OR (TRANS-ORIGIN-CODE OF TRANS = "FCR")
216920200423           OR (CONTR-REDEM-CODE  OF TRANS = "MRGO")
216930200423           OR (WAIVE-ERF)
216940200423           OR (TRANSFER-OUT-TRANSACTION)
216950200423           OR (NOT SWO-TRANSACTION AND NOT SELL-TRANSACTION)
216960200423      * -- RFS 33712 Begins
216970200423           OR (lncc-Waive-For-CDSC-Free
216980200423               AND SPLIT-OPTION-CODE OF TRANS = lnc-T
216990200423               AND lncc-Erf-Free-On-T)
217000200423      * -- RFS 33712 Ends
217010200423      * RFS 28264 - begins.
217020200423      * RFS24922 Start
217030200423      *    OR ERF-APPLICABLE OF TRANS-ERF-PURCHASE = "N"
217040200423      * RFS24922 End
217050200423      * RFS 28264 - ends.
217060200423      * RFS92475 - Start.
217070200423           OR (lb_editCodeSTTFSetupYes
217080200423               AND lc_FXCHKERFReturnCode NOT = lncc_00 )
217090200423      * RFS92475 - End.
217100200423
217110200423               MOVE "N" TO WS-TEP-ARRAY-CHARGE-ERF
217120200423               PERFORM CREATE-TRANS-ERF-SELL
217130200423               MOVE " " TO WS-TEP-ARRAY-CHARGE-ERF
217140200423      *RFS29134 - Begins
217150200423               MOVE ZEROS TO WS-ERF-CHARGE
217160200423      *RFS29134 - Ends
217170200423           END-IF.
217180200423
217190200423      * MASTER LOOP for gathering NON-chargeable units:
217200200423      * Determine if all required TRANS units have been exhausted
217210200423      * otherwise, loop back up to read the next TRANS-ERF-PURCHASE.
217220200423
217230200423           IF WS-ERF-UNITS-TO-REDEEM > 0
217240200423             GO TO PESU-0010
217250200423           END-IF.
217260200423      *-----------------
217270200423      * RFS 33712 Begins
217280200423      *-----------------
217290200423           COMPUTE ld-Units-Free = UNIT-AMT OF TRANS -
217300200423                                   ld-Curr-Units-Free-Hold.
217310200423           IF  WS-ERF-UNITS-TO-REDEEM = 0
217320200423           AND lncc-Waive-For-CDSC-Free
217330200423           AND SPLIT-OPTION-CODE OF TRANS = lnc-T
217340200423           AND ld-Units-Free > 0
217350200423              MOVE lnc-No TO lc-ERF-Free-On-T
217360200423              GO TO PESU-0010
217370200423           END-IF.
217380200423      *-----------------
217390200423      * RFS 33712 Ends
217400200423      *-----------------
217410200423
217420200423       PESU-0012.
217430200423
217440200423      * SECONDARY LOOP for gathering Chargeable units:
217450200423      *    If total unit amount is not satisfied yet, read above array
217460200423      *    and process only those occurences which will charge ERF
217470200423      *    as the ERF free units must have been fully exhausted to     s
217480200423      *    perform the following loop.
217490200423
217500200423      *-----------------
217510200423      * RFS 33712 Begins
217520200423      *-----------------
217530200423           COMPUTE ld-Units-Free = UNIT-AMT OF TRANS -
217540200423                                   ld-Curr-Units-Free-Hold.
217550200423           IF  WS-ERF-UNITS-TO-REDEEM = 0
217560200423           AND lncc-Waive-For-CDSC-Free
217570200423           AND SPLIT-OPTION-CODE OF TRANS = lnc-T
217580200423           AND ld-Units-Free > 0
217590200423178416     AND WS-WAIVE-ERF-FLAG NOT = "Y"
217600200423              COMPUTE WS-ERF-UNITS-TO-REDEEM = ld-Units-Free
217610200423           END-IF.
217620200423      *-----------------
217630200423      * RFS 33712 Ends
217640200423      *-----------------
217650200423
217660200423           MOVE WS-TEP-ARRAY-CTR TO WS-TEP-ARRAY-CTR-2.
217670200423
217680200423      * RFS49699 - Array logging logic
217690200423           IF WS-TEP-ARRAY-CTR  > WS-ARRAY10-MAX-USED
217700200423               MOVE WS-TEP-ARRAY-CTR       TO WS-ARRAY10-MAX-USED
217710200423           END-IF.
217720200423      * RFS49699 - End
217730200423      * Skip array loop which starts charging when exhausting if
217740200423      * all units are satisfied.
217750200423
217760200423           IF WS-ERF-UNITS-TO-REDEEM = 0
217770200423           OR REJECTION-CODE OF TRANS IS NOT EQUAL "00"
217780200423               GO TO PESU-0014
217790200423           END-IF.
217800200423
217810200423           PERFORM VARYING WS-TEP-ARRAY-CTR FROM 1 BY 1
217820200423           UNTIL WS-TEP-ARRAY-CTR > WS-TEP-ARRAY-CTR-2
217830200423           OR WS-ERF-UNITS-TO-REDEEM = 0
217840200423               MOVE "Y" TO WS-TEP-ARRAY-CHARGE-ERF
217850200423               PERFORM CREATE-TRANS-ERF-SELL
217860200423               MOVE " " TO WS-TEP-ARRAY-CHARGE-ERF
217870200423           END-PERFORM.
217880200423
217890200423      *RFS177796 - Starts
217900200423           IF WAIVE-ERF
217910200423              MOVE ZEROES TO WS-ERF-CHARGE
217920200423           END-IF.
217930200423      *RFS177796 - Ends
217940200423
217950200423      *RFS29134 - begins.
217960200423      *--------------------------------------------------------------*
217970200423      * After the total ERF charges are calculated, check it against *
217980200423      * the ERF schedule threshold amount for the current reduction  *
217990200423      * transaction that is being processed.                         *
218000200423      *--------------------------------------------------------------*
218010200423           MOVE TRANS-ORIGIN-CODE OF TRANS  TO
218020200423                WS-ERF-AWD-OR-DCA.
218030200423           MOVE INVESTMENT-CODE OF TRANS    TO
218040200423                INVESTMENT-CODE OF INVESTMENT-ERF-SCHEDULE-2.
218050200423
218060200423           READ INVESTMENT-ERF-SCHEDULE-2
218070200423             INVALID
218080200423               MOVE "N" TO WS-ERF-THRESHOLD-WAIVE-FLAG
218090200423             NOT INVALID
218100200423               MOVE ERF-SCHEDULE-CODE OF INVESTMENT-ERF-SCHEDULE-2
218110200423               TO   ERF-SCHEDULE-CODE OF ERF-SCHEDULE-2
218120200423
218130200423               READ ERF-SCHEDULE-2
218140200423                 INVALID
218150200423                   MOVE "N" TO WS-ERF-THRESHOLD-WAIVE-FLAG
218160200423                 NOT INVALID
218170200423                   IF WAIVE-THRESHOLD-AMT OF ERF-SCHEDULE-2 >=
218180200423                      WS-ERF-CHARGE
218190200423                      IF NOT ERF-AWD-OR-DCA
218200200423                         MOVE ZEROS TO WS-ERF-CHARGE
218210200423                         MOVE "Y" TO WS-ERF-THRESHOLD-WAIVE-FLAG
218220200423                      END-IF
218230200423                   END-IF
218240200423               END-READ
218250200423           END-READ.
218260200423      *RFS29134 - ends.
218270200423
218280200423
218290200423       PESU-0014.
218300200423
218310200423           PERFORM VARYING WS-TEP-ARRAY-CTR FROM 1 BY 1
218320200423           UNTIL WS-TEP-ARRAY-CTR > WS-TEP-ARRAY-CTR-2
218330200423           OR REJECTION-CODE OF TRANS IS NOT EQUAL "00"
218340200423           OR UNIT-AMT OF TRANS = 0
218350200423               IF WS-TES-RECORD-CREATED(WS-TEP-ARRAY-CTR) = "Y"
218360200423                   IF WS-TEP-UPDATE-ERF-FILES = "Y"
218370200423                       PERFORM UPDATE-ERF-FILES
218380200423                   END-IF
218390200423               END-IF
218400200423           END-PERFORM.
218410200423
218420200423      * RFS 29134 - begins.
218430200423           MOVE "N" TO WS-ERF-THRESHOLD-WAIVE-FLAG.
218440200423      * RFS 29134 - ends.
218450200423
218460200423
218470200423       PESU-EXIT.
218480200423           EXIT.
218490200423      /
218500200423      ******************************************************************
218510200423      *    C R E A T E  T R A N S  E R F  S E L L                      *
218520200423      ******************************************************************
218530200423       CREATE-TRANS-ERF-SELL SECTION.
218540200423
218550200423       CTES-0000.
218560200423
218570200423           IF WS-TES-RECORD-CREATED(WS-TEP-ARRAY-CTR) = "Y"
218580200423               GO TO CTES-0005
218590200423           END-IF.
218600200423
218610200423      * Setup array TRANS-ERF-SELL variables
218620200423
218630200423           MOVE "Y"
218640200423           TO WS-TES-RECORD-CREATED(WS-TEP-ARRAY-CTR).
218650200423
218660200423           MOVE PLACEMENT-DATE OF TRANS
218670200423           TO WS-TES-PLACEMENT-DATE(WS-TEP-ARRAY-CTR).
218680200423
218690200423           MOVE TRANS-NO OF TRANS
218700200423           TO WS-TES-TRANS-NO(WS-TEP-ARRAY-CTR).
218710200423
218720200423           ADD 1             TO WS-ERF-SELL-SEQ.
218730200423
218740200423           MOVE WS-ERF-SELL-SEQ
218750200423           TO WS-TES-ERF-SEQ-NO(WS-TEP-ARRAY-CTR).
218760200423
218770200423           MOVE SPACES
218780200423           TO WS-TES-REVERSED(WS-TEP-ARRAY-CTR).
218790200423
218800200423           MOVE ZEROES
218810200423           TO WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR).
218820200423
218830200423           MOVE AGE-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
218840200423           TO WS-TES-AGE-DATE(WS-TEP-ARRAY-CTR).
218850200423
218860200423           MOVE "A"
218870200423           TO   WS-TES-ERF-STATUS(WS-TEP-ARRAY-CTR).
218880200423
218890200423           MOVE ERF-SCHEDULE-CODE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
218900200423           TO   WS-TES-ERF-SCHEDULE-CODE(WS-TEP-ARRAY-CTR).
218910200423
218920200423           MOVE UNIT-PRICE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
218930200423           TO   WS-TES-UNIT-PRICE(WS-TEP-ARRAY-CTR).
218940200423
218950200423       CTES-0005.
218960200423
218970200423      * Subtract for CURR-UNITS-FREE first if free units available.
218980200423
218990200423           IF CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219000200423               GO TO CTES-0010
219010200423           END-IF.
219020200423
219030200423           IF CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219040200423           IS LESS THAN WS-ERF-UNITS-TO-REDEEM
219050200423             MOVE CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219060200423             TO WS-TES-FREE-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
219070200423             SUBTRACT CURR-UNITS-FREE
219080200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219090200423             FROM WS-ERF-UNITS-TO-REDEEM
219100200423             SUBTRACT CURR-UNITS-FREE
219110200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219120200423             FROM CURR-UNIT-BAL
219130200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219140200423             MOVE ZERO
219150200423             TO CURR-UNITS-FREE
219160200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219170200423             MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219180200423             TO WS-TES-PLACEMENT-DATE-2(WS-TEP-ARRAY-CTR)
219190200423             MOVE TRANS-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219200200423             TO WS-TES-TRANS-NO-2(WS-TEP-ARRAY-CTR)
219210200423             MOVE ERF-SEQ-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219220200423             TO WS-TES-ERF-SEQ-NO-2(WS-TEP-ARRAY-CTR)
219230200423             IF  CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219240200423             AND CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219250200423               MOVE "C"
219260200423               TO ERF-STATUS OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219270200423             END-IF
219280200423             GO TO CTES-EXIT
219290200423           ELSE
219300200423             MOVE WS-ERF-UNITS-TO-REDEEM
219310200423             TO WS-TES-FREE-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
219320200423             SUBTRACT WS-ERF-UNITS-TO-REDEEM
219330200423             FROM CURR-UNITS-FREE
219340200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219350200423             SUBTRACT WS-ERF-UNITS-TO-REDEEM
219360200423             FROM CURR-UNIT-BAL
219370200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219380200423             MOVE ZEROES     TO WS-ERF-UNITS-TO-REDEEM
219390200423             MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219400200423             TO WS-TES-PLACEMENT-DATE-2(WS-TEP-ARRAY-CTR)
219410200423             MOVE TRANS-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219420200423             TO WS-TES-TRANS-NO-2(WS-TEP-ARRAY-CTR)
219430200423             MOVE ERF-SEQ-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219440200423             TO WS-TES-ERF-SEQ-NO-2(WS-TEP-ARRAY-CTR)
219450200423             IF  CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219460200423             AND CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219470200423               MOVE "C"
219480200423               TO ERF-STATUS OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219490200423             END-IF
219500200423             GO TO CTES-EXIT
219510200423           END-IF.
219520200423
219530200423       CTES-0010.
219540200423
219550200423           IF CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219560200423           IS LESS THAN WS-ERF-UNITS-TO-REDEEM
219570200423
219580200423             COMPUTE WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) =
219590200423                     WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
219600200423                   + CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219610200423
219620200423      *-- RFS33712 Begins
219630200423           IF (lncc-Waive-For-CDSC-Free
219640200423              AND SPLIT-OPTION-CODE OF TRANS = lnc-T
219650200423              AND WS-TEP-ARRAY-CHARGE-ERF = "N")
219660200423              MOVE CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219670200423                TO ld-Tes-Chrg-Units-Taken-Dwn-Fr(WS-TEP-ARRAY-CTR)
219680200423           END-IF
219690200423      *-- RFS33712 Ends
219700200423
219710200423             SUBTRACT CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219720200423             FROM WS-ERF-UNITS-TO-REDEEM
219730200423
219740200423             SUBTRACT CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219750200423             FROM CURR-UNIT-BAL OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219760200423
219770200423             MOVE ZERO
219780200423             TO CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219790200423
219800200423             MOVE "C"
219810200423             TO ERF-STATUS OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219820200423             MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219830200423             TO WS-TES-PLACEMENT-DATE-2(WS-TEP-ARRAY-CTR)
219840200423             MOVE TRANS-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219850200423             TO WS-TES-TRANS-NO-2(WS-TEP-ARRAY-CTR)
219860200423             MOVE ERF-SEQ-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219870200423             TO WS-TES-ERF-SEQ-NO-2(WS-TEP-ARRAY-CTR)
219880200423             IF  CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219890200423             AND CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
219900200423               MOVE "C"
219910200423               TO ERF-STATUS OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
219920200423             END-IF
219930200423           ELSE
219940200423             COMPUTE WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) =
219950200423                     WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
219960200423                   + WS-ERF-UNITS-TO-REDEEM
219970200423
219980200423      *-- RFS33712 Begins
219990200423           IF (lncc-Waive-For-CDSC-Free
220000200423              AND SPLIT-OPTION-CODE OF TRANS = lnc-T
220010200423              AND WS-TEP-ARRAY-CHARGE-ERF = "N")
220020200423              MOVE WS-ERF-UNITS-TO-REDEEM
220030200423                TO ld-Tes-Chrg-Units-Taken-Dwn-Fr(WS-TEP-ARRAY-CTR)
220040200423           END-IF
220050200423      *-- RFS33712 Ends
220060200423
220070200423             SUBTRACT WS-ERF-UNITS-TO-REDEEM
220080200423             FROM CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220090200423                  CURR-UNIT-BAL   OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220100200423
220110200423             MOVE ZEROES     TO WS-ERF-UNITS-TO-REDEEM
220120200423
220130200423             MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220140200423             TO WS-TES-PLACEMENT-DATE-2(WS-TEP-ARRAY-CTR)
220150200423             MOVE TRANS-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220160200423             TO WS-TES-TRANS-NO-2(WS-TEP-ARRAY-CTR)
220170200423             MOVE ERF-SEQ-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220180200423             TO WS-TES-ERF-SEQ-NO-2(WS-TEP-ARRAY-CTR)
220190200423
220200200423             IF  CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
220210200423             AND CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
220220200423               MOVE "C"
220230200423               TO ERF-STATUS OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220240200423             END-IF
220250200423
220260200423           END-IF.
220270200423
220280200423       CTES-0020.
220290200423      **************************************************************
220300200423      * ERF charges
220310200423      **************************************************************
220320200423
220330200423      * Get out if not in charge mode
220340200423
220350200423      * RFS71427 Begins
220360200423           IF lb_editCodeSTTFSetupYes
220370200423      * RFS92475 - Start.
220380200423           AND Only-report-ERF of ERF-SCHEDULE = lncc_Y
220390200423      * RFS92475 - End.
220400200423               MOVE "N"  TO  WS-TEP-ARRAY-CHARGE-ERF
220410200423           END-IF.
220420200423      * RFS71427 Ends
220430200423
220440200423           IF WS-TEP-ARRAY-CHARGE-ERF = "N"
220450200423               GO TO CTES-EXIT
220460200423           END-IF.
220470200423
220480200423
220490200423      * RFS 26847 Begin
220500200423      *Get the original BUY transaction being exhausted from (TRANS)
220510200423
220520200423      *    IF PLACEMENT-DATE-2 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = 0
220530200423      *      MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220540200423      *                      TO PLACEMENT-DATE OF TRANS-PRIMARY
220550200423      *      MOVE TRANS-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220560200423      *                      TO TRANS-NO OF TRANS-PRIMARY
220570200423      *    ELSE
220580200423      *      MOVE PLACEMENT-DATE-2 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220590200423      *                      TO PLACEMENT-DATE OF TRANS-PRIMARY
220600200423      *      MOVE TRANS-NO-2 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
220610200423      *                      TO TRANS-NO OF TRANS-PRIMARY
220620200423      *    END-IF.
220630200423
220640200423      *    READ TRANS-PRIMARY WITH NO LOCK
220650200423      *    INVALID KEY
220660200423      *      DISPLAY "@@@ Original buy is missing"
220670200423      *      GO TO CTES-EXIT
220680200423      *    END-READ.
220690200423      * RFS 26847 End
220700200423
220710200423      * Get ERF rate and calculate charges
220720200423
220730200423      * RFS 28264 - begins.
220740200423      *---------------------------------------------------------------*
220750200423      * If anything, for the 2 condition coded below, the ERF Schedule
220760200423      * table values should be based on the ERF Schedule Code stored in
220770200423      * the array, and not based on the last array entry stored during
220780200423      * the load of the array in the first pass (PESU-0010).
220790200423      *---------------------------------------------------------------*
220800200423           MOVE Erf-Schedule-Code of Ws-Tep-Array(Ws-Tep-Array-Ctr)
220810200423           TO   Erf-Schedule-Code of Erf-Schedule.
220820200423
220830200423           READ Erf-Schedule
220840200423             INVALID KEY
220850200423               INITIALIZE Mfaerfscp of Erf-Schedule-Rec
220860200423             NOT INVALID KEY
220870200423               CONTINUE
220880200423           END-READ.
220890200423      * RFS 28264 - ends.
220900200423
220910200423           IF WAIVE-FOR-CDSC-FREE OF ERF-SCHEDULE = "Y"
220920200423           AND SPLIT-OPTION-CODE OF TRANS = "F"
220930200423               GO TO PESU-EXIT
220940200423           END-IF.
220950200423
220960200423           IF CALC-METHOD OF ERF-SCHEDULE = "B"
220970200423      * RFS 26847 Begin
220980200423      *        MOVE UNIT-PRICE OF TRANS-PRIMARY TO WS-ERF-PRICE
220990200423               MOVE WS-TES-UNIT-PRICE(WS-TEP-ARRAY-CTR)
221000200423                                                TO WS-ERF-PRICE
221010200423      * RFS 26847 End
221020200423           ELSE
221030200423               MOVE UNIT-PRICE OF TRANS         TO WS-ERF-PRICE
221040200423           END-IF.
221050200423
221060200423
221070200423      * 2) CALCULATE AGE OF REDEMPTION
221080200423
221090200423           INITIALIZE DR-G2J-PARMS.
221100200423           MOVE TRADE-DATE OF TRANS    TO  DGP-GREGORIAN.
221110200423           CALL    "DRG2J"          USING  DR-G2J-PARMS.
221120200423           CANCEL  "DRG2J".
221130200423           MOVE DGP-JULIAN             TO WS-JULIAN-TRADE-DATE.
221140200423
221150200423           INITIALIZE DR-G2J-PARMS.
221160200423           MOVE AGE-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
221170200423           TO DGP-GREGORIAN.
221180200423           CALL    "DRG2J"          USING  DR-G2J-PARMS.
221190200423           CANCEL  "DRG2J".
221200200423           MOVE DGP-JULIAN             TO WS-JULIAN-AGE-DATE.
221210200423
221220200423           COMPUTE WS-ERF-AGE-DIFFERENCE =
221230200423           WS-JULIAN-TRADE-DATE - WS-JULIAN-AGE-DATE.
221240200423
221250200423      * 3) GET FILE EARLY-REDEMPTION-FEE-SCHEDULE
221260200423      *    KEY = ERF-SCHEDULE-CODE  FOUND ON TEP
221270200423      *    YIELDS = DAYS-IN-RANGE (DAYS OLD)
221280200423      *             UPPER-LIMIT  ($$$)
221290200423      *             SELECT-VALUE (P/F)
221300200423      *             PERCENT-AMT
221310200423      *             FLAT-AMOUNT
221320200423      *
221330200423           MOVE ERF-SCHEDULE-CODE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
221340200423           TO   ERF-SCHEDULE-CODE OF EARLY-REDEMPTION-FEE-SCHEDULE.
221350200423
221360200423           MOVE WS-ERF-AGE-DIFFERENCE
221370200423           TO   DAYS-IN-RANGE     OF EARLY-REDEMPTION-FEE-SCHEDULE.
221380200423
221390200423      *-- RFS33712 Begins
221400200423      *    COMPUTE WS-ERF-DOLLARS-REDUCED =
221410200423      *    WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) *
221420200423      *    UNIT-PRICE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR).
221430200423      *-- RFS33712 Ends
221440200423      * RFS92475 - Start.
221450200423      *RFS 23088 Begin (FIX #1 - Ensure UPPER limit is based on gross)
221460200423      *    MOVE WS-ERF-DOLLARS-REDUCED
221470200423R92475*    MOVE GROSS-AMT OF TRANS
221480200423      *RFS 23088 End
221490200423R92475*    TO UPPER-LIMIT OF EARLY-REDEMPTION-FEE-SCHEDULE.
221500200423
221510200423           IF lb_editCodeSTTFSetupYes
221520200423              MOVE 1
221530200423              TO UPPER-LIMIT OF EARLY-REDEMPTION-FEE-SCHEDULE
221540200423           ELSE
221550200423              MOVE GROSS-AMT OF TRANS
221560200423              TO UPPER-LIMIT OF EARLY-REDEMPTION-FEE-SCHEDULE
221570200423           END-IF
221580200423      * RFS92475 - End.
221590200423
221600200423           START EARLY-REDEMPTION-FEE-SCHEDULE
221610200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
221620200423           INVALID KEY
221630200423               MOVE "ERF FEE S" TO WS-FILE-STATUS-FILE-NAME
22164020042358714          PERFORM LOG-FILE-STATUS-RD
221650200423               GO TO CTES-EXIT
221660200423           END-START.
221670200423
221680200423      *RFS 23088 Begin (FIX #2 - Ensure correct penalty record read)
221690200423       CTES-0030.
221700200423      *RFS 23088 End
221710200423
221720200423           READ EARLY-REDEMPTION-FEE-SCHEDULE NEXT RECORD
221730200423           AT END
221740200423      *RFS 23088 Being (FIX #2 - Ensure correct penalty record read)
221750200423             DISPLAY "@@@ No rate on EARLY-REDEMPTION-FEE-SCHEDULE"
221760200423             MOVE ZEROES TO WS-ERF-CHARGE
221770200423      *RFS 23088 End
221780200423             GO TO CTES-EXIT
221790200423           END-READ.
221800200423
221810200423      * RFS 92475 - begins.
221820200423           IF lb_editCodeSTTFSetupYes
221830200423              IF ERF-SCHEDULE-CODE OF EARLY-REDEMPTION-FEE-SCHEDULE
221840200423                 IS NOT EQUAL ERF-SCHEDULE-CODE
221850200423                 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) OR
221860200423                 DAYS-IN-RANGE OF EARLY-REDEMPTION-FEE-SCHEDULE
221870200423                 IS LESS THAN  WS-ERF-AGE-DIFFERENCE
221880200423
221890200423                   GO TO CTES-0030
221900200423              END-IF
221910200423           END-IF.
221920200423      * RFS 92475 - ends.
221930200423
221940200423      * RFS 92475 - begins.
22195020042392475      IF lb_editCodeSTTFSetupNo
221960200423             IF ERF-SCHEDULE-CODE OF EARLY-REDEMPTION-FEE-SCHEDULE
221970200423             IS NOT EQUAL ERF-SCHEDULE-CODE
221980200423             OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) OR
221990200423             DAYS-IN-RANGE OF EARLY-REDEMPTION-FEE-SCHEDULE IS LESS THAN
222000200423             WS-ERF-AGE-DIFFERENCE            OR
222010200423             UPPER-LIMIT   OF EARLY-REDEMPTION-FEE-SCHEDULE IS LESS THAN
222020200423      *RFS 23088 Begin (FIX #1 - Use GROSS-AMT instead of units reduced
222030200423      *    WS-ERF-DOLLARS-REDUCED
222040200423             GROSS-AMT OF TRANS
222050200423      *RFS 23088 End
222060200423
222070200423      *RFS 23088 Begin (FIX #2 - Ensure correct penalty record read)
222080200423               GO TO CTES-0030
222090200423      *        DISPLAY "@@@ No rate on EARLY-REDEMPTION-FEE-SCHEDULE"
222100200423      *        MOVE ZEROES TO WS-ERF-CHARGE
222110200423      *        GO TO CTES-EXIT
222120200423      *RFS 23088 End
22213020042392475        END-IF
222140200423           END-IF.
222150200423      * RFS 92475 - ends.
222160200423
222170200423      * 4) CALCULATE CHARGE
222180200423
222190200423           IF SELECT-VALUE OF EARLY-REDEMPTION-FEE-SCHEDULE = "%"
222200200423               IF PERCENT-AMT OF EARLY-REDEMPTION-FEE-SCHEDULE = 0
222210200423                 MOVE 0 TO WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
222220200423               ELSE
222230200423      *-- RFS33712 Begins
222240200423      *          COMPUTE WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR) ROUNDED =
222250200423      *          ((WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) *
222260200423      *          WS-ERF-PRICE) *
222270200423      *          (PERCENT-AMT OF EARLY-REDEMPTION-FEE-SCHEDULE / 100))
222280200423
222290200423                 COMPUTE WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR) ROUNDED =
222300200423                 (((WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) -
222310200423                    ld-Tes-Chrg-Units-Taken-Dwn-Fr(WS-TEP-ARRAY-CTR)) *
222320200423                 WS-ERF-PRICE) *
222330200423                 (PERCENT-AMT OF EARLY-REDEMPTION-FEE-SCHEDULE / 100))
222340200423      *-- RFS33712 Ends
222350200423               END-IF
222360200423           ELSE
222370200423      *RFS1006147-Starts
222380200423      *        MOVE FLAT-AMOUNT OF EARLY-REDEMPTION-FEE-SCHEDULE
222390200423      *          TO WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
222400200423           IF ( WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR) -
222410200423                ld-Tes-Chrg-Units-Taken-Dwn-Fr(WS-TEP-ARRAY-CTR))  > 0
222420200423           AND  ERF-APPLICABLE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR) = "Y"
222430200423                MOVE FLAT-AMOUNT OF EARLY-REDEMPTION-FEE-SCHEDULE
222440200423                  TO WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
222450200423           ELSE
222460200423                INITIALIZE WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
222470200423           END-IF
222480200423      *RFS1006147-Ends
222490200423           END-IF.
222500200423
222510200423           COMPUTE WS-ERF-CHARGE = WS-ERF-CHARGE +
222520200423           WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR).
222530200423
222540200423       CTES-EXIT.
222550200423           EXIT.
222560200423      /
222570200423      ******************************************************************
222580200423      *    U P D A T E  E R F  F I L E S                               *
222590200423      ******************************************************************
222600200423       UPDATE-ERF-FILES SECTION.
222610200423
222620200423       UEF-0000.
222630200423
222640200423      * RFS92475 - Start.
222650200423      *    IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
222660200423      *    AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
222670200423           IF lc_CalcMode  IS NOT EQUAL lncc_Y  AND
222680200423103575        NOT lnc_calcSoa  AND NOT lnc_calcSoaUpd  AND
222690200423              WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
222700200423      * RFS92475 - End.
222710200423
222720200423               MOVE PLACEMENT-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222730200423                             TO PLACEMENT-DATE
222740200423                             OF TRANS-ERF-PURCHASE-PRIMARY
222750200423               MOVE TRANS-NO     OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222760200423                             TO TRANS-NO
222770200423                             OF TRANS-ERF-PURCHASE-PRIMARY
222780200423               MOVE ERF-SEQ-NO  OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222790200423                             TO ERF-SEQ-NO
222800200423                             OF TRANS-ERF-PURCHASE-PRIMARY
222810200423
222820200423               READ TRANS-ERF-PURCHASE-PRIMARY WITH NO LOCK
222830200423               INVALID KEY
222840200423                   MOVE "ERF BUY" TO WS-FILE-STATUS-FILE-NAME
22285020042358714              PERFORM LOG-FILE-STATUS-RD
222860200423                   GO TO UEF-EXIT
222870200423               END-READ
222880200423
222890200423               MOVE CURR-UNIT-BAL  OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222900200423               TO CURR-UNIT-BAL    OF TRANS-ERF-PURCHASE-PRI-REC
222910200423
222920200423               MOVE CURR-UNITS-FREE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222930200423               TO CURR-UNITS-FREE   OF TRANS-ERF-PURCHASE-PRI-REC
222940200423
222950200423               MOVE CURR-UNITS-CHRG OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222960200423               TO CURR-UNITS-CHRG   OF TRANS-ERF-PURCHASE-PRI-REC
222970200423
222980200423               MOVE ERF-STATUS     OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
222990200423               TO ERF-STATUS       OF TRANS-ERF-PURCHASE-PRI-REC
223000200423
223010200423      *        MOVE PLACEMENT-DATE-2
223020200423      *        OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223030200423      *        TO PLACEMENT-DATE-2 OF TRANS-ERF-PURCHASE-PRI-REC
223040200423      *
223050200423      *        MOVE TRANS-NO-2 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223060200423      *        TO TRANS-NO-2       OF TRANS-ERF-PURCHASE-PRI-REC
223070200423      *
223080200423      *        MOVE ERF-SEQ-NO-2 OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223090200423      *        TO ERF-SEQ-NO-2    OF TRANS-ERF-PURCHASE-PRI-REC
223100200423      *
223110200423      *        MOVE AGE-DATE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223120200423      *        TO AGE-DATE         OF TRANS-ERF-PURCHASE-PRI-REC
223130200423      *
223140200423      *        MOVE ACCOUNT-NO OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223150200423      *        TO ACCOUNT-NO       OF TRANS-ERF-PURCHASE-PRI-REC
223160200423      *
223170200423      *        MOVE INVESTMENT-CODE OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223180200423      *        TO INVESTMENT-CODE  OF TRANS-ERF-PURCHASE-PRI-REC
223190200423      *
223200200423      *        MOVE ORIG-UNIT-BAL  OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223210200423      *        TO ORIG-UNIT-BAL    OF TRANS-ERF-PURCHASE-PRI-REC
223220200423      *
223230200423      *
223240200423      *        MOVE AGE-DATE
223250200423      *        OF WS-TEP-ARRAY(WS-TEP-ARRAY-CTR)
223260200423      *        TO AGE-DATE         OF TRANS-ERF-PURCHASE-PRI-REC
223270200423
223280200423               REWRITE TRANS-ERF-PURCHASE-PRI-REC
223290200423               INVALID KEY
223300200423                   MOVE "ERF BUY U"  TO WS-FILE-STATUS-FILE-NAME
22331020042358714              SET lncc_Err126  TO  TRUE
223320200423                   PERFORM LOG-FILE-STATUS
223330200423                   GO TO UEF-EXIT
223340200423               END-REWRITE
22335020042358714          IF WS-FILE-STATUS IS NOT EQUAL TO "00"
22336020042358714             MOVE "MFATRNEPP" TO WS-FILE-STATUS-FILE-NAME
22337020042358714             SET lncc_Err127  TO  TRUE
22338020042358714             PERFORM LOG-FILE-STATUS
22339020042358714          END-IF
223400200423
223410200423           END-IF.
223420200423
223430200423      * RFS92475 - Start.
223440200423      *    IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
223450200423      *    AND WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
223460200423102122     IF lc_CalcMode  IS NOT EQUAL lncc_Y  AND
223470200423103575        NOT lnc_calcSoa  AND NOT lnc_calcSoaUpd  AND
223480200423102122         WS-PASS-SWITCH-EDIT IS NOT EQUAL "1"
223490200423      * RFS92475 - End.
223500200423               INITIALIZE MFATRNERP OF TRANS-ERF-SELL
223510200423
223520200423               MOVE WS-TES-PLACEMENT-DATE(WS-TEP-ARRAY-CTR)
223530200423               TO PLACEMENT-DATE OF TRANS-ERF-SELL
223540200423
223550200423               MOVE WS-TES-TRANS-NO(WS-TEP-ARRAY-CTR)
223560200423               TO TRANS-NO       OF TRANS-ERF-SELL
223570200423
223580200423               MOVE WS-TES-ERF-SEQ-NO(WS-TEP-ARRAY-CTR)
223590200423               TO ERF-SEQ-NO    OF TRANS-ERF-SELL
223600200423
223610200423               MOVE WS-TES-PLACEMENT-DATE-2(WS-TEP-ARRAY-CTR)
223620200423               TO PLACEMENT-DATE-2 OF TRANS-ERF-SELL
223630200423
223640200423               MOVE WS-TES-TRANS-NO-2(WS-TEP-ARRAY-CTR)
223650200423               TO TRANS-NO-2 OF TRANS-ERF-SELL
223660200423
223670200423               MOVE WS-TES-ERF-SEQ-NO-2(WS-TEP-ARRAY-CTR)
223680200423               TO ERF-SEQ-NO-2 OF TRANS-ERF-SELL
223690200423
223700200423               MOVE WS-TES-ERF-STATUS(WS-TEP-ARRAY-CTR)
223710200423               TO ERF-STATUS OF TRANS-ERF-SELL
223720200423
223730200423               MOVE WS-TES-FREE-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
223740200423               TO FREE-UNITS-TAKEN-DOWN OF TRANS-ERF-SELL
223750200423
223760200423               MOVE WS-TES-CHRG-UNITS-TAKEN-DOWN(WS-TEP-ARRAY-CTR)
223770200423               TO CHRG-UNITS-TAKEN-DOWN OF TRANS-ERF-SELL
223780200423
223790200423      * RFS 29134 - begins.
223800200423      *        MOVE WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
223810200423      *        TO ERF-CHARGED OF TRANS-ERF-SELL
223820200423
223830200423               IF WS-ERF-THRESHOLD-WAIVE-FLAG = "Y"
223840200423                  MOVE ZEROS TO ERF-CHARGED OF TRANS-ERF-SELL
223850200423               ELSE
223860200423                  MOVE WS-TES-ERF-CHARGED(WS-TEP-ARRAY-CTR)
223870200423                  TO ERF-CHARGED OF TRANS-ERF-SELL
223880200423               END-IF
223890200423      * RFS 29134 - begins.
223900200423
223910200423               MOVE WS-TES-AGE-DATE(WS-TEP-ARRAY-CTR)
223920200423               TO AGE-DATE OF TRANS-ERF-SELL
223930200423
223940200423               MOVE WS-TES-ERF-SCHEDULE-CODE(WS-TEP-ARRAY-CTR)
223950200423               TO ERF-SCHEDULE-CODE OF TRANS-ERF-SELL
223960200423
223970200423               MOVE WS-TES-UNIT-PRICE(WS-TEP-ARRAY-CTR)
223980200423               TO UNIT-PRICE OF TRANS-ERF-SELL
223990200423
224000200423               WRITE TRANS-ERF-SELL-REC
224010200423               INVALID KEY
224020200423                   MOVE "ERF SELL W" TO WS-FILE-STATUS-FILE-NAME
22403020042358714              SET lncc_Err128  TO  TRUE
224040200423                   PERFORM LOG-FILE-STATUS
224050200423                   GO TO UEF-EXIT
224060200423               END-WRITE
22407020042358714          IF WS-FILE-STATUS IS NOT EQUAL TO "00"
22408020042358714             MOVE "MFATRNERP" TO WS-FILE-STATUS-FILE-NAME
22409020042358714             SET lncc_Err129  TO  TRUE
22410020042358714             PERFORM LOG-FILE-STATUS
22411020042358714          END-IF
224120200423
224130200423           END-IF.
224140200423
224150200423       UEF-EXIT.
224160200423            EXIT.
224170200423      *RFS 14380 End
224180200423      /
224190200423      *RFS 18486 Begin
224200200423      ******************************************************************
224210200423      *    C H E C K  I F  T R A N S  B U Y  L S I F  E X I S T S      *
224220200423      ******************************************************************
224230200423       CHECK-IF-TRANS-BUY-LSIF-EXISTS SECTION.
224240200423       CTBL-0000.
224250200423
224260200423           INITIALIZE MFATBLP OF TRANS-BUY-LSIF2.
224270200423
224280200423           MOVE PLACEMENT-DATE OF TRANS
224290200423                             TO PLACEMENT-DATE
224300200423                             OF TRANS-BUY-LSIF2.
224310200423           MOVE TRANS-NO OF TRANS
224320200423                             TO TRANS-NO OF TRANS-BUY-LSIF2.
224330200423
224340200423           MOVE 1            TO LSIF-SEQ-NO OF TRANS-BUY-LSIF2.
224350200423
224360200423
224370200423           READ TRANS-BUY-LSIF2
224380200423           INVALID KEY
224390200423               MOVE "TBL2 READ"  TO WS-FILE-STATUS-FILE-NAME
22440020042358714          PERFORM LOG-FILE-STATUS-RD
224410200423               GO TO CTBL-EXIT
224420200423           END-READ.
224430200423
224440200423           MOVE "Y" TO WS-TBL-ALREADY-EXISTS.
224450200423
224460200423           MOVE PLACEMENT-DATE-2 OF TRANS-BUY-LSIF2
224470200423           TO   PLACEMENT-DATE-2 OF TRANS-BUY-LSIF-PRIMARY.
224480200423
224490200423           MOVE TRANS-NO-2       OF TRANS-BUY-LSIF2
224500200423           TO   TRANS-NO-2       OF TRANS-BUY-LSIF-PRIMARY.
224510200423
224520200423           MOVE LSIF-SEQ-NO-2    OF TRANS-BUY-LSIF2
224530200423           TO   LSIF-SEQ-NO-2    OF TRANS-BUY-LSIF-PRIMARY.
224540200423
224550200423           IF COUNTRY-CODE OF TRANS-BUY-LSIF2 = SPACES
22456020042380658 *        MOVE COUNTRY-CODE  OF INVESTOR
22457020042380658          MOVE Lc_TaxCountryCode
224580200423               TO COUNTRY-CODE    OF TRANS-BUY-LSIF-PRIMARY
224590200423           ELSE
224600200423               MOVE COUNTRY-CODE  OF TRANS-BUY-LSIF2
224610200423               TO   COUNTRY-CODE  OF TRANS-BUY-LSIF-PRIMARY
224620200423           END-IF.
224630200423
224640200423           IF PROVINCE-CODE OF TRANS-BUY-LSIF2 = SPACES
224650200423               MOVE PROVINCE-CODE OF INVESTOR
224660200423               TO PROVINCE-CODE   OF TRANS-BUY-LSIF-PRIMARY
224670200423           ELSE
224680200423               MOVE PROVINCE-CODE OF TRANS-BUY-LSIF2
224690200423               TO PROVINCE-CODE   OF TRANS-BUY-LSIF-PRIMARY
224700200423           END-IF.
224710200423
224720200423       CTBL-EXIT.
224730200423           EXIT.
224740200423      *RFS 18486 End
224750200423      /
224760200423140269* Move LSIF routines to copy book to free up line space on TRNPST
224770200423140269     COPY CPYTPLSIF.
224780200423      /
224790200423      ******************************************************************
224800200423      *    E V A L  N O N  C H A R G E  C L A W B A C K  C O D E       *
224810200423      ******************************************************************
224820200423       EVAL-NON-CHARGE-CLAWBACK-CODE SECTION.
224830200423
224840200423       ENCC-0000.
224850200423
224860200423      * Set country code
224870200423
224880200423           MOVE COUNTRY-CODE OF TRANS-BUY-LSIF
224890200423                             TO COUNTRY-CODE
224900200423                             OF LSIF-CLAWBACK-CODES-DFT.
224910200423
224920200423      * Set Province Code
224930200423
224940200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
224950200423               MOVE "FED"    TO PROVINCE-CODE
224960200423                             OF LSIF-CLAWBACK-CODES-DFT
224970200423           ELSE
224980200423               MOVE PROVINCE-CODE OF TRANS-BUY-LSIF
224990200423                             TO PROVINCE-CODE
225000200423                             OF LSIF-CLAWBACK-CODES-DFT
225010200423           END-IF.
225020200423
225030200423      * Set LSIF Default Code
225040200423
225050200423           MOVE "N" TO LSIF-DEFAULT-CODE OF LSIF-CLAWBACK-CODES-DFT.
225060200423
225070200423      * Set end Date
225080200423
22509020042318705 *    MOVE TRADE-DATE OF TRANS-BUY-LSIF
22510020042318705      MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF
225110200423           TO END-DATE   OF LSIF-CLAWBACK-CODES-DFT.
225120200423
225130200423           START LSIF-CLAWBACK-CODES-DFT
225140200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
225150200423             INVALID KEY
225160200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
225170200423               DISPLAY "@@@9 No default N record for prv/trade date"
225180200423               MOVE "L3" TO REJECTION-CODE OF TRANS
225190200423               MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
225200200423                            WS-LSIF-WAIVE-CLAWBACK-PROV
225210200423               GO TO ENCC-EXIT
225220200423           END-START.
225230200423
225240200423       ENCC-0100.
225250200423
225260200423           READ LSIF-CLAWBACK-CODES-DFT NEXT RECORD
225270200423             AT END
225280200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
225290200423               DISPLAY "@@@10 No default N record for prv/trade date"
225300200423               MOVE "L3" TO REJECTION-CODE OF TRANS
225310200423               MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
225320200423                            WS-LSIF-WAIVE-CLAWBACK-PROV
225330200423               GO TO ENCC-EXIT
225340200423           END-READ.
225350200423
225360200423           IF (COUNTRY-CODE OF LSIF-CLAWBACK-CODES-DFT
225370200423             IS NOT EQUAL COUNTRY-CODE OF TRANS-BUY-LSIF)
225380200423           OR
225390200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "F") AND
225400200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES-DFT
225410200423              IS NOT EQUAL "FED"))
225420200423           OR
225430200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "P") AND
225440200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES-DFT
225450200423             IS NOT EQUAL PROVINCE-CODE OF TRANS-BUY-LSIF))
225460200423           OR
22547020042318705 *      (TRADE-DATE OF TRANS-BUY-LSIF >
22548020042318705        (CONTRIBUTION-DATE OF TRANS-BUY-LSIF >
225490200423               END-DATE   OF LSIF-CLAWBACK-CODES-DFT)
225500200423           OR
22551020042318705 *      (TRADE-DATE OF TRANS-BUY-LSIF <
22552020042318705        (CONTRIBUTION-DATE OF TRANS-BUY-LSIF <
225530200423               START-DATE OF LSIF-CLAWBACK-CODES-DFT)
225540200423           OR
225550200423             (LSIF-DEFAULT-CODE OF LSIF-CLAWBACK-CODES-DFT
225560200423              IS NOT EQUAL "N")
225570200423             GO TO ENCC-0100
225580200423           END-IF.
225590200423
225600200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
225610200423               MOVE LSIF-WAIVE-CLAWBACK-CODE
225620200423               OF LSIF-CLAWBACK-CODES-DFT
225630200423               TO WS-LSIF-WAIVE-CLAWBACK-FED
225640200423           ELSE
225650200423               MOVE LSIF-WAIVE-CLAWBACK-CODE
225660200423               OF LSIF-CLAWBACK-CODES-DFT
225670200423               TO WS-LSIF-WAIVE-CLAWBACK-PROV
225680200423           END-IF.
225690200423
225700200423      * Validate if code on LSIF Clawback code table
225710200423
225720200423           PERFORM VALIDATE-LSIF-CODE.
225730200423
225740200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
225750200423             IF WS-FEDERAL-FAIL = "Y"
225760200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
225770200423               DISPLAY "@@@11 Failed in FED VALIDATE-LSIF-CODE"
225780200423               MOVE "L3" TO REJECTION-CODE OF TRANS
225790200423               MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
225800200423               GO TO ENCC-EXIT
225810200423             END-IF
225820200423           ELSE
225830200423             IF WS-PROVINCIAL-FAIL = "Y"
225840200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
225850200423               DISPLAY "@@@12 Failed in PRV VALIDATE-LSIF-CODE"
225860200423               MOVE "L3" TO REJECTION-CODE OF TRANS
225870200423               MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-PROV
225880200423               GO TO ENCC-EXIT
225890200423             END-IF
225900200423           END-IF.
225910200423
225920200423     ** CHECK HOLDING PERIOD
225930200423
225940200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
225950200423               IF WS-LSIF-YEARS
225960200423                < HOLDING-PERIOD OF LSIF-CLAWBACK-CODES-DFT
225970200423                AND WS-LSIF-WAIVE-CLAWBACK-FED IS NOT EQUAL "D"
225980200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
225990200423                   DISPLAY "@@@13 Failed FED holding period phase3"
226000200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
226010200423                   MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
226020200423                                WS-LSIF-WAIVE-CLAWBACK-PROV
226030200423                   GO TO ENCC-EXIT
226040200423               END-IF
226050200423           END-IF.
226060200423
226070200423      * RFS 26905 - begins.
226080200423      *    IF WS-FEDERAL-PROVINCIAL-MODE = "P"
226090200423      *        IF WS-LSIF-YEARS
226100200423      *         < HOLDING-PERIOD OF LSIF-CLAWBACK-CODES-DFT
226110200423      *         AND WS-LSIF-WAIVE-CLAWBACK-FED IS NOT EQUAL "D"
226120200423      *            DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
226130200423      *            DISPLAY "@@@14 Failed PRV holding period phase3"
226140200423      *            MOVE "L3" TO REJECTION-CODE OF TRANS
226150200423      *            MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
226160200423      *                         WS-LSIF-WAIVE-CLAWBACK-PROV
226170200423      *            GO TO ENCC-EXIT
226180200423      *        END-IF
226190200423      *    END-IF.
226200200423
226210200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
226220200423              IF SW-GRACE-PERIOD-EXISTS
226230200423                 AND RETN-CALCULATION-TYPE-B
226240200423                 AND TRADE-DATE OF TRANS > 0
226250200423                 AND TRADE-DATE OF TRANS >=
226260200423                     RETN-REDEMPTION-START-DATE OF COMM-CPLSGPPP-PARMS
226270200423                 AND TRADE-DATE OF TRANS <=
226280200423                     RETN-REDEMPTION-END-DATE OF COMM-CPLSGPPP-PARMS
226290200423                 AND CONTRIBUTION-DATE OF TRANS-BUY-LSIF > 0
226300200423                 AND CONTRIBUTION-DATE OF TRANS-BUY-LSIF >=
226310200423                    RETN-CONTRIBUTION-START-DATE OF COMM-CPLSGPPP-PARMS
226320200423                 AND CONTRIBUTION-DATE OF TRANS-BUY-LSIF <=
226330200423                     RETN-CONTRIBUTION-END-DATE OF COMM-CPLSGPPP-PARMS
226340200423                     CONTINUE
226350200423              ELSE IF WS-LSIF-YEARS
226360200423                    < HOLDING-PERIOD OF LSIF-CLAWBACK-CODES-DFT
226370200423                      AND WS-LSIF-WAIVE-CLAWBACK-FED IS NOT EQUAL "D"
226380200423                       DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
226390200423                       DISPLAY "@@@14 Failed PRV holding period phase3"
226400200423                       MOVE "L3" TO REJECTION-CODE OF TRANS
226410200423                       MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
226420200423                                 WS-LSIF-WAIVE-CLAWBACK-PROV
226430200423                       GO TO ENCC-EXIT
226440200423                   END-IF
226450200423              END-IF
226460200423           END-IF.
226470200423      * RFS 26905 - ends.
226480200423
226490200423      * If we made it this far without rejecting, we can officially
226500200423      * waive clawback.
226510200423
226520200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
226530200423               MOVE "Y" TO WS-LSIF-WAIVE-CLAWBACK-YN-F
226540200423           ELSE
226550200423               MOVE "Y" TO WS-LSIF-WAIVE-CLAWBACK-YN-P
226560200423           END-IF.
226570200423
226580200423       ENCC-EXIT.
226590200423           EXIT.
226600200423      /
226610200423      ******************************************************************
226620200423      *    E V A L  S P E C I A L  C L A W B A C K  C O D E            *
226630200423      ******************************************************************
226640200423       EVAL-SPECIAL-CLAWBACK-CODE SECTION.
226650200423
226660200423       ESCC-0000.
226670200423
226680200423      * Move user supplied special clawback code to working storage
226690200423
226700200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
226710200423               MOVE LSIF-WAIVE-CLAWBACK-FED
226720200423               OF TRANS-LSIF-WAIVE-CLAWBACK
226730200423               TO WS-LSIF-WAIVE-CLAWBACK-FED
226740200423           ELSE
226750200423               MOVE LSIF-WAIVE-CLAWBACK-PROV
226760200423               OF TRANS-LSIF-WAIVE-CLAWBACK
226770200423               TO WS-LSIF-WAIVE-CLAWBACK-PROV
226780200423           END-IF.
226790200423
226800200423      * Validate if code on LSIF Clawback code table
226810200423
226820200423           PERFORM VALIDATE-LSIF-CODE.
226830200423
226840200423           IF WS-FEDERAL-FAIL = "Y"
226850200423           OR WS-PROVINCIAL-FAIL = "Y"
226860200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
226870200423               DISPLAY "@@@15 Failed VALIDATE-LSIF-CODE"
226880200423               MOVE "L3" TO REJECTION-CODE OF TRANS
226890200423               MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-FED
226900200423               MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-PROV
226910200423               GO TO ESCC-EXIT
226920200423           END-IF.
226930200423
226940200423      * CHECK HOLDING PERIOD
226950200423
226960200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
226970200423               IF WS-LSIF-YEARS < HOLDING-PERIOD
226980200423               OF LSIF-CLAWBACK-CODES
226990200423               AND WS-LSIF-WAIVE-CLAWBACK-FED IS NOT EQUAL "D"
227000200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227010200423                   DISPLAY "@@@16 Failed FED holding period phase3"
227020200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227030200423                   MOVE " "  TO WS-LSIF-WAIVE-CLAWBACK-FED
227040200423                                WS-LSIF-WAIVE-CLAWBACK-PROV
227050200423                   GO TO ESCC-EXIT
227060200423               END-IF
227070200423           END-IF.
227080200423
227090200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
227100200423               IF WS-LSIF-YEARS < HOLDING-PERIOD
227110200423               OF LSIF-CLAWBACK-CODES
227120200423               AND WS-LSIF-WAIVE-CLAWBACK-FED IS NOT EQUAL "D"
227130200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227140200423                   DISPLAY "@@@17 Failed PRV holding period phase3"
227150200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227160200423                   MOVE " " TO WS-LSIF-WAIVE-CLAWBACK-PROV
227170200423                               WS-LSIF-WAIVE-CLAWBACK-FED
227180200423                   GO TO ESCC-EXIT
227190200423               END-IF
227200200423           END-IF.
227210200423
227220200423     ** > 2 YEARS, NON RESIDENT
227230200423
227240200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
227250200423           AND WS-LSIF-WAIVE-CLAWBACK-FED = "G"
22726020042380658 *        IF COUNTRY-CODE OF INVESTOR IS EQUAL "CAN"
22727020042380658          IF Lc_TaxCountryCode        IS EQUAL "CAN"
227280200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227290200423                   DISPLAY "@@@18 Failed FED 2YRS NON-RESIDENT phase3"
227300200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227310200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-FED
227320200423                                  WS-LSIF-WAIVE-CLAWBACK-PROV
227330200423                   GO TO ESCC-EXIT
227340200423               END-IF
227350200423           END-IF.
227360200423
227370200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
227380200423           AND WS-LSIF-WAIVE-CLAWBACK-PROV = "G"
22739020042380658 *        IF COUNTRY-CODE OF INVESTOR IS EQUAL "CAN"
22740020042380658          IF Lc_TaxCountryCode        IS EQUAL "CAN"
227410200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227420200423                   DISPLAY "@@@19 Failed PRV 2YRS NON-RESIDENT phase3"
227430200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227440200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-PROV
227450200423                                  WS-LSIF-WAIVE-CLAWBACK-FED
227460200423                   GO TO ESCC-EXIT
227470200423               END-IF
227480200423           END-IF.
227490200423
227500200423     ** > 2 YEARS, AGE 65
227510200423
227520200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
227530200423           AND WS-LSIF-WAIVE-CLAWBACK-FED = "E"
227540200423               IF WS-LSIF-IVR-YEARS < 65
227550200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227560200423                   DISPLAY "@@@20 Failed FED 2YRS AGE 65 phase3"
227570200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227580200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-FED
227590200423                                  WS-LSIF-WAIVE-CLAWBACK-PROV
227600200423                   GO TO ESCC-EXIT
227610200423               END-IF
227620200423           END-IF.
227630200423
227640200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
227650200423           AND WS-LSIF-WAIVE-CLAWBACK-PROV = "E"
227660200423               IF WS-LSIF-IVR-YEARS < 65
227670200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227680200423                   DISPLAY "@@@21 Failed PRV 2YRS AGE 65 phase3"
227690200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227700200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-PROV
227710200423                                  WS-LSIF-WAIVE-CLAWBACK-FED
227720200423                   GO TO ESCC-EXIT
227730200423               END-IF
227740200423           END-IF.
227750200423
227760200423     ** > LESS THAN 60 DAYS OLD
227770200423
227780200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
227790200423           AND WS-LSIF-WAIVE-CLAWBACK-FED = "D"
227800200423               IF WS-LSIF-DAYS > 60
227810200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227820200423                   DISPLAY "@@@22 Failed FED LESS THAN 60 DAYS phase3"
227830200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227840200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-FED
227850200423                                  WS-LSIF-WAIVE-CLAWBACK-PROV
227860200423                   GO TO ESCC-EXIT
227870200423               END-IF
227880200423           END-IF.
227890200423
227900200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
227910200423           AND WS-LSIF-WAIVE-CLAWBACK-PROV = "D"
227920200423               IF WS-LSIF-DAYS > 60
227930200423                   DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
227940200423                   DISPLAY "@@@23 Failed PRV LESS THAN 60 DAYS phase3"
227950200423                   MOVE "L3" TO REJECTION-CODE OF TRANS
227960200423                   MOVE " "    TO WS-LSIF-WAIVE-CLAWBACK-PROV
227970200423                                  WS-LSIF-WAIVE-CLAWBACK-FED
227980200423                   GO TO ESCC-EXIT
227990200423               END-IF
228000200423           END-IF.
228010200423
228020200423      *RFS 20265 Begin
228030200423
228040200423     ** > TAX CREDIT CERTIFICATE NEVER ISSUED
228050200423
228060200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
228070200423           AND WS-LSIF-WAIVE-CLAWBACK-FED = "I"
228080200423               PERFORM CHECK-IF-FORM-EXISTS
228090200423               IF SKIP-TRANS-BUY-LSIF
228100200423                   GO TO ESCC-EXIT
228110200423               END-IF
228120200423           END-IF.
228130200423
228140200423           IF WS-FEDERAL-PROVINCIAL-MODE = "P"
228150200423           AND WS-LSIF-WAIVE-CLAWBACK-PROV = "I"
228160200423               PERFORM CHECK-IF-FORM-EXISTS
228170200423               IF SKIP-TRANS-BUY-LSIF
228180200423                   GO TO ESCC-EXIT
228190200423               END-IF
228200200423           END-IF.
228210200423
228220200423      *RFS 20265 End
228230200423
228240200423      * If we made it this far without rejecting, we can officially
228250200423      * waive clawback.
228260200423
228270200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
228280200423               MOVE 'Y' TO WS-LSIF-WAIVE-CLAWBACK-YN-F
228290200423           ELSE
228300200423               MOVE 'Y' TO WS-LSIF-WAIVE-CLAWBACK-YN-P
228310200423           END-IF.
228320200423
228330200423       ESCC-EXIT.
228340200423           EXIT.
228350200423      /
228360200423      *RFS 20265 Begin
228370200423      /
228380200423       CHECK-IF-FORM-EXISTS SECTION.
228390200423      ******************************************************************
228400200423      *    C H E C K  I F  F O R M  E X I S T S                        *
228410200423      ******************************************************************
228420200423       CIFE-0000.
228430200423
228440200423           MOVE "N" TO WS-SKIP-TRANS-BUY-LSIF-FLAG.
228450200423
228460200423      * First step is to loop through FORMS-TRANS-XREF.
228470200423
228480200423           MOVE PLACEMENT-DATE OF TRANS-BUY-LSIF
228490200423           TO   PLACEMENT-DATE OF FORMS-TRANS-XREF.
228500200423
228510200423           MOVE TRANS-NO       OF TRANS-BUY-LSIF
228520200423           TO   TRANS-NO       OF FORMS-TRANS-XREF.
228530200423
228540200423           MOVE SPACES TO FORM-SEQ-NO OF FORMS-TRANS-XREF.
228550200423
228560200423           START FORMS-TRANS-XREF
228570200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
228580200423           INVALID KEY
228590200423               GO TO CIFE-EXIT
228600200423           END-START.
228610200423
228620200423       CIFE-0010.
228630200423
228640200423           READ FORMS-TRANS-XREF NEXT RECORD
228650200423           AT END
228660200423               GO TO CIFE-EXIT
228670200423           END-READ.
228680200423
228690200423           IF PLACEMENT-DATE OF FORMS-TRANS-XREF IS NOT EQUAL
228700200423              PLACEMENT-DATE OF TRANS-BUY-LSIF   OR
228710200423              TRANS-NO       OF FORMS-TRANS-XREF IS NOT EQUAL
228720200423              TRANS-NO       OF TRANS-BUY-LSIF
228730200423               GO TO CIFE-EXIT
228740200423           END-IF.
228750200423
228760200423      * If we made it this far, we have a potential issued form.
228770200423      * We must now take the FORM-SEQ-NO of the FORMS-TRANS-XREF
228780200423      * and see if we can find an Account Issued Forms record.
228790200423
228800200423           MOVE FORM-SEQ-NO OF FORMS-TRANS-XREF
228810200423           TO   FORM-SEQ-NO OF ACCOUNT-ISSUED-FORMS.
228820200423
228830200423           READ ACCOUNT-ISSUED-FORMS
228840200423           INVALID KEY
228850200423             GO TO CIFE-0010
228860200423           END-READ.
228870200423
228880200423      * If the issued form is cancelled, it is almost like it never
228890200423      * issued.
228900200423           IF FORM-STATUS OF ACCOUNT-ISSUED-FORMS EQUAL 'C'
228910200423               GO TO CIFE-0010
228920200423           END-IF.
228930200423
228940200423      * If we have gotten this far, we must see if the FORM-CODE of
228950200423      * the retrieved FORM-REQUEST exists on the LSIF-TAX-CREDIT-PARMS.
228960200423
228970200423           MOVE FORM-CODE OF ACCOUNT-ISSUED-FORMS
228980200423           TO   FORM-CODE OF LSIF-TAX-CREDIT-PARMS-2.
228990200423
229000200423           START LSIF-TAX-CREDIT-PARMS-2
229010200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
229020200423           INVALID KEY
229030200423               GO TO CIFE-0010
229040200423           END-START.
229050200423
229060200423           READ LSIF-TAX-CREDIT-PARMS-2 NEXT RECORD
229070200423           AT END
229080200423               GO TO CIFE-0010
229090200423           END-READ.
229100200423
229110200423           IF FORM-CODE OF LSIF-TAX-CREDIT-PARMS-2 IS NOT EQUAL
229120200423              FORM-CODE OF ACCOUNT-ISSUED-FORMS
229130200423               GO TO CIFE-0010
229140200423           END-IF.
229150200423
229160200423      * If we have gotten this far, it means that a form was issued
229170200423      * for this TRANS-BUY-LSIF being exhausted. We should skip this
229180200423      * TRANS-BUY-LSIF due to the "I" clawback code specified by user.
229190200423
229200200423           MOVE "Y" TO WS-SKIP-TRANS-BUY-LSIF-FLAG.
229210200423
229220200423       CIFE-EXIT.
229230200423           EXIT.
229240200423      /
229250200423      * RFS 20265 End
229260200423      /
229270200423       VALIDATE-LSIF-CODE SECTION.
229280200423      ******************************************************************
229290200423      *    V A L I D A T E   L S I F   C O D E                         *
229300200423      ******************************************************************
229310200423           MOVE "N"          TO WS-FEDERAL-FAIL
229320200423                                WS-PROVINCIAL-FAIL.
229330200423
229340200423      * Set Clawback Code and Province Code
229350200423
229360200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
229370200423               MOVE "FED"    TO PROVINCE-CODE
229380200423                             OF LSIF-CLAWBACK-CODES
229390200423               MOVE WS-LSIF-WAIVE-CLAWBACK-FED
229400200423                             TO LSIF-WAIVE-CLAWBACK-CODE
229410200423                             OF LSIF-CLAWBACK-CODES
229420200423           ELSE
229430200423               MOVE PROVINCE-CODE OF TRANS-BUY-LSIF
229440200423                             TO PROVINCE-CODE
229450200423                             OF LSIF-CLAWBACK-CODES
229460200423               MOVE WS-LSIF-WAIVE-CLAWBACK-PROV
229470200423                             TO LSIF-WAIVE-CLAWBACK-CODE
229480200423                             OF LSIF-CLAWBACK-CODES
229490200423           END-IF.
229500200423
229510200423      * Set country code
229520200423
229530200423           MOVE COUNTRY-CODE OF TRANS-BUY-LSIF
229540200423                             TO COUNTRY-CODE
229550200423                             OF LSIF-CLAWBACK-CODES.
229560200423
229570200423      * Set End Date and read prior record
229580200423
22959020042318705 *    MOVE TRADE-DATE OF TRANS-BUY-LSIF
22960020042318705      MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF
229610200423           TO END-DATE OF LSIF-CLAWBACK-CODES
229620200423
229630200423           START LSIF-CLAWBACK-CODES
229640200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
229650200423             INVALID KEY
229660200423             IF WS-FEDERAL-PROVINCIAL-MODE = "F"
229670200423               MOVE "Y"        TO WS-FEDERAL-FAIL
229680200423             ELSE
229690200423               MOVE "Y"        TO WS-PROVINCIAL-FAIL
229700200423             END-IF
229710200423             GO TO VLC-EXIT
229720200423           END-START.
229730200423
229740200423       VLC-0100.
229750200423
229760200423           READ LSIF-CLAWBACK-CODES NEXT RECORD
229770200423             AT END
229780200423             IF WS-FEDERAL-PROVINCIAL-MODE = "F"
229790200423               MOVE "Y"        TO WS-FEDERAL-FAIL
229800200423             ELSE
229810200423               MOVE "Y"        TO WS-PROVINCIAL-FAIL
229820200423             END-IF
229830200423             GO TO VLC-EXIT
229840200423           END-READ.
229850200423
229860200423           IF (COUNTRY-CODE OF LSIF-CLAWBACK-CODES
229870200423             IS NOT EQUAL COUNTRY-CODE OF TRANS-BUY-LSIF)
229880200423           OR
229890200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "F") AND
229900200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES IS NOT EQUAL "FED"))
229910200423           OR
229920200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "P") AND
229930200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES
229940200423             IS NOT EQUAL PROVINCE-CODE OF TRANS-BUY-LSIF))
229950200423           OR
229960200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "F") AND
229970200423             (LSIF-WAIVE-CLAWBACK-CODE OF LSIF-CLAWBACK-CODES
229980200423             IS NOT EQUAL WS-LSIF-WAIVE-CLAWBACK-FED))
229990200423           OR
230000200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "P") AND
230010200423             (LSIF-WAIVE-CLAWBACK-CODE OF LSIF-CLAWBACK-CODES
230020200423             IS NOT EQUAL WS-LSIF-WAIVE-CLAWBACK-PROV))
230030200423           OR
23004020042318705 *      (TRADE-DATE OF TRANS-BUY-LSIF >
23005020042318705        (CONTRIBUTION-DATE OF TRANS-BUY-LSIF >
230060200423               END-DATE   OF LSIF-CLAWBACK-CODES)
230070200423           OR
23008020042318705 *      (TRADE-DATE OF TRANS-BUY-LSIF <
23009020042318705        (CONTRIBUTION-DATE OF TRANS-BUY-LSIF <
230100200423               START-DATE OF LSIF-CLAWBACK-CODES)
230110200423             GO TO VLC-0100
230120200423           END-IF.
230130200423
230140200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
230150200423               IF LSIF-DEFAULT-CODE OF LSIF-CLAWBACK-CODES = "C"
230160200423                   MOVE "N" TO WS-LSIF-WAIVE-CLAWBACK-YN-F
230170200423               ELSE
230180200423                   MOVE "Y" TO WS-LSIF-WAIVE-CLAWBACK-YN-F
230190200423               END-IF
230200200423           ELSE
230210200423               IF LSIF-DEFAULT-CODE OF LSIF-CLAWBACK-CODES = "C"
230220200423                   MOVE "N" TO WS-LSIF-WAIVE-CLAWBACK-YN-P
230230200423               ELSE
230240200423                   MOVE "Y" TO WS-LSIF-WAIVE-CLAWBACK-YN-P
230250200423               END-IF
230260200423           END-IF.
230270200423
230280200423       VLC-EXIT.
230290200423           EXIT.
230300200423      /
230310200423       GET-LSIF-CODE SECTION.
230320200423      ******************************************************************
230330200423      *    G E T   L S I F   C O D E                                   *
230340200423      ******************************************************************
230350200423           MOVE "N"          TO WS-FEDERAL-FAIL
230360200423                                WS-PROVINCIAL-FAIL.
230370200423
230380200423      * Set Clawback Code and Province Code
230390200423
230400200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
230410200423               MOVE "FED"    TO PROVINCE-CODE
230420200423                             OF LSIF-CLAWBACK-CODES
230430200423               MOVE WS-LSIF-WAIVE-CLAWBACK-FED
230440200423                             TO LSIF-WAIVE-CLAWBACK-CODE
230450200423                             OF LSIF-CLAWBACK-CODES
230460200423           ELSE
230470200423               MOVE PROVINCE-CODE OF TRANS-BUY-LSIF
230480200423                             TO PROVINCE-CODE
230490200423                             OF LSIF-CLAWBACK-CODES
230500200423               MOVE WS-LSIF-WAIVE-CLAWBACK-PROV
230510200423                             TO LSIF-WAIVE-CLAWBACK-CODE
230520200423                             OF LSIF-CLAWBACK-CODES
230530200423           END-IF.
230540200423
230550200423      * Set country code
230560200423
230570200423           MOVE COUNTRY-CODE OF TRANS-BUY-LSIF
230580200423                             TO COUNTRY-CODE
230590200423                             OF LSIF-CLAWBACK-CODES.
230600200423
230610200423      * Set End Date and read prior record
230620200423
230630200423           MOVE ZEROES TO END-DATE OF LSIF-CLAWBACK-CODES
230640200423
230650200423           START LSIF-CLAWBACK-CODES
230660200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
230670200423             INVALID KEY
230680200423             IF WS-FEDERAL-PROVINCIAL-MODE = "F"
230690200423               MOVE "Y"        TO WS-FEDERAL-FAIL
230700200423             ELSE
230710200423               MOVE "Y"        TO WS-PROVINCIAL-FAIL
230720200423             END-IF
230730200423             GO TO GLC-EXIT
230740200423           END-START.
230750200423
230760200423       GLC-0100.
230770200423
230780200423           READ LSIF-CLAWBACK-CODES NEXT RECORD
230790200423             AT END
230800200423             IF WS-FEDERAL-PROVINCIAL-MODE = "F"
230810200423               MOVE "Y"        TO WS-FEDERAL-FAIL
230820200423             ELSE
230830200423               MOVE "Y"        TO WS-PROVINCIAL-FAIL
230840200423             END-IF
230850200423             GO TO GLC-EXIT
230860200423           END-READ.
230870200423
230880200423           IF (COUNTRY-CODE OF LSIF-CLAWBACK-CODES
230890200423             IS NOT EQUAL COUNTRY-CODE OF TRANS-BUY-LSIF)
230900200423           OR
230910200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "F") AND
230920200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES IS NOT EQUAL "FED"))
230930200423           OR
230940200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "P") AND
230950200423             (PROVINCE-CODE OF LSIF-CLAWBACK-CODES
230960200423             IS NOT EQUAL PROVINCE-CODE OF TRANS-BUY-LSIF))
230970200423           OR
230980200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "F") AND
230990200423             (LSIF-WAIVE-CLAWBACK-CODE OF LSIF-CLAWBACK-CODES
231000200423             IS NOT EQUAL WS-LSIF-WAIVE-CLAWBACK-FED))
231010200423           OR
231020200423             ((WS-FEDERAL-PROVINCIAL-MODE IS EQUAL "P") AND
231030200423             (LSIF-WAIVE-CLAWBACK-CODE OF LSIF-CLAWBACK-CODES
231040200423             IS NOT EQUAL WS-LSIF-WAIVE-CLAWBACK-PROV))
231050200423               GO TO GLC-0100
231060200423           END-IF.
231070200423
231080200423       GLC-EXIT.
231090200423           EXIT.
231100200423      /
231110200423      *RFS 16760 End
231120200423      /
231130200423       VALIDATE-LSIF-SPECIFIC-TX-ID SECTION.
231140200423      ******************************************************************
231150200423      *    V A L I D A T E   S P E C I F I C   L S I F   T X N         *
231160200423      ******************************************************************
231170200423
231180200423           MOVE SPLIT-OPTION-CODE OF TRANS
231190200423                             TO TRANS-SPLIT-OPTION-CATAGORY.
231200200423           MOVE ZEROES       TO WS-LSIF-CHK-UNITS.
231210200423
231220200423       VLST-0010.
231230200423           MOVE "N"          TO WS-TRANS-WAIVE-EXIST.
231240200423
231250200423           MOVE PLACEMENT-DATE OF TRANS
231260200423                             TO PLACEMENT-DATE
231270200423                             OF TRANS-LSIF-WAIVE-CLAWBACK.
231280200423           MOVE TRANS-NO OF TRANS
231290200423                             TO TRANS-NO
231300200423                             OF TRANS-LSIF-WAIVE-CLAWBACK.
231310200423
231320200423           READ TRANS-LSIF-WAIVE-CLAWBACK
231330200423             INVALID KEY
231340200423             GO TO VLST-EXIT
231350200423           END-READ.
231360200423
231370200423           MOVE "Y"          TO WS-TRANS-WAIVE-EXIST.
231380200423
231390200423           IF PLACEMENT-DATE-2 OF TRANS-LSIF-WAIVE-CLAWBACK
231400200423           IS EQUAL ZEROES
231410200423             GO TO VLST-EXIT
231420200423           END-IF.
231430200423
231440200423           MOVE PLACEMENT-DATE-2 OF TRANS-LSIF-WAIVE-CLAWBACK
231450200423                             TO PLACEMENT-DATE
231460200423                             OF TRANS-BUY-LSIF-CHK
231470200423                                PLACEMENT-DATE
231480200423                             OF TRANS-PRIMARY.
231490200423           MOVE TRANS-NO-2 OF TRANS-LSIF-WAIVE-CLAWBACK
231500200423                             TO TRANS-NO
231510200423                             OF TRANS-BUY-LSIF-CHK
231520200423                                TRANS-NO
231530200423                             OF TRANS-PRIMARY.
231540200423
231550200423           READ TRANS-PRIMARY WITH NO LOCK
231560200423             INVALID KEY
231570200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
231580200423             DISPLAY "@@@24 Can't find LSIF-TAX-CREDIT-PARM"
231590200423             MOVE "54"       TO REJECTION-CODE OF TRANS
231600200423             GO TO VLST-0200
231610200423           END-READ.
231620200423
231630200423       VLST-0020.
231640200423
231650200423           START TRANS-BUY-LSIF-CHK
231660200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
231670200423             INVALID KEY
231680200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
231690200423             DISPLAY "@@@25 Specified TRANS-BUY-LSIF not there"
231700200423             MOVE "54"       TO REJECTION-CODE OF TRANS
231710200423             GO TO VLST-0200
231720200423           END-START.
231730200423
231740200423       VLST-0030.
231750200423
231760200423           READ TRANS-BUY-LSIF-CHK NEXT RECORD
231770200423           AT END
231780200423             GO TO VLST-0050
231790200423           END-READ.
231800200423
231810200423           IF PLACEMENT-DATE OF TRANS-BUY-LSIF-CHK
231820200423           IS NOT EQUAL PLACEMENT-DATE OF TRANS-PRIMARY OR
231830200423           TRANS-NO OF TRANS-BUY-LSIF-CHK IS NOT EQUAL
231840200423           TRANS-NO OF TRANS-PRIMARY
231850200423             GO TO VLST-0050
231860200423           END-IF.
231870200423
231880200423      *RFS 18486-Begin - commented existing condition below and added new one
231890200423      *RFS 18191 Begin
231900200423      *    IF LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "A"
231910200423      *    IF LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "F" OR
231920200423      *       LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "P" OR
231930200423      *       LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "B"
231940200423      *RFS 18191 End
231950200423      *    IF LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "F" AND
231960200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "P" AND
231970200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "B" AND
231980200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "N"
231990200423      *RFS 19063-Begin.
232000200423      *    IF LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "F" AND
232010200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "P" AND
232020200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "B" AND
232030200423      *       LSIF-STATUS OF TRANS-BUY-LSIF IS NOT EQUAL "N"
232040200423           IF LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "F" AND
232050200423              LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "P" AND
232060200423              LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "B" AND
232070200423              LSIF-STATUS OF TRANS-BUY-LSIF-CHK IS NOT EQUAL "N"
232080200423      *RFS 19063-End.
232090200423      *RFS 18486-End.
232100200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
232110200423             DISPLAY "@@@26 Specified TRANS-BUY-LSIF not active"
232120200423             MOVE "54"       TO REJECTION-CODE OF TRANS
232130200423             GO TO VLST-0200
232140200423           END-IF.
232150200423
232160200423           ADD CURR-UNIT-BAL OF TRANS-BUY-LSIF-CHK
232170200423                             TO WS-LSIF-CHK-UNITS.
232180200423
232190200423           GO TO VLST-0030.
232200200423
232210200423       VLST-0050.
232220200423
232230200423           IF TRANS-TYPE-CODE OF TRANS-PRIMARY IS NOT EQUAL "BUY"
232240200423           AND "SWI" AND "TRI"
232250200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
232260200423             DISPLAY "@@@27 Specified original buy not BUY/SWI/TRI"
232270200423             MOVE "54"       TO REJECTION-CODE OF TRANS
232280200423             GO TO VLST-0200
232290200423           END-IF.
232300200423
232310200423           IF REVERSE OF TRANS-PRIMARY IS NOT EQUAL " " AND "N"
232320200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
232330200423             DISPLAY "@@@28 Specified original buy is reversed"
232340200423             MOVE "54"       TO REJECTION-CODE OF TRANS
232350200423             GO TO VLST-0200
232360200423           END-IF.
232370200423
232380200423           IF TRANS-STATUS-CODE OF TRANS-PRIMARY IS NOT EQUAL "HST"
232390200423      *RFS 18486-Begin.
232400200423           AND TRANS-STATUS-CODE OF TRANS-PRIMARY IS NOT EQUAL "HSC"
232410200423      *RFS 18486-End.
232420200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
232430200423             DISPLAY "@@@29 Specified original buy is not history"
232440200423             MOVE "54"       TO REJECTION-CODE OF TRANS
232450200423             GO TO VLST-0200
232460200423           END-IF.
232470200423
232480200423           IF ACCOUNT-NO OF TRANS-PRIMARY IS NOT EQUAL ACCOUNT-NO
232490200423           OF TRANS
232500200423           OR INVESTMENT-CODE OF TRANS-PRIMARY IS NOT EQUAL
232510200423           INVESTMENT-CODE OF TRANS
232520200423             DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
232530200423             DISPLAY "@@@30 Specified original buy is same acc/inv"
232540200423             MOVE "54"       TO REJECTION-CODE OF TRANS
232550200423             GO TO VLST-0200
232560200423           END-IF.
232570200423
232580200423           IF WS-LSIF-CHK-UNITS < UNIT-AMT OF TRANS
232590200423             MOVE "11"       TO REJECTION-CODE OF TRANS
232600200423             GO TO VLST-0200
232610200423           END-IF.
232620200423
232630200423           IF NOT PLACED-UNITS
232640200423             MOVE "55"       TO REJECTION-CODE OF TRANS
232650200423             GO TO VLST-0200
232660200423           END-IF.
232670200423
232680200423       VLST-0200.
232690200423
232700200423
232710200423       VLST-EXIT.
232720200423           EXIT.
232730200423      /
232740200423       ESTIMATE-GROSS-AMT SECTION.
232750200423      ******************************************************************
232760200423      *    E S T I M A T E   G R O S S   A M O U N T                   *
232770200423      ******************************************************************
232780200423
232790200423      ** The purpose of this routine is to guess the gross that goes
232800200423      ** with a net placed transactions, and to guess the net that goes
232810200423      ** with a gross in the event that a transaction is placed gross
232820200423      ** but tax is calculated on the net amount
232830200423
232840200423      ** The concept of this routine is that some deductions should be
232850200423      ** exposed to a gross amount in order to be calculated, and other
232860200423      ** charges should be exposed to other deductions in order to be
232870200423      ** calculated. For example:  A switch from an RSP account to a
232880200423      ** CASH account, back end to back end, labour sponsor to labour
232890200423      ** sponsor.  The gross amount is subject to tax.  As a result of
232900200423      ** incurring this deduction, a redemption of sorts must occur
232910200423      ** to satisfy lsif and dsc accounting. This will become 'D'
232920200423      ** type deductions.  The 'D' portion of the routine answers the
232930200423      ** question 'what gross amount will have to be redeemed in order
232940200423      ** to the the tax out within the transaction
232950200423
232960200423      ** Flags to note:
232970200423      **
232980200423      ** WS-SWITCH-MODE - controls tax sequence
232990200423      ** --------------
233000200423      ** There are 3 values for this flag:
233010200423      ** G - the switch transaction was placed gross, tax is calculated
233020200423      **     on the net amount.  Because we need the tax out front
233030200423      **     and we have not incurred any sub deductions based on net
233040200423      **     we have to guess at the net.
233050200423      ** N - the switch transaction was placed net, tax on net.
233060200423      **     and sub deductions exist
233070200423      **' '- calculate as per normal
233080200423      **
233090200423      ** WS-DEDUCTION-MODE - controls calculation sequence
233100200423      ** -----------------
233110200423      **
233120200423      ** There are 2 values for this flag:
233130200423      ** G - accrue the value of gross based transactions
233140200423      ** D - gross up the value of gross based transactions by the D
233150200423      **     based transactions
233160200423
233170200423      ** WS-TAX-CDSC-APPLICABLE, WS-TAX-LBS-APPLICABLE
233180200423      ** ---------------------------------------------
233190200423      ** There are 4 values for this flag:
233200200423      ** 3 - perform lsif redemption and cdsc routines ignoring
233210200423      **     transaction specific code (SWO, TRO etc) logic.  Treat
233220200423      **     the transaction as a sell
233230200423      ** 1 - there is an amount in ws-trans-rec-3 that must be
233240200423      **     applied to LSIF and/or DSC.  This used in swithc/transfer
233250200423      **     situations where there is both units to be sold due to
233260200423      **     sub deductions and units to be transfered to a target fund
233270200423      **     at no charge.
233280200423      ** 2 - when 1 is processed, it becomes at 2 at the bottom of both
233290200423      **     routines.
233300200423
233310200423
233320200423      * RFS46962 - Begin:initialize the counter
233330200423           INITIALIZE ln_estimateCounter
233340200423183140                WS-EST-NR-TAX
233350200423      * RFS46962 - End
233360200423           MOVE " "      TO WS-SWITCH-GROSS-MODE.
233370200423      * RFS32914 - Start
233380200423           SET lb_SetTopNo     TO TRUE
233390200423           SET lb_SetRejNetYes TO TRUE
233400200423           SET lb_SetAddFeeNo  TO TRUE
233410200423      * RFS32914 - End
233420200423      * RFS12420 - Begin
233430200423           INITIALIZE  WS-IND-FOR-WITHH-RATES
233440200423           PERFORM GET-ALL-TAX-RATE
233450200423      * RFS12420 - End
233460200423
233470200423           IF  TAX-ON-NET
233480200423           AND (WS-CDSC-DEDUCTION-TYPE = "D"
233490200423           OR  WS-CLAWBACK-DEDUCTION-TYPE = "D")
233500200423
233510200423             IF GROSS-OR-NET OF TRANS = "G"
233520200423               MOVE GROSS-AMT OF TRANS
233530200423                             TO WS-TAXABLE-AMOUNT
23354020042380658          PERFORM ADJUST-RDSP-TAXABLE-AMT
233550200423      * RFS12420 - Begin
233560200423      *        PERFORM GET-TAX-RATE
233570200423               PERFORM SET-TAX-RATE
233580200423136069         PERFORM RDSP-SET-TAX-RATE
233590200423      * RFS12420 - End
233600200423             ELSE
233610200423               MOVE NET-AMT OF TRANS
233620200423                             TO WS-TAXABLE-AMOUNT
233630200423183140         PERFORM CALCULATE-LINKED-INTEREST
23364020042380658          PERFORM ADJUST-RDSP-TAXABLE-AMT
233650200423      * RFS12420 - Begin
233660200423      *        PERFORM GET-TAX-RATE
233670200423               PERFORM SET-TAX-RATE
233680200423136069         PERFORM RDSP-SET-TAX-RATE
233690200423      * RFS12420 - End
233700200423             END-IF
233710200423
233720200423             IF PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX > 0
233730200423             OR FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX > 0
233740200423               IF GROSS-OR-NET OF TRANS = "G"
233750200423                 MOVE "G"    TO WS-SWITCH-GROSS-MODE
233760200423               ELSE
233770200423                 MOVE "N"      TO WS-SWITCH-GROSS-MODE
233780200423               END-IF
233790200423             END-IF
233800200423           END-IF.
233810200423
233820200423           MOVE PASS-CDSC-CALCULATOR
233830200423                             TO WS-PASS-CDSC-CALCULATOR-HOLD.
233840200423           MOVE "C"          TO PASS-CDSC-CALCULATOR.
23385020042392475      MOVE lncc_Y       TO lc_CalcMode.
233860200423      * RFS24228 - Begin
233870200423           SET WS-CDSC-CALCULATOR-INTERNAL-C  TO TRUE
233880200423      * RFS24228 - End
233890200423
233900200423           MOVE "G"          TO WS-DEDUCTION-MODE.
233910200423
233920200423      * RFS12420 - Begin
233930200423           PERFORM SET-RANGE-MIN-MAX
233940200423           PERFORM SET-CURRENT-WITHH-INDEX.
233950200423
233960200423      *    MOVE ZEROS        TO WS-GROSS-STORED.
233970200423      *    MOVE ZEROS        TO WS-TAX-PASS-COUNT.
233980200423      *    MOVE "N"          TO WS-FINAL-TAX-PASS.
233990200423      * RFS12420 - End
234000200423
234010200423       EGA-G-START.
234020200423
234030200423           MOVE ZERO         TO WS-BASE-DEDUCTIONS
234040200423                                WS-CDSC-AMOUNT
234050200423                                WS-TOTAL-CLAWBACK
234060200423                                WS-HH-RED-AMT
234070200423                                WS-EST-TAX
234080200423                                WS-EST-NET
234090200423                                WS-SUB-DEDUCTION-NET
234100200423                                WS-CURRENT-RANGE-VALUE-D
234110200423                                WS-CURRENT-RANGE-MAXIMUM-D
234120200423                                WS-CURRENT-RANGE-MINIMUM-D.
234130200423140721     INITIALIZE ln_freeDollarsUsed
234140200423      * RFS46962 - Begin: add logic to prevent looping
234150200423            COMPUTE ln_estimateCounter = ln_estimateCounter + 1
234160200423            IF ln_estimateCounter > lnc_estimateCounterMax
234170200423              DISPLAY "Estimate Gross Amount cause the rejection "
234180200423              MOVE "29"   TO REJECTION-CODE OF TRANS
234190200423              GO TO EGA-CLEANUP5
234200200423            END-IF
234210200423      * RFS46962 - End
234220200423
234230200423           IF GROSS-OR-NET OF TRANS = "N"
234240200423             COMPUTE WS-CURRENT-RANGE-VALUE ROUNDED =
234250200423             ((WS-CURRENT-RANGE-MAXIMUM
234260200423             + WS-CURRENT-RANGE-MINIMUM) / 2)
234270200423             MOVE WS-CURRENT-RANGE-VALUE
234280200423                             TO GROSS-AMT OF TRANS
234290200423           END-IF.
234300200423
234310200423           IF WS-SWITCH-GROSS-MODE IS EQUAL "G"
234320200423             COMPUTE WS-CURRENT-RANGE-VALUE ROUNDED =
234330200423             (WS-CURRENT-RANGE-MAXIMUM
234340200423             + WS-CURRENT-RANGE-MINIMUM) / 2
234350200423             MOVE WS-CURRENT-RANGE-VALUE
234360200423                             TO NET-AMT OF TRANS
234370200423           END-IF.
234380200423
234390200423           IF WS-DEDUCTION-MODE = "G"
234400200423             COMPUTE UNIT-AMT OF TRANS ROUNDED = GROSS-AMT OF TRANS /
234410200423             UNIT-PRICE OF TRANS
234420200423           END-IF.
234430200423
234440200423           IF WS-SWITCH-GROSS-MODE = "G" OR "N"
234450200423             IF WS-TAX-DEDUCTION-TYPE = WS-DEDUCTION-MODE
234460200423               MOVE NET-AMT OF TRANS
234470200423                             TO WS-TAXABLE-AMOUNT
234480200423183140         PERFORM CALCULATE-LINKED-INTEREST
23449020042380658          PERFORM ADJUST-RDSP-TAXABLE-AMT
234500200423               MOVE ZEROES   TO WS-EST-TAX
234510200423      * RFS12420 - Begin
234520200423      *        PERFORM GET-TAX-RATE
234530200423               PERFORM SET-TAX-RATE
234540200423136069         PERFORM RDSP-SET-TAX-RATE
234550200423      * RFS12420 - End
234560200423               COMPUTE WS-WORK-TAX-RATE = ((FEDERAL-TAX-RATE
234570200423               OF COUNTRY-WITHHOLDING-TAX + PROVINCIAL-TAX-RATE
234580200423               OF COUNTRY-WITHHOLDING-TAX) / 100)
234590200423
234600200423      *RFS29550 - Begins
234610200423               IF  SPEC-MOD-AUTH-USWT
234620200423               AND USWT-APPLY-TAX
234630200423      *RFS135318 - Begins
234640200423               AND NOT (RDSP-ACCOUNT
234650200423                        AND WS-CURR-CONTR-REDEM-RULE-AHA)
234660200423      *RFS135318 - Ends
234670200423                 COMPUTE WS-WORK-TAX-RATE =
234680200423                   ((FEDERAL-TAX-RATE    OF COUNTRY-WITHHOLDING-TAX
234690200423                   + PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
234700200423                   + WS-USWT-TAX-RATE)
234710200423                   / 100)
234720200423                 IF WS-WORK-TAX-RATE > 1.0000
234730200423                    MOVE "11"  TO REJECTION-CODE OF TRANS
234740200423                    PERFORM RECORD-UPDATES
234750200423                    MOVE 0  TO WS-WORK-TAX-RATE
234760200423                    GO TO EGA-CLEANUP5
234770200423                 END-IF
234780200423               END-IF
234790200423      *RFS29550 - Ends
234800200423
234810200423      * RFS14879 - Begin
234820200423      *        COMPUTE WS-EST-TAX  = ((WS-TAXABLE-AMOUNT /
234830200423136069         IF NOT (RDSP-ACCOUNT-RULE  AND
234840200423136069                      WS-CURR-CONTR-REDEM-RULE-DAP)
234850200423               COMPUTE WS-EST-TAX  ROUNDED = ((WS-TAXABLE-AMOUNT /
234860200423      * RFS14879 - End
234870200423               (1.0000 - WS-WORK-TAX-RATE))
234880200423               - WS-TAXABLE-AMOUNT)
234890200423136069         ELSE
234900200423136069           PERFORM CALCULATE-RDSP-EST-TAX
234910200423136069         END-IF                                                   T
234920200423
234930200423      *RFS24190 - Begins
234940200423               IF NTAXT2062-CALC
234950200423                  PERFORM CALCULATE-NTAXT2062-EST
234960200423               END-IF
234970200423
234980200423               IF NTAXREGSEL-CALC
234990200423                  PERFORM CALCULATE-NTAXREGSEL-EST
235000200423               END-IF
235010200423      *RFS24190 - Ends
235020200423
235030200423               IF WS-TRANS-ADDL-TAX-FOUND = "Y"
235040200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "$"
235050200423      * RFS39003 - Start
235060200423                    SET lb_SetAddFeeYes TO TRUE
235070200423      * RFS39003 - End
235080200423                    IF ADD-REPLACE-TAX = "A"
235090200423                       ADD FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
235100200423                             TO WS-EST-TAX
235110200423                       ADD PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
235120200423                             TO WS-EST-TAX
235130200423                    ELSE
235140200423                       MOVE FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
235150200423                             TO WS-EST-TAX
235160200423                       ADD  PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
235170200423                             TO WS-EST-TAX
235180200423                    END-IF
235190200423                  END-IF
23520020042384482 * Begins: If INPUT-xxx-TAX-AMT > 0, add them
235210200423      * Referring to CALCULATE-TAX-AMOUNT
235220200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "%"
235230200423                     AND ADD-REPLACE-TAX OF TRANS-ADDITIONAL-TAX = "R"
235240200423                    IF INPUT-FEDERAL-TAX-AMT > 0
235250200423                      SET lb_SetAddFeeYes TO TRUE
235260200423                      ADD INPUT-FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
235270200423                       TO WS-EST-TAX
235280200423                    END-IF
235290200423                    IF INPUT-PROVINCIAL-TAX-AMT > 0
235300200423                      SET lb_SetAddFeeYes TO TRUE
235310200423                      ADD INPUT-PROVINCIAL-TAX-AMT
235320200423                          OF TRANS-ADDITIONAL-TAX
235330200423                       TO WS-EST-TAX
235340200423                    END-IF
235350200423                  END-IF
23536020042384482 * Ends
235370200423               END-IF
235380200423
235390200423               ADD WS-EST-TAX  TO WS-BASE-DEDUCTIONS
235400200423
235410200423             END-IF
235420200423           END-IF.
235430200423
235440200423
235450200423       EGA-D-START.
235460200423      * RFS12420 - Begin
235470200423           INITIALIZE WS-IND-RATE-CHK
235480200423      * RFS12420 - End
235490200423140721     INITIALIZE ln_freeDollarsUsed
235500200423           MOVE ZERO         TO WS-D-DEDUCTIONS.
235510200423
235520200423           IF WS-DEDUCTION-MODE = "D"
235530200423             COMPUTE WS-CURRENT-RANGE-VALUE-D
235540200423      * RFS14879 - Begin
235550200423                     ROUNDED
235560200423      * RFS14879 - End
235570200423             = (WS-CURRENT-RANGE-MAXIMUM-D + WS-CURRENT-RANGE-MINIMUM-D)
235580200423             / 2
235590200423             COMPUTE UNIT-AMT OF TRANS ROUNDED =
235600200423             WS-CURRENT-RANGE-VALUE-D / UNIT-PRICE OF TRANS
235610200423      *RFS 13405 BEGIN
235620200423             IF ACCOUNT-LEV-DSC
235630201223      *RFS180707 - Starts
235640201223             AND lnc_ACINDSCNo
235650201223      *RFS180707 - Ends
235660200423               MOVE GROSS-AMT OF TRANS
235670200423                             TO WS-ALV-GROSS
235680200423               MOVE WS-CURRENT-RANGE-VALUE-D
235690200423                             TO GROSS-AMT OF TRANS
235700200423             END-IF
235710200423      *RFS 13405 END
235720200423           END-IF.
235730200423
235740200423
235750200423           IF WS-CDSC-DEDUCTION-TYPE = WS-DEDUCTION-MODE
235760200423
235770200423             IF WS-DEDUCTION-MODE = "D"
235780200423               MOVE "3"        TO WS-TAX-CDSC-APPLICABLE
235790200423             END-IF
235800200423
235810200423             IF NOT CDSC-PAID-BY-DEALER
235820201125      *RFS 1102637 - Starts
235830201125             MOVE "N"          TO WS-CRC-0020-EXIT-POINT
235840201125      *RFS 1102637 - Ends
235850200423              PERFORM CALCULATE-REDEMPTION-CDSC
235860200423      * RFS32873 - Begin: added "END-IF"
235870200423             END-IF
235880200423      * RFS32873 - End
235890200423
235900200423      *RFS 13405 BEGIN
235910200423             IF ACCOUNT-LEV-DSC AND WS-DEDUCTION-MODE = "D"
235920201223      *RFS180707 - Starts
235930201223             AND lnc_ACINDSCNo
235940201223      *RFS180707 - Ends
235950200423               MOVE WS-ALV-GROSS TO GROSS-AMT OF TRANS
235960200423             END-IF
235970200423      *RFS 13405 END
235980200423      * RFS32873 - Begin - commented the END-IF
235990200423      *      END-IF
236000200423      * RFS32873 - End
236010200423
236020200423             IF WS-DEDUCTION-MODE = "G"
236030200423               ADD WS-CDSC-AMOUNT
236040200423                             TO WS-BASE-DEDUCTIONS
236050200423             END-IF
236060200423
236070200423             IF WS-DEDUCTION-MODE = "D"
236080200423               ADD WS-CDSC-AMOUNT
236090200423                             TO WS-D-DEDUCTIONS
236100200423             END-IF
236110200423
236120200423             MOVE "0"        TO WS-TAX-CDSC-APPLICABLE
236130200423           END-IF.
236140200423
236150200423      *RFS 14380 Begin
236160200423             IF SPEC-MOD-AUTH-ERFEE
236170200423                 MOVE "Y" TO WS-TEP-UPDATE-ERF-FILES
236180200423                 PERFORM POST-ERF-SELL-UNITS
236190200423             END-IF
236200200423      *RFS 14380 End
236210200423
236220200423           IF WS-CLAWBACK-DEDUCTION-TYPE = WS-DEDUCTION-MODE
236230200423             IF WS-DEDUCTION-MODE = "D"
236240200423               MOVE "3"        TO WS-TAX-LBS-APPLICABLE
236250200423             END-IF
236260200423
236270200423             IF PRODUCT-TYPE-CODE OF INVESTMENT IS EQUAL "LBS"
236280200423      *RFS 16760 Begin
236290200423               MOVE "Y" TO WS-TBL-UPDATE-LSIF-FILES
236300200423      *RFS 16760 End
236310200423               PERFORM CALCULATE-LBR-SPNS-REDEM
236320200423             END-IF
236330200423
236340200423             IF WS-DEDUCTION-MODE = "G"
236350200423               ADD WS-TOTAL-CLAWBACK
236360200423                             TO WS-BASE-DEDUCTIONS
236370200423             END-IF
236380200423
236390200423             IF WS-DEDUCTION-MODE = "D"
236400200423               ADD WS-TOTAL-CLAWBACK
236410200423                             TO WS-D-DEDUCTIONS
236420200423             END-IF
236430200423
236440200423             MOVE "0"        TO WS-TAX-LBS-APPLICABLE
236450200423
236460200423           END-IF.
236470200423
236480200423      *HHMOD
236490200423
236500200423           IF WS-HH-REDFEE-DEDUCTION-TYPE = WS-DEDUCTION-MODE
236510200423             IF WS-DEDUCTION-MODE = "D"
236520200423               MOVE "3"        TO WS-TAX-HH-REDFEE-APPLICABLE
236530200423             END-IF
236540200423
236550200423             IF WS-HH-RATES-APPLICABLE AND NOT BACK-END-LOAD
236560200423             AND REDEMPTION-TRANSACTION
236570200423             AND NOT SWITCH-OUT-TRANSACTION
236580200423               PERFORM CALCULATE-HH-REDEM-FEE
236590200423             END-IF
236600200423
236610200423             IF WS-HH-RATES-APPLICABLE AND NOT BACK-END-LOAD
236620200423             AND SWITCH-OUT-TRANSACTION
236630200423               IF (TO-BACK-END-LOAD) OR (NOT TO-HHFEE)
236640200423                 PERFORM CALCULATE-HH-REDEM-FEE
236650200423               END-IF
236660200423             END-IF
236670200423
236680200423             IF WS-DEDUCTION-MODE = "G"
236690200423               ADD WS-HH-RED-AMT
236700200423                             TO WS-BASE-DEDUCTIONS
236710200423             END-IF
236720200423
236730200423             IF WS-DEDUCTION-MODE = "D"
236740200423               ADD WS-HH-RED-AMT
236750200423                             TO WS-D-DEDUCTIONS
236760200423             END-IF
236770200423
236780200423             MOVE "0"        TO WS-TAX-HH-REDFEE-APPLICABLE
236790200423
236800200423           END-IF.
236810200423
236820200423      *GIC MOD
236830200423
236840200423      * RFS16384 Begin
236850200423      *    IF GIC-INVESTMENT
236860200423           IF (GIC-INVESTMENT          OR
236870200423              (PASS-CDSC-CALCULATOR = "C" AND GIC-DII-INVESTMENT))
236880200423      * RFS16384 End
236890200423           AND WS-REPMT-RFE-DEDUCTION-TYPE = WS-DEDUCTION-MODE
236900200423             IF WS-DEDUCTION-MODE = "D"
236910200423               MOVE "3"        TO WS-TAX-REPMT-RFE-APPLICABLE
236920200423             END-IF
236930200423
236940200423             PERFORM CALCULATE-GIC-DEDUCTIONS
236950200423      * RFS140721 - Start
236960200423             IF ACCOUNT-LEV-FREE-DOLLARS AND
236970201223      *RFS180707 - Starts
236980201223                lnc_ACINDSCNo AND
236990201223      *RFS180707 - Ends
237000200423                REDEMPTION-TRANSACTION   AND
237010200423                GIC-INVESTMENT AND lc_PenaltyMethod = lc_MVA  AND
237020200423                ln_freeDollarsUsed > 0
237030200423                  PERFORM WAIVE-MVA-CHARGE
237040200423             END-IF
237050200423      * RFS140721 - End
237060200423
237070200423             IF WS-DEDUCTION-MODE = "G"
237080200423               ADD WSA-REPMT-RED-FEE
237090200423                             TO WS-BASE-DEDUCTIONS
237100200423             END-IF
237110200423
237120200423             IF WS-DEDUCTION-MODE = "D"
237130200423               ADD WSA-REPMT-RED-FEE
237140200423                             TO WS-D-DEDUCTIONS
237150200423             END-IF
237160200423
237170200423             MOVE "0"        TO WS-TAX-REPMT-RFE-APPLICABLE
237180200423
237190200423           END-IF.
237200200423      *END GIC MOD
237210200423
237220200423      *GIC MOD
237230200423
237240200423      * RFS16384 Begin
237250200423      *    IF GIC-INVESTMENT
237260200423           IF (GIC-INVESTMENT          OR
237270200423              (PASS-CDSC-CALCULATOR = "C" AND GIC-DII-INVESTMENT))
237280200423      * RFS16384 End
237290200423           AND WS-REDE-PLTY-DEDUCTION-TYPE = WS-DEDUCTION-MODE
237300200423             IF WS-DEDUCTION-MODE = "D"
237310200423               MOVE "3"        TO WS-TAX-REDE-PLTY-APPLICABLE
237320200423             END-IF
237330200423
237340200423             PERFORM CALCULATE-GIC-DEDUCTIONS
237350200423      * RFS140721 - Start
237360200423             IF ACCOUNT-LEV-FREE-DOLLARS AND
237370201223      *RFS180707 - Starts
237380201223                lnc_ACINDSCNo AND
237390201223      *RFS180707 - Ends
237400200423                REDEMPTION-TRANSACTION   AND
237410200423                GIC-INVESTMENT AND lc_PenaltyMethod = lc_MVA  AND
237420200423                ln_freeDollarsUsed > 0
237430200423                  PERFORM WAIVE-MVA-CHARGE
237440200423             END-IF
237450200423      * RFS140721 - End
237460200423             IF WS-DEDUCTION-MODE = "G"
237470200423               ADD WSA-RED-PENALTY
237480200423                             TO WS-BASE-DEDUCTIONS
237490200423             END-IF
237500200423
237510200423             IF WS-DEDUCTION-MODE = "D"
237520200423               ADD WSA-RED-PENALTY
237530200423                             TO WS-D-DEDUCTIONS
237540200423             END-IF
237550200423
237560200423             MOVE "0"        TO WS-TAX-REDE-PLTY-APPLICABLE
237570200423
237580200423           END-IF.
237590200423
237600200423      *END GIC MOD
237610200423
237620200423           IF WS-TAX-DEDUCTION-TYPE = WS-DEDUCTION-MODE
237630200423             IF TAX-ON-GROSS
237640200423               MOVE GROSS-AMT OF TRANS
237650200423                             TO WS-TAXABLE-AMOUNT
237660200423               MOVE ZEROES   TO WS-EST-TAX
23767020042380658          PERFORM ADJUST-RDSP-TAXABLE-AMT
237680200423      * RFS12420 - Begin
237690200423      *        PERFORM GET-TAX-RATE
237700200423               PERFORM SET-TAX-RATE
237710200423136069         PERFORM RDSP-SET-TAX-RATE
237720200423               MOVE WS-IND-RATE-SAV     TO WS-IND-RATE-CHK
237730200423      * RFS12420 - End
237740200423               COMPUTE WS-WORK-TAX-RATE = ((FEDERAL-TAX-RATE
237750200423               OF COUNTRY-WITHHOLDING-TAX + PROVINCIAL-TAX-RATE
237760200423               OF COUNTRY-WITHHOLDING-TAX) / 100)
237770200423
237780200423      *RFS29550 - Begins
237790200423               IF  SPEC-MOD-AUTH-USWT
237800200423               AND USWT-APPLY-TAX
237810200423      *RFS135318 - Begins
237820200423               AND NOT (RDSP-ACCOUNT
237830200423                        AND WS-CURR-CONTR-REDEM-RULE-AHA)
237840200423      *RFS135318 - Ends
237850200423                 COMPUTE WS-WORK-TAX-RATE =
237860200423                   ((FEDERAL-TAX-RATE    OF COUNTRY-WITHHOLDING-TAX
237870200423                   + PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
237880200423                   + WS-USWT-TAX-RATE)
237890200423                   / 100)
237900200423                 IF WS-WORK-TAX-RATE > 1.0000
237910200423                    MOVE "11"  TO REJECTION-CODE OF TRANS
237920200423                    PERFORM RECORD-UPDATES
237930200423                    MOVE 0  TO WS-WORK-TAX-RATE
237940200423                    GO TO EGA-CLEANUP5
237950200423                 END-IF
237960200423               END-IF
237970200423      *RFS29550 - Ends
237980200423
237990200423136069         IF NOT (RDSP-ACCOUNT-RULE
238000200423136069                  AND  WS-CURR-CONTR-REDEM-RULE-DAP)
238010200423               COMPUTE WS-EST-TAX ROUNDED = (WS-TAXABLE-AMOUNT *
238020200423               WS-WORK-TAX-RATE)
238030200423136069         ELSE
238040200423136069           PERFORM CALCULATE-RDSP-EST-TAX
238050200423136069         END-IF
238060200423
238070200423      *RFS24190 - Begins
238080200423               IF NTAXT2062-CALC
238090200423                  PERFORM CALCULATE-NTAXT2062-EST
238100200423               END-IF
238110200423
238120200423               IF NTAXREGSEL-CALC
238130200423                  PERFORM CALCULATE-NTAXREGSEL-EST
238140200423               END-IF
238150200423      *RFS24190 - Ends
238160200423
238170200423               IF WS-TRANS-ADDL-TAX-FOUND = "Y"
238180200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "$"
238190200423      * RFS39003 - Start
238200200423                    SET lb_SetAddFeeYes TO TRUE
238210200423      * RFS39003 - End
238220200423                    IF ADD-REPLACE-TAX = "A"
238230200423                       ADD FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
238240200423                             TO WS-EST-TAX
238250200423                       ADD PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
238260200423                             TO WS-EST-TAX
238270200423                    ELSE
238280200423                       MOVE FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
238290200423                             TO WS-EST-TAX
238300200423                       ADD  PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
238310200423                             TO WS-EST-TAX
238320200423                    END-IF
238330200423                  END-IF
23834020042384482 * Begins: If INPUT-xxx-TAX-AMT > 0, add them
238350200423      * Referring to CALCULATE-TAX-AMOUNT
238360200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "%"
238370200423                     AND ADD-REPLACE-TAX OF TRANS-ADDITIONAL-TAX = "R"
238380200423                    IF INPUT-FEDERAL-TAX-AMT > 0
238390200423                      SET lb_SetAddFeeYes TO TRUE
238400200423                      ADD INPUT-FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
238410200423                       TO WS-EST-TAX
238420200423                    END-IF
238430200423                    IF INPUT-PROVINCIAL-TAX-AMT > 0
238440200423                      SET lb_SetAddFeeYes TO TRUE
238450200423                      ADD INPUT-PROVINCIAL-TAX-AMT
238460200423                          OF TRANS-ADDITIONAL-TAX
238470200423                       TO WS-EST-TAX
238480200423                    END-IF
238490200423                  END-IF
23850020042384482 * Ends
238510200423               END-IF
238520200423
238530200423               IF WS-DEDUCTION-MODE = "G"
238540200423                 ADD WS-EST-TAX
238550200423                             TO WS-BASE-DEDUCTIONS
238560200423               END-IF
238570200423
238580200423               IF WS-DEDUCTION-MODE = "D"
238590200423                 ADD WS-EST-TAX
238600200423                             TO WS-D-DEDUCTIONS
238610200423               END-IF
238620200423
238630200423             END-IF
238640200423           END-IF.
238650200423
238660200423           IF WS-DEDUCTION-MODE = "D"
238670200423
238680200423             COMPUTE WS-SUB-DEDUCTION-NET ROUNDED =
238690200423             WS-CURRENT-RANGE-VALUE-D - WS-D-DEDUCTIONS
238700200423
238710200423             IF WS-SUB-DEDUCTION-NET = WS-BASE-DEDUCTIONS
238720200423                GO TO EGA-END-D
238730200423
238740200423             ELSE
238750200423
238760200423               IF (WS-CURRENT-RANGE-VALUE-D IS EQUAL
238770200423               WS-CURRENT-RANGE-MINIMUM-D)
238780200423               OR (WS-CURRENT-RANGE-VALUE-D IS EQUAL
238790200423               WS-CURRENT-RANGE-MAXIMUM-D)
238800200423                 GO TO EGA-END-D
238810200423               END-IF
238820200423
238830200423      * Am I high or low?
238840200423
238850200423               IF WS-SUB-DEDUCTION-NET IS GREATER THAN
238860200423               WS-BASE-DEDUCTIONS
238870200423               MOVE WS-CURRENT-RANGE-VALUE-D
238880200423                             TO WS-CURRENT-RANGE-MAXIMUM-D
238890200423               ELSE
238900200423                 MOVE WS-CURRENT-RANGE-VALUE-D
238910200423                             TO WS-CURRENT-RANGE-MINIMUM-D
238920200423               END-IF
238930200423
238940200423               IF WS-TAX-DEDUCTION-TYPE = "D"
238950200423                 MOVE ZERO   TO WS-EST-TAX
238960200423               END-IF
238970200423
238980200423               IF WS-CDSC-DEDUCTION-TYPE = "D"
238990200423                 MOVE ZERO  TO WS-CDSC-AMOUNT
239000200423               END-IF
239010200423
239020200423               IF WS-CLAWBACK-DEDUCTION-TYPE = "D"
239030200423                 MOVE ZERO  TO WS-TOTAL-CLAWBACK
239040200423               END-IF
239050200423
239060200423               IF WS-HH-REDFEE-DEDUCTION-TYPE = "D"
239070200423                 MOVE ZERO  TO WS-HH-RED-AMT
239080200423               END-IF
239090200423
239100200423               IF WS-REPMT-RFE-DEDUCTION-TYPE = "D"
239110200423                 MOVE ZERO  TO WSA-REPMT-RED-FEE
239120200423               END-IF
239130200423
239140200423               IF WS-REDE-PLTY-DEDUCTION-TYPE = "D"
239150200423                 MOVE ZERO  TO WSA-RED-PENALTY
239160200423               END-IF
239170200423
239180200423               GO TO EGA-D-START
239190200423
239200200423             END-IF
239210200423
239220200423           END-IF.
239230200423
239240200423           IF WS-DEDUCTION-MODE = "G"
239250200423             IF WS-TAX-DEDUCTION-TYPE IS EQUAL "D"      OR
239260200423                WS-CLAWBACK-DEDUCTION-TYPE IS EQUAL "D" OR
239270200423                WS-CDSC-DEDUCTION-TYPE IS EQUAL "D"     OR
239280200423                WS-HH-REDFEE-DEDUCTION-TYPE IS EQUAL "D" OR
239290200423                WS-REPMT-RFE-DEDUCTION-TYPE IS EQUAL "D" OR
239300200423                WS-REDE-PLTY-DEDUCTION-TYPE IS EQUAL "D"
239310200423               MOVE "D"      TO WS-DEDUCTION-MODE
239320200423               MOVE WS-BASE-DEDUCTIONS
239330200423                             TO WS-CURRENT-RANGE-MINIMUM-D
239340200423
239350200423               COMPUTE WS-CURRENT-RANGE-MAXIMUM-D =
239360200423               WS-BASE-DEDUCTIONS * 4
239370200423               GO TO EGA-D-START
239380200423             END-IF
239390200423           END-IF.
239400200423
239410200423       EGA-END-D.
239420200423      *RFS 7152 BEGIN
239430200423           IF WS-IREDRT-EMPTY IS NOT EQUAL "Y"  AND
239440200423           REDEMPTION-TRANSACTION AND
239450200423      * RFS19733 - Begin
239460200423      *    ((NOT SWITCH-OUT-TRANSACTION) AND
239470200423           (
239480200423      * RFS19733 - End
239490200423           (NOT FEE-TRANSACTION)         AND
239500200423           (NOT REDEMPTION-ADJUSTMENT))
239510200423             PERFORM GET-REDEMPTION-FEE
239520200423           END-IF.
239530200423      *RFS 7152 END
239540200423
2395502004237721       IF  WS-ASL-REDF NOT EQUAL 0
2395602004237721       AND WS-REDEMPTION-FEE EQUAL 0
2395702004237721         COMPUTE WS-REDEMPTION-FEE = WS-REDEMPTION-FEE
2395802004237721                                   + WS-ASL-REDF
2395902004237721       END-IF
239600200423
239610200423           COMPUTE WS-EST-NET = GROSS-AMT OF TRANS - (WS-CDSC-AMOUNT +
239620200423           + WS-TOTAL-CLAWBACK + WS-REDEMPTION-FEE + WS-HH-RED-AMT
239630200423      *RFS 14380 Begin
239640200423           + WS-ERF-CHARGE
239650200423      *RFS 14380 End
239660200423      *RFS 139288Begin
239670200423           + WS-INSURANCE-FEE
239680200423      *RFS 139288End
239690200423      *RFS 19058 Begin
239700200423           + SPONSOR-AMT OF TRANS-COMMISSION
239710200423      *RFS 19058 End
239720200423           + WSA-REPMT-RED-FEE + WSA-RED-PENALTY)
239730200423      * RFS32914 - Start
239740200423           IF lb_SetAddFeeNo
239750200423             IF WS-CDSC-AMOUNT NOT = 0 OR
239760200423             WS-TOTAL-CLAWBACK NOT = 0 OR
239770200423             WS-REDEMPTION-FEE NOT = 0 OR
239780200423             WS-HH-RED-AMT     NOT = 0 OR
239790200423             WS-ERF-CHARGE     NOT = 0 OR
239800200423139288       WS-INSURANCE-FEE  NOT = 0 OR
239810200423             WSA-REPMT-RED-FEE NOT = 0 OR
239820200423             WSA-RED-PENALTY   NOT = 0 OR
239830200423             SPONSOR-AMT OF TRANS-COMMISSION NOT = 0
239840200423               SET lb_SetAddFeeYes TO TRUE
239850200423             END-IF
239860200423           END-IF
239870200423      * RFS32914 - End
239880200423
239890200423
239900200423           IF WS-TAX-DEDUCTION-TYPE IS NOT EQUAL " "
239910200423             IF TAX-ON-NET AND WS-SWITCH-GROSS-MODE IS EQUAL " "
239920200423               MOVE WS-EST-NET TO WS-TAXABLE-AMOUNT
239930200423      *        RFS 80658 - Begins - Change taxable amt for RDSP
239940200423183140         PERFORM CALCULATE-LINKED-INTEREST
239950200423               PERFORM ADJUST-RDSP-TAXABLE-AMT
239960200423      *        RFS 80658 - Ends
239970200423               MOVE ZEROES   TO WS-EST-TAX
239980200423      * RFS12420 - Begin
239990200423      *        PERFORM GET-TAX-RATE
240000200423               PERFORM SET-TAX-RATE
240010200423136069         PERFORM RDSP-SET-TAX-RATE
240020200423               MOVE WS-IND-RATE-SAV     TO WS-IND-RATE-CHK
240030200423      * RFS12420 - End
240040200423               COMPUTE WS-WORK-TAX-RATE = ((FEDERAL-TAX-RATE
240050200423               OF COUNTRY-WITHHOLDING-TAX + PROVINCIAL-TAX-RATE
240060200423               OF COUNTRY-WITHHOLDING-TAX) / 100)
240070200423
240080200423      *RFS29550 - Begins
240090200423               IF  SPEC-MOD-AUTH-USWT
240100200423               AND USWT-APPLY-TAX
240110200423      *RFS135318 - Begins
240120200423               AND NOT (RDSP-ACCOUNT
240130200423                        AND WS-CURR-CONTR-REDEM-RULE-AHA)
240140200423      *RFS135318 - Ends
240150200423                 COMPUTE WS-WORK-TAX-RATE =
240160200423                   ((FEDERAL-TAX-RATE    OF COUNTRY-WITHHOLDING-TAX
240170200423                   + PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
240180200423                   + WS-USWT-TAX-RATE)
240190200423                   / 100)
240200200423                 IF WS-WORK-TAX-RATE > 1.0000
240210200423                    MOVE "11"  TO REJECTION-CODE OF TRANS
240220200423                    PERFORM RECORD-UPDATES
240230200423                    MOVE 0  TO WS-WORK-TAX-RATE
240240200423                    GO TO EGA-CLEANUP5
240250200423                 END-IF
240260200423               END-IF
240270200423      *RFS29550 - Ends
240280200423
240290200423136069         IF NOT (RDSP-ACCOUNT-RULE
240300200423136069                 AND  WS-CURR-CONTR-REDEM-RULE-DAP)
240310200423               COMPUTE WS-EST-TAX ROUNDED = (WS-TAXABLE-AMOUNT *
240320200423               WS-WORK-TAX-RATE)
240330200423136069         ELSE
240340200423136069           PERFORM CALCULATE-RDSP-EST-TAX
240350200423136069         END-IF
240360200423
240370200423      *RFS24190 - Begins
240380200423               IF NTAXT2062-CALC
240390200423                  PERFORM CALCULATE-NTAXT2062-EST
240400200423               END-IF
240410200423
240420200423               IF NTAXREGSEL-CALC
240430200423                  PERFORM CALCULATE-NTAXREGSEL-EST
240440200423               END-IF
240450200423      *RFS24190 - Ends
240460200423
240470200423               IF WS-TRANS-ADDL-TAX-FOUND = "Y"
240480200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "$"
240490200423      * RFS39003 - Start
240500200423                    SET lb_SetAddFeeYes TO TRUE
240510200423      * RFS39003 - End
240520200423                    IF ADD-REPLACE-TAX = "A"
240530200423                       ADD FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
240540200423                             TO WS-EST-TAX
240550200423                       ADD PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
240560200423                             TO WS-EST-TAX
240570200423                    ELSE
240580200423                       MOVE FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
240590200423                             TO WS-EST-TAX
240600200423                       ADD  PROVINCIAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
240610200423                             TO WS-EST-TAX
240620200423                    END-IF
240630200423                  END-IF
24064020042384482 * Begins: If INPUT-xxx-TAX-AMT > 0, add them
240650200423      * Referring to CALCULATE-TAX-AMOUNT
240660200423                  IF SPLIT-OPTION-CODE OF TRANS-ADDITIONAL-TAX = "%"
240670200423                     AND ADD-REPLACE-TAX OF TRANS-ADDITIONAL-TAX = "R"
240680200423                    IF INPUT-FEDERAL-TAX-AMT > 0
240690200423                      SET lb_SetAddFeeYes TO TRUE
240700200423                      ADD INPUT-FEDERAL-TAX-AMT OF TRANS-ADDITIONAL-TAX
240710200423                       TO WS-EST-TAX
240720200423                    END-IF
240730200423                    IF INPUT-PROVINCIAL-TAX-AMT > 0
240740200423                      SET lb_SetAddFeeYes TO TRUE
240750200423                      ADD INPUT-PROVINCIAL-TAX-AMT
240760200423                          OF TRANS-ADDITIONAL-TAX
240770200423                       TO WS-EST-TAX
240780200423                    END-IF
240790200423                  END-IF
24080020042384482 * Ends
240810200423               END-IF
240820200423
240830200423             END-IF
240840200423           END-IF.
240850200423
240860200423      * This logic added for DJT so - GST and PST logic
240870200423      * This applies to fees only and is always based on the net amt
240880200423
240890200423           IF FEE-TRANSACTION
240900200423               MOVE NET-AMT OF TRANS
240910200423                             TO WS-GST-PST-TAX-BASIS
240920200423               PERFORM CALCULATE-GST-PST-AMOUNT
240930200423               COMPUTE WS-EST-NET = WS-EST-NET - (WS-GST-AMOUNT +
240940200423               WS-PST-AMOUNT)
240950200423      * RFS39003 - Start
240960200423                    SET lb_SetAddFeeYes TO TRUE
240970200423      * RFS39003 - End
240980200423           END-IF.
240990200423
241000200423           COMPUTE WS-EST-NET = WS-EST-NET - WS-EST-TAX.
241010200423183140     MOVE WS-EST-TAX TO WS-EST-NR-TAX
241020200423      * RFS32914 - Start
241030200423      *** For Net placed trades only.
241040200423      *** Check if there is a rounding problem with estimated Net Amt.
241050200423      *** after resolving a rounding between Minimum and Maximum.
241060200423      *** If Difference  between Placed Net Amount and Estimated Net
241070200423      *** Amount is less than .03, continue and don't Reject With "29"
241080200423      *** Rejection Code.
241090200423           IF GROSS-OR-NET OF TRANS = "N"  AND lb_SetRejNetNo
241100200423           AND lb_SetAddFeeNo
24111020042366816 *    AND (((WS-EST-NET - NET-AMT OF TRANS < .03) AND
24112020042366816 *           (WS-EST-NET - NET-AMT OF TRANS > 0)  OR
24113020042366816 *         ((NET-AMT OF TRANS - WS-EST-NET < .03) AND
24114020042366816 *         (NET-AMT OF TRANS - WS-EST-NET > 0))))
241150200423             COMPUTE WS-EST-NET = NET-AMT OF TRANS
241160200423             SET lb_SetRejNetYes TO TRUE
241170200423           END-IF.
241180200423      * RFS32914 - End
241190200423
241200200423           IF GROSS-OR-NET OF TRANS = "G"
241210200423           AND WS-SWITCH-GROSS-MODE IS NOT EQUAL "G"
241220200423      * RFS12420 - Begin
241230200423      *      GO TO EGA-CLEANUP
241240200423             GO TO EGA-CLEANUP5
241250200423      * RFS12420 - End
241260200423           END-IF.
241270200423
241280200423      * Bingo - a perfect match!!
241290200423
241300200423      * RFS21258 - Begin
241310200423           IF WS-EST-NET > NET-AMT OF TRANS
241320200423             COMPUTE WS-DIFF-EST-NET = WS-EST-NET - NET-AMT OF TRANS
241330200423           ELSE
241340200423             COMPUTE WS-DIFF-EST-NET = NET-AMT OF TRANS - WS-EST-NET
241350200423           END-IF
241360200423
241370200423           COMPUTE WS-CALC-NET-THRESHOLD ROUNDED = NET-AMT OF TRANS *
241380200423                           WS-APPLY-NET-THRESHOLD-PROC
241390200423           IF WS-CALC-NET-THRESHOLD > WS-MAX-EST-NET-THRESHOLD
241400200423             MOVE WS-MAX-EST-NET-THRESHOLD TO WS-CALC-NET-THRESHOLD
241410200423           END-IF
241420200423      * RFS31294 - Begin:Do not allow threshold to be zero in
241430200423      *   order not to reject the trade.
241440200423          IF WS-CALC-NET-THRESHOLD = 0
241450200423            MOVE lnc_minEstNetThreshold   TO WS-CALC-NET-THRESHOLD
241460200423          END-IF
241470200423      * RFS31294 - End
241480200423      * RFS21258 - End
241490200423
241500200423           IF WS-EST-NET = NET-AMT OF TRANS
241510200423      * RFS21258 - Begin
241520200423                                                  OR
241530200423            (( WS-SWITCH-GROSS-MODE = "G" OR "N" )               AND
241540200423             WS-CURRENT-RANGE-MINIMUM = WS-CURRENT-RANGE-MAXIMUM AND
241550200423             WS-DIFF-EST-NET <= WS-CALC-NET-THRESHOLD)
241560200423      * RFS21258 - End
241570200423      * RFS12420 - Begin
241580200423             IF
241590200423              (WS-IND-RATE-LAST = 0                  OR
241600200423               WS-IND-RATE-CHK  = 0                  OR
241610200423               WS-IND-RATE-CHK  >= WS-IND-RATE-LAST  OR
241620200423               WS-IND-RATE-CHK  = WS-IND-CURR)
241630200423             IF WS-SWITCH-GROSS-MODE IS NOT EQUAL "G"
241640200423               MOVE WS-CURRENT-RANGE-VALUE
241650200423                             TO GROSS-AMT OF TRANS
241660200423               GO TO EGA-CLEANUP5
241670200423             ELSE
241680200423               GO TO EGA-CLEANUP5
241690200423             END-IF
241700200423            ELSE
241710200423             PERFORM SET-RANGE-MIN-MAX
241720200423             ADD 1   TO WS-IND-CURR
241730200423             GO TO EGA-CLEANUP
241740200423            END-IF
241750200423      * RFS12420 - End
241760200423           END-IF.
241770200423
241780200423      * If the search is scoped all the way down - REJECT
241790200423
241800200423           IF  WS-CURRENT-RANGE-MINIMUM IS EQUAL
241810200423               WS-CURRENT-RANGE-MAXIMUM
241820200423      * RFS12420 - Begin
241830200423      *      MOVE "29"   TO REJECTION-CODE OF TRANS
241840200423      *      GO TO EGA-CLEANUP
241850200423             IF (WS-IND-RATE-LAST = 0                  OR
241860200423               WS-IND-RATE-CHK  >= WS-IND-RATE-LAST    OR
241870200423               WS-IND-RATE-CHK  = 0)
241880200423                MOVE "29"   TO REJECTION-CODE OF TRANS
241890200423                GO TO EGA-CLEANUP5
241900200423             ELSE
241910200423                PERFORM SET-RANGE-MIN-MAX
241920200423                ADD 1   TO WS-IND-CURR
241930200423      * RFS14591 - Begin
241940200423                IF WS-IND-CURR > WS-IND-RATE-LAST
241950200423                  MOVE "29"   TO REJECTION-CODE OF TRANS
241960200423                  GO TO EGA-CLEANUP5
241970200423                END-IF
241980200423      * RFS14591 - End
241990200423                GO TO EGA-LOOPUP
242000200423             END-IF
242010200423      * RFS12420 - End
242020200423           END-IF.
242030200423
242040200423      * Am I high or low?
242050200423      * RFS12420 - Begin
242060200423           MOVE NET-AMT   OF TRANS       TO WS-CHK-NET
242070200423           IF
242080200423              (WS-IND-RATE-LAST = 0                  OR
242090200423               WS-IND-RATE-CHK  = 0                  OR
242100200423               WS-IND-RATE-CHK  >= WS-IND-RATE-LAST  OR
242110200423               WS-IND-RATE-CHK  = WS-IND-CURR)
242120200423                MOVE NET-AMT   OF TRANS  TO WS-CHK-NET
242130200423           ELSE
242140200423                EVALUATE TRUE
242150200423                  WHEN WS-IND-RATE-CHK > WS-IND-CURR
242160200423                    MOVE LT-MIN-NET      TO WS-CHK-NET
242170200423                  WHEN WS-IND-RATE-CHK < WS-IND-CURR
242180200423                    MOVE LT-MAX-NET      TO WS-CHK-NET
242190200423                  WHEN OTHER
242200200423                    CONTINUE
242210200423                END-EVALUATE
242220200423           END-IF
242230200423      * RFS12420 - End
242240200423
242250200423           IF WS-SWITCH-GROSS-MODE = "G"
242260200423             IF (NET-AMT OF TRANS + (GROSS-AMT OF TRANS - WS-EST-NET))
242270200423             IS GREATER THAN GROSS-AMT OF TRANS
242280200423
242290200423               IF WS-CURRENT-RANGE-VALUE IS EQUAL
242300200423               WS-CURRENT-RANGE-MAXIMUM
242310200423               AND
242320200423
242330200423      ** Because we are rounding up - if the minimum is the net
242340200423      ** the maximum will never meet i.e a net of 1.00,
242350200423      ** minimum of 1.00 maximum of 1.01 will be 1.00 + 1.01 / 2
242360200423      ** = 1.005 rounded to 1.01.  This logic will force the max
242370200423      ** and min to be equal
242380200423
242390200423               WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-MINIMUM = .01
242400200423                 MOVE WS-CURRENT-RANGE-MINIMUM
242410200423                             TO WS-CURRENT-RANGE-MAXIMUM
242420200423                 GO TO EGA-LOOPUP
242430200423               END-IF
242440200423
242450200423               MOVE WS-CURRENT-RANGE-VALUE
242460200423                             TO WS-CURRENT-RANGE-MAXIMUM
242470200423
242480200423             ELSE
242490200423               MOVE WS-CURRENT-RANGE-VALUE
242500200423                             TO WS-CURRENT-RANGE-MINIMUM
242510200423             END-IF
242520200423           ELSE
242530200423      * RFS12420 - Begin
242540200423      *    IF WS-EST-NET IS GREATER THAN NET-AMT OF TRANS
242550200423           IF WS-EST-NET IS GREATER THAN WS-CHK-NET
242560200423      * RFS12420 - End
242570200423
242580200423             IF WS-CURRENT-RANGE-VALUE IS EQUAL WS-CURRENT-RANGE-MAXIMUM
242590200423             AND
242600200423
242610200423      ** Because we are rounding up - if the minimum is the net
242620200423      ** the maximum will never meet i.e a net of 1.00,
242630200423      ** minimum of 1.00 maximum of 1.01 will be 1.00 + 1.01 / 2
242640200423      ** = 1.005 rounded to 1.01.  This logic will force the max
242650200423      ** and min to be equal
242660200423
242670200423             WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-MINIMUM = .01
242680200423               MOVE WS-CURRENT-RANGE-MINIMUM TO WS-CURRENT-RANGE-MAXIMUM
242690200423               GO TO EGA-LOOPUP
242700200423             END-IF
242710200423
242720200423             MOVE WS-CURRENT-RANGE-VALUE
242730200423                             TO WS-CURRENT-RANGE-MAXIMUM
242740200423
242750200423           ELSE
242760200423
242770200423      * RFS32914 - Start
242780200423      ** Add logic to resolve problem with rounding up here:
242790200423      ** 1. When Curernt Range = Maximum Range and difference between
242800200423      **    Maximum Range and Minimum Range = .01.
242810200423      ** 2.Difference between Maximum Range and Current Range = .01 and
242820200423      **   Difference between Current Range and Minimum Range = .01
242830200423      **   for small amounts less than $20,000.00
242840200423      ** 3.Difference between Maximum Range and Current Range < .03 and
242850200423      **   Difference between Current Range and Minimum Range < .03
242860200423      **   for bigger amounts greater or equal to $20,000.00
242870200423           IF GROSS-OR-NET OF TRANS IS EQUAL "N"
242880200423           AND lb_SetAddFeeNo
242890200423            IF WS-CURRENT-RANGE-VALUE < lnc_RoundRange
242900200423             IF WS-CURRENT-RANGE-VALUE = WS-CURRENT-RANGE-MAXIMUM
242910200423             AND
242920200423             WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-MINIMUM = .01
242930200423              MOVE WS-CURRENT-RANGE-MINIMUM TO WS-CURRENT-RANGE-MAXIMUM
242940200423              GO TO EGA-LOOPUP
242950200423             END-IF
242960200423             IF WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-VALUE = .01
242970200423             AND
242980200423             WS-CURRENT-RANGE-VALUE - WS-CURRENT-RANGE-MINIMUM = .01
242990200423              MOVE WS-CURRENT-RANGE-VALUE   TO WS-CURRENT-RANGE-MAXIMUM
243000200423              MOVE WS-CURRENT-RANGE-VALUE   TO WS-CURRENT-RANGE-MINIMUM
243010200423              GO TO EGA-LOOPUP
243020200423             END-IF
243030200423            ELSE
243040200423             IF WS-CURRENT-RANGE-VALUE = WS-CURRENT-RANGE-MAXIMUM
243050200423             AND
243060200423             WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-MINIMUM = .01
243070200423              MOVE WS-CURRENT-RANGE-MINIMUM TO WS-CURRENT-RANGE-MAXIMUM
243080200423              GO TO EGA-LOOPUP
243090200423             END-IF
243100200423             IF WS-CURRENT-RANGE-MAXIMUM - WS-CURRENT-RANGE-VALUE < .03
243110200423             AND
243120200423             WS-CURRENT-RANGE-VALUE - WS-CURRENT-RANGE-MINIMUM < .03
243130200423              MOVE WS-CURRENT-RANGE-VALUE   TO WS-CURRENT-RANGE-MAXIMUM
243140200423              MOVE WS-CURRENT-RANGE-VALUE   TO WS-CURRENT-RANGE-MINIMUM
243150200423              SET lb_SetRejNetNo TO TRUE
243160200423              GO TO EGA-LOOPUP
243170200423             END-IF
243180200423            END-IF
243190200423           END-IF
243200200423           IF GROSS-OR-NET OF TRANS IS NOT EQUAL "N"
243210200423           OR lb_SetAddFeeYes
243220200423           OR (GROSS-OR-NET OF TRANS IS EQUAL "N"
243230200423           AND (WS-CURRENT-RANGE-VALUE  <  ln_TaxAmtTopGross
243240200423           OR ln_TaxAmtTopGross = 0))
243250200423      * RFS32914 - End
243260200423             MOVE WS-CURRENT-RANGE-VALUE
243270200423                             TO WS-CURRENT-RANGE-MINIMUM
243280200423      * RFS32914 - Start
243290200423           ELSE
243300200423      * RFS46962 - Begin: calculate temporary result
243310200423      *      COMPUTE WS-CURRENT-RANGE-MAXIMUM ROUNDED =
243320200423             COMPUTE ln_tmpRange ROUNDED =
243330200423      * RFS46962 - End
243340200423             ((WS-CURRENT-RANGE-MAXIMUM
243350200423             + WS-CURRENT-RANGE-VALUE) / 2)
243360200423      * RFS46962 - Begin: if result is the same then let old logic work
243370200423             IF ln_tmpRange = WS-CURRENT-RANGE-MAXIMUM
243380200423               MOVE WS-CURRENT-RANGE-VALUE TO
243390200423                                     WS-CURRENT-RANGE-MINIMUM
243400200423             ELSE
243410200423               MOVE ln_tmpRange   TO WS-CURRENT-RANGE-MAXIMUM
243420200423             END-IF
243430200423      * RFS46962 - End
243440200423           END-IF
243450200423      * RFS32914 - End
243460200423
243470200423           END-IF.
243480200423
243490200423       EGA-LOOPUP.
243500200423           MOVE "G"          TO WS-DEDUCTION-MODE.
243510200423           MOVE 0            TO WS-BASE-DEDUCTIONS.
243520200423      * RFS12420 - Begin
243530200423           MOVE "00"         TO REJECTION-CODE OF TRANS
243540200423      * RFS12420 - End
243550200423           GO TO EGA-G-START.
243560200423
243570200423       EGA-CLEANUP.
243580200423      *
243590200423      * RFS12420 - Begin
243600200423      * The miminmizing logic is implemented in previous
243610200423      * paragaphs, while looping through values from Withholding-tax
243620200423      * table.
243630200423      * RFS12420 - End
243640200423      *
243650200423
243660200423      * The following logic is incorporated in order to minimize
243670200423      * the tax when an order is placed net.  Sometimes there is
243680200423      * more than 1 eligible gross that will meet the net requirement
243690200423      * In this event, the gross is stored and a lower tax bracket
243700200423      *(if one exists) is attempted.  The lowest one is the one that
243710200423      *is selected.
243720200423      *
243730200423      * RFS12420 - Begin
243740200423      * ---------------------------------------------------------------
243750200423      * IF THIS IS A POINTER RESET TAX PASS - EXIT
243760200423      *
243770200423      *    IF WS-FINAL-TAX-PASS IS EQUAL "Y"
243780200423      *      GO TO EGA-CLEANUP5
243790200423      *    END-IF.
243800200423      *
243810200423      * BYPASS IF THIS IS NOT A TAXABLE SITUATION
243820200423      *
243830200423           IF WS-IND-CURR > WS-IND-RATE-LAST   OR
243840200423              WS-IND-CURR = 0
243850200423               GO TO EGA-CLEANUP5
243860200423           END-IF
243870200423
243880200423           IF (WS-TAX-DEDUCTION-TYPE IS NOT EQUAL "G") OR
243890200423              (NOT PLACED-NET)                      OR
243900200423      * RFS8517 - start                                                  RFS8517
243910200423              (NOT TAX-ON-GROSS)                    OR                   RFS8517
243920200423      * RFS8517 - end                                                    RFS8517
243930200423              (WS-WORK-TAX-RATE IS EQUAL 0)
243940200423              GO TO EGA-CLEANUP5
243950200423           END-IF.
243960200423
243970200423           GO TO EGA-LOOPUP.
243980200423
243990200423      *
244000200423      * GET OUT IF THE WHOLE RANGE HAS BEEN CHECKED AND REJECTED
244010200423      *
244020200423      *    IF REJECTION-CODE OF TRANS IS EQUAL "29"
244030200423      *      IF WS-TAX-PASS-COUNT IS EQUAL 0
244040200423      *        GO TO EGA-CLEANUP5
244050200423      *      END-IF
244060200423      *    ELSE
244070200423      *      MOVE GROSS-AMT OF TRANS
244080200423      *                      TO WS-GROSS-STORED
244090200423      *      ADD 1           TO WS-TAX-PASS-COUNT
244100200423      *    END-IF.
244110200423      *    READ COUNTRY-WITHHOLDING-TAX PRIOR RECORD
244120200423      *     AT END
244130200423      *     GO TO EGA-CLEANUP1
244140200423      *    END-READ.
244150200423      *
244160200423      *    IF (COUNTRY-CODE OF COUNTRY-WITHHOLDING-TAX
244170200423      *    IS NOT EQUAL COUNTRY-CODE OF INVESTOR)
244180200423      *    OR
244190200423      *      (NOT TAXABLE-PROVINCE AND (PROVINCE-CODE OF
244200200423      *      COUNTRY-WITHHOLDING-TAX IS NOT EQUAL "  " AND
244210200423      *      PROVINCE-CODE OF INVESTOR))
244220200423      *    OR
244230200423      *      (TAXABLE-PROVINCE AND (PROVINCE-CODE OF
244240200423      *      COUNTRY-WITHHOLDING-TAX IS NOT EQUAL "QC" AND "  "))
244250200423      *    OR
244260200423      *      (ACCOUNT-TYPE-CODE OF COUNTRY-WITHHOLDING-TAX
244270200423      *      IS NOT EQUAL ACCOUNT-TYPE-CODE OF ACCOUNT)
244280200423      *    OR
244290200423      *      (CONTR-REDEM-CODE OF COUNTRY-WITHHOLDING-TAX
244300200423      *      IS NOT EQUAL CONTR-REDEM-CODE OF TRANS)
244310200423      *    OR
244320200423      *      (TRANS-TYPE-CODE OF COUNTRY-WITHHOLDING-TAX
244330200423      *      IS NOT EQUAL TRANS-TYPE-CODE OF TRANS)
244340200423      *    OR (TAXABLE-AMT IS LESS THAN NET-AMT OF TRANS)
244350200423      *      GO TO EGA-CLEANUP1
244360200423      *    END-IF.
244370200423      *    MOVE NET-AMT OF TRANS
244380200423      *                      TO WS-CURRENT-RANGE-MINIMUM.
244390200423      *    MOVE TAXABLE-AMT OF COUNTRY-WITHHOLDING-TAX
244400200423      *                      TO WS-CURRENT-RANGE-MAXIMUM.
244410200423      *    MOVE "G"          TO WS-DEDUCTION-MODE.
244420200423      *    MOVE 0            TO WS-BASE-DEDUCTIONS.
244430200423      *    GO TO EGA-G-START.
244440200423
244450200423       EGA-CLEANUP1.
244460200423
244470200423      *    IF GROSS-AMT OF TRANS = WS-GROSS-STORED
244480200423      *      GO TO EGA-CLEANUP5
244490200423      *    END-IF.
244500200423      *
244510200423      *    MOVE WS-GROSS-STORED
244520200423      *                      TO WS-CURRENT-RANGE-MINIMUM
244530200423      *                         WS-CURRENT-RANGE-MAXIMUM.
244540200423      *    MOVE "G"          TO WS-DEDUCTION-MODE.
244550200423      *    MOVE 0            TO WS-BASE-DEDUCTIONS.
244560200423      *    MOVE "Y"          TO WS-FINAL-TAX-PASS
244570200423      *    MOVE "00"         TO REJECTION-CODE OF TRANS
244580200423      *    GO TO EGA-G-START.
244590200423      *
244600200423      * RFS12420 - End
244610200423      * ---------------------------------------------------------------
244620200423      *
244630200423       EGA-CLEANUP5.
244640200423
244650200423           MOVE ZEROES       TO WS-TOTAL-CLAWBACK
244660200423                                WS-CDSC-AMOUNT
244670200423                                WS-HH-RED-AMT
244680200423                                WSA-REPMT-RED-FEE
244690200423                                WSA-RED-PENALTY.
244700200423
244710200423           MOVE WS-PASS-CDSC-CALCULATOR-HOLD
244720200423                             TO PASS-CDSC-CALCULATOR.
24473020042392475      MOVE SPACES TO lc_CalcMode.
244740200423      * RFS24228 - Begin
244750200423      * Set back Internal flag for DSC Calculator
244760200423           SET WS-CDSC-CALCULATOR-INTER-INIT TO TRUE.
244770200423      * RFS24228 - End
244780200423
244790200423       EGA-EXIT.
244800200423           EXIT.
244810200423      * RFS12420 - Begin
244820200423      * ---------------------------------
244830200423       SET-RANGE-MIN-MAX SECTION.
244840200423      * ---------------------------------
244850200423       SRMM-0000.
244860200423           IF WS-SWITCH-GROSS-MODE IS NOT EQUAL "G"
244870200423             MOVE NET-AMT OF TRANS-REC
244880200423                             TO WS-CURRENT-RANGE-MINIMUM
244890200423      * RFS21258 - Begin
244900200423      *      COMPUTE WS-CURRENT-RANGE-MAXIMUM = NET-AMT OF TRANS * 4
244910200423R26987*      COMPUTE WS-CURRENT-RANGE-MAXIMUM = NET-AMT OF TRANS * 12
244920200423R26987       COMPUTE WS-CURRENT-RANGE-MAXIMUM = NET-AMT OF TRANS * 52
244930200423      * RFS21258 - End
244940200423           ELSE
244950200423             MOVE ZERO       TO WS-CURRENT-RANGE-MINIMUM
244960200423             MOVE GROSS-AMT OF TRANS
244970200423                             TO WS-CURRENT-RANGE-MAXIMUM
244980200423           END-IF.
244990200423       SRMM-EXIT.
245000200423            EXIT.
245010200423      * ---------------------------------
245020200423       GET-ALL-TAX-RATE SECTION.
245030200423      * ---------------------------------
245040200423       GATR-0000.
245050200423      *
245060200423      * This section was created to read ALL related data from
245070200423      * withholding table.
245080200423      *
245090200423           INITIALIZE WS1-WITHH-RATES-TABLE
245100200423                      WS-IND-RATE
245110200423
245120200423           SET SW-WITHH-RATES-ALL        TO TRUE
245130200423           PERFORM GET-TAX-RATE
245140200423           SET SW-WITHH-RATES-ONE        TO TRUE
245150200423
245160200423           MOVE WS-IND-RATE              TO WS-IND-RATE-LAST
245170200423      * RFS49699 - Array logging logic
245180200423           IF WS-IND-RATE      > WS-ARRAY1-MAX-USED
245190200423               MOVE WS-IND-RATE            TO WS-ARRAY1-MAX-USED
245200200423           END-IF
245210200423      * RFS49699 - End
245220200423      *
245230200423      * Populate "FROM" range
245240200423      *
245250200423           PERFORM VARYING WS-IND-RATE FROM 1 BY 1 UNTIL
245260200423                   WS-IND-RATE > WS-IND-RATE-LAST
245270200423             IF WS-IND-RATE = 1
245280200423                 MOVE WS1-TAXABLE-AMT-TO (WS-IND-RATE)     TO
245290200423                                  WS1-TAXABLE-AMT-SAV
245300200423             ELSE
245310200423                 MOVE WS1-TAXABLE-AMT-SAV                  TO
245320200423                                  WS1-TAXABLE-AMT-FROM (WS-IND-RATE)
245330200423                 MOVE WS1-TAXABLE-AMT-TO (WS-IND-RATE)     TO
245340200423                                  WS1-TAXABLE-AMT-SAV
245350200423             END-IF
245360200423           END-PERFORM.
245370200423       GATR-EXIT.
245380200423           EXIT.
245390200423      * ---------------------------------
245400200423       SET-CURRENT-WITHH-INDEX SECTION.
245410200423      * ---------------------------------
245420200423       SCWI-0000.
245430200423           INITIALIZE  WS-IND-CURR
245440200423      *
245450200423           PERFORM VARYING WS-IND-RATE FROM 1 BY 1 UNTIL
245460200423                           WS-IND-RATE > WS-IND-RATE-LAST
245470200423             IF  WS-CURRENT-RANGE-MINIMUM <=
245480200423                                   WS1-TAXABLE-AMT-TO (WS-IND-RATE)
245490200423      * RFS139844 - Start
245500200423      *           MOVE WS-IND-RATE   TO WS-IND-CURR
245510200423                  MOVE 1 TO WS-IND-CURR
245520200423      * RFS139844 - End
245530200423                  COMPUTE WS-IND-RATE = WS-IND-RATE-LAST + 1
245540200423             END-IF
245550200423           END-PERFORM.
245560200423      *
245570200423       SCWI-EXIT.
245580200423           EXIT.
245590200423      * ---------------------------------
245600200423       SET-TAX-RATE SECTION.
245610200423      * ---------------------------------
245620200423       STR-0000.
245630200423           INITIALIZE MFACOUWTP OF COUNTRY-WITHHOLDING-TAX
245640200423                      WS-IND-RATE-SAV
245650200423      *
245660200423           PERFORM VARYING WS-IND-RATE FROM 1 BY 1 UNTIL
245670200423                           WS-IND-RATE > WS-IND-RATE-LAST
245680200423             IF WS-TAXABLE-AMOUNT = ZEROES          OR
245690200423               (WS-TAXABLE-AMOUNT >
245700200423                            WS1-TAXABLE-AMT-FROM(WS-IND-RATE)   AND
245710200423                WS-TAXABLE-AMOUNT <=
245720200423                            WS1-TAXABLE-AMT-TO  (WS-IND-RATE))
245730200423                  MOVE WS1-TAXABLE-AMT-TO (WS-IND-RATE)      TO
245740200423                         TAXABLE-AMT      OF COUNTRY-WITHHOLDING-TAX
245750200423                  MOVE WS1-FEDERAL-TAX-RATE (WS-IND-RATE)    TO
245760200423                         FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
245770200423                  MOVE WS1-PROVINCIAL-TAX-RATE (WS-IND-RATE) TO
245780200423                         PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
245790200423      * RFS166873 - Start: use FXTAXPRP when called from REGACCRCON
245800200423                  INITIALIZE pc_FxtaxprpAwdFreq
245810200423                             pc_FxtaxprpAwdStatus
245820200423                             pn_FxtaxprpAwdAmount
245830200423                  IF lb_EditCodeAcwtaxYes
245840200423                    IF PASS-AWD-FREQ-CODE NOT = SPACES AND
245850200423                       PASS-AWD-STATUS    NOT = SPACES
245860200423                      MOVE PASS-AWD-FREQ-CODE TO pc_FxtaxprpAwdFreq
245870200423                      MOVE PASS-AWD-STATUS    TO pc_FxtaxprpAwdStatus
245880200423                      MOVE WS-TAXABLE-AMOUNT  TO pn_FxtaxprpAwdAmount
245890200423                      PERFORM CALL-FXTAXPRP-0
245900200423                      IF pc_FxtaxprpRtnCd = "00"
245910200423                        MOVE pn_FxtaxprpProvTaxRate TO
245920200423                         PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
245930200423                      END-IF
245940200423                    END-IF
245950200423                  END-IF
245960200423      * RFS166873 - End
245970200423      * RFS97248 - Begin: commented out the code
245980200423      * ---------------------------------------------------------------
245990200423      *RFS33578 - Begins
246000200423      *           IF lb_QcWhTaxFunctionYes
246010200423      *              MOVE WS-TAXABLE-AMOUNT  TO pn_FxtaxprpAwdAmount
246020200423      *              PERFORM CALL-FXTAXPRP
246030200423      *              IF lb_QcWhTaxFunctionYes
246040200423      *                 MOVE ln_QcWhTxAwdProvTaxRate
246050200423      *                   TO PROVINCIAL-TAX-RATE OF
246060200423      *                      COUNTRY-WITHHOLDING-TAX
246070200423      *              END-IF
246080200423      *           END-IF
246090200423      *RFS33578 - Ends
246100200423      * ---------------------------------------------------------------
246110200423      * RFS97248 - End
246120200423      *RFS24190 - Begins
246130200423                  IF INCRATCPG-CALC
246140200423                  OR NTAXT2062-CALC
246150200423                  OR NTAXREGSEL-CALC
246160200423                    MOVE WS1-FED-POOLED-TAX-RATE (WS-IND-RATE)
246170200423                      TO FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
246180200423                    MOVE WS1-INCLUSION-RATE (WS-IND-RATE)
246190200423                      TO TAXATION-RATE OF COUNTRY-TAX
246200200423                  ELSE
246210200423                    MOVE ZEROS  TO TAXATION-RATE OF COUNTRY-TAX
246220200423                  END-IF
246230200423      *RFS24190 - Ends
246240200423      * RFS147525 - Start: Waive tax if attribute is set up
246250200423           IF WS_TXWAV_YES
246260200423                  MOVE 0 TO
246270200423                         FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
246280200423                         PROVINCIAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
246290200423           END-IF
246300200423      * RFS147525 - End
246310200423                  MOVE    WS-IND-RATE   TO WS-IND-RATE-SAV
246320200423                  COMPUTE WS-IND-RATE = WS-IND-RATE-LAST + 1
246330200423             END-IF
246340200423           END-PERFORM.
246350200423       STR-EXIT.
246360200423           EXIT.
246370200423      * RFS12420 - END
246380200423      /
246390200423       INITIAL-LOGIC SECTION.
246400200423
246410200423      ******************************************************************
246420200423      *    I N I T I A L   L O G I C   R O U T I N E                   *
246430200423      ******************************************************************
246440200423
246450200423       INL-0000.
246460200423
246470200423      *RFS126482 - START
246480200423            IF pc_PassedFromRDSPPRE NOT = lncc_Y
246490200423               INITIALIZE pi_LDAPPeriods
246500200423                          pi_DTC_BPA
246510200423                          pi_Prov_DTC_BPA
246520200423                          pi_YTDDAPLDAPTaxable
246530200423                          pi_YTDLDAPTaxable
246540200423                          pi_TDTotalDAPLDAP
246550200423                          pi_NonTaxableAmount
246560200423                          pi_CDSPGrantAmount
246570200423                          pi_CDSPBondAmount
246580200423            END-IF.
246590200423      *RFS126482 - END
246600200423      * RFS21772 - Begin
246610200423           ACCEPT WS-LOCAL-DATA-AREA FROM WS-LOCAL
246620200423132956     MOVE " "   TO PASS-WARNING-CODE
246630200423132956     MOVE " "   TO lc_WarningCode
246640200423
246650200423117124     ACCEPT lc_MfaGICParm FROM WS-DTAARA-MFAGICPARM
246660200423117124                          FOR "MFAGICPARM"
246670200423
246680210405      *RFS1111244  - Starts
246690210405           SET lnc_ACINDSCNo   TO TRUE
246700210405      *RFS1111244  - Ends
246710200423      * RFS98866 - Begin
246720200423           IF PASS-CDSC-CALCULATOR = lncc_Y
246730200423             SET PASS-CDSC-CALCULATOR-YES TO TRUE
246740200423           ELSE
246750200423             SET PASS-CDSC-CALCULATOR-NO  TO TRUE
246760200423           END-IF.
246770200423           IF PASS-CDSC-CALCULATOR-YES
246780200423      *      RFS 98866-30037 - Begins
246790200423             CALL "CHKRDSPDAT"
246800200423      *      RFS 98866-30037 - Ends
246810200423             ACCEPT pc_WKRDSPData FROM WS-DTAARA-WKRDSPDATA
246820200423                                    FOR "WKRDSPDATA"
246830200507           END-IF.
246840200507
246850200507      *RFS1020521 START
246860200507           INITIALIZE RDSPCALCPlacementDate
246870200507           INITIALIZE RDSPCALCTransNo
246880200507      *RFS1020521 END
246890200507
246900200423      *    RFS1014281 - Inspect and INITIALIZE - Begins
246910200423           IF pi_RDSPGross            IS NOT NUMERIC
246920200423              INITIALIZE pi_RDSPGross
246930200423           END-IF.
246940200423           IF pi_RDSPTotCapital       IS NOT NUMERIC
246950200423              INITIALIZE pi_RDSPTotCapital
246960200423           END-IF.
246970200423           IF pi_RDSPTotGrant         IS NOT NUMERIC
246980200423              INITIALIZE pi_RDSPTotGrant
246990200423           END-IF.
247000200423           IF pi_RDSPTotMV            IS NOT NUMERIC
247010200423              INITIALIZE pi_RDSPTotMV
247020200423           END-IF.
247030200423           IF pi_RDSPTotBond          IS NOT NUMERIC
247040200423              INITIALIZE pi_RDSPTotBond
247050200423           END-IF.
247060200423           IF pi_RDSPAHAGrant         IS NOT NUMERIC
247070200423              INITIALIZE pi_RDSPAHAGrant
247080200423           END-IF.
247090200423           IF pi_RDSPAHABond          IS NOT NUMERIC
247100200423              INITIALIZE pi_RDSPAHABond
247110200423           END-IF.
247120200423      *    RFS1014281 - Ends
247130200423      * RFS98866 - End
247140200423           MOVE PASS-CDSC-CALCULATOR   TO SW-CALC-NO-UPDATES-FLAG
247150200423
247160200423113784     SET lb_ProcessFirstYes TO TRUE
247170200423113784     INITIALIZE lc_MULTDetailEOF
247180200423126805     MOVE SPACE TO lb_Read_Multi_Flag.
247190200423      *    RFS71433 -Begin
247200200423           INITIALIZE pc_fduArrRec
247210200423
247220200423      *    RFS71433.4 -Begin
247230210527           INITIALIZE ln_fcCntLast
247240200423           PERFORM initFreeDollVariablesAll
247250200423      *    RFS71433.4 -End
247260200423
247270200423      *    RFS71433 -End
247280200423
247290200423      * RFS32409 - Start: need to initialize working storage vars
247300200423           MOVE ZEROES       TO WS-CURR-UNITS-FREE
247310200423                                WS-CURR-UNITS-FREE-AWD
247320200423                                WS-CURR-UNITS-CHRG
247330200423                                WS-CURR-UNITS-BAL
247340200423                                WS-AWD-CHARGABLE-UNITS
247350200423                                WS-CURR-UNITS-MAT
247360200423                                WS-CURR-UNITS-CHRG-TO-CHARGE
247370210527      *RFS1115144 STARTS
247380210527111514     INITIALIZE MFATRNP OF WS-TRANS-REC
247390210527      *RFS1115144 ENDS
247400200423      * RFS32409 - End
247410200423           IF NOT SW-CALC-NO-UPDATES
247420200423      * RFS32409 - Start
247430200423            AND NOT lnc_calcSoa
247440200423      * RFS32409 - End
247450200423      * RFS50832 - Begin
247460200423            AND NOT lnc_calcSoaUpd
247470200423      * RFS50832 - End
247480200423             INITIALIZE      SW-FILES-OPEN-FLAG
247490200423           END-IF
247500200423
247510200423      * RFS72268 - Starts
247520200423           ACCEPT lc_Mfaobjects FROM lc_dtaaraMfaobjects
247530200423                                 FOR "MFAOBJECTS".
247540200423      * RFS96527 - Start
247550200423      * Retrieve Age Restriction Contract Start date from data area
247560200423           INITIALIZE li_Age_Res_Con_St_Date,
247570200423                      lc_Age_Res_Con_St_Date,
247580200423112944                lc_Policy.
247590200423
247600200423           ACCEPT lc_MfaSegParm FROM WS-DTAARA-MFASEGPARM
247610200423                                 FOR "MFASEGPARM"
247620200423           If lc_Age_Res_Con_St_Date not = SPACES
247630200423              MOVE lc_Age_Res_Con_St_Date TO li_Age_Res_Con_St_Date
247640200423           End-If.
247650200423      * RFS96527 - End
247660200423
247670200423           If lc_prvOJLibrary = spaces
247680200423              MOVE lc_OJLibrary TO lc_prvOJLibrary
247690200423           ELSE
247700200423              If lc_prvOJLibrary NOT = lc_OJLibrary
247710200423                 MOVE lc_OJLibrary TO lc_prvOJLibrary
247720200423                 INITIALIZE SW-FILES-OPEN-FLAG
247730200423                 PERFORM closeOpenedCondFiles
247740200423              END-IF
247750200423           END-IF.
247760200423      * RFS72268 - Ends
247770200423
247780200423           IF NOT SW-FILES-OPENED
247790200423      * RFS21772 - End
247800200423      * RFS125258 - Begin
247810200423      *    OPEN    I-O     TRANS-PRIMARY
247820200423      *                    TRANS-EXCHANGE-RATE
247830200423           OPEN    I-O     TRANS-EXCHANGE-RATE
247840200423      * RFS125258 - End
247850200423                           TRANS-DAILY-PROC-SEQ
247860200423                           TRANS-CHARGES
247870200423                           TRANS-COMMISSION
247880200423                           TRANS-INTEREST-DETAILS
247890200423                           TRANS-REDEM-DETAILS
247900200423                           TRANS-ASSIGNMENT
247910200423                           ACCOUNT-INV-ACCRUALS
247920200423      * RFS50832           ACCOUNT-INVESTMENT
247930200423                           ACCOUNT-INVESTMENT-PROC-COUNT
247940200423                           ACCT-INVEST-ACCUM-DIST
247950200423      * RFS50832           TRANS-CDSC-PUR-PRIMARY
247960200423      * RFS50832           TRANS-CDSC-PURCH-REDUCTION
247970200423                           TRANS-OLD-CDSC-REDUCTION
247980200423      * RFS50832           TRANS-CDSC-CLOCK-PRIMARY
247990200423      *RFS 14380 Begin
248000200423                           TRANS-ERF-PURCHASE-PRIMARY
248010200423                           TRANS-ERF-SELL
248020200423      *RFS 14380 End
248030200423      *RFS 25997 Begin
248040200423                           TRANS-LLP-MAX-EXCEED
248050200423      *RFS 25997 End
248060200423      *RFS 18568 BEGIN
248070200423                           TRANS-PAY-TO-CHEQUE
248080200423                           TRANS-PAY-TO-BANK-2
248090200423      *RFS 18568 END
248100200423      *RFS 23020 Begin
248110200423                           INVESTMENT-DISTRIB-CHEQUE
248120200423                           INVESTMENT-DISTRIB-EFT
248130200423                           ACCOUNT-INVESTMENT-DSRP
248140200423      *RFS 23020 End
248150200423                           TRANS-BUY-LSIF-PRIMARY
248160200423                           TRANS-SELL-LSIF-PRIMARY
248170200423                           BATCH-HEADER
248180200423                           TRANS-TARGET
248190200423                           CONTROL-FILE
248200200423                           TRANS-WO-LOCATOR
248210200423                           ACCOUNT-ASSIGNMENT-PRIMARY
248220200423                           ASSET-ALLOCATION-HEADER
248230200423                           TRANS-CONTRACT-DETAILS
248240200423                           ACCOUNT-CONTRACT
248250200423                           ACCOUNT-CONTRACT-INVESTMENT
248260200423                           ACCOUNT-CONTRACT-ANNUITANT
248270200423                           ACCT-INVEST-REDFEE-BASIS-AMT
248280200423                           TRANS-REDFEE-DEP-XFR
248290200423                           TRANS-REDFEE-CALC-DETAILS
24830020042334309                      TRANS-DIST-CNTRY-CODE
248310200423      *GIC MOD
248320200423                           GIC-CERTIFICATE-DETAILS
248330200423                           GIC-TRANS-RELATIONSHIP-PRIMARY
248340200423                           TRANS-GIC-REDEMPTION-DETAILS
248350200423      * RFS40418 - Begin: Open new declared file for I/O-Update
248360200423      *                    GIC-INT-ADJUST-REASON-DETAILS
248370200423                           GIC-INT-ADJUST-REASON-DETUPD
248380200423      * RFS40418 - End
248390200423                           ACCOUNT-INV-REGISTERED
248400200423                           ACCOUNT-FINANCIAL-TOTALS
248410200423      *END GIC MOD
248420200423      *RFS 8058 BEGIN
248430200423      * RFS50832 - Begin: always open and close the files
248440200423      *                    TRANS-CDSC-PUR-SUBDTLS
248450200423      *                    TRANS-CDSC-RED-SUBDTLS
248460200423      *                    ACCOUNT-LEVEL-FREE
248470200423      *                    TRANS-ACCOUNT-LV-DS-DTLS
248480200423      * RFS50832 - End
248490200423      *RFS 8058 END
248500200423      *RFS 7721 BEGIN
248510200423                           ACCOUNT-INV-SWITCH-COUNTER
248520200423                           ACCOUNT-INV-SWO-COUNTER-TRANS
248530200423      *RFS 7721 END
248540200423      *RFS 10575 BEGIN
248550200423      *RFS 8066 BEGIN
248560200423      * RFS50832           ACCOUNT-LV-QUALIFIED
248570200423      *RFS 8066 END
248580200423                           ACCOUNT-RRIF
248590200423                           ACCOUNT-LIF
248600200423      *RFS 13306 BEGIN
248610200423                           TRANS-CONTRACT-TARGET
248620200423      *RFS 13306 END
248630200423R24191                     TRANS-INCLUSION-RATE
248640200423R24190                     TRANS-UNIT-COST
248650200423      * RFS32873 - Begin
248660200423                           clawbackBonusComm
248670200423      * RFS32873 - End
248680200423      *RFS 16941 BEGIN
248690200423      * RFS42278 - Begin
248700200423                           ACCOUNT-INV-MATURITY
248710200423      * RFS114393 - Begin: open the file as input only
248720200423      *                    INVESTMENT-LINK-NOTES
248730200423      * RFS114393 - End
248740200423      * RFS42278 - End
248750200423                           TRANS-ENV-REDEM-XREF
248760200423                           TRANS-ENV-PURCH-XREF
248770200423      *RFS 16941 END
248780200423      *RFS 68035 - Begin
248790200423125258*                    TRANS-RDSP-REPAY
24880020042384456 *                    TRANS-HEADER
248810200423                           TRANS-RDSP-APPROVAL
248820200423                           TRANS-HEADER-2
248830200423      *RFS102421 - Commented Out to open both files below input only
248840200423      *RFS 68035 - End
24885020042386395 *                    TRANS-ASSIGN-LOANID
24886020042386395 *                    ACCOUNT-ASSIGN-LOANID
24887020042384063                      ACCOUNT-FEE-ACCRUAL.
248880200423      *RFS 10575 END
248890200423      * RFS50832 - Begin: always open and close the files
248900200423125258     OPEN I-O        TRANS-PRIMARY
248910200423125258                     TRANS-RDSP-REPAY.
248920200423           OPEN I-O        TRANS-CDSC-PUR-SUBDTLS
248930200423                           TRANS-CDSC-RED-SUBDTLS
248940200423                           ACCOUNT-LEVEL-FREE
248950200423                           TRANS-ACCOUNT-LV-DS-DTLS
248960200423                           ACCOUNT-LV-QUALIFIED
248970200423                           ACCOUNT-INVESTMENT
248980200423                           TRANS-CDSC-PUR-PRIMARY
248990200423                           TRANS-CDSC-PURCH-REDUCTION
249000200423                           TRANS-CDSC-CLOCK-PRIMARY
249010200423      * RFS92504 - Start.
249020200423                           Certificate
249030200423                           Certificate-Primary
249040200423                           Investment-Upd
249050200423106558                     ACCOUNT-LOAN-PRIMARY
249060200423104600                     CONTRACT-CHANGE-LOG
249070200423104600                     INVESTOR-CHANGE-LOG
249080200423112944                     ACCOUNT-MISC-DETAILS
249090200423139288                     Account-Contract-SPIA
249100200426      * RFS185169 - Starts
249110200426                           ACCOUNT-BENEFITS
249120200814186430*                    ACCOUNT-BENEFITS1
249130200426      * RFS185169 - Ends
249140200423110904                     CONTRACT-DATA-LOG.
249150200507      * RFS92504 - End.
249160200423           OPEN INPUT
249170200423      * RFS125258 - Begin.
249180200423                           TRANS
249190200423                           TRANS-PRIMARY-2
249200200423                           TRANS-GIC-CHK
249210200423                           TRANS2
249220200423                           TRANS-VALUE-LOOKUP
249230200423                           TRANS-MFR
249240200423      * RFS125258 - End
249250200423                           TRANS-CDSC-PUR-DIST
249260200423                           TRANS-CDSC-PURCHASE
249270200423                           TRANS-CDSC-CLOCK
249280200423                           TRANS-ADDITIONAL-TAX
249290200423                           ACCOUNT-INVESTMENT-SRCH
249300200423      *RFS92482 - Start
249310200423                           INVESTMENT-ROC-RATES
249320200423                           ROC-TRANS-TYPES
249330200423      *RFS92482 - End
24934020042396530                      GUARANTEED-MAT-VALUE-SCHED
249350200423113784                     MULTI-TRANS-DETAIL
249360200423126805                     MULTI-TRANS-DETAIL-A
249370200423108486                     RDSP-WORKFILE
249380200423      * RFS110904 - Start
249390200423                           ACCOUNT-INVESTMENT2
249391210914      * RFS1117913 - Starts
249392210914                           ACCOUNT-BENEFITS1
249393210914                           ACCOUNT-CONTRACT1
249394210914      * RFS1117913 - Ends
249400200423                           INVESTMENT-STRUCTURE-XREF-2.
249410200423      * RFS110904 - End
249420200423      * RFS50832 - End
249430200423      * RFS21772 - Begin
249440200423           IF NOT SW-FILES-OPENED
249450200423      * RFS21772 - End
249460200423           OPEN    INPUT   ACCOUNT-ASSIGNMENT-PAC
249470200423102421                     TRANS-ASSIGN-LOANID
249480200423102421                     ACCOUNT-ASSIGN-LOANID
249490200423                           BANK-ACCOUNT
249500200423                           BANK
249510200423                           BANK-SCHEDULE
249520200423                           TRANS-PAY-TO-BANK
249530200423125258*                    TRANS
249540200423R27609                     TRANS-BROKER
249550200423                           INVESTOR
249560200423                           ACCOUNT
249570200423      *RFS 14380 Begin
249580200423                           TRANS-ERF-PURCHASE
249590200423      *RFS 14380 End
249600200423      *RFS 18568 BEGIN
249610200423      *RFS 23020 Begin
249620200423      *****                INVESTMENT-DISTRIB-CHEQUE
249630200423      *****                INVESTMENT-DISTRIB-EFT
249640200423      * RFS50832 (comment) ACCOUNT-INVESTMENT-SRCH
249650200423      *RFS 23020 End
249660200423                           INVESTMENT-DISTRIB-DETAILS
249670200423                           PAYMENT-TYPE-CODES
249680200423      *RFS 18568 BEGIN
249690200423      *RFS 15658 Begins
249700200423                           ACCOUNT-2
249710200423      *RFS 15658 Ends
249720200423      * RFS51753 - Begin
249730200423                           BATCH-HEADER-RD
249740200423      * RFS51753 - End
249750200423                           ACCOUNT-NOMINEE
249760200423                           ACCOUNT-ASSIGNMENT
249770200423                           ACCOUNT-ASSIGNMENT-D
249780200423                           INVESTMENT
249790200423      *RFS112133 begin
249800200423                           INVESTMENT-MISC-DETAIL
249810200423                           PRODUCT-TYPE-CODES-2A
249820200423      *RFS112133 end
249830200423      *RFS1008937 - Starts
249840200423                           INVESTMENT-MANAGEMENT-SCHEDULE
249850200423      *RFS1008937 - Ends
249860200423      *RFS 15658 Begins
249870200423                           INVESTMENT-2
249880200423      *RFS 15658 Ends
249890200423                           INVESTMENT-NOTIONAL-DIST-DTLS
249900200423                           INVESTMENT-SWITCHES-CONTROL
249910200423                           INVESTMENT-CDSC-CALC-RULES
249920200423                           INVESTMENT-GROUP
249930200423                           TRANS-TARGET-2
249940200423      * RFS 13829 Begin
249950200423                           TRANS-TARGET-3
249960200423      * RFS 13829 End
249970200423177665                     INVESTMENT-STRUCTURE-FUNCTION
249980200423      * RFS50832 - Begin: always open and close some files
249990200423      *                    TRANS-CDSC-PUR-DIST
250000200423      *                    TRANS-CDSC-PURCHASE
250010200423      * RFS50832 - End
250020200423      * RFS10608 - Begin
250030200423                           TRANS-CDSC-ORIGINAL-DETAILS
250040200423      * RFS10608 - End
250050200423      * RFS50832           TRANS-CDSC-CLOCK
250060200423                           TRANS-COMMISSION-2
250070200423                           TRANS-DISTR-DETAILS
250080200423                           TRANS-REDEM-DETAILS
250090200423                           TRANS-TARGET-SPOT-RATE
250100200423      * RFS50832 (Commented) TRANS-ADDITIONAL-TAX
250110200423      * RFS 12261 BEGIN
250120200423      * RFS20711 - Begin
250130200423      * ---------------------------------
250140200423      *                    GIC-TRANS-FILE
250150200423      *                    GIC-TRANS-RELT-FILE
250160200423      * ---------------------------------
250170200423      * RFS20711 - End
250180200423      * RFS 12261 END
250190200423                           CDSC-REDEM-RATE-SCHEDULE
250200200423                           CDSC-SCHEDULE-OLD
250210200423                           COMM-SPONSOR-RATE-SCHED
250220200423                           COUNTRY-WITHHOLDING-TAX
250230200423                           EXCHANGE-RATE-HISTORY
250240200423                           INVESTMENT-UNIT-PRICE
250250200423                           DEALER
250260200423      *RFS20311 Start
250270200423                           DEALER-REP
250280200423      *RFS20311 End
250290200423                           DEALER-STATUS
250300200423                           INVESTMENT-FINANCER
250310200423                           FINANCER-SCHED
250320200423                           FINANCER-SCHED-2
250330200423                           FINANCER-FINANCER-SCHEDULE
250340200423                           FINANCER-SUB-ADVISOR
250350200423                           FINANCER-CDSC-INSTRUCTIONS
250360200423125258*                    TRANS-PRIMARY-2
250370200423                           TRANS-ASSET-ALLOC-HEADER
250380200423                           TRANS-ALLOCATION-POINTER
250390200423                           TRANS-ALLOCATION-POINTER-A
250400200423                           TRANS-BUY-LSIF
250410200423                           TRANS-BUY-LSIF-CHK
250420200423                           PRODUCT-TYPE-CODES
250430200423      * RFS 15658 Begins
250440200423                           PRODUCT-TYPE-CODES-2
250450200423      * RFS 15658 Ends
250460200423                           DISCOUNT-ACCRUAL-RATES
250470200423                           INVESTMENT-DAF-RATE
250480200423                           BUSINESS-DAYS
250490200423                           PROGRAM-EXCHANGE-RATE
250500200423                           TRANS-LSIF-WAIVE-CLAWBACK
250510200423      *RFS 16760 Begin (Remove old versions of LSIF files)
250520200423      *                    LSIF-WAIVE-CLAWBACK-DFT
250530200423      *                    LSIF-WAIVE-CLAWBACK
250540200423      *                    LSIF-TAX-CREDIT-FACTORS
250550200423                           LSIF-CLAWBACK-CODES-DFT
250560200423                           LSIF-CLAWBACK-CODES
250570200423                           LSIF-TAX-CREDIT-PARMS
250580200423                           INVESTMENT-LSIF-JURISDICTIONS
250590200423                           TRANS-BUY-LSIF2
250600200423      *RFS 16760 End
250610200423      * RFS16590 Start
250620200423                           TRANS-SELL-LSIF-IDX2
250630200423      * RFS16590 End
250640200423                           ACCOUNT-CONT-AGE
250650200423                           DEPOSIT-MAT-LEN-SCHED
250660200423                           CONTRACT-STATUS-SCHED
250670200423                           INVESTMENT-SEG
250680200423                           DEALER-MISC-DETAILS
250690200423                           DEALER-REP-PROV-LICENSE
250700200423      *RFS 7947 BEGIN
250710200423                           DEALER-PROV-LICENSE
250720200423      *RFS 7947 END
250730200423      *RFS 9092 BEGIN
250740200423      * RFS50832 (comment) ACCOUNT-INVESTMENT2
250750200423                           INVESTMENT-STRUCTURE-XREF
250760200423117763                     INVESTMENT-STRUCT-XREF-STR
250770200423      *RFS 9092 END
250780200423                           NOMINEE-MISC-DETAILS
250790200423                           NOMINEE-FILE
250800200423                           ACCOUNT-ANNUITANT-DEFAULT
250810200423                           CONTRACT-MATURITY-AGE
250820200423                           TRANS-SALES-TAX-DETAILS
250830200423                           TRANS-TYPE-SALES-TAX
250840200423                           INVESTMENT-REDEM-FEE-SCHED
250850200423                           REDEM-FEE-RATE-SCHED-DTL
250860200423                           REDEM-FEE-RATE-SCHED-HEADER
250870200423      *GIC MOD
250880200423                           BATCH-TYPE-CODES
250890200423                           REJECTION-CODES
250900200423                           GIC-CRT-STATUS-CODES
250910200423                           GIC-CLOSING-REASONS
250920200423      * RFS40418 - Begin
250930200423                           GIC-INT-ADJUST-REASON-DETAILS
250940200423      * RFS40418 - End
250950200423113773                     INVESTMENT-GIC-DETAILS
250960200423125258*                    TRANS-GIC-CHK
250970200423140269                     SORTED-GTR
250980200423                           GIC-TRANS-RELATIONSHIP
250990200423                           SCREEN-EDITS-ALLOWED
251000200423      *END GIC MOD
251010200423      *RFS 7152 START
251020200423                           INVESTMENT-REDEM-RATE
251030200423      *RFS 7152 END
251040200423      *RFS 7390 START
251050200423                           CONTR-REDEM-CODE-RULES
251060200423      *RFS 7390 END
251070200423
251080200423      *RFS 9859 START
251090200423                           FUNCTION-INV-STRUCTURE-XREF
251100200423      *RFS 9859 END
251110200423      *RFS 4637 START
251120200423                           ACCOUNT-CONTRACT-INV-DIST-BAL
251130200423                           ACCOUNT-CONTRACT-INV-DIST-BAL2
251140200423                           ACCOUNT-CONTRACT-INVESTMENT2
251150200423      *RFS 13306 BEGIN
251160200423125258*                    TRANS2
251170200423                           ACCOUNT2
251180200423                           ACCOUNT-NOMINEE2
251190200423                           ACCOUNT-CONTRACT2
251200200423                           TRANS-CONTRACT-DETAILS2
251210200423      *RFS 13306 END
251220200423      *RFS 8058
251230200423                           ACCOUNT-TYPE-PERCENT-FREE
251240200423                           FINANCER-PERCENT-FREE
251250200423                           INVESTMENT2
251260200423                           INVESTMENT-LAST-UNIT-PRICE
251270200423                           INVESTMENT-UNIT-PRICE2
251280200423125258*                    TRANS-VALUE-LOOKUP
25129020042334309                      TRANS-RESP-DETAILS
25130020042334309                      ACCOUNT-BENEFICIARY-SPLIT
25131020042334309                      ACCOUNT-BENEFICIARY
25132020042334309                      ADDRESS-DDS
251330200423      * RFS10040 - Begin
251340200423                           DEALER-COMMISSIONS
251350200423      * RFS10040 - End
251360200423      *RFS 10575 BEGIN
251370200423                           ACCOUNT-TYPE
251380200423      * RFS52816 - Begin
251390200423                           ACCOUNT-TYPE-NOMINEE
251400200423      * RFS52816 - End
251410200423                           TRANS-DIST-COUNTRY-CODES
251420200423      *RFS 10575 END
251430200423      *RFS 10826 BEGIN
251440200423                           REVERSAL-REASON
251450200423      *RFS 10826 END
251460200423      *RFS 7721 BEGIN
251470200423                           ALLOWABLE-SWO-LIMIT-CODES
251480200423                           ACCT-INV-SWO-CNTER-HIGHEST
251490200423                           INVESTMENT-STR-ALLW-SWO-LIMIT
251500200423      *RFS 7721 END
251510200423      *RFS 13306 BEGIN
251520200423                           SEG-SWITCH-TRF-OPT
251530200423      *RFS 13306 END
251540200423      *RFS 16941 BEGIN
251550200423                           TRANSFER-VALID-ENVIRONMENTS
251560200423      *RFS 16941 END
251570200423      *RFS 20265 BEGIN
251580200423                           LSIF-TAX-CREDIT-PARMS-2
251590200423                           FORMS-TRANS-XREF
251600200423                           ACCOUNT-ISSUED-FORMS
251610200423                           LSIF-TAX-CREDITS-ALLOWED
251620200423                           FORM-REQUEST
251630200423                           FORM-REQUEST-CONTR-REDEM
251640200423      *RFS 20265 END
251650200423      * RFS92475 - Start.
251660200423                           FEE-EXCLUSIONS
251670200423      * RFS92475 - End.
25168020042352265                      TRANS-TYPE-EXEMPTION-RULES
25169020042326151                      EXCLUDE-TRANS
251700200423R24191                     COUNTRY-TAX
251710200423R24190                     ACCTYP-CONTRED-TXNTYP-TAXEV
251720200423      *RFS 14380 BEGIN
251730200423                           INVESTMENT-ERF-SCHEDULE
251740200423                           EARLY-REDEMPTION-FEE-SCHEDULE
251750200423                           ERF-SCHEDULE
251760200423R29134                     ERF-SCHEDULE-2
251770200423R29134                     INVESTMENT-ERF-SCHEDULE-2
251780200423R30134                     Trans-Trade-Codes
25179020042344930                      GUARANTEED-DEATH-VALUE-SCHED
25180020042344930                      TRANS-ANNUITANT-AGE-LIMIT
251810200423R45781                     TRANS-MISC-DETAILS
251820200423R45781                     INVESTMENT-PLAN-TRANS-MIN
251830200423R59853                     ACCOUNT-ATTRIBUTES
251840200423138805                     TERM-DEPOSIT-TRANSACTIONS
251850200423138805                     TERM-DEPOSIT-INSTRUCTIONS
251860200423      * RFS114393 - Begin: open the file as input only
251870200423                           INVESTMENT-LINK-NOTES
251880200423      * RFS114393 - End
251890200423125258*                    TRANS-MFR
25190020042392145                      TRANS-TARGET-MFR
251910200423      * RFS 114854 BEGIN
251920200423      *                   TRANS-REDEMPTION-DETAILS.
251930200423                          TRANS-REDEMPTION-DETAILS
251940200423      * RFS138945 - Start
251950200423      *                   INVESTOR-ATTRIBUTES.
251960200423                          INVESTOR-ATTRIBUTES
251970200423166267*                   INVESTMENT-DOLLAR-TRACK.
251980200423166267                    INVESTMENT-DOLLAR-TRACK
251990200423166267                    INVESTMENT-SERIESID.
252000200423      *RFS145358 - Start
252010200423      *     PERFORM GetInvDolSetup.
252020200423            PERFORM GetInvDolSetup THRU Gids-Exit.
252030200423      *RFS145358 - End
252040200423
252050200423      * RFS138945 - End
252060200423      * RFS 114854 END
252070200423      *RFS 14380 END
252080200423      *RFS 8058 END
252090200423
252100200423      * RFS21772 - Begin
252110200423           IF NOT SW-FILES-OPENED
252120200423      * RFS21772 - End
252130200423R24192       OPEN EXTEND     ACCOUNT-CONTRACT-INV-DIST-BAL3
252140200423R24192                       NOTIONAL-DIST-NR-ERROR
252150200423R24192     END-IF.
252160200423      *RFS 4637 END
252170200423
252180200423      * RFS102122 - begins.
252190200423      * RFS92475 - Start.
252200200423           IF NOT SW-FILES-OPENED
252210200423              SET Lb-EOF-FeeExc-No TO TRUE
252220200423              INITIALIZE Lr-Fee-Exclusions-Array
252230200423
252240200423              SET CRRIDX TO 1
252250200423              SET CRRIDX DOWN BY 1
252260200423              MOVE  1    TO ln_Array-Size
252270200423              PERFORM Read-Fee-exclusions UNTIL Lb-EOF-FeeExc-Yes
252280200423      * RFS92475 - End.
252290200423
252300200423      * RFS 52265 - begins.
252310200423              SET Lb-EOF-TrnExempt-No TO TRUE
252320200423              INITIALIZE Lr-Trans-Type-Exemption-Array
252330200423
252340200423              SET TRNIDX TO 1
252350200423              SET TRNIDX DOWN BY 1
252360200423              MOVE  1    TO ln_TrnExemptArray-Size
252370200423              PERFORM Read-Trans-Type-Exemption
252380200423                      UNTIL Lb-EOF-TrnExempt-Yes
252390200423           END-IF.
252400200423      * RFS 52265 - ends.
252410200423      * RFS102122 - ends.
252420200423
252430200423R92156     INITIALIZE MFATRNRDP OF TRANS-CDSC-PURCH-REDUCTION.
252440200423136956     INITIALIZE MFATRRSDP OF TRANS-CDSC-RED-SUBDTLS.
252450201223      * RFS185174 - Start: Initialize record
252460201223           INITIALIZE MFATRALVP.
252470201223      * RFS185174 - End
252480200423      * RFS21772 - Begin
252490200423      * Use Optimization for openning files only when
252500200423      * SW-CALC-NO-UPDATES is TRUE.
252510200423           IF SW-CALC-NO-UPDATES
252520200423      * RFS32409 - Start
252530200423            OR lnc_calcSoa
252540200423      * RFS32409 - End
252550200423      * RFS50832 - Begin
252560200423            OR lnc_calcSoaUpd
252570200423      * RFS50832 - End
252580200423             SET             SW-FILES-OPENED TO TRUE
252590200423           END-IF
252600200423      * RFS21772 - End
252610200423
252620200423           MOVE LOW-VALUES             TO  CURR-CONTROLS.
252630200423
252640200423      *RFS17685 Start
252650200423           ACCEPT PROCESS-DATE-DATA-AREA FROM WS-DTAARA-MFAPRCDTP
252660200423                                                 FOR "MFAPRCDTP".
252670200423      *RFS17685 End
252680200423      * RFS21772 - Begin
252690200423      * These code was moved up
252700200423      *    ACCEPT WS-LOCAL-DATA-AREA FROM WS-LOCAL.
252710200423      * RFS21772 - End
252720200423           ACCEPT WS-SYSTIM          FROM  TIME.
252730200423104600     MOVE ZEROES              TO WS-SYSDATE.
252740200423   |       MOVE ZEROES              TO WS-SYSTIME.
252750200423   |       ACCEPT WS-SYSTIME         FROM  TIME.
252760200423104600     ACCEPT WS-SYSDATE FROM DATE YYYYMMDD.
252770200423      * RFS59842 - Begin
252780200423           CALL "FXTFSADAT" USING pi_TFSAAge
252790200423                                  pi_TFSAEffectiveDate
252800200423                                  pc_ReturnCd.
252810200423           MOVE pi_TFSAEffectiveDate
252820200423             TO li_TFSAEffectiveDate.
252830200423      * RFS59842 - End
252840200423           MOVE ZEROES       TO ACCOUNT-NO OF ACCOUNT
252850200423                                INVESTOR-NO OF INVESTOR.
252860200423
252870200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "Y" AND "U" AND "D"
252880200423           AND "A" AND "I" AND "F" AND "M" AND "R" AND "N"
252890200423           AND "X" AND "W" AND "Z" AND "V" AND "T"
252900200423      *GIC MOD
252910200423           AND "Q" AND "G" AND "H" AND "K" AND  "J" AND "L"
252920200423      *END GIC MOD
252930200423      * RFS 17019 Begin
252940200423           AND "B"
252950200423      * RFS 17019 End
252960200423      * RFS21772 - Begin
252970200423           AND "1"
252980200423      * RFS21772 - End
252990200423      * RFS35865 - Begin
253000200423           AND "E"
253010200423      * RFS35865 - End
253020200423      * RFS32409 - Start
253030200423           AND "2"
253040200423      * RFS32409 - End
253050200423      * RFS50832 - Start
253060200423           AND "3"
253070200423      * RFS50832 - End
253080200423      * RFS 47405 - Begin
253090200423           AND "O"
253100200423      * RFS 47405 - End
253110200423      *RFS163650 AUTO SWITCH MOD
253120200423           AND "S"
253130200423      *RFS163650 END
253140200423             MOVE HIGH-VALUES
253150200423                             TO CURR-CONTROLS
253160200423             GO TO INL-CLOSE
253170200423           END-IF.
253180200423
253190200423      ** MULTI LOCK MOD
253200200423           IF PASS-DQ-INDICATOR(1:1) = "Q"
253210200423             MOVE "Y"        TO  WS-ACCEPT-FROM-DQ
253220200423             MOVE PASS-DQ-LIB
253230200423                             TO  DATA-I-LIBRARY
253240200423             STRING "TXINPUT" DELIMITED BY SIZE,
253250200423             PASS-DQ-INDICATOR(2:2) DELIMITED BY SIZE
253260200423             INTO DATA-I-NAME
253270200423           END-IF.
253280200423
253290200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL "Y"
253300200423      * RFS21772 - Begin
253310200423              AND NOT SW-CALC-NO-UPDATES
253320200423      * RFS21772 - End
253330200423      * RFS32409 - Start
253340200423              AND NOT lnc_calcSoa
253350200423      * RFS32409 - End
253360200423      * RFS50832 - Begin
253370200423              AND NOT lnc_calcSoaUpd
253380200423      * RFS50832 - End
253390200423             MOVE "PSQ#"     TO CONTROL-CODE OF CONTROL-FILE
253400200423      * RFS20711 - Begin (Replaced "READ   " with "PERFORM ...")
253410200423             MOVE "CONTROL FILE PSQ"   TO WS-TEMP-STR
253420200423             PERFORM READ-CONTROL-FILE                                  RFS9530
253430200423             IF WS-FILE-STATUS = LT-ERR-REC-NOT-EXISTS
253440200423               DISPLAY "INL ERROR - CONTROL FILE READ"
253450200423               STOP RUN
253460200423             END-IF
253470200423      * RFS20711 - End
253480200423
253490200423      *RFS1000550 START - Check if PSQ# already inc. by 3000000
253500200423      *      MOVE NEXT-NUMBER OF CONTROL-FILE
253510200423      *                      TO WS-CONTROL-COUNT
253520200423            IF NEXT-NUMBER OF CONTROL-FILE  >= 3000000
253530200423               PERFORM REWRITE-CONTROL-FILE
253540200423            ELSE
253550200423      *RFS1000550 END
253560200423
253570200423      * RFS20711 - Begin (Replaced "REWRITE" with "PERFORM ...")
253580200423             ADD 3000000     TO NEXT-NUMBER OF CONTROL-FILE
253590200423             PERFORM REWRITE-CONTROL-FILE                               RFS9530
253600200423             IF WS-FILE-STATUS = LT-ERR-DUPLICATE
253610200423               DISPLAY "INL ERROR - CONTROL FILE REWRITE"
253620200423               STOP RUN
253630200423             END-IF
253640200423100055      END-IF
253650200423      * RFS20711 - End
253660200423           END-IF.
253670200423
253680200423      ** MULTI LOCK MOD END
253690200423
253700200423           IF PASS-CDSC-CALCULATOR IS EQUAL "Y"
253710200423      * RFS32409 - Start
253720200423              OR lnc_calcSoa
253730200423      * RFS32409 - End
253740200423      * RFS50832 - Begin
253750200423              OR lnc_calcSoaUpd
253760200423      * RFS50832 - End
253770200423      * RFS13839 - Begin
253780200423      *      CALL "SETCALCENV"
253790200423      * RFS13839 - End
253800200423             OPEN EXTEND DSC-CALC-FILE
253810200423      *RFS11905 Begin
253820200423      * RFS32409 - Start: for soa only not acc level is working
253830200423      * RFS50832 - Begin: commented the condition below -
253840200423      *      IF NOT lnc_calcSoa
253850200423      * RFS50832 - End
253860200423      * RFS32409 - End
253870200423               OPEN EXTEND DSC-CALC-FILE2
253880200423      * RFS32409 - Start
253890200423      * RFS50832 - Begin: commented END-IF
253900200423      *      END-IF
253910200423      * RFS50832 - End
253920200423      * RFS32409 - End
253930200423      *RFS11905 End
253940200423             MOVE "Y"        TO WS-CALC-FILE-WRITE
253950200423      * RFS13839 - Begin
253960200423             SET SW-DSC-OPENED     TO TRUE
253970200423      * RFS13839 - End
253980200423           END-IF.
253990200423
254000200423      **   DETERMINE EXCHANGE-RATE TO BE USED FOR SWITCH OUT
254010200423
254020200423           MOVE "TRNPST"       TO PROGRAM-CODE
254030200423                               OF PROGRAM-EXCHANGE-RATE.
254040200423           MOVE "SWO/TRO"      TO PROGRAM-ACTION
254050200423                               OF PROGRAM-EXCHANGE-RATE.
254060200423           READ PROGRAM-EXCHANGE-RATE
254070200423           INVALID KEY
254080200423             MOVE HIGH-VALUES  TO CURR-CONTROLS
254090200423             GO TO INL-CLOSE
254100200423           END-READ.
254110200423
254120200423           MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-RATE
254130200423                               TO WS-EXCHANGE-RATE-TYPE1.
254140200423
254150200423      **   DETERMINE EXCHANGE-RATE TO BE USED FOR SWITCH IN
254160200423
254170200423           MOVE "TRNPST"       TO PROGRAM-CODE
254180200423                               OF PROGRAM-EXCHANGE-RATE.
254190200423           MOVE "SWI/TRI"      TO PROGRAM-ACTION
254200200423                               OF PROGRAM-EXCHANGE-RATE.
254210200423
254220200423           READ PROGRAM-EXCHANGE-RATE
254230200423           INVALID KEY
254240200423             MOVE HIGH-VALUES  TO CURR-CONTROLS
254250200423             GO TO INL-CLOSE
254260200423           END-READ.
254270200423
254280200423           MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-RATE
254290200423                               TO WS-EXCHANGE-RATE-TYPE1A.
254300200423
254310200423      **   DETERMINE EXCHANGE-RATE TO BE USED FOR PROCESSING - TAX
254320200423
254330200423           MOVE "TRNPST"       TO PROGRAM-CODE
254340200423                               OF PROGRAM-EXCHANGE-RATE.
254350200423           MOVE "TAXCALC"      TO PROGRAM-ACTION
254360200423                               OF PROGRAM-EXCHANGE-RATE.
254370200423
254380200423           READ PROGRAM-EXCHANGE-RATE
254390200423           INVALID KEY
254400200423             MOVE HIGH-VALUES  TO CURR-CONTROLS
254410200423             GO TO INL-CLOSE
254420200423           END-READ.
254430200423
254440200423           MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-RATE
254450200423                               TO WS-EXCHANGE-RATE-TYPE2.
254460200423      **   END EXCHANGE-RATE
254470200423
254480200423      * RFS92499 - Start / 101832
254490200423      **   Exchange Rate Type for Payment Currency
254500200423           MOVE "DLYCHQ"       TO PROGRAM-CODE
254510200423                               OF PROGRAM-EXCHANGE-RATE.
254520200423           MOVE "CAD/USD"      TO PROGRAM-ACTION
254530200423                               OF PROGRAM-EXCHANGE-RATE.
254540200423           READ PROGRAM-EXCHANGE-RATE
254550200423           INVALID KEY
254560200423             CONTINUE
254570200423             NOT INVALID KEY
254580200423             MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-RATE
254590200423                               TO lc-ExchangeRateTypeUSD
254600200423           END-READ.
254610200423           MOVE "DLYCHQ"       TO PROGRAM-CODE
254620200423                               OF PROGRAM-EXCHANGE-RATE.
254630200423           MOVE "USD/CAD"      TO PROGRAM-ACTION
254640200423                               OF PROGRAM-EXCHANGE-RATE.
254650200423           READ PROGRAM-EXCHANGE-RATE
254660200423           INVALID KEY
254670200423             CONTINUE
254680200423             NOT INVALID KEY
254690200423             MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-RATE
254700200423                               TO lc-ExchangeRateTypeCAD
254710200423           END-READ.
254720200423      * RFS92499 - End
254730200423
254740200423           CALL "RTVCMPCD" USING MANAGEMENT-CO-CATAGORY.
254750200423           CANCEL "RTVCMPCD".
254760200423           CALL "RTVTAXFLG" USING WS-TAX-MODE.
254770200423           CANCEL "RTVTAXFLG".
254780200423
254790200423      * RFS17180 - Begin
254800200423           INITIALIZE               CPWSYSPARM-LINKAGE.
254810200423           CALL "RTVSYSPARM"        USING CPWSYSPARM-LINKAGE.
254820200423      * RFS17180 - End
254830210720      * RFS186019- Start
254840210720           INITIALIZE               lc_REGR_ACCR.
254850210720           MOVE CPWSYSPARM-LINKAGE(1185:1) TO lc_REGR_ACCR.
254860210720      * RFS186019- End
254870200423
254880200423      * RFS20883 - Begin
254890200423           CALL "RTVAAPHLD"         USING WS-GEN-TRADES-ON-HLD-FLAG.
254900200423      * RFS20883 - End
254910200423
254920200423      * RFS5512 - Begin
254930200423           CALL "RTVREMTHR"         USING WS-REMAINING-BAL-THRESHOLD-X
254940200423           IF WS-REMAINING-BAL-THRESHOLD IS NOT NUMERIC
254950200423             INITIALIZE WS-REMAINING-BAL-THRESHOLD
254960200423           END-IF
254970200423           COMPUTE WS-REMAINING-BAL-THRESHOLD-MIN =
254980200423                   WS-REMAINING-BAL-THRESHOLD * LT-MINUS-ONE
254990200423      * RFS5512 - End
255000200423
255010200423      * RFS17813 - Begin
255020200423           PERFORM GET-BASE-CURRENCY
255030200423      * RFS17813 - End
255040200423
255050200423           IF WS-TAX-MODE IS NOT EQUAL "N" AND "G"
255060200423             MOVE "G"        TO WS-TAX-MODE
255070200423           END-IF.
255080200423
255090200423      *RFS 7152 START
255100200423           MOVE "N"          TO WS-IREDRT-EMPTY.
255110200423           READ INVESTMENT-REDEM-RATE LAST RECORD
255120200423           AT END
255130200423             MOVE "Y"        TO WS-IREDRT-EMPTY
255140200423           END-READ.
255150200423
255160200423           IF WS-FILE-STATUS IS NOT EQUAL "00"
255170200423             MOVE "N"        TO WS-IREDRT-EMPTY
255180200423           END-IF.
255190200423
255200200423      *RFS 7152 END
255210200423      *GIC MOD
255220200423           MOVE "3"          TO CERT-RULE
255230200423                             OF GIC-CRT-STATUS-CODES.
255240200423
255250200423           READ GIC-CRT-STATUS-CODES
255260200423           INVALID KEY
255270200423             MOVE SPACES     TO WS-CERT-STATUS-CODE-CLOSE
255280200423           NOT INVALID KEY
255290200423             MOVE CERT-STATUS-CODE OF GIC-CRT-STATUS-CODES
255300200423                             TO WS-CERT-STATUS-CODE-CLOSE
255310200423           END-READ.
255320200423
255330200423           MOVE "1"          TO CERT-RULE
255340200423                             OF GIC-CRT-STATUS-CODES.
255350200423
255360200423           READ GIC-CRT-STATUS-CODES
255370200423           INVALID KEY
255380200423             MOVE SPACES     TO WS-CERT-STATUS-CODE-ACTIVE
255390200423           NOT INVALID KEY
255400200423             MOVE CERT-STATUS-CODE OF GIC-CRT-STATUS-CODES
255410200423                             TO WS-CERT-STATUS-CODE-ACTIVE
2554202004237858         MOVE SPACES     TO WS-CLOSING-REASON
255430200423           END-READ.
255440200423
2554502004237858       IF WS-CERT-STATUS-CODE-CLOSE EQUAL "C"
2554602004237858       MOVE "2"    TO CLOSING-REASON-RULE
2554702004237858                         OF GIC-CLOSING-REASONS
2554802004237858
2554902004237858       READ GIC-CLOSING-REASONS
2555002004237858       INVALID KEY
2555102004237858         MOVE SPACES     TO WS-CLOSING-REASON
2555202004237858       NOT INVALID KEY
2555302004237858         MOVE CLOSING-REASON-CODE OF GIC-CLOSING-REASONS
2555402004237858                         TO WS-CLOSING-REASON
2555502004237858       END-READ
2555602004237858       END-IF.
255570200423
255580200423      *RFS7390 BEGIN
255590200423
255600200423           IF WS-CERT-STATUS-CODE-CLOSE EQUAL "C"
255610200423             MOVE "5"    TO CLOSING-REASON-RULE
255620200423                             OF GIC-CLOSING-REASONS
255630200423
255640200423             READ GIC-CLOSING-REASONS
255650200423             INVALID KEY
255660200423               MOVE SPACES     TO WS-CLOSING-REASON-TRO
255670200423             NOT INVALID KEY
255680200423               MOVE CLOSING-REASON-CODE OF GIC-CLOSING-REASONS
255690200423                               TO WS-CLOSING-REASON-TRO
255700200423             END-READ
255710200423           END-IF.
255720200423      *RFS7390 END
255730200423
255740200423           CALL "RTVCLIB"     USING WS-CUR-LIB.
255750200423           CANCEL "RTVCLIB".
255760200423           MOVE WS-CUR-LIB
255770200423                             TO DATA-I-LIBRARY-GIC
255780200423                                DATA-O-LIBRARY-GIC.
255790200423           MOVE PASS-PROCESS-DATE-9
255800200423                              TO BUSINESS-DAY OF BUSINESS-DAYS
255810200423                                 WS-UPPER-LIMIT-DATE
255820200423                                 WS-PASS-PROCESS-DATE-SAV               RFS11964
255830200423           MOVE PASS-PROCESS-DATE-9 TO WS-YEAR-END-DATE                 RFS7652
255840200423           MOVE LT-LAST-MMDD        TO WS-YEAR-END-MMDD                 RFS7652
255850200423140269* Start
255860200423140269     MOVE WS-YEAR-END-DATE    TO WS-NEW-YEAR-DATE
255870200423140269     COMPUTE WS-NEW-YEAR-CCYY = WS-NEW-YEAR-CCYY + 1
255880200423140269     MOVE 0101 TO WS-NEW-YEAR-MMDD
255890200423140269* End
255900200423
255910200423      * RFS10351 - Start
255920200423           IF PASS-CDSC-CALCULATOR IS EQUAL "Y"  AND
255930200423              PASS-CDSC-INVESTMENT NOT = SPACES
255940200423      * RFS21772 - Begin
255950200423             OR SW-CALC-NO-UPDATES
255960200423      * RFS21772 - End
255970200423      * RFS32409 - Start
255980200423             OR lnc_calcSoa
255990200423      * RFS32409 - End
256000200423      * RFS50832 - Begin
256010200423             OR lnc_calcSoaUpd
256020200423      * RFS50832 - End
256030200423               PERFORM VA-GET-INV-PRODUCT
256040200423               IF GIC-DII-INVESTMENT
256050200423                   MOVE PASS-PROCESS-DATE-9               TO
256060200423                                 BUSINESS-DAY OF BUSINESS-DAYS
256070200423                   PERFORM GET-NEXT-PROCESS-DATE
256080200423                   MOVE BUSINESS-DAY OF BUSINESS-DAYS     TO
256090200423                                 PASS-PROCESS-DATE-9
256100200423                                 WS-UPPER-LIMIT-DATE
256110200423               END-IF
256120200423           END-IF
256130200423      * RFS10351 - End
256140200423
256150200423           IF PASS-CDSC-CALCULATOR IS EQUAL "Q"
256160200423             PERFORM GET-NEXT-PROCESS-DATE
256170200423             MOVE BUSINESS-DAY OF BUSINESS-DAYS
256180200423                              TO PASS-PROCESS-DATE-9
256190200423             MOVE BUSINESS-DAY OF BUSINESS-DAYS
256200200423                              TO WS-UPPER-LIMIT-DATE
256210200423           END-IF.
256220200423
256230200423           PERFORM GET-NEXT-PROCESS-DATE.
256240200423           MOVE BUSINESS-DAY OF BUSINESS-DAYS
256250200423                              TO WS-UPPER-LIMIT-DAT2.
256260200423      *RFS 8470 BEGIN
256270200423           IF WS-UPPER-LIMIT-DAT2-R(1:6) IS NOT EQUAL
256280200423              WS-UPPER-LIMIT-DATE-R(1:6)
256290200423              MOVE "99"       TO WS-UPPER-LIMIT-DATE-R(7:2)
256300200423           END-IF.
256310200423      *RFS 8470 END
256320200423
256330200423      * INITIALIZE AND READ SCREEN EDITS ALLOWED
256340200423
256350200423           MOVE WS-SCREEN-CODE TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
256360200423           MOVE WS-EDIT-CODE   TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
256370200423           MOVE WS-LEVEL-CODE  TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
256380200423
256390200423           MOVE "Y"            TO WS-SCREEN-EDITS-ALLOWED
256400200423           READ SCREEN-EDITS-ALLOWED
256410200423           INVALID KEY
256420200423           MOVE "N"            TO WS-SCREEN-EDITS-ALLOWED
256430200423
256440200423      *END GIC MOD
256450200423
256460200423      *RFS 7947 BEGIN
256470200423           MOVE "ACITSBUY"     TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
256480200423           MOVE "DLRSEG"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
256490200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
256500200423
256510200423           MOVE "Y"            TO WS-EDIT-SEG-CONTR-PROV.
256520200423
256530200423           READ SCREEN-EDITS-ALLOWED
256540200423           INVALID KEY
256550200423           MOVE "N"            TO WS-EDIT-SEG-CONTR-PROV.
256560200423      *RFS 7947 END
256570200423
256580200423      *RFS 7446 BEGIN
256590200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
256600200423           MOVE "TRANAG"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
256610200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
256620200423
256630200423           MOVE "Y"            TO WS-SEG-ANNUIT-AGE-THRESH
256640200423
256650200423           READ SCREEN-EDITS-ALLOWED
256660200423           INVALID KEY
256670200423           MOVE "N"            TO WS-SEG-ANNUIT-AGE-THRESH.
256680200423      *RFS 7446 END
256690200423
256700200423      *RFS 9092 BEGIN
256710200423
256720200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
256730200423           MOVE "TRNDRP"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
256740200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
256750200423
256760200423           MOVE "Y"            TO WS-EDIT-SEG-JURISDICTION.
256770200423
256780200423           READ SCREEN-EDITS-ALLOWED
256790200423           INVALID KEY
256800200423           MOVE "N"            TO WS-EDIT-SEG-JURISDICTION.
256810200423
256820200423      *RFS 9092 END
256830200423
256840200423      *RFS 18568 BEGIN
256850200423
256860200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
256870200423           MOVE "TRNCDP"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
256880200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
256890200423
256900200423           MOVE "Y"            TO WS-EDIT-CSH-DST-PAY-MTHD.
256910200423
256920200423           READ SCREEN-EDITS-ALLOWED
256930200423           INVALID KEY
256940200423           MOVE "N"            TO WS-EDIT-CSH-DST-PAY-MTHD.
256950200423
256960200423      *RFS 18568 END
256970200423
256980200423      *RFS 23020 Begin
256990200423
257000200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257010200423           MOVE "AADSOP"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
257020200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
257030200423
257040200423           MOVE "Y"            TO WS-EDIT-AAH-AADSOP.
257050200423
257060200423           READ SCREEN-EDITS-ALLOWED
257070200423           INVALID KEY
257080200423           MOVE "N"            TO WS-EDIT-AAH-AADSOP.
257090200423
257100200423      *RFS 23020 End
257110200423
257120200423      * RFS20722 - Start
257130200423
257140200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257150200423           MOVE "TRKDSC"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
257160200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
257170200423
257180200423           MOVE "Y"            TO WS-TRACK-RE-INVESTED-DISTRIB.
257190200423
257200200423           READ SCREEN-EDITS-ALLOWED
257210200423           INVALID KEY
257220200423           MOVE "N"            TO WS-TRACK-RE-INVESTED-DISTRIB.
257230200423
257240200423      * RFS20722 End
257250200423
257260200423      * RFS20311 - Start
257270200423
257280200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257290200423           MOVE "REPEXS"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
257300200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
257310200423
257320200423           MOVE "Y"            TO WS-VALIDATE-REP-EXISTS.
257330200423
257340200423           READ SCREEN-EDITS-ALLOWED
257350200423           INVALID KEY
257360200423           MOVE "N"            TO WS-VALIDATE-REP-EXISTS.
257370200423
257380200423      * RFS20311 End
257390200423
257400200423      *RFS162289 Begins
257410200423
257420200423           MOVE "T4R2"         TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257430200423           MOVE "T4R2TR"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
257440200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
257450200423
257460200423           MOVE "Y"            TO WS-EDIT-T4R2TR.
257470200423
257480200423           READ SCREEN-EDITS-ALLOWED
257490200423           INVALID KEY
257500200423           MOVE "N"            TO WS-EDIT-T4R2TR.
257510200423
257520200423      *RFS162289 ends
257530200423      * RFS20311 - Start
257540200423
257550200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257560200423           MOVE "REPACT"       TO EDIT-CODE OF SCREEN-EDITS-ALLOWED.
257570200423           MOVE "T"            TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
257580200423
257590200423           MOVE "Y"            TO WS-VALIDATE-REP-ACTIVE.
257600200423
257610200423           READ SCREEN-EDITS-ALLOWED
257620200423           INVALID KEY
257630200423           MOVE "N"            TO WS-VALIDATE-REP-ACTIVE.
257640200423
257650200423      * RFS20311 End
257660200423
257670200423      * RFS22180 - Begin
257680200423           MOVE LT-SCREEN-CODE-INVDTL    TO
257690200423                                  SCREEN-CODE OF SCREEN-EDITS-ALLOWED
257700200423           MOVE LT-EDIT-CODE-INVDT TO EDIT-CODE OF SCREEN-EDITS-ALLOWED
257710200423           MOVE LT-LEVEL-CODE-I    TO
257720200423                                   LEVEL-CODE OF SCREEN-EDITS-ALLOWED
257730200423           PERFORM GET-SCREEN-EDITS-ALLOWED
257740200423           IF SW-TEMP-OK
257750200423             MOVE LT-Y        TO WS-VALIDATE-INV-MISC-DETAIL-FL
257760200423           ELSE
257770200423             MOVE LT-N        TO WS-VALIDATE-INV-MISC-DETAIL-FL
257780200423           END-IF.
257790200423      * RFS22180 - End
257800200423
257810200423      *RFS24191 - Begins
257820200423           MOVE SPACES         TO WS-EDIT-IRCPG.
257830200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257840200423           MOVE "IRCPG"        TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
257850200423           MOVE "T"            TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
257860200423           READ SCREEN-EDITS-ALLOWED
257870200423             INVALID KEY
257880200423               MOVE "N"        TO WS-EDIT-IRCPG
257890200423             NOT INVALID KEY
257900200423               MOVE "Y"        TO WS-EDIT-IRCPG
257910200423           END-READ.
257920200423      *RFS24191 - Ends
257930200423
257940200423      *RFS24190 - Begins
257950200423           MOVE SPACES         TO WS-EDIT-NT2062.
257960200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
257970200423           MOVE "NT2062"       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
257980200423           MOVE "T"            TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
257990200423           READ SCREEN-EDITS-ALLOWED
258000200423             INVALID KEY
258010200423               MOVE "N"        TO WS-EDIT-NT2062
258020200423             NOT INVALID KEY
258030200423               MOVE "Y"        TO WS-EDIT-NT2062
258040200423           END-READ.
258050200423
258060200423           MOVE SPACES         TO WS-EDIT-NRGSEL.
258070200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
258080200423           MOVE "NRGSEL"       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
258090200423           MOVE "T"            TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
258100200423           READ SCREEN-EDITS-ALLOWED
258110200423             INVALID KEY
258120200423               MOVE "N"        TO WS-EDIT-NRGSEL
258130200423             NOT INVALID KEY
258140200423               MOVE "Y"        TO WS-EDIT-NRGSEL
258150200423           END-READ.
258160200423      *RFS24190 - Ends
258170200423
258180200423      *RFS24192 - Begins
258190200423           MOVE SPACES         TO WS-EDIT-NDSNRR.
258200200423           MOVE "TRNPST"       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
258210200423           MOVE "NDSNRR"       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
258220200423           MOVE "T"            TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
258230200423           READ SCREEN-EDITS-ALLOWED
258240200423             INVALID KEY
258250200423               MOVE "N"        TO WS-EDIT-NDSNRR
258260200423             NOT INVALID KEY
258270200423               MOVE "Y"        TO WS-EDIT-NDSNRR
258280200423           END-READ.
258290200423
258300200423           INITIALIZE        MFATRNP   OF WS-NRR-DIST-TRANS
258310200423                             MFATRNP   OF WS-NRR-SEL-TRANS
258320200423                             MFATRNTGP OF WS-NRR-TRANS-TARGET
258330200423                             MFATRNREP OF WS-NRR-TRANS-REDEM-DTLS
258340200423                             MFABCHHDP OF WS-NRR-BATCH-HDR-DTL.
258350200423      *RFS24192 - Ends
258360200423
258370200423      *RFS 30134 - starts
258380200423           MOVE SPACES         TO lc_Trntrd_Flag.
258390200423           MOVE lnc_Screen_Code  To
258400200423                Screen-Code OF Screen-Edits-Allowed.
258410200423           MOVE lnc_Trntrd_Edit_C  TO
258420200423                Edit-Code   OF Screen-Edits-Allowed.
258430200423           MOVE lnc_Trntrd_Level_C TO
258440200423                Level-Code  OF Screen-Edits-Allowed.
258450200423
258460200423           READ Screen-Edits-Allowed
258470200423             INVALID KEY
258480200423               MOVE LT-N       TO lc_Trntrd_Flag
258490200423             NOT INVALID KEY
258500200423               MOVE LT-Y       TO lc_Trntrd_Flag
258510200423           END-READ.
258520200423
258530200423           MOVE SPACES         TO lc_Accact_Flag.
258540200423           MOVE lnc_Screen_Code  To
258550200423                Screen-Code OF Screen-Edits-Allowed.
258560200423           MOVE lnc_Accact_Edit_C  TO
258570200423                Edit-Code   OF Screen-Edits-Allowed.
258580200423           MOVE lnc_Accact_Level_C TO
258590200423                Level-Code  OF Screen-Edits-Allowed.
258600200423
258610200423           READ Screen-Edits-Allowed
258620200423             INVALID KEY
258630200423               MOVE LT-N       TO lc_Accact_Flag
258640200423             NOT INVALID KEY
258650200423               MOVE LT-Y       TO lc_Accact_Flag
258660200423           END-READ.
258670200423      *RFS 30134 - Ends
258680200423      * RFS32873 - Begin
258690200423           MOVE lnc_EditCode1ACCONScreenCode
258700200423             TO Screen-Code OF Screen-Edits-Allowed.
258710200423           MOVE lnc_EditCode1ACCONEditCode
258720200423             TO Edit-Code   OF Screen-Edits-Allowed.
258730200423           MOVE lnc_EditCode1ACCONLevel
258740200423             TO Level-Code  OF Screen-Edits-Allowed.
258750200423
258760200423           READ Screen-Edits-Allowed
258770200423             INVALID KEY
258780200423               SET lb_EditCode1ACCONSetupNo  TO TRUE
258790200423             NOT INVALID KEY
258800200423               SET lb_EditCode1ACCONSetupYES TO TRUE
258810200423           END-READ.
258820200423
258830200423           CALL "FXSCEDTAL1" USING
258840200423                    lnc_Screen_Code
258850200423                    lc_editCodeCLWBCK
258860200423                    lncc_space1
258870200423                    lc_editCLWBCKflag
258880200423      * RFS32873 - End
258890200423      *RFS1016152-Starts
258900200423      * Check the Edit code SKPREJ exists
258910200423
258920200423           INITIALIZE  Pass-Screen-Code
258930200423                       Pass-Edit-Code
258940200423                       Pass-Level-Code.
258950200423
258960200423           MOVE lc_TRNPST                     TO Pass-Screen-Code.
258970200423           MOVE lc_SKPREJ                     TO Pass-Edit-Code.
258980200423           MOVE lnc_N                         TO Pass-Level-Code.
258990200423
259000200423           CALL "FXSCEDTAL1" USING Pass-Screen-Code
259010200423                                   Pass-Edit-Code
259020200423                                   Pass-Level-Code
259030200423                                   Retn-Edit-Allowed-Flag.
259040200423
259050200423           CANCEL "FXSCEDTAL1".
259060200423
259070200423           IF  Retn-Edit-Allowed
259080200423               SET lncc_YesBySKPREJ           TO TRUE
259090200423           END-IF.
259100200423      *RFS1016152-Ends
259110200423
259120200423      *RFS 104600 - Start
259130200423           CALL "FXSCEDTAL1" USING
259140200423                    lnc_screenCodeNOMRUL
259150200423                    lnc_editCodeNOMRUL
259160200423                    lnc_levelCodeNOMRUL
259170200423                    lc_NOMRULFlag.
259180200423      *RFS 104600 - End
259190200423      *RFS 137032 - Begins.
259200200423           CALL "FXSCEDTAL1" USING
259210200423                    lnc_screencodeminTRNPST
259220200423                    lnc_editcodeminOVRIMT
259230200423                    lnc_levelcodeminT
259240200423                    lncc_OVRIMT.
259250200423      *RFS 137032 - Ends.
259260200423
259270200423      * RFS35075 - Begin
259280200423           CALL "FXSCEDTAL1" USING
259290200423                    lnc_EditCodeREPLICScreenCode
259300200423                    lnc_EditCodeREPLICEditCode
259310200423                    lnc_EditCodeREPLICLevel
259320200423                    lc_EditCodeREPLICSetupFlag
259330200423      * RFS35075 - End
259340200423      * RFS40845 - Begin
259350200423
259360200423      *    RFS71433 -Begin
259370200423      *RFS108486 - Start : Un-commented variables
259380200423           CALL "FXSCEDTAL1" USING
259390200423                    lncc_screenCodeGrntnf
259400200423                    lncc_editCodeGrntnf
259410200423                    lncc_levelCodeGrntnf
259420200423                    lc_GrntnfFlag
259430200423      *RFS108486 - End
259440200423      *    RFS71433 -End
259450200423      * RFS40845 - End
259460200423
259470200423      * RFS52816 - Begin
259480200423           CALL "FXSCEDTAL1" USING
259490200423                    lncc_screenCodeRIFGLW
259500200423                    lncc_editCodeRIFGLW
259510200423                    lncc_levelCodeRIFGLW
259520200423                    lc_RIFGLWFlag
259530200423      * RFS52816 - End
259540200423      * RFS42278 - Begin
259550200423           CALL "FXSCEDTAL1" USING
259560200423                    lnc_LinkNoteScreenCode
259570200423                    lnc_LinkNoteEditCode
259580200423                    lnc_LinkNoteLevel
259590200423                    lc_LinkNoteSetonFlag
259600200423      *RFS42278 - Ends
259610200423
25962020042344930      CALL "FXSCEDTAL1" USING
25963020042344930               lnc_EditCodeTGDVScreenCode
25964020042344930               lnc_EditCodeTGDVEditCode
25965020042344930               lnc_EditCodeTGDVLevel
25966020042344930               lc_EditCodeTGDVSetupFlag.
259670200423
25968020042346707      CALL "FXSCEDTAL1" USING
25969020042346707               lnc_EditCodeANNDTHScreenCode
25970020042346707               lnc_EditCodeANNDTHEditCode
25971020042346707               lnc_EditCodeANNDTHLevel
25972020042346707               lc_EditCodeANNDTHSetupFlag.
259730200423
259740200423      *RFS33578 - Begins
259750200423           SET  lb_EditCodeAcwtaxNo   TO TRUE.
259760200423           MOVE lnc_Screen_Code TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
259770200423           MOVE lnc_ACWTAX      TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
259780200423           MOVE lnc_T           TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
259790200423           READ SCREEN-EDITS-ALLOWED
259800200423             INVALID KEY
259810200423               SET lb_EditCodeAcwtaxNo   TO TRUE
259820200423             NOT INVALID KEY
259830200423               SET lb_EditCodeAcwtaxYes  TO TRUE
259840200423           END-READ.
259850200423      *RFS33578 - Ends
259860200423
259870200423      *RFS50475 - Begins
259880200423           CALL "FXSCEDTAL1" USING
259890200423                    lnc_EditCodeALDScreenCode
259900200423                    lnc_EditCodeALDEditCode
259910200423                    lnc_EditCodeALDLevel
259920200423                    lc_EditCodeALDSetupFlag.
259930200423      *RFS50475 - Ends
259940200423
259950200423      *RFS138945 - Start
259960200423      *RFS112945 - Begins
259970200423      *    CALL "FXSCEDTAL1" USING
259980200423      *             lnc_EditCodeALDTTScreenCode
259990200423      *             lnc_EditCodeALDTTEditCode
260000200423      *             lnc_EditCodeALDTTLevel
260010200423      *             lc_EditCodeALDTTSetupFlag.
260020200423      *RFS112945 - Ends
260030200423      *RFS138945 - End
260040200423
260050200423      *RFS103858 - Begins
260060200423           CALL "FXSCEDTAL1" USING
260070200423                    lnc_EditCodeGENPUPScreenCode
260080200423                    lnc_EditCodeGENPUPEditCode
260090200423                    lnc_EditCodeGENPUPLevel
260100200423                    lc_EditCodeGENPUPSetupFlag.
260110200423      *RFS103858 - Ends
260120200423
260130200423      *51186 - Begins
260140200423           CALL "FXSCEDTAL1" USING
260150200423                    lnc_EditCodeACINVGScreenCode
260160200423                    lnc_EditCodeACINVGEditCode
260170200423                    lnc_EditCodeACINVGLevel
260180200423                    lc_EditCodeACINVGSetupFlag.
260190200423      *51186 - Ends
260200200423135263     SET lb_EditCodeSTTFSetupNo TO TRUE
260210200423103575     IF NOT lnc_calcSoa  AND NOT lnc_calcSoaUpd
260220200423      *RFS71427 Begins
260230200423           CALL "FXSCEDTAL1" USING
260240200423                    lnc_EditCodeSTTFScreenCode
260250200423                    lnc_EditCodeSTTFEditCode
260260200423                    lnc_EditCodeSTTFLevel
260270200423                    lc_EditCodeSTTFSetupFlag.
260280200423      *RFS71427 Ends
260290200423
260300200423      *    RFS71433 -Begin
260310200423           CALL "FXSCEDTAL1" USING
260320200423                    lc_EditCodeDSCScreenCode
260330200423                    lc_EditCodeDSCEditCode
260340200423                    lc_EditCodeDSCLevel
260350200423                    lc_DSCDOLFlag
260360200423
260370200423      *    RFS71433 -End
260380200423
260390200423      *    RFS96081 -Starts
260400200423           CALL "FXSCEDTAL1" USING
260410200423                    lc_ScreenCodeOETRNPST
260420200423                    lc_editCodeEWACD
260430200423                    lc_levelCodeA
260440200423                    lc_EWACDFlag
260450200423
260460200423      *    RFS96081 -End
260470200423
260480200423      *RFS161542 - Starts
260490200423           SET  lc_EditCodePURDTEOff TO TRUE
260500200423           CALL "FXSCEDTAL1" USING lnc_TRNPST-ScreenCode
260510200423                                   lnc_PURDTE-EditCode
260520200423                                   lnc_T-EditLevel
260530200423                                   lc_PURDTE-RtnFlag
260540200423      *RFS161542 - Ends
260550210531
260560210531      *RFS186729 STARTS
260570210531           call "FXSCEDTAL1" using lncc_screenCodeSFMSGW
260580210531                                   lncc_editCodeSFMSGW
260590210531                                   lncc_levelCodeSFMSGW
260600210531                                   lc_SFMSGWFlag.
260610210531      *RFS186729 END
260620210531
260630210216      *RFS1104392 - Start
260640210216           CALL "FXSCEDTAL1" USING lnc_UPDCONTScreenCode
260650210216                                   lnc_STRSMDEditCode
260660210216                                   lnc_STRSMDLevel
260670210216                                   lb_STRSMDSetonFlag
260680210216      *RFS1104392 - Ends
260681210916      *RFS186588 - Starts
260683210916           INITIALIZE lc_TRNSEQFlag.
260691210921           CALL "FXSCEDTAL1" USING lncc_ScreenCdTRNPST
260692210921                                   lncc_EditCdTRNSEQ
260693210921                                   lnc_LevelCdT
260695210921                                   lc_TRNSEQFlag.
260702210916      *RFS186588 - Ends
260703200423      *-----------------*
260704200423      * SPECIAL MODULES *
260710200423      *-----------------*
260720200423
260730200423      *RFS 8058 BEGIN
260740200423
260750200423           MOVE "MFASPMODA"  TO WS-INDEX-NAME.
260760200423           MOVE "*LIBL"      TO WS-LIBRARY.
260770200423           MOVE "R"          TO WS-ACTION.
260780200423
260790200423           MOVE "K"          TO WS-TYPE1.
260800200423           MOVE 10           TO WS-LENGTH1.
260810200423           MOVE "K"          TO WS-TYPE2.
260820200423           MOVE 3            TO WS-LENGTH2.
260830200423
260840200423           MOVE MANAGEMENT-CO-CATAGORY
260850200423                             TO WS-VALUE2.
260860200423
260870200423           MOVE "N"          TO WS-ACCOUNT-LEV-DSC.
260880200423           MOVE "ACLVDSC"    TO WS-VALUE1.
260890200423           PERFORM PROCESS-USER-INDEX-ACTION.
260900200423           MOVE WS-SUCCESSFUL
260910200423                             TO WS-ACCOUNT-LEV-DSC.
260920200423
260930200423           MOVE "N"          TO WS-ACCOUNT-LEV-FREE-DOLLARS.
260940200423           MOVE "ACLVFRD"    TO WS-VALUE1.
260950200423           PERFORM PROCESS-USER-INDEX-ACTION.
260960200423           MOVE WS-SUCCESSFUL
260970200423                             TO WS-ACCOUNT-LEV-FREE-DOLLARS.
260980200423
260990200423           MOVE "N"          TO WS-ACCOUNT-TYPE-PCT-FREE.
261000200423           MOVE "ACTPCTF"    TO WS-VALUE1.
261010200423           PERFORM PROCESS-USER-INDEX-ACTION.
261020200423           MOVE WS-SUCCESSFUL
261030200423                             TO WS-ACCOUNT-TYPE-PCT-FREE.
261040200423
261050200423           MOVE "N"          TO WS-COMMISSION-RECOVERY.
261060200423           MOVE "COMRCVY"    TO WS-VALUE1.
261070200423           PERFORM PROCESS-USER-INDEX-ACTION.
261080200423           MOVE WS-SUCCESSFUL
261090200423                             TO WS-COMMISSION-RECOVERY.
261100200423
261110200423           MOVE "N"          TO WS-RESET-ACCTP-SWITCH.
261120200423           MOVE "RSTATPS"    TO WS-VALUE1.
261130200423           PERFORM PROCESS-USER-INDEX-ACTION.
261140200423           MOVE WS-SUCCESSFUL
261150200423                             TO WS-RESET-ACCTP-SWITCH.
261160200423
261170200423           MOVE "N"          TO WS-EXTERNAL-TRANSFER.
261180200423           MOVE "EXTTRNF"    TO WS-VALUE1.
261190200423           PERFORM PROCESS-USER-INDEX-ACTION.
261200200423           MOVE WS-SUCCESSFUL
261210200423                             TO WS-EXTERNAL-TRANSFER.
261220200423
261230200423           MOVE "N"          TO WS-SPEC-MOD-AUTH-ALWBSWO.
261240200423           MOVE "ALWBSWO"    TO WS-VALUE1.
261250200423           PERFORM PROCESS-USER-INDEX-ACTION.
261260200423           MOVE WS-SUCCESSFUL
261270200423                             TO WS-SPEC-MOD-AUTH-ALWBSWO.
261280200423
261290200423      *RFS 16941 Begin
261300200423
261310200423           MOVE "N"          TO WS-SPEC-MOD-AUTH-ENVTRNSFER.
261320200423           MOVE "ENVTRNSFER" TO WS-VALUE1.
261330200423           PERFORM PROCESS-USER-INDEX-ACTION.
261340200423           MOVE WS-SUCCESSFUL
261350200423                             TO WS-SPEC-MOD-AUTH-ENVTRNSFER.
261360200423      *RFS 16941 End
261370200423
261380200423           MOVE "N"          TO WS-MANAGMENT-FEE.
261390200423           MOVE "MGMFEE"     TO WS-VALUE1.
261400200423           PERFORM PROCESS-USER-INDEX-ACTION.
261410200423           MOVE WS-SUCCESSFUL
261420200423                             TO WS-MANAGMENT-FEE.
261430200423      *RFS 13587 Begin
261440200423           MOVE "N"          TO WS-ADJUSTMENT-FEE.
261450200423           MOVE "ADJFEES"    TO WS-VALUE1.
261460200423           PERFORM PROCESS-USER-INDEX-ACTION.
261470200423           MOVE WS-SUCCESSFUL
261480200423                             TO WS-ADJUSTMENT-FEE.
261490200423      *RFS 13587 End
261500200423           MOVE "N"          TO WS-FREE-DOLLAR-DSC.
261510200423           MOVE "FRDODSC"    TO WS-VALUE1.
261520200423           PERFORM PROCESS-USER-INDEX-ACTION.
261530200423           MOVE WS-SUCCESSFUL
261540200423                             TO WS-FREE-DOLLAR-DSC.
261550200423      *RFS 13468 END
261560200423      *RFS 8058 END
261570200423      *RFS 7721 BEGIN
261580200423      *RFS 13468 BEGIN
261590200423           MOVE "N"          TO WS-SPEC-MOD-AUTH-ALWBSWO.
261600200423           MOVE "ALWBSWO"    TO WS-VALUE1.
261610200423           PERFORM PROCESS-USER-INDEX-ACTION.
261620200423           MOVE WS-SUCCESSFUL
261630200423                             TO WS-SPEC-MOD-AUTH-ALWBSWO.
261640200423      *RFS 13468 END
261650200423      *RFS 16505 - Begin
261660200423           MOVE "N"              TO WS-SPEC-MOD-AUTH-DSCMET
261670200423           MOVE "DSCMETHOD"      TO WS-VALUE1
261680200423           PERFORM PROCESS-USER-INDEX-ACTION
261690200423           MOVE WS-SUCCESSFUL    TO WS-SPEC-MOD-AUTH-DSCMET
261700200423      * RFS16505 - End
261710200423           INITIALIZE WS-ASL-ARR.
261720200423      *RFS 7721 END
261730200423      *RFS 17019 Begin
261740200423           MOVE "N"          TO WS-MFEAMS.
261750200423           MOVE "MFEAMS"     TO WS-VALUE1.
261760200423           PERFORM PROCESS-USER-INDEX-ACTION.
261770200423           MOVE WS-SUCCESSFUL
261780200423                             TO WS-MFEAMS.
261790200423      *RFS 17019 End
261800200423
261810200423      *RFS 14380 Begin
261820200423           MOVE "N"          TO WS-ERFEE.
261830200423           MOVE "ERFEE"      TO WS-VALUE1.
261840200423           PERFORM PROCESS-USER-INDEX-ACTION.
261850200423           MOVE WS-SUCCESSFUL
261860200423                             TO WS-ERFEE.
261870200423      *RFS 14380 End
261880200423      *RFS17685 Begin
261890200423           MOVE "N"          TO WS-MMINTA.
261900200423           MOVE "MMINTA"     TO WS-VALUE1.
261910200423           PERFORM PROCESS-USER-INDEX-ACTION.
261920200423           MOVE WS-SUCCESSFUL
261930200423                             TO WS-MMINTA.
261940200423      *RFS17685 End
261950200423      *RFS29550 - Begins
261960200423           MOVE "N"            TO WS-USWT.
261970200423           MOVE "USWT"         TO WS-VALUE1.
261980200423           PERFORM PROCESS-USER-INDEX-ACTION.
261990200423           MOVE WS-SUCCESSFUL  TO WS-USWT.
262000200423      *RFS29550 - Ends
262010200423      *RFS24191 - Begins
262020200423           MOVE "N"            TO WS-POLTAX.
262030200423           MOVE "POLTAX"       TO WS-VALUE1.
262040200423           PERFORM PROCESS-USER-INDEX-ACTION.
262050200423           MOVE WS-SUCCESSFUL  TO WS-POLTAX.
262060200423      *RFS24191 - Ends
262070200423      *RFS37754 - Begins
262080200423           MOVE "N"            TO WS-SPEC-MOD-AUTH-SEGSYSMAT.
262090200423           MOVE "SEGSYSMAT"    TO WS-VALUE1.
262100200423           PERFORM PROCESS-USER-INDEX-ACTION.
262110200423           MOVE WS-SUCCESSFUL  TO WS-SPEC-MOD-AUTH-SEGSYSMAT.
262120200423      *RFS37754 - Ends
262130200423      *RFS68035 - Begins
262140200423      *RFS85884 - Begins - move N to the correct variable
262150200423      *    MOVE "N"            TO WS-SPEC-MOD-AUTH-SEGSYSMAT.
262160200423           MOVE "N"            TO WS-SPEC-MOD-AUTH-RDSP.
262170200423      *RFS85884 - Ends
262180200423           MOVE "RDSP"         TO WS-VALUE1.
262190200423           PERFORM PROCESS-USER-INDEX-ACTION.
262200200423           MOVE WS-SUCCESSFUL  TO WS-SPEC-MOD-AUTH-RDSP.
262210200423      *RFS68035 - Ends
26222020042340942      CALL "RTVMODAUTH" USING lncc_ModuleSEGGLWB,
26223020042340942                              lc_ModuleSEGGLWBFlag.
26224020042354435      CALL "RTVMODAUTH" USING lncc_ModuleTFSA,
26225020042354435                              lc_ModuleTFSAFlag.
26226020042356471      CALL "RTVMODAUTH" USING lncc_ModuleSPIA,
26227020042356471                              lc_ModuleSPIAFlag.
262280200423139286     CALL "RTVMODAUTH" USING lncc_ModulePOANN,
262290200423139286                             lc_ModulePOANNFlag.
26230020042380144      CALL "RTVMODAUTH" USING lncc_ModuleIQEE,
26231020042380144                              lc_ModuleIQEEFlag.
26232020042364348      CALL "RTVMODAUTH" USING lncc_ModuleSRVFEE,
26233020042364348                              lc_ModuleSRVFEEFlag.
262340200423      *RFS138805 Start
262350200423           CALL "RTVMODAUTH" USING lncc_ModuleSEGFUND,
262360200423                                   lc_SegFundFlag.
262370200423           CALL "RTVMODAUTH" USING lncc_ModuleGIC,
262380200423                                   lc_GicFlag.
262390200423      *RFS138805 End
262400200423      *RFS183140 - Begin
262410200423           CALL "RTVMODAUTH" USING lncc_ModuleLNPREMAT,
262420200423                                   lc_LNPREMATFlag.
262430200423      *RFS183140 - End
262440201223      * RFS185174 - Start: set up Environment Function flag On
262450201223           CALL "FXGETFNCD" USING lncc_FLDALF lc_ENV_FLDALFFlag
262460201223      * RFS185174 - End
262470200423      * RFS140269 - Start
262480201223      *RFS180707 - Starts
262490201223140269*    IF ACCOUNT-LEV-DSC OR lb_GICActACB
262500210625      *RFS1113362 Starts
262510210625140269*    IF (ACCOUNT-LEV-DSC AND lnc_ACINDSCNo) OR lb_GICActACB
262520210625           IF ACCOUNT-LEV-DSC OR lb_GICActACB
262530210625      *RFS1113362 Ends
262540201223      *RFS180707 - Ends
262550200423140269        SET lb_SkipGICSeqYes to TRUE
262560200423140269      ELSE
262570200423140269        SET lb_SkipGICSeqNo to TRUE
262580200423140269     END-IF.
262590200423      * RFS140269 - End
262600200423      * RFS102778 - Start
262610200423           INITIALIZE MFAINVPTP  OF INVESTMENT-PLAN-TRANS-MIN-REC.
262620200423           SET li_MinIdx         TO 1.
262630200423           SET lb_EndOffileNo    TO TRUE.
262640200423      * RFS117763d - Begins
262650200423           INITIALIZE li_LastATSidx.
262660200423      * RFS117763d - Ends
262670200423           MOVE SPACES           TO INVESTMENT-CODE
262680200423                                       OF INVESTMENT-PLAN-TRANS-MIN.
262690200423           MOVE SPACES           TO PLAN-TRANS
262700200423                                       OF INVESTMENT-PLAN-TRANS-MIN.
262710200423           MOVE SPACES           TO CHEQUE-TYPE
262720200423                                       OF INVESTMENT-PLAN-TRANS-MIN.
262730200423           START INVESTMENT-PLAN-TRANS-MIN
262740200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
262750200423           INVALID KEY
262760200423                   CONTINUE
262770200423           NOT INVALID KEY
262780200423                   PERFORM Load-Min-Table UNTIL lb_EndofFileYes
262790200423           END-START.
262800200423      * RFS102778 - End
262810210405      * RFS1110228-STARTS
262820210405           INITIALIZE li_WithHierRecCount
262830200423
262840210405           CALL "RTVNBRRCD" USING lncc_WithHierFilNme,
262850210405                                  li_WithHierRecCount.
262860210405
262870210405      * RFS1110228-ENDS
262880200423       INL-CLOSE.
262890200423       INL-EXIT.
262900200423           EXIT.
262910200423      /
262920200423      *RFS 13468 BEGIN
262930200423       COPY PR1_UIDX.
262940200423      *RFS 13468 END
262950200423      /
262960200423       END-JOB SECTION.
262970200423
262980200423      ******************************************************************
262990200423      *    E N D   J O B   L O G I C   R O U T I N E                   *
263000200423      ******************************************************************
263010200423       EOJ-0000.
263020200423           DISPLAY WS-LOCAL-DATA-AREA UPON WS-LOCAL.
263030200423      * RFS50832 - Begin: always open and close the files
263040200423           CLOSE           TRANS-CDSC-PUR-SUBDTLS
263050200423      *RFS125258 -Begin
263060200423                           TRANS-PRIMARY
263070200423                           TRANS-RDSP-REPAY
263080200423                           TRANS
263090200423                           TRANS-PRIMARY-2
263100200423                           TRANS-GIC-CHK
263110200423                           TRANS2
263120200423                           TRANS-VALUE-LOOKUP
263130200423                           TRANS-MFR
263140200423      *RFS125258 -End
263150200423                           TRANS-CDSC-RED-SUBDTLS
263160200423                           ACCOUNT-LEVEL-FREE
263170200423                           TRANS-ACCOUNT-LV-DS-DTLS
263180200423                           ACCOUNT-LV-QUALIFIED
263190200423                           ACCOUNT-INVESTMENT
263200200423139288                     Account-Contract-SPIA
263210200423                           TRANS-CDSC-PUR-PRIMARY
263220200423                           TRANS-CDSC-PURCH-REDUCTION
263230200423                           TRANS-CDSC-CLOCK-PRIMARY
263240200423                           TRANS-CDSC-PUR-DIST
263250200423                           TRANS-CDSC-PURCHASE
263260200423                           TRANS-CDSC-CLOCK
263270200423                           TRANS-ADDITIONAL-TAX
263280200423                           ACCOUNT-INVESTMENT-SRCH
263290200423113784                     MULTI-TRANS-DETAIL
263300200423126805                     MULTI-TRANS-DETAIL-A
263310200423      *  RFS92482 - Start
263320200423                           INVESTMENT-ROC-RATES
263330200423                           ROC-TRANS-TYPES
263340200423      *  RFS92482 - End
26335020042396530                      GUARANTEED-MAT-VALUE-SCHED
263360200423      * RFS92475 - Start.
263370200423102122*                    FEE-EXCLUSIONS
263380200423      * RFS92475 - End.
263390200423      * RFS92504 - Start.
263400200423                           Certificate
263410200423                           Certificate-Primary
263420200423                           Investment-Upd
263430200423      * RFS92504 - End.
263440200423104600                     CONTRACT-CHANGE-LOG
263450200423104600                     INVESTOR-CHANGE-LOG
263460200423112944                     ACCOUNT-MISC-DETAILS
263470200423108486                     RDSP-WORKFILE
263480200423                           ACCOUNT-INVESTMENT2
263481210914      * RFS1117913 - Starts
263482210914                           ACCOUNT-BENEFITS1
263483210914                           ACCOUNT-CONTRACT1
263484210914      * RFS1117913 - Ends
263490200423      * RFS 129169 - begins.
263500200423110904*                    INVESTMENT-STRUCTURE-XREF
263510200423      * RFS 129169 - ends.
263520200423110904                     INVESTMENT-STRUCTURE-XREF-2
263530200423110904                     CONTRACT-DATA-LOG.
263540200423      * RFS50832 - End
263550200423      * RFS21772 - Begin
263560200423           IF NOT SW-FILES-OPENED
263570200423      * RFS21772 - End
263580200423R72268        PERFORM closeOpenedCondFiles
263590200423R72268     END-IF.
263600200423      * RFS20265 - End
263610200423      * RFS13839 - Begin
263620200423           IF SW-DSC-OPENED
263630200423               CLOSE DSC-CALC-FILE
263640200423      * RFS32409 - Start
263650200423      * RFS50832 - Begin: close the file without condition for SOA
263660200423      *        IF NOT lnc_calcSoa
263670200423      * RFS50832 - End
263680200423      * RFS32409 - End
263690200423                 CLOSE  DSC-CALC-FILE2
263700200423      * RFS32409 - Start
263710200423      * RFS50832 - Begin
263720200423      *        END-IF
263730200423      * RFS50832 - End
263740200423      * RFS32409 - End
263750200423               SET SW-DSC-NOT-OPENED     TO TRUE
263760200423           END-IF
263770200423      * RFS13839 - End
263780200423      * RFS16941 - Begin
263790200423           IF SPEC-MOD-AUTH-ENVTRNSFER
263800200423               MOVE SPACES                   TO WS-TRF-BW-ERR-FLAG
263810200423               MOVE "D"                      TO WS-SETTRFBW-ACTION
263820200423               IF WS-SETTRFBW-MODE-O-ON
263830200423                   CALL "SETTRFBW" USING
263840200423                                           WS-SETTRFBW-LIBRARY
263850200423                                           WS-SETTRFBW-ACTION
263860200423                                           WS-SETTRFBW-RETURN-CODE
263870200423                   IF WS-SETTRFBW-RETURN-CODE = " "
263880200423                       MOVE "N" TO WS-SETTRFBW-MODE-O-FLAG
263890200423                   END-IF
263900200423               END-IF
263910200423           END-IF.
263920200423      * RFS16941 - End
263930200423
263940200423      * MULTI LOCK MOD
263950200423           IF WS-ACCEPT-FROM-DQ = "Y"
263960200423             MOVE DATA-I-LIBRARY
263970200423                         TO DATA-O-LIBRARY
263980200423             MOVE DATA-I-NAME
263990200423                         TO  DATA-O-NAME
264000200423             MOVE "TXREPLY"
264010200423                         TO  DATA-O-NAME(1:7)
264020200423             MOVE "OK"   TO  DATA-O-MESSAGE
264030200423             CALL "QSNDDTAQ" USING DATA-O-NAME
264040200423                             DATA-O-LIBRARY
264050200423                             DATA-O-MESSAGE-LEN
264060200423                             DATA-O-MESSAGE
264070200423           END-IF.
264080200423      * MULTI LOCK MOD END
264090200423      * RFS49699 - Begin
264100200423           MOVE "LOGARR"               to Pass-Screen-Code.
264110200423           MOVE "LOGARR"               to Pass-Edit-Code.
264120200423           MOVE "N"                    to Pass-Level-Code.
264130200423
264140200423           call "FXSCEDTAL1" using Pass-Screen-Code
264150200423                                   Pass-Edit-Code
264160200423                                   Pass-Level-Code
264170200423                                   Retn-Edit-Allowed-Flag.
264180200423
264190200423           cancel "FXSCEDTAL1".
264200200423           IF Retn-Edit-Allowed
264210200423               PERFORM ARRAY-LOGGING
264220200423           END-IF.
264230200423      * RFS49699 - End
264240200423      * RFS98866 - Start
264250200423           IF PASS-CDSC-CALCULATOR-YES
264260200423             MOVE    PASS-CDSC-GROSS     TO  ln_RDSPGross
264270200423                                             pi_RDSPGross
264280200423             MOVE    pi_RDSPTotCapital   TO  ln_RDSPTotCapital
264290200423             MOVE    pi_RDSPTotGrant     TO  ln_RDSPTotGrant
264300200423             MOVE    pi_RDSPTotMV        TO  ln_RDSPTotMV
264310200423             MOVE    pi_RDSPTotBond      TO  ln_RDSPTotBond
264320200423             MOVE    pi_RDSPAHAGrant     TO  ln_RDSPAHAGrant
264330200423             MOVE    pi_RDSPAHABond      TO  ln_RDSPAHABond
264340200423             MOVE    pc_GroupAdjust      TO  lc_GroupAdjust
264350200423             PERFORM CalculateRDSPAmounts
264360200423             MOVE    ln_NonTaxableAmount TO  pi_NonTaxableAmount
264370200423             MOVE    ln_CDSPGrantAmount  TO  pi_CDSPGrantAmount
264380200423             MOVE    ln_CDSPBondAmount   TO  pi_CDSPBondAmount
264390200423             DISPLAY pc_WKRDSPData       UPON WS-DTAARA-WKRDSPDATA
264400200423                                         FOR "WKRDSPDATA"
264410200423           END-IF.
264420200423      * RFS98866 - End
264430200423       EOJ-EXIT.
264440200423           EXIT.
264450200423      * RFS49699 - Begin call array logging if on!
264460200423       ARRAY-LOGGING SECTION.
264470200423           MOVE "TRNPST"               TO  pp-Program-Name.
264480200423           MOVE WS-ARRAY1-NAME         TO  pp-Array-Name.
264490200423           SET  WS-ARR-COUWTP          TO  TRUE.
264500200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264510200423           MOVE WS-ARRAY1-MAX          TO  pp-Max-Size.
264520200423           MOVE WS-ARRAY1-MAX-USED     TO  pp-Max-Size-Used.
264530200423           MOVE SPACES                 TO  rp-Err-Flag.
264540200423
264550200423           CALL "FXLOGAU"      using PR-FXLOGAU.
264560200423
264570200423           MOVE WS-ARRAY2-NAME         TO  pp-Array-Name.
264580200423           SET  WS-ARR-TRCODP          TO  TRUE.
264590200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264600200423           MOVE WS-ARRAY2-MAX          TO  pp-Max-Size.
264610200423           MOVE WS-ARRAY2-MAX-USED     TO  pp-Max-Size-Used.
264620200423           MOVE SPACES                 TO  rp-Err-Flag.
264630200423
264640200423           CALL "FXLOGAU"      using PR-FXLOGAU.
264650200423
264660200423           MOVE WS-ARRAY3-NAME         TO  pp-Array-Name.
264670200423           SET  WS-ARR-ACCCIP          TO  TRUE.
264680200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264690200423           MOVE WS-ARRAY3-MAX          TO  pp-Max-Size.
264700200423           MOVE WS-ARRAY3-MAX-USED     TO  pp-Max-Size-Used.
264710200423           MOVE SPACES                 TO  rp-Err-Flag.
264720200423
264730200423           CALL "FXLOGAU"      using PR-FXLOGAU.
264740200423
264750200423           MOVE WS-ARRAY4-NAME         TO  pp-Array-Name.
264760200423           SET  WS-ARR-TRCTGLA         TO  TRUE.
264770200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264780200423           MOVE WS-ARRAY4-MAX          TO  pp-Max-Size.
264790200423           MOVE WS-ARRAY4-MAX-USED     TO  pp-Max-Size-Used.
264800200423           MOVE SPACES                 TO  rp-Err-Flag.
264810200423
264820200423           CALL "FXLOGAU"      using PR-FXLOGAU.
264830200423
264840200423           MOVE WS-ARRAY5-NAME         TO  pp-Array-Name.
264850200423           SET  WS-ARR-ACCONP          TO  TRUE.
264860200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264870200423           MOVE WS-ARRAY5-MAX          TO  pp-Max-Size.
264880200423           MOVE WS-ARRAY5-MAX-USED     TO  pp-Max-Size-Used.
264890200423           MOVE SPACES                 TO  rp-Err-Flag.
264900200423
264910200423           CALL "FXLOGAU"      using PR-FXLOGAU.
264920200423
264930200423           MOVE WS-ARRAY6-NAME         TO  pp-Array-Name.
264940200423           SET  WS-ARR-ACCANP          TO  TRUE.
264950200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
264960200423           MOVE WS-ARRAY6-MAX          TO  pp-Max-Size.
264970200423           MOVE WS-ARRAY6-MAX-USED     TO  pp-Max-Size-Used.
264980200423           MOVE SPACES                 TO  rp-Err-Flag.
264990200423
265000200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265010200423
265020200423           MOVE WS-ARRAY7-NAME         TO  pp-Array-Name.
265030200423           SET  WS-ARR-ACCCIP          TO  TRUE.
265040200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265050200423           MOVE WS-ARRAY7-MAX          TO  pp-Max-Size.
265060200423           MOVE WS-ARRAY7-MAX-USED     TO  pp-Max-Size-Used.
265070200423           MOVE SPACES                 TO  rp-Err-Flag.
265080200423
265090200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265100200423
265110200423           MOVE WS-ARRAY8-NAME         TO  pp-Array-Name.
265120200423           SET  WS-ARR-ACCCIP          TO  TRUE.
265130200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265140200423           MOVE WS-ARRAY8-MAX          TO  pp-Max-Size.
265150200423           MOVE WS-ARRAY8-MAX-USED     TO  pp-Max-Size-Used.
265160200423           MOVE SPACES                 TO  rp-Err-Flag.
265170200423
265180200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265190200423
265200200423           MOVE WS-ARRAY9-NAME         TO  pp-Array-Name.
265210200423           SET  WS-ARR-TBLP            TO  TRUE.
265220200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265230200423           MOVE WS-ARRAY9-MAX          TO  pp-Max-Size.
265240200423           MOVE WS-ARRAY9-MAX-USED     TO  pp-Max-Size-Used.
265250200423           MOVE SPACES                 TO  rp-Err-Flag.
265260200423
265270200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265280200423
265290200423           MOVE WS-ARRAY10-NAME        TO  pp-Array-Name.
265300200423           SET  WS-ARR-TRNEPP          TO  TRUE.
265310200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265320200423           MOVE WS-ARRAY10-MAX         TO  pp-Max-Size.
265330200423           MOVE WS-ARRAY10-MAX-USED    TO  pp-Max-Size-Used.
265340200423           MOVE SPACES                 TO  rp-Err-Flag.
265350200423
265360200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265370200423
265380200423           MOVE WS-ARRAY11-NAME        TO  pp-Array-Name.
265390200423           SET  WS-ARR-ACCASP          TO  TRUE.
265400200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265410200423           MOVE WS-ARRAY11-MAX         TO  pp-Max-Size.
265420200423           MOVE WS-ARRAY11-MAX-USED    TO  pp-Max-Size-Used.
265430200423           MOVE SPACES                 TO  rp-Err-Flag.
265440200423
265450200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265460200423
265470200423           MOVE WS-ARRAY12-NAME        TO  pp-Array-Name.
265480200423           SET  WS-ARR-ACCASP          TO  TRUE.
265490200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265500200423           MOVE WS-ARRAY12-MAX         TO  pp-Max-Size.
265510200423           MOVE WS-ARRAY12-MAX-USED    TO  pp-Max-Size-Used.
265520200423           MOVE SPACES                 TO  rp-Err-Flag.
265530200423
265540200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265550200423
265560200423           MOVE WS-ARRAY13-NAME        TO  pp-Array-Name.
265570200423           SET  WS-ARR-ISASLP          TO  TRUE.
265580200423           MOVE WS-FXLOGAT             TO  pp-Array-Edit-Code.
265590200423           MOVE WS-ARRAY13-MAX         TO  pp-Max-Size.
265600200423           MOVE WS-ARRAY13-MAX-USED    TO  pp-Max-Size-Used.
265610200423           MOVE SPACES                 TO  rp-Err-Flag.
265620200423
265630200423           CALL "FXLOGAU"      using PR-FXLOGAU.
265640200423           CANCEL "FXLOGAU".
265650200423       ARL-EXIT.
265660200423           EXIT.
265670200423      * RFS49699 - End
265680200423
265690200423      /
265700200423R27609 CHK-EC-ORDER SECTION.
265710200423
265720200423R27609 CEOS-EXIT.
265730200423R27609     EXIT.
265740200423
265750200423       FORMAT-CDSC-CALC-TRANSACTION SECTION.
265760200423R66894*FCCT-0020.
265770200423           INITIALIZE MFATRNP OF TRANS.
265780200423           MOVE PASS-CDSC-ACCOUNT
265790200423                               TO ACCOUNT-NO OF TRANS.
265800200423           MOVE PASS-CDSC-INVESTMENT
265810200423                               TO INVESTMENT-CODE OF TRANS.
265820200423           MOVE PASS-CDSC-TRADE-DATE
265830200423                               TO TRADE-DATE OF TRANS.
265840200423149620* Remove parameters PASS-WAIVE-GI-FLAG, PASS-OVR-REPLACE-AMT and
265850200423149620* PASS-OVR-PENALTY-AMT from CPTRNPST1 on local data area since
265860200423149620* it is in conflict with SWAPBACK in Web Service on the same
265870200423149620* locations.  Instead call program FXGICPRM to retreive the values.
265880200423138770* Initialize pass in override replacement amount and penalty amt
265890200423138770* to 0 if those 2 fields are not numeric.  This is to avoid issue
265900200423138770* that the program is calling from other programs other than
265910200423138770* SACDSCCLC.
265920200423149620*138770     IF PASS-OVR-REPLACE-AMT IS NOT NUMERIC
265930200423149620*138770        MOVE ZEROS   TO PASS-OVR-REPLACE-AMT
265940200423149620*138770     END-IF.
265950200423149620*138770     IF PASS-OVR-PENALTY-AMT IS NOT NUMERIC
265960200423149620*138770        MOVE ZEROS   TO PASS-OVR-PENALTY-AMT
265970200423149620*138770     END-IF.
265980200423
265990200423           IF PASS-SPLIT-OPTION IS EQUAL TO "$"
266000200423           AND PASS-CDSC-GROSS IS NOT EQUAL TO 0
266010200423              MOVE PASS-CDSC-GROSS
266020200423                               TO GROSS-AMT OF TRANS
266030200423              MOVE "$"         TO SPLIT-OPTION-CODE OF TRANS
266040200423              MOVE "G"         TO GROSS-OR-NET OF TRANS
266050200423      * RFS17466 - Begin
266060200423              IF PASS-CDSC-INVESTMENT NOT = SPACES
266070200423                PERFORM VA-GET-INV-PRODUCT
266080200423                IF GIC-INVESTMENT
266090200423                  PERFORM READ-GIC-CERTIFICATE-DETAILS
266100200423                  IF GROSS-AMT OF TRANS = CURRENT-CERTIFICATE-BALANCE
266110200423                                          OF GIC-CERTIFICATE-DETAILS
266120200423                    MOVE LT-A             TO PASS-SPLIT-OPTION
266130200423                                             SPLIT-OPTION-CODE OF TRANS
266140200423                    MOVE ZEROES           TO PASS-CDSC-GROSS
266150200423                                             GROSS-AMT OF TRANS
266160200423                  END-IF
266170200423                END-IF
266180200423              END-IF
266190200423      * RFS17466 - End
266200200423
266210200423           ELSE IF PASS-SPLIT-OPTION IS EQUAL TO "$"
266220200423           AND PASS-CDSC-NET   IS NOT EQUAL TO 0
266230200423              MOVE PASS-CDSC-NET
266240200423                               TO GROSS-AMT OF TRANS
266250200423                                  NET-AMT OF TRANS
266260200423              MOVE "$"         TO SPLIT-OPTION-CODE OF TRANS
266270200423              MOVE "N"         TO GROSS-OR-NET OF TRANS
266280200423
266290200423           ELSE IF PASS-SPLIT-OPTION IS EQUAL TO "U"
266300200423              MOVE PASS-CDSC-UNITS
266310200423                               TO UNIT-AMT OF TRANS
266320200423              MOVE "U"         TO SPLIT-OPTION-CODE OF TRANS
266330200423              MOVE "G"         TO GROSS-OR-NET OF TRANS
266340200423
266350200423           ELSE IF PASS-SPLIT-OPTION IS EQUAL TO "%"
266360200423             MOVE PASS-CDSC-GROSS
266370200423                               TO PERCENT-AMT OF TRANS
266380200423             MOVE ZEROES       TO GROSS-AMT OF TRANS
266390200423                                  NET-AMT   OF TRANS
266400200423              MOVE "%"         TO SPLIT-OPTION-CODE OF TRANS
266410200423              MOVE "G"         TO GROSS-OR-NET OF TRANS
266420200423           END-IF.
266430200423
266440200423           MOVE "9000"         TO DEALER-CODE OF TRANS.
266450200423           MOVE PASS-REDEM-CODE
266460200423                               TO CONTR-REDEM-CODE OF TRANS.
266470200423           MOVE "SEL"          TO TRANS-TYPE-CODE OF TRANS.
266480200423           MOVE "PND"          TO TRANS-STATUS-CODE OF TRANS.
266490200423      * RFS18672 - Begin
266500200423           MOVE "DIR"          TO TRANS-ORIGIN-CODE OF TRANS.
266510200423      * RFS18672 - End
266520200423
266530200423      * RFS21772 - Begin
266540200423      * Some new parameters are coming through LDA and need to be
266550200423      * moved to current transaction.
266560200423           IF SW-CALC-NO-UPDATES
266570200423      * RFS15626 - Begin
266580200423      *     MOVE PASS-TRANS-TYPE-CODE   TO TRANS-TYPE-CODE OF TRANS
266590200423            MOVE PASS-TRANS-TYPE-CODE OF WS-LOCAL-DATA-AREA   TO
266600200423                                           TRANS-TYPE-CODE OF TRANS
266610200423      * RFS15626 - End
266620200423            MOVE PASS-TRANS-ORIGIN-CODE TO TRANS-ORIGIN-CODE OF TRANS
266630200423            MOVE PASS-TRANS-STATUS-CODE TO TRANS-STATUS-CODE OF TRANS
266640200423           END-IF
266650200423      * RFS21772 - End
266660200423
266670200423           IF SPLIT-OPTION-CODE OF TRANS IS EQUAL " "
266680200423             MOVE PASS-SPLIT-OPTION
266690200423                               TO SPLIT-OPTION-CODE OF TRANS
266700200423             MOVE "G"          TO GROSS-OR-NET OF TRANS
266710200423           END-IF.
266720200423
266730200423      * RFS13839 - Begin
266740200423           SET COMM-SET-GET           TO TRUE
266750200423           MOVE PASS-CDSC-ACCOUNT     TO COMM-ACCOUNT-NO
266760200423      * RFS17180 - Begin
266770200423                                         OF COMM-SETCDSCCPY
266780200423      * RFS17180 - End
266790200423           MOVE PASS-CDSC-INVESTMENT  TO COMM-INVESTMENT-CODE
266800200423      * RFS17180 - Begin
266810200423                                         OF COMM-SETCDSCCPY
266820200423      * RFS44008 - Begin
266830200423      * RFS66894 - Begin: valide if parameter is numeric
266840200423           IF PASS-CERT-ID IS NOT NUMERIC
266850200423             MOVE ZEROES        TO PASS-CERT-ID-N
266860200423           END-IF
266870200423      * RFS66894 - End
266880200423           MOVE PASS-CERT-ID-N        TO
266890200423                  COMM-CERTIFICATE-ID-NO OF COMM-SETCDSCCPY
266900200423      * RFS44008 - End
266910200423      * RFS17180 - End
266920200423149620     INITIALIZE FXGICPRM-PARMS.
266930200423149620     MOVE "N"   TO lc_GICWaive.
266940200423149620     IF PASS-CERT-ID-N > 0
266950200423149620          MOVE PASS-CDSC-ACCOUNT TO ln_Account_No
266960200423149620          MOVE PASS-CERT-ID-N    TO ln_CertID_No
266970200423149620          CALL "FXGICPRM" USING
266980200423149620                           ln_Account_No
266990200423149620                           ln_CertID_No
267000200423149620                           lc_GICWaive
267010200423149620                           ln_PenaltyAmt
267020200423149620                           ln_ReplaceAmt
267030200423149620                           lc_ErrCode
267040200423149620          CANCEL "FXGICPRM"
267050200423149620          IF lc_ErrCode Not = "00"
267060200423149620             MOVE "N" TO lc_GICWaive
267070200423149620             MOVE 0   TO ln_PenaltyAmt
267080200423149620             MOVE 0   TO ln_ReplaceAmt
267090200423149620          END-IF
267100200423149620     END-IF.
267110200423      * RFS21772 - Begin
267120200423           IF NOT SW-CALC-NO-UPDATES
267130200423      * RFS21772 - End
267140200423      * RFS32409 - Start
267150200423      * RFS50832 - Begin: for SOA get the ref# from LDA
267160200423            IF lnc_calcSoa    OR
267170200423               lnc_calcSoaUpd
267180200423             MOVE PASS-GEN-PLACEMENT-DATE TO PLACEMENT-DATE OF TRANS
267190200423             MOVE PASS-GEN-TRANS-NO       TO TRANS-NO       OF TRANS
267200200423            ELSE
267210200423      *    AND NOT lnc_calcSoa
267220200423      * RFS50832 - End
267230200423      * RFS32409 - End
267240200423             CALL "SETCDSCTRN" USING
267250200423                                  COMM-SETCDSCCPY
267260200423             MOVE COMM-PLACEMENT-DATE   TO PLACEMENT-DATE OF TRANS
267270200423             MOVE COMM-TRANS-NO         TO TRANS-NO       OF TRANS
267280200423      * RFS21772 - Begin
267290200423           END-IF.
267300200423      * RFS21772 - End
267310200423      * RFS13839 - End
267320200423
267330200423      * RFS26598 - Start
267340200423      *** Write a record in qtemp for trans-redem-details to waive
267350200423      *** DSC/ERF for calculator.
267360200423      * RFS32409 - Start: for SOA  just init detail File
267370200423           IF lnc_calcSoa
267380200423      * RFS50832 - Begin
267390200423            OR lnc_calcSoaUpd
267400200423      * RFS50832 - End
267410200423             INITIALIZE MFATRNREP OF TRANS-REDEM-DETAILS-REC
267420200423                        MFATRNREP OF TRANS-REDEMPTION-DETAILS-REC
267430200423           END-IF
267440200423      * RFS32409 - Start
267450200423           IF PASS-WAIVE-ERF = "Y" OR PASS-WAIVE-DSC = "Y"
267460200423              INITIALIZE MFATRNREP OF TRANS-REDEM-DETAILS-REC
267470200423              MOVE PLACEMENT-DATE  OF TRANS
267480200423                TO PLACEMENT-DATE  OF TRANS-REDEM-DETAILS-REC
267490200423              MOVE TRANS-NO        OF TRANS
267500200423                TO TRANS-NO        OF TRANS-REDEM-DETAILS-REC
267510200423              MOVE PASS-WAIVE-DSC
267520200423                TO WAIVE-DSC       OF TRANS-REDEM-DETAILS-REC
267530200423              MOVE PASS-WAIVE-ERF
267540200423                TO WAIVE-ERF       OF TRANS-REDEM-DETAILS-REC
267550200423              MOVE PASS-TREAT-AWD
267560200423                TO TREAT-TXN-AS-AWD OF TRANS-REDEM-DETAILS-REC
267570200423      * RFS32409 - Start: for SOA do not update files
267580200423              IF lnc_calcSoa
267590200423      * RFS50832 - Begin
267600200423               OR lnc_calcSoaUpd
267610200423      * RFS50832 - End
267620200423                MOVE TRANS-REDEM-DETAILS-REC   TO
267630200423                           TRANS-REDEMPTION-DETAILS-REC
267640200423              ELSE
267650200423      * RFS32409 - End
267660200423                WRITE TRANS-REDEM-DETAILS-REC
26767020042358714           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
26768020042358714              MOVE "MFATRNREP" TO WS-FILE-STATUS-FILE-NAME
26769020042358714              SET lncc_Err134  TO  TRUE
26770020042358714              PERFORM LOG-FILE-STATUS
26771020042358714           END-IF
267720200423      * RFS32409 - Start: for SOA do not update files
267730200423              END-IF
267740200423      * RFS32409 - End
267750200423           END-IF.
267760200423      * RFS26598 - End
267770200423R66894 FCCT1-EXIT.
267780200423           EXIT.
267790200423      * RFS17466 - Begin
267800200423      * ---------------------------------
267810200423       READ-GIC-CERTIFICATE-DETAILS SECTION.
267820200423      * ---------------------------------
267830200423      * Read Certificate Details Data in calculator mode
267840200423           IF PASS-CERT-ID IS NOT NUMERIC
267850200423             MOVE ZEROES        TO PASS-CERT-ID-N
267860200423           END-IF
267870200423
267880200423           MOVE PASS-CERT-ID-N  TO
267890200423                CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
267900200423           READ GIC-CERTIFICATE-DETAILS WITH NO LOCK
267910200423             INVALID KEY
267920200423               INITIALIZE MFAGICDP OF GIC-CERTIFICATE-DETAILS
267930200423           END-READ.
267940200702      *RFS184842 Starts
267950200824           IF CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS NOT =
267960200824              ZEROES
267970200824              MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS TO
267980200824                   pi_MultiGICCertNo
267990210730      *RFS1117871 Starts
268000210730      *       INITIALIZE pc_MultiGICInd
268010210730      *RFS1117871 Ends
268020201009      *RFS1104781 Starts
268030201009                       , pd_MulPlacementdate
268040201009                       , pi_MulTransNo
268050201009              MOVE PLACEMENT-DATE OF TRANS TO pd_MulPlacementdate
268060201009              MOVE TRANS-NO OF TRANS       TO pi_MulTransNo
268070201009      *RFS1104781 Ends
268080200824              SET lb_GICMultiInsNo  TO TRUE
268090210727      *RFS1117871 Starts
268100210727              IF  PASS-CERT-ID NOT = SPACES
268110210727              AND CAPITAL-PAYMENT-OPTION OF GIC-CERTIFICATE-DETAILS
268120210727                  = SPACES
268130210727                  SET lb_GICMultiInsYes  TO TRUE
268140210727              END-IF
268150210727              IF lb_GICMultiInsYes
268160210727      *RFS1117871 Ends
268170200824              CALL "FXCKMULGIC" USING  pi_MultiGICCertNo
268180201004      *RFS1104781 Starts
268190201004                                       pd_MulPlacementdate
268200201004                                       pi_MulTransNo
268210201004      *RFS1104781 Ends
268220210727      *RFS1117871 Starts
268230210727      *                                pc_MultiGICInd
268240210727              END-IF
268250210727      *       IF pc_MultiGICInd = "Y"
268260210727      *         SET lb_GICMultiInsYes TO TRUE
268270210727      *       ELSE
268280210727      *         SET lb_GICMultiInsNo  TO TRUE
268290210727      *       END-IF
268300210727      *RFS1117871 Ends
268310200704           END-IF.
268320200702      *RFS184842 Ends
268330200702
268340200423       RGCD-EXIT.
268350200423           EXIT.
268360200423      * RFS17466 - End
268370200423      /
268380200423139288*Moved the section UPDATE-CDSC-CALC-PASS-AREA to CPUPDCDSC.
268390200423139288     COPY CPYUPDCDSC.
268400200423      /
268410200423R24192     COPY CPYTPSEG.
268420200423      /
268430200423       ROLLBACK-CDSC-LSIF-RECORDS SECTION.
268440200423
268450200423R83863     INITIALIZE MFATRNRDP OF TRANS-CDSC-PURCH-REDUCTION.
268460200423
268470200423      * RFS13839 - Begin
268480200423      *    IF PASS-CDSC-CALCULATOR = "C"
268490200423      *    OR  WS-PASS-SWITCH-EDIT IS EQUAL "1"
268500200423           IF  WS-PASS-SWITCH-EDIT IS EQUAL "1"
268510200423             GO TO RCL-EXIT
268520200423           END-IF.
268530200423      * RFS13839 - End
268540200423
268550200423      * RFS21772 - Begin
268560200423           IF SW-CALC-NO-UPDATES
268570200423      * RFS32409 - Start
268580200423            OR lnc_calcSoa
268590200423      * RFS32409 - End
268600200423             GO TO RCL-EXIT
268610200423           END-IF
268620200423      * RFS21772 - End
268630200423
268640200423           MOVE PLACEMENT-DATE OF TRANS
268650200423                              TO PLACEMENT-DATE
268660200423                              OF TRANS-CDSC-PURCH-REDUCTION.
268670200423           MOVE TRANS-NO OF TRANS
268680200423                              TO TRANS-NO
268690200423                              OF TRANS-CDSC-PURCH-REDUCTION.
268700200423           MOVE ZERO          TO CDSC-SEQ-NO
268710200423                              OF TRANS-CDSC-PURCH-REDUCTION.
268720200423           START TRANS-CDSC-PURCH-REDUCTION
268730200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
268740200423           INVALID KEY
268750200423             GO TO RCL-EXIT1
268760200423           END-START.
268770200423
268780200423       RCL-NEXT.
268790200423
268800200423           READ TRANS-CDSC-PURCH-REDUCTION NEXT RECORD
268810200423           WITH NO LOCK
268820200423           AT END
268830200423             GO TO RCL-EXIT1
268840200423           END-READ.
268850200423
268860200423           IF PLACEMENT-DATE OF TRANS-CDSC-PURCH-REDUCTION
268870200423           IS NOT EQUAL PLACEMENT-DATE OF TRANS            OR
268880200423              TRANS-NO OF TRANS-CDSC-PURCH-REDUCTION
268890200423           IS NOT EQUAL TRANS-NO OF TRANS
268900200423             GO TO RCL-EXIT1
268910200423           END-IF.
268920200423
268930200423           MOVE PLACEMENT-DATE-2 OF TRANS-CDSC-PURCH-REDUCTION
268940200423                             TO PLACEMENT-DATE
268950200423                             OF TRANS-CDSC-PUR-PRIMARY.
268960200423           MOVE TRANS-NO-2 OF TRANS-CDSC-PURCH-REDUCTION
268970200423                             TO TRANS-NO
268980200423                             OF TRANS-CDSC-PUR-PRIMARY.
268990200423           MOVE CDSC-SEQ-NO-2 OF TRANS-CDSC-PURCH-REDUCTION
269000200423                             TO CDSC-SEQ-NO
269010200423                             OF TRANS-CDSC-PUR-PRIMARY.
269020200423
269030200423           READ TRANS-CDSC-PUR-PRIMARY WITH NO LOCK
269040200423           INVALID KEY
269050200423             GO TO RCL-NEXT
269060200423           END-READ.
269070200423
269080200423           ADD FREE-UNITS-TAKEN-DOWN OF TRANS-CDSC-PURCH-REDUCTION
269090200423                             TO CURR-UNITS-FREE
269100200423                             OF TRANS-CDSC-PUR-PRIMARY
269110200423                                CURR-UNIT-BAL
269120200423                             OF TRANS-CDSC-PUR-PRIMARY.
269130200423
269140200423           ADD CHRG-UNITS-TAKEN-DOWN OF TRANS-CDSC-PURCH-REDUCTION
269150200423                             TO CURR-UNITS-CHRG
269160200423                             OF TRANS-CDSC-PUR-PRIMARY
269170200423                                CURR-UNIT-BAL
269180200423                             OF TRANS-CDSC-PUR-PRIMARY.
269190200423
269200200423           MOVE "A"          TO CDSC-STATUS OF TRANS-CDSC-PUR-PRIMARY.
269210200423
269220200423      *    RFS71433 -Begin
269230200423      *    RFS71433.1 -Begin
269240200423      *      Perform UpdTransPurFreeUnits.
269250200423      *    RFS71433.1 -End
269260200423      *    RFS71433 -End
269270200423           REWRITE TRANS-CDSC-PUR-PRIMARY-REC.
269280200423
26929020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
26930020042358714         MOVE "MFATRNCPP" TO WS-FILE-STATUS-FILE-NAME
26931020042358714         SET lncc_Err135  TO  TRUE
26932020042358714         PERFORM LOG-FILE-STATUS
26933020042358714      END-IF.
269340200423
269350200423           DELETE TRANS-CDSC-PURCH-REDUCTION RECORD.
269360200423
26937020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
26938020042358714         MOVE "MFATRNRDP" TO WS-FILE-STATUS-FILE-NAME
26939020042358714         SET lncc_Err136  TO  TRUE
26940020042358714         PERFORM LOG-FILE-STATUS
26941020042358714      END-IF.
269420200423
269430200423           GO TO RCL-NEXT.
269440200423
269450200423       RCL-EXIT1.
269460200423      * RFS13839 - Begin
269470200423           IF PASS-CDSC-CALCULATOR = "C"
269480200423           OR  WS-PASS-SWITCH-EDIT IS EQUAL "1"
269490200423             GO TO RCL-EXIT
269500200423           END-IF.
269510200423      * RFS13839 - End
269520200423
269530200423           MOVE PLACEMENT-DATE OF TRANS
269540200423                              TO PLACEMENT-DATE
269550200423                              OF TRANS-SELL-LSIF-PRIMARY.
269560200423           MOVE TRANS-NO OF TRANS
269570200423                              TO TRANS-NO
269580200423                              OF TRANS-SELL-LSIF-PRIMARY.
269590200423           MOVE ZERO          TO LSIF-SEQ-NO
269600200423                              OF TRANS-SELL-LSIF-PRIMARY.
269610200423
269620200423           START TRANS-SELL-LSIF-PRIMARY
269630200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
269640200423           INVALID KEY
269650200423             GO TO RCL-EXIT
269660200423           END-START.
269670200423
269680200423       RCL-NEXT1.
269690200423
269700200423           READ TRANS-SELL-LSIF-PRIMARY NEXT RECORD
269710200423           WITH NO LOCK
269720200423           AT END
269730200423             GO TO RCL-EXIT
269740200423           END-READ.
269750200423
269760200423           IF PLACEMENT-DATE OF TRANS-SELL-LSIF-PRIMARY
269770200423           IS NOT EQUAL PLACEMENT-DATE OF TRANS            OR
269780200423              TRANS-NO OF TRANS-SELL-LSIF-PRIMARY
269790200423           IS NOT EQUAL TRANS-NO OF TRANS
269800200423             GO TO RCL-EXIT
269810200423           END-IF.
269820200423
269830200423           MOVE PLACEMENT-DATE-2 OF TRANS-SELL-LSIF-PRIMARY
269840200423                             TO PLACEMENT-DATE
269850200423                             OF TRANS-BUY-LSIF-PRIMARY.
269860200423           MOVE TRANS-NO-2 OF TRANS-SELL-LSIF-PRIMARY
269870200423                             TO TRANS-NO
269880200423                             OF TRANS-BUY-LSIF-PRIMARY.
269890200423           MOVE LSIF-SEQ-NO-2 OF TRANS-SELL-LSIF-PRIMARY
269900200423                             TO LSIF-SEQ-NO
269910200423                             OF TRANS-BUY-LSIF-PRIMARY.
269920200423
269930200423           READ TRANS-BUY-LSIF-PRIMARY
269940200423           WITH NO LOCK
269950200423           INVALID KEY
269960200423             GO TO RCL-NEXT1
269970200423           END-READ.
269980200423
269990200423           ADD UNITS-REDUCED OF TRANS-SELL-LSIF-PRIMARY
270000200423                             TO CURR-UNIT-BAL
270010200423                             OF TRANS-BUY-LSIF-PRIMARY.
270020200423
270030200423      *RFS 18191 Begin
270040200423      *    MOVE "A"          TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY.
270050200423           MOVE LSIF-STATUS  OF TRANS-SELL-LSIF-PRIMARY
270060200423                             TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY.
270070200423      *RFS 18191 End
270080200423
270090200423           REWRITE TRANS-BUY-LSIF-PRI-REC.
270100200423
27011020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27012020042358714         MOVE "MFATBLP" TO WS-FILE-STATUS-FILE-NAME
27013020042358714         SET lncc_Err137  TO  TRUE
27014020042358714         PERFORM LOG-FILE-STATUS
27015020042358714      END-IF.
270160200423
270170200423           DELETE TRANS-SELL-LSIF-PRIMARY RECORD.
270180200423
27019020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27020020042358714         MOVE "MFATSLP" TO WS-FILE-STATUS-FILE-NAME
27021020042358714         SET lncc_Err138  TO  TRUE
27022020042358714         PERFORM LOG-FILE-STATUS
27023020042358714      END-IF.
270240200423
270250200423           GO TO RCL-NEXT1.
270260200423
270270200423       RCL-EXIT.
270280200423           EXIT.
270290200423      /
270300200423       GET-HH-REDEMPTION-RATE SECTION.
270310200423
270320200423           IF PASS-CDSC-CALCULATOR IS NOT EQUAL TO "C"
270330200423             IF   PLACEMENT-DATE OF TRANS =
270340200423                                  WS-HH-PLACEMENT-DT
270350200423             AND  TRANS-NO OF TRANS =
270360200423                                  WS-HH-TRANS-NO
270370200423               GO TO GERR-EXIT
270380200423             END-IF
270390200423           END-IF.
270400200423
270410200423           MOVE ZERO         TO WS-HH-REDEM-RATE.
270420200423           MOVE INVESTMENT-CODE OF TRANS
270430200423                             TO INVESTMENT-CODE
270440200423                             OF INVESTMENT-REDEM-FEE-SCHED.
270450200423
270460200423           READ INVESTMENT-REDEM-FEE-SCHED
270470200423           INVALID KEY
270480200423             GO TO GERR-EXIT
270490200423           END-READ.
270500200423
270510200423           IF REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
270520200423           IS EQUAL SPACES
270530200423             GO TO GERR-EXIT
270540200423           END-IF.
270550200423
270560200423           MOVE INVESTOR-NO  OF ACCOUNT
270570200423                             TO HHLD-VALUATION-HH-INVESTOR.
270580200423           MOVE REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
270590200423                             TO HHLD-VALUATION-SCHED-CODE.
270600200423           MOVE "AGR"        TO HHLD-VALUATION-HH-LINKAGE.
270610200423           MOVE 0            TO HHLD-TOTAL-VALUE-N.
270620200423
270630200423           CALL "CALHHVAL" USING   HHLD-VALUATION-HH-LINKAGE,
270640200423                                   HHLD-VALUATION-SCHED-CODE,
270650200423                                   HHLD-VALUATION-HH-INVESTOR,
270660200423                                   HHLD-TOTAL-VALUE.
270670200423           CANCEL "CALHHVAL".
270680200423
270690200423           MOVE REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
270700200423                             TO REDEM-FEE-SCHED-CODE
270710200423                             OF REDEM-FEE-RATE-SCHED-DTL.
270720200423           MOVE HHLD-TOTAL-VALUE-N
270730200423                             TO UPPER-LIMIT
270740200423                             OF REDEM-FEE-RATE-SCHED-DTL.
270750200423
270760200423           START REDEM-FEE-RATE-SCHED-DTL
270770200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
270780200423           INVALID KEY
270790200423             GO TO GERR-EXIT
270800200423           END-START.
270810200423
270820200423           READ REDEM-FEE-RATE-SCHED-DTL NEXT RECORD
270830200423           AT END
270840200423             GO TO GERR-EXIT
270850200423           END-READ.
270860200423
270870200423           IF REDEM-FEE-SCHED-CODE
270880200423                             OF REDEM-FEE-RATE-SCHED-DTL
270890200423           IS NOT EQUAL REDEM-FEE-SCHED-CODE
270900200423                             OF INVESTMENT-REDEM-FEE-SCHED
270910200423             GO TO GERR-EXIT
270920200423           END-IF.
270930200423
270940200423           MOVE REDEM-RATE OF REDEM-FEE-RATE-SCHED-DTL
270950200423                             TO WS-HH-REDEM-RATE.
270960200423
270970200423           MOVE PLACEMENT-DATE OF TRANS
270980200423                             TO WS-HH-PLACEMENT-DT.
270990200423           MOVE TRANS-NO OF TRANS
271000200423                             TO WS-HH-TRANS-NO.
271010200423
271020200423       GERR-0100.
271030200423
271040200423           PERFORM CALCULATE-HH-MAX-REDEM-AMT.
271050200423
271060200423       GERR-EXIT.
271070200423           EXIT.
271080200423      /
271090200423       CALCULATE-HH-MAX-REDEM-AMT SECTION.
271100200423
271110200423           MOVE REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
271120200423                             TO REDEM-FEE-SCHED-CODE
271130200423                             OF REDEM-FEE-RATE-SCHED-HEADER.
271140200423
271150200423           READ REDEM-FEE-RATE-SCHED-HEADER
271160200423           INVALID KEY
271170200423             DISPLAY "ERROR READING REDEM SCHED HEADER ",
271180200423             REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
271190200423             MOVE ZERO       TO WS-HH-REDEM-RATE
271200200423             MOVE ZERO       TO WS-HH-REDEM-RATE-MAX
271210200423             MOVE ZERO       TO WS-HH-MAX-RED-AMT
271220200423             GO TO CMRA-EXIT
271230200423           END-READ.
271240200423
271250200423           MOVE MAX-RATE-ALLOWED OF  REDEM-FEE-RATE-SCHED-HEADER
271260200423                             TO WS-HH-REDEM-RATE-MAX.
271270200423
271280200423           MOVE ACCOUNT-NO OF TRANS
271290200423                             TO ACCOUNT-NO
271300200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
271310200423           MOVE INVESTMENT-CODE OF TRANS
271320200423                             TO INVESTMENT-CODE
271330200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
271340200423
271350200423           READ ACCT-INVEST-REDFEE-BASIS-AMT
271360200423           INVALID KEY
271370200423             MOVE ZERO       TO WS-HH-REDEM-RATE
271380200423             MOVE ZERO       TO WS-HH-REDEM-RATE-MAX
271390200423             MOVE ZERO       TO WS-HH-MAX-RED-AMT
271400200423             GO TO CMRA-EXIT
271410200423           END-READ.
271420200423
271430200423           COMPUTE WS-HH-MAX-RED-AMT ROUNDED =
271440200423           (((LTD-PUR OF ACCT-INVEST-REDFEE-BASIS-AMT *
271450200423           (WS-HH-REDEM-RATE-MAX / 100))
271460200423           - LTD-REDFEE OF ACCT-INVEST-REDFEE-BASIS-AMT)).
271470200423
271480200423       CMRA-EXIT.
271490200423           EXIT.
271500200423      /
271510200423       CALCULATE-HH-REDEM-FEE SECTION.
271520200423
271530200423           IF WS-TAX-HH-REDFEE-APPLICABLE IS EQUAL "1"
271540200423             MOVE TRANS-REC  TO WS-TRANS-REC-4
271550200423             MOVE WS-TRANS-REC-3
271560200423                             TO TRANS-REC
271570200423           END-IF.
271580200423
271590200423           PERFORM GET-HH-REDEMPTION-RATE.
271600200423
271610200423           COMPUTE WS-HH-RED-AMT ROUNDED = GROSS-AMT OF TRANS *
271620200423           (WS-HH-REDEM-RATE / 100).
271630200423      *RFS 20515 Start
271640200423           MOVE WS-HH-REDEM-RATE TO WS-HRDF-RATE.
271650200423      *RFS 20515 End
271660200423
271670200423           IF WS-HH-RED-AMT IS GREATER THAN WS-HH-MAX-RED-AMT
271680200423             MOVE WS-HH-MAX-RED-AMT
271690200423                             TO WS-HH-RED-AMT
271700200423           END-IF.
271710200423
271720200423           IF WS-TAX-HH-REDFEE-APPLICABLE = "1"
271730200423             MOVE TRANS-REC  TO WS-TRANS-REC-3
271740200423             MOVE WS-TRANS-REC-4
271750200423                             TO TRANS-REC OF TRANS
271760200423             MOVE "0"        TO WS-TAX-HH-REDFEE-APPLICABLE
271770200423           END-IF.
271780200423
271790200423       CHRF-EXIT.
271800200423           EXIT.
271810200423      /
271820200423       COMPUTE-HH-SWITCH-OUT-VALUES SECTION.
271830200423
271840200423
271850200423           MOVE ZERO         TO WS-HH-SWITCH-OUT-FEE
271860200423                                WS-HH-SWITCH-OUT-DEP.
271870200423
271880200423           MOVE ACCOUNT-NO OF TRANS
271890200423                             TO ACCOUNT-NO
271900200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
271910200423           MOVE INVESTMENT-CODE OF TRANS
271920200423                             TO INVESTMENT-CODE
271930200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
271940200423
271950200423           READ ACCT-INVEST-REDFEE-BASIS-AMT
271960200423           INVALID KEY
271970200423             GO TO CHSO-EXIT
271980200423           END-READ
271990200423
272000200423           COMPUTE WS-HH-SWITCH-OUT-DEP ROUNDED =
272010200423           ((UNIT-AMT OF TRANS /
272020200423            (CURR-UNIT-BAL OF ACCOUNT-INVESTMENT + UNIT-AMT OF TRANS)) *
272030200423           LTD-PUR OF ACCT-INVEST-REDFEE-BASIS-AMT).
272040200423
272050200423           COMPUTE WS-HH-SWITCH-OUT-FEE ROUNDED =
272060200423           ((UNIT-AMT OF TRANS /
272070200423            (CURR-UNIT-BAL OF ACCOUNT-INVESTMENT + UNIT-AMT OF TRANS)) *
272080200423           LTD-REDFEE OF ACCT-INVEST-REDFEE-BASIS-AMT).
272090200423
272100200423           COMPUTE LTD-PUR OF ACCT-INVEST-REDFEE-BASIS-AMT =
272110200423                   LTD-PUR OF ACCT-INVEST-REDFEE-BASIS-AMT -
272120200423                   WS-HH-SWITCH-OUT-DEP.
272130200423
272140200423           COMPUTE LTD-REDFEE OF ACCT-INVEST-REDFEE-BASIS-AMT =
272150200423                   LTD-REDFEE OF ACCT-INVEST-REDFEE-BASIS-AMT -
272160200423                   WS-HH-SWITCH-OUT-FEE.
272170200423
272180200423           MOVE PLACEMENT-DATE OF TRANS
272190200423                             TO PLACEMENT-DATE
272200200423                             OF TRANS-REDFEE-DEP-XFR.
272210200423           MOVE TRANS-NO OF TRANS
272220200423                             TO TRANS-NO
272230200423                             OF TRANS-REDFEE-DEP-XFR.
272240200423           MOVE WS-HH-SWITCH-OUT-DEP
272250200423                             TO AMOUNT-TRANSFERED
272260200423                             OF TRANS-REDFEE-DEP-XFR.
272270200423           MOVE WS-HH-SWITCH-OUT-FEE
272280200423                             TO FEE-TRANSFERED
272290200423                             OF TRANS-REDFEE-DEP-XFR.
272300200423
272310200423           MOVE "W"          TO WRITE-TRANS-RED-DEP-XFR.
272320200423           MOVE "R"          TO WRITE-ACCT-INVEST-BASIS.
272330200423
272340200423
272350200423       CHSO-EXIT.
272360200423           EXIT.
272370200423      /
272380200423       COMPUTE-HH-SWITCH-IN-VALUES SECTION.
272390200423
272400200423           MOVE "R"          TO WRITE-ACCT-INVEST-BASIS.
272410200423           MOVE ACCOUNT-NO OF TRANS
272420200423                             TO ACCOUNT-NO
272430200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
272440200423           MOVE INVESTMENT-CODE OF TRANS
272450200423                             TO INVESTMENT-CODE
272460200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
272470200423
272480200423           READ ACCT-INVEST-REDFEE-BASIS-AMT
272490200423           INVALID KEY
272500200423             MOVE "W"      TO WRITE-ACCT-INVEST-BASIS
272510200423           END-READ.
272520200423
272530200423           IF WRITE-ACCT-INVEST-BASIS = "W"
272540200423             MOVE ACCOUNT-NO OF TRANS
272550200423                             TO ACCOUNT-NO
272560200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
272570200423             MOVE INVESTMENT-CODE OF TRANS
272580200423                             TO INVESTMENT-CODE
272590200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
272600200423             MOVE ZEROES     TO LTD-PUR
272610200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
272620200423             MOVE ZEROES     TO LTD-REDFEE
272630200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
272640200423           END-IF.
272650200423
272660200423           ADD WS-HH-SWITCH-OUT-DEP
272670200423                             TO LTD-PUR
272680200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
272690200423           ADD WS-HH-SWITCH-OUT-FEE
272700200423                             TO LTD-REDFEE
272710200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
272720200423
272730200423           MOVE PLACEMENT-DATE OF TRANS
272740200423                             TO PLACEMENT-DATE
272750200423                             OF TRANS-REDFEE-DEP-XFR.
272760200423           MOVE TRANS-NO OF TRANS
272770200423                             TO TRANS-NO
272780200423                             OF TRANS-REDFEE-DEP-XFR.
272790200423           MOVE WS-HH-SWITCH-OUT-DEP
272800200423                             TO AMOUNT-TRANSFERED
272810200423                             OF TRANS-REDFEE-DEP-XFR.
272820200423           MOVE WS-HH-SWITCH-OUT-FEE
272830200423                             TO FEE-TRANSFERED
272840200423                             OF TRANS-REDFEE-DEP-XFR.
272850200423
272860200423           MOVE "W"          TO WRITE-TRANS-RED-DEP-XFR.
272870200423
272880200423       CHSI-EXIT.
272890200423           EXIT.
272900200423      /
272910200423       COMPUTE-HH-REDFEE-CALC-DET SECTION.
272920200423
272930200423           MOVE PLACEMENT-DATE OF TRANS
272940200423                             TO PLACEMENT-DATE
272950200423                             OF TRANS-REDFEE-CALC-DETAILS.
272960200423           MOVE TRANS-NO OF TRANS
272970200423                             TO TRANS-NO
272980200423                             OF TRANS-REDFEE-CALC-DETAILS.
272990200423           MOVE HHLD-TOTAL-VALUE-N
273000200423                             TO ASSESS-BASED-ON-AMT
273010200423                             OF TRANS-REDFEE-CALC-DETAILS.
273020200423
273030200423           IF BACK-END-LOAD
273040200423             MOVE WS-CDSC-AMOUNT
273050200423                             TO CALCULATED-ASSESSMENT
273060200423                             OF TRANS-REDFEE-CALC-DETAILS
273070200423           ELSE
273080200423             MOVE WS-HH-RED-AMT
273090200423                             TO CALCULATED-ASSESSMENT
273100200423                             OF TRANS-REDFEE-CALC-DETAILS
273110200423           END-IF.
273120200423
273130200423           MOVE WS-HH-REDEM-RATE
273140200423                             TO ASSESSMENT-RATE-USED
273150200423                             OF TRANS-REDFEE-CALC-DETAILS.
273160200423
273170200423           MOVE REDEM-FEE-SCHED-CODE OF INVESTMENT-REDEM-FEE-SCHED
273180200423                             TO REDEM-FEE-SCHED-CODE
273190200423                             OF TRANS-REDFEE-CALC-DETAILS.
273200200423
273210200423           IF WS-HH-MAX-RED-AMT IS EQUAL TO WS-HH-RED-AMT
273220200423             MOVE "Y"        TO MAX-USED
273230200423                             OF TRANS-REDFEE-CALC-DETAILS
273240200423           ELSE
273250200423             MOVE "N"        TO MAX-USED
273260200423                             OF TRANS-REDFEE-CALC-DETAILS
273270200423           END-IF.
273280200423
273290200423           MOVE "W"          TO WRITE-TXN-REDFEE-CALC-DT.
273300200423
273310200423       CHRCD-EXIT.
273320200423           EXIT.
273330200423      /
273340200423       COMPUTE-HH-DEPOSIT-CALC-DET SECTION.
273350200423
273360200423           MOVE "R"          TO WRITE-ACCT-INVEST-BASIS.
273370200423           MOVE ACCOUNT-NO OF TRANS
273380200423                             TO ACCOUNT-NO
273390200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
273400200423           MOVE INVESTMENT-CODE OF TRANS
273410200423                             TO INVESTMENT-CODE
273420200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT.
273430200423
273440200423           READ ACCT-INVEST-REDFEE-BASIS-AMT
273450200423           INVALID KEY
273460200423             MOVE "W"        TO WRITE-ACCT-INVEST-BASIS
273470200423             MOVE ACCOUNT-NO OF TRANS
273480200423                             TO ACCOUNT-NO
273490200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273500200423             MOVE INVESTMENT-CODE OF TRANS
273510200423                             TO INVESTMENT-CODE
273520200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273530200423             MOVE ZEROES     TO LTD-PUR
273540200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273550200423             MOVE ZEROES     TO LTD-REDFEE
273560200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273570200423           END-READ.
273580200423
273590200423           IF PURCHASE-TRANSACTION OR DISTRIBUTION-TRANSACTION
273600200423             ADD GROSS-AMT OF TRANS
273610200423                             TO LTD-PUR
273620200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273630200423           END-IF.
273640200423
273650200423           IF REDEMPTION-TRANSACTION
273660200423             ADD WS-HH-RED-AMT
273670200423                             TO LTD-REDFEE
273680200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273690200423             ADD WS-CDSC-AMOUNT
273700200423                             TO LTD-REDFEE
273710200423                             OF ACCT-INVEST-REDFEE-BASIS-AMT
273720200423           END-IF.
273730200423
273740200423       CHDCD-EXIT.
273750200423           EXIT.
273760200423
273770200423      *GIC MOD
273780200423      *Moved GET-GIC-CERTIFICATE SECTION TO CPYTPGIC.
273790200423
273800200423       GET-NEXT-PROCESS-DATE SECTION.
273810200423
273820200423            START BUSINESS-DAYS
273830200423              KEY IS GREATER THAN EXTERNALLY-DESCRIBED-KEY
273840200423              INVALID KEY
273850200423              MOVE HIGH-VALUES  TO CURR-CONTROLS
273860200423              GO TO INL-EXIT.
273870200423
273880200423       GNPD-0010.
273890200423
273900200423            READ BUSINESS-DAYS NEXT RECORD
273910200423              AT END
273920200423              MOVE HIGH-VALUES  TO CURR-CONTROLS
273930200423              GO TO GNPD-EXIT
273940200423            END-READ.
273950200423
273960200423            IF ALLOW-TRADING OF BUSINESS-DAYS
273970200423            IS NOT EQUAL "Y"
273980200423              GO TO GNPD-0010
273990200423            END-IF.
274000200423
274010200423
274020200423       GNPD-EXIT.
274030200423           EXIT.
274040200423      *END GIC MOD
274050200423      *
274060200423      *GIC MOD
274070200423132956/
274080200423132956     COPY CPYTPGIC.
274090200423132956/
274100200423
274110200423       UPD-ACCT-FINANCIAL SECTION.
274120200423
274130200423           IF NOT HISTORY
274140200423             GO TO UPD-EXIT
274150200423           END-IF.
274160200423
274170200423           IF REVERSE OF TRANS IS NOT EQUAL "N" AND " "
274180200423             GO TO UPD-EXIT
274190200423           END-IF.
274200200423
274210200423           MOVE TRANS-ORIGIN-CODE OF TRANS
274220200423                             TO WS-TRANS-ORIGIN-88.
274230200423           MOVE GROSS-AMT OF TRANS
274240200423                             TO WS-UPDFIN-GROSS.
274250200423           IF ADJUSTMENT
274260200423              IF WS-SCREEN-EDITS-ALLOWED IS EQUAL TO "Y"
274270200423                 COMPUTE WS-UPDFIN-GROSS =
274280200423                         UNIT-AMT OF TRANS * AVERAGE-UNIT-COST OF TRANS
274290200423              END-IF
274300200423           END-IF.
274310200423           MOVE ACCOUNT-NO OF TRANS
274320200423                             TO ACCOUNT-NO OF ACCOUNT-INV-REGISTERED.
274330200423           MOVE INVESTMENT-CODE OF TRANS
274340200423                             TO INVESTMENT-CODE
274350200423                             OF ACCOUNT-INV-REGISTERED.
274360200423           MOVE CONTR-REDEM-CODE OF TRANS
274370200423                             TO CONTR-REDEM-CODE
274380200423                             OF ACCOUNT-INV-REGISTERED.
274390200423           MOVE CURRENCY-DDS OF INVESTMENT
274400200423                             TO CURRENCY-DDS
274410200423                             OF ACCOUNT-INV-REGISTERED.
274420200423           MOVE "R"          TO WRITE-ACCOUNT-INV-REG.
274430200423
274440200423           READ ACCOUNT-INV-REGISTERED
274450200423           INVALID KEY
274460200423           MOVE "W"          TO WRITE-ACCOUNT-INV-REG
274470200423           GO TO UPD-0050.
274480200423           GO TO UPD-0060.
274490200423
274500200423       UPD-0050.
274510200423
274520200423           INITIALIZE MFAACCIRP.
274530200423           MOVE ACCOUNT-NO OF TRANS
274540200423                             TO ACCOUNT-NO OF ACCOUNT-INV-REGISTERED.
274550200423           MOVE INVESTMENT-CODE OF TRANS
274560200423                             TO INVESTMENT-CODE
274570200423                             OF ACCOUNT-INV-REGISTERED.
274580200423           MOVE CONTR-REDEM-CODE OF TRANS
274590200423                             TO CONTR-REDEM-CODE
274600200423                             OF ACCOUNT-INV-REGISTERED.
274610200423           MOVE CURRENCY-DDS OF INVESTMENT
274620200423                             TO CURRENCY-DDS
274630200423                             OF ACCOUNT-INV-REGISTERED.
274640200423           IF ADDITION-TRANSACTION
274650200423             MOVE "C"        TO CONTR-OR-REDEMPTION
274660200423                             OF ACCOUNT-INV-REGISTERED
274670200423           ELSE
274680200423             MOVE "R"        TO CONTR-OR-REDEMPTION
274690200423                             OF ACCOUNT-INV-REGISTERED
274700200423           END-IF.
274710200423
274720200423       UPD-0060.
274730200423
274740200423           IF REDUCTION-TRANSACTION
274750200423             COMPUTE WS-UPDFIN-GROSS = GROSS-AMT OF TRANS * -1
274760200423           END-IF.
274770200423           ADD WS-UPDFIN-GROSS
274780200423                             TO CONTR-DEDUCT-AMT
274790200423                             OF ACCOUNT-INV-REGISTERED.
274800200423           ADD WS-UPDFIN-GROSS
274810200423                             TO YTD-CONTR-DEDUCT-AMT
274820200423                             OF ACCOUNT-INV-REGISTERED
274830200423           IF WRITE-ACCOUNT-INV-REG = "W"
274840200423             WRITE ACCOUNT-INV-REGIS-REC
274850200423                 INVALID KEY
274860200423                 DISPLAY "INVALID ACCOUNT INV REGISTER WRITE"
274870200423             END-WRITE
27488020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27489020042358714           MOVE "MFAACCIRP" TO WS-FILE-STATUS-FILE-NAME
27490020042358714           SET lncc_Err139  TO  TRUE
27491020042358714           PERFORM LOG-FILE-STATUS
27492020042358714        END-IF
274930200423           ELSE
274940200423             REWRITE ACCOUNT-INV-REGIS-REC
274950200423                 INVALID KEY
274960200423                 DISPLAY "INVALID ACCOUNT INV REGISTER REWRITE"
274970200423             END-REWRITE
27498020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27499020042358714           MOVE "MFAACCIRP" TO WS-FILE-STATUS-FILE-NAME
27500020042358714           SET lncc_Err140  TO  TRUE
27501020042358714           PERFORM LOG-FILE-STATUS
27502020042358714        END-IF
275030200423           END-IF.
275040200423
275050200423       UPD-0080.
275060200423           MOVE ACCOUNT-NO OF TRANS
275070200423                             TO ACCOUNT-NO OF
275080200423                             ACCOUNT-FINANCIAL-TOTALS.
275090200423           MOVE INVESTMENT-CODE OF TRANS
275100200423                             TO INVESTMENT-CODE OF
275110200423                             ACCOUNT-FINANCIAL-TOTALS.
275120200423           MOVE CURRENCY-DDS OF INVESTMENT
275130200423                             TO CURRENCY-DDS OF
275140200423                             ACCOUNT-FINANCIAL-TOTALS.
275150200423           MOVE "R"          TO WRITE-ACCOUNT-FIN-TOTALS.
275160200423
275170200423           READ ACCOUNT-FINANCIAL-TOTALS
275180200423           INVALID KEY
275190200423           MOVE "W"          TO WRITE-ACCOUNT-FIN-TOTALS
275200200423           GO TO UPD-0083.
275210200423           GO TO UPD-0085.
275220200423
275230200423       UPD-0083.
275240200423            INITIALIZE MFAACCFIP.
275250200423            MOVE ACCOUNT-NO OF TRANS
275260200423                             TO ACCOUNT-NO OF
275270200423                             ACCOUNT-FINANCIAL-TOTALS.
275280200423            MOVE INVESTMENT-CODE OF TRANS
275290200423                             TO INVESTMENT-CODE OF
275300200423                             ACCOUNT-FINANCIAL-TOTALS.
275310200423            MOVE CURRENCY-DDS OF INVESTMENT
275320200423                             TO CURRENCY-DDS OF
275330200423                             ACCOUNT-FINANCIAL-TOTALS.
275340200423       UPD-0085.
275350200423
275360200423           IF CAPITAL-GAIN-TRANSACTION
275370200423               ADD WS-UPDFIN-GROSS
275380200423                             TO YTD-CAP-GAIN
275390200423                             OF ACCOUNT-FINANCIAL-TOTALS
275400200423               ADD WS-UPDFIN-GROSS
275410200423                             TO LTD-CAP-GAIN
275420200423                             OF ACCOUNT-FINANCIAL-TOTALS
275430200423RF9277*    ELSE IF INCOME-TRANSACTION
275440200423RF9277     ELSE IF INCOME-TRANSACTION  OR
275450200423RF9277             INTEREST-TRANSACTION
275460200423               ADD WS-UPDFIN-GROSS
275470200423                             TO YTD-INCOME
275480200423                             OF ACCOUNT-FINANCIAL-TOTALS
275490200423               ADD WS-UPDFIN-GROSS
275500200423                             TO LTD-INCOME
275510200423                             OF ACCOUNT-FINANCIAL-TOTALS
275520200423           ELSE IF ADDITION-TRANSACTION AND PAC
275530200423               ADD WS-UPDFIN-GROSS
275540200423                             TO YTD-PAC
275550200423                             OF ACCOUNT-FINANCIAL-TOTALS
275560200423               ADD WS-UPDFIN-GROSS
275570200423                             TO LTD-PAC
275580200423                             OF ACCOUNT-FINANCIAL-TOTALS
275590200423           ELSE IF ADDITION-TRANSACTION
275600200423               ADD WS-UPDFIN-GROSS
275610200423                             TO YTD-PUR
275620200423                             OF ACCOUNT-FINANCIAL-TOTALS
275630200423               ADD WS-UPDFIN-GROSS
275640200423                             TO LTD-PUR
275650200423                             OF ACCOUNT-FINANCIAL-TOTALS
275660200423           ELSE IF REDUCTION-TRANSACTION AND AWD
275670200423               ADD WS-UPDFIN-GROSS
275680200423                             TO YTD-AWD
275690200423                             OF ACCOUNT-FINANCIAL-TOTALS
275700200423               ADD WS-UPDFIN-GROSS
275710200423                             TO LTD-AWD
275720200423                             OF ACCOUNT-FINANCIAL-TOTALS
275730200423           ELSE IF REDUCTION-TRANSACTION
275740200423               ADD WS-UPDFIN-GROSS
275750200423                             TO YTD-RED
275760200423                             OF ACCOUNT-FINANCIAL-TOTALS
275770200423               ADD WS-UPDFIN-GROSS
275780200423                             TO LTD-RED
275790200423                             OF ACCOUNT-FINANCIAL-TOTALS
275800200423           END-IF.
275810200423
275820200423           IF WRITE-ACCOUNT-FIN-TOTALS = "W"
275830200423             WRITE ACCOUNT-FIN-TOTAL-REC
275840200423               INVALID KEY
275850200423               DISPLAY "INVALID ACCOUNT FIN TOTAL WRITE"
275860200423             END-WRITE
27587020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27588020042358714           MOVE "MFAACCFIP" TO WS-FILE-STATUS-FILE-NAME
27589020042358714           SET lncc_Err141  TO  TRUE
27590020042358714           PERFORM LOG-FILE-STATUS
27591020042358714        END-IF
275920200423           ELSE
275930200423             REWRITE ACCOUNT-FIN-TOTAL-REC
275940200423               INVALID KEY
275950200423               DISPLAY "INVALID ACCOUNT FIN TOTAL REWRITE"
275960200423             END-REWRITE
27597020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27598020042358714           MOVE " MFAACCFIP" TO WS-FILE-STATUS-FILE-NAME
27599020042358714           SET lncc_Err142  TO  TRUE
27600020042358714           PERFORM LOG-FILE-STATUS
27601020042358714        END-IF
276020200423           END-IF.
276030200423       UPD-EXIT.
276040200423           EXIT.
276050200423      *END GIC MOD
276060200423
276070200423      * RFS9346 - BEGIN
276080200423     /
276090200423       UPD-RESP-FINANCIAL SECTION.
276100200423
276110200423           IF NOT HISTORY
276120200423             GO TO URF-EXIT
276130200423           END-IF.
276140200423
276150200423           IF REVERSE OF TRANS IS NOT EQUAL "N" AND " "
276160200423             GO TO URF-EXIT
276170200423           END-IF.
276180200423      *RFS 12409 - Begin
276190200423           INITIALIZE      UPESPFN-BUFFER-AREA.
276200200423      *    MOVE SPACES     TO UPESPFN-AREA.
276210200423      *RFS 12409 - End
276220200423           MOVE "I"        TO UPESPFN-PROCESS-OPTION.
276230200423           MOVE "N"        TO UPESPFN-NEXT-PROCESS-DATE-OPT.
276240200423      *    RFS84977 -Begin
276250200423      *    MOVE "X"        TO UPESPFN-GIC-DII-OPTION.
276260200423           MOVE "I"        TO UPESPFN-GIC-DII-OPTION.
276270200423           MOVE ACCOUNT-NO OF TRANS TO UPESPFN-ACCOUNT-NO.
276280200423      *    RFS84977 -End
276290200423           MOVE "14"       TO UPESPFN-CONTR-REDEM-RULE.
276300200423      * RFS9530 - Begin
276310200423           IF WS-NEXT-DATE-SWI-YES              AND
276320200423              TRANS-TYPE-CODE OF TRANS = "SWI"
276330200423             MOVE WS-UPPER-LIMIT-DAT2
276340200423                           TO UPESPFN-PROCESS-DATE
27635020042380144                         UPIQEEFNParmProcessDate
276360200423           ELSE
276370200423      * RFS9530 - End
276380200423           MOVE PASS-PROCESS-DATE-9
276390200423                           TO UPESPFN-PROCESS-DATE.
276400200423      *
276410200423           MOVE PLACEMENT-DATE OF TRANS
276420200423                           TO UPESPFN-PLACEMENT-DATE.
276430200423           MOVE TRANS-NO OF TRANS
276440200423                           TO UPESPFN-TRANS-NO.
276450200423
276460200423R32964*    Old code calls CL program UPESPFNP; it will be archived.
276470200423  |   *    Call the cobol program below from now on.
276480200423R32964     CALL "UPESPFN" USING UPESPFN-AREA.
276490200423           IF UPESPFN-REJECTION-CODE NOT = SPACES AND "00"
276500200423              NEXT SENTENCE.
276510200423
276520200423      * RFS 80144 - Begin
276530200423           IF lc_ModuleIQEEOn
276540200423169088        AND lb_OnlineYes
276550200423      *    RFS84977.4 -Begin
276560200423              AND GIC-DII-INVESTMENT
276570200423      *    RFS84977.4 -End
276580200423              MOVE ACCOUNT-NO OF TRANS
276590200423                TO UPIQEEFNParmAccountNo
276600200423              MOVE 0
276610200423                TO UPIQEEFNParmPlacementDate
276620200423                   UPIQEEFNParmTransNo
276630200423              MOVE PROCESS-DATE OF TRANS
276640200423                TO UPIQEEFNParmProcessDate
276650200423              MOVE PLACEMENT-DATE OF TRANS
276660200423                TO UPIQEEFNParmOrigPlacementDate
276670200423              MOVE TRANS-NO OF TRANS
276680200423                TO UPIQEEFNParmOrigTransNo
276690200423              MOVE "X" TO UPIQEEFNParmGIC_DII
27670020042390105         MOVE " "
27671020042390105           TO UPIQEEFNOldSplitCode
27672020042390105         MOVE " "
27673020042390105           TO UPIQEEFNNewSplitCode
27674020042390105         MOVE " "
27675020042390105           TO UPIQEEFNOldContrCode
27676020042390105         MOVE " "
27677020042390105           TO UPIQEEFNNewContrCode
276780200423108322             UPIQEEFNAction
276790200423      *    RFS92917 - Start
276800200423              MOVE ZEROES
276810200423                TO UPIQEEFNTransactionID
276820200423                   UPIQEEFNBenSeqNo
276830200423103643             UPIQEEFNTransactionTypeExt
276840200423108322             UPIQEEFNTransferSeqNo
276850200423103860             UPIQEEFNReversalDate
276860200423      *    RFS92917 - End
276870200423
276880200423              CALL "UPIQEEFN" USING
276890200423                    UPIQEEFNParmAccountNo
276900200423                    UPIQEEFNParmPlacementDate
276910200423                    UPIQEEFNParmTransNo
276920200423                    UPIQEEFNParmProcessDate
276930200423                    UPIQEEFNParmOrigPlacementDate
276940200423                    UPIQEEFNParmOrigTransNo
276950200423                    UPIQEEFNParmGIC_DII
27696020042390105               UPIQEEFNOldSplitCode
27697020042390105               UPIQEEFNNewSplitCode
27698020042390105               UPIQEEFNOldContrCode
27699020042390105               UPIQEEFNNewContrCode
277000200423      *    RFS92917 - Start
277010200423                    UPIQEEFNTransactionID
277020200423                    UPIQEEFNBenSeqNo
277030200423103643              UPIQEEFNTransactionTypeExt
277040200423108322              UPIQEEFNTransferSeqNo
277050200423108322              UPIQEEFNAction
277060200423103860              UPIQEEFNReversalDate
277070200423      *    RFS92917 - End
277080200423              END-CALL
277090200423           END-IF.
277100200423      * RFS 80144 - End
277110200423
277120200423       URF-EXIT.
277130200423           EXIT.
277140200423      * RFS9346 - END
277150200423     /
277160200423      *RFS 4637 - BEGIN
277170200423       UPDATE-CONTRACT-DISTR SECTION.
277180200423
277190200423       UCD-0010.
277200200423           IF NOT HISTORY
277210200423             GO TO UCD-EXIT
277220200423           END-IF.
277230200423
277240200423      * RFS21772 - Begin
277250200423           IF PASS-CDSC-CALCULATOR = "C"
277260200423             GO TO UCD-EXIT
277270200423           END-IF.
277280200423      * RFS21772 - End
277290200423
277300200423      * RFS24145 Start
27731020042326151**    IF MAN-FEE-REB-TRANSACTION
27732020042326151**      GO TO UCD-EXIT
27733020042326151**    END-IF.
277340200423      * RFS24145 End
277350200423
277360200423001128     IF INTEREST-TRANSACTION
27737020042326151         OR MAN-FEE-REB-TRANSACTION
277380200423001128         MOVE "Y" TO WS-PID-ERROR
277390200423001128         PERFORM POPU-CONTRACT-INV-DIST-BAL THRU POP-EXIT
277400200423001128         IF WS-PID-ERROR = "Y"
277410200423001128             GO TO UCD-EXIT
277420200423001128         END-IF
277430200423001128     END-IF.
277440200423
277450200423      *  rfs 37754 - begin
277460200423           IF (SPEC-MOD-AUTH-SEGSYSMAT-ON AND
277470200423               CAPITAL-GAIN-TRANSACTION   AND
277480200423               lnc_OrigCodeMat)
277490200423               PERFORM Popu-Contract-Invest  THRU PCI-EXIT
277500200423           END-IF.
277510200423      *  rfs 37754 - end
277520200423
277530200423      * RFS 159011 Start
277540200423           Set lb_NoProcessTran To True
277550200423           IF DISTRIBUTION-TRANSACTION AND CASH-DISTRIB
277560210112180708        INITIALIZE WS-PLACEMENTDATE WS-TRANSNO
277570210112180708        MOVE PLACEMENT-DATE OF TRANS  TO WS-PLACEMENTDATE
277580210112180708        MOVE TRANS-NO OF TRANS        TO WS-TRANSNO
277590200423              PERFORM CHECK-IF-EXCLUDE-TRANSACTION THRU CIET-EXIT
277600200423              IF EXCLUDE-TRANS-FLAG = "N"
277610200824185171        OR (EXCLUDE-TRANS-FLAG = "Y"
277620200824185171        AND EXCLUSION-RULE = '02')
277630200423                 Set lb_ProcessTran To True
277640200423              END-IF
277650200423           END-IF
277660200423      * RFS 159011 End
277670200423           IF UNIT-AMT OF TRANS IS EQUAL 0
277680200423      * RFS35909 - Start: for MFR trades make sure transaction created
277690200423             AND NOT MAN-FEE-REB-TRANSACTION
277700200423      * RFS35909 - End
277710200423159011       AND lb_NoProcessTran
277720200423             GO TO UCD-EXIT
277730200423           END-IF.
277740200423
277750200423      **** RFS 13829 Begin
277760200423           IF CAPITAL-GAIN-TRANSACTION
277770200423           OR INCOME-TRANSACTION
277780200423               MOVE "N" TO WS-REC-ACIDB-EXISTS
277790200423               PERFORM FIND-IF-ACIDB-REC-EXISTS THRU FAE-EXIT
277800200423               IF WS-REC-ACIDB-EXISTS = "N"
277810200423R26260            PERFORM POPU-CONTRACT-INV-DIST-BAL THRU POP-EXIT
277820200423R26260            IF WS-PID-ERROR = "Y"
277830200423R26260               GO TO UCD-EXIT
277840200423R26260            END-IF
277850200423      *            MOVE "N" TO WS-ASSOCIATED-CONTRACT-FOUND
277860200423      *            PERFORM CHECK-IF-ASSOCIATED-CONTRACT THRU CIA-EXIT
277870200423      *            IF WS-ASSOCIATED-CONTRACT-FOUND = "Y"
277880200423      *                PERFORM PUT-100-PERCENT-TO-ACIDB THRU PTA-EXIT
277890200423      *            END-IF
277900200423               END-IF
277910200423           END-IF.
277920200423      **** RFS 13829 End
277930200423
27794020042326151      IF MAN-FEE-REB-TRANSACTION
27795020042326151         GO TO UCD-0030
27796020042326151      END-IF.
277970200423           MOVE "N"          TO WS-SEG-ALLOC-FOUND.
277980200423
277990200423           MOVE UNIT-AMT OF TRANS
278000200423                             TO WS-UNITS-SEG-ALLOCATED.
278010200423           IF NOT INTEREST-TRANSACTION
278020200423               MOVE DATE-OF-RECORD OF TRANS-DISTR-DETAILS
278030200423                                 TO DATE-OF-RECORD
278040200423                                 OF ACCOUNT-CONTRACT-INV-DIST-BAL
278050200423           ELSE
278060200423               MOVE TRADE-DATE OF TRANS
278070200423                                 TO DATE-OF-RECORD
278080200423                                 OF ACCOUNT-CONTRACT-INV-DIST-BAL
278090200423           END-IF.
278100200423
278110200423           MOVE ACCOUNT-NO OF TRANS
278120200423                             TO ACCOUNT-NO
278130200423                             OF ACCOUNT-CONTRACT-INV-DIST-BAL.
278140200423
278150200423           MOVE ZERO         TO CONTRACT-NO
278160200423                             OF ACCOUNT-CONTRACT-INV-DIST-BAL.
278170200423           MOVE LOW-VALUES   TO INVESTMENT-CODE
278180200423                             OF ACCOUNT-CONTRACT-INV-DIST-BAL.
278190200423
278200200423           START ACCOUNT-CONTRACT-INV-DIST-BAL
278210200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
278220200423           INVALID KEY
278230200423             GO TO UCD-EXIT
278240200423           END-START.
278250200423
278260200423       UCD-0020.
278270200423
278280200423           READ ACCOUNT-CONTRACT-INV-DIST-BAL NEXT RECORD
278290200423           AT END
278300200423             GO TO UCD-FINAL-CHK
278310200423           END-READ.
278320200423
278330200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-DIST-BAL
278340200423           IS NOT EQUAL ACCOUNT-NO OF TRANS
278350200423             GO TO UCD-FINAL-CHK
278360200423           END-IF.
278370200423
278380200423      *RFS167385- STARTS
278390200423           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-DIST-BAL TO
278400200423                ACCOUNT-NO OF ACCOUNT-CONTRACT
278410200423           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-DIST-BAL TO
278420200423                CONTRACT-NO OF ACCOUNT-CONTRACT
278430200423
278440200423           START ACCOUNT-CONTRACT
278450200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
278460200423           INVALID KEY
278470200423             GO TO UCD-EXIT
278480200423           END-START.
278490200423
278500200423           READ ACCOUNT-CONTRACT NEXT RECORD
278510200423           AT END
278520200423              GO TO UCD-FINAL-CHK
278530200423           END-READ.
278540200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT
278550200423           IS EQUAL TO ACCOUNT-NO OF TRANS
278560200423           IF CONTRACT-STATUS OF ACCOUNT-CONTRACT = "C"
278570200423      *       RFS1005091 START
278580200423                IF INTEREST-TRANSACTION AND
278590200423                   WS-INTEREST-GENERATED = "2" AND
278600200423                   (PASS-CDSC-CALCULATOR = "W" or
278610200423                    PASS-CDSC-CALCULATOR = "X")
278620200423                 CONTINUE
278630200423                ELSE
278640200423             GO TO UCD-0020
278650200423              END-IF
278660200423      *       RFS1005091 END
278670200423             END-IF
278680200423           END-IF.
278690200423      *RFS167385- ENDS
278700200423
278710200423           IF NOT INTEREST-TRANSACTION
278720200423               IF DATE-OF-RECORD OF ACCOUNT-CONTRACT-INV-DIST-BAL
278730200423               IS NOT EQUAL DATE-OF-RECORD OF TRANS-DISTR-DETAILS
278740200423                 GO TO UCD-FINAL-CHK
278750200423               END-IF
278760200423           ELSE
278770200423               IF DATE-OF-RECORD OF ACCOUNT-CONTRACT-INV-DIST-BAL
278780200423               IS NOT EQUAL TRADE-DATE OF TRANS
278790200423                 GO TO UCD-FINAL-CHK
278800200423               END-IF
278810200423           END-IF.
278820200423
278830200423           IF INVESTMENT-CODE  OF ACCOUNT-CONTRACT-INV-DIST-BAL
278840200423           IS NOT EQUAL INVESTMENT-CODE OF TRANS
278850200423             GO TO UCD-0020
278860200423           END-IF.
278870200423
278880200423
278890200423           MOVE "Y"          TO WS-SEG-ALLOC-FOUND.
278900200423           INITIALIZE MFATRCODP OF TRANS-CONTRACT-DETAILS.
278910200423
278920200423           MOVE PLACEMENT-DATE OF TRANS
278930200423                             TO PLACEMENT-DATE
278940200423                             OF TRANS-CONTRACT-DETAILS.
278950200423           MOVE TRANS-NO OF TRANS
278960200423                             TO TRANS-NO
278970200423                             OF TRANS-CONTRACT-DETAILS.
278980200423           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-DIST-BAL
278990200423                             TO CONTRACT-NO
279000200423                             OF TRANS-CONTRACT-DETAILS.
279010200423
279020200423           COMPUTE ORIG-UNIT-BAL OF TRANS-CONTRACT-DETAILS =
279030200423           UNIT-AMT OF TRANS *
279040200423           (CONTRACT-UNIT-PERCENT OF ACCOUNT-CONTRACT-INV-DIST-BAL
279050200423           / 100)
279060200423
279070200423           SUBTRACT ORIG-UNIT-BAL OF TRANS-CONTRACT-DETAILS
279080200423           FROM WS-UNITS-SEG-ALLOCATED.
279090200423
279100200423           MOVE ACCOUNT-NO OF TRANS
279110200423                             TO ACCOUNT-NO
279120200423                             OF ACCOUNT-CONTRACT-INVESTMENT.
279130200423           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-DIST-BAL
279140200423                             TO CONTRACT-NO
279150200423                             OF ACCOUNT-CONTRACT-INVESTMENT.
279160200423           MOVE INVESTMENT-CODE OF TRANS
279170200423                             TO INVESTMENT-CODE
279180200423                             OF ACCOUNT-CONTRACT-INVESTMENT.
279190200423
279200200423           READ ACCOUNT-CONTRACT-INVESTMENT
279210200423           INVALID KEY
279220200423             DISPLAY "MISSING EXPECTED CONTRACT IN ALLOCATION"
279230200423             GO TO UCD-EXIT
279240200423           END-READ.
279250200423
279260200423           ADD ORIG-UNIT-BAL OF TRANS-CONTRACT-DETAILS
279270200423                             TO CURR-UNIT-BAL
279280200423                             OF ACCOUNT-CONTRACT-INVESTMENT.
279290200423           MOVE ACCOUNT-CONTRACT-INVEST-REC
279300200423                             TO WS-ACCOUNT-CONTRACT-INVESTMENT.
279310200423           MOVE TRANS-CONTRACT-DETAILS-REC
279320200423                             TO WS-TRANS-CONTRACT-DETAILS.
279330200423
279340200423           REWRITE ACCOUNT-CONTRACT-INVEST-REC
279350200423           INVALID KEY
27936020042358714 *      DISPLAY "ERROR REWRITE OF ACCT CONTR INVES IN ALLOC"
27937020042358714         MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
27938020042358714        SET lncc_Err143  TO  TRUE
27939020042358714        PERFORM LOG-FILE-STATUS
279400200423             GO TO UCD-EXIT
279410200423           END-REWRITE.
27942020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27943020042358714         MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
27944020042358714         SET lncc_Err144  TO  TRUE
27945020042358714         PERFORM LOG-FILE-STATUS
27946020042358714      END-IF.
279470200423
279480200423           WRITE TRANS-CONTRACT-DETAILS-REC
279490200423           INVALID KEY
27950020042358714 *      DISPLAY "ERROR REWRITE OF TRANS-CONTR REC IN ALLOC"
27951020042358714         MOVE "MFATRCODP" TO WS-FILE-STATUS-FILE-NAME
27952020042358714         SET lncc_Err145  TO  TRUE
27953020042358714         PERFORM LOG-FILE-STATUS
279540200423             GO TO UCD-EXIT
279550200423           END-WRITE.
27956020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
27957020042358714         MOVE "MFATRCODP" TO WS-FILE-STATUS-FILE-NAME
27958020042358714         SET lncc_Err146  TO  TRUE
27959020042358714         PERFORM LOG-FILE-STATUS
27960020042358714      END-IF.
279610200423
279620200423           GO TO UCD-0020.
279630200423
27964020042326151**Process MFR transactions.
27965020042326151  UCD-0030.
27966020042326151      INITIALIZE MFATRCODP OF TRANS-CONTRACT-DETAILS.
27967020042326151      MOVE PLACEMENT-DATE OF TRANS
27968020042326151        TO PLACEMENT-DATE OF TRANS-CONTRACT-DETAILS.
27969020042326151      MOVE TRANS-NO OF TRANS
27970020042326151        TO TRANS-NO OF TRANS-CONTRACT-DETAILS.
27971020042326151      MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
27972020042326151        TO CONTRACT-NO OF TRANS-CONTRACT-DETAILS.
27973020042326151      MOVE UNIT-AMT OF TRANS
27974020042326151        TO ORIG-UNIT-BAL OF TRANS-CONTRACT-DETAILS.
279750200423
27976020042326151      MOVE ACCOUNT-NO OF TRANS
27977020042326151        TO ACCOUNT-NO OF ACCOUNT-CONTRACT-INVESTMENT.
27978020042326151      MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
27979020042326151        TO CONTRACT-NO OF ACCOUNT-CONTRACT-INVESTMENT.
27980020042326151      MOVE INVESTMENT-CODE OF TRANS
27981020042326151        TO INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVESTMENT.
279820200423
27983020042326151      READ ACCOUNT-CONTRACT-INVESTMENT
27984020042326151      INVALID KEY
27985020042326151        DISPLAY "MISSING EXPECTED CONTRACT IN ALLOCATION"
27986020042326151        GO TO UCD-EXIT
27987020042326151      END-READ.
279880200423
279890210112180708     INITIALIZE WS-PLACEMENTDATE WS-TRANSNO.
279900210112180708     MOVE PLACEMENT-DATE OF TRANS  TO WS-PLACEMENTDATE.
279910210112180708     MOVE TRANS-NO OF TRANS        TO WS-TRANSNO.
27992020042326151      PERFORM CHECK-IF-EXCLUDE-TRANSACTION THRU CIET-EXIT.
27993020042326151      IF EXCLUDE-TRANS-FLAG = "Y" AND
27994020042326151         MAN-FEE-REB-TRANSACTION
279950200824185171        AND EXCLUSION-RULE = '01'
27996020042326151         ADD ORIG-UNIT-BAL OF TRANS-CONTRACT-DETAILS
27997020042326151          TO CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVESTMENT
27998020042326151         REWRITE ACCOUNT-CONTRACT-INVEST-REC
27999020042326151           INVALID KEY
28000020042358714 *         DISPLAY "ERROR REWRITE OF ACCT CONTR INVES IN ALLOC"
28001020042358714            MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
28002020042358714            SET lncc_Err147  TO  TRUE
28003020042358714            PERFORM LOG-FILE-STATUS
28004020042326151           GO TO UCD-EXIT
28005020042326151         END-REWRITE
28006020042358714         IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28007020042358714            MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
28008020042358714            SET lncc_Err148  TO  TRUE
28009020042358714            PERFORM LOG-FILE-STATUS
28010020042358714         END-IF
28011020042326151      END-IF.
280120200423
28013020042326151      WRITE TRANS-CONTRACT-DETAILS-REC
28014020042326151      INVALID KEY
28015020042326151        DISPLAY "ERROR REWRITE OF TRANS-CONTR REC IN ALLOC"
28016020042358714         MOVE "MFATRCODP" TO WS-FILE-STATUS-FILE-NAME
28017020042358714         SET lncc_Err149  TO  TRUE
28018020042358714         PERFORM LOG-FILE-STATUS
28019020042326151        GO TO UCD-EXIT
28020020042326151      END-WRITE.
280210200423
28022020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28023020042358714         MOVE "MFATRCODP" TO WS-FILE-STATUS-FILE-NAME
28024020042358714         SET lncc_Err150  TO  TRUE
28025020042358714         PERFORM LOG-FILE-STATUS
28026020042358714      END-IF.
280270200423
28028020042326151      GO TO UCD-EXIT.
280290200423
280300200423       UCD-FINAL-CHK.
280310200423
280320200423           IF WS-SEG-ALLOC-FOUND IS NOT EQUAL "Y"
280330200423             GO TO UCD-EXIT
280340200423           END-IF.
280350200423
280360200423           IF WS-UNITS-SEG-ALLOCATED IS NOT EQUAL 0
280370200423             MOVE WS-TRANS-CONTRACT-DETAILS
280380200423                             TO TRANS-CONTRACT-DETAILS-REC
280390200423             READ TRANS-CONTRACT-DETAILS
280400200423             ADD WS-UNITS-SEG-ALLOCATED
280410200423                             TO ORIG-UNIT-BAL
280420200423                             OF TRANS-CONTRACT-DETAILS-REC
280430200423             REWRITE TRANS-CONTRACT-DETAILS-REC
28044020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28045020042358714           MOVE "MFATRCODP" TO WS-FILE-STATUS-FILE-NAME
28046020042358714           SET lncc_Err151  TO  TRUE
28047020042358714           PERFORM LOG-FILE-STATUS
28048020042358714        END-IF
280490200423             MOVE WS-ACCOUNT-CONTRACT-INVESTMENT
280500200423                             TO ACCOUNT-CONTRACT-INVEST-REC
280510200423             READ ACCOUNT-CONTRACT-INVESTMENT
280520200423             ADD WS-UNITS-SEG-ALLOCATED
280530200423                             TO CURR-UNIT-BAL
280540200423                             OF ACCOUNT-CONTRACT-INVEST-REC
280550200423             REWRITE ACCOUNT-CONTRACT-INVEST-REC
28056020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28057020042358714           MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
28058020042358714           SET lncc_Err152  TO  TRUE
28059020042358714           PERFORM LOG-FILE-STATUS
28060020042358714        END-IF
280610200423           END-IF.
280620200423
280630200423       UCD-EXIT.
280640200423             EXIT.
280650200423      *RFS 4637 - END
280660200423
280670200423      *RFS 4637B - BEGIN INTEREST ALLOCATION (TSTBASTM)
280680200423
280690200423       POPU-CONTRACT-INV-DIST-BAL SECTION.
280700200423       POP-0010.
280710200423
280720200423      **** PRIME READ OF FIRST CONTRACT
280730200423
280740200423           INITIALIZE MFAACCCIP OF ACCOUNT-CONTRACT-INVEST2-REC.
280750200423
280760200423           MOVE ACCOUNT-NO      OF TRANS
280770200423           TO   ACCOUNT-NO      OF ACCOUNT-CONTRACT-INVEST2-REC.
280780200423
280790200423           MOVE ZEROES
280800200423           TO   CONTRACT-NO     OF ACCOUNT-CONTRACT-INVEST2-REC.
280810200423
280820200423           MOVE SPACES
280830200423           TO   INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC.
280840200423
280850200423           MOVE "00"                TO WS-END-OF-ACI.
280860200423
280870200423           START ACCOUNT-CONTRACT-INVESTMENT2
280880200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
280890200423             INVALID KEY
280900200423             GO TO POP-EXIT.
280910200423
280920200423           READ ACCOUNT-CONTRACT-INVESTMENT2 NEXT RECORD
280930200423             AT END
280940200423             MOVE "10" TO WS-END-OF-ACI
280950200423             GO TO POP-EXIT
280960200423           END-READ.
280970200423
280980200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
280990200423              ACCOUNT-NO OF TRANS
281000200423              MOVE "10" TO WS-END-OF-ACI
281010200423              GO TO POP-EXIT
281020200423           END-IF.
281030200423
281040200423           MOVE WS-SAVE-CURR-UNIT-BAL
281050200423           TO   WS-REMAINING-UNITS.
281060200423
281070200423           MOVE 100
281080200423           TO   WS-REMAINING-PERCENT.
281090200423
28110020042326151      IF MAN-FEE-REB-TRANSACTION
28111020042326151         SET SW-RECORD-FOUND-NO TO TRUE
281120200423      * RFS35909 - Start: initialize current contract Number
281130200423              INITIALIZE ln_currContractNo
281140200423      * RFS35909 - End
28115020042326151         PERFORM READ-CONTRACT-LOOP-MFR
28116020042326151           UNTIL SW-RECORD-FOUND-YES
28117020042326151              OR END-OF-ACI
281180200423      * RFS35909 - Start: if record was not found then
281190200423      *  create new record and reset the flag
281200200423              IF SW-RECORD-FOUND-NO AND
281210200423                 ln_currContractNo NOT = 0
281220200423                PERFORM create-upd-acc-contract-inv
281230200423              END-IF
281240200423      * RFS35909 - End
28125020042326151      ELSE
281260200423           PERFORM READ-CONTRACT-LOOP THRU RCT-EXIT UNTIL
281270200423           END-OF-ACI OR
281280200423           ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
281290200423           ACCOUNT-NO OF TRANS OR
281300200423           WS-REMAINING-UNITS <= 0.
281310200423
281320200423       POP-EXIT.
281330200423             EXIT.
281340200423
281350200423      * RFS35909 - Start: create/upd record in Account-contract-inv
281360200423       create-upd-acc-contract-inv SECTION.
281370200423      * Re-init PID-ERROR if write/rewrite is successful
281380200423           INITIALIZE MFAACCCIP OF ACCOUNT-CONTRACT-INVESTMENT
281390200423           MOVE ACCOUNT-NO      OF TRANS TO
281400200423                ACCOUNT-NO OF ACCOUNT-CONTRACT-INVESTMENT
281410200423           MOVE INVESTMENT-CODE OF TRANS TO
281420200423                INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVESTMENT
281430200423           MOVE ln_currContractNo        TO
281440200423                CONTRACT-NO     OF ACCOUNT-CONTRACT-INVESTMENT
281450200423           READ ACCOUNT-CONTRACT-INVESTMENT
281460200423             INVALID KEY
281470200423               MOVE UNIT-AMT        OF TRANS TO
281480200423                CURR-UNIT-BAL   OF ACCOUNT-CONTRACT-INVESTMENT
281490200423               WRITE ACCOUNT-CONTRACT-INVEST-REC
281500200423                 INVALID KEY
281510200423                   CONTINUE
281520200423                 NOT INVALID KEY
281530200423                   MOVE ACCOUNT-CONTRACT-INVEST-REC TO
281540200423                        ACCOUNT-CONTRACT-INVEST2-REC
281550200423                   MOVE lncc_N     TO WS-PID-ERROR
281560200423               END-WRITE
28157020042358714          IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28158020042358714             MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
28159020042358714             SET lncc_Err153  TO  TRUE
28160020042358714             PERFORM LOG-FILE-STATUS
28161020042358714          END-IF
281620200423             NOT INVALID KEY
281630200423      *RFS1002132 START
281640200423      *        MOVE UNIT-AMT        OF TRANS TO
281650200423      *         CURR-UNIT-BAL   OF ACCOUNT-CONTRACT-INVESTMENT
281660200423      *        REWRITE ACCOUNT-CONTRACT-INVEST-REC
281670200423      *          INVALID KEY
281680200423      *            CONTINUE
281690200423      *          NOT INVALID KEY
281700200423                   MOVE ACCOUNT-CONTRACT-INVEST-REC TO
281710200423                        ACCOUNT-CONTRACT-INVEST2-REC
281720200423                   MOVE lncc_N     TO WS-PID-ERROR
281730200423      *        END-REWRITE
28174020042358714 *        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28175020042358714 *           MOVE "MFAACCCIP" TO WS-FILE-STATUS-FILE-NAME
28176020042358714 *           SET lncc_Err154  TO  TRUE
28177020042358714 *           PERFORM LOG-FILE-STATUS
28178020042358714 *        END-IF
281790200423      *RFS1002132 END
281800200423           END-READ.
281810200423       caci-exit.
281820200423             EXIT.
281830200423      * RFS35909 - End
281840200423
281850200423       READ-CONTRACT-LOOP SECTION.
281860200423       RCL-0010.
281870200423
281880200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC =
281890200423              ACCOUNT-NO OF TRANS AND
281900200423              INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC =
281910200423              INVESTMENT-CODE OF TRANS AND
281920200423              CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVEST2-REC
281930200423              NOT EQUAL ZEROES
281940200423
281950200423               MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
281960200423               TO   ACCOUNT-NO OF ACIDB2-REC
281970200423                    ACCOUNT-NO OF ACIDB3-REC
281980200423
281990200423               MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
282000200423               TO   CONTRACT-NO OF ACIDB2-REC
282010200423                    CONTRACT-NO OF ACIDB3-REC
282020200423
282030200423               MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC
282040200423               TO   INVESTMENT-CODE OF ACIDB2-REC
282050200423                    INVESTMENT-CODE OF ACIDB3-REC
282060200423
282070200423               MOVE WS-SAVE-CURR-UNIT-BAL
282080200423               TO WS-CURR-BASE-UNITS
282090200423
282100200423               MOVE WS-CURR-BASE-UNITS
282110200423               TO   UNIT-AMT        OF ACIDB3-REC
282120200423
282130200423               MOVE CURR-UNIT-BAL   OF ACCOUNT-CONTRACT-INVEST2-REC
282140200423               TO   CURR-UNIT-BAL   OF ACIDB3-REC
282150200423
282160200423               COMPUTE WS-CONTRACT-UNIT-PERCENT =
282170200423               CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVEST2-REC
282180200423               / WS-CURR-BASE-UNITS * 100
282190200423
282200200423               MOVE WS-CONTRACT-UNIT-PERCENT
282210200423               TO   CONTRACT-UNIT-PERCENT OF ACIDB3-REC
282220200423
282230200423R26260*** Begin
282240200423  ¦            IF Capital-Gain-Transaction OR Income-Transaction
282250200423  ¦               MOVE Date-of-Record of Trans-Distr-Details-Rec
282260200423  ¦                 TO DATE-OF-RECORD OF ACIDB2-REC
282270200423  ¦                    DATE-OF-RECORD OF ACIDB3-REC
282280200423  ¦            ELSE
282290200423  ¦               MOVE Trade-Date of Trans
282300200423  ¦                 TO DATE-OF-RECORD OF ACIDB2-REC
282310200423  ¦                    DATE-OF-RECORD OF ACIDB3-REC
282320200423  ¦            END-IF
282330200423R26260*** End
282340200423
282350200423               COMPUTE WS-REMAINING-UNITS =
282360200423                       WS-REMAINING-UNITS
282370200423                     - CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVEST2-REC
282380200423
282390200423               COMPUTE WS-REMAINING-PERCENT =
282400200423                       WS-REMAINING-PERCENT
282410200423                     - CONTRACT-UNIT-PERCENT OF ACIDB3-REC
282420200423
282430200423               IF WS-REMAINING-UNITS = 0
282440200423                   COMPUTE CONTRACT-UNIT-PERCENT OF ACIDB3-REC =
282450200423                           CONTRACT-UNIT-PERCENT OF ACIDB3-REC +
282460200423                           WS-REMAINING-PERCENT
282470200423               ELSE
282480200423                   IF WS-REMAINING-UNITS < 0
282490200423                       COMPUTE CONTRACT-UNIT-PERCENT OF ACIDB3-REC =
282500200423                               CONTRACT-UNIT-PERCENT OF ACIDB3-REC +
282510200423                               WS-REMAINING-PERCENT
282520200423                   END-IF
282530200423               END-IF
282540200423               READ ACCOUNT-CONTRACT-INV-DIST-BAL2
282550200423                INVALID KEY
282560200423                   WRITE ACIDB3-REC
282570200423018885*Commented out changes done in RFS1015039
282580200423015039*            INVALID KEY
28259020042358714              IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28260020042358714                 MOVE "MFAACCCDP" TO WS-FILE-STATUS-FILE-NAME
28261020042358714                 SET lncc_Err155  TO  TRUE
28262020042358714                 PERFORM LOG-FILE-STATUS
28263020042358714              END-IF
282640200423015039*           END-WRITE
282650200423015039*         NOT INVALID KEY
282660200423018885*            MOVE "N"        TO WS-PID-ERROR
282670200423               END-READ
282680200423018885         MOVE "N"        TO WS-PID-ERROR
282690200423           END-IF.
282700200423
282710200423           READ ACCOUNT-CONTRACT-INVESTMENT2 NEXT RECORD
282720200423             AT END
282730200423             MOVE "10"              TO WS-END-OF-ACI
282740200423             GO TO RCT-EXIT
282750200423           END-READ.
282760200423
282770200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
282780200423              ACCOUNT-NO OF TRANS
282790200423              MOVE "10"             TO WS-END-OF-ACI
282800200423              GO TO RCT-EXIT
282810200423           END-IF.
282820200423
282830200423       RCT-EXIT.
282840200423           EXIT.
282850200423
282860200423      *RFS 4637 - END
282870200423
28288020042326151**For MFR transaction only.
28289020042326151**Get the first Open or Active contract from MFAACCCIP.
282900200423
28291020042326151  READ-CONTRACT-LOOP-MFR.
282920200423      * RFS35909 - Start: Save Contract Number to be used while
282930200423      *   creating new acc-inv-contract record
282940200423           IF ACCOUNT-NO      OF ACCOUNT-CONTRACT-INVEST2-REC =
282950200423                ACCOUNT-NO    OF TRANS            AND
282960200423              INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC =
282970200423                INVESTMENT-CODE OF TRANS
282980200423             MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INVEST2-REC TO
282990200423                  ln_currContractNo
283000200423           END-IF
283010200423      * RFS35909 - End
283020200423
28303020042326151      IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC =
28304020042326151         ACCOUNT-NO OF TRANS AND
28305020042326151         INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC =
28306020042326151         INVESTMENT-CODE OF TRANS AND
28307020042326151         CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVEST2-REC
28308020042326151         NOT EQUAL ZEROES
28309020042326151         SET SW-RECORD-FOUND-YES TO TRUE
28310020042326151         MOVE "N"        TO WS-PID-ERROR
28311020042326151      ELSE
28312020042326151         READ ACCOUNT-CONTRACT-INVESTMENT2 NEXT RECORD
28313020042326151           AT END
28314020042326151             MOVE "10"              TO WS-END-OF-ACI
28315020042326151         END-READ
28316020042326151      END-IF.
283170200423
283180200423      *RFS 13829 Begin
283190200423      /
283200200423       FIND-IF-ACIDB-REC-EXISTS SECTION.
283210200423       FAE-0010.
283220200423
283230200423      **** PRIME READ OF FIRST CONTRACT
283240200423
283250200423           INITIALIZE MFAACCCIP OF ACCOUNT-CONTRACT-INVEST2-REC.
283260200423
283270200423           MOVE ACCOUNT-NO      OF TRANS
283280200423           TO   ACCOUNT-NO      OF ACCOUNT-CONTRACT-INVEST2-REC.
283290200423
283300200423           MOVE ZEROES
283310200423           TO   CONTRACT-NO     OF ACCOUNT-CONTRACT-INVEST2-REC.
283320200423
283330200423           MOVE SPACES
283340200423           TO   INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC.
283350200423
283360200423           MOVE "00"                TO WS-END-OF-ACI.
283370200423
283380200423           START ACCOUNT-CONTRACT-INVESTMENT2
283390200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
283400200423             INVALID KEY
283410200423             GO TO FAE-EXIT.
283420200423
283430200423           READ ACCOUNT-CONTRACT-INVESTMENT2 NEXT RECORD
283440200423             AT END
283450200423             MOVE "10" TO WS-END-OF-ACI
283460200423             GO TO FAE-EXIT
283470200423           END-READ.
283480200423
283490200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
283500200423              ACCOUNT-NO OF TRANS
283510200423              MOVE "10" TO WS-END-OF-ACI
283520200423              GO TO FAE-EXIT
283530200423           END-IF.
283540200423
283550200423           PERFORM READ-CONTRACT-LOOP-2 THRU RC2-EXIT UNTIL
283560200423           END-OF-ACI OR
283570200423           ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
283580200423           ACCOUNT-NO OF TRANS OR
283590200423           WS-REC-ACIDB-EXISTS = "Y".
283600200423
283610200423       FAE-EXIT.
283620200423             EXIT.
283630200423      /
283640200423       READ-CONTRACT-LOOP-2 SECTION.
283650200423       RC2-0010.
283660200423
283670200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC =
283680200423              ACCOUNT-NO OF TRANS AND
283690200423              INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC =
283700200423              INVESTMENT-CODE OF TRANS AND
283710200423              CURR-UNIT-BAL OF ACCOUNT-CONTRACT-INVEST2-REC
283720200423              NOT EQUAL ZEROES
283730200423
283740200423               MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
283750200423               TO   ACCOUNT-NO OF ACIDB2-REC
283760200423
283770200423               MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INVEST2-REC
283780200423               TO   CONTRACT-NO OF ACIDB2-REC
283790200423
283800200423               MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INVEST2-REC
283810200423               TO   INVESTMENT-CODE OF ACIDB2-REC
283820200423
283830200423               MOVE DATE-OF-RECORD OF TRANS-DISTR-DETAILS
283840200423               TO   DATE-OF-RECORD OF ACIDB2-REC
283850200423
283860200423               MOVE "Y"     TO WS-REC-ACIDB-EXISTS
283870200423
283880200423               READ ACCOUNT-CONTRACT-INV-DIST-BAL2
283890200423               INVALID KEY
283900200423                   MOVE "N" TO WS-REC-ACIDB-EXISTS
283910200423               END-READ
283920200423
283930200423           END-IF.
283940200423
283950200423       RC2-0020.
283960200423
283970200423           READ ACCOUNT-CONTRACT-INVESTMENT2 NEXT RECORD
283980200423             AT END
283990200423             MOVE "10"              TO WS-END-OF-ACI
284000200423             GO TO RC2-EXIT
284010200423           END-READ.
284020200423
284030200423           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INVEST2-REC NOT EQUAL
284040200423              ACCOUNT-NO OF TRANS
284050200423              MOVE "10"             TO WS-END-OF-ACI
284060200423              GO TO RC2-EXIT
284070200423           END-IF.
284080200423
284090200423       RC2-EXIT.
284100200423           EXIT.
284110200423      /
284120200423       PUT-100-PERCENT-TO-ACIDB SECTION.
284130200423       PTA-0010.
284140200423
284150200423           MOVE ACCOUNT-NO OF TRANS
284160200423           TO   ACCOUNT-NO OF ACIDB3-REC.
284170200423
284180200423           MOVE WS-ASSOCIATED-CONTRACT
284190200423           TO   CONTRACT-NO OF ACIDB3-REC.
284200200423
284210200423           MOVE INVESTMENT-CODE OF TRANS
284220200423           TO   INVESTMENT-CODE OF ACIDB3-REC.
284230200423
284240200423           MOVE WS-SAVE-CURR-UNIT-BAL
284250200423           TO WS-CURR-BASE-UNITS.
284260200423
284270200423           MOVE WS-CURR-BASE-UNITS
284280200423           TO   UNIT-AMT OF ACIDB3-REC.
284290200423
284300200423           MOVE CURR-UNIT-BAL   OF ACCOUNT-CONTRACT-INVEST2-REC
284310200423           TO   CURR-UNIT-BAL   OF ACIDB3-REC
284320200423
284330200423           MOVE 100
284340200423           TO   CONTRACT-UNIT-PERCENT OF ACIDB3-REC.
284350200423
284360200423           MOVE DATE-OF-RECORD OF TRANS-DISTR-DETAILS
284370200423           TO   DATE-OF-RECORD OF ACIDB3-REC.
284380200423
284390200423           WRITE ACIDB3-REC.
284400200423
28441020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28442020042358714         MOVE "MFAACCCDP" TO WS-FILE-STATUS-FILE-NAME
28443020042358714         SET lncc_Err156  TO  TRUE
28444020042358714         PERFORM LOG-FILE-STATUS
28445020042358714      END-IF.
284460200423
284470200423       PTA-EXIT.
284480200423             EXIT.
284490200423      /
284500200423       CHECK-IF-ASSOCIATED-CONTRACT SECTION.
284510200423       CIA-0010.
284520200423
284530200423           MOVE PLACEMENT-DATE OF TRANS
284540200423           TO   PLACEMENT-DATE-2 OF TRANS-TARGET-3.
284550200423
284560200423           MOVE TRANS-NO OF TRANS
284570200423           TO   TRANS-NO-2 OF TRANS-TARGET-3.
284580200423
284590200423           READ TRANS-TARGET-3
284600200423           KEY IS EXTERNALLY-DESCRIBED-KEY
284610200423           INVALID KEY
284620200423             MOVE 'N'        TO WS-ASSOCIATED-CONTRACT-FOUND
284630200423             GO TO CIA-EXIT
284640200423           END-READ.
284650200423
284660200423           MOVE PLACEMENT-DATE   OF TRANS-TARGET-3
284670200423           TO   PLACEMENT-DATE   OF TRANS-CONTRACT-DETAILS.
284680200423
284690200423           MOVE TRANS-NO       OF TRANS-TARGET-3
284700200423           TO   TRANS-NO         OF TRANS-CONTRACT-DETAILS.
284710200423
284720200423           MOVE ZEROES       TO CONTRACT-NO OF TRANS-CONTRACT-DETAILS.
284730200423
284740200423           START TRANS-CONTRACT-DETAILS
284750200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
284760200423           INVALID KEY
284770200423             MOVE 'N'        TO WS-ASSOCIATED-CONTRACT-FOUND
284780200423             GO TO CIA-EXIT
284790200423           END-START.
284800200423
284810200423           READ TRANS-CONTRACT-DETAILS NEXT RECORD
284820200423           WITH NO LOCK
284830200423           AT END
284840200423             MOVE 'N'        TO WS-ASSOCIATED-CONTRACT-FOUND
284850200423             GO TO CIA-EXIT
284860200423           END-READ.
284870200423
284880200423           MOVE "Y"          TO WS-ASSOCIATED-CONTRACT-FOUND
284890200423
284900200423           MOVE CONTRACT-NO OF TRANS-CONTRACT-DETAILS
284910200423           TO   WS-ASSOCIATED-CONTRACT.
284920200423
284930200423       CIA-EXIT.
284940200423             EXIT.
284950200423      *RFS 13829 End
284960200423      /
284970200423      *RFS 8470 - BEGIN
284980200423       EVAL-CHQ-LOGIC SECTION.
284990200423
285000200423           IF NOT GIC-INVESTMENT
285010200423             GO TO ECL-EXIT
285020200423           END-IF.
285030200423
285040200423           IF NOT REDEMPTION-TRANSACTION
285050200423             GO TO ECL-EXIT
285060200423           END-IF.
285070200423
285080200423           IF CURRENT-CERTIFICATE-BALANCE
285090200423                             OF GIC-CERTIFICATE-DETAILS
285100200423                             IS NOT EQUAL 0
285110200423             GO TO ECL-EXIT
285120200423           END-IF.
285130200423
285140200423           MOVE "CHQ"        TO TRANS-STATUS-CODE OF TRANS-GIC-CHK.
285150200423           MOVE ACCOUNT-NO OF TRANS
285160200423                             TO ACCOUNT-NO OF TRANS-GIC-CHK.
285170200423           MOVE INVESTMENT-CODE OF TRANS
285180200423                             TO INVESTMENT-CODE OF TRANS-GIC-CHK.
285190200423
285200200423           START TRANS-GIC-CHK
285210200423           KEY IS EQUAL EXTERNALLY-DESCRIBED-KEY
285220200423           INVALID KEY
285230200423             GO TO ECL-EXIT
285240200423           END-START.
285250200423
285260200423
285270200423       ECL-0100.
285280200423
285290200423           READ TRANS-GIC-CHK NEXT RECORD
285300200423           AT END
285310200423             GO TO ECL-EXIT
285320200423           END-READ.
285330200423
285340200423           IF ACCOUNT-NO OF TRANS-GIC-CHK IS NOT EQUAL
285350200423           ACCOUNT-NO OF TRANS
285360200423             GO TO ECL-EXIT
285370200423           END-IF.
285380200423
285390200423           IF INVESTMENT-CODE OF TRANS-GIC-CHK IS NOT EQUAL
285400200423           INVESTMENT-CODE OF TRANS
285410200423             GO TO ECL-EXIT
285420200423           END-IF.
285430200423
285440200423           IF TRANS-STATUS-CODE OF TRANS-GIC-CHK IS NOT EQUAL "CHQ"
285450200423             GO TO ECL-EXIT
285460200423           END-IF.
285470200423
285480200423           IF TRANS-TYPE-CODE OF TRANS-GIC-CHK IS NOT EQUAL "INT"
285490200423             GO TO ECL-0100
285500200423           END-IF.
285510200423
285520200423      * RFS11964 - Begin
285530200423           IF TRADE-DATE OF TRANS-GIC-CHK > PASS-PROCESS-DATE-9    OR
285540200423              TRADE-DATE OF TRANS-GIC-CHK < WS-PASS-PROCESS-DATE-SAV
285550200423             GO TO ECL-0100
285560200423           END-IF.
285570200423      * RFS11964 - End
285580200423
285590200423           MOVE PLACEMENT-DATE OF TRANS-GIC-CHK
285600200423                             TO PLACEMENT-DATE
285610200423                             OF GIC-TRANS-RELATIONSHIP.
285620200423
285630200423           MOVE TRANS-NO OF TRANS-GIC-CHK
285640200423                             TO TRANS-NO
285650200423                             OF GIC-TRANS-RELATIONSHIP.
285660200423
285670200423           MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
285680200423                             TO CERTIFICATE-ID-NO
285690200423                             OF GIC-TRANS-RELATIONSHIP.
285700200423
285710200423           READ GIC-TRANS-RELATIONSHIP
285720200423           INVALID KEY
285730200423             GO TO ECL-0100
285740200423           END-READ.
285750200423
285760200423
285770200423           MOVE "Y"          TO WS-PROCESS-GIC-INT-FIRST.
285780200423
285790200423           CALL "RTVCMPCD"   USING WS-RQ-MGMT-CO.
285800200423           CANCEL "RTVCMPCD".
285810200423
285820200423           CALL "RTVCLIB"    USING WS-CUR-LIB.
285830200423           CANCEL "RTVCLIB".
285840200423
285850200423
285860200423           MOVE PLACEMENT-DATE OF TRANS-GIC-CHK
285870200423                             TO WS-RQ-PLACEMENT-DATE.
285880200423
285890200423           MOVE TRANS-NO OF TRANS-GIC-CHK
285900200423                          TO WS-RQ-TRANS-NO.
285910200423
285920200423
285930200423           MOVE WS-CUR-LIB   TO DATA-O-LIBRARY-GIC
285940200423                                DATA-I-LIBRARY-GIC.
285950200423
285960200423           MOVE REQUEST-LAYOUT2
285970200423                             TO DATA-O-MESSAGE-GIC.
285980200423
285990200423           CALL "QSNDDTAQ"   USING DATA-O-NAME-GIC
286000200423                                   DATA-O-LIBRARY-GIC
286010200423                                   DATA-O-MESSAGE-LEN-GIC
286020200423                                   DATA-O-MESSAGE-GIC.
286030200423
286040200423           MOVE PLACEMENT-DATE OF TRANS
286050200423                             TO WS-RQ-PLACEMENT-DATE.
286060200423
286070200423           MOVE TRANS-NO OF TRANS
286080200423                          TO WS-RQ-TRANS-NO.
286090200423
286100200423           MOVE WS-CUR-LIB   TO DATA-O-LIBRARY-GIC
286110200423                                DATA-I-LIBRARY-GIC.
286120200423
286130200423           MOVE REQUEST-LAYOUT2
286140200423                             TO DATA-O-MESSAGE-GIC.
286150200423
286160200423           CALL "QSNDDTAQ"   USING DATA-O-NAME-GIC
286170200423                                   DATA-O-LIBRARY-GIC
286180200423                                   DATA-O-MESSAGE-LEN-GIC
286190200423                                   DATA-O-MESSAGE-GIC.
286200200423       ECL-EXIT.
286210200423           EXIT.
286220200423      *RFS 8470 - END
286230200423      *RFS10351 - Start
286240200423      * ---------------------------------
286250200423       VA-GET-INV-PRODUCT SECTION.
286260200423      * ---------------------------------
286270200423       VA-0000.
286280200423           INITIALIZE INVESTMENT-TYPE-RULE
286290200423      *
286300200423           MOVE PASS-CDSC-INVESTMENT                            TO
286310200423                                     INVESTMENT-CODE OF INVESTMENT
286320200423           READ INVESTMENT
286330200423             KEY IS EXTERNALLY-DESCRIBED-KEY
286340200423             INVALID KEY
286350200423               MOVE SPACES TO INVESTMENT-CODE OF INVESTMENT
286360200423             NOT INVALID KEY
286370200423               MOVE PRODUCT-TYPE-CODE OF INVESTMENT             TO
286380200423                           PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
286390200423               READ PRODUCT-TYPE-CODES
286400200423                 INVALID KEY
286410200423                   MOVE SPACES                                  TO
286420200423                           PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
286430200423                 NOT INVALID KEY
286440200423                   MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES TO
286450200423                                             INVESTMENT-TYPE-RULE
286460200423               END-READ
286470200423           END-READ.
286480200423       VGIP-EXIT.
286490200423           EXIT.
286500200423      *RFS10351 - End
286510200423
286520200423      * RFS92475 - Start.
286530200423      * ---------------------------------
286540200423       Read-Fee-Exclusions SECTION.
286550200423
286560200423           READ FEE-EXCLUSIONS
286570200423             AT END
286580200423               SET Lb-EOF-FeeExc-Yes TO TRUE
286590200423           END-READ.
286600200423
286610200423           IF Lb-EOF-FeeExc-No
286620200423              SET CRRIDX UP BY 1
286630200423              IF CRRIDX >= ln_Array-Size
286640200423                 COMPUTE ln_Array-Size   = ln_Array-Size   + 1
286650200423              END-IF
286660200423              MOVE Account-Type-Code OF FEE-EXCLUSIONS-REC
286670200423                TO lc_Fee-Acct-Type-Code(CRRIDX)
286680200423              MOVE Contr-Redem-Code-rule OF FEE-EXCLUSIONS-REC
286690200423                TO lc_Fee-Contr-Redem-Rule(CRRIDX)
286700200423              MOVE Deduction-Code OF FEE-EXCLUSIONS-REC
286710200423                TO lc_Fee-Charge-Code(CRRIDX)
286720200423           END-IF.
286730200423
286740200423           IF Lb-EOF-FeeExc-Yes
286750200423              SET CRRIDX UP BY 1
286760200423              INITIALIZE    Fee-Exclusions-Element(CRRIDX)
286770200423           END-IF.
286780200423      * RFS92475 - End.
286790200423
286800200423      * RFS 52265 - begins.
286810200423      * ---------------------------------
286820200423       Read-Trans-Type-Exemption SECTION.
286830200423
286840200423           READ TRANS-TYPE-EXEMPTION-RULES
286850200423             AT END
286860200423               SET Lb-EOF-TrnExempt-Yes TO TRUE
286870200423           END-READ.
286880200423
286890200423           IF Lb-EOF-TrnExempt-No
286900200423              SET TRNIDX UP BY 1
286910200423              IF TRNIDX >= ln_TrnExemptArray-Size
286920200423                 COMPUTE ln_TrnExemptArray-Size   =
286930200423                         ln_TrnExemptArray-Size  + 1
286940200423              END-IF
286950200423              MOVE Trans-Type-Code   OF TRANS-TYPE-EXEMPTION-RULES-REC
286960200423                TO lr_Trans-Type-Code(TRNIDX)
286970200423              MOVE Trans-Sub-Type    OF TRANS-TYPE-EXEMPTION-RULES-REC
286980200423                TO lr_Trans-Sub-Type(TRNIDX)
286990200423              MOVE Trans-Origin-Code OF TRANS-TYPE-EXEMPTION-RULES-REC
287000200423                TO lr_Trans-Origin-Code(TRNIDX)
287010200423              MOVE Exemption-Rule    OF TRANS-TYPE-EXEMPTION-RULES-REC
287020200423                TO lr_Exemption-Rule(TRNIDX)
287030200423115495        MOVE Account-Type-Code OF TRANS-TYPE-EXEMPTION-RULES-REC
287040200423115495          TO lr_Account-Type-Code(TRNIDX)
287050200423           END-IF.
287060200423
287070200423           IF Lb-EOF-TrnExempt-Yes
287080200423              SET TRNIDX UP BY 1
287090200423              INITIALIZE    Trans-Type-Exemption-Element(TRNIDX)
287100200423           END-IF.
287110200423      * RFS 52265 - ends.
287120200423
287130200423      * RFS9530  - Begin
287140200423      * ---------------------------------
287150200423       READ-CONTROL-FILE SECTION.
287160200423      * ---------------------------------
287170200423       RCF-0000.
287180200423           READ CONTROL-FILE
287190200423             INVALID KEY
287200200423               MOVE WS-TEMP-STR       TO WS-FILE-STATUS-FILE-NAME
28721020042358714          PERFORM LOG-FILE-STATUS-RD
287220200423               INITIALIZE NEXT-NUMBER OF CONTROL-FILE
287230200423           END-READ.
287240200423       RCF-EXIT.
287250200423           EXIT.
287260200423      * ---------------------------------
287270200423       REWRITE-CONTROL-FILE SECTION.
287280200423      * ---------------------------------
287290200423       RECF-0000.
287300200423           REWRITE CONTROL-FILE-REC
287310200423             INVALID KEY
28732020042358714          CONTINUE
28733020042358714 *        MOVE WS-TEMP-STR       TO WS-FILE-STATUS-FILE-NAME
28734020042358714 *        PERFORM LOG-FILE-STATUS
287350200423           END-REWRITE.
28736020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
28737020042358714         MOVE WS-TEMP-STR     TO WS-FILE-STATUS-FILE-NAME
28738020042358714         SET lncc_Err157  TO  TRUE
28739020042358714         PERFORM LOG-FILE-STATUS
28740020042358714      END-IF.
287410200423
287420200423       RECF-EXIT.
287430200423           EXIT.
287440200423      * ---------------------------------
287450200423       SET-NEXT-DATE-SWI SECTION.
287460200423      * ---------------------------------
287470200423       SNDS-0000.
287480200423      * Set switch for SWO from MF to GIC/DII
287490200423           IF TRANS-TYPE-CODE OF WS-TRANS-REC = "SWI"      AND
287500200423              TRANS-TYPE-CODE OF WS-TRANS-REC-2 = "SWO"    AND
287510200423              TRADE-DATE OF WS-TRANS-REC > PASS-PROCESS-DATE-9
287520200423             MOVE WS-TRANS-REC                TO WS-TEMP-TRANS-REC
287530200423             PERFORM GET-INVESTMENT-TYPE-RULE
287540200423             MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES     TO
287550200423                                               INVESTMENT-TYPE-RULE-1
287560200423             IF GIC-DII-INVESTMENT-1
287570200423               MOVE WS-TRANS-REC-2            TO WS-TEMP-TRANS-REC
287580200423               PERFORM GET-INVESTMENT-TYPE-RULE
287590200423               MOVE PRODUCT-TYPE-RULE OF PRODUCT-TYPE-CODES   TO
287600200423                                             INVESTMENT-TYPE-RULE-2
287610200423               IF NOT GIC-DII-INVESTMENT-2
287620200423                 SET WS-NEXT-DATE-SWI-YES     TO TRUE.
287630200423       SNDS-EXIT.
287640200423           EXIT.
287650200423      * RFS14898 - Begin
287660200423      * ---------------------------------
287670200423       SET-SWITCH-TO-SAME-ACC-INV SECTION.
287680200423      * ---------------------------------
287690200423       SSTSAI-0000.
287700200423           IF ACCOUNT-NO OF WS-TRANS-REC =
287710200423                            ACCOUNT-NO OF WS-TRANS-REC-2   AND
287720200423              INVESTMENT-CODE OF WS-TRANS-REC =
287730200423                       INVESTMENT-CODE OF WS-TRANS-REC-2
287740200423      *RFS 16919 Begin
287750200423              AND NOT LSIF-ROLLOVER
287760200423      *RFS 16919 End
287770200423                SET WS-SWITCH-TO-SAME-ACC-INV-YES      TO TRUE
287780200423           END-IF.
287790200423      *RFS182952 START
287800200423           IF ACCOUNT-NO OF WS-TRANS-REC =
287810200423                            ACCOUNT-NO OF WS-TRANS-REC-2
287820200423              SET WS-SWITCH-TO-SAME-ACC-YES TO TRUE
287830200423           END-IF.
287840200423      *RFS182952 END
287850200423       SSTSAI-EXIT.
287860200423           EXIT.
287870200423      * RFS14898 - End
287880200423
287890200423      * RFS17180 - Begin
287900200423      * ---------------------------------
287910200423       SET-LAST-TRANSACTION-FLAG SECTION.
287920200423      * ---------------------------------
287930200423           IF TOTAL-ALLOC-TO-PROCESS =
287940200423              PROCESS-SEQUENCE OF TRANS-ASSET-ALLOC-HEADER
287950200423             MOVE LT-Y       TO WS-LAST-AA-REC-TO-PROCESS
287960200423           END-IF.
287970200423       SET-EXIT.
287980200423           EXIT.
287990200423      * ---------------------------------
288000200423       SET-ALL-UNITS-TO-OTHER-PH SECTION.
288010200423      * ---------------------------------
288020200423      * RFS19210 - Begin
288030200423           IF SWO-SWI-TRANSACTION                   AND
288040200423      * RFS19210 - End
288050200423      * RFS25821 - Begin - put back commented code in RFS23802
288060200423      * RFS23802 - Begin
288070200423              ACCOUNT-NO OF WS-TRANS-REC =
288080200423                              ACCOUNT-NO OF WS-TRANS-REC-2        AND
288090200423      * RFS23802 - End
288100200423      * RFS25821 - End
288110200423              SPLIT-OPTION-CODE OF ASSET-ALLOCATION-HEADER = LT-A AND
288120200423              AA-MODEL-CODE  OF ASSET-ALLOCATION-HEADER NOT = SPACES
288130200423                                                                  AND
288140200423              AA-MODEL-CODE2 OF ASSET-ALLOCATION-HEADER NOT = SPACES
288150200423               SET WS-ALL-UNITS-TO-OTHER-PH-YES       TO TRUE
288160200423           END-IF.
288170200423       SAUTOP-EXIT.
288180200423           EXIT.
288190200423      * RFS19210 - Begin: Change logic in this paragraph
288200200423      * ---------------------------------
288210200423       VALIDATE-ACTIVE-PHANTOM SECTION.
288220200423      * ---------------------------------
288230200423       VAP-0000.
288240200423           IF AAP-AAH-INVESTMENT
288250200423             PERFORM GET-ACTIVE-PHANTOM
288260200423             PERFORM GET-CURR-PHANTOM-STATUS
288270200423
288280200423      * RFS25821 - Begin
288290200423      * ---------------------------------------------------------------
288300200423      * RFS23802 - Begin
288310200423      *      IF REDEMPTION-TRANSACTION
288320200423      *         MOVE  LT-Y     TO WS-DEL-ACTIVE-AAP
288330200423      *      END-IF
288340200423      * RFS23802 - End
288350200423      * ---------------------------------------------------------------
288360200423             IF REDEMPTION-TRANSACTION  AND
288370200423                TRANS-ORIGIN-CODE OF TRANS IS NOT EQUAL "ARA"
288380200423                 MOVE  LT-Y     TO WS-DEL-ACTIVE-AAP
288390200423               END-IF
288400200423             END-IF
288410200423             MOVE AA-MODEL-CODE  OF ASSET-ALLOCATION-HEADER   TO
288420200423                  WS-CURR-AA-MODEL-CODE
288430200423      * RFS25821 - End
288440200423
288450200423             IF WS-ALL-UNITS-TO-OTHER-PH-YES
288460200423      * RFS25821 - Begin - put back commented code
288470200423      * RFS23802 - Begin
288480200423      * ---------------------------------------------------------------
288490200423      **       IF SWI-TRANSACTION
288500200423      *        IF SWITCH-IN-TRANSACTION
288510200423      * ---------------------------------------------------------------
288520200423               IF SWI-TRANSACTION
288530200423      * RFS23802 - End
288540200423      * RFS25821 - End
288550200423                 IF WS-LAST-AA-REC-TO-PROCESS = LT-Y   OR
288560200423                   (AAP-INVESTMENT-SW-OUT AND AAP-INVESTMENT-SW-IN)
288570200423                   MOVE LT-Y   TO WS-SET-TO-ACTIVE
288580200423                 END-IF
288590200423               ELSE
288600200423                 PERFORM REJECT-IF-NOT-ACT
288610200423               END-IF
288620200423             ELSE
288630200423               IF WS-CURR-ACTIVE-INV-NOT-EXISTS   AND
288640200423                  PURCHASE-TRANSACTION
288650200423                 MOVE LT-Y   TO WS-SET-TO-ACTIVE
288660200423               ELSE
288670200423                 PERFORM REJECT-IF-NOT-ACT.
288680200423       VAP-EXIT.
288690200423           EXIT.
288700200423
288710200423      * RFS25821 - Begin
288720200423      *
288730200423      * ---------------------------------------------------------------
288740200423      * Call subprogram which calculate Current unit balance
288750200423      * for all holings in the Phantom. If COUB = 0.0 then
288760200423      * phantom active should be deleted.
288770200423      * ---------------------------------------------------------------
288780200423      * RFS23802 - Begin
288790200423      * ---------------------------------
288800200423       DELETE-ACTIVE-AAP-STATUS SECTION.
288810200423      * ---------------------------------
288820200423           PERFORM CALC-CURR-UNIT-BAL-PER-PHANTOM
288830200423
288840200423           IF WS-CURR-UNITS-BAL-PER-PHANTOM = 0.0    AND
288850200423              SW-RETN-BAL-STATUS-OK
288860200423             INITIALIZE COMM-PARMS
288870200423             MOVE ACCOUNT-NO OF TRANS    TO
288880200423                  COMM-ACCOUNT-NO OF COMM-CPAAAINV-PARAMETERS
288890200423             MOVE WS-CURR-ACTIVE-INVESTMENT TO
288900200423                  COMM-INVESTMENT-CODE OF COMM-CPAAAINV-PARAMETERS
288910200423
288920200423             SET COMM-ACTION-DEL-DATA    TO TRUE
288930200423             PERFORM CALL-FXAAAINV
288940200423
288950200423             IF NOT RETN-OK OF COMM-CPAAAINV-PARAMETERS
288960200423               DISPLAY "Delete Active Investment failed. RETN-CODE = "
288970200423                 RETN-CODE OF COMM-CPAAAINV-PARAMETERS
288980200423               PERFORM SET-INVESTMENT-DSP
288990200423             END-IF
289000200423           END-IF.
289010200423       DAAS-EXIT.
289020200423            EXIT.
289030200423      * -------------------------------------
289040200423       CALC-CURR-UNIT-BAL-PER-PHANTOM SECTION.
289050200423      * -------------------------------------
289060200423            INITIALIZE WS-CURR-UNITS-BAL-PER-PHANTOM
289070200423                       SW-RETN-BAL-STATUS-FLAG
289080200423
289090200423            MOVE ACCOUNT-NO        OF TRANS  TO
289100200423                 PASS-ACCOUNT-NO        OF COMM-CPPHCUB-PARAMETERS
289110200423            MOVE WS-CURR-AA-MODEL-CODE       TO
289120200423                 PASS-MODEL-CODE        OF COMM-CPPHCUB-PARAMETERS
289130200423            MOVE TRADE-DATE OF TRANS         TO
289140200423                 PASS-TRADE-DATE        OF COMM-CPPHCUB-PARAMETERS
289150200423            MOVE WS-CURR-ACTIVE-INVESTMENT   TO
289160200423                 PASS-ACTIVE-INVESTMENT OF COMM-CPPHCUB-PARAMETERS
289170200423
289180200423            CALL "FXPHCUB" USING COMM-CPPHCUB-PARAMETERS
289190200423
289200200423            MOVE RETN-CURR-UNIT-BAL OF COMM-CPPHCUB-PARAMETERS   TO
289210200423                                       WS-CURR-UNITS-BAL-PER-PHANTOM
289220200423            MOVE RETN-CODE          OF COMM-CPPHCUB-PARAMETERS   TO
289230200423                                       SW-RETN-BAL-STATUS-FLAG.
289240200423       CCUBPP-EXIT.
289250200423            EXIT.
289260200423
289270200423      * RFS25821 - End
289280200423
289290200423      * ---------------------------------
289300200423       REJECT-IF-NOT-ACT SECTION.
289310200423      * ---------------------------------
289320200423           IF NOT WS-CURR-ACCOUNT-INV-STATUS-ACT
289330200423               MOVE LT-A1   TO REJECTION-CODE OF TRANS
289340200423           END-IF.
289350200423        RINA-EXIT.
289360200423           EXIT.
289370200423      * RFS19210 - End
289380200423      * ---------------------------------
289390200423       GET-ACCOUNT-INVESTMENT SECTION.
289400200423      * ---------------------------------
289410200423           MOVE ACCOUNT-NO OF TRANS
289420200423                               TO ACCOUNT-NO OF ACCOUNT-INVESTMENT
289430200423           MOVE INVESTMENT-CODE OF TRANS
289440200423                               TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT.
289450200423
289460200423           READ ACCOUNT-INVESTMENT WITH NO LOCK
289470200423             INVALID KEY
289480200423              SET SW-TEMP-FAIL     TO TRUE
289490200423             NOT INVALID KEY
289500200423              SET SW-TEMP-OK       TO TRUE
289510200423           END-READ.
289520200423       GAI-EXIT.
289530200423           EXIT.
289540200423      * ---------------------------------
289550200423       GET-ACTIVE-PHANTOM SECTION.
289560200423      * ---------------------------------
289570200423           INITIALIZE WS-CURR-ACTIVE-INVESTMENT
289580200423                      COMM-PARMS
289590200423           MOVE ACCOUNT-NO OF TRANS    TO COMM-ACCOUNT-NO OF COMM-PARMS
289600200423           SET COMM-ACTION-GET-ACTIVE  TO TRUE
289610200423           PERFORM CALL-FXAAAINV
289620200423      * RFS15626 - Begin
289630200423      *    MOVE RETN-INVESTMENT-CODE   TO WS-CURR-ACTIVE-INVESTMENT.
289640200423           MOVE RETN-INVESTMENT-CODE OF COMM-CPAAAINV-PARAMETERS  TO
289650200423                                          WS-CURR-ACTIVE-INVESTMENT.
289660200423      * RFS15626 - End
289670200423       GAP-EXIT.
289680200423           EXIT.
289690200423      * ---------------------------------
289700200423       GET-CURR-PHANTOM-STATUS SECTION.
289710200423      * ---------------------------------
289720200423           INITIALIZE WS-CURR-ACCOUNT-INV-STATUS
289730200423                      COMM-PARMS
289740200423           MOVE ACCOUNT-NO OF TRANS    TO COMM-ACCOUNT-NO OF COMM-PARMS
289750200423
289760200423      * RFS19210 - Begin
289770200423           INITIALIZE WS-CURR-PHANTOM
289780200423
289790200423           IF WS-TRADE-ON-HOLDING-AASWITCH = LT-Y
289800200423             IF SWITCH-IN-TRANSACTION
289810200423               MOVE INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER   TO
289820200423                    WS-CURR-PHANTOM
289830200423             ELSE
289840200423               MOVE INVESTMENT-CODE  OF ASSET-ALLOCATION-HEADER   TO
289850200423                    WS-CURR-PHANTOM
289860200423             END-IF
289870200423           ELSE
289880200423             IF AAP-INVESTMENT
289890200423               MOVE INVESTMENT-CODE OF TRANS    TO WS-CURR-PHANTOM
289900200423             ELSE
289910200423               IF AAH-INVESTMENT
289920200423                 IF SWITCH-TRANSACTION
289930200423                   EVALUATE TRUE
289940200423                     WHEN SWITCH-IN-TRANSACTION
289950200423                       MOVE INVESTMENT-CODE OF WS-TRANS-REC-2 TO
289960200423                            WS-CURR-PHANTOM
289970200423                     WHEN SWITCH-OUT-TRANSACTION
289980200423                       MOVE INVESTMENT-CODE OF WS-TRANS-REC-1 TO
289990200423                            WS-CURR-PHANTOM
290000200423                     WHEN OTHER
290010200423                       MOVE INVESTMENT-CODE OF TRANS          TO
290020200423                            WS-CURR-PHANTOM
290030200423                   END-EVALUATE
290040200423                 ELSE
290050200423                   MOVE INVESTMENT-CODE  OF ASSET-ALLOCATION-HEADER TO
290060200423                        WS-CURR-PHANTOM
290070200423                 END-IF
290080200423               END-IF
290090200423             END-IF
290100200423           END-IF
290110200423
290120200423           IF AAP-AAH-INVESTMENT
290130200423            MOVE WS-CURR-PHANTOM                                TO
290140200423                    COMM-INVESTMENT-CODE OF COMM-PARMS
290150200423            SET COMM-ACTION-GET-DATA    TO TRUE
290160200423            PERFORM CALL-FXAAAINV
290170200423            MOVE RETN-ACCOUNT-INV-STATUS TO WS-CURR-ACCOUNT-INV-STATUS
290180200423           END-IF.
290190200423      * RFS19210 - End
290200200423       GCPS-EXIT.
290210200423           EXIT.
290220200423      * ---------------------------------
290230200423       CALL-FXAAAINV SECTION.
290240200423      * ---------------------------------
290250200423      * RFS17813 - Begin:use COMM-CPAAAINV-PARAMETERS
290260200423           CALL "FXAAAINV" USING
290270200423                           COMM-CPAAAINV-PARAMETERS
290280200423      * RFS17813 - End
290290200423       CF-EXIT.
290300200423           EXIT.
290310200423      * RFS17180 - End
290320200423      * ---------------------------------
290330200423       GET-INVESTMENT-TYPE-RULE SECTION.
290340200423      * ---------------------------------
290350200423       GITR-0000.
290360200423           IF INVESTMENT-CODE OF WS-TEMP-TRANS-REC NOT =
290370200423                                    INVESTMENT-CODE OF INVESTMENT
290380200423             MOVE INVESTMENT-CODE OF WS-TEMP-TRANS-REC   TO
290390200423                                  INVESTMENT-CODE OF INVESTMENT
290400200423             READ INVESTMENT
290410200423                  KEY IS EXTERNALLY-DESCRIBED-KEY
290420200423             INVALID KEY
290430200423               MOVE SPACES     TO INVESTMENT-CODE OF INVESTMENT
290440200423             END-READ
290450200423           END-IF
290460200423
290470200423           IF INVESTMENT-CODE OF INVESTMENT NOT = SPACES
290480200423      * RFS11838 - Begin
290490200423      *      IF PRODUCT-TYPE-CODE OF INVESTMENT NOT =
290500200423      *                 PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
290510200423      * RFS11838 - End
290520200423               MOVE PRODUCT-TYPE-CODE OF INVESTMENT  TO
290530200423                                PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
290540200423               READ PRODUCT-TYPE-CODES
290550200423                 INVALID KEY
290560200423                   MOVE SPACES                     TO
290570200423                          PRODUCT-TYPE-CODE OF PRODUCT-TYPE-CODES
290580200423               END-READ
290590200423             END-IF.
290600200423      * RFS11838 - Begin
290610200423      *    END-IF.
290620200423      * RFS11838 - End
290630200423       GITR-EXIT.
290640200423           EXIT.
290650200423
290660200423      * RFS9530 - End
290670200423
290680200423      * RFS 10575 BEGIN
290690200423       UPDATE-ACCOUNT-RRIF-LIF SECTION.
290700200423
290710200423           IF NOT REDEMPTION-TRANSACTION
290720200423             GO TO UARL-EXIT
290730200423           END-IF.
290740200423
290750200423      * RFS11306 - Begin
290760200423           IF NOT HISTORY
290770200423               GO TO UARL-EXIT
290780200423           END-IF.
290790200423      * RFS11306 - End
290800200423      * RFS45991 - Begin
290810200423           IF WS-PROVINCIAL-TAX-AMOUNT NOT = 0 OR
290820200423              WS-FEDERAL-TAX-AMOUNT    NOT = 0
290830200423            MOVE WS-PROVINCIAL-TAX-AMOUNT TO WS-PROVINCIAL-TAX-AMOUNT-2
290840200423            MOVE WS-FEDERAL-TAX-AMOUNT    TO WS-FEDERAL-TAX-AMOUNT-2
290850200423           ELSE
290860200423            PERFORM GET-ADDL-TAX-AMT
290870200423           END-IF
290880200423      * RFS45991 - End
290890200423      * ----------------------------------------------------------
290900200423      *Determine if date comparison based on trade or process date
290910200423      * ----------------------------------------------------------
290920200423           MOVE PLACEMENT-DATE OF TRANS
290930200423                             TO PLACEMENT-DATE
290940200423                             OF TRANS-DIST-COUNTRY-CODES.
290950200423           MOVE TRANS-NO OF TRANS
290960200423                             TO TRANS-NO
290970200423                             OF TRANS-DIST-COUNTRY-CODES.
290980200423
290990200423           MOVE PASS-PROCESS-DATE-9
291000200423                             TO WS-WK-PROCESS-DATE.
291010200423           MOVE TRADE-DATE OF TRANS
291020200423                             TO WS-WK-TRADE-DATE.
291030200423
291040200423           READ TRANS-DIST-COUNTRY-CODES
291050200423           INVALID KEY
29106020042334309 *    INITIALIZE MFATRDCCP
29107020042334309x     INITIALIZE MFATRDCCP OF TRANS-DIST-COUNTRY-CODES
291080200423           END-READ.
291090200423
291100200423      *RFS162289 begins
291110200423           IF WS-EDIT-T4R2TR = 'Y' AND TAX-PERIOD-INDICATOR
291120200423              OF TRANS-DIST-COUNTRY-CODES = ' '
291130200423              MOVE 'T' TO TAX-PERIOD-INDICATOR OF
291140200423                 TRANS-DIST-COUNTRY-CODES
291150200423            END-IF
291160200423      *RFS162289 ends
291170200423           IF TAX-PERIOD-INDICATOR OF TRANS-DIST-COUNTRY-CODES
291180200423           EQUAL "T"
291190200423             IF WS-WKP-YEAR IS NOT EQUAL WS-WKT-YEAR
291200200423               GO TO UARL-EXIT
291210200423             END-IF
291220200423           END-IF.
291230200423
291240200423      * ----------------------------------------------------------
291250200423      *Determine Account type based on rule
291260200423      * ----------------------------------------------------------
291270200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
291280200423                             TO ACCOUNT-TYPE-CODE
291290200423                             OF ACCOUNT-TYPE.
291300200423
291310200423           READ ACCOUNT-TYPE
291320200423           INVALID KEY
291330200423             GO TO UARL-EXIT
291340200423           END-READ.
291350200423
291360200423           MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
291370200423                             TO WS-ACCOUNT-TYPE-CAT.
291380200423
291390200423      * ----------------------------------------------------------
291400200423      *Process RRIF
291410200423      * ----------------------------------------------------------
291420200423           IF RRIF-ACCOUNT
29143020042354661        INITIALIZE MFAACRIFP OF ACCOUNT-RRIF-REC
291440200423             MOVE ACCOUNT-NO OF TRANS
291450200423                             TO ACCOUNT-NO OF ACCOUNT-RRIF
291460200423             READ ACCOUNT-RRIF
291470200423             INVALID KEY
291480200423             GO TO UARL-EXIT
291490200423             END-READ
291500200423
291510200423      * RFS18779 - Begin
291520200423      *      IF CONTR-REDEM-CODE OF TRANS(1:3) = "IFP"
291530200423             IF WS-CURR-CONTR-REDEM-RULE-IFP
291540200423      * Rfs42278 Ends
29155020042347251 *         OR lnc_ContrRedemRuleLinkNote
291560200423      * Rfs42278 ends
291570200423
291580200423      * RFS18779 - End
291590200423               COMPUTE YTD-MINIMUM-PAID OF ACCOUNT-RRIF =
291600200423               YTD-MINIMUM-PAID OF ACCOUNT-RRIF + NET-AMT
291610200423               OF TRANS + WS-FEDERAL-TAX-AMOUNT +
291620200423               WS-PROVINCIAL-TAX-AMOUNT
291630200423      *        *RFS 16844 Begin
291640200423               COMPUTE GROSS-YTD-MINIMUM-PAID OF ACCOUNT-RRIF =
291650200423               GROSS-YTD-MINIMUM-PAID OF ACCOUNT-RRIF +
291660200423               GROSS-AMT OF TRANS
291670200423      *        *RFS 16844 End
291680210720
291690210720      *RFS186771 - Starts
291700210720             IF ((COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES NOT = "CAN"
291710210720              AND COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES NOT = SPACE)
291720210720             OR (COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES = SPACE
291730210720              AND Lc_TaxCountryCode NOT = "CAN"))
291740210720             AND PPPA-ANNUAL OF ACCOUNT-RRIF  > 0
291750210720               COMPUTE GROSS-YTD-PPPA-PAID  OF ACCOUNT-RRIF
291760210720                            =  GROSS-YTD-PPPA-PAID  OF ACCOUNT-RRIF
291770210720                            + GROSS-AMT OF TRANS
291780210720               COMPUTE NET-YTD-PPPA-PAID OF ACCOUNT-RRIF
291790210720                            =  NET-YTD-PPPA-PAID OF ACCOUNT-RRIF
291800210720                            + NET-AMT OF TRANS
291810210720               END-IF
291820210720      *RFS186771 - Ends
291830210720
291840200423             END-IF
291850200423
291860200423             COMPUTE YTD-TOTAL-PAID OF ACCOUNT-RRIF =
291870200423             YTD-TOTAL-PAID OF ACCOUNT-RRIF + NET-AMT OF TRANS
291880200423      * rfs45991 - Begin
291890200423      *     + WS-FEDERAL-TAX-AMOUNT +
291900200423      *       WS-PROVINCIAL-TAX-AMOUNT +
291910200423              + WS-FEDERAL-TAX-AMOUNT-2
291920200423              + WS-PROVINCIAL-TAX-AMOUNT-2
291930200423      * rfs45991 - End
291940200423
291950200423      * RFS 16844 Begin
291960200423             COMPUTE GROSS-YTD-TOTAL-PAID OF ACCOUNT-RRIF =
291970200423             GROSS-YTD-TOTAL-PAID OF ACCOUNT-RRIF +
291980200423             GROSS-AMT OF TRANS
291990200423      * RFS 16844 End
292000200423
292010200423             REWRITE ACCOUNT-RRIF-REC
292020200423             INVALID KEY
29203020042358714           MOVE "MFAACRIFP " TO WS-FILE-STATUS-FILE-NAME
29204020042358714           SET lncc_Err158  TO  TRUE
29205020042358714           PERFORM LOG-FILE-STATUS
292060200423               GO TO UARL-EXIT
292070200423             END-REWRITE
292080200423
29209020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
29210020042358714           MOVE "MFAACRIFP" TO WS-FILE-STATUS-FILE-NAME
29211020042358714           SET lncc_Err159  TO  TRUE
29212020042358714           PERFORM LOG-FILE-STATUS
29213020042358714        END-IF
292140200423
29215020042354661        PERFORM UPDATE-RRIF-LIF-TAX
292160200423             GO TO UARL-EXIT
292170200423
292180200423           END-IF.
292190200423
292200200423      * ----------------------------------------------------------
292210200423      *Process LIF
292220200423      * ----------------------------------------------------------
292230200423           IF LIF-ACCOUNT
29224020042354661        INITIALIZE MFAACLIFP OF ACCOUNT-LIF-REC
292250200423             MOVE ACCOUNT-NO OF TRANS
292260200423                             TO ACCOUNT-NO OF ACCOUNT-LIF
292270200423             READ ACCOUNT-LIF
292280200423             INVALID KEY
292290200423             GO TO UARL-EXIT
292300200423             END-READ
292310200423
292320200423      * RFS18779 - Begin
292330200423      *      IF CONTR-REDEM-CODE OF TRANS(1:3) = "IFP"
292340200423             IF WS-CURR-CONTR-REDEM-RULE-IFP
292350200423      * Rfs42278 Ends
29236020042347251 *         OR lnc_ContrRedemRuleLinkNote
292370200423      * Rfs42278 ends
292380200423      * RFS18779 - End
292390200423               COMPUTE YTD-MINIMUM-PAID OF ACCOUNT-LIF =
292400200423               YTD-MINIMUM-PAID OF ACCOUNT-LIF + NET-AMT
292410200423               OF TRANS + WS-FEDERAL-TAX-AMOUNT +
292420200423               WS-PROVINCIAL-TAX-AMOUNT
292430200423      *        *RFS 16844 Begin
292440200423               COMPUTE GROSS-YTD-MINIMUM-PAID OF ACCOUNT-LIF =
292450200423               GROSS-YTD-MINIMUM-PAID OF ACCOUNT-LIF +
292460200423               GROSS-AMT OF TRANS
292470200423      *        *RFS 16844 End
292480210720
292490210720      *RFS186771 - Starts
292500210720              IF ((COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES NOT = "CAN"
292510210720               AND COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES NOT = SPACE)
292520210720              OR (COUNTRY-CODE OF TRANS-DIST-COUNTRY-CODES = SPACE
292530210720               AND Lc_TaxCountryCode NOT = "CAN"))
292540210720              AND PPPA-ANNUAL OF ACCOUNT-LIF  > 0
292550210720               COMPUTE GROSS-YTD-PPPA-PAID  OF ACCOUNT-LIF
292560210720                            =  GROSS-YTD-PPPA-PAID  OF ACCOUNT-LIF
292570210720                            + GROSS-AMT OF TRANS
292580210720               COMPUTE NET-YTD-PPPA-PAID OF ACCOUNT-LIF
292590210720                            =  NET-YTD-PPPA-PAID OF ACCOUNT-LIF
292600210720                            + NET-AMT OF TRANS
292610210720               END-IF
292620210720      *RFS186771 - Ends
292630210720
292640200423             END-IF
292650200423
292660200423             COMPUTE YTD-TOTAL-PAID OF ACCOUNT-LIF =
292670200423             YTD-TOTAL-PAID OF ACCOUNT-LIF  + NET-AMT OF TRANS
292680200423      * rfs45991 - Begin
292690200423      *     + WS-FEDERAL-TAX-AMOUNT +
292700200423      *       WS-PROVINCIAL-TAX-AMOUNT +
292710200423              + WS-FEDERAL-TAX-AMOUNT-2
292720200423              + WS-PROVINCIAL-TAX-AMOUNT-2
292730200423      * rfs45991 - End
292740200423
292750200423      * RFS 16844 Begin
292760200423             COMPUTE GROSS-YTD-TOTAL-PAID OF ACCOUNT-LIF =
292770200423             GROSS-YTD-TOTAL-PAID OF ACCOUNT-LIF +
292780200423             GROSS-AMT OF TRANS
292790200423      * RFS 16844 End
292800200423
292810200423             REWRITE ACCOUNT-LIF-REC
292820200423             INVALID KEY
29283020042358714           MOVE "MFAACLIFP" TO WS-FILE-STATUS-FILE-NAME
29284020042358714           SET lncc_Err160  TO  TRUE
29285020042358714           PERFORM LOG-FILE-STATUS
292860200423               GO TO UARL-EXIT
292870200423             END-REWRITE
292880200423
29289020042358714        IF WS-FILE-STATUS IS NOT EQUAL TO "00"
29290020042358714           MOVE "MFAACLIFP" TO WS-FILE-STATUS-FILE-NAME
29291020042358714           SET lncc_Err161  TO  TRUE
29292020042358714           PERFORM LOG-FILE-STATUS
29293020042358714        END-IF
292940200423
29295020042354661        PERFORM UPDATE-RRIF-LIF-TAX
292960200423             GO TO UARL-EXIT
292970200423
292980200423           END-IF.
292990200423       UARL-EXIT.
293000200423           EXIT.
293010200423
293020200423      * RFS 10575 END
293030200423      * RFS 10040 - Begin
293040200423      * ---------------------------------
293050200423       SET-COMM-RATE SECTION.
293060200423      * ---------------------------------
293070200423       SCR-0000.
293080200423      * ---------------------------------------------------------------
293090200423               MOVE DEALER-CODE OF TRANS         TO
293100200423                           DEALER-CODE OF DEALER-COMMISSIONS
293110200423               MOVE CURRENCY-DDS OF INVESTMENT   TO
293120200423                           CURRENCY-DDS OF DEALER-COMMISSIONS
293130200423
293140200423               READ DEALER-COMMISSIONS
293150200423                       KEY IS EXTERNALLY-DESCRIBED-KEY
293160200423               INVALID KEY
293170200423                 CONTINUE
293180200423               NOT INVALID KEY
293190200423                 IF COMM-BONUS-RATE OF DEALER-COMMISSIONS > 0.0    AND
293200200423                    COMM-BONUS-SOURCE OF DEALER-COMMISSIONS =
293210200423                                                LT-BONUS-SOURCE-U
293220200423                   COMPUTE WS-COMM-RATE ROUNDED =
293230200423103858*                COMM-RATE OF TRANS-COMMISSION *
293240200423103858                 WS-COMM-RATE *
293250200423                           (1.0 + COMM-BONUS-RATE OF DEALER-COMMISSIONS
293260200423                            / 100.0)
293270200423                 END-IF
293280200423               END-READ.
293290200423       SCR-EXIT.
293300200423           EXIT.
293310200423      * RFS 10040 - End
293320200423
293330200423
293340200423      * RFS 103858 - Start
293350200423       CALL-DEPOSIT-MATURITY SECTION.
293360200423       CDM-000.
293370200423           INITIALIZE pn_depCommRetnRate
293380200423      *    MOVE FINANCER-SCHEDULE OF FINANCER-SCHED-2
293390200423           MOVE WS-FINANCER-SCHEDULE       TO pc_FinancerSchedule
293400200423           MOVE  ln_depCommYearsToMaturity TO pn_depCommYearsToMaturity
293410200423           CALL "FXDEPCOMP" using pc_FinancerSchedule,
293420200423                                  pn_depCommYearsToMaturity,
293430200423                                  pc_depCommRetnDataFlag,
293440200423                                  pn_depCommRetnRate.
293450200423       CDM-EXIT.
293460200423           EXIT.
293470200423      * RFS 103858 - End
293480200423
293490200423      * RFS10608 - Begin
293500200423      * ---------------------------------
293510200423       CREATE-TRANS-CDSC-PURCHASE SECTION.
293520200423      * ---------------------------------
293530200423       CTCP-0000.
293540200423      * RFS38704 - Begin: moved code to the beginning of the section
293550200423           SET SW-TEMP-OK         TO TRUE
293560200423      * RFS38704 - End
293570200423
293580200423           IF  WS-PASS-SWITCH-EDIT IS EQUAL "1"
293590200423             GO TO CTCP-EXIT
293600200423           END-IF.
293610200423
293620200423      * RFS21772 - Begin
293630200423           IF SW-CALC-NO-UPDATES
293640200423      * RFS32409 - Start
293650200423            OR lnc_calcSoa
293660200423      * RFS32409 - End
293670200423             GO TO CTCP-EXIT
293680200423           END-IF
293690200423      * RFS21772 - End
293700200423
293710200423      * RFS38704 - Begin: moved code to the beginning of the section
293720200423      *    SET SW-TEMP-OK         TO TRUE
293730200423      * RFS38704 - End
293740200423           INITIALIZE MFATRNCPP OF TRANS-CDSC-PUR-PRIMARY-REC
293750200423      *
293760200423           MOVE WS-PLACEMENT-DATE
293770200423                             TO PLACEMENT-DATE
293780200423                             OF TRANS-CDSC-PUR-PRIMARY
293790200423           MOVE WS-TRANS-NO  TO TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
293800200423           MOVE ZEROES       TO CDSC-SEQ-NO OF TRANS-CDSC-PUR-PRIMARY
293810200423           MOVE WS-FINANCER-CODE
293820200423                             TO FINANCER-CODE OF TRANS-CDSC-PUR-PRIMARY
293830200423           MOVE WS-FINANCER-SCHEDULE
293840200423                             TO FINANCER-SCHEDULE
293850200423                             OF TRANS-CDSC-PUR-PRIMARY
293860200423           MOVE WS-CDSC-SCHEDULE
293870200423                             TO CDSC-SCHEDULE OF TRANS-CDSC-PUR-PRIMARY
293880200423           MOVE WS-ACCOUNT-NO
293890200423                             TO ACCOUNT-NO OF TRANS-CDSC-PUR-PRIMARY
293900200423           MOVE WS-INVESTMENT-CODE
293910200423                             TO INVESTMENT-CODE
293920200423                             OF TRANS-CDSC-PUR-PRIMARY
293930200423           MOVE WS-DEALER-CODE
293940200423                             TO DEALER-CODE OF TRANS-CDSC-PUR-PRIMARY
293950200423      *
293960200423      *    RFS71433 -Begin
293970200423             Perform UpdTransPurFreeUnits
293980200423      *    RFS71433 -End
293990200423127385     If Account-lev-dsc
294000201223      *RFS180707 - Starts
294010201223              And lnc_ACINDSCNo
294020201223      *RFS180707 - Ends
294030200423   |          And Years-for-gain of Financer-cdsc-instructions > 0
294040200423   |          And External-load-type-code
294050200423   |                of Investment-misc-detail-rec = "NL"
294060200423   |          And ln_accountTypePercentFree = 0
294070200423   |          And BUY-Transaction
294080200423   |          Go To Ctcp-exit
294090200423127385     End-if.
294100200423
294110200423           WRITE TRANS-CDSC-PUR-PRIMARY-REC
294120200423           INVALID KEY
294130200423             SET SW-TEMP-FAIL        TO TRUE
294140200423             INITIALIZE MFATRNCPP OF TRANS-CDSC-PUR-PRIMARY-REC
294150200423           NOT INVALID KEY
294160200423             MOVE WS-PLACEMENT-DATE
294170200423                             TO PLACEMENT-DATE
294180200423                             OF TRANS-CDSC-PUR-PRIMARY
294190200423             MOVE WS-TRANS-NO
294200200423                             TO TRANS-NO OF TRANS-CDSC-PUR-PRIMARY
294210200423             MOVE ZEROES
294220200423                             TO CDSC-SEQ-NO OF TRANS-CDSC-PUR-PRIMARY
294230200423             READ TRANS-CDSC-PUR-PRIMARY
294240200423             WITH NO LOCK
294250200423             INVALID KEY
294260200423               SET SW-TEMP-FAIL
294270200423                             TO TRUE
294280200423               INITIALIZE MFATRNCPP OF TRANS-CDSC-PUR-PRIMARY-REC
294290200423             END-READ
294300200423           END-WRITE.
294310200423
29432020042358714      IF WS-FILE-STATUS IS NOT EQUAL TO "00"
29433020042358714         MOVE "MFATRNCPP" TO WS-FILE-STATUS-FILE-NAME
29434020042358714         SET lncc_Err162  TO  TRUE
29435020042358714         PERFORM LOG-FILE-STATUS
29436020042358714      END-IF.
294370200423
294380200423       CTCP-EXIT.
294390200423            EXIT.
294400200423
294410200423      * ----------------------------------
294420200423       GET-CDSC-ORIGINAL-DETAILS SECTION.
294430200423      * ----------------------------------
294440200423       GCOD-0000.
294450200423127450     INITIALIZE WS-PURCHASE-DETAIL.
294460200423           INITIALIZE MFATNCODP OF TRANS-CDSC-ORIGINAL-DETAILS
294470200423      *
294480200423           MOVE WS-TRANS-NO               TO
294490200423                          TRANS-NO       OF TRANS-CDSC-ORIGINAL-DETAILS
294500200423           MOVE WS-PLACEMENT-DATE         TO
294510200423                          PLACEMENT-DATE OF TRANS-CDSC-ORIGINAL-DETAILS
294520200423
294530200423           READ TRANS-CDSC-ORIGINAL-DETAILS
294540200423           KEY IS EXTERNALLY-DESCRIBED-KEY
294550200423             INVALID KEY
294560200423               INITIALIZE MFATNCODP OF TRANS-CDSC-ORIGINAL-DETAILS
294570200423             NOT INVALID KEY
294580200423               MOVE LT-Y       TO WS-PURCHASE-DETAIL
294590200423           END-READ.
294600200423
294610200423       GCOD-EXIT.
294620200423            EXIT.
294630200423      * RFS10608 - End
294640200423
294650200423      * RFS 7721  BEGIN
294660200423       ALLOWABLE-SWITCHES-LIMIT  SECTION.
294670200423
294680200423       ASL-0000.
294690200423
294700200423           IF  WS-PASS-SWITCH-EDIT = "2"
294710200423      * RFS13383 - Begin
294720200423            AND SW-N-TWO-PASSES
294730200423      * RFS13383 - End
294740200423             IF WS-ASL-REDF NOT EQUAL 0
294750200423               COMPUTE WS-REDEMPTION-FEE = WS-REDEMPTION-FEE
294760200423                                         + WS-ASL-REDF
294770200423             END-IF
294780200423      * RFS13383 - Begin
294790200423      *      GO TO ASL-EXIT
294800200423             GO TO ASL-EXIT-0
294810200423      * RFS13383 - End
294820200423           END-IF.
294830200423
294840200423           MOVE 0 TO WS-ASL-REDF.
294850200423           MOVE SPACES TO WS-ASL-FLAG.
294860200423           INITIALIZE MFAALSWLP OF ALLOWABLE-SWO-LIMIT-CODES-REC.
294870200423           INITIALIZE MFAACISCP OF ACCOUNT-INV-SWITCH-COUNTER-REC.
294880200423           INITIALIZE MFAAISCTP OF ACCNT-INV-SWO-CNTER-TRANS-REC.
294890200423           INITIALIZE MFAACISCP
294900200423                      OF ACCT-INV-SWO-CNTER-HIGHEST-REC
294910200423
294920200423           MOVE INVESTMENT-CODE     OF TRANS
294930200423                TO INVESTMENT-CODE  OF INVESTMENT-STRUCTURE-XREF.
294940200423           MOVE SPACES TO INVESTMENT-STRUCTURE-CODE
294950200423                          OF INVESTMENT-STRUCTURE-XREF.
294960200423
294970200423           START INVESTMENT-STRUCTURE-XREF
294980200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
294990200423             INVALID KEY
295000200423             GO TO ASL-EXIT.
295010200423
295020200423           MOVE TRADE-DATE OF TRANS TO WS-ASL-TRADE-DATE.
295030200423
295040200423           SET ASLIDX TO 1.
295050200423
295060200423           SEARCH WS-ASL-ARRAY VARYING ASLIDX
295070200423           AT END
295080200423             GO TO ASL-0010
295090200423           WHEN WS-ASL-ARR-INV-CODE(ASLIDX) = SPACES
295100200423             GO TO ASL-0010
295110200423           WHEN (    (  WS-ASL-ARR-INV-CODE(ASLIDX)
295120200423                      = INVESTMENT-CODE OF TRANS)
295130200423                 AND (  WS-ASL-ARR-YEAR(ASLIDX)
295140200423                      = WS-ASL-YEAR))
295150200423             MOVE WS-ASL-ARR-INV-STR-CODE(ASLIDX)
295160200423               TO WS-ASL-INVESTMENT-STR
295170200423             MOVE WS-ASL-ARR-CODE(ASLIDX) TO WS-ASL-CODE
295180200423             GO TO ASL-0020
295190200423           END-SEARCH.
295200200423
295210200423       ASL-0010.
295220200423           READ INVESTMENT-STRUCTURE-XREF NEXT RECORD
295230200423             AT END GO TO ASL-EXIT.
295240200423
295250200423           IF   INVESTMENT-CODE     OF TRANS NOT EQUAL
295260200423                INVESTMENT-CODE  OF INVESTMENT-STRUCTURE-XREF
295270200423             GO TO ASL-EXIT
295280200423           END-IF.
295290200423
295300200423           MOVE INVESTMENT-STRUCTURE-CODE OF INVESTMENT-STRUCTURE-XREF
295310200423                TO INVESTMENT-STRUCTURE-CODE
295320200423                                    OF INVESTMENT-STR-ALLW-SWO-LIMIT.
295330200423           READ INVESTMENT-STR-ALLW-SWO-LIMIT
295340200423             INVALID KEY
295350200423               GO TO ASL-0010
295360200423           END-READ.
295370200423
295380200423           IF WS-ASL-ARR-INV-CODE(ASLIDX) = SPACES
295390200423      * RFS49699 - Array logging logic
295400200423             IF ASLIDX           > WS-ARRAY13-MAX-USED
295410200423                 MOVE ASLIDX                 TO WS-ARRAY13-MAX-USED
295420200423             END-IF
295430200423      * RFS49699 - End
295440200423             MOVE INVESTMENT-CODE OF TRANS
295450200423               TO WS-ASL-ARR-INV-CODE(ASLIDX)
295460200423             MOVE INVESTMENT-STRUCTURE-CODE
295470200423                  OF INVESTMENT-STR-ALLW-SWO-LIMIT
295480200423               TO WS-ASL-ARR-INV-STR-CODE(ASLIDX)
295490200423             MOVE ALLOWABLE-SWO-LIMIT-CODE
295500200423                  OF INVESTMENT-STR-ALLW-SWO-LIMIT
295510200423               TO WS-ASL-ARR-CODE(ASLIDX)
295520200423             MOVE WS-ASL-YEAR  TO WS-ASL-ARR-YEAR(ASLIDX)
295530200423           END-IF.
295540200423
295550200423           MOVE INVESTMENT-STRUCTURE-CODE
295560200423                OF INVESTMENT-STR-ALLW-SWO-LIMIT
295570200423             TO WS-ASL-INVESTMENT-STR.
295580200423           MOVE ALLOWABLE-SWO-LIMIT-CODE
295590200423                OF INVESTMENT-STR-ALLW-SWO-LIMIT
295600200423             TO WS-ASL-CODE.
295610200423
295620200423       ASL-0020.
295630200423
295640200423           MOVE ACCOUNT-NO          OF TRANS
295650200423             TO ACCOUNT-NO       OF ACCOUNT-INV-SWITCH-COUNTER.
295660200423           MOVE WS-ASL-INVESTMENT-STR
295670200423             TO INVESTMENT-STRUCTURE-CODE
295680200423                                    OF ACCOUNT-INV-SWITCH-COUNTER.
295690200423           MOVE TRADE-DATE          OF TRANS
295700200423             TO TRADE-DATE       OF ACCOUNT-INV-SWITCH-COUNTER.
295710200423           READ ACCOUNT-INV-SWITCH-COUNTER
295720200423             NOT INVALID KEY
295730200423               ADD 1 TO NO-OF-TRADES OF ACCOUNT-INV-SWITCH-COUNTER
295740200423               MOVE 'R' TO WS-ASL-FLAG
295750200423               GO TO ASL-EXIT
295760200423           END-READ.
295770200423
295780200423           MOVE WS-ASL-CODE TO ALLOWABLE-SWO-LIMIT-CODE
295790200423                                    OF ALLOWABLE-SWO-LIMIT-CODES.
295800200423           MOVE WS-ASL-YEAR TO YEAR OF ALLOWABLE-SWO-LIMIT-CODES.
295810200423
295820200423           READ ALLOWABLE-SWO-LIMIT-CODES
295830200423             INVALID KEY
295840200423             GO TO ASL-EXIT
295850200423           END-READ.
295860200423
295870200423           MOVE ACCOUNT-NO          OF TRANS
295880200423             TO ACCOUNT-NO       OF ACCT-INV-SWO-CNTER-HIGHEST.
295890200423           MOVE WS-ASL-INVESTMENT-STR
295900200423             TO INVESTMENT-STRUCTURE-CODE
295910200423                OF ACCT-INV-SWO-CNTER-HIGHEST.
295920200423           MOVE WS-ASL-YEAR TO YEAR OF ACCT-INV-SWO-CNTER-HIGHEST.
295930200423           MOVE 999         TO NO-OF-SWITCHES
295940200423                                    OF ACCT-INV-SWO-CNTER-HIGHEST.
295950200423
295960200423           START ACCT-INV-SWO-CNTER-HIGHEST
295970200423             KEY IS GREATER  THAN EXTERNALLY-DESCRIBED-KEY
295980200423             INVALID KEY
295990200423               READ ACCT-INV-SWO-CNTER-HIGHEST LAST  RECORD
296000200423                 INVALID KEY
296010200423                   MOVE 0 TO NO-OF-SWITCHES
296020200423                             OF ACCT-INV-SWO-CNTER-HIGHEST
296030200423               END-READ
296040200423             NOT INVALID KEY
296050200423               READ ACCT-INV-SWO-CNTER-HIGHEST PRIOR RECORD
296060200423                 AT END
296070200423                   MOVE 0 TO NO-OF-SWITCHES
296080200423                             OF ACCT-INV-SWO-CNTER-HIGHEST
296090200423               END-READ
296100200423           END-START.
296110200423
296120200423           MOVE TRADE-DATE OF ACCT-INV-SWO-CNTER-HIGHEST
296130200423             TO WS-ASL-TRADE-DATE-H.
296140200423
296150200423           IF  NO-OF-SWITCHES-ALLOWED
296160200423                     OF ALLOWABLE-SWO-LIMIT-CODES >
296170200423               NO-OF-SWITCHES OF ACCT-INV-SWO-CNTER-HIGHEST
296180200423           AND ACCOUNT-NO OF TRANS         EQUAL
296190200423                   ACCOUNT-NO OF ACCT-INV-SWO-CNTER-HIGHEST
296200200423           AND WS-ASL-INVESTMENT-STR       EQUAL
296210200423                   INVESTMENT-STRUCTURE-CODE
296220200423                     OF ACCT-INV-SWO-CNTER-HIGHEST
296230200423           AND WS-ASL-YEAR-H               EQUAL WS-ASL-YEAR
296240200423              MOVE ACCOUNT-NO          OF TRANS
296250200423                TO ACCOUNT-NO       OF ACCOUNT-INV-SWITCH-COUNTER
296260200423              MOVE WS-ASL-INVESTMENT-STR
296270200423                TO INVESTMENT-STRUCTURE-CODE
296280200423                   OF ACCOUNT-INV-SWITCH-COUNTER
296290200423              MOVE TRADE-DATE          OF TRANS
296300200423                TO TRADE-DATE       OF ACCOUNT-INV-SWITCH-COUNTER
296310200423              MOVE WS-ASL-YEAR
296320200423                TO YEAR             OF ACCOUNT-INV-SWITCH-COUNTER
296330200423              MOVE 1 TO NO-OF-TRADES OF ACCOUNT-INV-SWITCH-COUNTER
296340200423              COMPUTE NO-OF-SWITCHES OF ACCOUNT-INV-SWITCH-COUNTER
296350200423                    = NO-OF-SWITCHES OF ACCT-INV-SWO-CNTER-HIGHEST
296360200423                    + 1
296370200423              MOVE 'W' TO WS-ASL-FLAG
296380200423           ELSE IF ACCOUNT-NO OF TRANS                     NOT EQUAL
296390200423                   ACCOUNT-NO OF ACCT-INV-SWO-CNTER-HIGHEST
296400200423                OR WS-ASL-INVESTMENT-STR                   NOT EQUAL
296410200423                   INVESTMENT-STRUCTURE-CODE
296420200423                     OF ACCT-INV-SWO-CNTER-HIGHEST
296430200423                OR WS-ASL-YEAR-H                           NOT EQUAL
296440200423                   WS-ASL-YEAR
296450200423              MOVE ACCOUNT-NO          OF TRANS
296460200423                TO ACCOUNT-NO       OF ACCOUNT-INV-SWITCH-COUNTER
296470200423              MOVE WS-ASL-INVESTMENT-STR
296480200423                TO INVESTMENT-STRUCTURE-CODE
296490200423                   OF ACCOUNT-INV-SWITCH-COUNTER
296500200423              MOVE TRADE-DATE          OF TRANS
296510200423                TO TRADE-DATE       OF ACCOUNT-INV-SWITCH-COUNTER
296520200423              MOVE WS-ASL-YEAR
296530200423                TO YEAR             OF ACCOUNT-INV-SWITCH-COUNTER
296540200423              MOVE 1 TO NO-OF-TRADES OF ACCOUNT-INV-SWITCH-COUNTER
296550200423              MOVE 1 TO NO-OF-SWITCHES
296560200423                        OF ACCOUNT-INV-SWITCH-COUNTER
296570200423              MOVE 'W' TO WS-ASL-FLAG
296580200423           ELSE
296590200423              MOVE 'C' TO WS-ASL-FLAG
296600200423              IF SPLIT-OPTION-CODE OF ALLOWABLE-SWO-LIMIT-CODES = "%"
296610200423                COMPUTE WS-ASL-REDF
296620200423                      = GROSS-AMT OF TRANS
296630200423                      * CHARGE OF ALLOWABLE-SWO-LIMIT-CODES
296640200423                      / 100
296650200423                MOVE CHARGE OF ALLOWABLE-SWO-LIMIT-CODES
296660200423                  TO WS-ASL-REDF-RATE
296670200423              ELSE
296680200423                MOVE CHARGE OF ALLOWABLE-SWO-LIMIT-CODES
296690200423                  TO WS-ASL-REDF
296700200423                MOVE 0 TO WS-ASL-REDF-RATE
296710200423              END-IF
296720200423              COMPUTE WS-REDEMPTION-FEE = WS-REDEMPTION-FEE
296730200423                                        + WS-ASL-REDF
296740200423           END-IF.
296750200423
296760200423       ASL-EXIT.
296770200423           IF (WS-ASL-FLAG IS EQUAL "W" OR WS-ASL-FLAG IS EQUAL "R")
296780200423      * RFS13383 - Begin
296790200423      *    AND WS-PASS-SWITCH-EDIT IS EQUAL "1"
296800200423      * RFS13383 - End
296810200423             MOVE ACCOUNT-NO           OF ACCOUNT-INV-SWITCH-COUNTER
296820200423               TO ACCOUNT-NO           OF ACCOUNT-INV-SWO-COUNTER-TRANS
296830200423             MOVE INVESTMENT-STRUCTURE-CODE
296840200423                                       OF ACCOUNT-INV-SWITCH-COUNTER
296850200423               TO INVESTMENT-STRUCTURE-CODE
296860200423                                       OF ACCOUNT-INV-SWO-COUNTER-TRANS
296870200423             MOVE TRADE-DATE           OF ACCOUNT-INV-SWITCH-COUNTER
296880200423               TO TRADE-DATE           OF ACCOUNT-INV-SWO-COUNTER-TRANS
296890200423             MOVE PLACEMENT-DATE       OF TRANS
296900200423               TO PLACEMENT-DATE       OF ACCOUNT-INV-SWO-COUNTER-TRANS
296910200423             MOVE TRANS-NO             OF TRANS
296920200423               TO TRANS-NO             OF ACCOUNT-INV-SWO-COUNTER-TRANS
296930200423             MOVE NO-OF-SWITCHES-ALLOWED
296940200423                                       OF ALLOWABLE-SWO-LIMIT-CODES
296950200423               TO NO-OF-SWITCHES-ALLOWED
296960200423                                       OF ACCOUNT-INV-SWO-COUNTER-TRANS
296970200423             MOVE SPLIT-OPTION-CODE    OF ALLOWABLE-SWO-LIMIT-CODES
296980200423               TO SPLIT-OPTION-CODE    OF ACCOUNT-INV-SWO-COUNTER-TRANS
296990200423             MOVE CHARGE               OF ALLOWABLE-SWO-LIMIT-CODES
297000200423               TO CHARGE               OF ACCOUNT-INV-SWO-COUNTER-TRANS
297010200423           END-IF.
297020200423
297030200423      * RFS13383 - Begin
297040200423       ASL-EXIT-0.
297050200423      * RFS13383 - End
297060200423
297070200423           EXIT.
297080200423      * RFS 7721  END
297090200423
297100200423      * RFS11194 - Begin
297110200423      * ---------------------------------
297120200423       GET-GIC-INT-ADJUST-REASON-DET SECTION.
297130200423      * ---------------------------------
297140200423       GGIAR-0000.
297150200423           INITIALIZE WS-TEMP-AMT
297160200423                      MFAGIARDP OF GIC-INT-ADJUST-REASON-DETAILS
297170200423           SET SW01-STS-OK         TO TRUE                              RFS8371
297180200423      *
297190200423           MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS    TO
297200200423                    CERTIFICATE-ID-NO OF GIC-INT-ADJUST-REASON-DETAILS
297210200423           INITIALIZE EFFECTIV-DATE   OF GIC-INT-ADJUST-REASON-DETAILS
297220200423                      INT-ADJUSTMENT-REASON-CODE
297230200423                                      OF GIC-INT-ADJUST-REASON-DETAILS
297240200423           START GIC-INT-ADJUST-REASON-DETAILS
297250200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
297260200423               INVALID KEY
297270200423                 CONTINUE
297280200423               NOT INVALID KEY
297290200423                 PERFORM GET-GIC-INT-ADJUST-NEXT UNTIL                  RFS8371
297300200423                                                 SW01-STS-END           RFS8371
297310200423           END-START.
297320200423       GGIAR-EXIT.
297330200423           EXIT.
297340200423      * ---------------------------------
297350200423       GET-GIC-INT-ADJUST-NEXT SECTION.                                 RFS8371
297360200423      * ---------------------------------
297370200423       GGIAN-0000.                                                      RFS8371
297380200423           READ GIC-INT-ADJUST-REASON-DETAILS NEXT RECORD
297390200423           AT END
297400200423             SET SW01-STS-END        TO TRUE
297410200423           NOT AT END
297420200423            IF CERTIFICATE-ID-NO OF GIC-INT-ADJUST-REASON-DETAILS NOT =
297430200423                         CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS
297440200423              SET SW01-STS-END       TO TRUE
297450200423            ELSE
297460200423              IF PLACEMENT-DATE OF GIC-INT-ADJUST-REASON-DETAILS = 0
297470200423                  COMPUTE WS-TEMP-AMT = WS-TEMP-AMT +
297480200423                     ADJUSTMENT-AMOUNT OF GIC-INT-ADJUST-REASON-DETAILS
297490200423              END-IF
297500200423            END-IF
297510200423           END-READ.
297520200423
297530200423       GGIAN-EXIT.                                                      RFS8371
297540200423           EXIT.
297550200423      * RFS11194 - End
297560200423
297570200423      * RFS 12261 BEGIN
297580200423      * ------------------------------
297590200423       GET-NON-RESIDENT-TRANS SECTION.
297600200423      * ------------------------------
297610200423       GNRT-0000.
297620200423           MOVE CERTIFICATE-ID-NO OF GIC-CERTIFICATE-DETAILS   TO
297630200423                                           PASS-CERTIFICATE-ID-NO
297640200423           SET  PASS-TRANS-TYPE-INT  TO TRUE
297650200423           CALL "FXCERTTX" USING COMM-CPCERTTX
297660200423           MOVE RETN-GROSS-AMT       TO WS-ALL-NR-INTEREST.
297670200423      * RFS21772 - Begin
297680200423      * Add Gross Amount (which is future interest) to WS-ALL-NR-INT
297690200423           IF SW-CALC-NO-UPDATES
297700200423R30095*    OR (PASS-CDSC-CALCULATOR  = "Q"  AND
297710200423R32519     OR ((PASS-CDSC-CALCULATOR = "Q"  OR "U") AND
297720200423R30095         WS-INTEREST-GENERATED = "2"  AND
297730200423R30095         GIC-INVESTMENT)
297740200423             COMPUTE WS-ALL-NR-INTEREST = WS-ALL-NR-INTEREST +
297750200423                     GROSS-AMT OF TRANS
297760200423           END-IF.
297770200423      * RFS21772 - End
297780200423       GNRT-EXIT.
297790200423           EXIT.
297800200423      * RFS 12261 END
297810200423
297820200423      * RFS17813 - Begin
297830200423      * ---------------------------------
297840200423       GET-BASE-CURRENCY SECTION.
297850200423      * ---------------------------------
297860200423           INITIALIZE COMM-CPBASCUR-PARMS
297870200423           SET COMM-ACT-GET-BAS-CURRENCY TO TRUE
297880200423           CALL "FXBASCUR" USING COMM-CPBASCUR-PARAMETERS
297890200423           IF RETN-OK OF COMM-CPBASCUR-PARAMETERS
297900200423             MOVE RETN-CURRENCY OF COMM-CPBASCUR-PARAMETERS    TO
297910200423                                WS-BASE-CURRENCY
297920200423           ELSE
297930200423             MOVE "CAD"      TO WS-BASE-CURRENCY
297940200423           END-IF.
297950200423      * RFS17813 - End
297960200423
297970200423      * RFS18568 - Begin
297980200423      * ---------------------------------
297990200423       CASH-DIST-PAYMENT-METHOD SECTION.
298000200423      * ---------------------------------
298010200423      * This routine is used when interest transactions are generated
298020200423      * on all unit redemptions which have distr. option of cash. The
298030200423      * accrued interest is distributed based on payment method set at
298040200423      * the account investment. If Payment-Type-Codes table not found
298050200423      * or accrual-amount is less than minimum-cash-dist-amt, then
298060200423      * skip this process and default to reinvest.
298070200423
298080200423       CDPM-0000.
298090200423           INITIALIZE MFAINVDDP OF INVESTMENT-DISTRIB-DETAILS-REC.
298100200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
298110200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-DETAILS-REC.
298120200423           READ INVESTMENT-DISTRIB-DETAILS
298130200423            INVALID KEY
298140200423                INITIALIZE MFAINVDDP OF INVESTMENT-DISTRIB-DETAILS-REC
298150200423                DISPLAY "@@@ NO INVESTMENT-DISTRIB-DETAILS RECORD"
298160200423           END-READ.
298170200423
298180200423           IF ACCRUAL-AMT
298190200423              OF ACCOUNT-INV-ACCRUALS IS LESS THAN
298200200423                                      MINIMUM-CASH-DIST-AMT
298210200423                                      OF INVESTMENT-DISTRIB-DETAILS-REC
298220200423              GO TO CDPM-EXIT
298230200423           END-IF.
298240200423
298250200423       CDPM-0005.
298260200423           INITIALIZE MFAPMTTYP OF PAYMENT-TYPE-CODES-REC.
298270200423           MOVE PAYMENT-TYPE-CODE OF ACCOUNT-INVESTMENT
298280200423             TO PAYMENT-TYPE-CODE OF PAYMENT-TYPE-CODES-REC.
298290200423           READ PAYMENT-TYPE-CODES
298300200423             INVALID KEY
298310200423               INITIALIZE MFAPMTTYP OF PAYMENT-TYPE-CODES-REC
298320200423               DISPLAY "@@@ ERROR NO PAYMENT-TYPES-CODES RECORD"
298330200423               GO TO CDPM-EXIT
298340200423           END-READ.
298350200423
298360200423       CDPM-SET-DIST-AND-PAYMENT.
298370200423           MOVE  INCOME-DISTR-OPTION  OF ACCOUNT-INVESTMENT
298380200423             TO  DISTR-OPTION-CODE    OF WS-TRANS-INTEREST-DETAILS.
298390200423           MOVE  PAYMENT-TYPE-CODE    OF ACCOUNT-INVESTMENT
298400200423             TO  PAYMENT-TYPE-CODE    OF WS-INTEREST-TRANS.
298410200423
298420200423           EVALUATE  PAYMENT-TYPE-RULE OF PAYMENT-TYPE-CODES-REC
298430200423              WHEN "C"
298440200423                   GO TO CDPM-CHEQUE
298450200423              WHEN "E"
298460200423                   GO TO CDPM-EFT
298470200423              WHEN OTHER
298480200423                   GO TO CDPM-EXIT
298490200423           END-EVALUATE.
298500200423
298510200423
298520200423       CDPM-CHEQUE.
298530200423           MOVE ACCOUNT-NO      OF ACCOUNT-INVESTMENT
298540200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-CHEQUE-REC.
298550200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
298560200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-CHEQUE-REC.
298570200423           READ INVESTMENT-DISTRIB-CHEQUE
298580200423             INVALID KEY
298590200423                DISPLAY "@@@ NO INVESTMENT-DISTRIB-CHEQUE RECORD"
298600200423                INITIALIZE MFADISCQP OF INVESTMENT-DISTRIB-CHEQUE-REC
298610200423                GO TO CDPM-EXIT
298620200423           END-READ.
298630200423
298640200423           INITIALIZE MFATRNCP   OF TRANS-PAY-TO-CHEQUE-REC.
298650200423           MOVE  PLACEMENT-DATE  OF WS-TRANS-INTEREST-DETAILS
298660200423             TO  PLACEMENT-DATE  OF TRANS-PAY-TO-CHEQUE-REC.
298670200423           MOVE  TRANS-NO        OF WS-TRANS-INTEREST-DETAILS
298680200423             TO  TRANS-NO        OF TRANS-PAY-TO-CHEQUE-REC.
298690200423           MOVE  PAYEE-NAME      OF INVESTMENT-DISTRIB-CHEQUE-REC
298700200423             TO  PAYEE-NAME      OF TRANS-PAY-TO-CHEQUE-REC.
298710200423           MOVE  PAYEE-NAME2     OF INVESTMENT-DISTRIB-CHEQUE-REC
298720200423             TO  PAYEE-NAME2     OF TRANS-PAY-TO-CHEQUE-REC.
298730200423           MOVE  ADDR-NO         OF INVESTMENT-DISTRIB-CHEQUE-REC
298740200423             TO  ADDR-NO         OF TRANS-PAY-TO-CHEQUE-REC.
298750200423           MOVE  "W"             TO WRITE-TRANS-PAY-TO-CHEQUE.
298760200423
298770200423           GO TO CDPM-EXIT.
298780200423
298790200423
298800200423       CDPM-EFT.
298810200423           MOVE ACCOUNT-NO      OF ACCOUNT-INVESTMENT
298820200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-EFT-REC.
298830200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
298840200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-EFT-REC.
298850200423           READ INVESTMENT-DISTRIB-EFT
298860200423             INVALID KEY
298870200423                DISPLAY "@@@ NO INVESTMENT-DISTRIB-EFT RECORD"
298880200423                INITIALIZE MFADISEFP OF INVESTMENT-DISTRIB-EFT-REC
298890200423                GO TO CDPM-EXIT
298900200423           END-READ.
298910200423
298920200423           INITIALIZE MFATRNBP  OF TRANS-PAY-TO-BANK-2-REC.
298930200423           MOVE  PLACEMENT-DATE OF WS-TRANS-INTEREST-DETAILS
298940200423             TO  PLACEMENT-DATE OF TRANS-PAY-TO-BANK-2-REC.
298950200423           MOVE  TRANS-NO       OF WS-TRANS-INTEREST-DETAILS
298960200423             TO  TRANS-NO       OF TRANS-PAY-TO-BANK-2-REC.
298970200423           MOVE  BANK-SEQ-NO    OF INVESTMENT-DISTRIB-EFT-REC
298980200423             TO  BANK-SEQ-NO    OF TRANS-PAY-TO-BANK-2-REC.
298990200423           MOVE  "W"            TO WRITE-TRANS-PAY-TO-BANK-2.
299000200423
299010200423       CDPM-EXIT.
299020200423            EXIT.
299030200423      * RFS18568 - End
299040200423
299050200423      * RFS5512 - Begin
299060200423      * ---------------------------------
299070200423       SET-REMAINING-BAL-FLAG SECTION.
299080200423      * ---------------------------------
299090200423      * Identify if Remaining Balance need to be Checked and
299100200423      * Set/Reset values for one or two passes
299110200423      * There is special check for LT-SPLIT-DOLLARS which come from
299120200423      * JOBWEBMMO job.
299130200423
299140200423           IF WS-REMAINING-BAL-THRESHOLD > ZERO                 AND
299150200423              NOT SETTLED                                       AND
299160200423              WIRE-ORDER-NO OF TRANS NOT = ZEROES AND SPACES    AND
299170200423              ((SPLIT-OPTION-CODE OF TRANS = LT-SPLIT-UNITS)  OR
299180200423               (SPLIT-OPTION-CODE OF TRANS = LT-SPLIT-DOLLARS   AND
299190200423                TRANS-TYPE-CODE OF TRANS   = LT-SEL             AND
299200200423                TRANS-STATUS-CODE OF TRANS = LT-PND             AND
299210200423                WIRE-ORDER-FLAG   OF TRANS = LT-N) )
299220200423             PERFORM GET-ORDER-ENTRY-LOG-IN
299230200423             IF RETN-SPLIT-OPTION-CODE OF COMM-CPOELOGSP = LT-PERCENT
299240200423               SET SW-CHECK-REMAINING-BAL     TO TRUE
299250200423             END-IF
299260200423           END-IF
299270200423
299280200423           IF SW-CHECK-REMAINING-BAL
299290200423             MOVE "1"               TO WS-PASS-SWITCH-EDIT
299300200423             SET SW-N-TWO-PASSES    TO TRUE
299310200423           END-IF.
299320200423       SRBF-EXIT.
299330200423            EXIT.
299340200423      * RFS50058 - Begin: get order entry unit amount
299350200423      * ---------------------------------
299360200423       GET-ORDER-ENTRY-MAIN    SECTION.
299370200423      * ---------------------------------
299380200423      * Get Order entry log for redemptions
299390200423           INITIALIZE ln_logUnitAmt
299400200423           IF WIRE-ORDER-NO     OF TRANS NOT = ZEROES AND SPACES AND
299410200423              SPLIT-OPTION-CODE OF TRANS = LT-SPLIT-DOLLARS      AND
299420200423              TRANS-TYPE-CODE   OF TRANS = LT-SEL                AND
299430200423              NOT SETTLED                                        AND
299440200423              WIRE-ORDER-FLAG   OF TRANS = LT-N
299450200423             PERFORM GET-ORDER-ENTRY-LOG-IN
299460200423             IF RETN-SPLIT-OPTION-CODE OF COMM-CPOELOGSP =
299470200423                                          lt-split-units
299480200423               COMPUTE ln_logUnitAmt ROUNDED = RETN-AMOUNT-13
299490200423             END-IF
299500200423           END-IF.
299510200423       GOEM-EXIT.
299520200423            EXIT.
299530200423      * ---------------------------------
299540200423       GET-ORDER-ENTRY-LOG-IN SECTION.
299550200423      * ---------------------------------
299560200423            MOVE PLACEMENT-DATE OF TRANS         TO
299570200423                            PASS-PLACEMENT-DATE  OF COMM-CPOELOGSP
299580200423            MOVE TRANS-NO       OF TRANS         TO
299590200423                            PASS-TRANS-NO        OF COMM-CPOELOGSP
299600200423            MOVE LT-PROGRAM-CODE-OETRANS22       TO
299610200423                            PASS-PROGRAM-CODE OF COMM-CPOELOGSP
299620200423            MOVE INVESTMENT-CODE OF TRANS        TO
299630200423                            PASS-INVESTMENT-CODE OF COMM-CPOELOGSP
299640200423            CALL "FXOELOGSP" USING COMM-CPOELOGSP.
299650200423       GOELI-EXIT.
299660200423            EXIT.
299670200423      * ---------------------------------
299680200423       SET-SPLIT-OPTION-TO-ALL SECTION.
299690200423      * ---------------------------------
299700200423           MOVE LT-A  TO SPLIT-OPTION-CODE OF TRANS
299710200423                         TRANS-SPLIT-OPTION-CATAGORY.
299720200423       SSOTA-EXIT.
299730200423           EXIT.
299740200423      * ---------------------------------
299750200423       RE-GET-TRANS-PRIMARY SECTION.
299760200423      * ---------------------------------
299770200423           MOVE PLACEMENT-DATE OF TRANS  TO
299780200423                                       PLACEMENT-DATE OF TRANS-PRIMARY
299790200423           MOVE TRANS-NO OF TRANS        TO TRANS-NO OF TRANS-PRIMARY
299800200423           READ TRANS-PRIMARY WITH NO LOCK
299810200423           INVALID KEY
299820200423             MOVE "50"                   TO REJECTION-CODE OF TRANS-REC
299830200423           NOT INVALID KEY
299840200423             CONTINUE
299850200423           END-READ
299860200423
299870200423           MOVE TRANS-PRIMARY-REC          TO TRANS-REC
299880200423           MOVE TRANS-STATUS-CODE OF TRANS TO TRANS-STATUS-CATAGORY.
299890200423       RGTP-EXIT.
299900200423           EXIT.
299910200423      * ---------------------------------
299920200423       SAVE-ORIGINAL-TRANS-DATA SECTION.
299930200423      * ---------------------------------
299940200423           MOVE SPLIT-OPTION-CODE OF TRANS TO
299950200423                                      WS-ORIG-SPLIT-OPTION-CODE.
29996020042358714      MOVE PLACEMENT-DATE OF TRANS    TO  lc_Placement_Date.
29997020042358714      MOVE TRANS-NO       OF TRANS    TO  lc_Trans_No.
299980200423
299990200423       SOTD-EXIT.
300000200423            EXIT.
300010200423      * RFS5512 - End
300020200423
300030200423      * RFS21772 - Begin
300040200423      * ---------------------------------
300050200423       FORMAT-TRANS-INTEREST-DETAILS SECTION.
300060200423      * ---------------------------------
300070200423      * This paragraph is formatting TRANS-INTEREST-DETAILS for
300080200423      * calculator mode
300090200423           INITIALIZE MFATRNIDP    OF TRANS-INTEREST-DETAILS
300100200423      *
300110200423           MOVE TRANS-NO OF TRANS         TO
300120200423                              TRANS-NO OF TRANS-INTEREST-DETAILS
300130200423           MOVE PLACEMENT-DATE OF TRANS   TO
300140200423                              PLACEMENT-DATE OF TRANS-INTEREST-DETAILS
300150200423
300160200423      * Determine interest payment option
300170200423           IF ACCOUNT-NO OF GIC-CERTIFICATE-DETAILS
300180200423                                        IS NOT NUMERIC
300190200423              INITIALIZE INT-PAYMENT-OPTION OF GIC-CERTIFICATE-DETAILS
300200200423           END-IF
300210200423           MOVE INT-PAYMENT-OPTION OF GIC-CERTIFICATE-DETAILS
300220200423                TO PAYMENT-TYPE-CODE OF PAYMENT-TYPE-CODES
300230200423
300240200423           PERFORM READ-PAYMENT-TYPE-CODES
300250200423           MOVE PAYMENT-TYPE-RULE OF PAYMENT-TYPE-CODES  TO
300260200423                SW-PAYMENT-TYPE-RULE
300270200423           IF SW-PAYMENT-TYPE-RULE-REINVEST
300280200423             MOVE LT-R TO DISTR-OPTION-CODE OF TRANS-INTEREST-DETAILS
300290200423           ELSE
300300200423             MOVE LT-C TO DISTR-OPTION-CODE OF TRANS-INTEREST-DETAILS
300310200423           END-IF.
300320200423       FTID-EXIT.
300330200423            EXIT.
300340200423      * ---------------------------------
300350200423       READ-PAYMENT-TYPE-CODES SECTION.
300360200423      * ---------------------------------
300370200423           READ PAYMENT-TYPE-CODES
300380200423             INVALID KEY
300390200423               INITIALIZE PAYMENT-TYPE-RULE OF PAYMENT-TYPE-CODES
300400200423               SET SW-TEMP-FAIL        TO TRUE
300410200423             NOT INVALID KEY
300420200423               SET SW-TEMP-OK          TO TRUE
300430200423           END-READ.
300440200423       RPTC-EXIT.
300450200423           EXIT.
300460200423      * RFS21772 - End
300470200423
300480200423      * RFS22180 - Begin
300490200423      * ---------------------------------
300500200423       GET-SCREEN-EDITS-ALLOWED SECTION.
300510200423      * ---------------------------------
300520200423           READ SCREEN-EDITS-ALLOWED
300530200423           INVALID KEY
300540200423             SET SW-TEMP-FAIL        TO TRUE
300550200423           NOT INVALID KEY
300560200423             SET SW-TEMP-OK          TO TRUE
300570200423           END-READ.
300580200423       GSEA-EXIT.
300590200423           EXIT.
300600200423      * ---------------------------------
300610200423       CHECK-INV-CODE-MISC-DETAIL SECTION.
300620200423      * ---------------------------------
300630200423           MOVE INVESTMENT-CODE OF TRANS     TO
300640200423                PASS-INVESTMENT-CODE OF COMM-CPINVDAT-PARAMETERS
300650200423           MOVE TRADE-DATE      OF TRANS     TO
300660200423                PASS-TRADE-DATE      OF COMM-CPINVDAT-PARAMETERS
300670200423           CALL "FXINVDAT" USING COMM-CPINVDAT-PARAMETERS.
300680200423       CICMD-EXIT.
300690200423           EXIT.
300700200423      * RFS22180 - End
300710200423
300720200423      * RFS15626 - Begin
300730200423      * ---------------------------------
300740200423       GET-GRACE-PERIOD SECTION.
300750200423      * ---------------------------------
300760200423      * Call subprogram to get Grace Period parameters
300770200423      *RFS25358 Start
300780200423           IF WS-FEDERAL-PROVINCIAL-MODE = "F"
300790200423               MOVE "FED"
300800200423                 TO pass-province-code OF comm-cplsgppp-parms
300810200423           ELSE
300820200423      *RFS25358 End
300830200423           MOVE PROVINCE-CODE OF TRANS-BUY-LSIF TO
300840200423                      pass-province-code OF comm-cplsgppp-parms
300850200423      *RFS25358 Start
300860200423           END-IF.
300870200423      *RFS25358 End
300880200423           MOVE TRADE-DATE OF TRANS             TO
300890200423                      pass-redemption-date OF comm-cplsgppp-parms
300900200423      *RFS26557X2 Start
300910200423      *    MOVE TRADE-DATE OF TRANS-BUY-LSIF    TO
300920200423      *               pass-contribution-date OF comm-cplsgppp-parms
300930200423           MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF    TO
300940200423                      pass-contribution-date OF comm-cplsgppp-parms
300950200423      *RFS26557X2 End
300960200423           SET pass-action-get-data             TO TRUE
300970200423
300980200423           CALL "FXLSGPPP" USING comm-cplsgppp-parms.
300990200423      * ---------------------------------
301000200423       ADD-DURATION-DAYS SECTION.
301010200423      * ---------------------------------
301020200423           MOVE FUNCTION ADD-DURATION (WD-CCYYMMDD DAYS WS-DURATION) TO
301030200423                WS-OUT-DATE.
301040200423      * ---------------------------------
301050200423       CALC-DURATION-DAYS SECTION.
301060200423      * ---------------------------------
301070200423           COMPUTE WS-DURATION =
301080200423             FUNCTION FIND-DURATION (WD-CCYYMMDD WD-CCYYMMDD-1 DAYS).
301090200423      * ---------------------------------
301100200423       GET-CURR-GRACE-DATA SECTION.
301110200423      * ---------------------------------
301120200423      * Populate some parameters to look through LSIF Buy table
301130200423      * and then get data from GRACE-PERIOD-DSC-PARMS table.
301140200423      *
301150200423           INITIALIZE WS-CURR-GRACE-CALCULATION-TYPE
301160200423                      WS-CURR-GRACE-DAYS
301170200423                      WS-CURR-JURISDICTION
301180200423                      WS-CURR-DSC-WAIVE-OPTION-FLAG
301190200423           MOVE PLACEMENT-DATE OF TRANS-CDSC-PURCHASE  TO
301200200423                WS-TEMP-PLACEMENT-DATE
301210200423           MOVE TRANS-NO OF TRANS-CDSC-PURCHASE        TO
301220200423                WS-TEMP-TRANS-NO
301230200423           PERFORM GET-LSIF-TBL
301240200423           IF SW-GRACE-DSC-FOUND
301250200423             MOVE retn-dsc-waive-option OF comm-cplgrdsp-parms   TO
301260200423                  ws-curr-dsc-waive-option-flag
301270200423           END-IF.
301280200423      * ---------------------------------
301290200423       GET-LSIF-TBL SECTION.
301300200423      * ---------------------------------
301310200423      * Look through LSIF Buy table and get matched record
301320200423      * Then get data from GRACE-PERIOD-DSC-PARMS table and make
301330200423      * decision using DSC Waive Option of the table.
301340200423      *
301350200423           INITIALIZE WS-CURR-JURISDICTION
301360200423           SET SW-GRACE-DSC-OK  TO TRUE
301370200423           SET SW1-TEMP-OK      TO TRUE
301380200423           PERFORM VARYING WS-TBL-ARRAY-CTR FROM 1 BY 1 UNTIL
301390200423                           NOT SW1-TEMP-OK                    OR
301400200423                           WS-TBL-ARRAY-CTR > WS-TBL-ARRAY-CTR-2 OR
301410200423                           WS-TBL-ARRAY-CTR > WS-TBL-ARRAY-MAX
301420200423             IF WS-TEMP-PLACEMENT-DATE = WS-TSL-PLACEMENT-DATE-2 OF
301430200423                                    WS-TBL-ARRAY (WS-TBL-ARRAY-CTR) AND
301440200423                WS-TEMP-TRANS-NO       = WS-TSL-TRANS-NO-2 OF
301450200423                                    WS-TBL-ARRAY (WS-TBL-ARRAY-CTR)
301460200423              SET SW1-TEMP-FOUND        TO TRUE
301470200423              MOVE WS-TBL-ARRAY-CTR     TO WS-TEMP-IND
301480200423             END-IF
301490200423           END-PERFORM
301500200423
301510200423           IF SW1-TEMP-FOUND
301520200423             MOVE WS-TBL-GRACE-CALCULATION-TYPE (WS-TEMP-IND)      TO
301530200423                   WS-CURR-GRACE-CALCULATION-TYPE
301540200423             MOVE WS-TBL-GRACE-DAYS (WS-TEMP-IND)                  TO
301550200423                   WS-CURR-GRACE-DAYS
301560200423             IF WS-TBL-LSIF-STATUS OF WS-TBL-ARRAY (WS-TEMP-IND)   =
301570200423                                                  LT-B OR LT-P
301580200423               MOVE PROVINCE-CODE OF WS-TBL-ARRAY (WS-TEMP-IND)    TO
301590200423                                   WS-CURR-JURISDICTION
301600200423             ELSE
301610200423               IF WS-TBL-LSIF-STATUS OF WS-TBL-ARRAY (WS-TEMP-IND) =
301620200423                                                  LT-F
301630200423                 MOVE LT-FED   TO  WS-CURR-JURISDICTION
301640200423               END-IF
301650200423             END-IF
301660200423             IF WS-CURR-JURISDICTION NOT = SPACES
301670200423               PERFORM GET-GRACE-PERIOD-DSC-PARMS
301680200423               IF retn-code-ok OF comm-cplgrdsp-parms
301690200423                 SET SW-GRACE-DSC-FOUND         TO TRUE
301700200423               END-IF
301710200423             END-IF
301720200423           END-IF.
301730200423      * ---------------------------------
301740200423       GET-GRACE-PERIOD-DSC-PARMS SECTION.
301750200423      * ---------------------------------
301760200423      * Call subprogram to retrieve Grace period DSC parameters
301770200423           MOVE WS-CURR-JURISDICTION                       TO
301780200423                  pass-province-code OF comm-cplgrdsp-parms
301790200423           MOVE TRANS-TYPE-CODE OF TRANS                   TO
301800200423                  pass-trans-type-code OF comm-cplgrdsp-parms
301810200423           MOVE TRADE-DATE OF TRANS                        TO
301820200423                  pass-validate-date OF comm-cplgrdsp-parms
301830200423           MOVE INVESTMENT-CODE OF TRANS                   TO
301840200423                  pass-investment-code OF comm-cplgrdsp-parms
301850200423           SET pass-action-vld-data OF comm-cplgrdsp-parms TO TRUE
301860200423
301870200423           CALL "FXLGRDSP" USING comm-cplgrdsp-parms.
301880200423      * RFS15626 - End
301890200423      /
301900200423      * RFS23020 - Begin
301910200423      * ---------------------------------
301920200423       GET-AAP-DIST-PAYMENT-METHOD SECTION.
301930200423      * ---------------------------------
301940200423      * This routine is used to get the asset allocation phantom
301950200423      * account investment distribution options and payment type when
301960200423      * creating new account investment for asset allocation holdings.
301970200423
301980200423           INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-SRCH-REC.
301990200423           MOVE ACCOUNT-NO      OF ASSET-ALLOCATION-HEADER-REC
302000200423             TO ACCOUNT-NO      OF ACCOUNT-INVESTMENT-SRCH-REC.
302010200423           MOVE INVESTMENT-CODE OF ASSET-ALLOCATION-HEADER-REC
302020200423             TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT-SRCH-REC.
302030200423           IF SWITCH-IN-TRANSACTION
302040200423              MOVE INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER-REC
302050200423                TO INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-SRCH-REC
302060200423           END-IF.
302070200423
302080200423           READ ACCOUNT-INVESTMENT-SRCH
302090200423             INVALID KEY
302100200423                DISPLAY "@@@ NO ACC-INVESTMENT-SRCH RECORD"
302110200423                INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-SRCH-REC
302120200423                GO TO GAAI-EXIT
302130200423           END-READ.
302140200423
302150200423           MOVE CAPITAL-GAIN-DISTR-OPTION
302160200423             OF ACCOUNT-INVESTMENT-SRCH-REC TO
302170200423                                   WS-CAPITAL-GAIN-DISTR-OPTION.
302180200423           MOVE INCOME-DISTR-OPTION
302190200423             OF ACCOUNT-INVESTMENT-SRCH-REC TO
302200200423                                   WS-INCOME-DISTR-OPTION.
302210200423           MOVE PAYMENT-TYPE-CODE
302220200423             OF ACCOUNT-INVESTMENT-SRCH-REC TO
302230200423                                   WS-PAYMENT-TYPE-CODE.
302240200423
302250200423       GAAI-EXIT.
302260200423            EXIT.
302270200423      /
302280200423      * RFS25997 - Begin
302290200423      * ---------------------------------
302300200423       GET-LLP-MAX-VALIDATE-RULE.
302310200423      * ---------------------------------
302320200423           INITIALIZE WS-LLP-REJECT.
302330200423           INITIALIZE MFATLLPXP OF TRANS-LLP-MAX-EXCEED.
302340200423
302350200423           IF SWITCH-OUT-TRANSACTION OR SELL-TRANSACTION OR
302360200423              SWITCH-IN-TRANSACTION
302370200423              IF SWITCH-OUT-TRANSACTION OR SELL-TRANSACTION
302380200423                 MOVE PLACEMENT-DATE  OF TRANS
302390200423                   TO PLACEMENT-DATE  OF TRANS-LLP-MAX-EXCEED
302400200423                 MOVE TRANS-NO        OF TRANS
302410200423                   TO TRANS-NO OF TRANS-LLP-MAX-EXCEED
302420200423              END-IF
302430200423              IF (TRANS-TYPE-CODE OF WS-TRANS-REC-2 = "SWO" OR "TRO")
302440200423                 AND SWITCH-IN-TRANSACTION
302450200423                 MOVE PLACEMENT-DATE     OF WS-TRANS-REC-2
302460200423                      TO PLACEMENT-DATE  OF TRANS-LLP-MAX-EXCEED
302470200423                 MOVE TRANS-NO    OF WS-TRANS-REC-2
302480200423                      TO TRANS-NO OF TRANS-LLP-MAX-EXCEED
302490200423              END-IF
302500200423
302510200423              READ TRANS-LLP-MAX-EXCEED
302520200423               INVALID KEY
302530200423                 CONTINUE
302540200423               NOT INVALID KEY
302550200423                MOVE "Y" TO WS-LLP-REJECT
302560200423              END-READ
302570200423           END-IF.
302580200423
302590200423       GLLP-EXIT.
302600200423            EXIT.
302610200423      * RFS25997 - End
302620200423      /
302630200423      * ---------------------------------
302640200423       UPD-INVESTMENT-DISTRIB-CHEQUE SECTION.
302650200423      * ---------------------------------
302660200423      * This routine is used to get the asset allocation phantom cheque
302670200423      * payment info. and create the same info. for the asset
302680200423      * allocation holding fund.
302690200423
302700200423       UIDC-0000.
302710200423           INITIALIZE MFADISCQP OF INVESTMENT-DISTRIB-CHEQUE-REC.
302720200423           MOVE ACCOUNT-NO      OF ASSET-ALLOCATION-HEADER-REC
302730200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-CHEQUE-REC.
302740200423           MOVE INVESTMENT-CODE OF ASSET-ALLOCATION-HEADER-REC
302750200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-CHEQUE-REC.
302760200423           IF SWITCH-IN-TRANSACTION
302770200423              MOVE INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER-REC
302780200423                TO INVESTMENT-CODE  OF INVESTMENT-DISTRIB-CHEQUE-REC
302790200423           END-IF.
302800200423
302810200423       UIDC-0005.
302820200423           READ INVESTMENT-DISTRIB-CHEQUE
302830200423             INVALID KEY
302840200423                DISPLAY "@@@ NO INVEST-DISTRIB-CHEQUE RECORD"
302850200423                INITIALIZE MFADISCQP OF INVESTMENT-DISTRIB-CHEQUE-REC
302860200423                GO TO UIDC-EXIT
302870200423           END-READ.
302880200423
302890200423           MOVE ACCOUNT-NO      OF ACCOUNT-INVESTMENT
302900200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-CHEQUE-REC.
302910200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
302920200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-CHEQUE-REC.
302930200423
302940200423           WRITE INVESTMENT-DISTRIB-CHEQUE-REC
302950200423              INVALID KEY
302960200423                 CONTINUE
302970200423           END-WRITE
302980200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
302990200423              MOVE "INVEST-DISTRIB-CHQ" TO WS-FILE-STATUS-FILE-NAME
30300020042358714         SET lncc_Err163  TO  TRUE
303010200423              PERFORM LOG-FILE-STATUS
303020200423           END-IF.
303030200423
303040200423       UIDC-EXIT.
303050200423            EXIT.
303060200423      /
303070200423      * ---------------------------------
303080200423       UPD-INVESTMENT-DISTRIB-EFT SECTION.
303090200423      * ---------------------------------
303100200423      * This routine is used to get the asset allocation phantom eft
303110200423      * payment info. and create the same info. on the asset allocation
303120200423      * holding fund.
303130200423
303140200423       UIDE-0000.
303150200423           INITIALIZE MFADISEFP OF INVESTMENT-DISTRIB-EFT-REC.
303160200423           MOVE ACCOUNT-NO      OF ASSET-ALLOCATION-HEADER-REC
303170200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-EFT-REC.
303180200423           MOVE INVESTMENT-CODE OF ASSET-ALLOCATION-HEADER-REC
303190200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-EFT-REC.
303200200423           IF SWITCH-IN-TRANSACTION
303210200423              MOVE INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER-REC
303220200423                TO INVESTMENT-CODE  OF INVESTMENT-DISTRIB-EFT-REC
303230200423           END-IF.
303240200423
303250200423       UIDE-0005.
303260200423           READ INVESTMENT-DISTRIB-EFT
303270200423             INVALID KEY
303280200423                DISPLAY "@@@ NO INVEST-DISTRIB-EFT RECORD"
303290200423                INITIALIZE MFADISEFP OF INVESTMENT-DISTRIB-EFT-REC
303300200423                GO TO UIDE-EXIT
303310200423           END-READ.
303320200423
303330200423           MOVE ACCOUNT-NO      OF ACCOUNT-INVESTMENT
303340200423             TO ACCOUNT-NO      OF INVESTMENT-DISTRIB-EFT-REC.
303350200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
303360200423             TO INVESTMENT-CODE OF INVESTMENT-DISTRIB-EFT-REC.
303370200423
303380200423           WRITE INVESTMENT-DISTRIB-EFT-REC
303390200423              INVALID KEY
303400200423                 CONTINUE
303410200423           END-WRITE
303420200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
303430200423              MOVE "INVEST-DISTRIB-EFT" TO WS-FILE-STATUS-FILE-NAME
30344020042358714         SET lncc_Err164  TO  TRUE
303450200423              PERFORM LOG-FILE-STATUS
303460200423           END-IF.
303470200423
303480200423       UIDE-EXIT.
303490200423            EXIT.
303500200423      /
303510200423      * ---------------------------------
303520200423       UPD-ACCOUNT-INVESTMENT-DSRP SECTION.
303530200423      * ---------------------------------
303540200423      * This routine is used to get the asset allocation phantom dsrp
303550200423      * account info. and create the same info. for the asset
303560200423      * allocation holding fund.
303570200423
303580200423       UAID-0000.
303590200423           INITIALIZE MFAACIDSRP OF ACCOUNT-INVESTMENT-DSRP-REC.
303600200423           MOVE ACCOUNT-NO      OF ASSET-ALLOCATION-HEADER-REC
303610200423             TO ACCOUNT-NO      OF ACCOUNT-INVESTMENT-DSRP-REC.
303620200423           MOVE INVESTMENT-CODE OF ASSET-ALLOCATION-HEADER-REC
303630200423             TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT-DSRP-REC.
303640200423           IF SWITCH-IN-TRANSACTION
303650200423              MOVE INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER-REC
303660200423                TO INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-DSRP-REC
303670200423           END-IF.
303680200423
303690200423           MOVE ZEROES          TO TARGET-ACCOUNT
303700200423                                OF ACCOUNT-INVESTMENT-DSRP-REC.
303710200423           MOVE SPACES          TO TARGET-INVESTMENT
303720200423                                OF ACCOUNT-INVESTMENT-DSRP-REC.
303730200423
303740200423           START ACCOUNT-INVESTMENT-DSRP
303750200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
303760200423              INVALID KEY
303770200423                DISPLAY "@@@ NO ACCOUNT-INVESTMENT-DSRP RECORD"
303780200423                INITIALIZE MFAACIDSRP OF ACCOUNT-INVESTMENT-DSRP-REC
303790200423                GO TO UAID-EXIT
303800200423           END-START.
303810200423
303820200423       UAID-NEXT.
303830200423           READ ACCOUNT-INVESTMENT-DSRP  NEXT RECORD
303840200423             AT END
303850200423                DISPLAY "@@@ AT END ACC-INVESTMENT-DSRP RECORD"
303860200423                INITIALIZE MFAACIDSRP OF ACCOUNT-INVESTMENT-DSRP-REC
303870200423                GO TO UAID-EXIT
303880200423           END-READ.
303890200423
303900200423           IF ACCOUNT-NO OF ACCOUNT-INVESTMENT-DSRP-REC NOT =
303910200423              ACCOUNT-NO OF ASSET-ALLOCATION-HEADER-REC
303920200423              GO TO UAID-EXIT
303930200423           END-IF.
303940200423           IF SWITCH-IN-TRANSACTION
303950200423              IF INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-DSRP-REC NOT =
303960200423                 INVESTMENT-CODE2 OF ASSET-ALLOCATION-HEADER-REC
303970200423                 GO TO UAID-EXIT
303980200423              END-IF
303990200423           ELSE
304000200423              IF INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-DSRP-REC NOT =
304010200423                 INVESTMENT-CODE  OF ASSET-ALLOCATION-HEADER-REC
304020200423                 GO TO UAID-EXIT
304030200423              END-IF
304040200423           END-IF.
304050200423
304060200423           MOVE ACCOUNT-NO      OF ACCOUNT-INVESTMENT
304070200423             TO ACCOUNT-NO      OF ACCOUNT-INVESTMENT-DSRP-REC.
304080200423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
304090200423             TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT-DSRP-REC.
304100200423
304110200423           WRITE ACCOUNT-INVESTMENT-DSRP-REC
304120200423              INVALID KEY
304130200423                 CONTINUE
304140200423           END-WRITE
304150200423           IF WS-FILE-STATUS IS NOT EQUAL TO "00"
304160200423              MOVE "ACC-INVESTMENT-DSRP" TO WS-FILE-STATUS-FILE-NAME
30417020042358714         SET lncc_Err165  TO  TRUE
304180200423              PERFORM LOG-FILE-STATUS
304190200423           END-IF.
304200200423
304210200423           GO TO UAID-NEXT.
304220200423
304230200423       UAID-EXIT.
304240200423            EXIT.
304250200423      * RFS23020 - End
304260200423      /
304270200423      * ---------------------------------
304280200423        UPD-ACCOUNT-INV-MATURITY.
304290200423      * ---------------------------------
304300200423      * Rfs42278 Start
304310200423      * This routine is used to create a default maturity instruction
304320200423      * of "I" for linked notes investment
304330200423      * ---------------------------------
304340200423             INITIALIZE MFAACIVMP   OF ACCOUNT-INV-MAT-REC
304350200423              MOVE  INVESTMENT-CODE OF ACCOUNT-INVESTMENT-REC TO
304360200423                    INVESTMENT-CODE OF ACCOUNT-INV-MAT-REC
304370200423              MOVE  ACCOUNT-NO      OF ACCOUNT-INVESTMENT-REC TO
304380200423                    ACCOUNT-NO      OF ACCOUNT-INV-MAT-REC
304390200423              READ  ACCOUNT-INV-MATURITY
304400200423              INVALID KEY
304410200423                    MOVE  "I"   TO   PAYMENT-TYPE-CODE OF
304420200423                                     ACCOUNT-INV-MAT-REC
304430200423                    WRITE  ACCOUNT-INV-MAT-REC
304440200423                    INVALID KEY
304450200423                           CONTINUE
304460200423                    END-WRITE
304470200423                    IF WS-FILE-STATUS IS NOT EQUAL TO "00"
304480200423                       MOVE "ACC-INV-MATURITY-REC"
304490200423                               TO WS-FILE-STATUS-FILE-NAME
30450020042358714                  SET lncc_Err166  TO  TRUE
304510200423                       PERFORM LOG-FILE-STATUS
304520200423                    END-IF
304530200423              END-READ.
304540200423      * Rfs42278 End
304550200423
304560200423      * RFS26557 Start
304570200423      ******************************************************************
304580200423      *    G E T  B O T H  L S I F  J U R I S D I C T I O N S          *
304590200423      ******************************************************************
304600200423       GET-BOTH-LSIF-JURISDICTIONS SECTION.
304610200423
304620200423           MOVE "N"             TO WS-FED-JURISDICTION-EXIST
304630200423                                   WS-PRV-JURISDICTION-EXIST
304640200423                                   WS-FED-JURISDICTION-ISSUE
304650200423                                   WS-PRV-JURISDICTION-ISSUE.
304660200423
304670200423       GBLJ-0000.
304680200423      * Retrieve the PROVINCIAL jurisdiction information.
304690200423           MOVE PROVINCE-CODE OF INVESTOR
304700200423             TO WS-PROVINCE-CODE.
304710200423           PERFORM GET-LSIF-JURISDICTION.
304720200423           MOVE WS-JURISDICTION-EXIST
304730200423             TO WS-PRV-JURISDICTION-EXIST.
304740200423           MOVE WS-JURISDICTION-ISSUE
304750200423             TO WS-PRV-JURISDICTION-ISSUE.
304760200423      * Retrieve the FEDERAL jurisdiction information.
304770200423           MOVE "FED"
304780200423             TO WS-PROVINCE-CODE.
304790200423           PERFORM GET-LSIF-JURISDICTION.
304800200423           MOVE WS-JURISDICTION-EXIST
304810200423             TO WS-FED-JURISDICTION-EXIST.
304820200423           MOVE WS-JURISDICTION-ISSUE
304830200423             TO WS-FED-JURISDICTION-ISSUE.
304840200423
304850200423      * If PROV record not found, reject the transaction.
304860200423           IF WS-PRV-JURISDICTION-EXIST = "N"
304870200423               DISPLAY "@@@ TRANS-NO: " TRANS-NO OF TRANS
304880200423               DISPLAY "@@@P8 MISSING LSIF-JURISDICTION "
304890200423               MOVE "L1" TO REJECTION-CODE OF TRANS
304900200423               GO TO GBLJ-EXIT
304910200423           END-IF.
304920200423
304930200423      * Set the proper LSIF status.
304940200423           IF WS-PRV-JURISDICTION-ISSUE = "Y"  AND
304950200423              WS-FED-JURISDICTION-ISSUE = "Y"
304960200423                MOVE "B"
304970200423                  TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
304980200423           ELSE
304990200423             IF WS-PRV-JURISDICTION-ISSUE = "Y"
305000200423                  MOVE "P"
305010200423                    TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
305020200423             ELSE
305030200423               IF WS-FED-JURISDICTION-ISSUE = "Y"
305040200423                    MOVE "F"
305050200423                      TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
305060200423               END-IF
305070200423             END-IF
305080200423           END-IF.
305090200423
305100200423       GBLJ-EXIT.
305110200423            EXIT.
305120200423      ******************************************************************
305130200423      *    G E T  L S I F  J U R I S D I C T I O N                     *
305140200423      ******************************************************************
305150200423       GET-LSIF-JURISDICTION SECTION.
305160200423
305170200423            MOVE "N"             TO WS-JURISDICTION-EXIST
305180200423                                    WS-JURISDICTION-ISSUE.
305190200423
305200200423       GLJ-0000.
305210200423
305220200423           MOVE INVESTMENT-CODE OF TRANS
305230200423           TO   INVESTMENT-CODE OF INVESTMENT-LSIF-JURISDICTIONS.
305240200423
305250200423           MOVE "CAN"
305260200423           TO   COUNTRY-CODE    OF INVESTMENT-LSIF-JURISDICTIONS.
305270200423
305280200423           MOVE WS-PROVINCE-CODE
305290200423           TO   PROVINCE-CODE   OF INVESTMENT-LSIF-JURISDICTIONS.
305300200423
305310200423           MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
305320200423           TO START-DATE        OF INVESTMENT-LSIF-JURISDICTIONS.
305330200423
305340200423           START INVESTMENT-LSIF-JURISDICTIONS
305350200423           KEY IS GREATER THAN EXTERNALLY-DESCRIBED-KEY
305360200423           INVALID KEY
305370200423             READ INVESTMENT-LSIF-JURISDICTIONS LAST RECORD
305380200423             AT END
305390200423               GO TO GLJ-EXIT
305400200423             END-READ
305410200423
305420200423           NOT INVALID KEY
305430200423
305440200423             READ INVESTMENT-LSIF-JURISDICTIONS PRIOR RECORD
305450200423             AT END
305460200423               GO TO GLJ-EXIT
305470200423             END-READ
305480200423
305490200423           END-START.
305500200423
305510200423           IF (INVESTMENT-CODE OF INVESTMENT-LSIF-JURISDICTIONS IS
305520200423           NOT EQUAL INVESTMENT-CODE OF TRANS)
305530200423           OR (COUNTRY-CODE    OF INVESTMENT-LSIF-JURISDICTIONS IS
305540200423           NOT EQUAL "CAN")
305550200423           OR (PROVINCE-CODE   OF INVESTMENT-LSIF-JURISDICTIONS IS
305560200423           NOT EQUAL WS-PROVINCE-CODE)
305570200423           OR (START-DATE      OF INVESTMENT-LSIF-JURISDICTIONS IS
305580200423           GREATER THAN CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY)
305590200423           OR (END-DATE        OF INVESTMENT-LSIF-JURISDICTIONS IS
305600200423           LESS THAN CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY)
305610200423               GO TO GLJ-EXIT
305620200423           END-IF.
305630200423
305640200423           MOVE "Y"             TO WS-JURISDICTION-EXIST.
305650200423
305660200423           IF ISSUE-CREDITS    OF INVESTMENT-LSIF-JURISDICTIONS = "Y"
305670200423             MOVE "Y"         TO WS-JURISDICTION-ISSUE
305680200423           END-IF.
305690200423
305700200423       GLJ-EXIT.
305710200423           EXIT.
305720200423      ******************************************************************
305730200423      *    G E T  L S I F  T A X  C R E D I T S  A L L O W E D         *
305740200423      ******************************************************************
305750200423       GET-LSIF-TAX-CREDITS-ALLOWED SECTION.
305760200423
305770200423       GLTCA-0000.
305780200423           INITIALIZE MFALTCAP OF LSIF-TAX-CREDITS-ALLOWED-REC.
305790200423
305800200423           MOVE ACCOUNT-TYPE-CODE    OF ACCOUNT
305810200423           TO   ACCOUNT-TYPE-CODE    OF LSIF-TAX-CREDITS-ALLOWED.
305820200423
305830200423           IF NOMINEE OF ACCOUNT = "Y"
305840200423               MOVE ACCOUNT-NO OF ACCOUNT
305850200423                               TO ACCOUNT-NO OF ACCOUNT-NOMINEE
305860200423               READ ACCOUNT-NOMINEE
305870200423               INVALID KEY
305880200423                 INITIALIZE MFAACCNMP OF ACCOUNT-NOM-REC
305890200423               END-READ
305900200423               MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
305910200423               TO   NOMINEE-ACCOUNT-TYPE OF LSIF-TAX-CREDITS-ALLOWED
305920200423           ELSE
305930200423               MOVE SPACES
305940200423               TO   NOMINEE-ACCOUNT-TYPE OF LSIF-TAX-CREDITS-ALLOWED
305950200423           END-IF.
305960200423
305970200423           MOVE NOMINEE-ACCOUNT-TYPE OF LSIF-TAX-CREDITS-ALLOWED
305980200423               TO WS-NOMINEE-ACCOUNT-TYPE.
305990200423
306000200423           MOVE INVESTOR-TYPE-CODE   OF INVESTOR
306010200423           TO   INVESTOR-TYPE-CODE   OF LSIF-TAX-CREDITS-ALLOWED.
306020200423
306030200423           MOVE CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY
306040200423           TO START-DATE             OF LSIF-TAX-CREDITS-ALLOWED.
306050200423
306060200423           START LSIF-TAX-CREDITS-ALLOWED
306070200423           KEY IS GREATER THAN EXTERNALLY-DESCRIBED-KEY
306080200423           INVALID KEY
306090200423             READ LSIF-TAX-CREDITS-ALLOWED LAST RECORD
306100200423             AT END
306110200423               MOVE "N"
306120200423                 TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
306130200423               GO TO GLTCA-EXIT
306140200423             END-READ
306150200423
306160200423           NOT INVALID KEY
306170200423
306180200423           READ LSIF-TAX-CREDITS-ALLOWED PRIOR RECORD
306190200423           AT END
306200200423             MOVE "N"
306210200423               TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
306220200423             GO TO GLTCA-EXIT
306230200423           END-READ
306240200423
306250200423           END-START.
306260200423
306270200423           IF (ACCOUNT-TYPE-CODE    OF LSIF-TAX-CREDITS-ALLOWED
306280200423           IS NOT EQUAL ACCOUNT-TYPE-CODE OF ACCOUNT)
306290200423           OR (NOMINEE-ACCOUNT-TYPE OF LSIF-TAX-CREDITS-ALLOWED
306300200423           IS NOT EQUAL WS-NOMINEE-ACCOUNT-TYPE)
306310200423           OR (INVESTOR-TYPE-CODE   OF LSIF-TAX-CREDITS-ALLOWED
306320200423           IS NOT EQUAL INVESTOR-TYPE-CODE OF INVESTOR)
306330200423           OR (START-DATE           OF LSIF-TAX-CREDITS-ALLOWED
306340200423           IS GREATER THAN CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY)
306350200423           OR (END-DATE             OF LSIF-TAX-CREDITS-ALLOWED
306360200423           IS LESS THAN CONTRIBUTION-DATE OF TRANS-BUY-LSIF-PRIMARY)
306370200423               MOVE "N"
306380200423                 TO LSIF-STATUS OF TRANS-BUY-LSIF-PRIMARY
306390200423               GO TO GLTCA-EXIT
306400200423           END-IF.
306410200423
306420200423       GLTCA-EXIT.
306430200423             EXIT.
306440200423      * RFS26557 End
306450200423
30646020042326151  COPY CPYEXCLTRN.
306470200423
306480200423R43677*RFS43677 - Begin
306490200423      ******************************************************************
306500200423      * Check Account types for Client-Held or Nominee Cash Accounts   *
306510200423      ******************************************************************
306520200423       CHECK-ACCT-TYPES SECTION.
306530200423
306540200423       CAT-0001.
306550200423           Initialize Ws-Acct-Type-Cash
306560200423                      Ws-Nom-Acct-Type-Cash
306570200423                      Ws-Account-Type-Rule
306580200423                      Ws-Account-Type-Rule-Nominee.
306590200423
306600200423           Initialize MFAACCTYP Of Account-Type.
306610200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
306620200423             TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE.
306630200423           READ ACCOUNT-TYPE
306640200423             INVALID KEY
306650200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
306660200423                          WS-ACCOUNT-TYPE-RULE
306670200423             NOT INVALID KEY
306680200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
306690200423                 TO Ws-Account-Type-Rule
30670020042380658          MOVE ACCOUNT-NO OF ACCOUNT
30671020042380658            TO WS-ACCOUNT-NO-FOR-RULE
306720200423           END-READ.
306730200423
306740200423           IF Ws-Account-Type-Rule = "1"
306750200423               IF NOMINEE OF ACCOUNT = "Y"
306760200423                  PERFORM GET-ACCOUNT-NOMINEE
306770200423                  INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
306780200423                  MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
306790200423                    TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE
306800200423                  READ ACCOUNT-TYPE
306810200423                    INVALID KEY
306820200423                      Initialize MFAACCTYP OF ACCOUNT-TYPE
306830200423                                 Ws-Account-Type-Rule-Nominee
306840200423                    NOT INVALID KEY
306850200423                      MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
306860200423                        TO Ws-Account-Type-Rule-Nominee
306870200423                  END-READ
306880200423               END-IF
306890200423
306900200423               IF NOMINEE OF ACCOUNT NOT = "Y" AND
306910200423                  Ws-Account-Type-Rule = "1"
306920200423                  MOVE "Y"  TO Ws-Acct-Type-Cash
306930200423               END-IF
306940200423
306950200423               IF NOMINEE OF ACCOUNT = "Y" AND
306960200423                  Ws-Account-Type-Rule-Nominee = "1"
306970200423                  MOVE "Y"  TO Ws-Nom-Acct-Type-Cash
306980200423               END-IF
306990200423
307000200423 53578         IF NOMINEE OF ACCOUNT = "Y" AND
307010200423   |              Ws-Account-Type-Rule-Nominee NOT = "1"
307020200423   |              MOVE "N"  TO Ws-Nom-Acct-Type-Cash
307030200423 53578         END-IF
307040200423           END-IF.
307050200423
307060200423       CAT-EXIT.
307070200423           EXIT.
307080200423      ******************************************************************
307090200423      * New rejection code was introduced for Linked Note maturity     *
307100200423      * processing to make sure that ACB is correct.                   *
307110200423      * Check Linked Note Tax at Maturity Options                      *
307120200423      * before redemption transactions is generated                    *
307130200423      ******************************************************************
307140200423       CHECK-LNK-MAT-REDEM SECTION.
307150200423
307160200423       CLMR-0001.
307170200423            PERFORM Check-Acct-Types.
307180200423
307190200423            IF Acct-Type-Cash OR Nom-Acct-Type-Cash
307200200423               PERFORM Get-Average-Unit-Cost
307210200423               Move "Y" TO Ws-Lnk-Maturity-NR-Flag
307220200423
307230200423               IF Ws-AUC-Unit-Cost-OK NOT = "Y"
307240200423                  Move "00" TO Rejection-Code of Trans
307250200423               END-IF
307260200423            End-If.
307270200423
307280200423       CLMR-EXIT.
307290200423            EXIT.
307300200423R43677*RFS 43677 - End
307310200423
307320200423      *RFS24191 - Begins
307330200423      ******************************************************************
307340200423      *    CHECK INCLUSION RATE FOR CAPITAL GAINS                      *
307350200423      ******************************************************************
307360200423       CHECK-INCRATCPG SECTION.
307370200423
307380200423       CKIRC-0000.
307390200423           INITIALIZE WS-ACCOUNT-TYPE-RULE
307400200423                      WS-ACCOUNT-TYPE-RULE-NOMINEE.
307410200423
307420200423           INITIALIZE MFAACCTYP OF ACCOUNT-TYPE.
307430200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
307440200423             TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE.
307450200423           READ ACCOUNT-TYPE
307460200423             INVALID KEY
307470200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
307480200423                          WS-ACCOUNT-TYPE-RULE
307490200423             NOT INVALID KEY
307500200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
307510200423                 TO WS-ACCOUNT-TYPE-RULE
30752020042380658          MOVE ACCOUNT-NO OF ACCOUNT
30753020042380658            TO WS-ACCOUNT-NO-FOR-RULE
307540200423           END-READ.
307550200423
30756020042380658 *    IF  COUNTRY-CODE OF INVESTOR  NOT =  'CAN'
30757020042380658      IF  Lc_TaxCountryCode         NOT =  'CAN'
307580200423           AND WS-ACCOUNT-TYPE-RULE = "1"
307590200423               IF NOMINEE OF ACCOUNT = "Y"
307600200423                  PERFORM GET-ACCOUNT-NOMINEE
307610200423                  INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
307620200423                  MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
307630200423                    TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE
307640200423                  READ ACCOUNT-TYPE
307650200423                    INVALID KEY
307660200423                      INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
307670200423                                 WS-ACCOUNT-TYPE-RULE-NOMINEE
307680200423                    NOT INVALID KEY
307690200423                      MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
307700200423                        TO WS-ACCOUNT-TYPE-RULE-NOMINEE
307710200423                  END-READ
307720200423               END-IF
307730200423
307740200423               IF (NOMINEE OF ACCOUNT NOT = "Y" AND
307750200423                   WS-ACCOUNT-TYPE-RULE = "1")
307760200423               OR (NOMINEE OF ACCOUNT = "Y" AND
307770200423                   WS-ACCOUNT-TYPE-RULE-NOMINEE = "1")
307780200423                  MOVE "Y"  TO WS-INCRATCPG-CALC
307790200423               END-IF
307800200423           END-IF.
307810200423
307820200423       CKIRC-EXIT.
307830200423           EXIT.
307840200423      ******************************************************************
307850200423      *    CALCULATE INCLUSION RATE FOR CAPITAL GAINS                  *
307860200423      ******************************************************************
307870200423       CALCULATE-INCRATCPG SECTION.
307880200423       CIRC-0000.
307890200423           MOVE ZEROS  TO WS-PROVINCIAL-TAX-AMOUNT.
307900200423           IF TAXATION-RATE OF COUNTRY-TAX = 0
307910200423      * Taxable Amount = Gross Amt * Fed Pooled Rate
307920200423              MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
307930200423                TO WS-FED-INCL-RATE-2
307940200423              COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
307950200423                      WS-TAXABLE-AMOUNT *
307960200423                      FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX /
307970200423                      100
307980200423           ELSE
307990200423      * Taxable Amount = Gross Amt * Fed Pooled Rate * Inclusion Rate
308000200423              COMPUTE WS-FED-INCL-RATE-2 =
308010200423                      FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX *
308020200423                      TAXATION-RATE OF COUNTRY-TAX /
308030200423                      100
308040200423              COMPUTE WS-FEDERAL-TAX-AMOUNT ROUNDED =
308050200423                     (WS-TAXABLE-AMOUNT *
308060200423                      FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX *
308070200423                      TAXATION-RATE OF COUNTRY-TAX) /
308080200423                      10000
308090200423           END-IF.
308100200423       CIRC-EXIT.
308110200423           EXIT.
308120200423      *RFS24191 - Ends
308130200423      *RFS24190 - Begins
308140200423      ******************************************************************
308150200423      *    CHECK TRANSFER AT COST                                      *
308160200423      ******************************************************************
308170200423       CHECK-TRANSFER-AT-COST SECTION.
308180200423       CTAC-0000.
308190200423           IF ACCOUNT-TYPE-CODE OF ACCOUNT  NOT =
308200200423              ACCOUNT-TYPE-CODE OF ACCTYP-CONTRED-TXNTYP-TAXEV
308210200423           OR CONTR-REDEM-CODE  OF TRANS    NOT =
308220200423              CONTR-REDEM-CODE  OF ACCTYP-CONTRED-TXNTYP-TAXEV
308230200423           OR TRANS-TYPE-CODE   OF TRANS    NOT =
308240200423              TRANS-TYPE-CODE   OF ACCTYP-CONTRED-TXNTYP-TAXEV
308250200423              INITIALIZE MFAACTEVP OF ACCTYP-CONTRED-TXNTYP-TXEV-REC
308260200423                         WS-TFR-AT-COST-OCCURS
308270200423              MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
308280200423                TO ACCOUNT-TYPE-CODE OF ACCTYP-CONTRED-TXNTYP-TAXEV
308290200423              MOVE CONTR-REDEM-CODE  OF TRANS
308300200423                TO CONTR-REDEM-CODE  OF ACCTYP-CONTRED-TXNTYP-TAXEV
308310200423              MOVE TRANS-TYPE-CODE   OF TRANS
308320200423                TO TRANS-TYPE-CODE   OF ACCTYP-CONTRED-TXNTYP-TAXEV
308330200423
308340200423              READ ACCTYP-CONTRED-TXNTYP-TAXEV
308350200423                INVALID KEY
308360200423                  MOVE SPACES  TO WS-TFR-AT-COST-OCCURS
308370200423                NOT INVALID KEY
308380200423                  MOVE TRANSFER-AT-AVERAGE OF
308390200423                       ACCTYP-CONTRED-TXNTYP-TAXEV
308400200423                    TO WS-TFR-AT-COST-OCCURS
308410200423              END-READ
308420200423           END-IF.
308430200423       CTAC-EXIT.
308440200423           EXIT.
308450200423      ******************************************************************
308460200423      *    CHECK NON-RESIDENT TAX  T2062                               *
308470200423      ******************************************************************
308480200423       CHECK-NTAXT2062 SECTION.
308490200423
308500200423       CKT2062-0000.
308510200423           INITIALIZE WS-ACCOUNT-TYPE-RULE
308520200423                      WS-ACCOUNT-TYPE-RULE-NOMINEE.
308530200423
308540200423           INITIALIZE MFAACCTYP OF ACCOUNT-TYPE.
308550200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
308560200423             TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE.
308570200423           READ ACCOUNT-TYPE
308580200423             INVALID KEY
308590200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
308600200423                          WS-ACCOUNT-TYPE-RULE
308610200423             NOT INVALID KEY
308620200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
308630200423                 TO WS-ACCOUNT-TYPE-RULE
30864020042380658          MOVE ACCOUNT-NO OF ACCOUNT
30865020042380658            TO WS-ACCOUNT-NO-FOR-RULE
308660200423           END-READ.
30867020042380658 *    IF  COUNTRY-CODE OF INVESTOR  NOT =  'CAN'
30868020042380658      IF  Lc_TaxCountryCode         NOT =  'CAN'
308690200423           AND WS-ACCOUNT-TYPE-RULE = "1"
308700200423               IF NOMINEE OF ACCOUNT = "Y"
308710200423                  PERFORM GET-ACCOUNT-NOMINEE
308720200423                  INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
308730200423                  MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
308740200423                    TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE
308750200423                  READ ACCOUNT-TYPE
308760200423                    INVALID KEY
308770200423                      INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
308780200423                                 WS-ACCOUNT-TYPE-RULE-NOMINEE
308790200423                    NOT INVALID KEY
308800200423                      MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
308810200423                        TO WS-ACCOUNT-TYPE-RULE-NOMINEE
308820200423                  END-READ
308830200423               END-IF
308840200423               IF (NOMINEE OF ACCOUNT NOT = "Y" AND
308850200423                   WS-ACCOUNT-TYPE-RULE = "1")
308860200423               OR (NOMINEE OF ACCOUNT = "Y" AND
308870200423                   WS-ACCOUNT-TYPE-RULE-NOMINEE = "1")
308880200423                  MOVE "Y"  TO WS-NTAXT2062-CALC
308890200423                  IF SWITCH-OUT-TRANSACTION
308900200423                     PERFORM CHECK-TRANSFER-AT-COST
308910200423                  END-IF
308920200423
308930200423                  IF NOT TFR-AT-COST-OCCURS
308940200423                     PERFORM GET-AVERAGE-UNIT-COST
308950200423                  END-IF
308960200423               END-IF
308970200423           END-IF.
308980200423       CKT2062-EXIT.
308990200423           EXIT.
309000200423      ******************************************************************
309010200423      *    CHECK NON-RESIDENT TAX  REGSEL                              *
309020200423      ******************************************************************
309030200423       CHECK-NTAXREGSEL SECTION.
309040200423       CKREGSEL-0000.
309050200423           INITIALIZE WS-ACCOUNT-TYPE-RULE
309060200423                      WS-ACCOUNT-TYPE-RULE-NOMINEE.
309070200423           INITIALIZE MFAACCTYP OF ACCOUNT-TYPE.
309080200423           MOVE ACCOUNT-TYPE-CODE OF ACCOUNT
309090200423             TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE.
309100200423           READ ACCOUNT-TYPE
309110200423             INVALID KEY
309120200423               INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
309130200423                          WS-ACCOUNT-TYPE-RULE
309140200423             NOT INVALID KEY
309150200423               MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
309160200423                 TO WS-ACCOUNT-TYPE-RULE
30917020042380658        MOVE ACCOUNT-NO Of ACCOUNT
30918020042380658          TO WS-ACCOUNT-NO-FOR-RULE
309190200423           END-READ.
30920020042380658 *    IF  COUNTRY-CODE OF INVESTOR  NOT =  'CAN'
30921020042380658      IF  Lc_TaxCountryCode         NOT =  'CAN'
309220200423           AND WS-ACCOUNT-TYPE-RULE = "1"
309230200423               IF NOMINEE OF ACCOUNT = "Y"
309240200423                  PERFORM GET-ACCOUNT-NOMINEE
309250200423                  INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
309260200423                  MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-NOMINEE
309270200423                    TO ACCOUNT-TYPE-CODE OF ACCOUNT-TYPE
309280200423                  READ ACCOUNT-TYPE
309290200423                    INVALID KEY
309300200423                      INITIALIZE MFAACCTYP OF ACCOUNT-TYPE
309310200423                                 WS-ACCOUNT-TYPE-RULE-NOMINEE
309320200423                    NOT INVALID KEY
309330200423                      MOVE ACCOUNT-TYPE-RULE OF ACCOUNT-TYPE
309340200423                        TO WS-ACCOUNT-TYPE-RULE-NOMINEE
309350200423                  END-READ
309360200423               END-IF
309370200423               IF (NOMINEE OF ACCOUNT NOT = "Y" AND
309380200423                   WS-ACCOUNT-TYPE-RULE = "1")
309390200423               OR (NOMINEE OF ACCOUNT = "Y" AND
309400200423                   WS-ACCOUNT-TYPE-RULE-NOMINEE = "1")
309410200423                  MOVE "Y"  TO WS-NTAXREGSEL-CALC
309420200423                  IF SWITCH-OUT-TRANSACTION
309430200423                     PERFORM CHECK-TRANSFER-AT-COST
309440200423                  END-IF
309450200423               END-IF
309460200423           END-IF.
309470200423       CKREGSEL-EXIT.
309480200423           EXIT.
309490200423      ******************************************************************
309500200423      *    CALCULATE NON-RESIDENT TAX  T2062  ESTIMATE                 *
309510200423      ******************************************************************
309520200423       CALCULATE-NTAXT2062-EST SECTION.
309530200423       CAT2062E-0000.
309540200423           MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
309550200423             TO WS-WORK-TAX-RATE.
309560200423           IF TFR-AT-COST-OCCURS
309570200423              MOVE ZEROS  TO WS-EST-TAX
309580200423           ELSE
309590200423              IF AUC-UNIT-COST-OK
309600200423                 COMPUTE WS-BOOK-VALUE  ROUNDED =
309610200423                         WS-AUC-UNIT-COST * UNIT-AMT OF TRANS
309620200423                 COMPUTE WS-CAPITAL-GAIN  ROUNDED =
309630200423                         GROSS-AMT OF TRANS - WS-BOOK-VALUE
309640200423
309650200423                 IF WS-CAPITAL-GAIN > 0
309660200423136069             IF NOT (RDSP-ACCOUNT-RULE  AND
309670200423136069                WS-CURR-CONTR-REDEM-RULE-DAP)
309680200423                    COMPUTE WS-EST-TAX  ROUNDED =
309690200423                            WS-CAPITAL-GAIN * WS-WORK-TAX-RATE / 100
309700200423136069             ELSE
309710200423136069               PERFORM CALCULATE-RDSP-EST-TAX
309720200423136069             END-IF
309730200423                 ELSE
309740200423                    MOVE ZEROS  TO WS-EST-TAX
309750200423                 END-IF
309760200423              END-IF
309770200423           END-IF.
309780200423
309790200423       CAT2062E-EXIT.
309800200423           EXIT.
309810200423      ******************************************************************
309820200423      *    CALCULATE NON-RESIDENT TAX  T2062                           *
309830200423      ******************************************************************
309840200423       CALCULATE-NTAXT2062 SECTION.
309850200423       CAT2062-0000.
309860200423           MOVE ZEROS  TO WS-PROVINCIAL-TAX-AMOUNT.
309870200423           MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
309880200423             TO WS-FED-INCL-RATE-2.
309890200423
309900200423           IF TFR-AT-COST-OCCURS
309910200423              MOVE ZEROS  TO WS-FEDERAL-TAX-AMOUNT
309920200423           ELSE
309930200423              IF AUC-UNIT-COST-OK
309940200423                 COMPUTE WS-BOOK-VALUE  ROUNDED =
309950200423                         WS-AUC-UNIT-COST * UNIT-AMT OF TRANS
309960200423                 COMPUTE WS-CAPITAL-GAIN  ROUNDED =
309970200423                         GROSS-AMT OF TRANS - WS-BOOK-VALUE
309980200423
309990200423                 IF WS-CAPITAL-GAIN > 0
310000200423                    COMPUTE WS-FEDERAL-TAX-AMOUNT  ROUNDED =
310010200423                            WS-CAPITAL-GAIN *
310020200423                            FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
310030200423                            / 100
310040200423                 ELSE
310050200423                    MOVE ZEROS  TO WS-FEDERAL-TAX-AMOUNT
310060200423                 END-IF
310070200423              END-IF
310080200423           END-IF.
310090200423       CAT2062-EXIT.
310100200423           EXIT.
310110200423      ******************************************************************
310120200423      *    CALCULATE NON-RESIDENT TAX  REGSEL  ESTIMATE                *
310130200423      ******************************************************************
310140200423       CALCULATE-NTAXREGSEL-EST SECTION.
310150200423
310160200423       CAREGSELE-0000.
310170200423           MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
310180200423             TO WS-WORK-TAX-RATE.
310190200423
310200200423           IF TFR-AT-COST-OCCURS
310210200423              MOVE ZEROS  TO WS-EST-TAX
310220200423           ELSE
310230200423              COMPUTE WS-EST-TAX  ROUNDED =
310240200423                      WS-TAXABLE-AMOUNT * WS-WORK-TAX-RATE / 100
310250200423           END-IF.
310260200423
310270200423       CAREGSELE-EXIT.
310280200423           EXIT.
310290200423      ******************************************************************
310300200423      *    CALCULATE NON-RESIDENT TAX  REGSEL                          *
310310200423      ******************************************************************
310320200423       CALCULATE-NTAXREGSEL SECTION.
310330200423
310340200423       CAREGSEL-0000.
310350200423           MOVE ZEROS  TO WS-PROVINCIAL-TAX-AMOUNT.
310360200423
310370200423           MOVE FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX
310380200423             TO WS-FED-INCL-RATE-2.
310390200423
310400200423           IF TFR-AT-COST-OCCURS
310410200423              MOVE ZEROS  TO WS-FEDERAL-TAX-AMOUNT
310420200423           ELSE
310430200423              COMPUTE WS-FEDERAL-TAX-AMOUNT  ROUNDED =
310440200423                      WS-TAXABLE-AMOUNT *
310450200423                      FEDERAL-TAX-RATE OF COUNTRY-WITHHOLDING-TAX / 100
310460200423           END-IF.
310470200423
310480200423       CAREGSEL-EXIT.
310490200423           EXIT.
310500200423
310510200423      * RFS92482 - Start
310520200423       GET-ROC-RATE SECTION.
310530200423      *****************************************************************
310540200423      *    READ THE FILE INVESTMENT-ROC-RATES - MFAIVROCP
310550200423      *****************************************************************
310560200423       GRR-0000.
310570200423100957     INITIALIZE MFAIVROCP OF INVESTMENT-ROC-RATES-REC.
310580200423           MOVE INVESTMENT-CODE OF TRANS
310590200423                            TO INVESTMENT-CODE
310600200423                               OF INVESTMENT-ROC-RATES.
310610200423           MOVE TRADE-DATE OF TRANS
310620200423                            TO DISTR-PAYMENT-DATE
310630200423                               OF INVESTMENT-ROC-RATES.
310640200423           MOVE LOW-VALUES  TO ROC-TRANS-TYPE-CODE
310650200423                               OF INVESTMENT-ROC-RATES.
310660200423
310670200423           START INVESTMENT-ROC-RATES
310680200423             KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
310690200423             INVALID KEY
310700200423               MOVE "N"     TO lc_ROCFound
310710200423               GO TO GRR-EXIT
310720200423           END-START.
310730200423
310740200423       GRR-0001.
310750200423           READ INVESTMENT-ROC-RATES NEXT RECORD
310760200423100957*     INVALID KEY
310770200423100957*       MOVE "N"      TO lc_ROCFound
310780200423100957*       GO TO GRR-EXIT
310790200423100957*     NOT INVALID KEY
310800200423100957*       MOVE "Y"      TO lc_ROCFound
310810200423            AT END
310820200423100957        MOVE "N"      TO lc_ROCFound
310830200423              GO TO GRR-EXIT.
310840200423100957      IF INVESTMENT-CODE OF TRANS = INVESTMENT-CODE
310850200423100957                         OF INVESTMENT-ROC-RATES    AND
310860200423100957        TRADE-DATE OF TRANS = DISTR-PAYMENT-DATE
310870200423100957                         OF INVESTMENT-ROC-RATES
310880200423100957        MOVE "Y"      TO lc_ROCFound
310890200423100957      ELSE
310900200423100957        MOVE "N"     TO lc_ROCFound
310910200423100957        GO TO GRR-EXIT
310920200423100957      END-IF.
310930200423      *****************************************************************
310940200423      *    READ THE FILE ROC-TRANS-TYPES - MFAROCTTP
310950200423      *****************************************************************
310960200423       GRR-0002.
310970200423100957     INITIALIZE MFAROCTTP OF ROC-TRANS-TYPES-REC.
310980200423            IF  INVESTMENT-CODE OF INVESTMENT-ROC-RATES =
310990200423                INVESTMENT-CODE OF TRANS
311000200423            AND DISTR-PAYMENT-DATE OF INVESTMENT-ROC-RATES =
311010200423                TRADE-DATE OF TRANS
311020200423            AND ROC-ACTIVE OF INVESTMENT-ROC-RATES = "Y"
311030200423            AND lc_ROCFound = "Y"
311040200423                MOVE ROC-TRANS-TYPE-CODE OF INVESTMENT-ROC-RATES
311050200423                              TO ROC-TRANS-TYPE-CODE OF ROC-TRANS-TYPES
311060200423                MOVE TRANS-TYPE-CODE OF TRANS
311070200423                              TO TRANS-TYPE-CODE OF ROC-TRANS-TYPES
311080200423                MOVE "N"      TO lc_ROCFound
311090200423                READ ROC-TRANS-TYPES
311100200423                 INVALID KEY
311110200423                     MOVE "N" TO lc_ROCFound
311120200423                     GO TO GRR-0001
311130200423                 NOT INVALID KEY
311140200423                     MOVE "Y" TO lc_ROCFound
311150200423                END-READ
311160200423                IF  TRANS-TYPE-CODE OF ROC-TRANS-TYPES NOT =
311170200423                    TRANS-TYPE-CODE OF TRANS
311180200423                OR  DISTR-PAYMENT-DATE OF INVESTMENT-ROC-RATES NOT =
311190200423                    TRADE-DATE OF TRANS
311200200423                    MOVE "N"  TO lc_ROCFound
311210200423                    GO TO GRR-0001
311220200423                END-IF
311230200423            END-IF.
311240200423
311250200423       GRR-EXIT.
311260200423           EXIT.
311270200423      * RFS92482 - End
311280200423
311290200423      ******************************************************************
311300200423      *    GET AVERAGE UNIT COST                                       *
311310200423      ******************************************************************
311320200423       GET-AVERAGE-UNIT-COST SECTION.
311330200423
311340200423       GAUC-0000.
311350200423           IF WS-AUC-CALCULATED = "Y"
311360200423              GO TO GAUC-EXIT
311370200423           END-IF.
311380200423
311390200423           MOVE "Y"     TO WS-AUC-CALCULATED.
311400200423           MOVE SPACES  TO WS-AUC-UNIT-COST-OK.
311410200423
311420200423           MOVE PASS-PROCESS-DATE-9       TO WS-AUC-PROCESS-DATE.
311430200423           MOVE ACCOUNT-NO      OF TRANS  TO WS-AUC-ACCOUNT-NO.
311440200423           MOVE INVESTMENT-CODE OF TRANS  TO WS-AUC-INVESTMENT-CODE.
311450200423           MOVE ZEROS                     TO WS-AUC-UNIT-COST.
311460200423           MOVE SPACES                    TO WS-AUC-REJECTION-CODE.
311470200423
311480200423           CALL "AUCINQ" USING WS-AUC-PROCESS-DATE
311490200423                               WS-AUC-ACCOUNT-NO
311500200423                               WS-AUC-INVESTMENT-CODE
311510200423                               WS-AUC-UNIT-COST
311520200423                               WS-AUC-REJECTION-CODE.
311530200423
311540200423           IF WS-AUC-REJECTION-CODE  NOT =  SPACES
311550200423           OR WS-AUC-UNIT-COST  <=  0
311560200423              MOVE "N"  TO WS-AUC-UNIT-COST-OK
311570200423           ELSE
311580200423              MOVE "Y"  TO WS-AUC-UNIT-COST-OK
311590200423           END-IF.
311600200423
311610200423           IF WS-AUC-UNIT-COST-OK  NOT =  "Y"
311620200423              IF WS-AUC-REJECTION-CODE = SPACES  OR  "00"
311630200423                 MOVE "53"  TO REJECTION-CODE OF TRANS
311640200423              ELSE
311650200423                 MOVE WS-AUC-REJECTION-CODE  TO REJECTION-CODE OF TRANS
311660200423              END-IF
311670200423              GO TO GAUC-EXIT
311680200423           END-IF.
311690200423
311700200423       GAUC-EXIT.
311710200423           EXIT.
311720200423      *RFS24190 - Ends
311730200423
311740200423      * RFS31860 - Begin
311750200423       RECALC-LSIF-CLAW-PRICE SECTION.
311760200423
311770200423      * Recalculate LSIF-CLAW price based on original switch trade.
311780200423
311790200423           MOVE PLACEMENT-DATE OF WS-TBL-ARRAY(WS-TBL-ARRAY-CTR)  TO
311800200423                                    PLACEMENT-DATE OF TRANS-PRIMARY-2
311810200423           MOVE TRANS-NO OF WS-TBL-ARRAY(WS-TBL-ARRAY-CTR)        TO
311820200423                                    TRANS-NO OF TRANS-PRIMARY-2
311830200423           PERFORM READ-TRANS-PRIMARY-2
311840200423           IF SW-TEMP-OK        AND
311850200423              TRANS-TYPE-CODE OF TRANS-PRIMARY-2 = "SWI" OR "TRI"
311860200423             MOVE UNIT-PRICE OF TRANS-PRIMARY-2    TO WS-SWI-UNIT-PRICE
311870200423             MOVE PLACEMENT-DATE OF TRANS-PRIMARY-2 TO
311880200423                                    PLACEMENT-DATE-2 OF TRANS-TARGET-2
311890200423             MOVE TRANS-NO       OF TRANS-PRIMARY-2 TO
311900200423                                    TRANS-NO-2 OF TRANS-TARGET-2
311910200423             MOVE ZEROES         TO PLACEMENT-DATE OF TRANS-TARGET-2
311920200423                                     TRANS-NO OF TRANS-TARGET-2
311930200423             PERFORM START-TRANS-TARGET-2
311940200423             IF SW-TEMP-OK
311950200423               READ TRANS-TARGET-2 NEXT RECORD
311960200423               AT END
311970200423                 CONTINUE
311980200423               NOT AT END
311990200423                 IF PLACEMENT-DATE OF TRANS-PRIMARY-2 =
312000200423                             PLACEMENT-DATE-2 OF TRANS-TARGET-2 AND
312010200423                    TRANS-NO       OF TRANS-PRIMARY-2 =
312020200423                             TRANS-NO-2 OF TRANS-TARGET-2
312030200423                   MOVE PLACEMENT-DATE OF TRANS-TARGET-2 TO
312040200423                               PLACEMENT-DATE OF TRANS-PRIMARY-2
312050200423                   MOVE TRANS-NO       OF TRANS-TARGET-2 TO
312060200423                               TRANS-NO OF TRANS-PRIMARY-2
312070200423                   PERFORM READ-TRANS-PRIMARY-2
312080200423                   IF SW-TEMP-OK
312090200423                     MOVE UNIT-PRICE OF TRANS-PRIMARY-2  TO
312100200423                                                   WS-SWO-UNIT-PRICE
312110200423                     IF WS-SWO-UNIT-PRICE NOT = 0.0    AND
312120200423                        WS-SWI-UNIT-PRICE NOT = 0.0
312130200423                       COMPUTE WS-LSIF-CLAW-PRICE ROUNDED =
312140200423                          WS-LSIF-CLAW-PRICE * WS-SWI-UNIT-PRICE /
312150200423                                               WS-SWO-UNIT-PRICE
312160200423                     END-IF
312170200423                   END-IF
312180200423                END-IF
312190200423           END-READ.
312200200423       RLCP-EXIT.
312210200423           EXIT.
312220200423
312230200423       READ-TRANS-PRIMARY-2 SECTION.
312240200423           SET SW-TEMP-OK      TO TRUE
312250200423           READ TRANS-PRIMARY-2
312260200423             INVALID KEY
312270200423               SET SW-TEMP-FAIL    TO TRUE
312280200423           END-READ.
312290200423
312300200423       START-TRANS-TARGET-2 SECTION.
312310200423           SET SW-TEMP-OK      TO TRUE
312320200423           START TRANS-TARGET-2
312330200423                       KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
312340200423             INVALID KEY
312350200423               SET SW-TEMP-FAIL    TO TRUE
312360200423           END-START.
312370200423       STT2-EXIT.
312380200423           EXIT.
312390200423      * RFS31860 - End
312400200423      *RFS24192 - Begins
312410200423      ******************************************************************
312420200423      *    GENERATE NR TAX REDEMPTION TRANSACTION TO REDEEM UNITS      *
312430200423      ******************************************************************
312440200423       GENERATE-NR-TAX-SELL-TRANS SECTION.
312450200423       GNRS-0000.
312460200423
312470200423           MOVE WS-FEDERAL-TAX-AMOUNT  TO WS-NRR-FEDERAL-TAX-AMT.
312480200423           MOVE TRANS-REC              TO WS-NRR-DIST-TRANS
312490200423                                          WS-NRR-SEL-TRANS.
312500200423
312510200423           INITIALIZE        MFATRNTGP OF WS-NRR-TRANS-TARGET
312520200423                             MFATRNREP OF WS-NRR-TRANS-REDEM-DTLS
312530200423                             MFABCHHDP OF WS-NRR-BATCH-HDR-DTL
312540200423                                          WS-NNRDSTGN-NEW-BATCH-FLAG
312550200423                                          WS-NNRDSTGN-RETURN-CODE.
312560200423
312570200423           CALL "NNRDSTGN" USING WS-NRR-FEDERAL-TAX-AMT
312580200423                                 WS-NRR-SEL-TRANS
312590200423                                 WS-NRR-TRANS-TARGET
312600200423                                 WS-NRR-TRANS-REDEM-DTLS
312610200423                                 WS-NRR-BATCH-HDR-DTL
312620200423                                 WS-NNRDSTGN-NEW-BATCH-FLAG
312630200423                                 WS-NNRDSTGN-RETURN-CODE.
312640200423
312650200423      * Error creating NR Tax Redemption trans
312660200423           IF WS-NNRDSTGN-RETURN-CODE  NOT =  "00"
312670200423              MOVE PLACEMENT-DATE OF WS-NRR-DIST-TRANS
312680200423                TO DSP-PLACEMENT-DATE
312690200423              MOVE TRANS-NO       OF WS-NRR-DIST-TRANS
312700200423                TO DSP-TRANS-NO
312710200423              DISPLAY "@@@ DIST: "
312720200423                      DSP-PLACEMENT-DATE  " "
312730200423                      DSP-TRANS-NO " "
312740200423              MOVE PLACEMENT-DATE OF WS-NRR-SEL-TRANS
312750200423                TO DSP-PLACEMENT-DATE
312760200423              MOVE TRANS-NO       OF WS-NRR-SEL-TRANS
312770200423                TO DSP-TRANS-NO
312780200423              DISPLAY "@@@ NRR SEL: "
312790200423                      DSP-PLACEMENT-DATE  " "
312800200423                      DSP-TRANS-NO " "
312810200423              DISPLAY "@@@N1 NNRDSTGN RETURN: "
312820200423                      WS-NNRDSTGN-RETURN-CODE
312830200423           END-IF.
312840200423
312850200423      * If there was an error in creating the NR Tax Redemption trans,
312860200423      * then create a record in MFANDSEP file for the NR Tax Redemption
312870200423      * trans
312880200423           IF WS-NNRDSTGN-RETURN-CODE  NOT =  "00"
312890200423              PERFORM GENERATE-NR-TAX-SELL-ERROR
312900200423              GO TO GNRS-EXIT
312910200423           END-IF.
312920200423
312930200423      * Write TRANS, TRANS-TARGET, TRANS-REDEM-DETAILS for NR Tax
312940200423      * Redemption trans
312950200423
312960200423           MOVE WS-NRR-TRANS-TARGET
312970200423             TO TRANS-TARGET-REC.
312980200423           MOVE WS-NRR-TRANS-REDEM-DTLS
312990200423             TO TRANS-REDEM-DETAILS-REC.
313000200423
313010200423           INITIALIZE   WRITE-SWITCHES.
313020200423           MOVE "W"  TO WRITE-TRANS-TARGET
313030200423                        WRITE-TRANS-REDEM-DETAILS.
313040200423
313050200423           MOVE "2"  TO WS-NDSNRR-GENERATED.
313060200423           MOVE "Y"  TO WS-NDSNRR-NO-READ.
313070200423       GNRS-EXIT.
313080200423           EXIT.
313090200423      ******************************************************************
313100200423      *    GENERATE NR TAX REDEMPTION ERROR                            *
313110200423      ******************************************************************
313120200423       GENERATE-NR-TAX-SELL-ERROR SECTION.
313130200423
313140200423           INITIALIZE    MFANDSEP  OF NOTIONAL-DIST-NR-ERROR-REC
313150200423                         MFAREJCDP OF REJECTION-CODES.
313160200423           MOVE "N1"  TO REJECTION-CODE OF REJECTION-CODES.
313170200423
313180200423           READ REJECTION-CODES
313190200423             INVALID KEY
313200200423               INITIALIZE MFAREJCDP OF REJECTION-CODES
313210200423           END-READ.
313220200423
313230200423           MOVE PASS-PROCESS-DATE-9
313240200423             TO PROCESS-DATE       OF NOTIONAL-DIST-NR-ERROR.
313250200423           MOVE ACCOUNT-NO         OF WS-NRR-DIST-TRANS
313260200423             TO ACCOUNT-NO         OF NOTIONAL-DIST-NR-ERROR.
313270200423           MOVE INVESTMENT-CODE    OF WS-NRR-DIST-TRANS
313280200423             TO INVESTMENT-CODE    OF NOTIONAL-DIST-NR-ERROR.
313290200423           MOVE PLACEMENT-DATE     OF WS-NRR-DIST-TRANS
313300200423             TO PLACEMENT-DATE     OF NOTIONAL-DIST-NR-ERROR.
313310200423           MOVE TRANS-NO           OF WS-NRR-DIST-TRANS
313320200423             TO TRANS-NO           OF NOTIONAL-DIST-NR-ERROR.
313330200423           MOVE GROSS-AMT          OF WS-NRR-DIST-TRANS
313340200423             TO GROSS-AMT          OF NOTIONAL-DIST-NR-ERROR.
313350200423           MOVE TRANS-STATUS-CODE  OF WS-NRR-DIST-TRANS
313360200423             TO TRANS-STATUS-CODE  OF NOTIONAL-DIST-NR-ERROR.
313370200423           MOVE "N1"
313380200423             TO REJECTION-CODE     OF NOTIONAL-DIST-NR-ERROR.
313390200423           MOVE REJECTION-DESCR    OF REJECTION-CODES
313400200423             TO REJECTION-DESC     OF NOTIONAL-DIST-NR-ERROR.
313410200423
313420200423      * Write Notional Dist NR Error record
313430200423           WRITE NOTIONAL-DIST-NR-ERROR-REC
313440200423             INVALID KEY
313450200423               CONTINUE
313460200423           END-WRITE.
313470200423
313480200423           IF WS-FILE-STATUS  NOT =  "00"
313490200423              MOVE "NRTAX SEL ERROR" TO WS-FILE-STATUS-FILE-NAME
31350020042358714         SET lncc_Err167  TO  TRUE
313510200423              PERFORM LOG-FILE-STATUS
313520200423           END-IF.
313530200423
313540200423       GNRE-EXIT.
313550200423           EXIT.
313560200423      *RFS24192 - Ends
313570200423
313580200423R27609 CHK-AOT-REV SECTION.
313590200423R27609 CAR-0000.
313600200423R27609     MOVE PLACEMENT-DATE OF TRANS TO PLACEMENT-DATE OF TRNBKP-REC.
313610200423R27609     MOVE TRANS-NO       OF TRANS TO TRANS-NO       OF TRNBKP-REC.
313620200423R27609     READ TRANS-BROKER
313630200423R27609          INVALID KEY MOVE SPACES TO ACTION-CODE    OF TRNBKP-REC
313640200423R27609     END-READ.
313650200423
313660200423R27609     IF ACTION-CODE OF TRNBKP-REC = "AOT" OR "REV"
313670200423R27609        MOVE "Y" TO EC-WOR-FLAG
313680200423R27609     END-IF.
313690200423
313700200423R27609 CAR-EXIT.
313710200423R27609     EXIT.
313720200423      * ------------------------------*
313730200423      * RFS32479 Begins               *
313740200423      * Two new subroutines added  to *
313750200423      * avoid the code redundancy     *
313760200423      * ------------------------------*
313770200423       START-INV-LSIF-JUR-RECS SECTION.
313780200423       START-INV-LSIF-JUR-RECS-0000.
313790200423
313800200423           MOVE lc-InvCode TO                                            RFS9932
313810200423                INVESTMENT-CODE OF INVESTMENT-LSIF-JURISDICTIONS.
313820200423           MOVE "CAN"
313830200423           TO   COUNTRY-CODE    OF INVESTMENT-LSIF-JURISDICTIONS.
313840200423           MOVE lc-ProCode
313850200423           TO   PROVINCE-CODE   OF INVESTMENT-LSIF-JURISDICTIONS.
313860200423           MOVE ZEROES
313870200423           TO START-DATE        OF INVESTMENT-LSIF-JURISDICTIONS.
313880200423
313890200423           MOVE " "         TO lc-JurExist.
313900200423           START INVESTMENT-LSIF-JURISDICTIONS
313910200423           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
313920200423           INVALID KEY
313930200423               MOVE "N"         TO lc-JurExist
313940200423           END-START.
313950200423
313960200423       START-INV-LSIF-JUR-RECS-EXIT.
313970200423           EXIT.
313980200423
313990200423       CHECK-INV-LSIF-JUR-RECS SECTION.
314000200423       CHECK-INV-LSIF-JUR-RECS-0000.
314010200423
314020200423           MOVE " "   TO lc-ChkFail.
314030200423           IF (INVESTMENT-CODE OF INVESTMENT-LSIF-JURISDICTIONS NOT =
314040200423                lc-InvCode)
314050200423           OR (COUNTRY-CODE    OF INVESTMENT-LSIF-JURISDICTIONS NOT =
314060200423              "CAN")
314070200423           OR (PROVINCE-CODE   OF INVESTMENT-LSIF-JURISDICTIONS NOT =
314080200423                lc-ProCode)
314090200423           OR (START-DATE      OF INVESTMENT-LSIF-JURISDICTIONS >
314100200423           CONTRIBUTION-DATE   OF WS-TBL-ARRAY(WS-TBL-ARRAY-CTR))
314110200423           OR (END-DATE        OF INVESTMENT-LSIF-JURISDICTIONS <
314120200423           CONTRIBUTION-DATE   OF WS-TBL-ARRAY(WS-TBL-ARRAY-CTR))
314130200423               MOVE "Y"   TO lc-ChkFail
314140200423           END-IF.
314150200423       CHECK-INV-LSIF-JUR-RECS-EXIT.
314160200423           EXIT.
314170200423      * ------------------------------*
314180200423      * RFS32479 Ends                 *
314190200423      * ----------------*
314200200423      * RFS33712 Begins *
314210200423      * ----------------*
314220200423       Get-ERF-Schedule-Code SECTION.
314230200423
314240200423       Get-ERF-Schedule-Code-0000.
314250200423
314260200423           MOVE lnc-No TO lc-Notfound.
314270200423           READ INVESTMENT-ERF-SCHEDULE
314280200423             INVALID KEY
314290200423             MOVE "INV ERF SCHEDULE" TO WS-FILE-STATUS-FILE-NAME
31430020042358714          PERFORM LOG-FILE-STATUS-RD
314310200423               DISPLAY "@@@ No INVESTMENT-ERF-SCHEDULE"
314320200423               MOVE lnc-Yes TO lc-Notfound
314330200423           END-READ.
314340200423       Get-ERF-Schedule-Code-EXIT.
314350200423           EXIT.
314360200423      *---
314370200423       Get-ERF-Schedule SECTION.
314380200423
314390200423       Get-ERF-Schedule-0000.
314400200423
314410200423           MOVE lnc-No TO lc-Notfound.
314420200423           READ ERF-SCHEDULE
314430200423           INVALID KEY
314440200423             MOVE ZEROES     TO WS-ERF-CHARGE
314450200423             DISPLAY "@@@ No ERF schedule"
314460200423             MOVE lnc-Yes TO lc-Notfound
314470200423           END-READ.
314480200423
314490200423       Get-ERF-Schedule-EXIT.
314500200423           EXIT.
314510200423      * RFS33712 Ends   *
314520200423      * ---------------------------------
314530200423       calc-bonus-commission SECTION.
314540200423      * ---------------------------------
314550200423
314560200423            IF COMM-BONUS-SOURCE OF DEALER-COMMISSIONS =
314570200423                                                LT-BONUS-SOURCE-U
314580200423              COMPUTE ln_BonusComm ROUNDED =
314590200423                  WS-CDSC-AMOUNT
314600200423                * COMM-BONUS-RATE OF DEALER-COMMISSIONS / 100.00
314610200423            ELSE
314620200423              COMPUTE ln_BonusComm = 0.0
314630200423            END-IF
314640200423
314650200423            MOVE placement-date OF trans                 TO
314660200423                 placement-date OF lfh_clawbackBonusCommRec
314670200423            MOVE trans-no OF trans                       TO
314680200423                 trans-no OF lfh_clawbackBonusCommRec
314690200423
314700200423            MOVE WS-CDSC-AMOUNT                          TO
314710200423                 DSC-AMT OF lfh_clawbackBonusCommRec
314720200423
314730200423            IF COMM-BONUS-SOURCE OF DEALER-COMMISSIONS =
314740200423                                                LT-BONUS-SOURCE-U
314750200423              MOVE COMM-BONUS-RATE OF DEALER-COMMISSIONS TO
314760200423                        COMM-BONUS-RATE OF lfh_clawbackBonusCommRec
314770200423            ELSE
314780200423              MOVE 0 TO  COMM-BONUS-RATE OF lfh_clawbackBonusCommRec
314790200423            END-IF
314800200423
314810200423            MOVE ln_BonusComm                            TO
314820200423                 BONUS-AMT OF lfh_clawbackBonusCommRec
314830200423
314840200423            SET lncc_writeRewBonusComm TO TRUE
314850200423      * Update CDSC amount and commission amount
314860200423            COMPUTE WS-CDSC-AMOUNT = WS-CDSC-AMOUNT + ln_BonusComm
314870200423            MOVE WS-CDSC-AMOUNT TO COMM-AMT OF TRANS-COMMISSION
314880200423                                   COMM-PAYABLE OF TRANS-COMMISSION
314890200423           .
314900200423      *RFS33578 - Begins
314910200423166873*       CALL-FXTAXPRP.
314920200423166873 CALL-FXTAXPRP SECTION.
314930200423           SET lb_QcWhTaxFunctionNo   TO TRUE
314940200423           IF lb_EditCodeAcwtaxYes
314950200423      * RFS166873 - Start: Moved code to seperate Section and
314960200423      *   added code to use Freq code and awd status.
314970200423      * -------------------------------------------------------------
314980200423      *      MOVE lnc_CAL                   TO pc_FxtaxprpMode
314990200423      *      MOVE INVESTOR-NO OF INVESTOR   TO pi_FxtaxprpIvrNo
315000200423      *      MOVE ACCOUNT-NO  OF ACCOUNT    TO pi_FxtaxprpAcctNo
315010200423      *      INITIALIZE pc_FxtaxprpAwdFreq
315020200423      *                 pc_FxtaxprpAwdStatus
315030200423      *                 pn_FxtaxprpProvTaxRate
315040200423      *                 pn_FxtaxprpProvWHTaxAmt
315050200423      *                 pc_FxtaxprpRtnCd
315060200423      *      CALL "FXTAXPRP" USING pc_FxtaxprpMode
315070200423      *                            pi_FxtaxprpIvrNo
315080200423      *                            pi_FxtaxprpAcctNo
315090200423      *                            pc_FxtaxprpIvrTaxCountry
315100200423      *                            pc_FxtaxprpIvrTaxProv
315110200423      *                            pc_FxtaxprpAcctType
315120200423      *                            pc_FxtaxprpContrRedemCd
315130200423      *                            pc_FxtaxprpAwdFreq
315140200423      *                            pn_FxtaxprpAwdAmount
315150200423      *                            pc_FxtaxprpAwdStatus
315160200423      *                            pi_FxtaxprpPlacementDate
315170200423      *                            pi_FxtaxprpTransNo
315180200423      *                            pn_FxtaxprpProvTaxRate
315190200423      *                            pn_FxtaxprpProvWHTaxAmt
315200200423      *                            pc_FxtaxprpRtnCd
315210200423      * -------------------------------------------------------------
315220200423             IF PASS-AWD-FREQ-CODE NOT = SPACES AND
315230200423                PASS-AWD-STATUS    NOT = SPACES
315240200423                 MOVE PASS-AWD-FREQ-CODE TO pc_FxtaxprpAwdFreq
315250200423                 MOVE PASS-AWD-STATUS    TO pc_FxtaxprpAwdStatus
315260200423             ELSE
315270200423                 INITIALIZE pc_FxtaxprpAwdFreq
315280200423                            pc_FxtaxprpAwdStatus
315290200423             END-IF
315300200423             PERFORM CALL-FXTAXPRP-0
315310200423      * RFS166873 - End
315320200423             IF pc_FxtaxprpRtnCd = "00"
315330200423                MOVE pn_FxtaxprpProvTaxRate
315340200423                  TO ln_QcWhTxAwdProvTaxRate
315350200423                SET lb_QcWhTaxFunctionYes  TO TRUE
315360200423             END-IF
315370200423           END-IF
315380200423           .
315390200423      *RFS33578 - Ends
315400200423      * RFS166873 - Start: Moved code to seperate Section
315410200423      * -----------------------------------------
315420200423        CALL-FXTAXPRP-0 SECTION.
315430200423      * -----------------------------------------
315440200423             MOVE lnc_CAL                   TO pc_FxtaxprpMode
315450200423             MOVE INVESTOR-NO OF INVESTOR   TO pi_FxtaxprpIvrNo
315460200423             MOVE ACCOUNT-NO  OF ACCOUNT    TO pi_FxtaxprpAcctNo
315470200423             INITIALIZE pn_FxtaxprpProvTaxRate
315480200423                        pn_FxtaxprpProvWHTaxAmt
315490200423                        pc_FxtaxprpRtnCd
315500200423             CALL "FXTAXPRP" USING pc_FxtaxprpMode
315510200423                                   pi_FxtaxprpIvrNo
315520200423                                   pi_FxtaxprpAcctNo
315530200423                                   pc_FxtaxprpIvrTaxCountry
315540200423                                   pc_FxtaxprpIvrTaxProv
315550200423                                   pc_FxtaxprpAcctType
315560200423                                   pc_FxtaxprpContrRedemCd
315570200423                                   pc_FxtaxprpAwdFreq
315580200423                                   pn_FxtaxprpAwdAmount
315590200423                                   pc_FxtaxprpAwdStatus
315600200423                                   pi_FxtaxprpPlacementDate
315610200423                                   pi_FxtaxprpTransNo
315620200423                                   pn_FxtaxprpProvTaxRate
315630200423                                   pn_FxtaxprpProvWHTaxAmt
315640200423                                   pc_FxtaxprpRtnCd.
315650200423      * RFS166873 - End
315660200423      *RFS72268 Starts
315670200423      *---------------------
315680200423       closeOpenedCondFiles SECTION.
315690200423
315700200423       closeOpenedFiles_P1.
315710200423           CLOSE           ASSET-ALLOCATION-HEADER
315720200423                           ACCOUNT-ASSIGNMENT-PAC
315730200423                           BANK-ACCOUNT
315740200423                           BANK
315750200423                           BANK-SCHEDULE
315760200423                           TRANS-PAY-TO-BANK
315770200423                           TRANS-CHARGES
315780200423                           TRANS-EXCHANGE-RATE
315790200423                           TRANS-COMMISSION
315800200423                           TRANS-DISTR-DETAILS
315810200423                           TRANS-INTEREST-DETAILS
315820200423                           TRANS-ASSIGNMENT
31583020042334309                      TRANS-RESP-DETAILS
31584020042334309                      ACCOUNT-BENEFICIARY-SPLIT
31585020042334309                      ACCOUNT-BENEFICIARY
31586020042334309                      ADDRESS-DDS
31587020042334309                      TRANS-DIST-CNTRY-CODE
315880200423      *RFS 14380 Begin
315890200423                           TRANS-ERF-PURCHASE
315900200423                           TRANS-ERF-PURCHASE-PRIMARY
315910200423                           TRANS-ERF-SELL
315920200423                           INVESTMENT-ERF-SCHEDULE
315930200423                           EARLY-REDEMPTION-FEE-SCHEDULE
315940200423                           ERF-SCHEDULE
315950200423R29134                     ERF-SCHEDULE-2
315960200423R29134                     INVESTMENT-ERF-SCHEDULE-2
315970200423                           TRANS-REDEMPTION-DETAILS
315980200423143489                     INVESTOR-ATTRIBUTES
315990200423R30134                     Trans-Trade-Codes
316000200423      *RFS 14380 End
316010200423      *RFS 18568 Begin
316020200423                           INVESTMENT-DISTRIB-CHEQUE
316030200423                           INVESTMENT-DISTRIB-EFT
316040200423                           INVESTMENT-DISTRIB-DETAILS
316050200423                           PAYMENT-TYPE-CODES
316060200423                           TRANS-PAY-TO-CHEQUE
316070200423                           TRANS-PAY-TO-BANK-2
316080200423      *RFS 18568 End
316090200423      *RFS 23020 Begin
316100200423                           ACCOUNT-INVESTMENT-DSRP
316110200423      * RFS50832           ACCOUNT-INVESTMENT-SRCH
316120200423      *RFS 23020 End
316130200423                           TRANS-BUY-LSIF
316140200423                           TRANS-BUY-LSIF-CHK
316150200423                           ACCOUNT-INV-ACCRUALS
316160200423      * RFS50832           ACCOUNT-INVESTMENT
316170200423                           ACCOUNT-INVESTMENT-PROC-COUNT
316180200423177665                     INVESTMENT-STRUCTURE-FUNCTION
316190200423                           ACCT-INVEST-ACCUM-DIST
316200200423      * RFS50832 (comment) TRANS-CDSC-PURCHASE
316210200423      * RFS50832 (comment) TRANS-CDSC-PUR-PRIMARY
316220200423                           TRANS-CDSC-ORIGINAL-DETAILS                  RFS10608
316230200423      * RFS50832 (comment) TRANS-CDSC-PURCH-REDUCTION
316240200423                           TRANS-OLD-CDSC-REDUCTION
316250200423                           TRANS-COMMISSION-2
316260200423                           BATCH-HEADER
316270200423      * RFS51753 - Begin
316280200423                           BATCH-HEADER-RD
316290200423      * RFS51753 - End
316300200423125258*                    TRANS
316310200423R27609                     TRANS-BROKER
316320200423                           CONTROL-FILE
316330200423                           TRANS-WO-LOCATOR
316340200423                           ACCOUNT-ASSIGNMENT-PRIMARY
316350200423                           INVESTOR
316360200423                           ACCOUNT
316370200423      *RFS 15658 Begins
316380200423                           ACCOUNT-2
316390200423      *RFS 15658 Ends
316400200423                           ACCOUNT-NOMINEE
316410200423                           ACCOUNT-ASSIGNMENT
316420200423                           ACCOUNT-ASSIGNMENT-D
316430200423                           INVESTMENT
316440200423      * RFS112133 begin
316450200423                           INVESTMENT-MISC-DETAIL
316460200423                           PRODUCT-TYPE-CODES-2A
316470200423      * RFS112133 end
316480200423      *RFS1008937 - Starts
316490200423                           INVESTMENT-MANAGEMENT-SCHEDULE
316500200423      *RFS1008937 - Ends
316510200423      *RFS 15658 Begins
316520200423                           INVESTMENT-2
316530200423      *RFS 15658 Ends
316540200423                           INVESTMENT-NOTIONAL-DIST-DTLS
316550200423                           INVESTMENT-SWITCHES-CONTROL
316560200423                           INVESTMENT-CDSC-CALC-RULES
316570200423                           INVESTMENT-GROUP
316580200423125258*                    TRANS-PRIMARY
316590200423                           TRANS-DAILY-PROC-SEQ
316600200423                           TRANS-TARGET
316610200423                           TRANS-TARGET-2
316620200423      * RFS 13829 Begin
316630200423                           TRANS-TARGET-3
316640200423      * RFS 13829 End
316650200423                           TRANS-TARGET-SPOT-RATE
316660200423      * RFS50832           TRANS-CDSC-PUR-DIST
316670200423                           TRANS-REDEM-DETAILS
316680200423                           CDSC-REDEM-RATE-SCHEDULE
316690200423                           CDSC-SCHEDULE-OLD
316700200423                           COMM-SPONSOR-RATE-SCHED
316710200423                           COUNTRY-WITHHOLDING-TAX
316720200423                           EXCHANGE-RATE-HISTORY
316730200423                           INVESTMENT-UNIT-PRICE
316740200423                           DEALER
316750200423      *RFS20311 Start
316760200423                           DEALER-REP
316770200423      *RFS20311 End
316780200423                           DEALER-STATUS
316790200423                           INVESTMENT-FINANCER
316800200423                           FINANCER-SCHED
316810200423                           FINANCER-SCHED-2
316820200423                           FINANCER-FINANCER-SCHEDULE
316830200423                           FINANCER-SUB-ADVISOR
316840200423                           FINANCER-CDSC-INSTRUCTIONS
316850200423      * RFS50832           TRANS-CDSC-CLOCK-PRIMARY
316860200423      * RFS50832           TRANS-CDSC-CLOCK
316870200423125258*                    TRANS-PRIMARY-2
316880200423                           TRANS-ASSET-ALLOC-HEADER
316890200423                           TRANS-ALLOCATION-POINTER
316900200423                           TRANS-ALLOCATION-POINTER-A
316910200423      * RFS50832           TRANS-ADDITIONAL-TAX
316920200423                           PRODUCT-TYPE-CODES
316930200423      *RFS 15658 Begins
316940200423                           PRODUCT-TYPE-CODES-2
316950200423      *RFS 15658 Ends
316960200423                           DISCOUNT-ACCRUAL-RATES
316970200423                           INVESTMENT-DAF-RATE
316980200423                           BUSINESS-DAYS
316990200423                           PROGRAM-EXCHANGE-RATE
317000200423                           TRANS-LSIF-WAIVE-CLAWBACK
317010200423      *RFS 16760 Begin (Remove old versions of LSIF files)
317020200423      *                    LSIF-WAIVE-CLAWBACK-DFT
317030200423      *                    LSIF-WAIVE-CLAWBACK
317040200423      *                    LSIF-TAX-CREDIT-FACTORS
317050200423                           LSIF-CLAWBACK-CODES-DFT
317060200423                           LSIF-CLAWBACK-CODES
317070200423                           LSIF-TAX-CREDIT-PARMS
317080200423                           INVESTMENT-LSIF-JURISDICTIONS
317090200423                           TRANS-BUY-LSIF2
317100200423      *RFS 16760 End
317110200423      * RFS16590 Start
317120200423                           TRANS-SELL-LSIF-IDX2
317130200423      * RFS16590 End
317140200423                           TRANS-CONTRACT-DETAILS
317150200423                           ACCOUNT-CONTRACT
317160200423                           ACCOUNT-CONTRACT-INVESTMENT
317170200423      *RFS 13306 BEGIN
317180200423                           TRANS2
317190200423                           ACCOUNT2
317200200423                           ACCOUNT-NOMINEE2
317210200423                           ACCOUNT-CONTRACT2
317220200423                           TRANS-CONTRACT-DETAILS2
317230200423      *RFS 13306 END
317240200423                           DEPOSIT-MAT-LEN-SCHED
317250200423                           CONTRACT-STATUS-SCHED
317260200423                           INVESTMENT-SEG
317270200423                           ACCOUNT-CONT-AGE
317280200423                           DEALER-MISC-DETAILS
317290200423      *RFS 7947 BEGIN
317300200423                           DEALER-PROV-LICENSE
317310200423      *RFS 7947 END
317320200423                           DEALER-REP-PROV-LICENSE
317330200423                           NOMINEE-MISC-DETAILS
317340200423                           NOMINEE-FILE
317350200423                           ACCOUNT-CONTRACT-ANNUITANT
317360200423                           ACCOUNT-ANNUITANT-DEFAULT
317370200423                           CONTRACT-MATURITY-AGE
317380200423                           ACCT-INVEST-REDFEE-BASIS-AMT
317390200423                           TRANS-REDFEE-DEP-XFR
317400200423                           TRANS-REDFEE-CALC-DETAILS
317410200423                           INVESTMENT-REDEM-FEE-SCHED
317420200423                           REDEM-FEE-RATE-SCHED-DTL
317430200423                           REDEM-FEE-RATE-SCHED-HEADER
317440200423      *GIC MOD
317450200423                           BATCH-TYPE-CODES
317460200423                           REJECTION-CODES
317470200423                           GIC-CERTIFICATE-DETAILS
317480200423                           GIC-TRANS-RELATIONSHIP
317490200423                           GIC-TRANS-RELATIONSHIP-PRIMARY
317500200423                           TRANS-GIC-REDEMPTION-DETAILS
317510200423125258*                    TRANS-GIC-CHK
317520200423                           GIC-INT-ADJUST-REASON-DETAILS
317530200423      * RFS40418 - Begin
317540200423                           GIC-INT-ADJUST-REASON-DETUPD
317550200423      * RFS40418 - End
317560200423113773                     INVESTMENT-GIC-DETAILS
317570200423                           ACCOUNT-INV-REGISTERED
317580200423                           ACCOUNT-FINANCIAL-TOTALS
317590200423                           SCREEN-EDITS-ALLOWED
317600200423      *END GIC MOD
317610200423      *RFS 9092 BEGIN
317620200423      * RFS50832           ACCOUNT-INVESTMENT2
317630200423                           INVESTMENT-STRUCTURE-XREF
317640200423117763                     INVESTMENT-STRUCT-XREF-STR
317650200423      *RFS 9092 END
317660200423      *RFS 4637 START
317670200423                           ACCOUNT-CONTRACT-INV-DIST-BAL
317680200423                           ACCOUNT-CONTRACT-INV-DIST-BAL2
317690200423                           ACCOUNT-CONTRACT-INV-DIST-BAL3
317700200423                           ACCOUNT-CONTRACT-INVESTMENT2
317710200423      *RFS 4637 END
317720200423      *RFS 13306 BEGIN
317730200423125258*                    TRANS2
317740200423                           ACCOUNT2
317750200423                           ACCOUNT-NOMINEE2
317760200423                           ACCOUNT-CONTRACT2
317770200423                           TRANS-CONTRACT-DETAILS2
317780200423      *RFS 13306 END
317790200423      *RFS 9859 START
317800200423                           FUNCTION-INV-STRUCTURE-XREF
317810200423      *RFS 9859 END
317820200423      *RFS 7390 START
317830200423                           CONTR-REDEM-CODE-RULES
317840200423      *RFS 7390 END
317850200423      *RFS 8058
317860200423                           INVESTMENT2
317870200423                           INVESTMENT-LAST-UNIT-PRICE
317880200423      * RFS50832 - Begin
317890200423      *                    TRANS-CDSC-PUR-SUBDTLS
317900200423      *                    TRANS-CDSC-RED-SUBDTLS
317910200423      *                    TRANS-ACCOUNT-LV-DS-DTLS
317920200423      *                    ACCOUNT-LEVEL-FREE
317930200423      * RFS50832 - End
317940200423                           ACCOUNT-TYPE-PERCENT-FREE
317950200423                           FINANCER-PERCENT-FREE
317960200423                           INVESTMENT-UNIT-PRICE2
317970200423125258*                    TRANS-VALUE-LOOKUP
317980200423      *RFS 8058 END
317990200423      *RFS 8066 BEGIN
318000200423      * RFS50832           ACCOUNT-LV-QUALIFIED
318010200423      *RFS 8066 END
318020200423      *RFS 7721 BEGIN
318030200423                           ACCOUNT-INV-SWITCH-COUNTER
318040200423                           ACCOUNT-INV-SWO-COUNTER-TRANS
318050200423                           ALLOWABLE-SWO-LIMIT-CODES
318060200423                           INVESTMENT-STR-ALLW-SWO-LIMIT
318070200423                           ACCT-INV-SWO-CNTER-HIGHEST
318080200423      *RFS 7721 END
318090200423      * RFS 12261 BEGIN
318100200423      * RFS20711 - Begin
318110200423      * ---------------------------------
318120200423      *                    GIC-TRANS-FILE
318130200423      *                    GIC-TRANS-RELT-FILE
318140200423      * ---------------------------------
318150200423      * RFS20711 - End
318160200423      * RFS 12261 END
318170200423      *RFS 10575 BEGIN
318180200423                           ACCOUNT-RRIF
318190200423                           ACCOUNT-LIF
318200200423                           ACCOUNT-TYPE
318210200423      * RFS52816 - Begin
318220200423                           ACCOUNT-TYPE-NOMINEE
318230200423      * RFS52816 - End
318240200423                           TRANS-DIST-COUNTRY-CODES
318250200423      *RFS 10575 END
318260200423      *RFS 10826 BEGIN
318270200423                           REVERSAL-REASON
318280200423      *RFS 10826 END
318290200423      * RFS10040 - Begin
318300200423                           TRANS-COMMISSION
318310200423      * RFS10040 - End
318320200423      * RFS16941 - Begin
318330200423                           TRANS-ENV-REDEM-XREF
318340200423                           TRANS-ENV-PURCH-XREF
318350200423      * RFS16941 - End
318360200423      * RFS13306 - Begin
318370200423                           SEG-SWITCH-TRF-OPT
318380200423                           TRANS-CONTRACT-TARGET
318390200423      * RFS13306 - End
318400200423      * RFS16941 - Begin
318410200423                           TRANSFER-VALID-ENVIRONMENTS
318420200423      * RFS16941 - End
31843020042326151                      EXCLUDE-TRANS
318440200423      * RFS25997 - Begin
318450200423                           TRANS-LLP-MAX-EXCEED
318460200423      * RFS25997 - End
318470200423R24191                     TRANS-INCLUSION-RATE
318480200423R24191                     COUNTRY-TAX
318490200423R24190                     TRANS-UNIT-COST
318500200423R24190                     ACCTYP-CONTRED-TXNTYP-TAXEV
318510200423R45781                     TRANS-MISC-DETAILS
318520200423R45781                     INVESTMENT-PLAN-TRANS-MIN
318530200423R59853                     ACCOUNT-ATTRIBUTES
318540200423138805                     TERM-DEPOSIT-TRANSACTIONS
318550200423138805                     TERM-DEPOSIT-INSTRUCTIONS
318560200423      * RFS32873 - Begin
318570200423                           clawbackBonusComm
318580200423      * RFS32873 - End
318590200423      * RFS20265 - Begin
318600200423                           LSIF-TAX-CREDIT-PARMS-2
318610200423                           FORMS-TRANS-XREF
318620200423                           ACCOUNT-ISSUED-FORMS
318630200423                           LSIF-TAX-CREDITS-ALLOWED
31864020042344930                      GUARANTEED-DEATH-VALUE-SCHED
31865020042344930                      TRANS-ANNUITANT-AGE-LIMIT
318660200423                           FORM-REQUEST
318670200423                           FORM-REQUEST-CONTR-REDEM
318680200423      *RFS 68035 - Begin
318690200423125258*                    TRANS-RDSP-REPAY
31870020042384456 *                    TRANS-HEADER
318710200423                           TRANS-RDSP-APPROVAL
318720200423                           TRANS-HEADER-2
318730200423      *RFS 68035 - End
318740200423      * RFS114393 - Begin: added statement to close the file
318750200423                           INVESTMENT-LINK-NOTES
318760200423      * RFS114393 - End
318770200423125258*                    TRANS-MFR
318780200423140269                     SORTED-GTR
31879020042392145                      TRANS-TARGET-MFR
318800200423102122                     FEE-EXCLUSIONS
31881020042352265                      TRANS-TYPE-EXEMPTION-RULES
318820200423106558                     ACCOUNT-LOAN-PRIMARY
318830200423      * RFS138945 - Start
31884020042384063 *                    ACCOUNT-FEE-ACCRUAL.
318850200423                           ACCOUNT-FEE-ACCRUAL
318860200423166267*                    INVESTMENT-DOLLAR-TRACK.
318870200423166267                     INVESTMENT-DOLLAR-TRACK
318880200426      * RFS185169 - Starts
318890200426                           ACCOUNT-BENEFITS
318900200814186430*                    ACCOUNT-BENEFITS1
318910200426      * RFS185169 - Ends
318920200423166267                     INVESTMENT-SERIESID.
318930200423      * RFS138945 - End
318940200423      *RFS72268 Ends
318950200423      * RFS44202 Begins *
318960200423R59853*Calc-Inv-Return-Relq SECTION.
318970200423  |
318980200423  |   *    MOVE Account-No of TRANS
318990200423  |   *      TO Pass-Account-No-LIF.
319000200423  |   *    INITIALIZE Pass-Return-Code-LIF.
319010200423  |   *    CALL "JOBLIFCAL" USING Pass-LIF-R.
319020200423  |
319030200423  |   *    IF Pass-Return-Code-Char = "99"
319040200423  |   *       DISPLAY "Inv returns reliqnushed calc. failed"
319050200423R59853*    END-IF.
319060200423      * RFS44202 Ends   *
319070200423R59853 Update-Account-Lif SECTION.
319080200423  |
319090200423      * RFS108383 - Starts - add back 84339
319100200423  |   *    INITIALIZE MFAACCATP OF ACCOUNT-ATTRIBUTES-REC
319110200423  |   *    MOVE ACCOUNT-NO OF TRANS
319120200423  |   *      TO ACCOUNT-NO OF ACCOUNT-ATTRIBUTES
319130200423  |   *    MOVE "OLDLF"
319140200423  |   *      TO ACCOUNT-ATTRIBUTE-CODE OF ACCOUNT-ATTRIBUTES
319150200423  |   *    READ ACCOUNT-ATTRIBUTES
319160200423  |   *    INVALID KEY
319170200423      * RFS108383 - Ends
319180200423  |           INITIALIZE MFAACLIFP OF ACCOUNT-LIF-REC
319190200423  |           MOVE ACCOUNT-NO OF TRANS
319200200423  |             TO ACCOUNT-NO OF ACCOUNT-LIF
319210200423  |           READ ACCOUNT-LIF
319220200423  |           INVALID KEY
319230200423  |              INITIALIZE MFAACLIFP OF ACCOUNT-LIF-REC
319240200423  |           NOT INVALID KEY
319250200423  |              COMPUTE INVESTMENT-RETURN-RECV OF ACCOUNT-LIF =
319260200423  |                      INVESTMENT-RETURN-RECV OF ACCOUNT-LIF +
319270200423  |                      INVESTMENT-RETURN OF TRANS-MISC-DETAILS
319280200423  |              END-COMPUTE
319290200423  |              REWRITE ACCOUNT-LIF-REC
319300200423  |              INVALID KEY
319310200423  |                 MOVE "MFAACLIFP" TO WS-FILE-STATUS-FILE-NAME
319320200423  |                 SET lncc_Err168  TO  TRUE
319330200423  |                 PERFORM LOG-FILE-STATUS
319340200423  |              END-REWRITE
319350200423108383        END-READ.
319360200423R59853*    END-READ.                                                    R108383
319370200423
319380200423R59853*Update-Account-Lif-Buy SECTION.                                  R73715
319390200423R73715 Upd-Inv-Return-Recv SECTION.
319400200423  |
319410200423  |        INITIALIZE MFATRNMSCP OF TRANS-MISC-DETAILS-REC.
319420200423  |        MOVE PLACEMENT-DATE OF TRANS
319430200423  |          TO PLACEMENT-DATE OF TRANS-MISC-DETAILS.
319440200423  |        MOVE TRANS-NO OF TRANS TO TRANS-NO OF TRANS-MISC-DETAILS.
319450200423  |        READ TRANS-MISC-DETAILS
319460200423  |        INVALID KEY
319470200423  |            INITIALIZE INVESTMENT-RETURN OF TRANS-MISC-DETAILS
319480200423  |        NOT INVALID KEY
319490200423  |            IF INVESTMENT-RETURN OF TRANS-MISC-DETAILS NOT = 0
319500200423  |               PERFORM Update-Account-Lif
319510200423  |            END-IF
319520200423R59853     END-READ.
319530200423
319540200423      *RFS61637 - Start
319550200423      *--------------------------------
319560200423R59583*GET-RRIF-MIN-WITHDRAWAL.
319570200423R59583 GET-RRIF-MIN-WITHDRAWAL SECTION.
319580200423      * RFS80602 - Begin: modified the section towrok for LIFs Accounts
319590200423           INITIALIZE  ln_MinWithdrawalAmt
319600200423           IF LIF-ACCOUNT
319610200423             MOVE ACCOUNT-NO OF TRANS  TO ACCOUNT-NO OF ACCOUNT-LIF
319620200423             READ ACCOUNT-LIF
319630200423              INVALID KEY
319640200423                 MOVE ZERO         TO Min-Withdrawal-Amt OF ACCOUNT-LIF
319650200423             END-READ
319660200423             MOVE Min-Withdrawal-Amt OF ACCOUNT-LIF  TO
319670200423                                       ln_MinWithdrawalAmt
319680200423           ELSE
319690200423             MOVE ACCOUNT-NO OF TRANS  TO ACCOUNT-NO OF ACCOUNT-RRIF
319700200423             READ ACCOUNT-RRIF
319710200423               INVALID KEY
319720200423                 MOVE ZERO        TO Min-Withdrawal-Amt OF ACCOUNT-RRIF
319730200423             END-READ
319740200423             MOVE Min-Withdrawal-Amt OF ACCOUNT-RRIF TO
319750200423                                       ln_MinWithdrawalAmt
319760200423           END-IF.
319770200423      * ---------------------------------------------------------------
319780200423      *    MOVE ACCOUNT-NO OF TRANS
319790200423      *      TO ACCOUNT-NO OF ACCOUNT-RRIF.
319800200423      *    READ ACCOUNT-RRIF
319810200423      *    INVALID KEY
319820200423      *       MOVE ZERO TO Min-Withdrawal-Amt OF ACCOUNT-RRIF
319830200423      *    END-READ.
319840200423      * ---------------------------------------------------------------
319850200423      * RFS80602 - End
319860200423      *RFS61637 - End
319870200423      * RFS 84063 - begins.
319880200423      * RFS 164509 Begin
319890200423      *---------------------
319900200423      *UPDATE-ACCOUNT-FEE-ACCRUAL SECTION.
319910200423      *    SET  lb_AccrualUpdatedNo TO True.
319920200423      *
319930200423      *    Move Placement-Date OF TRANS TO
319940200423      *                   Placement-Date OF ACCOUNT-FEE-ACCRUAL
319950200423      *    Move Trans-No   OF TRANS TO
319960200423      *                   Trans-No OF ACCOUNT-FEE-ACCRUAL
319970200423      *    START ACCOUNT-FEE-ACCRUAL
319980200423      *    KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
319990200423      *    INVALID KEY CONTINUE
320000200423      *    NOT INVALID KEY
320010200423      *      PERFORM UPDATE-ACCOUNT-FEE-ACC-CONT
320020200423      *        UNTIL lb_AccrualUpdatedYes
320030200423      *    END-START.
320040200423      *---------------------
320050200423      *UPDATE-ACCOUNT-FEE-ACC-CONT SECTION.
320060200423      *
320070200423      *    READ ACCOUNT-FEE-ACCRUAL NEXT RECORD
320080200423      *      INVALID KEY
320090200423      *         SET lb_AccrualUpdatedYes TO TRUE
320100200423      *      AT END
320110200423      *         SET lb_AccrualUpdatedYes TO TRUE
320120200423      *      NOT INVALID KEY
320130200423      *         If Placement-Date OF TRANS =
320140200423      *                      Placement-Date OF ACCOUNT-FEE-ACCRUAL  AND
320150200423      *            Trans-No OF TRANS =
320160200423      *                      Trans-No OF ACCOUNT-FEE-ACCRUAL
320170200423      *              Move 'Y' TO  PAID-STATUS OF ACCOUNT-FEE-ACCRUAL
320180200423      *              REWRITE ACCOUNT-FEE-ACCRUAL-REC
320190200423      *              INVALID KEY
320200200423      *                MOVE "MFAACFEALB" TO WS-FILE-STATUS-FILE-NAME
320210200423      *              END-REWRITE
320220200423      *         Else
320230200423      *            SET lb_AccrualUpdatedYes TO TRUE
320240200423      *         End-If
320250200423      *    END-READ.
320260200423      * RFS 84063 - ends.
320270200423      * RFS 164509 End
320280200423      *RFS86395-Begin.
320290200423      *------------------------------
320300200423       Get-trans-assignment SECTION.
320310200423      *------------------------------
320320200423           INITIALIZE MFATRNASP
320330200423                      OF TRANS-ASSIGN-LOANID-REC
320340200423
320350200423           MOVE PLACEMENT-DATE     OF TRANS
320360200423            TO  PLACEMENT-DATE     OF TRANS-ASSIGN-LOANID
320370200423
320380200423           MOVE TRANS-NO           OF TRANS
320390200423            TO  TRANS-NO           OF TRANS-ASSIGN-LOANID
320400200423
320410200423           START TRANS-ASSIGN-LOANID
320420200423              KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
320430200423             INVALID KEY CONTINUE
320440200423             NOT INVALID KEY
320450200423              PERFORM Read-Trans-Assign-Record
320460200423           END-START.
320470200423      *------------------------------------
320480200423       Read-Trans-Assign-Record SECTION.
320490200423      *------------------------------------
320500200423              READ TRANS-ASSIGN-LOANID NEXT
320510200423               NOT INVALID KEY
320520200423               IF PLACEMENT-DATE     OF TRANS =
320530200423                  PLACEMENT-DATE     OF TRANS-ASSIGN-LOANID  AND
320540200423                  TRANS-NO           OF TRANS =
320550200423                  TRANS-NO           OF TRANS-ASSIGN-LOANID
320560200423                   SET lc-TrnaspRecordYes TO TRUE
320570200423               End-IF
320580200423              End-READ.
320590200423      *------------------------------------
320600200423       Generate-account-assignment SECTION.
320610200423      *------------------------------------
320620200423           INITIALIZE MFAACCASP
320630200423                      OF WS-ACCOUNT-ASSIGN-LOANID-REC.
320640200423           INITIALIZE WS-MFAACCASP-WSW
320650200423                      WS-MFATRNASP-WSW.
320660200423           PERFORM DAILY-ASSIGNMENT-LOANID.
320670200423           PERFORM WRITE-ACCOUNT-TRANS-ASSIGN-REC.
320680200423       WRITE-ACCOUNT-TRANS-ASSIGN-REC SECTION.
320690200423
320700200423      *****    Write account assignment file only if update falg is set
320710200423      *****    to "Y".
320720200423           IF  WS-MFAACCASP-WSW
320730200423                          IS NOT EQUAL TO  "Y"
320740200423               GO TO XEU-0320.
320750200423       XEU-0310.
320760200423           MOVE WS-ACCOUNT-ASSIGN-LOANID-REC
320770200423            TO  ACCOUNT-ASSIGNMENT-PRIMARY-REC.
320780200423
320790200423           WRITE ACCOUNT-ASSIGNMENT-PRIMARY-REC
320800200423               INVALID KEY
320810200423                   CONTINUE
320820200423           END-WRITE.
320830200423
320840200423           IF  WS-FILE-STATUS IS NOT EQUAL TO  "00"
320850200423               ADD 1  TO  ASSIGN-SEQ-NO OF WS-ACCOUNT-ASSIGN-LOANID-REC
320860200423               MOVE ASSIGN-SEQ-NO OF WS-ACCOUNT-ASSIGN-LOANID-REC
320870200423                                       TO  ASSIGN-SEQ-NO
320880200423                                          OF WS-TRANS-ASSIGN-LOANID-REC
320890200423               MOVE "MFAACCASP" TO WS-FILE-STATUS-FILE-NAME
320900200423               SET lncc_Err097  TO  TRUE
320910200423               PERFORM LOG-FILE-STATUS.
320920200423
320930200423       XEU-0320.
320940200423       XEU-0330.
320950200423      *****    If a Transaction Assignment record is to be created,
320960200423      *****    write it.
320970200423           IF  WS-MFATRNASP-WSW
320980200423                          IS NOT EQUAL TO  "Y"
320990200423               GO TO XEU-0340.
321000200423
321010200423101074     MOVE "A" TO ASSIGNMENT-STATUS OF WS-TRANS-ASSIGN-LOANID-REC
321020200423      **RFS102421 Begins - Changed to Write from TRANS-ASSIGNMENT-REC
321030200423      **   MOVE WS-TRANS-ASSIGN-LOANID-REC
321040200423      **                               TO  TRANS-ASSIGN-LOANID-REC.
321050200423      *RFS101074 Starts -Changed Write to Rewrite
321060200423      *    WRITE TRANS-ASSIGN-LOANID-REC
321070200423      *        INVALID KEY
321080200423      *            CONTINUE
321090200423      *    END-WRITE.
321100200423      **   REWRITE TRANS-ASSIGN-LOANID-REC
321110200423      **       INVALID KEY
321120200423      **           CONTINUE
321130200423      **   END-REWRITE.
321140200423      *RFS101074 - ends
321150200423           MOVE TRANS-ASSIGN-LOANID-REC TO TRANS-ASSIGNMENT-REC
321160200423           READ TRANS-ASSIGNMENT WITH NO LOCK
321170200423             INVALID KEY
321180200423               SET lb_WriteTransAsn_Yes  TO TRUE
321190200423             NOT INVALID KEY
321200200423               DELETE TRANS-ASSIGNMENT RECORD
321210200423                NOT INVALID KEY
321220200423                 SET lb_WriteTransAsn_Yes  TO TRUE
321230200423                INVALID KEY
321240200423                 SET lb_WriteTransAsn_NO   TO TRUE
321250200423               END-DELETE
321260200423           END-READ
321270200423           IF lb_WriteTransAsn_Yes
321280200423              MOVE WS-TRANS-ASSIGN-LOANID-REC TO TRANS-ASSIGNMENT-REC
321290200423              WRITE TRANS-ASSIGNMENT-REC
321300200423               NOT INVALID KEY
321310200423                        CONTINUE
321320200423              END-WRITE
321330200423           END-IF.
321340200423      **RFS102421 ends
321350200423           IF  WS-FILE-STATUS
321360200423                          IS NOT EQUAL TO  "00"
321370200423               MOVE "TRAN ASSGN: REU"  TO  WS-FILE-STATUS-FILE-NAME
321380200423               SET lncc_Err098  TO  TRUE
321390200423               PERFORM LOG-FILE-STATUS.
321400200423
321410200423       XEU-0340.
321420200423           EXIT.
321430200423      *RFS86395-End.
321440200423106558 COPY CPTRNACCLN.
321450200423107679 COPY CPYSEGLOG.
32146020042334309  COPY CPRESPEAP.
32147020042352265  COPY CPTRNEXMPT.
321480200423102778 COPY CPLDMINTBL.
321490200423104600 COPY CPYTRNLOG.
321500200423122496 COPY CPYACCMAT.
321510200423114676 COPY CPREADFILE.
321520200423113783 COPY CPMVAVALD.
321530200423      * RFS115495 - Fix QC32015 Start
321540200423115495 COPY CPBYPWHTAX.
321550200423      * RFS115495 - Fix QC32015 End
321560200423      * RFS138945 - Start
321570200423       COPY CPGETINVDL.
321580200423      * RFS138945 - End
321590200423
