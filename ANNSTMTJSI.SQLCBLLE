000100180314      * %ATTR DBGVIEW(*SOURCE) CLOSQLCSR(*ENDMOD)
000110190723       IDENTIFICATION DIVISION.
000120200203       PROGRAM-ID.     ANNSTMTJSI.
000130200203       AUTHOR.         Jewelstone Systems Inc.
000140210616       INSTALLATION.   Jewelstone Systems Inc.
000150200328       DATE-WRITTEN.   January 1996.
000160210807       DATE-COMPILED.
000170200310      ******************************************************************
000180180904      *                                                                *
000190210211      *    ANNSTMTJSI: Statement File Generation                       *
000200210624      *                                                                *
000210000000      *    **NOTE**:   This program was renamed on December 16, 1996.  *
000220210615      *                The old name was ANNSTMTBPI.                    *
000230210211      *                                                                *
000240970108      *    ********************************************************    *
000250210221      *    *                                                      *    *
000260970108      *    *    NOTE:  This program was originally written to     *    *
000270970108      *    *           access the Investor Join, the primary      *    *
000280970108      *    *           driving file, in Investor Numer / Account  *    *
000290970108      *    *           Number sequence.  This is still the case.  *    *
000300970108      *    *           Due to BPI's investor statements, as       *    *
000310970108      *    *           opposed to account statements, special     *    *
000320970108      *    *           logic was required to process the ALL      *    *
000330970108      *    *           DEALER REPRESENTATIVE and ALL DEALER runs. *    *
000340970108      *    *           These runs expect the Investor Join to be  *    *
000350970108      *    *           read in Dealer / Dealer Representative /   *    *
000360970108      *    *           Investor / Account sequence.  This is done *    *
000370970108      *    *           using an OPEN QUERY FILE (OPNQRYF) and an  *    *
000380970108      *    *           OVERRIDE DATA BASE FILE (OVRDBF) in the    *    *
000390970108      *    *           calling CL program.  The DEALER and DEALER *    *
000400970108      *    *           REPRESENTATIVE levels were added for the   *    *
000410970108      *    *           Investor Statements (BPI) and are only     *    *
000420970108      *    *           used for these ALL statement runs.  Please *    *
000430970108      *    *           be aware of this if any changes are to be  *    *
000440181129      *    *           made to these levels.                      *    *
000450970108      *    *                                                      *    *
000460970108      *    ********************************************************    *
000470000000      *                                                                *
000480000000      *    PURPOSE:    To create the statement file, which will be     *
000490000000      *                used to create the statements by a Statement    *
000500000000      *                Print program.                                  *
000510000000      *                                                                *
000520970108      *    LEVELS: **** 1. ACDEALER    Dealer                          *
000530970108      *            **** 2. ACDEALREP   Dealer Representative           *
000540970108      *                 3. ACIVRNO     Investor Number                 *
000550970108      *                 4. ACACTNO     Account Number                  *
000560970108      *                 5. INVESTMENT-CODE                             *
000570000000      *                                                                *
000580000000      ******************************************************************
000590020418      *****************************************************************
000600020418      ****
000610190723      **** NOTES:      A Module must be created while create a PGM.   *
000620020418      ****                                                            *
000630020418      **** COMPILE PGM: 1) Use option 15 to create module.            *
000640020418      ****              2) CRTPGM prompt F4                           *
000650020424      ****                 program: ANNSTMTJSI                        *
000660020418      ****                 library: ie. MFADEVPKOJ                    *
000670020424      ****                 Module : ANNSTMTJSI                        *
000680020418      ****                 library: ie. MFADEVPKOJ                    *
000690020418      ****                 Prompt F10 (additional parameters)         *
000700020424      ****                 program entry...:ANNSTMTJSI                *
000710020418      ****                 library: ie. MFADEVPKOJ                    *
000720020418      ****                                                            *
000730020418      ****       THE COMMENTS MUST BE REMOVED FROM YOUR PACKAGE       *
000740020418      ****       FRAME TO EXECUTE THE CRTSTMTSRV, CRTSTMTPGM          *
000750020418      ****       PROGRAMS FOR THE CREATION OF STATEMENT/CONFIRM       *
000760020418      ****       PROGRAMS.                                            *
000770020418      ******************************************************************
000780000000      *    C H A N G E   H I S T O R Y                                 *
000790000000      ******************************************************************
000800080425      * Please add change history into copybook CPYANNSTMT.            *
000810140925      * Nagamnai S * 2014/08/13   * RFS139007 - Recompile for CPGLWBRULE
000820190722      * THILAGA K  *  2015/02/12  * RFS143400 - ADD NEW LDA VARIABLE  *
000830150414      *            *              *  LNCC-GIC-REN-TRN IN POSITION 675 *
000840160630      * SHAIK RABS * 2015/09/10   * RFS152451-ADDITIONAL FEE CHANGES  *
000850160630      * Arthy K    * 2016/06/24   * RFS160982-Fix for incorrect       *
000860160630      *            *              * exchange rate in Statement/con ext*
000870170217      * Janapriya J* 2017/01/10   * RFS164528- CRM2-Cash Flows Extract*
000880170526      * Digvijay S * 2017/05/25   * RFS169000- Incorrect values for   *
000890181128      *            *              * exchange rate in extract          *
000900181015      * Aarthi M   * 2017/06/13   * RFS167932- Trade dated Statement  *
000910190110      *
000920190110      * M K SINDHU * 2019/01/03   * RFS180850-generating statement and*
000930190110      *            *              * confirm output                    *
000940190222      * Kavya K    * 2019/02/21   * RFS181057- Recompile for MFAINVMDP*
000950190422      * Lavanya V  * 2019/04/22   * RFS183538 - Fix for ESG expansion *
000960190830      * Jebastin K * 2019/08/12   * RFS182294- Recompile of MFAIVRCMP
000970190830      *            *              *          - Recompile of MFAIVRMDP
000980200327      * Chaya SP   *  2020/03/25  * RFS185170 - Recompile for MFAGDTHCSP
000990200413      * Sasikumar B* 2020/04/13   * RFS185170 - DJT Seg Fund Migration
001000200413      *            *              * - Gap Development - Managing
001010200413      *            *              * Optional Rider
001020200619      * Kirthigaa S*  2020/04/17  * RFS186069 - Recompile for MFAACMDP *
001030200706      * CHAYA SP   * 2020/07/06   * RFS185172 - Recompile for MFAACCONP*
001040200706      * Ashwini B  *  2020/06/20  * RFS184676 - Recompile for MFAGDTHVP*
001050200708      * CHAYA SP   * 2020/07/08   * RFS185172 - Recompile for MFAGMATVP*
001060200715      * VIGNESH    * 2020/07/15   * RFS185171 -Recompile for MFASGGWBRP
001070200717      * Surendran C* 2020/06/25   * RFS1100943- To fix for incorrect
001080200717      *            *              * Current Market value and Inception
001090200717      *            *              * Market value
001100200720      * M K SINDHU * 2020/07/08   * RFS185172 - Recompile for MFATRCODP
001110200720      *                           * MFASEGIRLP, MFAGDTHVP and MFAGDTHCSP
001120200721      * Ashwini B  * 2020/07/21   * RFS185176 - Recompile for MFAACCCRP*
001130200721      *            *              * and MFAALWRSTP                     *
001140200928      * Suresh P   * 2020/07/21   * RFS178492- Recompilation           *
001150200928      * Surendran C* 2020/09/15   * RFS1104542 -Statement Extract is   *
001160200928      *            *              * reporting incorrect market value   *
001170201127      *            *              * change for USD Funds               *
001180201127      * Chaya SP   * 2020/10/23   *RFS1105599 - Change to include blank*
001190201127      *            *              * reset type                         *
001200210127      * Kavya K    * 2020/10/13   * RFS186497 - Recompile for MFAACMDP *
001210210127      * Ragavi S   * 2020/10/21   * RFS186018  Recompile for MFAACAADP
001220210127      * Surendran C* 2020/12/02   * RFS186446- To Identify first Policy*
001230210127      *            *              * in section 80 statement/confirm    *
001240210127      *            *              * Extract.                           *
001250210210      * Kavya K    * 2021/02/10   * RFS186088 - Recompile for MFAINVMDP*
001260210217      * VIGNESH    * 2021/02/17   * RFS185894 -Recompile for MFASEGIRLP
001270210217      * Kavin      * 2021/02/17   * RFS186290 - Recompile only
001280210405      * Gomathi S  * 2021/01/07   * RFS1101968- RECOMPILE
001290210607      * Raja N     * 2020/03/20   * RFS186918 - Recompile
001300210607      * Gomathi S  * 2021/04/21   * RFS1114209- RECOMPILE
001310210803      * Vignesh    * 2021/07/07   * RFS187254 - Recompile for MFATRCODP
001320210803      * M K SINDHU * 2021/07/13   * RFS186771 - RECOMPILE MFAACLIFP    *
001330210803      *                           * & MFAACRIFP
001340210803      * Kavin      * 2021/07/28   * RFS186199 - Recompile for MFAACCCERP
001350210806      * Poojasri M *2021/08/05* RFS187659 - Recompile for MFAROLP
001351211007      * Vignesh    * 2021/08/18   * RFS1117445 - Changed Acc-Con-Inv
001352211007      *            *              * Array from 100 to 1000
001353211007      *            *              * Tagged as 111744
001354211007      * Kavin K    * 2021/08/07   * RFS187471 - Recompile for MFAGDTHVP*
001355211012      * Vignesh    * 2021/08/10   * RFS1121330 - Array initialize chang
001356211012      *            *              * Tagged as 112133
001370210803      ******************************************************************
001380190919      *RFS47406 Start
001390210805         COPY CPYANNSTMT.
001400080425      *RFS47406 End
001410210805      /
001420190111       ENVIRONMENT DIVISION.
001430200227       CONFIGURATION SECTION.
001440000000       SOURCE-COMPUTER. IBM-AS400.
001450190111       OBJECT-COMPUTER. IBM-AS400.
001460030825       SPECIAL-NAMES.
001470030825R14149     LINKAGE TYPE IS PROCEDURE FOR "STMTTARGET"
001480030825R12102     LINKAGE TYPE IS PROCEDURE FOR "PHANTOMFND"
001490030825  ¦        LINKAGE TYPE IS PROCEDURE FOR "JUTOGRPRG"
001500030825R12715     LINKAGE TYPE IS PROCEDURE FOR "GRTOJUPRG"
001510030825R18143     LINKAGE TYPE IS PROCEDURE FOR "FXDLCKFMCD"
001520030825R18143     LINKAGE TYPE IS PROCEDURE FOR "FXDRCKFMCD"
001530030825R18143     LINKAGE TYPE IS PROCEDURE FOR "FXNMCKFMCD"
001540030825R18147     LINKAGE TYPE IS PROCEDURE FOR "FXACMBVALU"
001550030910R18147     LINKAGE TYPE IS PROCEDURE FOR "FXINRSTRF"
001560031216R16511     LINKAGE TYPE IS PROCEDURE FOR "STMTSECT17"
001570040223R19586     LINKAGE TYPE IS PROCEDURE FOR "CALCALAI"
001580090305R20688     LINKAGE TYPE IS PROCEDURE FOR "STMTROR"
001590060524R66105     LINKAGE TYPE IS PROCEDURE FOR "FXSTRTADR"
001600060524      * RFS30797 - Begin
001610060524           LINKAGE TYPE IS PROCEDURE FOR "RORCLCSAV"
001620190111      * RFS30797 - End
001630041019R23365     LINKAGE TYPE IS PROCEDURE FOR "INTCLC"
001640050921R23365     LINKAGE TYPE IS PROCEDURE FOR "GICCALC"
001650050921      * RFS27951 - Begin
001660050921           LINKAGE TYPE IS PROCEDURE FOR "TRCODCALC"
001670070724      * RFS27951 - End
001680070724      * RFS37906 - Begins                                              *
001690130619           LINKAGE TYPE IS PROCEDURE FOR "TRCODCALD"
001700130619117038     LINKAGE TYPE IS PROCEDURE FOR "FXCHKTRN"
001710130619117038     LINKAGE TYPE IS PROCEDURE FOR "FXGIDIOINT"
001720070724117038     LINKAGE TYPE IS PROCEDURE FOR "FXSTMS22"
001730080806      * RFS37906 - Ends                                                *
001740111014R50993     LINKAGE TYPE IS PROCEDURE FOR "FXACCANUIT"
001750160122R97807     LINKAGE TYPE IS PROCEDURE FOR "FXSUMAWDT"
001760160122155778     LINKAGE TYPE IS PROCEDURE FOR "FXGETGMP"
001770160122155778     LINKAGE TYPE IS PROCEDURE FOR "FXGLWBRULE"
001780160523155778     LINKAGE TYPE IS PROCEDURE FOR "FXGLWBVLD"
001790170929159149     LINKAGE TYPE IS PROCEDURE FOR "FXGETMKVT"
001800100408171359     LINKAGE TYPE IS PROCEDURE FOR "CWTINPLTD"
001801210914      * RFS186199 - Begin
001802210914           LINKAGE TYPE IS PROCEDURE FOR "FXSEGMATVA"
001803210914           LINKAGE TYPE IS PROCEDURE FOR "FXCHKBELG"
001804210914           LINKAGE TYPE IS PROCEDURE FOR "CALCDUR"
001805210914           LINKAGE TYPE IS PROCEDURE FOR "VALDATEFMT"
001806210914      * RFS186199 - End
001810100408      * RFS76998 Begin
001820100408      *    LOCAL-DATA IS WS-LOCAL.
001830100408           LOCAL-DATA IS WS-LOCAL
001840201211186198     DATA-AREA IS WS-DTAARA-MFASEGPARM
001850100408           DATA-AREA IS WS-DATA-AREA.
001860000000      * RFS76998 End
001870000000      /
001880000000       INPUT-OUTPUT SECTION.
001890000000      ******************************************************************
001900000000      *    I N P U T   /   O U T P U T   S E C T I O N                 *
001910000000      ******************************************************************
001920120301       FILE-CONTROL.
001930120301      * RFS93662 Begin
001940120301      * FILE CONTROL has been moved to copy book CPYSTMTFC
001950000000        COPY CPYSTMTFC.
001960000000      /
001970100409       DATA DIVISION.
001980110907      * RFS78161 Begin
001990100304      * FILE SECTION has been moved to copy book CPYANNSTMT
002000100304      * INVESTOR-JOIN file is defined here as the
002010100304      * field ACACTNO for SQL compile.
002020190725        COPY CPYSTMTFD.
002030100304
002040100304       FD  INVESTOR-JOIN
002050100304           LABEL RECORDS      ARE  STANDARD.
002060100304       01  INVESTOR-J-REC.             COPY DD-ALL-FORMATS
002070100409                                            OF MFAACOJLA.
002080980206      * RFS78161 End
002090000000      /
002100000000       WORKING-STORAGE SECTION.
002110000000      ******************************************************************
002120000000      *    W O R K I N G   S T O R A G E   S E C T I O N               *
002130170928      ******************************************************************
002140000000
002150971024      /
002160980210       01  WS-LOCAL-DATA-AREA.         COPY CPYLDASTMT.
002170980219      /
002180980219                                COPY CPWCMPNMA.
002190030825                                COPY CPWPRCDTP.
002200030825R18143 01  DEALER-MAILING-INST-REC.   COPY DD-ALL-FORMATS OF MFADEAMIP.
002210030825   ¦  /
002220030825   ¦   01  DLRREP-MAILING-INST-REC.   COPY DD-ALL-FORMATS OF MFADERMIP.
002230030825   ¦  /
002240030825   ¦   01  NOMINEE-MAILING-INST-REC.  COPY DD-ALL-FORMATS OF MFANOMMIP.
002250140519      /
002260180905130239 COPY CPYANSC12A.
002270070925      *--RFS 42623 Begins
002280070925           COPY CPYSQLFLD
002290070925      ** RFS43691 - Start
002300070925      *  To fix the original compiler error of exceeding length(10)
002310070925               REPLACING == "CURRENT_PROGRAM" == BY == "ANNSTMTJSI" ==.
002320070619      ** RFS43691 - End
002330160519      *--RFS 42623 Ends
002340130614159149  COPY CPGETMKVT.
002350130614117038  COPY CPYSTMTREC.
002360140707117038  COPY CPYSTMS22.
002370120627        COPY CPYSTMAA16.
002380030825109016  COPY CPCALCDUR.
002390030825           EXEC SQL
002400030825             INCLUDE SQLCA
002410030825           END-EXEC.
002420030825           EXEC SQL
002430030825             INCLUDE SQLDA
002440110506           END-EXEC.
002450110506      /
002460110506      * RFS63488 Move report heading to copybook
002470000000       COPY CPYRPTHDG.
002480000000      /
002490970526           COPY CPYJSISTMT.
002500991123      /
002510991125
002520031015RF5148     COPY CPWRORCALC.
002530010719R18682     COPY CPYALOCCAL.
002540010719
002550010719      * RFS10737C - Begin
002560010807RF6697*    COPY INTCLCLS.
002570010719       COPY INTCLCLS.
002580010719      * RFS10737C - End
002590010719
002600010919      * RFS10563 - Begin
002610050308      * RFS11367 - Begin
002620050308R24679*COPY GICCALCLS OF LEVP-RFS11367C.                                RFS10563
002630010919R24679 COPY GICCALCLS.                                                  RFS10563
002640101217      * RFS11367 - End
002650010719R85453 COPY CPGETGMP.
002660991123
002670100408      /
002680100408      ***Copy Book used to retrieve data area MFAPRCDTP
002690100408           COPY PRCDTWS.
002700090309      * RFS76998 End
00271016120866105  Copy cpystrtadr.
002720060524
002730060524      * RFS30797 - Begin
002740060524      * -------------------------------
002750060524      * Copybooks - Start
002760060524      * -------------------------------
002770200319       COPY Cprorclcsa.
002780200319      * RFS1027733 - Start: Linkage to FXINVGR program
002790200319       COPY CPINVGR.
002800060524      * RFS1027733 - End
002810060524      * -------------------------------
002820060524      * Copybooks - End
002830060524      * -------------------------------
002840080502      * RFS30797 - End
002850080502      * RFS47406 - Start
002860080502      *Copybook used to pass parameters when calling FXGLWBVLD
002870080502          COPY CPYGLWBVLD.
002880080721      * RFS47406 - End
00289017092852779   COPY CPACCANUIT.
002891210914186199  COPY CPFXSGMTVA.
002892210914186199  COPY CPCHKBELG.
002900170928      ******************************************************************
002910170928      ** RFS171359 - START **                                         **
002920170928      ** ALL THE WORKING STORAGE VARIABLES HAVE BEEN MOVED TO COPYBOOK**
002930170928      ** CPANNSTMV AS the total lines ANNSTMTJSI in exceeds 32764 due **
002940170928      ** to which Users are not able to open ANNSTMTJSI in the STRPDM **
002950171012      ** Screen. KINDLY ADD YOUR NEW VARIABLES TO CPANNSTMV AND       **
002960170928      ** IF POSSIBLE, CREATE NEW COPY BOOKS FOR YOUR NEW FUNCTIONS    **
002970170928             EXEC SQL
002980170928                INCLUDE CPANNSTMV
002990170928             END-EXEC.
003000171011
003010180329             COPY CPCWTCALC.
003020180521      ** RFS171359 - END   **                                         **
003030180521      *RFS178765 - Starts
003040180521       01 ln_TempGross         PIC S9(11)V9(2)   COMP-3 VALUE 0.
003050180926      *RFS178765 - Ends
003060180926      * RFS176735 - Starts
003070180926       01 ln_LnkIntAmt         PIC S9(11)V9(2)   COMP-3 VALUE 0.
003080180926       01 ln_LnkNetProceeds    PIC S9(11)V9(2)   COMP-3 VALUE 0.
003090180926       01 li_LnkPlacementDate  PIC S9(9)      VALUE 0.
003100180926       01 li_LnkTransNo        PIC S9(9)      VALUE 0.
003110180430      * RFS176735 - Ends
003120180430      * RFS1001592 - Start
003130180430       01  ln-CLOSING-BAL-T    PIC S9(11)V999 VALUE 0.
003140180430       01  WS-OPN-STRDTE-T     PIC S9(8)      VALUE 0.
003150180628      * RFS1001592 - End
003160180628      * RFS1002966 - Start
003170180628       01  WS-CLOBAL-TXN-T     PIC S9(11)V999 VALUE 0.
003180180628       01  WS-ENDDTE-TXN-T     PIC S9(8)      VALUE 0.
003190170928      * RFS1002966 - End
003200000000      ******************************************************************
003210000000       PROCEDURE DIVISION.
003220000000      ******************************************************************
003230000000      *                                                                *
003240000000      *    P R O C E D U R E   D I V I S I O N                         *
003250000000      *                                                                *
003260000000      ******************************************************************
003270000000       MAINLINE.
003280000000      ******************************************************************
003290000000      *                                                                *
003300000000      *    M A I N L I N E                                             *
003310000000      *                                                                *
003320970108      ******************************************************************
003330970108      *****    ****    ****    R E M I N D E R     ****    ****    *****
003340970108      *****
003350970108      *****    Levels 4 and 5 are only to be used for INVESTOR type
003360970108      *****    statements.  The CL must resort the INVESTOR JOIN file
003370970108      *****    (using OPNQRYF & OVRDBF) and update position 610 of the
003380970108      *****    LDA with a value of 'D' (Dealer) or 'R' (Dealer
003390970108      *****    Representative).
003400000000      *****
003410000000           ACCEPT WS-LOCAL-DATA-AREA FROM WS-LOCAL.
003420000000           PERFORM INITIAL-LOGIC     THRU INL-EXIT.
003430991004           IF CURR-CONTROLS IS EQUAL TO HIGH-VALUES
003440991004              GO TO ML-1200
003450000000           END-IF.
003460000000       ML-0010.
003470000000           PERFORM GET-CURRENT-RECORD  THRU GCR-EXIT.
003480991004           IF PREV-LEVEL1 IS EQUAL TO CURR-LEVEL1
003490991004              GO TO ML-1100
003500000000           END-IF
003510991004           IF PREV-CONTROLS IS EQUAL TO LOW-VALUES
003520991004              GO TO ML-0040
003530000000           END-IF
003540000000           PERFORM LEVEL-SUMMARY-1     THRU LS1-EXIT.
003550991004           IF PREV-LEVEL2 IS EQUAL TO CURR-LEVEL2
003560991004              GO TO ML-0100
003570000000           END-IF
003580000000           PERFORM LEVEL-SUMMARY-2     THRU LS2-EXIT.
003590991004           IF PREV-LEVEL3 IS EQUAL TO CURR-LEVEL3
003600991004              GO TO ML-0050
003610000000           END-IF
003620970108           PERFORM LEVEL-SUMMARY-3     THRU LS3-EXIT.
003630991004           IF  PREV-LEVEL4    IS EQUAL TO  CURR-LEVEL4
003640991004               GO TO ML-0040-0020
003650970108           END-IF
003660970108           PERFORM LEVEL-SUMMARY-4    THRU LS4-EXIT.
003670991004           IF  PREV-LEVEL5    IS EQUAL TO  CURR-LEVEL5
003680991004               GO TO ML-0040-0010
003690970108           END-IF
003700000000           PERFORM LEVEL-SUMMARY-5    THRU LS5-EXIT.
003710000000       ML-0040.
003720991004           IF CURR-CONTROLS IS EQUAL TO HIGH-VALUES
003730991004              GO TO ML-1200
003740970108           END-IF
003750970108           PERFORM LEVEL-REINIT-5     THRU LR5-EXIT.
003760970108       ML-0040-0010.
003770970108           PERFORM LEVEL-REINIT-4     THRU LR4-EXIT.
003780000000       ML-0040-0020.
003790000000           PERFORM LEVEL-REINIT-3      THRU LR3-EXIT.
003800000000       ML-0050.
003810000000           PERFORM LEVEL-REINIT-2      THRU LR2-EXIT.
003820000000       ML-0100.
003830000000           PERFORM LEVEL-REINIT-1      THRU LR1-EXIT.
003840980521           MOVE CURR-CONTROLS          TO PREV-CONTROLS.
003850000911980514     MOVE CURR-GROUP-CONTROL     TO PREV-GROUP-CONTROL.
003860000911RF6697     MOVE CURR-ACCOUNT-TYPE      TO PREV-ACCOUNT-TYPE.
003870010607           MOVE CURR-NOMINEE-ACCOUNT-TYPE TO PREV-NOMINEE-ACCOUNT-TYPE.
003880000000R10404     MOVE CURR-PT-RULE           TO PREV-PT-RULE.
003890000000       ML-1100.
003900161110           PERFORM DETAIL-PROCESSING   THRU DPR-EXIT.
003910161026156507     IF LC-LDASECTION79 = "Y" AND WS-LDA-STMT-CNFM-FLAG = 'S'
003920161026156507        PERFORM DETAIL-PROCESSING-STM79 THRU DPR79-EXIT
003930161024156507        INITIALIZE WS-STM79-FLAG
003940000000156507     END-IF.
003950000000           GO TO ML-0010.
003960000000       ML-1200.
003970000817           PERFORM END-JOB             THRU EOJ-EXIT.
003980030825RF7628     GOBACK.
003990031007      /
004000120208***********************************************************************
004010031007******* SQL DECLARE CURSORS
004020031007***********************************************************************
004030140714R17495 SQL-DECLARE.
004040140716132121     EXEC SQL DROP TABLE QTEMP/SQAINSPERC END-EXEC.
004050120208132121     EXEC SQL DROP TABLE QTEMP/SQAINVREF  END-EXEC.
004060120208           EXEC SQL
004070031007              WHENEVER SQLERROR GOTO SQLLOG
004080031007           END-EXEC.
004090031007***********************************************************************
004100031007******* CURSOR: TRNCHC1  TRANS-CHARGES
004110031007***********************************************************************
004120031007******* ALIAS        FILENAME                 OPENNAME
004130031007***********************************************************************
004140031007******* TRNCHP       TRANS-CHARGES            MFATRNCHP
004150031007***********************************************************************
004160031007R17495     MOVE "DECLARE TRNCHC1 CURSOR" TO WS-SQLERR-STATEMENT.
004170031007           EXEC SQL
004180031007              DECLARE TRNCHC1 CURSOR FOR
004190031007              SELECT
004200031007                 TRNCHP.DEDUCTION_CODE,
004210031007                 TRNCHP.CHARGE,
004220031007                 TRNCHP.COUNTRY_CODE,
004230031007                 TRNCHP.PROVINCE_CODE
004240031007              FROM MFATRNCHP  TRNCHP
004250031007              WHERE
004260031007                 TRNCHP.PLACEMENT_DATE = :WS-PLACEMENT-DATE AND
004270031007                 TRNCHP.TRANS_NO = :WS-TRANS-NO
004280031007           END-EXEC
004290031007***********************************************************************
004300031007******* CURSOR: CONMTC1
004310031007***********************************************************************
004320031007******* ALIAS        FILENAME                    OPENNAME
004330031007***********************************************************************
004340031007******* CONMTP       CONTACT-METHODS             MFACONMTP
004350031007******* DRECMP       DEALER-REP-CONTACT-METHODS  MFADRECMP
004360031007***********************************************************************
004370031007R18147     MOVE "DECLARE CONMTC1 CURSOR" TO WS-SQLERR-STATEMENT.
004380031007           EXEC SQL
004390031007           DECLARE CONMTC1 CURSOR FOR
004400031007           SELECT DRECMP.CONTACT_METHOD,
004410031007                  DRECMP.CONTACT
004420031007           FROM MFACONMTP CONMTP
004430031007           JOIN MFADRECMP DRECMP ON
004440031007           DRECMP.DEALER_CODE = :WS-DEALER-CODE AND
004450031007           DRECMP.DEALER_REP_CODE = :WS-DEALER-REP-CODE AND
004460031007           DRECMP.CONTACT_SEQ_NO = CONMTP.CONTACT_SEQ_NO
004470031007           WHERE
004480031007           CONMTP.CONTACT_SEQ_NO <= 3
004490031007           END-EXEC.
004500031007***********************************************************************
004510031007******* CURSOR: IVRCLPC1
004520031007***********************************************************************
004530031007******* ALIAS        FILENAME                    OPENNAME
004540031007***********************************************************************
004550031007*******              INVESTOR-CHANGE-LOG         MFAIVRCLP
004560031007***********************************************************************
004570031007R18147     MOVE "DECLARE IVRCLC1 CURSOR" TO WS-SQLERR-STATEMENT.
004580031007           EXEC SQL
004590031007             DECLARE IVRCLC1 CURSOR FOR
004600031007             SELECT CHAR("N",1)
004610031007             FROM MFAIVRCLP
004620031007             WHERE
004630031007             ACCOUNT_NO = :ACACTNO AND
004640031007             CHANGE_CATEGORY = :WS-ACCOUNT-CLOSED AND
004650031007             AUDIT_DATE >= :WS-STMT-CFNM-STR-DATE
004660031215           END-EXEC.
004670031215***********************************************************************
004680031215******* CURSOR: INVSXC1
004690031215***********************************************************************
004700031215******* ALIAS        FILENAME                    OPENNAME
004710031215***********************************************************************
004720031215*******              INVESTMENT-STRUCTURE-XREF   MFAINVSXP
004730031215***********************************************************************
004740031215R17527     MOVE "DECLARE INVSXC1 CURSOR" TO WS-SQLERR-STATEMENT.
004750031215           EXEC SQL
004760031215             DECLARE INVSXC1 CURSOR FOR
004770091022             SELECT DISTINCT
004780091022R74738              a.INVESTMENT_STRUCTURE_CODE,
004790091022  ]                 a.INVESTMENT_CODE
004800091022  ]
004810091022  ]          FROM MFAINVSXP a
004820091022  ]
004830091022  ]          LEFT OUTER JOIN mfafnctp b on
004840091022  ]          a.INVESTMENT_STRUCTURE_CODE =b.INVESTMENT_STRUCTURE_CODE
004850101217  ]
004860101217R83550       WHERE ((a.INVESTMENT_STRUCTURE_CODE =
004870101217  |                            :WS-INVESTMENT-STRUCTURE-CODE OR
004880101217  |                 :WS-INVESTMENT-STRUCTURE-CODE = " ") and
004890101217  |              (((COALESCE(b.function_code, " ") <> "ACINVG")
004900101224  |                 AND (:Lc_InvStrSel <> "Y")) OR
004910101217  V               ((COALESCE(b.function_code, " ") =  "SETPOL")
004920031215R83550              AND (:Lc_InvStrSel =  "Y"))))
004930031215           END-EXEC.
004940031215***********************************************************************
004950031215******* CURSOR: ACCBENC1  ACCOUNT-BENEFICIARY
004960031215***********************************************************************
004970031215******* ALIAS        FILENAME                 OPENNAME
004980031215***********************************************************************
004990031215******* ACCBNP       ACCOUNT-BENEFICIARY      MFAACCBNP
005000031215***********************************************************************
005010031215R19502     MOVE "DECLARE ACCBENC1 CURSOR" TO WS-SQLERR-STATEMENT.
005020031215           EXEC SQL
005030031215             DECLARE ACCBENC1 CURSOR FOR
005040031215           SELECT
005050031215              ACCBNP.BENEFICIARY_SEQ_NO,  ACCBNP.SALUTATION_CODE,
005060031215              ACCBNP.FIRST_NAME,          ACCBNP.INITIALS,
005070031215              ACCBNP.LAST_NAME,           ACCBNP.REVOCABLE,
005080031215              ACCBNP.SOCIAL_INSURANCE_NO, ACCBNP.BENEFICIARY_TYPE,
005090031215              ACCBNP.DATE_OF_BIRTH,       ACCBNP.BENEFICIARY_STATUS,
005100031215              ACCBNP.RELATIONSHIP_TYPE,
005110031215              ACCBNP.SEX,                 ACCBNP.CUSTODIAL_PARENT_NAME,
005120031215              ACCBNP.CONTRACT_DATE,       ACCBNP.LANGUAGE_CODE,
005130140707              COALESCE(BENTYP.BENEFICIARY_TYPE_DESC, " "),
005140140707132121*       COALESCE(BRELTP.BEN_RELATION_TYPE_DESCR, " ")
005150150416132121        COALESCE(BRELTP.BEN_RELATION_TYPE_DESCR, " "),
005160150416      * RFS 144030 STARTS
005170150520132121*       COALESCE(ACCBPPS.BENEFICIARY_PERCENT, 0)
005180150520              COALESCE(ACCBPPS.BENEFICIARY_PERCENT, 0),
005190150520144030        COALESCE(AACSUCP.SUC_FIRST_NAME," "),
005200150520  |           COALESCE(AACSUCP.SUC_INITIALS," "),
005210150520  |           COALESCE(AACSUCP.SUC_LAST_NAME," "),
005220150520  |           COALESCE(AACSUCP.FOR_FIRST_NAME," "),
005230150520  |           COALESCE(AACSUCP.FOR_INITIALS," "),
005240150520  |           COALESCE(AACSUCP.FOR_LAST_NAME," "),
005250150520  |           COALESCE(AACSUCP.PRE_FIRST_NAME," "),
005260150520  |           COALESCE(AACSUCP.PRE_INITIALS," "),
005270180905144030        COALESCE(AACSUCP.PRE_LAST_NAME," ")
005280180905172713        ,COALESCE(AACSUCP.PRE_DOB,0)
005290031215172713        ,COALESCE(AACSUCP.PRE_DOD,0)
005300031215           FROM MFAACCBNP ACCBNP
005310031215           LEFT OUTER JOIN MFABENTYP BENTYP ON
005320150520              BENTYP.BENEFICIARY_TYPE = ACCBNP.BENEFICIARY_TYPE
005330150520144030*-----------------START-------------------------------***********
005340150520           LEFT OUTER JOIN (SELECT DISTINCT
005350150520           ACCBNP2.ACCOUNT_NO,
005360150520           CASE WHEN  SUC.RELATIONSHIP_TYPE = "SUC"
005370150520           THEN  SUC.FIRST_NAME ELSE  " "
005380150520           END AS SUC_FIRST_NAME,
005390150520           CASE WHEN  SUC.RELATIONSHIP_TYPE = "SUC"
005400150520           THEN  SUC.INITIALS  ELSE  " "
005410150520           END AS SUC_INITIALS,
005420150520           CASE WHEN  SUC.RELATIONSHIP_TYPE = "SUC"
005430150520           THEN  SUC.LAST_NAME ELSE  " "
005440150520           END AS SUC_LAST_NAME,
005450150520           CASE WHEN  FRO.RELATIONSHIP_TYPE = "FOR"
005460150520           THEN  FRO.FIRST_NAME ELSE  " "
005470150520           END AS FOR_FIRST_NAME,
005480150520           CASE WHEN  FRO.RELATIONSHIP_TYPE = "FOR"
005490150520           THEN  FRO.INITIALS  ELSE  " "
005500150520           END AS FOR_INITIALS,
005510150520           CASE WHEN  FRO.RELATIONSHIP_TYPE = "FOR"
005520150520           THEN  FRO.LAST_NAME ELSE  " "
005530150520           END AS FOR_LAST_NAME,
005540150520           CASE WHEN  PRE.RELATIONSHIP_TYPE = "PRE"
005550150520           THEN  PRE.FIRST_NAME ELSE  " "
005560150520           END AS PRE_FIRST_NAME,
005570150520           CASE WHEN  PRE.RELATIONSHIP_TYPE = "PRE"
005580150520           THEN  PRE.INITIALS  ELSE  " "
005590150520           END AS PRE_INITIALS,
005600150520           CASE WHEN  PRE.RELATIONSHIP_TYPE = "PRE"
005610150520           THEN  PRE.LAST_NAME ELSE  " "
005620180821           END AS PRE_LAST_NAME
005630180821172713     , CASE WHEN  PRE.RELATIONSHIP_TYPE = "PRE"
005640180821172713     THEN  PRE.DATE_OF_BIRTH ELSE  0
005650180821172713     END AS PRE_DOB
005660180827172713     , CASE WHEN  PRE.RELATIONSHIP_TYPE = "PRE"
005670180821172713     THEN  PREIVRETP.DOCUMENTATION_DATE ELSE  0
005680150520172713     END AS PRE_DOD
005690150520           FROM MFAACCBNP ACCBNP2
005700180821             INNER JOIN MFAACCNTP ACCNTP ON
005710180821172713           ACCNTP.ACCOUNT_NO = ACCBNP2.ACCOUNT_NO
005720180821172713*          ACCNTP.ACCOUNT_NO = ACCBNP2.ACCOUNT_NO AND
005730180821172713*          ACCNTP.ACCOUNT_TYPE_CODE = "TFSA"
005740180821172713       INNER JOIN MFAACCTYP ACCTYP ON
005750180821172713       ACCTYP.ACCOUNT_TYPE_CODE = ACCNTP.ACCOUNT_TYPE_CODE
005760180821172713       AND ACCTYP.ACCOUNT_TYPE_RULE IN ("3", "9")
005770150520
005780150520             LEFT OUTER JOIN MFAACSUCP SUC ON
005790150520                 SUC.ACCOUNT_NO = ACCBNP2.ACCOUNT_NO  AND
005800150520                 SUC.RELATIONSHIP_TYPE = "SUC"  AND
005810150520                 SUC.STATUS = "A"
005820150520             LEFT OUTER JOIN MFAACSUCP FRO ON
005830150520             FRO.ACCOUNT_NO = ACCBNP2.ACCOUNT_NO  AND
005840150520             FRO.RELATIONSHIP_TYPE = "FOR"  AND
005850150520             FRO.STATUS = "A"
005860150520             LEFT OUTER JOIN MFAACSUCP PRE ON
005870150520             PRE.ACCOUNT_NO = ACCBNP2.ACCOUNT_NO  AND
005880150520             PRE.RELATIONSHIP_TYPE = "PRE"  AND
005890180827             PRE.STATUS = "A"
005900181012172713       LEFT OUTER JOIN MFAIVRETP PREIVRETP ON
005910180821172713       PREIVRETP.INVESTOR_NO = PRE.INVESTOR_NO2
005920150520
005930150520           WHERE
005940150520           ACCBNP2.ACCOUNT_NO = :WS-ACCOUNT-NO) AS AACSUCP ON
005950150520           AACSUCP.ACCOUNT_NO = ACCBNP.ACCOUNT_NO
005960031215144030* -------------------END----------------------------*****
005970031215           LEFT OUTER JOIN MFABRELTP BRELTP ON
005980031215              BRELTP.BEN_RELATION_TYPE_CODE =
005990140707                                        ACCBNP.RELATIONSHIP_TYPE
006000140707      * RFS132121 - Starts
006010140707           LEFT OUTER JOIN (
006020140707           SELECT ACCBPP.ACCOUNT_NO,
006030140707                  ACCBPP.BENEFICIARY_SEQ_NO,
006040140707                  ACCBPP.BENEFICIARY_PERCENT
006050140707           FROM   MFAACCNTP ACCNTP
006060140707           INNER  JOIN MFAACCTYP ACCTYP ON
006070140707           ACCNTP.ACCOUNT_TYPE_CODE = ACCTYP.ACCOUNT_TYPE_CODE AND
006080140707           ACCTYP.ACCOUNT_TYPE_RULE NOT IN ("4" , "0")
006090140707
006100140707           INNER JOIN MFAACCBNP ACCBNP1 ON
006110140707           ACCBNP1.ACCOUNT_NO = ACCNTP.ACCOUNT_NO AND
006120140707           ACCBNP1.BENEFICIARY_STATUS = "A"
006130140707           INNER JOIN MFAACCBPP ACCBPP ON
006140140707           ACCBPP.ACCOUNT_NO = ACCBNP1.ACCOUNT_NO AND
006150140707           ACCBPP.BENEFICIARY_SEQ_NO = ACCBNP1.BENEFICIARY_SEQ_NO AND
006160140707           ACCBPP.BENEFICIARY_SPLIT_CODE =
006170140707             (SELECT COALESCE(ACCBPP1.BENEFICIARY_SPLIT_CODE, " ")
006180140707              FROM   MFAACCBPP ACCBPP1
006190140707              WHERE  ACCBPP1.ACCOUNT_NO = ACCNTP.ACCOUNT_NO
006200140707              ORDER BY ACCBPP1.ACCOUNT_NO,
006210140707                       ACCBPP1.BENEFICIARY_SPLIT_CODE
006220140707              FETCH FIRST ROW ONLY)
006230140707           WHERE  ACCNTP.ACCOUNT_NO = :WS-ACCOUNT-NO
006240140707                           ) AS ACCBPPS ON
006250140707           ACCBPPS.ACCOUNT_NO = ACCBNP.ACCOUNT_NO  AND
006260140707           ACCBPPS.BENEFICIARY_SEQ_NO = ACCBNP.BENEFICIARY_SEQ_NO
006270031215      * RFS132121 - Ends
006280031215           WHERE
006290160908              ACCBNP.ACCOUNT_NO = :WS-ACCOUNT-NO
006300031215162826     ORDER BY ACCBNP.BENEFICIARY_SEQ_NO
006310150731           END-EXEC
006320031215149292     PERFORM DECLARE-ACCBENC2-CURSOR.
006330031215***********************************************************************
006340031215******* CURSOR: IVRPACC1
006350031215***********************************************************************
006360031215******* ALIAS        FILENAME                 OPENNAME
006370031215***********************************************************************
006380031215******* IVRPPP       INVESTOR-PAC-PURCHASE    MFAIVRPPP
006390031215******* IVRPAP       INVESTOR-PAC             MFAIVRPAP
006400031215******* SPLOP        SPLIT-OPTIONS            MFASPLOP
006410031215******* BNKACP       BANK-ACCOUNT             MFABNKACP
006420031215******* BNKP         BANK                     MFABNKP
006430031215***********************************************************************
006440031215R19502     MOVE "DELCARE IVRPACC1 CURSOR" TO WS-SQLERR-STATEMENT.
006450031215           EXEC SQL
006460031215           DECLARE IVRPACC1 CURSOR FOR
006470031215           SELECT
006480031215               IVRPPP.PAC_SEQ_NO,      IVRPPP.INVESTMENT_CODE,
006490031215               IVRPPP.DEPOSIT_AMT,     IVRPPP.NEGOTIATED_COMM,
006500031215               IVRPAP.START_DATE,      IVRPAP.FREQUENCY_CODE,
006510031215               IVRPAP.PAC_AMT,
006520060622               IVRPAP.PAC_STATUS,      IVRPAP.STOP_DATE,
006530031215               IVRPAP.HOlD_UNTIL_DATE, IVRPAP.SPLIT_OPTION_CODE,
006540031215               SPLOPP.SPLIT_OPTION_RULE,
006550031215               COALESCE(BNKACP.CURRENCY, :WS-CURRENCY-CAD),
006560031215               COALESCE(BNKP.BANK_NAME, " "),
006570101111               COALESCE(BNKP.BANK_NAME_FRENCH, " ")
006580101111      * RFS84988 Begins
006590101111      *    FROM  MFAIVRPAP IVRPAP, MFAIVRPPP IVRPPP,
006600101111      *          MFASPLOPP SPLOPP
006610101111           FROM MFAIVRPAP IVRPAP
006620101111           INNER JOIN MFAIVRPPP IVRPPP ON
006630101111           IVRPPP.INVESTOR_NO = IVRPAP.INVESTOR_NO AND
006640101111           IVRPPP.PAC_SEQ_NO  = IVRPAP.PAC_SEQ_NO
006650101111           INNER JOIN MFASPLOPP SPLOPP ON
006660101111           SPLOPP.SPLIT_OPTION_CODE = IVRPAP.SPLIT_OPTION_CODE
006670031215      * RFS84988 Ends
006680031215           LEFT OUTER JOIN MFABNKACP BNKACP ON
006690031215              BNKACP.BANK_SEQ_NO = IVRPAP.BANK_SEQ_NO
006700031215
006710031215           LEFT OUTER JOIN MFABNKP BNKP ON
006720031215              BNKP.BANK_NO = BNKACP.BANK_NO
006730101111
006740101111      * RFS84988 Begins
006750101111      *    WHERE
006760101111      *       IVRPPP.INVESTOR_NO = :WS-INVESTOR-NO AND
006770101111      *       IVRPPP.INVESTOR_NO = IVRPAP.INVESTOR_NO AND
006780101111      *       IVRPPP.PAC_SEQ_NO = IVRPAP.PAC_SEQ_NO AND
006790101111      *       IVRPPP.ACCOUNT_NO = :WS-ACCOUNT-NO AND
006800101111      *       SPLOPP.SPLIT_OPTION_CODE = IVRPAP.SPLIT_OPTION_CODE
006810101111
006820101111           WHERE
006830101111               IVRPPP.INVESTOR_NO = :WS-INVESTOR-NO AND
006840101111               IVRPPP.ACCOUNT_NO = :WS-ACCOUNT-NO
006850031215      * RFS84988 Ends
006860031215           ORDER BY
006870031215              IVRPPP.PAC_SEQ_NO
006880031215           END-EXEC.
006890031215***********************************************************************
006900031215******* CURSOR: ACCAWDC1
006910031215*******
006920031215***********************************************************************
006930031215******* ALIAS        FILENAME                 OPENNAME
006940031215***********************************************************************
006950031215******* ACCAWP       ACCOUNT-AWD              MFAACCAWP
006960031215******* ACCAIP       ACCOUNT-AWD-INVESTMENT   MFAACCAIP
006970031215******* SPLOP        SPLIT-OPTIONS            MFASPLOP
006980031215***********************************************************************
006990031215R19502     MOVE "DELCARE ACCAWDC1 CURSOR" TO WS-SQLERR-STATEMENT.
007000031215           EXEC SQL
007010031215           DECLARE ACCAWDC1 CURSOR FOR
007020031215
007030031215           SELECT
007040031215              ACCAWP.AWD_SEQ_NO,        ACCAWP.START_DATE,
007050060622              ACCAWP.FREQUENCY_CODE,    ACCAWP.STOP_DATE,
007060031215              ACCAWP.HOLD_UNTIL_DATE,   ACCAWP.AWD_PAYMENT_TYPE,
007070031215              ACCAWP.AWD_STATUS,        ACCAWP.CURRENCY,
007080031215              ACCAIP.INVESTMENT_CODE,   ACCAIP.AWD_AMOUNT,
007090031215              ACCAIP.AWD_PERCENT,       ACCAIP.AWD_UNITS,
007100031215              ACCAIP.SPLIT_OPTION_CODE, ACCAIP.GROSS_OR_NET,
007110200831              SPLOPP.SPLIT_OPTION_RULE
007120101111186053        ,COALESCE(AWDHP.USE_WITHDRAWAL_HIERARCHY, "N")
007130101111      * RFS84988 Begins
007140101111      *    FROM MFAACCAWP ACCAWP, MFAACCAIP ACCAIP,
007150101111      *         MFASPLOPP SPLOPP
007160101111           FROM MFAACCAWP ACCAWP
007170101111           INNER JOIN MFAACCAIP ACCAIP ON
007180101111           ACCAIP.ACCOUNT_NO = ACCAWP.ACCOUNT_NO AND
007190101111           ACCAIP.AWD_SEQ_NO = ACCAWP.AWD_SEQ_NO
007200101111           INNER JOIN MFASPLOPP SPLOPP ON
007210200831           SPLOPP.SPLIT_OPTION_CODE = ACCAIP.SPLIT_OPTION_CODE
007220200831      *RFS186053 START
007230200831           LEFT  JOIN MFAACAWDHP AWDHP ON
007240200831           AWDHP.ACCOUNT_NO = ACCAWP.ACCOUNT_NO AND
007250200831           AWDHP.AWD_SEQ_NO = ACCAWP.AWD_SEQ_NO
007260101111      *RFS186053 END
007270101111      *    WHERE
007280101111      *       ACCAWP.ACCOUNT_NO = :WS-ACCOUNT-NO AND
007290101111      *       ACCAIP.ACCOUNT_NO = ACCAWP.ACCOUNT_NO AND
007300101111      *       ACCAIP.AWD_SEQ_NO = ACCAWP.AWD_SEQ_NO AND
007310101111      *       ACCAIP.SPLIT_OPTION_CODE <> " " AND
007320101111      *       SPLOPP.SPLIT_OPTION_CODE = ACCAIP.SPLIT_OPTION_CODE AND
007330101111           WHERE
007340101111              ACCAWP.ACCOUNT_NO = :WS-ACCOUNT-NO AND
007350101111              ACCAIP.SPLIT_OPTION_CODE <> " " AND
007360040202      * RFS84988 Ends
007370040202R20136        (SPLOPP.SPLIT_OPTION_RULE = "$" OR
007380040202R20136         SPLOPP.SPLIT_OPTION_RULE = "%" OR
007390031215R20136         SPLOPP.SPLIT_OPTION_RULE = "U")
007400031215
007410031215           ORDER BY
007420031215              ACCAWP.AWD_SEQ_NO
007430031215           END-EXEC.
007440031215  *********************************************************************
007450031215  ***** CURSOR:  IPSGRPIDC1
007460031215  *********************************************************************
007470031215  ***** ALIAS        FILENAME                 OPENNAME
007480031215  *********************************************************************
007490031215  ***** CONSAP       CONS-ACCT-ACCOUNTS       MFACONSAP
007500031215  *********************************************************************
007510031007R17527     MOVE "DECLARE IPSGRPIDC1 CURSOR" TO WS-SQLERR-STATEMENT.
007520031007  ¦
007530031007  ¦        EXEC SQL
007540031007  ¦          DECLARE IPSGRPIDC1 CURSOR FOR
007550031007  ¦             SELECT CONSAP.CONS_ACCT_ID, CONSAP.EFFECTIV_DATE
007560031007  ¦             FROM  MFACONSAP CONSAP
007570031007  ¦             WHERE CONSAP.ACCOUNT_NO  = :WS-STMT-IPS-ACCOUNT-NO AND
007580031007  ¦                   CONSAP.EFFECTIV_DATE <= :WS-STMT-IPS-DATE
007590031007  ¦             ORDER BY
007600031007  ¦                   CONSAP.EFFECTIV_DATE DESC
007610031007  ¦        END-EXEC.
007620031007R18485
007630031007***********************************************************************
007640031007******* CURSOR: TRNCDC1
007650031007*******
007660031007***********************************************************************
007670031007******* ALIAS        FILENAME                    OPENNAME
007680031007***********************************************************************
007690031007******* TRNCDP       TRANS-CONTR-REDEM-DESCR     MFATRNCDP
007700031007***********************************************************************
007710031007 |         MOVE "DECLARE TRNCDC1 CURSOR" TO WS-SQLERR-STATEMENT.
007720031007 |         EXEC SQL
007730031007 V           DECLARE TRNCDC1 CURSOR FOR
007740031007             SELECT CONTR_REDEM_CODE,
007750031007                    LANGUAGE_CODE,
007760031007                    CONTR_REDEM_CODE_DESCR
007770031007             FROM MFATRNCDP
007780031007             ORDER BY CONTR_REDEM_CODE, LANGUAGE_CODE
007790061004           END-EXEC.
007800061004R34848*RFS34838 - Start
007810061004***********************************************************************
007820061004******* CURSOR: TRNTDD1
007830061004*******
007840061004***********************************************************************
007850061004******* ALIAS        FILENAME                    OPENNAME
007860061004***********************************************************************
007870061004******* TRNDEP       TRANS-DEDUCTION-DESCR       MFATRNDEP
007880061004***********************************************************************
007890061004           IF WS-LDA-STMT-CNFM-FLAG = lnc_C   AND
007900061004              lc-LdaSection81    =    lnc_Y
007910061004              MOVE "DECLARE TRNTDD1 CURSOR" TO WS-SQLERR-STATEMENT
007920061004              EXEC SQL
007930061004                 DECLARE TRNTDD1 CURSOR FOR
007940061004                 SELECT   DEDUCTION_CODE,
007950061004                          LANGUAGE_CODE,
007960061004                          DEDUCTION_SHORT_DESCR,
007970061004                          DEDUCTION_LONG_DESCR
007980061004                 FROM MFATRNDEP
007990061004                 ORDER BY DEDUCTION_CODE, LANGUAGE_CODE
008000061004              END-EXEC
008010061004           END-IF.
008020031007R34848**RFS34848 - End
008030031007***********************************************************************
008040031007******* CURSOR: INVCDC1
008050031007***********************************************************************
008060031007******* ALIAS        FILENAME                    OPENNAME
008070031007***********************************************************************
008080031007******* INVP         INVESTMENT                  MFAINVP
008090031007******* INVNMP       INVESTMENT-NAME             MFAINVNMP
008100031007***********************************************************************
008110031007           MOVE "DECLARE INVCDC1 CURSOR" TO WS-SQLERR-STATEMENT.
008120031007           EXEC SQL
008130031007             DECLARE INVCDC1 CURSOR FOR
008140031007             SELECT A.INVESTMENT_CODE,
008150031007                    A.CURRENCY,
008160031007                    A.CONSTITUTE_FOREIGN,
008170031007                    A.INDUSTRY_FUND_CODE,
008180031007                    A.INVESTMENT_GROUP_CODE,
008190031007                    A.LOAD_STRUCTURE,
008200031007                    0,
008210031007                    A.PRODUCT_TYPE_CODE,
008220160613                    IFNULL(B.INVESTMENT_NAME_LONG, "*******"),
008230160613156335*             IFNULL(C.INVESTMENT_NAME_LONG, "*******")
008240190206156335              IFNULL(C.INVESTMENT_NAME_LONG, "*******"),
008250190206      *RFS181062 STARTS
008260190206156335*             IFNULL(D.EXTERNAL_LOAD_TYPE_CODE, " "),
008270190425156335*             IFNULL(E. LOAD_TYPE_DESCR, " "),
008280190419                    CHAR(IFNULL(D.EXTERNAL_LOAD_TYPE_CODE, " "),3),
008290190425183538*             IFNULL(E. ALLOW_VALUE_DESC, " "),
008300190206183538              CHAR(IFNULL(E.ALLOW_VALUE_DESC, " "),25),
008310160613      *RFS181062 ENDS
008320031007156335              IFNULL(F.INVESTMENT_GROUP_CATEGORY, " ")
008330031007              FROM MFAINVP A
008340031007              LEFT JOIN
008350031007                   (SELECT INVESTMENT_CODE, INVESTMENT_NAME_LONG
008360160613                    FROM MFAINVNMP WHERE LANGUAGE_CODE = "E")B
008370031007              ON   B.INVESTMENT_CODE = A.INVESTMENT_CODE
008380031007              LEFT JOIN
008390031007                   (SELECT INVESTMENT_CODE, INVESTMENT_NAME_LONG
008400160613                    FROM MFAINVNMP  WHERE LANGUAGE_CODE = "F")C
008410160613              ON   C.INVESTMENT_CODE = A.INVESTMENT_CODE
008420160613156335        LEFT JOIN  MFAINVMDP D ON
008430190131156335             A.INVESTMENT_CODE = D.INVESTMENT_CODE
008440190206      *RFS181062 STARTS
008450190222156335*       LEFT JOIN  MFAXLDCDP E ON
008460190222156335*            D.EXTERNAL_LOAD_TYPE_CODE = E.EXTERNAL_LOAD_TYPE_CODE
008470190222              LEFT JOIN MFAALWVLP E ON
008480190222                   D.EXTERNAL_LOAD_TYPE_CODE = E.ALLOW_VALUE
008490190222               AND E.ALLOW_VALUE_TYPE        = "EXTERN_LOAD_TYPE"
008500190131               AND E.LANGUAGE_CODE           = "E"
008510160613      *RFS181062 ENDS
008520160613156335        LEFT JOIN  MFAINVGRP F ON
008530031007156335               F.INVESTMENT_GROUP_CODE = A.INVESTMENT_GROUP_CODE
008540031007              ORDER BY A.INVESTMENT_CODE, A.INDUSTRY_FUND_CODE
008550080925           END-EXEC.
008560080923R50823*****************************************************************
008570080923  ¦   * CURSOR: INVCDC2
008580080923  ¦   *****************************************************************
008590080923  ¦   * ALIAS        FILENAME                    OPENNAME
008600080925  ¦   *****************************************************************
008610080923  ¦   * INVP2        INVESTMENT                  MFAINVP
008620080923  ¦   * INVMDP1      INVESTMENT-MISC-DETAILS     MFAINVMDP
008630080923  ¦   *****************************************************************
008640080923  ¦        MOVE "DECLARE INVCDC2 CURSOR" TO WS-SQLERR-STATEMENT.
008650080923  ¦        EXEC SQL
008660080925  ¦          DECLARE INVCDC2 CURSOR FOR
008670080923  ¦             SELECT Invp2.INVESTMENT_CODE,
008680080925  ¦                    COALESCE(Invmdp1.GMP_Closing_Date, 0)
008690080923  ¦             FROM MFAINVP Invp2
008700080923  ¦
008710080925  ¦             LEFT OUTER JOIN MFAINVMDP Invmdp1 ON
008720080925  ¦                  Invmdp1.Investment_Code = Invp2.Investment_Code
008730080923  v             ORDER BY Invp2.INVESTMENT_CODE
008740080923R50823     END-EXEC.
008750031215
008760031215R17527*****************************************************************
008770031215  ¦**** CURSOR:  ASMXPC1
008780031215  ¦********************************************************************
008790031215  ¦**** ALIAS        FILENAME                 OPENNAME
008800031215  ¦********************************************************************
008810031215  ¦**** CONSTP       CONS-ACCT-TARGET-MIX     MFACONSTP
008820031215  ¦********************************************************************
008830031215  ¦
008840031215  ¦        MOVE "DECLARE ASMXPC1 CURSOR" TO WS-SQLERR-STATEMENT.
008850031215  ¦
008860031215  ¦        EXEC SQL
008870031215  ¦          DECLARE ASMXPC1 CURSOR FOR
008880031215  ¦          SELECT CONSTP.ASSET_CLASS_PERCENTAGE
008890031215  ¦          FROM MFACONSTP CONSTP
008900031215  ¦          WHERE
008910031215  ¦            CONSTP.CONS_ACCT_ID     = :WS-CONS-ACCT-ID         AND
008920031215  ¦            CONSTP.ASSET_CLASS_CODE = :WS-ASSET-CLASS-CODE     AND
008930031215  ¦            CONSTP.EFFECTIV_DATE    = :WS-EFFECTIVE-DATE       AND
008940031215  ¦            CONSTP.ASSET_SUB_CLASS_CODE = :WS-ASSET-SUB-CLASS-CODE
008950031215  ¦        END-EXEC.
008960031215  ¦
008970031215  v
008980051003R17527**********
008990051003R14153*****************************************************************
009000051003  ¦   * CURSOR: CNTRRPC1
009010051003  ¦   *
009020051003  ¦   *****************************************************************
009030051003  ¦   * ALIAS        FILENAME                    OPENNAME
009040051003  ¦   *****************************************************************
009050051003  ¦   * CNTRRP       CONTR-REDEM-CODE-RULES      MFACNTRRP
009060051003  ¦   *****************************************************************
009070051003  ¦        MOVE "DECLARE CNTRRPC1 CURSOR" TO WS-SQLERR-STATEMENT.
009080051003  ¦        EXEC SQL
009090051003  ¦          DECLARE CNTRRPC1 CURSOR FOR
009100051003  ¦          SELECT ACCOUNT_TYPE_CODE,
009110051003  ¦                 CONTR_REDEM_CODE,
009120051003  ¦                 CONTR_REDEM_CODE_RULE
009130051003  ¦          FROM MFACNTRRP
009140051003  ¦          ORDER BY ACCOUNT_TYPE_CODE, CONTR_REDEM_CODE
009150051003  ¦        END-EXEC.
009160051003  ¦
009170051003  ¦   *****************************************************************
009180051003  ¦   * CURSOR: CNTRRPC1
009190051003  ¦   *****************************************************************
009200051003  ¦   * ALIAS        FILENAME                    OPENNAME
009210051003  ¦   *****************************************************************
009220051003  ¦   * INVGDP    INVESTMENT-GROUP-CATEGORY-DESCR MFAINVGDP
009230051003  ¦   *****************************************************************
009240051003  ¦        MOVE "DECLARE INVGDPC1 CURSOR" TO WS-SQLERR-STATEMENT.
009250051003  ¦
009260051003  ¦        EXEC SQL
009270051003  ¦          DECLARE INVGDPC1 CURSOR FOR
009280051003  ¦          SELECT INVESTMENT_GROUP_CATEGORY,
009290051003  ¦                 LANGUAGE_CODE,
009300051003  ¦                 DESCRIPTION
009310051003  ¦          FROM MFAINVGDP
009320051003  v          ORDER BY INVESTMENT_GROUP_CATEGORY
009330081121R14153     END-EXEC.
009340081121R52815*****************************************************************
009350081121  ¦**** CURSOR:  MfaAccFbp1
009360081121  ¦********************************************************************
009370081121  ¦**** ALIAS        FILENAME                 OPENNAME
009380081121  ¦********************************************************************
009390081121  ¦**** accfbp       ACCT-CONTRACT-FIE-BONUS  MFAACCFBP
009400081121  ¦********************************************************************
009410081121  ¦
009420081121  ¦        MOVE "DECLARE MfaAccFbp1 CURSOR" TO WS-SQLERR-STATEMENT.
009430081121  ¦
009440081121  ¦        EXEC SQL
009450081121  ¦          DECLARE MfaAccFbp1 CURSOR FOR
009460081121  ¦          SELECT accfbp.Fie_Bonus_Date,
009470081121  ¦                 accfbp.Bonus_Eligibility_Flag,
009480081121  ¦                 accfbp.Fie_Bonus_Amount
009490081121  ¦          FROM MFAACCFBP accfbp
009500081121  ¦          WHERE
009510081121  ¦            accfbp.Account_No       = :li_AccountNo          AND
009520081121  ¦            accfbp.Contract_No      = :li_ContractNo         AND
009530081121  ¦            accfbp.Fie_Bonus_Date  <= :ld_LdaEndDate
009540081121  ¦          ORDER BY
009550081121  ¦            accfbp.Fie_Bonus_Date DESC
009560081121  ¦          FETCH FIRST 1 ROW ONLY
009570081121  v          FOR READ ONLY
009580051003R52815     END-EXEC.
009590160205
009600031215148326     PERFORM DECLARE-MRRINV-CURSOR THRU MRRINV-EXIT.
009610031215       SQL-EXIT.
009620031007           EXIT.
009630030825      /
009640030825       INITIAL-LOGIC.
009650030825      ******************************************************************
009660030825      *                                                                *
009670030825      *    I N I T I A L   L O G I C   R O U T I N E                   *
009680030825      *                                                                *
009690160603      ******************************************************************
009700160603      *RFS160824 Begin
009710160603159149*    PERFORM SELECT-ACCOUNT98
009720030825      *RFS160824 End
009730130614R18147     INITIALIZE  ACMBVALU-EXCHANGE-ARRAY.
009740130614117038     Initialize li_S22Index.
009750140417117038     Move "N" to lc_S22RRSPtoRRIF.
009760160526129378     INITIALIZE lc_GICMatValue.
009770180201159664     INITIALIZE ln-ACB-UNIT-TRANSACTED.
009780180201      ** RFS177079 - Start **
009790180201           INITIALIZE  WS-TEMP-AT-UNIT-BALANCE
009800180201                       WS-TEMP-AT-NO-OF-UNITS
009810180201                       WS-TEMP-AT-NO-OF-UNITS-SIGN
009820180201                       WS-TEMP-AT-NON-TAX-DEDUCTIONS
009830180201                       WS-TEMP-AT-ACB-UNITS-TRANS
009840180201                       WS-TEMP-AT-UNIT-PRICE
009850160211      ** RFS177079 - End   **
009860160205148326     INITIALIZE ln_InvMktValTot, li_MerCount, WS-MERINV-TBL.
009870160205148326     SET MER TO 1.
009880160205148326     SET MER DOWN BY 1.
009890180404148326     PERFORM INIT-LOGIC-MER THRU INIT-EXIT.
009900100408177423     PERFORM BUILD-EXCHANGE-RATES-DTL THRU BERD-EXIT.
009910100408      * RFS76998 Begin
009920100408           ACCEPT PROCESS-DATE-DATA-AREA FROM WS-DATA-AREA
009930100408                  FOR "MFAPRCDTP".
009940100408           IF PDDA-YEAR-END = 'N'
009950100408              COMPUTE Ld-year = PDDA-AS-AT-DATE / 10000
009960100408           ELSE
009970100408              COMPUTE Ld-year = (PDDA-AS-AT-DATE / 10000)  + 1
009980100408           END-IF
009990060524      * RFS76998 End
010000060524      * RFS30797 - Begin
010010060707      * Initial passing array - parameters
010020060707           PERFORM VARYING pi-IxPerRor
010030060707             FROM 1 BY 1 UNTIL pi-IxPerRor > 10
010040060707               INITIALIZE pc-PeriodCode   (pi-IxPerRor)
010050060707                          pn-PeriodRor    (pi-IxPerRor)
010060060524                          pc-PeriodRorSts (pi-IxPerRor)
010070060524           END-PERFORM
010080051003      * RFS30797 - End
010090051003R14153*****
010100051003  ¦   *****    Accept System Date and Time
010110051003  ¦   *****
010120051003  ¦
010130051003  ¦        CALL "GETDAT" USING WS-REQUEST-DATE.
010140051003  ¦        CANCEL "GETDAT".
010150051003  ¦
010160051003  ¦        ACCEPT WS-REQUEST-TIME-1 FROM TIME.
010170051003  ¦        MOVE WS-DI-REQUEST-H1    TO WS-DI-REQUEST-H2.
010180051003  ¦        MOVE WS-DI-REQUEST-M1    TO WS-DI-REQUEST-M2.
010190051003  ¦        MOVE WS-DI-REQUEST-S1    TO WS-DI-REQUEST-S2.
010200051003  ¦
010210051003  v        DISPLAY "ANNSTMTJSI started on: "  WS-REQUEST-DATE.
010220051018R14153     DISPLAY "ANNSTMTJSI started at: "  WS-REQUEST-TIME-1.
010230201211186198     ACCEPT lc_MfaSegParm FROM WS-DTAARA-MFASEGPARM
010240201211186198            FOR "MFASEGPARM".
010250051018
010260051019R30514     EXEC SQL
010270051019                SELECT COUNT(*)
010280051018                INTO :WS-BYSTM-COUNT
010290051018                FROM MFAIVACAP
010300051018                WHERE INVESTOR_ATTRIBUTE_CODE = "BYSTM"
010310051018R30514     END-EXEC.
010320070926
01033007092640307      MOVE lncc_No TO pc-extAccRorCalYrFlag pc-extAciRorCalYrFlag
010340070926  |                        pc-extIstRorCalYrFlag pc-CalendarYearFlag
010350070926  |                        pc-AddNewAccFlag.
01036003082540307      MOVE ZEROES TO  pn-CalendarYearPeriods.
010370030825      * RFS10737 -Begin
010380030825           CALL "QCMDEXC"  USING CL-COMMAND PACK-VAL.
010390030825      * RFS10737 -End
010400030825      *****
010410030825      *****    Open the Input files.
010420030825      *****
010430030825           OPEN    INPUT   ACCOUNT-AWD-INVESTMENT
010440030825980316                     ACCOUNT
010450030825                           ACCOUNT-ATTRIBUTE
010460030825                           ACCOUNT-AWD
010470030825                           ACCOUNT-BENEFICIARY
010480030825RF6063                     ACCOUNT-BENEFICIARY-FINANCIALS
010490030825RF6063                     BENEFICIARY-TYPE-FILE
010500030825RF6063                     BENEFICIARY-RELATIONSHIP-TYPE
010510030825                           ACCOUNT-BENEFICIARY-SPLIT
010520030825RF4638                     ACCOUNT-BENEFICIARY-SPLITLB
010530030825                           ACCOUNT-INV-ACCRUALS
010540030825                           ACCOUNT-SERVICE-LEVEL
010550030825                           ACCOUNT-T
010560030825                           ACCOUNT-TYPE-BK
010570030825rf9326                     ACCOUNT-LIF-ADD-DETAILS
010580030825                           ASSET-CLASS-DESCRIPTION
010590030825                           BUSINESS-DAY-FILE
010600030825                           EXCHANGE-RATE-M
010610030825                           INV-GROUP-WEIGHTING-DETAIL
010620030825                           INV-GROUP-WEIGHTING-HEADER
010630030825                           INV-GROUP-WEIGHTING-SUBCLS-DTL
010640030825                           INVESTOR-ATTRIBUTE
010650030825                           PROGRAM-EXCHANGE-RATE
010660030825                           PRODUCT-TYPE-CODES
010670030825R15880                     PROGRAM-THRESHOLDS
010680040712                           REVERSAL-REASON-BK
010690030825R21714                     SCREEN-EDITS-ALLOWED
010700030825                           TRANS-EXCHANGE-RATE
010710110519                           TRANS-T
01072003082593759                      TRANS-M
010730030825RF5962                     TRANS-ROC-APPLIED
010740030825RF5962                     MAX-PENSION-EARNINGS
010750030825                           INVESTOR-MARKETING-INFO
010760030825                           INVESTOR-SPOUSE
010770030825                           INVESTOR-TYPE
010780030825                           INVESTOR-TENANT
010790030825                           INSTITUTION
010800030825                           INSTITUTION-BRANCH
010810030825                           INSTITUTION-ADDRESS
010820030825                           DEALER-REP-ADDRESS
010830030825                           ACCOUNT-TYPE-LANG
010840030825                           MANAGEMENT-COMPANY-CODES
010850030825                           NOMINEE-ACCOUNT-TYPE-DESCR
010860030825                           ACCOUNT-INVESTMENT
010870030825                           ROLLOVER
010880030825                           INVESTMENT-GROUP
010890030825RF6697                     INVESTMENT-DII-RATES
010900030825                           DII-RATE-SET
010910030825                           INV-CATEGORY
010920030825                           INVESTMENT-UNIT-PRICE
010930030825                           TRANS
010940030825                           TRANS-RESP-DETAILS
010950030825RF4638                     TRANS-CDSC-PURCHASE
010960030825                           TRANS-TYPE-REPORT-DESCR
010970030825                           DEALER
010980030825                           DEALER-REP
010990030825                           CURRENCY-CODE
011000030825                           TAXABLE-EVENT
011010030825                           ADDRESS-FILE
011020030825                           INVESTOR-ADDRESS-FILE
011030030825                           COUNTRY-FILE
011040030825                           INVESTOR-JOIN
011050030825                           DISCRETIONARY-FEE-SCHED
011060030825                           ACCOUNT-FEE
011070030825RF9331                     ACCOUNT-RESP
011080030825R10362                     FREQUENCY-CODES-LANG
011090030825R10362                     PAYMENT-TYPE-LANG
011100070925RF9415                     DEALER-MISC-DETAILS
011110070925      ** RFS43691 - Start
011120070925                           DEALER-REP-MISC-DETAILS
011130030825      ** RFS43691 - End
011140030825RF9415                     NOMINEE-MISC-DETAILS
011150030825R13211                     ACCOUNT-XREFLA
011160030825R13756                     MASTER-ACCOUNT
011170030825R13955                     GROUP-PLAN-DESC
011180030825R16363                     TRANS-DISTR-DETAILS
011190030825R16363                     TRANS-INTEREST-DETAILS
011200031006R14418                     INVESTOR-ACCOUNT-ATTRIBUTES
011210030825R18368                     DEALER-REP-TXN
011220160215R14418                     ACCOUNT-ATTRIBUTE-CODES
011230030825148326                     TransAdjustmentUnitCost
011240041028                           USER-FILE.
011250041028      *****
011260041028      *****    Open the Mass select account file
011270041028      *****
011280041028            IF SELECT-ACCOUNTS
011290041028               OPEN INPUT  STATEMENT-ACCOUNT-SELECTION
011300030825            END-IF
011310030825      *****
011320030825      *****    Open the Input files for AIC
011330030825      *****
011340030825           IF WS-LDA-FCR-FUND-FLAG = "Y"
011350030825              OPEN  INPUT      ACCOUNT-FGN-CONTENT-REBAL-OPT
011360030825R14178                         FGN-CONTENT-REBAL-SCHED-LA
011370030825R14178                         ACCOUNT-INVESTMENT-FCR.
011380030825
011390030825      *****
011400030825      *****    Open the Input files for GGF
011410030825      *****
011420030825
011430030825           IF WS-LDA-ACCOUNT-LIF = "Y"
011440030825              OPEN  INPUT      ACCOUNT-LIF.
011450030825
011460030825           IF WS-LDA-GROUP = "Y"
011470030825              OPEN  INPUT      ACCOUNT-GROUP
011480030825                               GROUP-FILE.
011490030825
011500030825
011510030825           IF WS-LDA-REQUEST-SCOPE IS EQUAL TO "C"
011520030825           OR WS-LDA-REQUEST-SCOPE IS EQUAL TO "E"
011530030825              OPEN  INPUT      DEALER-REP-EXTRACT.
011540030825
011550030825      *****
011560030825      *****    Open the Input files for SEG
011570030825      *****
011580030825           IF WS-LDA-SEG-40         = "Y"
011590030825           OR WS-LDA-SEG-43         = "Y"
011600030825           OR WS-LDA-SEG-45         = "Y"
011610030825           OR WS-LDA-SEG-90         = "Y"
011620030825              OPEN  INPUT      ACCOUNT-CONTRACT
011630030825                               ACCOUNT-CONTRACT-INVESTMENT
011640030825                               ACCOUNT-CONTRACT-INV-RESET
011650030825                               INVESTMENT-SEG
011660090610                               GUAR-DEATH-SCHED
011670030825R57388                         GUAR-DEATH-CRITERIA-SCHED
011680030825                               GUAR-MATURITY-SCHED
011690030825                               ACCOUNT-CONTRACT-ANNUITANT
011700030825                               ACCOUNT-ANNUITANT
011710030825                               TRANS-CONTRACT-DETAILS
011720041229                               ALLOWABLE-RESET-SCHED
011730030825R25469                         TRANS-C
011740030825           END-IF.
011750030825      *****
011760030825      *****    Open print file if it is confirmation
011770030825      *****
011780030825           IF WS-LDA-STMT-CNFM-FLAG = "C"
011790030825              OPEN  OUTPUT     PRINT-FILE.
011800030825      *****
011810030825      *****    If this is a Batch Request, open the Statement Print
011820030825      *****    Request, which will be the driver file.
011830030825      *****
011840030825           IF  WS-LDA-REQUEST-SCOPE
011850030825                              IS EQUAL TO  "B"
011860030825               OPEN    INPUT   STATEMENT-PRINT-REQUEST.
011870030825      *****
011880030825      *****    If PAC/AWD systematic data is to be processed, open the
011890030825      *****    required files.
011900030825      *****
011910030825           IF  WS-LDA-PACAWD-FLAG
011920030825                          IS NOT EQUAL TO  "N"
011930030825               OPEN    INPUT   BANK-ACCOUNT
011940030825                               BANK-FILE
011950030825                               INVESTOR-PAC
011960030825                               INVESTOR-PAC-PURCHASE.
011970030825      *****
011980030825      *****    If multiple dealer records are to be produced, open the
011990030825      *****    required files.
012000030825      *****
012010030825           IF  WS-LDA-DEALER-FLAG
012020030825                              IS EQUAL TO  "M"
012030030825               OPEN    INPUT   INVESTOR-DEALER-REP.
012040030825      *****
012050030825      *****    If RRIF detail records are to be produced, open the
012060030825      *****    required files.
012070030825      *****
012080030825           IF  WS-LDA-RRIF-FLAG  EQUAL TO  "Y"
012090040109R10207     OR  WS-LDA-RRIF-FLAG  EQUAL TO  "A"
012100030825R20352     OR  WS-LDA-RRIF-FLAG  EQUAL TO  "G"
012110030825               OPEN    INPUT   ACCOUNT-RRIF.
012120030825      *****
012130030825      *****    If Duplicate Mailing is applicable, open the required
012140030825      *****    files.
012150030825      *****
012160030825           IF  WS-LDA-DUP-MAIL   EQUAL TO  "Y"
012170030825               OPEN    INPUT   MAIL-LIST-DETAILS
012180030825                               MAIL-LIST-HEADER.
012190030825      *****
012200030825      *****    If ROR is applicable, open the required files
012210030825      *****
012220030825980402     IF  WS-LDA-ROR-FLAG = "Y"
012230030825               OPEN    I-O     TRANS-Y
012240161025                               TRANS-Z.
012250161024156507     IF  LC-LDASECTION79 = "Y"
012260161024156507         OPEN    INPUT    TRANS-I
012270161024156507         IF WS-LDA-ROR-FLAG NOT = "Y"
012280161024156507            OPEN    INPUT    TRANS-Z
012290030825156507     END-IF.
012300030825      *****
012310030825      *****    If processing GGF, open the Transaction Currency Unit
012320030825      *****    Cost file.
012330030825      *****
012340030825           OPEN    INPUT   TRANS-CURRENCY-UNIT-COST.
012350030825      *****
012360030825      *****    If section 30 and 35 were required, open the files
012370030825      *****
012380030825RF5148     OPEN    INPUT   ROR-PERIOD-CODES
012390030825RF5148                     ROR-PERIOD-DESCRIPTION.
012400030825      *****
012410030825      *****    If ACCOUNT-GIC-DETAILS are to be produced, open the
012420030825      *****    required files.
012430030825      *****
012440030825RF6697     IF  WS-LDA-GIC-25     EQUAL TO  "Y"
012450030825               OPEN  INPUT     GIC-CERTIFICATE-DETAILS
012460151205           END-IF.
012470151205      *RFS151145 Start
012480151205           IF lb-LdaAccountAdditionalInfoYes
012490151205              OPEN  INPUT     ACCOUNT-XREF2
012500151205           END-IF.
012510161024      *RFS151145 End
012520161024      *RFS156507 Start  - To check edit code STMPDN exists or not
012530161024
012540161024           MOVE lc_PndTransScreenCode
012550161024                          TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
012560161024           MOVE lc_PndTransEditCode
012570161024                          TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
012580161024           MOVE lc_PndTransLevelCode
012590161024                          TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
012600161024           MOVE "Y"       TO Lc_PndTrans.
012610161024           READ SCREEN-EDITS-ALLOWED
012620161024                INVALID KEY
012630161024                MOVE "N" TO Lc_PndTrans
012640161123           END-READ.
012650161123
012660161129           IF Lc_PndTrans = "Y"
012670161123              PERFORM LOAD-INV-PND-TRANS-ARRAY THRU LIPT-EXIT
012680161024           END-IF.
012690171011      *RFS156507 End
012691210914      *RFS186199 Starts *
012692210914           IF lncc-LdaFundLongDescYes
012693210914              PERFORM LOAD-FUND-LONG-DESC-ARRAY THRU LFLD-EXIT
012694210914           END-IF.
012695210917      *RFS186199 Ends*
012700171016      ** RFS171359 -  Start **
012710171016           INITIALIZE CWT-PARAMETERS.
012720170929
012730170929           MOVE lc_STMLTD_ScreenCode
012740170929                          TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
012750170929           MOVE lc_STMLTD_EditCode
012760170929                          TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
012770170929           MOVE lc_STMLTD_Code
012780170929                          TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
012790170929           MOVE "Y"       TO Lc_STMLTD.
012800170929           READ SCREEN-EDITS-ALLOWED
012810170929                INVALID KEY
012820170929                MOVE "N" TO Lc_STMLTD
012830171010           END-READ.
012840171011
012850171010           IF Lc_STMLTD = "Y"
012860171010           INITIALIZE ln_Trans_Arr_Count
012870171010                      ln_Trans_Arr_Count_Max
012880171010           MOVE 100 TO ln_Trans_Arr_Count_Max
012890171010           PERFORM VARYING ln_Trans_Arr_Count
012900171010                   FROM 1 BY 1
012910171010                   UNTIL ln_Trans_Arr_Count > ln_Trans_Arr_Count_Max
012920171010               INITIALIZE ILT-TRANS-RECORD(ln_Trans_Arr_Count)
012930171010           END-PERFORM
012940170929           END-IF.
012950101217      ** RFS171359 -  End   **
012960101217R83550***** See if SETPOL was needed or not
012970101217  ¦        MOVE lc_InvStrSelScreenCode
012980101217  ¦                       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
012990101217  ¦        MOVE lc_InvStrSelEditCode
013000101217  ¦                       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
013010101217  ¦        MOVE lc_InvStrSelCode
013020101217  ¦                       TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
013030101217  ¦        MOVE "Y"       TO Lc_InvStrSel.
013040101217  ¦        READ SCREEN-EDITS-ALLOWED
013050101217  ¦           INVALID KEY
013060101217  V             MOVE "N" TO Lc_InvStrSel
013070110302R83550     END-READ.
013080110302R88823***** See if SETPOL was needed or not
013090110302  ¦        MOVE lc_BYPSTMSelScreenCode
013100110302  ¦                       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
013110110302  ¦        MOVE lc_BYPSTMSelEditCode
013120110302  ¦                       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
013130110302  ¦        MOVE lc_BYPSTMSelCode
013140110302  ¦                       TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
013150110302  ¦        MOVE "Y"       TO Lc_BYPSTMTrn.
013160110302  ¦        READ SCREEN-EDITS-ALLOWED
013170110302  ¦           INVALID KEY
013180110302  V             MOVE "N" TO Lc_BYPSTMTrn
013190130219R88823     END-READ.
013200130219101829***** See if CLCBV  was needed or not
013210130219  ¦        MOVE lc_CLCBV_SelScreenCode
013220130219  ¦                       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
013230130219  ¦        MOVE lc_CLCBV_SelEditCode
013240130219  ¦                       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
013250130219  ¦        MOVE lc_CLCBV_SelCode
013260130219  ¦                       TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
013270130219  ¦        MOVE "Y"       TO Lc_CLCBV.
013280130219  ¦        READ SCREEN-EDITS-ALLOWED
013290130219  ¦           INVALID KEY
013300130219  |             MOVE "N" TO Lc_CLCBV
013310120301101829     END-READ.
013320120301105408***** See if STMPAY was needed or not
013330120301  ¦        MOVE lc_PayOptionScreenCode
013340120301  ¦                       TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
013350120301  ¦        MOVE lc_PayOptionEditCode
013360120301  ¦                       TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
013370120301  ¦        MOVE lc_PayOptionCode
013380120301  ¦                       TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
013390120301  ¦        MOVE "Y"       TO Lc_PayOption.
013400120301  ¦        READ SCREEN-EDITS-ALLOWED
013410120301  ¦           INVALID KEY
013420120301  V             MOVE "N" TO Lc_PayOption
013430130124105408     END-READ.
013440130124      *RFS116317 - Begin
013450130124      * Check if Edit code is on to suppress Accounts with An. Reset
013460130124      * Get BYPRST Edit Code
013470130124           INITIALIZE lc_BYPRST_RtnFlag.
013480130124           CALL "FXSCEDTAL1" USING lc_BYPRST_ScreenCode
013490130124                                   lc_BYPRST_EditCode
013500130124                                   lc_BYPRST_EditLevel
013510130124                                   lc_BYPRST_RtnFlag.
013520130124           CANCEL "FXSCEDTAL1".
013530190919      *RFS116317 - End
013540190919      *RFS184715 - Begin
013550190919      * Get STMATL Edit Code
013560190919           INITIALIZE lc_STMATL_RtnFlag.
013570190919           CALL "FXSCEDTAL1" USING lc_STMATL_ScreenCode
013580190919                                   lc_STMATL_EditCode
013590190919                                   lc_STMATL_EditLevel
013600190919                                   lc_STMATL_RtnFlag.
013610190919           CANCEL "FXSCEDTAL1".
013620140714      *RFS184715 - End
013630030825
013640030825R17495     PERFORM SQL-DECLARE THRU SQL-EXIT.
013650051111
013660051111R30514*****
013670051111  ¦   *****    Get FOREIGN-CONTENT-LIMIT of the Company. This is one
013680051111  ¦   *****    time process.
013690051111  ¦   *****
013700051111  ¦
013710051111  ¦        INITIALIZE  MFAMGTCDP OF MANAGEMENT-COM-CODES-REC.
013720051111  ¦        MOVE WS-LDA-MGMT-COM-CDE TO
013730051111  ¦             MANAGEMENT-COMPANY-CODE OF MANAGEMENT-COM-CODES-REC.
013740051111  ¦
013750051111  ¦        READ MANAGEMENT-COMPANY-CODES
013760051111  ¦             INVALID KEY
013770051111  ¦              MOVE ZEROES TO WS-FOREIGN-CONTENT-LIMIT
013780051111  ¦        END-READ.
013790051111  ¦
013800051111  ¦        MOVE FOREIGN-CONTENT-LIMIT OF MANAGEMENT-COM-CODES-REC
013810051111  v                                   TO WS-FOREIGN-CONTENT-LIMIT.
013820051111R30514
013830030825
013840030825      *****
013850030825      *****    Get User-iD value
013860030825      *****
01387005083116419      CALL "RTVUSERID"  USING WS-USER-ID.
013880050831      *****
013890050831      *****    Get The last 12-months date from the statement end date
013900050831      *****
013910050831R28931     MOVE WS-LDA-ENDDTE TO WD-CCYYMMDD
013920050831  ¦        MOVE
013930050831  ¦         FUNCTION SUBTRACT-DURATION (WD-CCYYMMDD MONTHS LT-DELTA-MM)
013940050831R28931                      TO LAST-12-MONTHS-DATE
013950060630
013960060630R35042     MOVE LAST-12-MONTHS-DATE TO WD-CCYYMMDD.
013970060630  ¦        MOVE FUNCTION ADD-DURATION
013980060630  v             (WD-CCYYMMDD DAYS 1)
013990040928R35042                      TO LAST-12-MONTHS-DATE.
014000040928R18924*****
014010040928   ¦  *****  S P E C I A L   M O D U L E   A U T H O R I Z A T I O N   *
014020040928   ¦  *****  Check for authorized GDVRSTCON module.
014030040928   ¦  *****                                                            *
014040040928   ¦       IF WS-LDA-SEG-90               = "Y"
014050040928   ¦          MOVE SPACES                 TO WS-MODULE-AUTH
014060040928   ¦          MOVE WS-MODULE1             TO WS-MODULE
014070070321   v          CALL "RTVMODAUTH"  USING WS-MODULE  WS-MODULE-AUTH
014080070321      **RFS37754 - Begins
014090070321              CALL "RTVMODAUTH"  USING
014100070321                                 lc_ModuleSegSysMat lc_SegSysMat
014110070501      **RFS37754 - Ends
014120070501      * RFS 38639 - begins.
014130110531              PERFORM Check_GbvRst_Edit_Code
014140200710R63488*       IF Edit-GbvRst
014150200710      *RFS 1098681 Begin
014160200710      *          PERFORM Create_Tmp_Stm_Extract
014170110531      *RFS 1098681 End
014180070501R63488*       END-IF
014190070501      * RFS 38639 - ends.
014200040928
014210080425R18924     END-IF.
014220080430      *RFS47406 Start
014230080425           MOVE WS-LDA-AS-AT-DATE   TO ld_AsAtDate.
014240080425      * Get Special Module SEGGLWB
014250080501           MOVE SPACE TO lc_SegGLWB.
014260080425           CALL "RTVMODAUTH"  USING lnc_ModuleSegGLWB   lc_SegGLWB.
014270200710      *RFS47406 End
014280200710      *RFS 1098681 Begin
014290200710              IF Edit-GbvRst OR
014300200710                 lc_SegGLWBYes
014310200710                 PERFORM Create_Tmp_Stm_Extract
014320200710              END-IF
014330140707      *RFS 1098681 End
014340140707      * RFS132121 - Start
014350140707           INITIALIZE lc_ModAssetAlloc.
014360140707           MOVE lnc_AssetAlloc  TO lc_ModuleId
014370140707           CALL "RTVMODAUTH" USING lc_ModuleId  lc_ModAssetAlloc.
014380180629      * RFS132121 - End
014390180629      *RFS177152 START
014400180629           IF lc_SegGLWBYes
014410180629      *LWADetails TABLE
014420180629              INITIALIZE WS-LWA-Details
014430180629              MOVE "DeclareCur lcu_LWADetails"
014440180629                TO WS-SQLERR-STATEMENT
014450180629              EXEC SQL
014460180629                DECLARE lcu_LWADetails CURSOR FOR
014470180629                Select INVESTMENT_SERIES, AGE_UPPER_LIMIT,
014480180629                       GWA_PERCENT, ALTERNATE_GWA_PERCENT,
014490180629                       LWA_PROJECTION
014500180629                from MFASGGWRTP
014510180629                ORDER BY INVESTMENT_SERIES, AGE_UPPER_LIMIT
014520180629              END-EXEC
014530180629              MOVE "Open_Cur lcu_LWADetails"
014540180629                TO WS-SQLERR-STATEMENT
014550180629              EXEC SQL
014560180629                OPEN lcu_LWADetails
014570180629              END-EXEC
014580180629              MOVE "Fetch_Cur lcu_LWADetails"
014590180629                TO WS-SQLERR-STATEMENT
014600180629              EXEC SQL
014610180629                FETCH NEXT FROM lcu_LWADetails
014620180629                  FOR 500 ROWS
014630180629                  INTO :WS-LWA-Details-DEF
014640180905              END-EXEC
014650180905              MOVE "CloseCur lcu_LWADetails"
014660180905                TO WS-SQLERR-STATEMENT
014670180905              EXEC SQL
014680180905                CLOSE lcu_LWADetails
014690180629              END-EXEC
014700180629      *SGGWBRPDetails TABLE
014710180629              INITIALIZE WS-SGGWBR-Details
014720180629              MOVE "DeclrC lcu_SGGWBRPDetails"
014730180629                TO WS-SQLERR-STATEMENT
014740180629              EXEC SQL
014750180629                DECLARE lcu_SGGWBRPDetails CURSOR FOR
014760180629                Select INVESTMENT_SERIES, CONTRACT_AGE_UPPER_LIMIT,
014770180629                       BONUS_RATE, SKIP_SELL_TAKEN, AGE_THRESHOLD
014780180629                from MFASGGWBRP
014790180629                ORDER BY INVESTMENT_SERIES, CONTRACT_AGE_UPPER_LIMIT
014800180629              END-EXEC
014810180629              MOVE "Open_C lcu_SGGWBRPDetails"
014820180629                TO WS-SQLERR-STATEMENT
014830180629              EXEC SQL
014840180629                OPEN lcu_SGGWBRPDetails
014850180629              END-EXEC
014860180629              MOVE "FetchC lcu_SGGWBRPDetails"
014870180629                TO WS-SQLERR-STATEMENT
014880180629              EXEC SQL
014890180629                FETCH NEXT FROM lcu_SGGWBRPDetails
014900180629                  FOR 500 ROWS
014910180629                  INTO :WS-SGGWBR-Details-DEF
014920180905              END-EXEC
014930180905              MOVE "CloseC lcu_SGGWBRPDetails"
014940180905                TO WS-SQLERR-STATEMENT
014950180905              EXEC SQL
014960180905                CLOSE lcu_SGGWBRPDetails
014970180629              END-EXEC
014980180629           END-IF.
014990040928      *RFS177152 END
015000030825
015010030825      *****
015020030825      *****    Accept System Date and Time
015030030825      *****
015040030825           CALL "GETDAT" USING WS-REQUEST-DATE.
015050030825           CANCEL "GETDAT".
015060030825
015070030825           ACCEPT WS-REQUEST-TIME-1 FROM TIME.
015080030825           MOVE WS-DI-REQUEST-H1    TO WS-DI-REQUEST-H2.
015090030825           MOVE WS-DI-REQUEST-M1    TO WS-DI-REQUEST-M2.
015100030825           MOVE WS-DI-REQUEST-S1    TO WS-DI-REQUEST-S2.
015110030825      *****
015120030825      ***** INITIALIZE START AND END DATE IN LOCAL DATA AREA
015130030825      *****
015140030825           IF WS-LDA-STRDTE = SPACES
015150030825              MOVE ZEROES TO WS-LDA-STRDTE.
015160030825           IF WS-LDA-ENDDTE = SPACES
015170030825              MOVE ZEROES TO WS-LDA-ENDDTE.
015180030825R18147     MOVE WS-LDA-STRDTE TO WS-STMT-CFNM-STR-DATE.
015190030825           MOVE WS-LDA-STRDTE TO WS-CNFM-SDATE.
015200031003           MOVE WS-LDA-ENDDTE TO WS-CNFM-EDATE.
015210190806R17527     MOVE WS-LDA-ENDDTE TO WS-STMT-IPS-DATE.
015220190806      *RFS1015600 - Begin
015230190806           MOVE WS-LDA-ENDDTE TO WS-END-DTE-STMT.
015240190806           MOVE WS-LDA-STRDTE TO WS-STR-DTE-STMT.
015250030825      *RFS1015600 - End
015260040712
015270040712R20804* Request scope "A" was changed to "R" in the CL when Rep copy
015280040712   |  * was processed.
015290040712   |
015300040712   |       MOVE "N"      TO WS-DLRREP-FREQ
015310040712   |                        WS-DLR-FREQ
015320040712   |                        WS-REP-FREQ.
015330040712   |
015340040712   |       IF (WS-LDA-REQUEST-SCOPE = "A"   OR
015350040712   |                                  "R")  AND
015360040712   |          WS-LDA-DLRREP-FREQ    = "Y"   AND
015370040712   |         (WS-LDA-CPYSELECT      = "D"   OR
015380040712   |                                = "R")  AND
015390040712   |         (WS-LDA-FREQUENCY-CODE = "AN"  OR
015400040712   |                                  "SA")
015410040712   |         MOVE "Y"    TO WS-DLRREP-FREQ
015420040712   |
015430040712   |         IF WS-LDA-CPYSELECT    = "D"
015440040712   |            MOVE "Y" TO WS-DLR-FREQ
015450040712   |         END-IF
015460040712   |
015470040712   |         IF WS-LDA-CPYSELECT    = "R"
015480040712   |            MOVE "Y" TO WS-REP-FREQ
015490040712   |         END-IF
015500030825R20804     END-IF.
015510030825
015520030825RF7503     MOVE WS-LDA-ENDDTE            TO  WS-MKTVALUE-Q-DATE.
015530030825           MOVE ZEROS                    TO  WS-LOOP-DATE-NUM.
015540030825R10737***
015550030825      *** GIC/DII Accrued interest was calculated more than one day
015560030825      *** of the Statement end date.
015570030825      ***
015580030825           MOVE WS-LDA-ENDDTE            TO  G2J-GREGORIAN
015590030825           MOVE ZEROS                    TO  G2J-JULIAN.
015600030825
015610030825           CALL "GRTOJUPRG" USING
015620030825                                  G2J-GREGORIAN
015630030825                                  G2J-JULIAN.
015640030825
015650030825           ADD 1                         TO  G2J-JULIAN.
015660030825           MOVE G2J-JULIAN               TO  J2G-JULIAN.
015670030825           MOVE ZEROS                    TO  J2G-GREGORIAN.
015680030825
015690030825           CALL "JUTOGRPRG" USING
015700030825                                  J2G-JULIAN
015710030825                                  J2G-GREGORIAN.
015720030825           MOVE J2G-GREGORIAN            TO  WS-GIC-DII-END-DATE.
015730030825
015740030825R10737*** End of rfs10737.
015750030825
015760030825R15880***
015770030825   `  ***      Sets the default Investment Structure Code.
015780030825   `  ***
015790030825
015800030825   `       CALL "FXINRSTRF" USING
015810030825   `                        WS-FXINR-INVESTMENT-CODE
015820030825   `                        WS-MLTFAMFNDD-FUNC-CODE
015830030825   `                        WS-FXINR-INV-STRUCTURE-CODE
015840030825R18147                      WS-DECLARE-INRSTRF.
015850030825
015860030825   `       MOVE WS-FXINR-INV-STRUCTURE-CODE
015870030825   `         TO WS-INVESTMENT-STRUCTURE-CODE-F,
015880030825   `            INVESTMENT-STRUCTURE-CODE OF PROGRAM-THRESHOLDS-REC.
015890030825   `       MOVE "ANNSTMTJ" TO PROGRAM-CODE OF PROGRAM-THRESHOLDS-REC.
015900030825
015910030825   `       READ PROGRAM-THRESHOLDS
015920030825   `            INVALID KEY
015930030825   `              MOVE ZEROES TO WS-INTERNAL-AMT-PREV
015940030825   `              GO TO INL-0002
015950030825   `       END-READ.
015960030825
015970030825   `       MOVE INTERNAL-AMT OF PROGRAM-THRESHOLDS-REC
015980030825   `         TO WS-INTERNAL-AMT-PREV.
015990180627
016000030825
016010041019       INL-0002.
016020120126
016030120126      *RFS93662 Start
016040120126           INITIALIZE MFAEDTSCP of SCREEN-EDITS-ALLOWED-REC.
016050120126           Set lb_OMSEXTYes          TO TRUE
016060120126           MOVE lc_OMSEXTScreenCode  TO SCREEN-CODE OF
016070120126           SCREEN-EDITS-ALLOWED.
016080120126           MOVE lc_OMSEXTEditCode    TO EDIT-CODE   OF
016090120126           SCREEN-EDITS-ALLOWED.
016100120126           MOVE lc_OMSEXTLevelCode   TO LEVEL-CODE  OF
016110120126           SCREEN-EDITS-ALLOWED.
016120120126
016130120126           READ SCREEN-EDITS-ALLOWED
016140120126            INVALID KEY
016150120126             MOVE   lnc_N            TO lb_OMSEXT
016160120126           END-READ.
016170120126
016180120126      *RFS93662 End
016190040712
016200040712R21714     IF WS-LDA-STMT-CNFM-FLAG = "S"
016210040712  ¦           MOVE "STMTJSI" TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED
016220040712  ¦           MOVE "SKPCDE"  TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED
016230040712  ¦           MOVE "A"       TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED
016240040712  ¦           MOVE "Y"       TO WS-SKIP-CODE-VALIDATION
016250040712  ¦
016260040712  ¦           READ SCREEN-EDITS-ALLOWED
016270040712  ¦             INVALID KEY
016280040712  ¦               MOVE "N" TO WS-SKIP-CODE-VALIDATION
016290040712  V           END-READ
016300040712R21714     END-IF.
016310090902
01632009090272750      MOVE lc_StmtjsiScrnCode
016330090902  ¦          TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
016340090902  ¦        MOVE lncc_Stmdis
016350090902  ¦          TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
016360090902  ¦        MOVE lncc_A    TO LEVEL-CODE  OF SCREEN-EDITS-ALLOWED.
016370090902  ¦        MOVE lncc_Yes  TO lc_Edit_Stmdis.
016380090902  ¦
016390090902  ¦        READ SCREEN-EDITS-ALLOWED
016400090902  ¦          INVALID KEY
016410090902  ¦            MOVE lncc_No TO lc_Edit_Stmdis
01642007022772750      END-READ.
016430070227      * RFS38037 Start
016440070227           PERFORM GetOvrGbvEditCode.
016450081120      * RFS38037 End
016460081205
016470081205      * RFS 50492 - Begin
016480081205      * RFS 61342 - Begin
016490101029      * Only apply DRFYTD logic for Mass Stmt Run
016500081205R71834* and Adhoc Run for a specific Dealer
016510081205           INITIALIZE ln_PrevAccountNo
016520081218                      lc_AccFinActivity
016530081205R62153                Ln_AccTotalBal
016540081205                      lc_Edit-Drfytd.
016550081205           IF  WS-LDA-STMT-CNFM-FLAG    IS EQUAL TO "S"
016560110721           AND (WS-LDA-REQUEST-SCOPE    IS EQUAL TO "A"
016570101029R94848     OR  WS-LDA-REQUEST-SCOPE     IS EQUAL TO "E"
016580081205R71834     OR  WS-LDA-REQUEST-SCOPE     IS EQUAL TO "C"
016590081205           OR  WS-LDA-REQUEST-SCOPE     IS EQUAL TO "R")
016600081205               PERFORM GetDrfytdEdtCde
016610081205           END-IF.
016620081205      * RFS 61342 - End
016630070227      * RFS 50492 - End
016640030825
016650030825R15206     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
016660030825           AND WS-LDA-STMT-CNFM-FLAG = "S"
016670030825               MOVE ZEROS                TO  WS-ADHOC-B-FLAG
016680030825               GO TO  INL-0007
016690030825R15206     END-IF.
016700040511
01671004051118194 ***
016720040511  ¦   *** This is the common initialze routine for all Statements
016730040511  ¦   *** and Confirm/Duplicate.
016740040511  ¦   ***
01675004051118194      PERFORM MASS-ADHOC-TABLE-INITIALIZE     THRU MATI-EXIT
016760030825
016770030825RF6362     IF  WS-LDA-REQUEST-SCOPE    IS EQUAL TO  "T"
016780030825           AND WS-LDA-LANGUAGE-CODE    IS EQUAL TO  SPACES
016790030825               MOVE "E"                TO WS-LDA-LANGUAGE-CODE
016800030825           END-IF.
016810030825
016820030825RF6362     IF  WS-LDA-REQUEST-SCOPE    IS NOT EQUAL TO  "I"
016830030825           AND WS-LDA-REQUEST-SCOPE    IS NOT EQUAL TO  "T"
016840030825               GO TO INL-0007.
016850030825
016860030825      ****
016870030825      **** Add account based statement generation for an investor
016880030825      **** Read in investor no from account file
016890030825      ****
016900030825
016910030825980316     IF  WS-LDA-STMT-CNFM-FLAG NOT = "S"
016920030825980316         OR WS-LDA-STATEMENT-TYPE NOT = "A"
016930030825               GO TO INL-0005.
016940030825
016950030825980316     MOVE WS-LDA-ACCOUNT-NO TO ACCOUNT-NO OF ACCOUNT.
016960030825
016970030825980316     READ ACCOUNT
016980030825980316         INVALID KEY
016990030825980316         MOVE HIGH-VALUES   TO CURR-CONTROLS
017000030825980316         GO TO INL-EXIT.
017010030825
017020030825980316     INITIALIZE MFAACOJLA.
017030030825980316     MOVE INVESTOR-NO OF ACCOUNT TO ACIVRNO
017040030825980316                                OF INVESTOR-JOIN.
017050030825980316     MOVE WS-LDA-ACCOUNT-NO  TO  ACACTNO
017060030825980316                                OF INVESTOR-JOIN.
017070030825980316     GO TO INL-0006.
017080030825
017090030825      /
017100030825       INL-0005.
017110030825980316     INITIALIZE MFAACOJLA.
017120030825980316     MOVE WS-LDA-INVESTOR-NO TO  ACIVRNO
017130030825980316                                 OF INVESTOR-JOIN.
017140030825980316     MOVE ZEROES             TO  ACACTNO
017150030825980316                                 OF INVESTOR-JOIN.
017160030825      /
017170030825       INL-0006.
017180030825           START INVESTOR-JOIN
017190030825             KEY   IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
017200030825               INVALID KEY
017210030825                 MOVE HIGH-VALUES TO CURR-CONTROLS
017220030825                 GO TO INL-EXIT.
017230030825      /
017240030825       INL-0007.
017250030825      *****
017260030825      *****    Load the account type entries.
017270030825      *****
017280030825
017290030825           MOVE SPACES                 TO  WS-ACCTYP-TBL.
017300030825           MOVE ZEROES                 TO  WS-AT-LST.
017310030825
017320030825       INL-0010.
017330030825           READ ACCOUNT-TYPE-BK        AT  END
017340030825               GO TO INL-0020.
017350030825
017360030825           IF  WS-AT-LST IS NOT LESS THAN  WS-AT-MAX
017370030825               DISPLAY "ACCOUNT TYPES (MFAACTYP) EXCEED PROGRAM MAX"
017380030825               GO TO INL-0030.
017390030825
017400030825           ADD 1                       TO  WS-AT-LST.
017410030825           SET AT1                     TO  WS-AT-LST.
017420030825           MOVE ACCOUNT-TYPE-CODE
017430030825                OF ACCOUNT-TYPE-BK-REC TO  WS-AT-CODE (AT1).
017440030825           MOVE ACCOUNT-TYPE-RULE
017450030825                OF ACCOUNT-TYPE-BK-REC TO  WS-AT-RULE (AT1).
017460030825
017470030825           INITIALIZE MFAACTYLP.
017480030825           MOVE ACCOUNT-TYPE-CODE
017490030825                OF ACCOUNT-TYPE-BK-REC TO  ACCOUNT-TYPE-CODE
017500030825                                           OF ACCOUNT-TYPE-LANG-REC.
017510030825           START ACCOUNT-TYPE-LANG
017520030825               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
017530030825               INVALID KEY
017540030825                   GO TO INL-0010-0020.
017550030825
017560030825       INL-0010-0010.
017570030825           READ ACCOUNT-TYPE-LANG NEXT AT  END
017580030825               GO TO INL-0010-0020.
017590030825
017600030825           IF  ACCOUNT-TYPE-CODE
017610030825               OF ACCOUNT-TYPE-LANG-REC
017620030825                          IS NOT EQUAL TO  ACCOUNT-TYPE-CODE
017630030825                                           OF ACCOUNT-TYPE-BK
017640030825               GO TO INL-0010-0020.
017650030825
017660030825           IF  LANGUAGE-CODE
017670030825               OF ACCOUNT-TYPE-LANG-REC
017680030825                              IS EQUAL TO  "E"
017690030825               SET ATL                 TO  1
017700030825               MOVE ACCOUNT-TYPE-DESCR
017710030825                    OF ACCOUNT-TYPE-LANG-REC
017720030825                                       TO  WS-AT-DESC (AT1, ATL).
017730030825
017740030825           IF  LANGUAGE-CODE
017750030825               OF ACCOUNT-TYPE-LANG-REC
017760030825                              IS EQUAL TO  "F"
017770030825               SET ATL                 TO  2
017780030825               MOVE ACCOUNT-TYPE-DESCR
017790030825                    OF ACCOUNT-TYPE-LANG-REC
017800030825                                       TO  WS-AT-DESC (AT1, ATL).
017810030825
017820030825           GO TO INL-0010-0010.
017830030825
017840030825       INL-0010-0020.
017850030825           GO TO INL-0010.
017860030825
017870030825       INL-0020.
017880030825           IF  WS-AT-LST NOT GREATER THAN  ZEROES
017890030825               DISPLAY "NO ACCOUNT TYPES (MFAACTYP) FOUND".
017900030825
017910030825       INL-0030.
017920030825      /
017930030825      *****
017940030825      *****    Load the investor type entries.
017950030825      *****
017960030825
017970030825           MOVE SPACES                 TO  WS-INVTYP-TBL.
017980030825           MOVE ZEROES                 TO  WS-IT-LST.
017990030825
018000030825       INL-0040.
018010030825           READ INVESTOR-TYPE          AT  END
018020030825               GO TO INL-0050.
018030030825
018040030825           IF  WS-IT-LST IS NOT LESS THAN  WS-IT-MAX
018050030825               DISPLAY "INVESTOR TYPES (MFAIVRTYP) EXCEED PROGRAM MAX"
018060030825               GO TO INL-0030-0010.
018070030825
018080030825           ADD 1                       TO  WS-IT-LST.
018090030825           SET IT                      TO  WS-IT-LST.
018100030825           MOVE INVESTOR-TYPE-CODE
018110030825                OF INVESTOR-TYPE-REC   TO  WS-IT-CODE (IT).
018120030825           MOVE INVESTOR-CATEGORY
018130030825                OF INVESTOR-TYPE-REC   TO  WS-IT-CAT (IT).
018140030825           MOVE INVESTOR-TYPE-DESCR
018150030825                OF INVESTOR-TYPE-REC   TO  WS-IT-DESC (IT).
018160030825           GO TO INL-0040.
018170030825
018180030825       INL-0050.
018190030825           IF  WS-IT-LST NOT GREATER THAN  ZEROES
018200030825               DISPLAY "NO INVESTOR TYPES (MFAIVRTYP) FOUND".
018210030825
018220030825R11036 INL-0030-0010.
018230030825      /
018240030825      *****
018250030825      *****    Load the investment-structure entries only Investment
018260030825      *****    structure was required.
018270030825      *****
018280030825
018290030825           MOVE SPACES                 TO  WS-INVSTR-TBL.
018300090914           MOVE ZEROES                 TO  WS-ISC-LST.
018310090914R64527***  MOVE 500 TO ln_Array-Size-ISC.   R72304
018320040109R72304     MOVE 1   TO ln_Array-Size-ISC.
018330040109R20363     MOVE WS-LDA-INVESTMENT-STRUCTURE TO
018340030825                                    WS-INVESTMENT-STRUCTURE-CODE.
018350031007
018360031007R18485     MOVE "OPEN-INVSXC1" TO WS-SQLERR-STATEMENT.
018370031007 |         EXEC SQL
018380031007 |            OPEN INVSXC1
018390031007 V         END-EXEC.
018400090501           MOVE "FETCH NEXT FROM INVSXC1" TO WS-SQLERR-STATEMENT.
018410090501R64527***  EXEC SQL
018420090501R64527***     FETCH NEXT FROM INVSXC1
018430090501R64527***     FOR :WS-ISC-MAX  ROWS
018440090501R64527***     INTO :WS-INVSTR-ENT
018450090501R64527***  END-EXEC.
018460090501R64527
018470090501R64527     SET ISC           TO 1.
018480090501R64527     SET ISC      DOWN BY 1.
018490090501R64527
018500090501R64527     EXEC SQL
018510090501R64527        FETCH NEXT FROM INVSXC1
018520090501R64527        INTO :WX-ISC-STRCODE   ,
018530090501R64527             :WX-ISC-INVCODE
018540090501R64527     END-EXEC.
018550090501R64527     PERFORM UNTIL SQLSTATE NOT = '00000'
018560090501R64527        COMPUTE WS-ISC-LST = WS-ISC-LST + 1
018570090501R64527        SET ISC      UP BY 1
018580090501R64527        IF ISC      >= ln_Array-size-ISC
018590090914R64527           COMPUTE ln_Array-size-ISC  =
018600090914R72304                   ln_Array-size-ISC  + 1
018610090501R64527***                ln_Array-size-ISC  + 500     R72304
018620090501R64527        END-IF
018630090501R64527        MOVE WX-ISC-STRCODE      TO
018640090501R64527                WS-ISC-STRCODE (ISC)
018650090501R64527        MOVE WX-ISC-INVCODE      TO
018660090501R64527                WS-ISC-INVCODE (ISC)
018670090501R64527        EXEC SQL
018680090501R64527          FETCH NEXT FROM INVSXC1
018690090501R64527          INTO :WX-ISC-STRCODE   ,
018700090501R64527               :WX-ISC-INVCODE
018710090501R64527        END-EXEC
018720090914R64527     END-PERFORM.
018730090914R72304     SET ISC      UP BY 1
018740090501R72304     INITIALIZE     WS-INVSTR-ENT-ELEMENT(ISC).
018750090501R64527
018760090501R64527***  IF SQLCODE = 0
018770090501R64527***     COMPUTE WS-ISC-LST = SQLERRD(3)
018780031007R64527***  END-IF.
018790031007           EXEC SQL
018800031007              CLOSE INVSXC1
018810031007           END-EXEC.
018820031007           IF  WS-ISC-LST NOT GREATER THAN  ZEROES
018830031007               DISPLAY "NO INVESTMENT STRUCTURE (MFAINVSXLA) FOUND"
018840090219           END-IF.
018850090219R64057*    IF  WS-ISC-LST = WS-ISC-MAX
018860031007R64057     IF  WS-ISC-LST >= WS-ISC-MAX
018870031007               DISPLAY "INVESTMENT STRUCTURE EXCEED TABLE MAX"
018880030825           END-IF.
018890051003
018900051003R14153 INL-0030-0020.
018910051003  ¦   /
018920051003  ¦   *****
018930051003  ¦   *****    Load the Contr-Redem-Code-Rules Table.
018940051003  ¦   *****
018950051003  ¦
018960051003  ¦        MOVE SPACES                 TO  WS-CONTR-REDEM-TBL.
018970090924  ¦        MOVE ZEROES                 TO  WS-CRC-LST.
018980090914R64527***  MOVE 500 TO ln_Array-Size-CRC.    R72304
018990051003R72304     MOVE 1   TO ln_Array-Size-CRC.
019000051003  ¦
019010051003  ¦        MOVE "OPEN-CNTRRPC1" TO WS-SQLERR-STATEMENT.
019020051003  ¦        EXEC SQL
019030051003  ¦           OPEN CNTRRPC1
019040051003  ¦        END-EXEC.
019050051003  ¦
019060090501  ¦        MOVE "FETCH NEXT FROM CNTRRPC1" TO WS-SQLERR-STATEMENT.
019070090501R64527***  EXEC SQL
019080090501R64527***     FETCH NEXT FROM CNTRRPC1
019090090501R64527***     FOR :WS-CRC-MAX  ROWS
019100090501R64527***     INTO :WS-CONTR-REDEM-ENT
019110090501R64527***  END-EXEC.
019120090501R64527
019130090501R64527     SET CRC           TO 1.
019140090501R64527     SET CRC      DOWN BY 1.
019150090501R64527
019160090501R64527     EXEC SQL
019170090501R64527        FETCH NEXT FROM CNTRRPC1
019180090501R64527        INTO :WX-CRC-ACCTYPCODE
019190090501R64527          ,  :WX-CRC-REDEMCODE
019200090501R64527          ,  :WX-CRC-REDEMRULE
019210090501R64527     END-EXEC.
019220090501R64527     PERFORM UNTIL SQLSTATE NOT = '00000'
019230090501R64527        SET CRC      UP BY 1
019240090501R64527        COMPUTE WS-CRC-LST = WS-CRC-LST + 1
019250090501R64527        IF CRC      >= ln_Array-size-CRC
019260090914R64527           COMPUTE ln_Array-size-CRC  =
019270090914R72304                   ln_Array-size-CRC  + 1
019280090501R64527***                ln_Array-size-CRC  + 500    R72304
019290090501R64527        END-IF
019300090501R64527        MOVE  WX-CRC-ACCTYPCODE
019310090501R64527          TO  WS-CRC-ACCTYPCODE (CRC)
019320090501R64527        MOVE  WX-CRC-REDEMCODE
019330090501R64527          TO  WS-CRC-REDEMCODE (CRC)
019340090501R64527        MOVE  WX-CRC-REDEMRULE
019350090501R64527          TO  WS-CRC-REDEMRULE (CRC)
019360090501R64527        EXEC SQL
019370090501R64527        FETCH NEXT FROM CNTRRPC1
019380090501R64527        INTO :WX-CRC-ACCTYPCODE
019390090501R64527          ,  :WX-CRC-REDEMCODE
019400090501R64527          ,  :WX-CRC-REDEMRULE
019410090501R64527        END-EXEC
019420090914R64527     END-PERFORM.
019430090914R72304     SET CRC      UP BY 1
019440051003R72304     INITIALIZE      WS-CONTR-REDEM-ENT-ELEMENT(CRC).
019450090501  ¦
019460090501R64527*    IF SQLCODE = 0
019470090501R64527*       COMPUTE WS-CRC-LST = SQLERRD(3)
019480051003R64527*    END-IF.
019490051003  ¦
019500051003  ¦        EXEC SQL
019510051003  ¦           CLOSE CNTRRPC1
019520051003  ¦        END-EXEC.
019530051003  ¦
019540051003  ¦        IF WS-CRC-LST NOT GREATER THAN  ZEROES
019550051003  ¦           DISPLAY "No Contr-Derem-Code-Rules(MFACNTRRP) found"
019560051003  ¦        END-IF.
019570051003  ¦
019580051003  ¦        IF WS-CRC-LST >= WS-CRC-MAX
019590051003  ¦           DISPLAY "CONTR-REDEM-CODE-RULES Table reached Max"
019600051003  ¦        END-IF.
019610051003  ¦
019620051003  ¦    INL-0030-0030.
019630051003  ¦   /
019640051003  ¦   *****
019650051003  ¦   *****    Load the INVESTMENT-GROUP-CATEGORY-DESCR TABLE.
019660051003  ¦   *****
019670051003  ¦
019680051003  ¦        MOVE SPACES                 TO  WS-INV-GRP-CAT-TBL.
019690051003  ¦        MOVE ZEROES                 TO  WS-INVGC-LST.
019700051003  ¦
019710051003  ¦        MOVE "OPEN-INVGDPC1" TO WS-SQLERR-STATEMENT.
019720051003  ¦        EXEC SQL
019730051003  ¦           OPEN INVGDPC1
019740051003  ¦        END-EXEC.
019750051003  ¦
019760051003  ¦        MOVE "FETCH NEXT FROM INVGDPC1" TO WS-SQLERR-STATEMENT.
019770051003  ¦        EXEC SQL
019780051003  ¦           FETCH NEXT FROM INVGDPC1
019790051003  ¦           FOR :WS-INVGC-MAX ROWS
019800051003  ¦           INTO :WS-INV-GRP-CAT-ENT
019810051003  ¦        END-EXEC.
019820051003  ¦
019830051003  ¦        IF SQLCODE = 0
019840051003  ¦           COMPUTE WS-INVGC-LST = SQLERRD(3)
019850051003  ¦        END-IF.
019860051003  ¦
019870051003  ¦        EXEC SQL
019880051003  ¦           CLOSE INVGDPC1
019890051003  ¦        END-EXEC.
019900051003  ¦
019910051003  ¦        IF WS-INVGC-LST NOT GREATER THAN  ZEROES
019920051003  ¦           DISPLAY "No INV-GROUP-CATEGORY-DESCRP (MFAINVGDP) found"
019930051003  ¦        END-IF.
019940051003  ¦
019950051003  ¦        IF WS-INVGC-LST >= WS-INVGC-MAX
019960051003  v           DISPLAY "INVESTMENT-GROUP-CATEGORY-DESCR reached Max"
019970030825R14153     END-IF.
019980030825       INL-0060.
019990030825      /
020000030825      *****
020010030825      *****    Load the nominee account type entries.
020020030825      *****
020030030825
020040030825           MOVE SPACES                 TO  WS-NOMACC-TBL.
020050030825           MOVE ZEROES                 TO  WS-NA-LST.
020060030825
020070030825       INL-0070.
020080030825           READ NOMINEE-ACCOUNT-TYPE-DESCR
020090030825                                       AT  END
020100030825               GO TO INL-0080.
020110030825
020120030825           IF  WS-NA-LST IS NOT LESS THAN  WS-NA-MAX
020130030825               DISPLAY "NOMINEE ACCT TYPES (MFANMTPYP) EXCEED PGM MAX"
020140030825               GO TO INL-0090.
020150030825
020160030825           ADD 1                       TO  WS-NA-LST.
020170030825           SET NA                      TO  WS-NA-LST.
020180030825           MOVE NOMINEE-ACCOUNT-TYPE
020190030825                OF NOMINEE-ACCOUNT-TYPE-DESCR-REC
020200030825                                       TO  WS-NA-TYPE (NA).
020210030825           MOVE ACCOUNT-TYPE-DESCR
020220030825                OF NOMINEE-ACCOUNT-TYPE-DESCR-REC
020230030825                                       TO  WS-NA-DESC (NA).
020240030825           MOVE LANGUAGE-CODE
020250030825                OF NOMINEE-ACCOUNT-TYPE-DESCR-REC
020260030825                                       TO  WS-NA-LANG (NA).
020270030825           GO TO INL-0070.
020280030825
020290030825       INL-0080.
020300030825           IF  WS-NA-LST NOT GREATER THAN  ZEROES
020310030825               DISPLAY "NO NOMINEE ACCOUNT TYPES (MFANMTPYP) FOUND".
020320030825
020330030825       INL-0090.
020340030825      /
020350030825      *****
020360030825      *****    Load the reversal reason entries.
020370030825      *****
020380030825
020390030825           MOVE SPACES                 TO  WS-RVSRSN-TBL.
020400030825           MOVE ZEROES                 TO  WS-RR-LST.
020410030825
020420030825       INL-0180.
020430030825           READ REVERSAL-REASON-BK     AT  END
020440030825               GO TO INL-0190.
020450030825
020460030825           IF  WS-RR-LST IS NOT LESS THAN  WS-RR-MAX
020470030825               DISPLAY "REVERSAL REASONS (MFARVRP) EXCEED PROGRAM MAX"
020480030825               GO TO INL-0200.
020490030825
020500030825           ADD 1                       TO  WS-RR-LST.
020510030825           SET RR                      TO  WS-RR-LST.
020520030825           MOVE REVERSAL-CODE
020530030825                OF REVERSAL-REASON-BK-REC
020540030825                                       TO  WS-RR-CODE (RR).
020550030825           MOVE REVERSAL-DESCR
020560030825                OF REVERSAL-REASON-BK-REC
020570030825                                       TO  WS-RR-DESC (RR).
020580030825R16913     MOVE REVERSAL-RULE
020590030825                OF REVERSAL-REASON-BK-REC
020600030825                                       TO  WS-RR-RULE (RR).
020610030825           GO TO INL-0180.
020620030825
020630030825       INL-0190.
020640030825           IF  WS-RR-LST NOT GREATER THAN  ZEROES
020650030825               DISPLAY "NO REVERSAL REASONS (MFARVRP) FOUND".
020660030825
020670030825       INL-0200.
020680030825      /
020690030825      *****
020700030825      *****    Load the transaction contribution/redemption entries.
020710030825      *****
020720030825
020730030825           MOVE SPACES                 TO  WS-CTBRED-TBL.
020740090914           MOVE ZEROES                 TO  WS-CR-LST.
020750090914R64527***  MOVE 500 TO ln_Array-size-CR.   R72304
020760030825R72304     MOVE 1   TO ln_Array-size-CR.
020770030825
020780031007       INL-0210.
020790031007R18485     MOVE "OPEN-TRNCDC1" TO WS-SQLERR-STATEMENT.
020800031007 |         EXEC SQL
020810031007 |            OPEN TRNCDC1
020820031007 |         END-EXEC.
020830090501 |         MOVE "FETCH NEXT FROM TRNCDC1" TO WS-SQLERR-STATEMENT.
020840090501R64527***  EXEC SQL
020850090501R64527***     FETCH NEXT FROM TRNCDC1
020860090501R64527***     FOR :WS-CR-MAX ROWS
020870090501R64527***     INTO :WS-CTBRED-ENT
020880090501R64527***  END-EXEC.
020890090501R64527***  IF SQLCODE = 0
020900090501R64527***     COMPUTE WS-CR-LST = SQLERRD(3)
020910090501R64527***  END-IF.
020920090501R64527
020930090501R64527     SET CR            TO 1.
020940090501R64527     SET CR       DOWN BY 1.
020950090501R64527
020960090501R64527     EXEC SQL
020970090501R64527        FETCH NEXT FROM TRNCDC1
020980090501R64527        INTO :WX-CR-CODE
020990090501R64527          ,  :WX-CR-LANG
021000090501R64527          ,  :WX-CR-DESC
021010090501R64527     END-EXEC.
021020090501R64527     PERFORM UNTIL SQLSTATE NOT = '00000'
021030090501R64527        SET CR       UP BY 1
021040090501R64527        COMPUTE WS-CR-LST = WS-CR-LST + 1
021050090501R64527        IF  CR      >= ln_Array-size-CR
021060090914R64527           COMPUTE ln_Array-size-CR   =
021070090914R72304                   ln_Array-size-CR   + 1
021080090501R64527***                ln_Array-size-CR   + 500    R72304
021090090501R64527        END-IF
021100090501R64527        MOVE WX-CR-CODE          TO
021110090501R64527                WS-CR-CODE     (CR)
021120090501R64527        MOVE WX-CR-LANG          TO
021130090501R64527                WS-CR-LANG     (CR)
021140090501R64527        MOVE WX-CR-DESC          TO
021150090501R64527                WS-CR-DESC     (CR)
021160090501R64527        EXEC SQL
021170090501R64527        FETCH NEXT FROM TRNCDC1
021180090501R64527        INTO :WX-CR-CODE
021190090501R64527          ,  :WX-CR-LANG
021200090501R64527          ,  :WX-CR-DESC
021210090501R64527        END-EXEC
021220090914R64527     END-PERFORM.
021230090914R72304     SET CR       UP BY 1
021240031007R72304     INITIALIZE      WS-CTBRED-ENT-ELEMENT(CR).
021250031007           EXEC SQL
021260031007              CLOSE TRNCDC1
021270031007           END-EXEC.
021280090219
021290090219R64057*    IF WS-CR-LST = WS-CR-MAX
021300031007R64057     IF WS-CR-LST >= WS-CR-MAX
021310031007              DISPLAY "CONTRIB/REDEMP CODES EXCEED TABLE MAX"
021320031007           END-IF.
021330031007           IF WS-CR-LST = 0
021340031007              DISPLAY "NO CONTRIB/REDEMP CODES (MFATRNCDP) FOUND"
021350061004           END-IF.
021360061004R34848*RFS34848 - Start
021370061004      *****
021380061004      *****   For confirmation and requested;
021390061004      *****   Load the deduction description entries (English & French)
021400061004      *****
021410061004           IF WS-LDA-STMT-CNFM-FLAG = lnc_C   AND
021420061004              lc-LdaSection81    =    lnc_Y
021430061004              PERFORM LOAD-DEDUCTION-DESCRIPTION
021440061004           END-IF.
021450031007R34848*RFS34848 - End
021460030825
021470030825       INL-0230.
021480030825      /
021490030825      *****
021500030825      *****    Load the investment group entries and the asset class
021510030825      *****    entries.  The driving file is the Investment Group.  For
021520030825      *****    each record, create a table entry as follows.
021530030825      *****       1. Format the table entry using the Investment Group.
021540030825      *****       2. Read the Investment Group Category for the
021550030825      *****          description.
021560030825      *****       3. Using the passed AS AT DATE and the Investment
021570030825      *****          Group Weighting Header, determine which date of
021580030825      *****          weighting is to be used, if any.
021590030825      *****       4. If weighting is applicable for the group, read
021600030825      *****          through the Investment Group Weighting Detail.  For
021610030825      *****          each record read, the following will be executed.
021620030825      *****             a) Find the Asset Class Code table entry.  If it
021630030825      *****                is not found, create the new Asset Class Code
021640030825      *****                table entry using the Account Class
021650030825      *****                Description.
021660030825      *****             b) Read through the Investment Group Weighting
021670030825      *****                Sub-class Detail.  For each sub-class found,
021680030825      *****                find the Asset Sub-class Code, in the Asset
021690030825      *****                Class Code table, entry.  If it is not found,
021700030825      *****                create the new Asset Sub-class table entry
021710030825      *****                using the Account Class Description.  If the
021720030825      *****                sub-class percentage total does not equal
021730030825      *****                zero or 100%, the difference will be assigned
021740030825      *****                to the undefined sub-class.
021750030825      *****             c) If the class percentage total does not equal
021760030825      *****                zero or 100%, the difference will be assigned
021770030825      *****                to the undefined class.
021780030825      *****       5. If weighting is applicable, the following checks
021790030825      *****          will be performed.  If an error is detected, the
021800030825      *****          specified action will be performed.
021810030825      *****             a) All investment groups must have at least one
021820030825      *****                Asset Class specified.  If an investment
021830030825      *****                group is not specified, it will be assigned
021840030825      *****                to the undefined asset class.
021850030825      *****             b) If an Account Class has at least one
021860030825      *****                Sub-class speicifed, all investment groups
021870030825      *****                with the Account Class must also have at
021880030825      *****                least one Sub-class specified.  If an
021890030825      *****                investment group with the Account Class is
021900030825      *****                found without a Sub-class, it will be
021910030825      *****                assigned to the undefined asset sub-class.
021920030825      *****
021930030825
021940030825r13017     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
021950030825           AND WS-LDA-STMT-CNFM-FLAG = "S"
021960030825               GO TO  INL-0260
021970030825R13017     END-IF.
021980040511
021990030825r14142     PERFORM ADHOC-IN-BATCH-ASSET-CLASS     THRU AIBAC-EXIT.
022000030825
022010030825       INL-0260.
022020030825      /
022030030825      *****
022040030825      *****    Load the investment code entries.
022050030825      *****
022060030825
022070030825           MOVE SPACES                 TO  WS-INVCDE-TBL.
022080090914           MOVE ZEROES                 TO  WS-IC-LST.
022090090914R72304     MOVE 1   TO ln_Array-Size-XX.
022100030825R64527***  MOVE 500 TO ln_Array-Size-XX.   R72304
022110031007
022120031007R18485     MOVE "OPEN-INVCDC1" TO WS-SQLERR-STATEMENT.
022130031007 |         EXEC SQL
022140031007 |           OPEN INVCDC1
022150031007 |         END-EXEC.
022160090501 |         MOVE "FETCH NEXT FROM INVCDC1" TO WS-SQLERR-STATEMENT.
022170090501R64527***  EXEC SQL
022180090501R64527***    FETCH NEXT FROM INVCDC1
022190090501R64527***    FOR :WS-IC-MAX ROWS
022200090501R64527***    INTO :WS-INVCDE-ENT
022210090501R64527***  END-EXEC.
022220090501R64527***
022230090501R64527***  IF SQLCODE = 0
022240090501R64527***     COMPUTE WS-IC-LST = SQLERRD(3)
022250090501R64527***  END-IF.
022260090501R64527
022270090501R64527     SET ICS           TO 1.
022280090501R64527     SET ICS      DOWN BY 1.
022290090501R64527
022300090501R64527     EXEC SQL
022310090501R64527        FETCH NEXT FROM INVCDC1
022320090501R64527        INTO :WX-IC-CODE
022330090501R64527          ,  :WX-IC-CURR
022340090501R64527          ,  :WX-IC-FRGN
022350090501R64527          ,  :WX-IC-FUND
022360090501R64527          ,  :WX-IC-GRP
022370090501R64527          ,  :WX-IC-LOAD
022380090501R64527          ,  :WX-IC-LSTPRC
022390090501R64527          ,  :WX-IC-PROD
022400090501R64527          ,  :WX-IC-NAME-E
022410160613R64527          ,  :WX-IC-NAME-F
022420160613156335          ,  :Wx-IC-EXT-LOAD-TYP
022430160613156335          ,  :Wx-IC-EXT-LOAD-DESC
022440090501156335          ,  :Wx-IC-INV-GRP-CAT
022450190425R64527     END-EXEC.
022460190425      * RFS183538 - Start
022470190425      *     PERFORM UNTIL SQLSTATE NOT = '00000'
022480190425R64527      PERFORM UNTIL (SQLSTATE NOT = '00000'
022490190425                            AND SQLSTATE NOT = '01004'
022500190425                            AND SQLSTATE NOT = '01003')
022510090501      * RFS183538 - End
022520090501R64527        SET ICS      UP BY 1
022530090501R64527        COMPUTE WS-IC-LST = WS-IC-LST + 1
022540090501R64527        IF  ICS     >= ln_Array-size-XX
022550090914R64527           COMPUTE ln_Array-size-XX   =
022560090914R72304                   ln_Array-size-XX   + 1
022570090501R64527***                ln_Array-size-XX   + 500   R72304
022580090501R64527        END-IF
022590090501R64527        MOVE  WX-IC-CODE                TO
022600090501R64527              WS-IC-CODE                (ICS)
022610090501R64527        MOVE  WX-IC-CURR                TO
022620090501R64527              WS-IC-CURR                (ICS)
022630090501R64527        MOVE  WX-IC-FRGN                TO
022640090501R64527              WS-IC-FRGN                (ICS)
022650090501R64527        MOVE  WX-IC-FUND                TO
022660090501R64527              WS-IC-FUND                (ICS)
022670090501R64527        MOVE  WX-IC-GRP                 TO
022680090501R64527              WS-IC-GRP                 (ICS)
022690090501R64527        MOVE  WX-IC-LOAD                TO
022700090501R64527              WS-IC-LOAD                (ICS)
022710090501R64527        MOVE  WX-IC-LSTPRC              TO
022720090501R64527              WS-IC-LSTPRC              (ICS)
022730090501R64527        MOVE  WX-IC-PROD                TO
022740090501R64527              WS-IC-PROD                (ICS)
022750090501R64527        MOVE  WX-IC-NAME-E              TO
022760090501R64527              WS-IC-NAME-E              (ICS)
022770160613R64527        MOVE  WX-IC-NAME-F              TO
022780160613R64527              WS-IC-NAME-F              (ICS)
022790160613156335        MOVE  WX-IC-EXT-LOAD-TYP        TO
022800160613156335              WS-IC-EXT-LOAD-TYP        (ICS)
022810160613156335        MOVE  WX-IC-EXT-LOAD-DESC       TO
022820160613156335              WS-IC-EXT-LOAD-DESC       (ICS)
022830160613156335        MOVE  WX-IC-INV-GRP-CAT         TO
022840090501156335              WS-IC-INV-GRP-CAT         (ICS)
022850090501R64527     EXEC SQL
022860090501R64527        FETCH NEXT FROM INVCDC1
022870090501R64527        INTO :WX-IC-CODE
022880090501R64527          ,  :WX-IC-CURR
022890090501R64527          ,  :WX-IC-FRGN
022900090501R64527          ,  :WX-IC-FUND
022910090501R64527          ,  :WX-IC-GRP
022920090501R64527          ,  :WX-IC-LOAD
022930090501R64527          ,  :WX-IC-LSTPRC
022940090501R64527          ,  :WX-IC-PROD
022950090501R64527          ,  :WX-IC-NAME-E
022960160613R64527          ,  :WX-IC-NAME-F
022970160613156335          ,  :Wx-IC-EXT-LOAD-TYP
022980160613156335          ,  :Wx-IC-EXT-LOAD-DESC
022990090501156335          ,  :Wx-IC-INV-GRP-CAT
023000090501R64527     END-EXEC
023010090914R64527     END-PERFORM.
023020090914R72304     SET ICS      UP BY 1
023030031007R72304     INITIALIZE      WS-INVCDE-ENT-ELEMENT(ICS).
023040031007 |
023050031007 |         EXEC SQL
023060031007 |           CLOSE INVCDC1
023070031007 |         END-EXEC.
023080090219 |
023090090219R64057*    IF WS-IC-LST  =  WS-IC-MAX
023100031007R64057     IF WS-IC-LST  >=  WS-IC-MAX
023110031007 |            DISPLAY "INVESTMENTS EXIT TABLE MAX"
023120031007 ¦         END-IF.
023130031007 |         IF WS-IC-LST NOT GREATER THAN  ZEROES
023140031007 |            DISPLAY "NO INVESTMENTS (MFAINVP) FOUND"
023150031007 |            MOVE HIGH-VALUES        TO  CURR-CONTROLS
023160031007 V            GO TO INL-EXIT
023170040511           END-IF.
023180040511R18194     IF WS-LDA-REQUEST-SCOPE        IS NOT EQUAL TO "A"
023190040511   ¦          GO TO INL-0300
023200031007R18194     END-IF.
023210031007R18485     MOVE SPACES                 TO  WS-INVUPE-TBL.
023220031007   |       MOVE ZEROES                 TO  WS-IUP-LST.
023230031007   |       SET  IUP                    TO  1.
023240151124   V       SET  IC                     TO  1.
023250031007152637     MOVE 1                      TO  ln_Array-size-iup.
023260031007       INL-0290.
023270031007RF6234     PERFORM POPULATE-INVESTMENT-PRICE-TBL  THRU  PIPT-EXIT
023280031007           IF IUP < WS-IC-LST
023290031007              SET  IUP UP BY 1
023300031007              SET  IC  UP BY 1
023310031007              GO TO INL-0290
023320030825           END-IF.
023330030825       INL-0300.
023340030825           IF  WS-IC-LST NOT GREATER THAN  ZEROES
023350030825               DISPLAY "NO INVESTMENTS (MFAINVP) FOUND"
023360030825               MOVE HIGH-VALUES        TO  CURR-CONTROLS
023370030825               GO TO INL-EXIT.
023380030825       INL-0310.
023390030825      /
023400030825      *****
023410030825      *****    Load the transaction type entries.
023420030825      *****
023430030825           MOVE "ACCSTMT   "           TO  WS-FORM-CODE.
023440030825           MOVE SPACES                 TO  WS-TRNTYP-TBL.
023450030825           MOVE ZEROES                 TO  WS-TT-LST.
023460030825           INITIALIZE MFATTRDSP.
023470030825           MOVE WS-FORM-CODE           TO  FORM-CODE
023480030825                                           OF TRANS-TYPE-DESC-REC.
023490030825           START TRANS-TYPE-REPORT-DESCR
023500030825               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
023510030825               INVALID KEY
023520030825                   GO TO INL-0330.
023530030825       INL-0320.
023540030825           READ TRANS-TYPE-REPORT-DESCR NEXT
023550030825                                       AT  END
023560030825               GO TO INL-0330.
023570030825           IF  FORM-CODE
023580030825               OF TRANS-TYPE-DESC-REC
023590030825                          IS NOT EQUAL TO  WS-FORM-CODE
023600030825               GO TO INL-0330.
023610030825
023620030825           IF  WS-TT-LST IS NOT LESS THAN  WS-TT-MAX
023630030825               DISPLAY "TRAN TYPE DESC (MFATTRDSP) EXCEED PROGRAM MAX"
023640030825               GO TO INL-0340.
023650030825           ADD 1                       TO  WS-TT-LST.
023660030825           SET TT                      TO  WS-TT-LST.
023670030825           MOVE TRANS-TYPE-CODE
023680030825                OF TRANS-TYPE-DESC-REC TO  WS-TT-CODE (TT).
023690030825           MOVE TRANS-STATUS-CODE
023700030825                OF TRANS-TYPE-DESC-REC TO  WS-TT-STAT (TT).
023710030825R 2865     MOVE TRANS-ORIGIN-CODE
023720030825R12865          OF TRANS-TYPE-DESC-REC TO  WS-TT-ORIGIN-CODE (TT).
023730030825           MOVE LANGUAGE-CODE
023740030825                OF TRANS-TYPE-DESC-REC TO  WS-TT-LANG (TT).
023750030825           MOVE TRANS-TYPE-CODE-DESCR
023760030825                OF TRANS-TYPE-DESC-REC TO  WS-TT-DESC (TT).
023770030825           GO TO INL-0320.
023780030825
023790030825       INL-0330.
023800030825           IF  WS-TT-LST NOT GREATER THAN  ZEROES
023810030825               DISPLAY "NO TRAN TYPE DESC (MFATTRDSP) FOUND".
023820030825
023830030825       INL-0340.
023840030825      /
023850030825      *****
023860030825      *****    Load the product type code entries.
023870030825      *****
023880030825
023890030825           MOVE SPACES                 TO  WS-PRDTYP-TBL.
023900030825           MOVE ZEROES                 TO  WS-PT-LST.
023910030825
023920030825       INL-0350.
023930030825           READ PRODUCT-TYPE-CODES     AT  END
023940030825               GO TO INL-0360.
023950030825
023960030825           IF  WS-PT-LST IS NOT LESS THAN  WS-PT-MAX
023970030825               DISPLAY "PRODUCT TYPES (MFAPRTCDP) EXCEED PROGRAM MAX"
023980030825               GO TO INL-0370.
023990030825
024000030825           ADD 1                       TO  WS-PT-LST.
024010030825           SET PT                      TO  WS-PT-LST.
024020030825           MOVE PRODUCT-TYPE-CODE
024030030825                OF PRODUCT-TYPE-CODES-REC
024040030825                                       TO  WS-PT-CODE (PT).
024050030825           MOVE PRODUCT-TYPE-RULE
024060030825                OF PRODUCT-TYPE-CODES-REC
024070030825                                       TO  WS-PT-RULE (PT).
024080030825           GO TO INL-0350.
024090030825
024100030825       INL-0360.
024110030825           IF  WS-PT-LST NOT GREATER THAN  ZEROES
024120030825               DISPLAY "NO PRODUCT TYPES (MFAPRTCDP) FOUND"
024130030825               MOVE HIGH-VALUES        TO  CURR-CONTROLS
024140030825               GO TO INL-EXIT.
024150030825
024160030825      /
024170030825RF5148 INL-0370.
024180030825
024190030825      *****
024200030825      *****    Load the ROR Description table.
024210030825      *****
024220030825
024230030825           MOVE SPACES                 TO  WS-ROR-TBL.
024240030825           MOVE ZEROES                 TO  WS-ROT-LST.
024250030825
024260030825       INL-0375.
024270030825
024280030825           READ ROR-PERIOD-CODES       AT  END
024290030825               GO TO INL-0900
024300030825           END-READ
024310030825
024320030825           IF  WS-ROT-LST IS NOT LESS THAN  WS-ROT-MAX
024330030825               DISPLAY "PERIOD CODES (MFARORPCP) EXCEED PROGRAM MAX"
024340030825               GO TO INL-1000
024350030825           END-IF
024360030825
024370030825           ADD 1                        TO  WS-ROT-LST.
024380030825           SET ROT                      TO  WS-ROT-LST.
024390030825           MOVE PERIOD-CODE
024400030825                OF ROR-PERIOD-CODES-REC TO  WS-PERIOD-CODE (ROT).
024410030825
024420030825           INITIALIZE MFARORPDP.
024430030825           MOVE PERIOD-CODE  OF ROR-PERIOD-CODES-REC
024440030825                     TO  PERIOD-CODE OF ROR-PERIOD-DESCRIPTION-REC.
024450030825
024460030825           START ROR-PERIOD-DESCRIPTION
024470030825               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
024480030825               INVALID KEY
024490030825                   GO TO INL-0800-0020
024500030825           END-START.
024510030825
024520030825       INL-0800-0010.
024530030825
024540030825           READ ROR-PERIOD-DESCRIPTION NEXT AT  END
024550030825               GO TO INL-0800-0020
024560030825           END-READ
024570030825
024580030825           IF PERIOD-CODE
024590030825               OF ROR-PERIOD-DESCRIPTION-REC
024600030825                          IS NOT EQUAL TO  PERIOD-CODE
024610030825                                    OF ROR-PERIOD-CODES-REC
024620030825               GO TO INL-0800-0020
024630030825           END-IF
024640030825
024650030825           IF LANGUAGE-CODE OF ROR-PERIOD-DESCRIPTION-REC
024660030825                       IS EQUAL TO  "E"
024670030825              SET ROTL                TO  1
024680030825              MOVE PERIOD-DESCRIPTION OF ROR-PERIOD-DESCRIPTION-REC
024690030825                               TO  WS-PERIOD-DESC (ROT, ROTL)
024700030825           END-IF
024710030825
024720030825           IF LANGUAGE-CODE OF ROR-PERIOD-DESCRIPTION-REC
024730030825                       IS EQUAL TO  "F"
024740030825              SET ROTL                TO  2
024750030825              MOVE PERIOD-DESCRIPTION OF ROR-PERIOD-DESCRIPTION-REC
024760030825                               TO  WS-PERIOD-DESC (ROT, ROTL)
024770030825           END-IF
024780030825
024790030825           GO TO INL-0800-0010.
024800030825
024810030825       INL-0800-0020.
024820030825
024830030825           GO TO INL-0375.
024840030825
024850030825       INL-0900.
024860030825
024870030825           IF  WS-ROT-LST NOT GREATER THAN  ZEROES
024880030825               DISPLAY "ROR PERIOD CODES (MFARORPCP) FOUND"
024890030825           END-IF.
024900030825
024910030825
024920030825RF6697 INL-0910.
024930030825      /
024940030825      *****
024950030825      *****    Load the DII rate group/account type table.
024960030825      *****
024970030825
024980030825           MOVE SPACES                 TO  WS-DIITYP-TBL.
024990030825           MOVE ZEROES                 TO  WS-DIT-LST.
025000030825
025010030825       INL-0910-10.
025020030825
025030030825           READ DII-RATE-SET           AT  END
025040030825               GO TO INL-0910-20
025050030825           END-READ.
025060030825
025070030825           IF  WS-DIT-LST IS NOT LESS THAN  WS-DIT-MAX
025080030825               DISPLAY "DII RATE SETS (MFADIIRSP) EXCEED PROGRAM MAX"
025090030825               GO TO INL-0910-20
025100030825           END-IF.
025110030825
025120030825           ADD 1                       TO  WS-DIT-LST.
025130030825           SET DIT                     TO  WS-DIT-LST.
025140030825           MOVE DII-SET OF DII-RATE-SET-REC
025150030825                                       TO  WS-DIST-CODE (DIT).
025160030825           MOVE ACCOUNT-TYPE-CODE OF DII-RATE-SET-REC
025170030825                                       TO  WS-DIAT-CODE (DIT).
025180030825           MOVE NOMINEE-ACCOUNT-TYPE OF DII-RATE-SET-REC
025190030825                                       TO  WS-DINT-CODE (DIT).
025200030825           GO TO INL-0910-10.
025210030825
025220030825       INL-0910-20.
025230030825
025240030825           IF  WS-DIT-LST NOT GREATER THAN  ZEROES
025250030825               DISPLAY "NO DII RATE SET (MFADIIRSP) WAS FOUND"
025260030825           END-IF.
025270030825
025280031008       INL-1000.
025290121203
025300121203      * RFS116867 - Strats
025310121203      * RFS112003 - Strats
025320121203      * Building table array lc_PlanTypeTable,lc_PlanCodeTable and
025330121203      * lc_FreqCodeTable to store all descriptions of Plan-Type-Code
025340121203      * and Frequency-Code associated with the language code as defined
025350121203      * within the Plan Type Table.
025360121203
025370121203      *  Plan-Type-Name.
025380121203           INITIALIZE lc_PlanTypeTable.
025390121203           MOVE ZEROES                        TO li_MaxFetch.
025400121203           MOVE "DECLARE lcu_PlanType CURSOR" TO WS-SQLERR-STATEMENT.
025410121203           EXEC SQL
025420121203                DECLARE lcu_PlanType CURSOR FOR
025430121203                SELECT  PLNP.PLAN_CODE,
025440121203                        IFNULL(EN_PTXTP.TARGET_VALUE," "),
025450121203                        IFNULL(FR_PTXTP.TARGET_VALUE," ")
025460121203                FROM    MFAPLNP PLNP
025470121203
025480121203                LEFT OUTER JOIN MFAMAPTXTP EN_PTXTP
025490121203                ON      PLNP.PLAN_CODE = EN_PTXTP.SOURCE_VALUE
025500121203                AND     EN_PTXTP.LANGUAGE_CODE    = :lnc_EN
025510121203                AND     EN_PTXTP.MAPPING_CODE     = :lnc_PlanTypeDesc
025520121203                AND     EN_PTXTP.MAPPING_SUB_CODE = :lnc_PlanTypeName
025530121203
025540121203                LEFT OUTER JOIN MFAMAPTXTP FR_PTXTP
025550121203                ON      PLNP.PLAN_CODE = FR_PTXTP.SOURCE_VALUE
025560121203                AND     FR_PTXTP.LANGUAGE_CODE    = :lnc_FR
025570121203                AND     FR_PTXTP.MAPPING_CODE     = :lnc_PlanTypeDesc
025580121203                AND     FR_PTXTP.MAPPING_SUB_CODE = :lnc_PlanTypeName
025590121203
025600121203                ORDER BY PLNP.PLAN_CODE
025610121203           END-EXEC.
025620121203
025630121203           MOVE "OPEN lcu_PlanType" TO WS-SQLERR-STATEMENT.
025640121203           EXEC SQL
025650121203                OPEN lcu_PlanType
025660121203           END-EXEC.
025670121203
025680121203           MOVE "FETCH NEXT FROM lcu_PlanType" TO WS-SQLERR-STATEMENT.
025690121203           EXEC SQL
025700121203                FETCH NEXT
025710121203                FROM  lcu_PlanType
025720121203                FOR   :lnc_MaxRec  ROWS
025730121203                INTO  :ltb_PlanTypeRecord
025740121203           END-EXEC.
025750121203
025760121203           IF SQLCODE = 0
025770121203              COMPUTE li_MaxFetch  = SQLERRD(3)
025780121203           END-IF.
025790121203
025800121203           EXEC SQL
025810121203                CLOSE lcu_PlanType
025820121203           END-EXEC.
025830121203
025840121203      * Plan-Type-Code
025850121203           INITIALIZE lc_PlanCodeTable.
025860121203           MOVE ZEROES                 TO    li_MaxFetch.
025870121203           MOVE "lcu_PlanCode CURSOR"  TO    WS-SQLERR-STATEMENT.
025880121203           EXEC SQL
025890121203                DECLARE lcu_PlanCode CURSOR FOR
025900121203                SELECT  PLNP.PLAN_CODE,
025910121203                        IFNULL(EN_PTXTP.TARGET_VALUE," "),
025920121203                        IFNULL(FR_PTXTP.TARGET_VALUE," ")
025930121203                FROM    MFAPLNP PLNP
025940121203
025950121203                LEFT OUTER JOIN MFAMAPTXTP EN_PTXTP
025960121203                ON      PLNP.PLAN_CODE = EN_PTXTP.SOURCE_VALUE
025970121203                AND     EN_PTXTP.LANGUAGE_CODE    = :lnc_EN
025980121203                AND     EN_PTXTP.MAPPING_CODE     = :lnc_PlanTypeDesc
025990121203                AND     EN_PTXTP.MAPPING_SUB_CODE = :lnc_PlanTypeCode
026000121203
026010121203                LEFT OUTER JOIN MFAMAPTXTP FR_PTXTP
026020121203                ON      PLNP.PLAN_CODE = FR_PTXTP.SOURCE_VALUE
026030121203                AND     FR_PTXTP.LANGUAGE_CODE    = :lnc_FR
026040121203                AND     FR_PTXTP.MAPPING_CODE     = :lnc_PlanTypeDesc
026050121203                AND     FR_PTXTP.MAPPING_SUB_CODE = :lnc_PlanTypeCode
026060121203
026070121203                ORDER BY PLNP.PLAN_CODE
026080121203           END-EXEC.
026090121203
026100121203           MOVE "OPEN lcu_PlanCode" TO WS-SQLERR-STATEMENT.
026110121203           EXEC SQL
026120121203                OPEN lcu_PlanCode
026130121203           END-EXEC.
026140121203
026150121203           MOVE "FETCH NEXT FROM lcu_PlanCode" TO WS-SQLERR-STATEMENT.
026160121203           EXEC SQL
026170121203                FETCH NEXT
026180121203                FROM lcu_PlanCode
026190121203                FOR  :lnc_MaxRec ROWS
026200121203                INTO :ltb_PlanCodeRecord
026210121203           END-EXEC.
026220121203
026230121203           IF SQLCODE = 0
026240121203              COMPUTE li_MaxFetch  = SQLERRD(3)
026250121203           END-IF.
026260121203
026270121203           EXEC SQL
026280121203                CLOSE lcu_PlanCode
026290121203           END-EXEC.
026300121203
026310121203      * Frequency Code.
026320121203           INITIALIZE lc_FreqCodeTable.
026330121203           MOVE ZEROES                        TO li_MaxFetch.
026340121203           MOVE "DECLARE lcu_FreqCode CURSOR" TO WS-SQLERR-STATEMENT.
026350121203           EXEC SQL
026360121203                DECLARE lcu_FreqCode CURSOR FOR
026370121203                SELECT
026380121203                  CASE WHEN SUBSTRING(COALESCE
026390121203                            (FRQCDE.TARGET_VALUE," "),1,4) <> " "
026400121203                       THEN SUBSTRING(COALESCE
026410121203                            (FRQCDE.TARGET_VALUE," "),1,4)
026420121203                       ELSE FREQ.FREQUENCY_CODE END,
026430121203                  CASE WHEN SUBSTRING(COALESCE
026440121203                            (FRQ_E.TARGET_VALUE," "),1,40) <> " "
026450121203                       THEN SUBSTRING(COALESCE
026460121203                            (FRQ_E.TARGET_VALUE," "),1,40)
026470121203      * RFS116867 - Starts
026480121203      *                WHEN COALESCE
026490121203      *                     (FRQL_E.FREQUENCY_DESCR," ") <> " "
026500121203      *                THEN COALESCE
026510121203      *                     (FRQL_E.FREQUENCY_DESCR," ")
026520121203                       WHEN SUBSTRING(COALESCE
026530121203                            (FRQL_E.FREQUENCY_DESCR," "),1,25) <> " "
026540121203                       THEN SUBSTRING(COALESCE
026550121203                            (FRQL_E.FREQUENCY_DESCR," "),1,25)
026560121203      * RFS116867 - Ends
026570121203                       ELSE FREQ.FREQUENCY_DESCR END,
026580121203                  CASE WHEN SUBSTRING(COALESCE
026590121203                            (FRQ_F.TARGET_VALUE," "),1,60) <> " "
026600121203                       THEN SUBSTRING(COALESCE
026610121203                            (FRQ_F.TARGET_VALUE," "),1,60)
026620121203      * RFS116867 - Starts
026630121203      *                WHEN COALESCE
026640121203      *                     (FRQL_F.FREQUENCY_DESCR," ") <> " "
026650121203      *                THEN COALESCE
026660121203      *                     (FRQL_F.FREQUENCY_DESCR," ")
026670121203                       WHEN SUBSTRING(COALESCE
026680121203                            (FRQL_F.FREQUENCY_DESCR," "),1,25) <> " "
026690121203                       THEN SUBSTRING(COALESCE
026700121203                            (FRQL_F.FREQUENCY_DESCR," "),1,25)
026710121203      * RFS116867 - Ends
026720121203                       ELSE " " END
026730121203                FROM MFAFRECDP FREQ
026740121203
026750121203                LEFT OUTER JOIN MFAMAPTXTP FRQCDE
026760121203                ON     FREQ.FREQUENCY_CODE     = FRQCDE.SOURCE_VALUE
026770121203                AND    FRQCDE.MAPPING_CODE     = :lnc_FreqDesc
026780121203                AND    FRQCDE.MAPPING_SUB_CODE = :lnc_FreqLCode
026790121203                AND    FRQCDE.LANGUAGE_CODE    = " "
026800121203
026810121203                LEFT OUTER JOIN MFAFRQLP FRQL_E
026820121203                ON     FREQ.FREQUENCY_CODE     = FRQL_E.FREQUENCY_CODE
026830121203                AND    FRQL_E.LANGUAGE_CODE    = :lnc_EN
026840121203
026850121203                LEFT OUTER JOIN MFAFRQLP FRQL_F
026860121203                ON     FREQ.FREQUENCY_CODE     = FRQL_F.FREQUENCY_CODE
026870121203                AND    FRQL_F.LANGUAGE_CODE    = :lnc_FR
026880121203
026890121203                LEFT OUTER JOIN MFAMAPTXTP FRQ_E
026900121203                ON     FREQ.FREQUENCY_CODE     = FRQ_E.SOURCE_VALUE
026910121203                AND    FRQ_E.MAPPING_CODE      = :lnc_FreqDesc
026920121203                AND    FRQ_E.MAPPING_SUB_CODE  = :lnc_FreqName
026930121203                AND    FRQ_E.LANGUAGE_CODE     = :lnc_EN
026940121203
026950121203                LEFT OUTER JOIN MFAMAPTXTP FRQ_F
026960121203                ON     FREQ.FREQUENCY_CODE     = FRQ_F.SOURCE_VALUE
026970121203                AND    FRQ_F.MAPPING_CODE      = :lnc_FreqDesc
026980121203                AND    FRQ_F.MAPPING_SUB_CODE  = :lnc_FreqName
026990121203                AND    FRQ_F.LANGUAGE_CODE     = :lnc_FR
027000121203           END-EXEC.
027010121203
027020121203           MOVE "OPEN lcu_FreqCode" TO WS-SQLERR-STATEMENT.
027030121203           EXEC SQL
027040121203                OPEN lcu_FreqCode
027050121203           END-EXEC.
027060121203
027070121203           MOVE "FETCH NEXT FROM lcu_FreqCode" TO WS-SQLERR-STATEMENT.
027080121203           EXEC SQL
027090121203                FETCH NEXT
027100121203                FROM lcu_FreqCode
027110121203                FOR  :lnc_MaxRec ROWS
027120121203                INTO :ltb_FreqCodeRecord
027130121203           END-EXEC.
027140121203
027150121203           IF SQLCODE = 0
027160121203              COMPUTE li_MaxFetch  = SQLERRD(3)
027170121203           END-IF.
027180121203
027190121203           EXEC SQL
027200121203                CLOSE lcu_FreqCode
027210121203           END-EXEC.
027220121203      * RFS112003 - Ends
027230140714      * RFS116867 - Ends
027240140714132121 INT-1100.
027250140714132121     PERFORM GET-QTMP-FILE.
027260031009
027270031014R17626 INL-0910-30.
027280031015  |
027290031015  |        IF WS-LDA-FUND-ROR-FRQ IS NOT EQUAL TO  "Y"
027300031015  |           OR  WS-LDA-ACCOUNT-ROR-FRQ IS NOT EQUAL TO "Y"
027310031015  |           GO TO INL-EXIT
027320031015  |        END-IF.
027330031014  |
027340031014  |   *****                              *****
027350031014  |   *****  Format the end month date   *****
027360031014  |   *****  for the Quarter End table   *****
027370031014  |   *****                              *****
027380031015  |    GET-END-DATE.
027390031015  |        MOVE "3M"           TO  WS-QRT-END-FRQ.
027400031014  |        MOVE WS-LDA-ENDDTE  TO  WS-LDA-YY-MM-DD.
027410031015  |
027420031015  |   *****  Format the end month date which must be a
027430031015  |   *****  Quarter End period.
027440031015  |
027450031015  |        MOVE   WS-LDA-YY   TO   WS-END-YY.
027460031015  |
027470031015  |        IF WS-LDA-MM  =  3 OR 6 OR 9 OR 12
027480031015  |           MOVE WS-LDA-MM  TO  WS-END-MM
027490031015  |           IF WS-LDA-MM = 3 OR 12
027500031015  |              IF WS-LDA-DD NOT = 31
027510031015  |                 COMPUTE WS-END-MM = WS-LDA-MM - 3
027520031015  |              END-IF
027530031015  |              IF WS-END-MM = 0
027540031015  |                 MOVE 12 TO WS-END-MM
027550031015  |                 COMPUTE WS-END-YY = WS-LDA-YY - 1
027560031015  |              END-IF
027570031015  |           END-IF
027580031015  |           IF WS-LDA-MM = 6 OR 9
027590031015  |              IF WS-LDA-DD NOT = 30
027600031015  |                 COMPUTE WS-END-MM = WS-LDA-MM - 3
027610031015  |              END-IF
027620031015  |           END-IF
027630031015  |        END-IF.
027640031015  |
027650031015  |        IF WS-LDA-MM  <  3
027660031015  |           MOVE 12         TO  WS-END-MM
027670031015  |           COMPUTE WS-END-YY = WS-LDA-YY - 1
027680031015  |        END-IF.
027690031015  |
027700031015  |        IF WS-LDA-MM  <  6 AND WS-LDA-MM > 3
027710031015  |           MOVE 3          TO  WS-END-MM
027720031015  |        END-IF.
027730031015  |
027740031015  |        IF WS-LDA-MM  <  9 AND WS-LDA-MM > 6
027750031015  |           MOVE 6          TO  WS-END-MM
027760031015  |        END-IF.
027770031015  |
027780031015  |        IF WS-LDA-MM  < 12 AND WS-LDA-MM > 9
027790031015  |           MOVE 9          TO  WS-END-MM
027800031015  |        END-IF.
027810031015  |
027820031015  |   *****  Format the end day date.
027830031015  |        IF WS-END-MM  =  3 OR 12
027840031015  |           MOVE 31         TO  WS-END-DD
027850031015  |        END-IF.
027860031015  |
027870031015  |        IF WS-END-MM  =  6 OR 9
027880031015  V           MOVE 30         TO  WS-END-DD
027890121203R17626     END-IF.
027900121203
027910121203      * RFS116867 - Starts
027920121203      * To fix the defect on RFS112003, the logic which were introduced
027930121203      * in INITIAL para moved to upward after label INL-1000 and before
027940121203      * label INL-0910-30.
027950120918      * RFS116867 - Ends
027960030825       INL-EXIT.
027970030825           EXIT.
027980120925
027990120918      * RFS112003 - Strats
028000120920           EXEC SQL
028010120918             INCLUDE CPYSYSPLAN
028020120918           END-EXEC.
028030140714      * RFS112003 - Ends
028040140714
028050140714      * RFS132121 - Start
028060140714           EXEC SQL
028070140714             INCLUDE  CPYSTMP16
028080140714           END-EXEC.
028090120921      * RFS132121 - End
028100061004
028110061004R34848*RFS34848 - Start
028120061004R34848*  Per SRS, Short and Long descriptions on Section81 will be
028130061004      *  populated with blank if no matching code is found.
028140061004      *
028150061004       LOAD-DEDUCTION-DESCRIPTION.
028160061004           MOVE SPACES                 TO  ltb_TrndepTbl.
028170061004           MOVE ZEROES                 TO  li_TdLst.
028180061004           MOVE "OPEN-TRNTDD1" TO WS-SQLERR-STATEMENT.
028190061004           EXEC SQL
028200061004                OPEN TRNTDD1
028210061004           END-EXEC.
028220061004           MOVE "FETCH NEXT FROM TRNTDD1" TO WS-SQLERR-STATEMENT.
028230061004           EXEC SQL
028240061004                FETCH NEXT FROM TRNTDD1
028250061004                FOR :li_TdMax ROWS
028260061004                INTO :lc_TrnDepEnt
028270061004           END-EXEC.
028280061004           IF SQLCODE = 0
028290061004              COMPUTE li_TdLst  = SQLERRD(3)
028300061004           END-IF.
028310061004           EXEC SQL
028320061004              CLOSE TRNTDD1
028330061004           END-EXEC.
028340030825R34848*RFS34848 - End
028350000000      /
028360000000       GET-CURRENT-RECORD.
028370000000
028380000000      ******************************************************************
028390000000      *                                                                *
028400000000      *    G E T   C U R R E N T   R E C O R D   R O U T I N E         *
028410000000      *                                                                *
028420000000      ******************************************************************
028430000000
028440000000           IF WS-ACCT-NEXT IS NOT EQUAL TO "Y"
028450000000             GO TO GCR-ACI-START
028460000000           END-IF.
028470000000
028480991004       GCR-0010.
028490980706
028500980706           IF  WS-LDA-REQUEST-SCOPE = "C"
028510991004           OR  WS-LDA-REQUEST-SCOPE = "E"
028520991004               GO TO GCR-0010-0015
028530980706           END-IF
028540991004
028550991004           IF  WS-LDA-REQUEST-SCOPE    IS NOT EQUAL TO  "B"
028560991004               GO TO GCR-0010-0010
028570980709           END-IF
028580980709
028590991004           IF  WS-INVESTOR-SWITCH IS NOT EQUAL TO "N"
028600991004               GO TO GCR-0010-0005
028610980709           END-IF
028620970523
028630970523      *****
028640970523      *****    This is a batch request.  The Statement Print Request
028650970523      *****    file has been populated with the desired investor/account
028660970523      *****    combinations requiring a statement to be produced.  For
028670970523      *****    each record read, start the Investor Join file.  When all
028680970523      *****    records have been processed, exit.
028690970523      *****
028700970523
028710970523           READ STATEMENT-PRINT-REQUEST
028720970523                                       AT  END
028730970523               MOVE HIGH-VALUES        TO  CURR-CONTROLS
028740980128               GO TO GCR-EXIT.
028750980128
028760980212      ****
028770980128      ****  DECIDE IF IT IS DUPLICATE REQUEST
028780980128      ****
028790980128
028800980128           IF START-DATE OF STMT-PRINT-REQ-REC NOT = ZERO
028810980128              AND END-DATE OF STMT-PRINT-REQ-REC NOT = ZERO
028820980128              MOVE START-DATE OF STMT-PRINT-REQ-REC
028830980128                              TO WS-LDA-STRDTE
028840980128              MOVE END-DATE OF STMT-PRINT-REQ-REC
028850980128                              TO WS-LDA-ENDDTE.
028860020417
028870020417r13017     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
028880030704           AND WS-LDA-STMT-CNFM-FLAG = "S"
028890020417R17783         MOVE USER-ID OF STMT-PRINT-REQ-REC    TO CURR-USER-ID
028900040723               PERFORM ADHOC-IN-BATCH-INITIALIZE     THRU AIBI-EXIT
028910020417R21815         SET AIB-NOT-FIRST-USD TO TRUE
028920020417               ADD 1                TO  WS-ADHOC-B-FLAG
028930020708               CLOSE                CURRENCY-CODE
028940020708R14142         IF WS-ADHOC-B-FLAG < 2
028950020708                  CLOSE             INVESTMENT-GROUP
028960020417R14142         END-IF
028970020417R13017     END-IF.
028980970523
028990970523           INITIALIZE INVESTOR-J-REC.
029000970523           MOVE INVESTOR-NO
029010970523                OF STMT-PRINT-REQ-REC  TO  ACIVRNO
029020970523                                           OF INVESTOR-J-REC.
029030970523           MOVE ACCOUNT-NO
029040970523                OF STMT-PRINT-REQ-REC  TO  ACACTNO
029050970523                                           OF INVESTOR-J-REC.
029060970523           START INVESTOR-JOIN
029070970523               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
029080980910               INVALID KEY
029090980910                   MOVE HIGH-VALUES TO CURR-CONTROLS
029100970523                   GO TO GCR-EXIT.
029110980709
029120980709       GCR-0010-0005.
029130980709           READ INVESTOR-JOIN NEXT RECORD
029140980910             AT END
029150980910             MOVE HIGH-VALUES TO CURR-CONTROLS
029160980709             GO TO GCR-EXIT
029170980709           END-READ.
029180980709
029190980709           GO TO GCR-0010-0010-0000.
029200970523
029210000000       GCR-0010-0010.
029220000000           READ INVESTOR-JOIN NEXT RECORD
029230980709             AT END
029240980709             MOVE HIGH-VALUES TO CURR-CONTROLS
029250000000             GO TO GCR-EXIT
029260041028           END-READ.
029270041028
029280041028R21715     IF SELECT-ACCOUNTS
029290041028  ¦           MOVE ACACTNO OF INVESTOR-J-REC TO
029300041028  ¦              ACCOUNT-NO OF STATEMENT-ACCOUNT-SELECT-REC
029310041028  ¦
029320041028  ¦           READ  STATEMENT-ACCOUNT-SELECTION
029330041028  ¦           INVALID KEY
029340041028  ¦             GO TO  GCR-0010-0010
029350000000R21715     END-IF.
029360980709
029370971024       GCR-0010-0010-0000.
029380971024           IF  WS-LDA-REQUEST-SCOPE
029390980317                              IS EQUAL TO  "I"
029400971024980316     AND WS-LDA-STATEMENT-TYPE = "I"
029410971024           AND ACIVRNO
029420971024               OF INVESTOR-JOIN
029430971024                          IS NOT EQUAL TO  WS-LDA-INVESTOR-NO
029440971024               MOVE HIGH-VALUES        TO  CURR-CONTROLS
029450980317               GO TO GCR-EXIT.
029460990813
029470990813           IF  WS-LDA-STMT-CNFM-FLAG = "S"
029480990813           AND  WS-LDA-REQUEST-SCOPE = "I"
029490990813           AND  WS-LDA-STATEMENT-TYPE = "A"
029500990813           AND  ACIVRNO OF INVESTOR-JOIN
029510990813                        NOT = INVESTOR-NO OF ACCOUNT
029520990813               MOVE HIGH-VALUES        TO  CURR-CONTROLS
029530980318               GO TO GCR-EXIT.
029540990813
029550990813           IF  WS-LDA-STMT-CNFM-FLAG = "S"
029560990813           AND  WS-LDA-REQUEST-SCOPE = "I"
029570990813           AND  WS-LDA-STATEMENT-TYPE = "A"
029580990813           AND  ACACTNO OF INVESTOR-JOIN
029590990813                        NOT = WS-LDA-ACCOUNT-NO
029600990813               MOVE HIGH-VALUES        TO  CURR-CONTROLS
029610980318               GO TO GCR-EXIT.
029620000216
029630000216RF6362     IF  WS-LDA-STMT-CNFM-FLAG = "S"
029640000216           AND  WS-LDA-REQUEST-SCOPE = "T"
029650000216           AND  WS-LDA-STATEMENT-TYPE = "A"
029660000216           AND  ACACTNO OF INVESTOR-JOIN
029670000216                        NOT = WS-LDA-ACCOUNT-NO
029680000216               MOVE HIGH-VALUES        TO  CURR-CONTROLS
029690000216               GO TO GCR-EXIT
029700000216           END-IF
029710971024
029720970523           IF  WS-LDA-REQUEST-SCOPE
029730970523                          IS NOT EQUAL TO  "B"
029740970523               GO TO GCR-0010-0030.
029750970523
029760970523      *****
029770970523      *****    This is a batch request.  If the Investor Join is not for
029780970523      *****    the investor/account being processed, return to retrieve
029790970528      *****    the next investor/account.  Otherwise, process the
029800970528      *****    record.  If an account was not specified, all accounts
029810970523      *****    for the investor will be processed.
029820970528      *****
029830970528
029840970528           IF  ACCOUNT-NO
029850970528               OF STMT-PRINT-REQ-REC
029860970528                          IS NOT EQUAL TO  ZEROES
029870970528           AND ACCOUNT-NO
029880970528               OF STMT-PRINT-REQ-REC
029890970528                          IS NOT EQUAL TO  ACACTNO
029900980910                                           OF INVESTOR-J-REC
029910970528               MOVE "N" TO WS-INVESTOR-SWITCH
029920970523               GO TO GCR-0010-0020.
029930970528
029940970528           IF  INVESTOR-NO
029950970528               OF STMT-PRINT-REQ-REC
029960970528                          IS NOT EQUAL TO  ACIVRNO
029970980910                                           OF INVESTOR-J-REC
029980970523               MOVE "N" TO WS-INVESTOR-SWITCH
029990980709               GO TO GCR-0010-0020.
030000980709
030010980709           MOVE "Y" TO WS-INVESTOR-SWITCH.
030020970523
030030970523           GO TO GCR-0010-0030.
030040980706
030050980706       GCR-0010-0015.
030060980706           READ DEALER-REP-EXTRACT
030070980706                AT END
030080980706                 MOVE HIGH-VALUES TO CURR-CONTROLS
030090980706                 GO TO GCR-EXIT.
030100980706
030110980706           IF START-DATE OF DEALER-REP-EXTRACT NOT = ZERO AND
030120980706              END-DATE OF DEALER-REP-EXTRACT NOT = ZERO
030130980706              MOVE START-DATE OF DEALER-REP-EXTRACT
030140980706                                 TO WS-LDA-STRDTE
030150980706              MOVE END-DATE OF DEALER-REP-EXTRACT
030160980706                                 TO WS-LDA-ENDDTE.
030170990217
030180990217           IF START-DATE OF DEALER-REP-EXTRACT = ZERO AND
030190990217              END-DATE OF DEALER-REP-EXTRACT = ZERO
030200990217              MOVE WS-CNFM-SDATE
030210990217                                 TO WS-LDA-STRDTE
030220990217              MOVE WS-CNFM-EDATE
030230990217                                 TO WS-LDA-ENDDTE.
030240981124
030250981124           INITIALIZE MFAACOJLA OF INVESTOR-J-REC.
030260981124           MOVE INVESTOR-NO
030270981124                OF DEALER-REP-EXTRACT  TO  ACIVRNO
030280981124                                           OF INVESTOR-J-REC.
030290981124           MOVE ACCOUNT-NO
030300981124                OF DEALER-REP-EXTRACT  TO  ACACTNO
030310980706                                           OF INVESTOR-J-REC.
030320980706           START INVESTOR-JOIN
030330980706                 KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
030340981124                 INVALID KEY
030350981124                  MOVE HIGH-VALUES TO CURR-CONTROLS
030360980706                  GO TO GCR-EXIT.
030370980706
030380980706       GCR-0010-0015-0000.
030390980706           READ INVESTOR-JOIN NEXT RECORD
030400981124                AT END
030410981124                 MOVE HIGH-VALUES TO CURR-CONTROLS
030420010111                 GO TO GCR-EXIT.
030430981124
030440980706           IF  DEALER-CODE OF DEALER-REP-EXTRACT NOT = ACDEALER
030450981124                           OF INVESTOR-J-REC
030460981124           OR  DEALER-REP-CODE OF DEALER-REP-EXTRACT NOT = ACDEALREP
030470981124                           OF INVESTOR-J-REC
030480981124           OR  INVESTOR-NO OF DEALER-REP-EXTRACT NOT = ACIVRNO
030490981124                           OF INVESTOR-J-REC
030500981124           OR  ACCOUNT-NO OF  DEALER-REP-EXTRACT NOT = ACACTNO
030510981111                           OF INVESTOR-J-REC
030520981124               GO TO GCR-0010-0020.
030530980706
030540980706           GO TO GCR-0010-0030.
030550970523
030560970523       GCR-0010-0020.
030570970523           GO TO GCR-0010.
030580970523
030590011106       GCR-0010-0030.
030600011106
030610011106R11623     IF  ACSTATUS                 IS EQUAL TO "C"
030620011106           AND (WS-LDA-REQUEST-SCOPE    IS EQUAL TO "A"
030630011106            OR  WS-LDA-REQUEST-SCOPE    IS EQUAL TO "R")
030640011106               PERFORM BYPASS-CLOSED-ACCOUNT-RTN      THRU BCAR-EXIT
030650011106               IF WS-BYPASS-ACCOUNT     IS EQUAL TO "Y"
030660011106                  GO TO GCR-0010
030670011106               END-IF
030680021230R11623     END-IF.
030690040107
030700040107R19511** This selection criteria will determine whether to check for
030710040107R19511** the Account Attribute 'BYSTM'.  It will bypass the check if
030720040107R19511** Adhoc was submitted through the account or investor screen, or
030730040107R19511** if the Adhoc submission is type 'B' (batch).
030740021230
030750040107R15424     IF (WS-LDA-REQUEST-SCOPE     IS EQUAL TO "I"
030760040107R15424     AND WS-LDA-STMT-CNFM-FLAG    IS EQUAL TO "S")
030770040107R19511     OR (WS-LDA-REQUEST-SCOPE     IS EQUAL TO "B"
030780040107R19511     AND WS-LDA-STMT-CNFM-FLAG    IS EQUAL TO "S")
030790021230R15424     OR (WS-LDA-STMT-CNFM-FLAG    IS EQUAL TO "C")
030800021230  ¦            GO TO GCR-0010-0030-0030
030810051003R15424     END-IF.
030820051020  ¦
030830051020R30514     IF WS-BYSTM-COUNT = ZEROS
030840051020  ¦           GO TO GCR-0010-0030-0030
030850051020R30514     END-IF.
030860051020
030870051020R14153 GCR-0010-0040.
030880051020  ¦
030890051020  ¦   *****  Read the Account-Attribute file
030900051020  ¦        INITIALIZE MFAACCATP ACCOUNT-ATTRIBUTE-REC.
030910051020  ¦        MOVE ACACTNO OF INVESTOR-JOIN   TO  ACCOUNT-NO
030920051020  ¦                                        OF ACCOUNT-ATTRIBUTE-REC.
030930051020  ¦        START ACCOUNT-ATTRIBUTE
030940051020  ¦            KEY IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
030950051020  ¦            INVALID KEY
030960051020  ¦            MOVE SPACES TO  ACCOUNT-ATTRIBUTE-CODE
030970051020  ¦                                        OF ACCOUNT-ATTRIBUTE-REC
030980051020  ¦            GO TO GCR-0010-0030-0030
030990051020  ¦        END-START.
031000051020  ¦
031010051020  ¦    GCR-0010-0050.
031020051020  ¦        READ ACCOUNT-ATTRIBUTE NEXT AT  END
031030051020  ¦            MOVE SPACES  TO  ACCOUNT-ATTRIBUTE-CODE
031040051020  ¦                                        OF ACCOUNT-ATTRIBUTE-REC
031050051020  ¦            GO TO GCR-0010-0030-0030
031060051020  ¦        END-READ.
031070051020  ¦
031080051020  ¦        IF ACACTNO OF INVESTOR-JOIN IS NOT EQUAL TO
031090051020  ¦                     ACCOUNT-NO OF ACCOUNT-ATTRIBUTE-REC
031100051020  ¦           GO TO GCR-0010-0030-0030
031110051020  ¦        END-IF.
031120051020  ¦
031130051020  ¦   *****  Read the Investor-Account-Attribute file
031140051020  ¦        INITIALIZE MFAIVACAP INVESTOR-ACCOUNT-ATTRIB-REC.
031150051020  ¦
031160051020  ¦        MOVE  "BYSTM"  TO  INVESTOR-ATTRIBUTE-CODE  OF
031170051020  ¦                                 INVESTOR-ACCOUNT-ATTRIB-REC.
031180051020  ¦
031190051020  ¦        MOVE  ACCOUNT-ATTRIBUTE-CODE OF ACCOUNT-ATTRIBUTE-REC
031200051020  ¦                       TO  ACCOUNT-ATTRIBUTE-CODE  OF
031210051020  ¦                                 INVESTOR-ACCOUNT-ATTRIB-REC.
031220051020  ¦
031230051020  ¦        READ INVESTOR-ACCOUNT-ATTRIBUTES
031240051020  ¦          INVALID KEY
031250051020  ¦             INITIALIZE INVESTOR-ACCOUNT-ATTRIB-REC
031260051020  ¦             GO TO GCR-0010-0050
031270051020  ¦        END-READ.
031280051020  ¦
031290051020  ¦   *****  Read the Account-Attribute-Codes file
031300051020  ¦        INITIALIZE    MFAACCACP.
031310051020  ¦
031320051020  ¦        MOVE ACCOUNT-ATTRIBUTE-CODE
031330051020  ¦                OF  INVESTOR-ACCOUNT-ATTRIB-REC
031340051020  ¦              TO  ACCOUNT-ATTRIBUTE-CODE
031350051020  ¦                     OF ACCOUNT-ATTRIBUTE-CODES-REC.
031360051020  ¦
031370051020  ¦        READ ACCOUNT-ATTRIBUTE-CODES
031380051020  ¦          INVALID KEY
031390051020  ¦             GO TO GCR-0010-0030-0030.
031400051020  ¦
031410051020  ¦        IF BYPASS-INVESTOR OF ACCOUNT-ATTRIBUTE-CODES-REC
031420051020  ¦           IS EQUAL TO "N" OR " "
031430051020  v           GO TO GCR-0010
031440051020R14153     END-IF.
031450020910
031460021230
031470010411R15424 GCR-0010-0030-0030.
031480010910
031490010910R10605     MOVE SPACES                      TO WS-ACCOUNT-DLR-REP-CODE.
031500010910           MOVE ACDEALER  OF INVESTOR-J-REC TO WS-ACCOUNT-DLRCDE.
031510010910           MOVE ACDEALREP OF INVESTOR-J-REC TO WS-ACCOUNT-DLRREPCDE.
031520010910
031530010910R10605     PERFORM FORMAT-ACC-DLR-REP-NAME THRU FADRN-EXIT.
031540000000
031550000000           MOVE "Y"          TO WS-ACI-START.
031560000000           MOVE "N"          TO WS-ACCT-NEXT.
031570000000
031580011106       GCR-ACI-START.
031590000000
031600000000           IF WS-ACI-START IS NOT EQUAL TO "Y"
031610000000             GO TO GCR-ACI-NEXT
031620000000           END-IF.
031630000000
031640000000           MOVE ACACTNO      TO ACCOUNT-NO
031650161125                             OF ACCOUNT-INVESTMENT.
031660161125      ** RFS156507 - Start **
031670161125           IF Lc_PndTrans = "Y"
031680161128              COMPUTE INVPND-NXT = INVPND-NXT + 1
031690161128              SET INVPND-IDX TO 1
031700161125              SEARCH WS-INV-PND-ARR-DTL VARYING INVPND-IDX
031710161125                 AT END
031720161125                      MOVE ZEROS TO INVPND-NXT
031730161125                      CONTINUE
031740161125                 WHEN WS-INVPND-ACCOUNT(INVPND-IDX) = ACACTNO AND
031750161128                      WS-INVPND-ROWNUM(INVPND-IDX)  = INVPND-NXT
031760161125                         INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-REC
031770161125                         MOVE WS-INVPND-ACCOUNT(INVPND-IDX)
031780161125                           TO ACCOUNT-NO      OF ACCOUNT-INVESTMENT-REC
031790161125                         MOVE WS-INVPND-INVESTMENT(INVPND-IDX)
031800161125                           TO INVESTMENT-CODE OF ACCOUNT-INVESTMENT-REC
031810161125                         GO TO GCR-0011
031820161125               END-SEARCH
031830161125           END-IF.
031840000000      ** RFS156507 - End   **
031850000000           MOVE LOW-VALUES   TO INVESTMENT-CODE
031860000000                             OF ACCOUNT-INVESTMENT.
031870000000           START ACCOUNT-INVESTMENT
031880000000           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
031890031007           INVALID KEY
031900000000R18485             GO TO GCR-0010.
031910000000
031920000000           MOVE "N"          TO WS-ACI-START.
031930000000
031940000000       GCR-ACI-NEXT.
031950000000           READ ACCOUNT-INVESTMENT NEXT RECORD
031960031007             AT END
031970000000R18485         GO TO GCR-0010.
031980000000
031990031007           IF ACCOUNT-NO OF ACCOUNT-INVESTMENT IS NOT EQUAL ACACTNO
032000020627R18485         GO TO GCR-0010.
032010040106
032020040106R19074     MOVE "N" TO WS-ACCT-CHG.
032030011211
032040011214R11036*****
032050011211      *****  If Investment-structure was required, only pick up the
032060011211      *****  selected investment that in the Investment-structure.
032070161123      *****
032080011214156507 GCR-0011.
032090011213           IF WS-LDA-INVESTMENT-STRUCTURE     IS EQUAL TO  SPACES
032100011213              GO TO GCR-0030-0020
032110011213           END-IF.
032120031007
032130031007R18485     SET ISC TO 1.
032140031007   ¦       SEARCH WS-INVSTR-ENT    VARYING ISC
032150040420   |           AT END
032160031007R21337            GO TO GCR-ACI-NEXT
032170031007   V           WHEN INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-REC
032180031007                                 IS EQUAL TO  WS-ISC-INVCODE (ISC)
032190031007                  GO TO GCR-0030-0020
032200970523           END-SEARCH.
032210970523
032220000000       GCR-0030-0020.
032230000000
032240000000      *------------------------------------------------------
032250970428      * GET ONLY STF'S AND AAH'S
032260970428
032270970428           SET ICG                     TO  1.
032280970428
032290970428       GCR-0040.
032300970428           IF  INVESTMENT-CODE
032310970428               OF ACCOUNT-INVESTMENT-REC
032320970428                              IS EQUAL TO  WS-IC-CODE (ICG)
032330970428               GO TO GCR-0050.
032340970428
032350970428           IF  ICG           IS LESS THAN  WS-IC-LST
032360970428               SET ICG              UP BY  1
032370970428               GO TO GCR-0040.
032380970428
032390970428           GO TO GCR-ACI-NEXT.
032400970428
032410970530       GCR-0050.
032420970530
032430970530      *****
032440970530      *****    Determine the Product Type rule.  If it is not found or
032450970530      *****    is not valid, bypass the Investment.
032460970530      *****
032470970530
032480970530           SET PT                      TO  1.
032490970530
032500970530       GCR-0050-0010.
032510970530           IF  WS-IC-PROD (ICG)  EQUAL TO  WS-PT-CODE (PT)
032520970530               GO TO GCR-0050-0020.
032530970530
032540970530           IF  PT            IS LESS THAN  WS-PT-LST
032550970530               SET PT               UP BY  1
032560970530               GO TO GCR-0050-0010.
032570970530
032580970530           GO TO GCR-0060-0010.
032590970530
032600970530       GCR-0050-0020.
032610970530           IF  WS-PT-RULE (PT)
032620970530                          IS NOT EQUAL TO  "1"
032630970530           AND WS-PT-RULE (PT)
032640040105                          IS NOT EQUAL TO  "2"
032650040105           AND WS-PT-RULE (PT)
032660000414                          IS NOT EQUAL TO  "4"
032670000414
032680000414      ** ADDED BY RH TO INCLUDE SEG AND DII
032690000414
032700000414           AND WS-PT-RULE (PT)
032710000414                          IS NOT EQUAL TO  "6"
032720000414           AND WS-PT-RULE (PT)
032730970530                          IS NOT EQUAL TO  "7"
032740970428               GO TO GCR-0060-0010.
032750010607
032760010607R10404     MOVE WS-PT-RULE (PT)     TO  CURR-PT-RULE.
032770970428
032780970428      *****
032790970428      *****    Determine the Investment Group.  If it is not found,
032800970428      *****    bypass the Investment.
032810970428      *****
032820970428
032830970428           SET IGG                     TO  1.
032840970428
032850970428       GCR-0060.
032860970523           IF  WS-IC-GRP (ICG)   EQUAL TO  WS-IG-CODE (IGG)
032870970523               GO TO GCR-0070.
032880970523
032890970523           IF  IGG           IS LESS THAN  WS-IG-LST
032900970523               SET IGG              UP BY  1
032910970428               GO TO GCR-0060.
032920970530
032930970428       GCR-0060-0010.
032940970428           GO TO GCR-ACI-NEXT.
032950970428
032960970108       GCR-0070.
032970970108
032980970108      *****
032990970108      *****    Format the current controls.  Remember, levels 4 & 5 are
033000970108      *****    only to be used for INVESTOR type statements, indicated
033010970108      *****    by position 610 of the LDA containing a value of 'D'
033020970108      *****    (Dealer) or 'R' (Dealer Representative).
033030970108      *****
033040971024
033050971024           IF  WS-LDA-ALLTYP  IS EQUAL TO  "D"
033060980707           OR  WS-LDA-ALLTYP  IS EQUAL TO  "R"
033070980707           OR  WS-LDA-REQUEST-SCOPE IS EQUAL TO "C"
033080970108           OR  WS-LDA-REQUEST-SCOPE IS EQUAL TO "E"
033090970108               MOVE ACDEALER           TO  CURR-DEALER
033100980129               MOVE ACDEALREP          TO  CURR-DLRREP.
033110980129
033120980129           MOVE WS-LDA-STRDTE TO CURR-START-DATE.
033130000000           MOVE WS-LDA-ENDDTE TO CURR-END-DATE.
033140000000           MOVE ACIVRNO      TO CURR-INVESTOR.
033150000000           MOVE ACACTNO      TO CURR-ACCOUNT.
033160000000           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
033170990119                             TO CURR-INVESTMENT.
033180000911           MOVE ACGROUP      TO CURR-GROUP-CONTROL.
033190000911
033200000911RF6697     MOVE ACACTYP      TO CURR-ACCOUNT-TYPE.
033210000911           IF ACNOMINEE      IS EQUAL TO     "Y"
033220000911              MOVE ANACTYP   TO CURR-NOMINEE-ACCOUNT-TYPE
033230000911           ELSE
033240000911              MOVE SPACES    TO CURR-NOMINEE-ACCOUNT-TYPE
033250990119           END-IF.
033260990119
033270990120           IF WS-YTDSTRDTE IS EQUAL TO ZEROES
033280990120           OR WS-LDA-REQUEST-SCOPE IS EQUAL TO "B"
033290990120           OR WS-LDA-REQUEST-SCOPE IS EQUAL TO "E"
033300990119           OR WS-LDA-REQUEST-SCOPE IS EQUAL TO "C"
033310991004              MOVE WS-LDA-ENDDTE TO WS-YTDSTRDTE
033320991004              MOVE ZEROES TO WS-YTDSTRDTE-MMDD
033330991004           END-IF.
033340991004
033350991004      **********
033360000000
033370000000       GCR-EXIT.
033380991004           EXIT.
033390991004
033400991004      **********
033410000000
033420000000      /
033430000000       DETAIL-PROCESSING.
033440000000
033450000000      ******************************************************************
033460000000      *                                                                *
033470000000      *    D E T A I L   P R O C E S S I N G   R O U T I N E           *
033480000000      *                                                                *
033490970108      ******************************************************************
033500970108
033510970108      *****
033520970108      *****    If the account being processed is to be bypassed, exit.
033530970108      *****
033540970108
033550991004           IF  WS-LR2BYP-SW   IS EQUAL TO  "Y"
033560991004               GO TO DPR-EXIT
033570000000           END-IF
033580171010
033590171010      ** RFS171359 - Start **
033600171010           IF Lc_STMLTD = "Y"
033610171010              INITIALIZE ILT-Fields-Info
033620171010                         pn_Placement_Date
033630171011                         pn_Trans_No
033640171010                         pn_Trans_Arr_Count
033650171010              MOVE WS-LDA-STRDTE            TO pn_Start_Date
033660171010              MOVE WS-LDA-ENDDTE            TO pn_End_Date
033670171010              MOVE ACACTNO                  TO pn_Account_No
033680171010              MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
033690171010                                            TO pc_Investment_Code
033700171017              MOVE "Y"                      TO pn_Generate_Section80
033710171010              MOVE "N"                      TO pc_Txns_In_Range
033720171010              CALL "CWTINPLTD" using CWT-PARAMETERS,
033730171010                                     ILT-Fields-Info,
033740171014                                     ILT-TRANS-ARRAY
033750180323              IF pc_Txns_In_Range = "Y"
033760180323      ** RFS175900 - Start **
033770180323              IF pd_First_Purchase_Date < WS-FIRST-PURCHASE-DATE
033780180323                MOVE pd_First_Purchase_Date TO WS-FIRST-PURCHASE-DATE
033790180323                INITIALIZE WS-IS2-BUY-FIRST-N
033800180323                           WS-IS2-TRI-FIRST-N
033810180323                           WS-IS2-SWI-FIRST-N
033820180323              END-IF
033830171010      ** RFS175900 - End   **
033840171010                 PERFORM CALCULATE-RORTRNP-SUMMARY THRU CRS-EXIT
033850171010                 IF pd_First_Trade_Transaction <
033860171010                    WS-FIRST-TRADE-TRANSACTION
033870171010                    MOVE pd_First_Trade_Transaction
033880171010                     TO WS-FIRST-TRADE-TRANSACTION
033890171016                 END-IF
033900171016                 MOVE ZEROS            TO ln_CWT_Trans_Count
033910171014                 MOVE pc_Txns_In_Range TO WS-TXNS-IN-RANGE
033920171010                 PERFORM DETAIL-PROCESSING-CWT THRU DPR-CWT-EXIT
033930171014              END-IF
033940171014
033950171014              MOVE ACACTNO      TO ACCOUNT-NO OF TRANS
033960171014              MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
033970190523                                TO INVESTMENT-CODE OF TRANS
033980190523      ** rfs 1013007 - start
033990190523      *       MOVE WS-LDA-STRDTE
034000190523      *                         TO  PROCESS-DATE OF TRANS-REC
034010190523              IF lc-LdaSelectDate = "T" AND
034020190523                 WS-LDA-STMT-CNFM-FLAG = "S"
034030190523                 MOVE 0 TO PROCESS-DATE OF TRANS-REC
034040190523              ELSE
034050190523              MOVE WS-LDA-STRDTE
034060190523                                TO  PROCESS-DATE OF TRANS-REC
034070190523              END-IF
034080171014      ** rfs 1013007 - end
034090171014              MOVE 0            TO TRANS-PROC-SEQ-NO OF TRANS
034100171014              START TRANS
034110171014              KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
034120171014              INVALID KEY
034130171014                  GO TO DPR-EXIT
034140171010              END-START
034150171010           END-IF.
034160171014      ** RFS171359 - End   **
034170000000
034180000000           IF WS-WRITE-INVESTMENT-LEVEL IS NOT EQUAL "Y"
034190991004             GO TO DPR-EXIT
034200000000           END-IF
034210000000
034220000000      *-----------------------------------------------
034230000000      * BYPASS DETAILS IF NOT TXNS IN RANGE.
034240000000      * THIS CONDITION IS NEEDED IF THE START READ IN
034250000000      *  LEVEL-REINIT-1 GOT AN AT-END CONDITION, SO WE
034260000000      *  DON'T DO THE READ NEXT BELOW.
034270000000      *-----------------------------------------------
034280000000           IF WS-TXNS-IN-RANGE = "N"
034290000000             GO TO DPR-EXIT
034300000000           END-IF.
034310000000
034320000000      *-----------------------------------------------
034330000000      * GET TRANSACTIONS WITHIN START AND END DATE
034340980209
034350991004       DPR-NEXT-TXN.
034360170622
034370170622           READ TRANS NEXT RECORD
034380170622              AT END
034390170622                 GO TO DPR-EXIT
034400170622           END-READ
034410000000
034420000000           IF (ACCOUNT-NO OF TRANS IS NOT EQUAL ACACTNO) OR
034430000000           (INVESTMENT-CODE OF TRANS IS NOT EQUAL INVESTMENT-CODE
034440000000           OF ACCOUNT-INVESTMENT)
034450991004             GO TO DPR-EXIT
034460180220           END-IF
034470180220
034480180220      ** RFS1001189- Start **
034490180220           IF lc-LdaSelectDate = "T" AND
034500180220              WS-LDA-STMT-CNFM-FLAG = "S" AND
034510180220              TRADE-DATE OF TRANS-REC < WS-LDA-STRDTE
034520180220              GO TO DPR-NEXT-TXN
034530180220           END-IF
034540180220      ** RFS1001189- End   **
034550171004
034560171016      ** RFS171359 - Start **
034570171016           IF Lc_STMLTD = "Y" AND
034580171004              PLACEMENT-DATE OF TRANS = pn_Placement_Date AND
034590180323              TRANS-NO OF TRANS =  pn_Trans_No
034600180626      * 1001329 - Begin
034610180626      * 1002905 - Begin:Comment out changes from 1001329 and add new
034620180626      *      IF PROCESS-DATE OF TRANS-REC IS <= WS-PRV-Y-END-DATE
034630180626      *        MOVE CLOSING-UNIT-BAL OF TRANS
034640180626      *         TO WS-TEMP-CLOSING-UNIT-BAL
034650180626      *      END-IF
034660180626      *      IF  PROCESS-DATE OF TRANS-REC IS > WS-PRV-Y-END-DATE
034670180626      *       AND WS-PTRANS-PROCESS-DATE IS <= WS-PRV-Y-END-DATE
034680180626      *           MOVE WS-PRV-CLOSING-UNIT-BAL
034690180626      *                      TO WS-TEMP-CLOSING-UNIT-BAL
034700180626      *      END-IF
034710180626      *      MOVE PROCESS-DATE OF TRANS-REC TO WS-PTRANS-PROCESS-DATE
034720180626      *      MOVE CLOSING-UNIT-BAL OF TRANS-REC
034730180626      *                          TO WS-PRV-CLOSING-UNIT-BAL
034740180626      * 1002905 - End
034750180626      * 1002905 - Begin
034760180626             PERFORM COMPUTE-AVG-COST-UNIT-BALANCE THRU CACUB-EXIT
034770180323      * 1002905 - End
034780171014      * 1001329 - End
034790171004              GO TO DPR-NEXT-TXN
034800171004           END-IF.
034810171004      ** RFS171359 - End   **
034820170614
034830170614      *RFS167932 - Starts
034840170614      *    IF PROCESS-DATE OF TRANS-REC  GREATER THAN  WS-LDA-ENDDTE
034850170614      *       GO TO DPR-EXIT
034860170614      *    END-IF
034870170614           INITIALIZE ld_SelectDate
034880170621
034890170620           IF lc-LdaSelectDate = "T" AND
034900170614              WS-LDA-STMT-CNFM-FLAG = "S"
034910170614              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDate
034920170614           ELSE
034930170614              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDate
034940170614           END-IF
034950190523
034960190523      * RFS 1013007 -- start
034970190523           IF lc-LdaSelectDate = "T" AND
034980190523              WS-LDA-STMT-CNFM-FLAG = "S"
034990190523              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDate
035000190523           ELSE
035010190523              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDate
035020190523           END-IF
035030190523
035040190523           IF lc-ldaSelectDate = "T" AND
035050190523              WS-LDA-STMT-CNFM-FLAG = "S"
035060190523            IF ld_SelectDate GREATER THAN WS-LDA-ENDDTE AND
035070190523               PROCESS-DATE OF TRANS-REC GREATER THAN WS-LDA-ENDDTE
035080190523              GO TO DPR-0090
035090190523            END-IF
035100190523           ELSE
035110190523            IF ld_SelectDate GREATER THAN WS-LDA-ENDDTE
035120190523               GO TO DPR-EXIT
035130190523            END-IF
035140190523           END-IF
035150190523      *    IF ld_SelectDate GREATER THAN  WS-LDA-ENDDTE
035160190523      *        GO TO DPR-EXIT
035170190523      *    END-IF
035180170614      * RFS 1013007 -- end
035190030825      *RFS167932 - Ends
035200980209
035210980304      *****
035220980209      ***** IF DAILY CONFIRM HOLDMAIL OR SUPPRESS FOR BOTH
035230980209      ***** DAILY AND DUPLICATE, FORMAT CONTROL REPORT AND GET
035240980209      ***** ANOTHER RECORD
035250980309      *****
035260991004
035270991004           IF WS-MFATRNP-KEYLST        IS  EQUAL TO  SPACES
035280991004              GO TO DPR-0010-0010
035290980309           END-IF
035300980309
035310991004           MOVE SPACES                 TO  WS-MFATRNP-KEYCUR.
035320991004           MOVE ACCOUNT-NO OF TRANS-REC
035330991004                                       TO  WS-KC-ACCOUNT-NO.
035340991004           MOVE INVESTMENT-CODE OF TRANS-REC
035350991004                                       TO  WS-KC-INVESTMENT-CODE.
035360991004           MOVE PROCESS-DATE OF TRANS-REC
035370991004                                       TO  WS-KC-PROCESS-DATE.
035380991004           MOVE TRANS-PROC-SEQ-NO OF TRANS-REC
035390991004                                       TO  WS-KC-TRANS-PROC-SEQ-NO.
035400991004           IF WS-MFATRNP-KEYCUR    IS LESS THAN  WS-MFATRNP-KEYLST
035410991004              GO TO DPR-0090
035420991004           END-IF
035430980309
035440980309           MOVE SPACES                 TO  WS-MFATRNP-KEYLST.
035450980309
035460981127       DPR-0010-0010.
035470031029
035480031029           IF HOLD-MAIL OF ADDRESS-RECD = "Y"
035490031029           AND WS-LDA-STMT-CNFM-FLAG = "C"
035500031029           AND WS-LDA-CNFM-DUP-FLAG = "N"
035510031029rf9523     AND WS-LDA-HOLD-MAIL       IS NOT EQUAL TO "Y"
035520031029R14871      IF  ACIVRNO OF INVESTOR-JOIN IS NOT EQUAL TO
035530031029  ¦                                WS-ACIVRNO-TEMP
035540031029  ¦         OR  ACACTNO OF INVESTOR-JOIN IS NOT EQUAL TO
035550031029  ¦                                WS-ACACTNO-TEMP
035560031029  ¦         OR  TRANS-NO OF TRANS-REC    IS NOT EQUAL TO
035570031029R14871                             WS-TRANSNO-TEMP
035580031029               PERFORM CONTROL-WRITE  THRU CW-EXIT
035590031029               MOVE "Y" TO WS-CTLREP-W-FLAG
035600031029R14871      END-IF
035610031029R18512         GO TO DPR-0090
035620031028           END-IF
035630991005
035640991005           MOVE TRANS-STATUS-CODE OF TRANS   TO  WS-TRANS-STATUS.
035650080623           MOVE TRANS-TYPE-CODE   OF TRANS   TO  WS-TRANS-TYPE.
035660991005R48660     MOVE TRANS-ORIGIN-CODE OF TRANS   TO  lc-OriginCode.
035670041216           MOVE CONTR-REDEM-CODE  OF TRANS   TO  WS-CONTR-REDEM.
035680991004R24058     MOVE CONTR-REDEM-CODE  OF TRANS   TO  WS-CONTR-REDEM-CODE.
035690010910           MOVE ZEROES                       TO  WS-TRNCHGHID.
035700000000
035710991004           IF NOT VALID-STATUS
035720991004              GO TO DPR-NEXT-TXN
035730991004           END-IF
035740970128
035750991004           IF NOT HISTORY AND NOT REVERSAL
035760030611              GO TO DPR-NEXT-TXN
035770030611R16913     END-IF.
035780090902
035790041216
035800041216R24058     PERFORM GET-CONTR-REDEM-RULE       THRU GCRR-EXIT.
035810030825
035820030825R17495     MOVE PLACEMENT-DATE OF TRANS-REC TO WS-PLACEMENT-DATE.
035830051026R17495     MOVE TRANS-NO       OF TRANS-REC TO WS-TRANS-NO.
035840051026R30514     MOVE SPACES                      TO WS-TRANS-DLR-REP-CODE.
035850051026  ¦        MOVE DEALER-CODE    OF TRANS-REC TO WS-TRANS-DLRCDE.
035860030825R30514     MOVE DEALER-REP-CODE OF TRANS-REC TO WS-TRANS-DLRREPCDE.
035870030825
035880031006R17495     IF TRANSFER-IN-OUT-ONLY OR REVERSAL OR FEES OR TRUSTEE-FEES
035890031006R18830       OR  REVERSE OF TRANS = "Y"
035900030826  |           IF  REVERSE OF TRANS = "Y"      AND
035910030826  |               HIDDEN-TRANS OF TRANS = "Y" AND
035920030826  |               WS-LDA-STMT-CNFM-FLAG = "S"
035930030826  |               MOVE "Y" TO  WS-HIDDEN-FLAG
035940030826  |           ELSE
035950030826  |               MOVE "N" TO  WS-HIDDEN-FLAG
035960030826  |           END-IF
035970030826  |
035980030825  |           PERFORM GET-TARGET-TRANSACTION THRU GTT-EXIT
035990030825  V        END-IF.
036000110107
036010110107R88823     IF TRANSFER-IN-OUT-ONLY
036020110302  |        AND WS-TARGET-ERROR    = "Y"
036030110107  |        AND Lc_BYPSTMTrn       = "Y"
036040110107  V           GO TO DPR-NEXT-TXN
036050110107R88823     END-IF.
036060030611
036070030611R16913*****
036080030611  ¦   ***** If a LSIF Rollover TRI/SWI or TRO/SWO transaction,
036090030611  ¦   ***** changed it to a BUY or SEL.
036100030611  ¦   *****
036110030611  ¦
036120030611  ¦    DPR-0010-0010-0010.
036130030611  ¦
036140030611  ¦        IF WS-IC-PROD (ICG)      IS NOT EQUAL TO "LBS"
036150030611  ¦           GO TO  DPR-0010-0010-0030
036160030611  ¦        END-IF.
036170030611  ¦
036180030611  ¦        IF NOT TRANSFER-IN-ONLY AND NOT TRANSFER-OUT-ONLY
036190030611  ¦           GO TO  DPR-0010-0010-0030
036200030611  ¦        END-IF.
036210030611  ¦
036220030611  ¦        PERFORM GET-REVERSAL-REASON-RTN  THRU GRRR-EXIT.
036230030611  ¦
036240030611  ¦        IF WS-RR-RULE (RR)   EQUAL TO  "5"
036250030611  ¦           IF TRANSFER-OUT-ONLY
036260030611  ¦             MOVE "SEL"      TO  TRANS-TYPE-CODE OF TRANS
036270030611  ¦           ELSE
036280030611  ¦             MOVE "BUY"      TO  TRANS-TYPE-CODE OF TRANS
036290030611  ¦           END-IF
036300080623  ¦           MOVE TRANS-TYPE-CODE OF TRANS   TO  WS-TRANS-TYPE
036310030611R48660        MOVE TRANS-ORIGIN-CODE OF TRANS TO  lc-OriginCode
036320030611  ¦        END-IF.
036330030611  v
036340030611R16913 DPR-0010-0010-0030.
036350030304
036360030304R16033*****
036370030304   ¦  ***** If TRI/TRO of GIC, bypass the transaction in Statement.
036380030304   ¦  *****
036390030304   ¦
036400030304   ¦       IF  WS-LDA-STMT-CNFM-FLAG          IS EQUAL TO "S"
036410030304   ¦       AND WS-PT-RULE (PT)                IS EQUAL TO "2"
036420030304   ¦       AND (TRANSFER-IN OR TRANSFER-OUT)
036430030304   ¦          MOVE "N"                        TO WS-GIC-SAME-FUND-FLAG
036440030304   ¦          PERFORM GET-GIC-OPPOSITE-SIDE   THRU GGOS-EXIT
036450030617   ¦          IF WS-GIC-SAME-FUND-FLAG        IS EQUAL TO "Y"
036460150414R17566           IF GROSS-AMT OF TRANS = GROSS-AMT OF TRANS-T-REC AND
036470150414      * RFS143400 Starts *
036480150414R17566*            NET-AMT OF TRANS   = NET-AMT OF TRANS-T-REC
036490150414                   NET-AMT OF TRANS   = NET-AMT OF TRANS-T-REC AND
036500150414                   LC-INC-GIC-REN-TRN = 'N'
036510150414      *RFS143400 ENDS
036520030617R17566             GO TO DPR-NEXT-TXN
036530030304R17566           END-IF
036540030304   ¦          END-IF
036550030304R16033     END-IF.
036560990329
036570990329           PERFORM GET-USER-ENTERED THRU GUE-EXIT.
036580070816
036590991004
036600991004           IF TRANS-TYPE-CODE  OF TRANS-REC   IS EQUAL TO  "BFW"
036610991004              MOVE "Y"                        TO  WS-INVAUC-SW
036620991004           END-IF
036630991004
036640991004           IF NOT ORIGINAL-COST-OUT
036650991004              GO TO DPR-0010-0015
036660991004           END-IF
036670060621
036680041216R24058     IF WS-CONTR-REDEM-CODE-RULE = "27"
036690041216   v          GO TO DPR-0010-0015
036700041216R24058     END-IF.
036710991004
036720991004           IF REVERSE OF TRANS = "Y"
036730991004              GO TO DPR-0010-0015
036740991004           END-IF
036750170614
036760170614      *RFS167932 - Starts
036770170614      *    IF PROCESS-DATE OF TRANS-REC  IS LESS THAN  WS-TAX-S-DATE-P
036780170620      *    OR PROCESS-DATE OF TRANS-REC  NOT LESS THAN  WS-TAX-S-DATE
036790170620           IF ld_SelectDate              IS LESS THAN  WS-TAX-S-DATE-P
036800170614           OR ld_SelectDate              NOT LESS THAN  WS-TAX-S-DATE
036810991004      *RFS167932 - Ends
036820991004               GO TO DPR-0010-0015
036830991004           END-IF
036840981214
036850980527           ADD GROSS-AMT OF TRANS      TO  WS-INV-TINCOME-PRV.
036860980527
036870010612       DPR-0010-0015.
036880051024
036890051024R30514***    Pupulate the FIRST-TRADE-DATE for an account.
036900051024  ¦
036910051024  ¦         IF HISTORY AND TRADE-DATE OF TRANS-REC IS LESS THAN
036920051024  ¦                                   WS-FIRST-TRADE-TRANSACTION
036930051024  ¦            MOVE TRADE-DATE OF TRANS-REC TO
036940051024  v                                   WS-FIRST-TRADE-TRANSACTION
036950051024R30514     END-IF.
036960010612
036970010612      ***
036980010612R10243***    Pupulate CD-FIRST-TRADE-DATE only for BUY or TRI or SWI.
036990010612      ***
037000010612
037010010612           IF (TRANS-TYPE-CODE OF TRANS-REC  IS EQUAL TO "BUY"
037020010612           OR TRANS-TYPE-CODE OF TRANS-REC   IS EQUAL TO "TRI"
037030010612           OR TRANS-TYPE-CODE OF TRANS-REC   IS EQUAL TO "SWI")
037040010612           AND REVERSE OF TRANS-REC          IS NOT EQUAL TO "Y"
037050010612           AND TRADE-DATE OF TRANS-REC      IS LESS THAN
037060010612                                                WS-FIRST-TRADE-DATE
037070010612              MOVE TRADE-DATE OF TRANS-REC   TO WS-FIRST-TRADE-DATE
037080010612           END-IF.
037090010612
037100010612R10243*** End of RFS10243
037110030625
037120030625R16881*** Populate AT-PHANTOM-FUND-NUMBER field.
037130030625  ¦
037140031229  ¦        IF WS-PT-RULE (PT)          IS  EQUAL TO  "4"
037150030625R19074     OR WS-PT-RULE (PT)          IS  EQUAL TO  "3"
037160030625  ¦        AND NOT DISTRIBUTION
037170030625  ¦            INITIALIZE           WS-PHANTOM-FUND-PARMS
037180030625  V            PERFORM POPULATE-PHANTOM-FUND-NUMBER   THRU PPFN-EXIT
037190981215R16881     END-IF.
037200971030
037210971030      *****
037220971030      *****    If this is not a contribution or a transfer in, indicate
037230971030      *****    the Book Value will have to be calculated.
037240981215      *****
037250980731
037260991004           IF  WS-BKVAL-SW           IS EQUAL TO "Y"
037270991004               PERFORM BOOK-VALUE-RTN THRU BVR-EXIT
037280000000           END-IF
037290000000
037300000000           PERFORM COMPUTE-AVG-COST-UNIT-BALANCE THRU CACUB-EXIT.
037310970115
037320970115      *****
037330970115      *****    If processing a REVERSAL, the amount is to be deducted,
037340970115      *****    not added.
037350970115      *****
037360990128
037370991004           IF  REVERSAL
037380991004               SUBTRACT GROSS-AMT OF TRANS
037390991004                        FROM  ZEROES  GIVING  GROSS-AMT OF TRANS
037400991004               SUBTRACT UNIT-AMT OF TRANS
037410991004                        FROM  ZEROES  GIVING  UNIT-AMT OF TRANS
037420991004           END-IF
037430051003
037440051003R14153**** The following part was moved from LR1-0000-0030. The sub
037450051003  ¦  ***** routine was also modifed not read the Trans file again since
037460051003  ¦  ***** it was read in the first level.
037470051003  ¦
037480051003  ¦        IF WS-LDA-RESP IS EQUAL TO "Y"
037490051003  ¦        AND WS-AT-RULE (AT1) IS EQUAL TO "4"
037500051003  v            PERFORM GEN-CURR-YEAR-RESP THRU GCYR-EXIT
037510051003R14153     END-IF.
037520990619
037530070724           PERFORM COMPUTE-EXCHANGE-RATE THRU CER-EXIT.
037540071019
037550071019R42810*    IF SUPPRESS-CONFIRMATION OF TRANS = "Y" AND  ;R44693
037560071019R42810*       WS-LDA-STMT-CNFM-FLAG = "C"               ;R44693
037570071019R42810*       GO TO DPR-NEXT-TXN                        ;R44693
037580011003R42810*    END-IF.                                      ;R44693
037581210914      * RFS 186903 - Begins
037582210914           IF SUPPRESS-CONFIRMATION OF TRANS = "Y" AND
037583210914              WS-LDA-STMT-CNFM-FLAG = "C"
037584210914              GO TO DPR-NEXT-TXN
037585210914           END-IF.
037586210914      * RFS 186903 - Ends
037590011003
037600011003R11127*****
037610011003      *****   RFS11127 If SEL/SWO and the Taxable-event-indicator in
037620011003      *****   the Taxable-Event-Code file = "D" or " "(means record not
037630011003      *****   fund), then the SEL/SWO was Disposition. For each SEL or
037640011003      *****   SWO, read the MFAACTEVP file
037650011003      *****
037660020923
037670020923R14556*****
037680021202      *****   Added TRANSFER-IN and TRANSFER-OUT to
037690020923      *****   GET-TAXABLE-EVENT-IND routine
037700020923      *****
037710020923
037720021202R14556     IF SWITCHES-OUT OR SEL-ONLY OR TRANSFER-IN OR TRANSFER-OUT
037730021202R15022        OR FEES OR TRUSTEE-FEES
037740011003R15022        PERFORM GET-TAXABLE-EVENT-IND        THRU CYTDD-EXIT
037750011003R11127     END-IF.
037760991004
037770051026           PERFORM COMPUTE-CURRENT-PERIOD THRU CP-EXIT.
037780051026
037790051026R30514     IF REINVESTED-ONLY
037800051026  ¦           PERFORM COMPUTE-DISTRIBUTION-ROC THRU CDR-EXIT
037810010326R30514     END-IF.
037820010326
037830010326      *****
037840010326      *****   RFS9466 If SWI/SWO and the Account-no is defferenet on
037850010326      *****   each side of the trade, the transactions should be
037860010326      *****   considered as TRI/TRO and be included in TRI/TRO instead
037870010326      *****   of in SWI/SWO. Because the amount have been calculated
037880010326      *****   before, therefore, recalculates are required.
037890010326      *****
037900010326
037910010326RF9466     IF SWITCHES-IN
037920010326           OR SWITCHES-OUT
037930010326              PERFORM RECOMPUTE-SWI-SWO  THRU RSS-EXIT
037940010326           END-IF.
037950010309
037960010309
037970010309RF8633***
037980010309      ***  For every transaction in the date-range read
037990010309      ***  TRANS-DISTR-DETAILS file to get the
038000010309      ***  DISTR-OPTION-CODE for Section 12.
038010030306      ***
038020090501
038030090501R61356     IF (WS-LDA-INVESTOR-12    IS EQUAL TO "Y"
038040051028R61356     OR WS-AT-RULE (AT1)      IS EQUAL TO  "9")
038050051028 ¦         AND DISTRIBUTION
038060051026 v            PERFORM INVESTOR-SUMMARY-SECTION2 THRU ISS2-EXIT
038070010309R30514     END-IF.
038080160321      ***  End RFS8633
038090190725148326     IF WS-LDA-INVESTOR-12    IS EQUAL TO "Y" AND
038100190725      * RFS 1016703 - start
038110190725              ((REVERSE OF TRANS-REC IS EQUAL TO "Y" OR "N" OR " "
038120190725                 AND
038130190725                lc-LDASelectDate = "T"               AND
038140190725                WS-LDA-STMT-CNFM-FLAG = "S") OR
038150190725               (REVERSE OF TRANS-REC  IS NOT EQUAL TO "Y" AND
038160190725                lc-LDASelectDate = "P"))
038170190725148326*       REVERSE OF TRANS-REC  IS NOT EQUAL TO "Y"
038180160209      * RFS 1016703 - end
038190010309148326        PERFORM INVESTOR-SUMMARY-SECTION2-MER THRU ISSM-EXIT.
038200010420
038210010420RF8633***    Pupulate Professional Service Fee fields in Section10.
038220010420      ***
038230010420
038240160811           IF TRANS-TYPE-CODE OF TRANS             IS EQUAL TO "FEE"
038250010420158609        OR TRANS-TYPE-CODE OF TRANS IS EQUAL TO "TFE"
038260010420              PERFORM GET-PROFESSIONAL-FEE         THRU GPF-EXIT
038270010420           END-IF.
038280010420
038290010420RF8633*** End of rf8633
038300991004
038310991004           IF REVERSAL
038320991004              SUBTRACT GROSS-AMT OF TRANS
038330991004                       FROM  ZEROES GIVING  GROSS-AMT OF TRANS
038340991004              SUBTRACT UNIT-AMT OF TRANS
038350991004                       FROM  ZEROES  GIVING  UNIT-AMT OF TRANS
038360000000           END-IF
038370000000
038380000000           PERFORM FORMAT-TXN-OUTPUT-RECORD THRU FTOR-EXIT.
038390011102
038400011102R10605     IF  WS-ACCOUNT-DLRCDE = WS-TRANS-DLRCDE
038410011102           AND WS-ACCOUNT-DLRREPCDE = WS-TRANS-DLRREPCDE
038420011102               MOVE WS-REP-NAME-ACC      TO AT-REP-NAME
038430011102           ELSE
038440030825               PERFORM GET-DLR-REP-NAME-FOR-TXN THRU GDRNT-EXIT
038450010910R10605     END-IF.
038460000000
038470000000      *------------------------------------------------*
038480000000      *  DEDUCTIONS, COMMISSIONS, TAXES                *
038490991004      *------------------------------------------------*
038500030825
038510030825       DPR-TRANS-CHARGES.
038520980615R17495     PERFORM TRANS-CHARGES-PROCESS THRU TCP-EXIT.
038530000000
038540970115       DPR-CONTRIB.
038550970115
038560970115      *****
038570970115      *****    If processing a REVERSAL, the amount will decrease, not
038580970115      *****    increase, the accumulated contributions and withdrawals.
038590970115      *****
038600970115
038610991005           IF  REVERSAL
038620991005               SUBTRACT GROSS-AMT OF TRANS
038630991005                    FROM  ZEROS    GIVING  GROSS-AMT OF TRANS
038640991005           END-IF
038650990619
038660991005           PERFORM COMPUTE-EXCHANGE-RATE THRU CER-EXIT.
038670991005           PERFORM ACCUM-CONTRIB-WITHDRAW THRU ACW-EXIT.
038680970115
038690991005           IF  REVERSAL
038700991005               SUBTRACT GROSS-AMT OF TRANS
038710991005                    FROM  ZEROS    GIVING  GROSS-AMT OF TRANS
038720021204           END-IF
038730021230
038740021230R14101     IF WS-LDA-REPORT-HIDDEN-TRANS    IS NOT EQUAL TO "Y"
038750021230              GO TO DPR-0050
038760021230           END-IF.
038770021230
038780021230           IF  REVERSE OF TRANS = "Y" AND HIDDEN-TRANS OF TRANS = "Y"
038790030605           AND WS-LDA-STMT-CNFM-FLAG = "S"
038800030825
038810030825               IF TRANS-STATUS-CODE OF TRANS NOT = "RVS"
038820021230                  IF PROCESS-DATE OF TRANS-T-REC NOT > WS-LDA-ENDDTE
038830021230                     GO TO DPR-NEXT-TXN
038840021230                  ELSE
038850021230                     GO TO DPR-0055
038860021230                  END-IF
038870030825               ELSE
038880021230                  IF PROCESS-DATE OF TRANS-T-REC NOT < WS-LDA-STRDTE
038890021230                     GO TO DPR-NEXT-TXN
038900021230                  ELSE
038910021230                     GO TO DPR-0055
038920021230                  END-IF
038930021230               END-IF
038940021230           END-IF.
038950021230
038960021204R14101 DPR-0050.
038970970523
038980020122           IF HIDDEN-TRANS OF TRANS = "Y"
038990980209R11936     AND WS-LDA-STMT-CNFM-FLAG = "S"
039000021204             GO TO DPR-NEXT-TXN
039010021230           END-IF.
039020021230
039030021204R14101 DPR-0055.
039040991005
039050991005           IF  WS-LDA-MGMT-COM-CDE        IS NOT EQUAL TO  "CEM"
039060991005           OR  WS-TRNCHGHID               IS EQUAL TO  ZEROES
039070991005           OR  GROSS-AMT OF TRANS-REC     IS GREATER THAN  ZEROES
039080991005               GO TO DPR-0060
039090980623           END-IF
039100980623
039110001123           IF  CAPITAL-GAIN
039120980623           OR  CAPITAL-LOSS
039130980623           OR  INCOME
039140991005           OR  INTEREST
039150991005               GO TO DPR-0090
039160991005           END-IF.
039170980623
039180991005       DPR-0060.
039190970705
039200970705           IF  AT-GROSS      IS LESS THAN  AT-NET
039210970705               SUBTRACT AT-GROSS     FROM  AT-NET
039220970705                                   GIVING  AT-GROSS-NET-DIFF
039230991005               MOVE "-"                TO  AT-GROSS-NET-DIFF-SIGN
039240970705           ELSE
039250970705               SUBTRACT AT-NET       FROM  AT-GROSS
039260061003                                   GIVING  AT-GROSS-NET-DIFF
039270991005R35540         MOVE " "                TO  AT-GROSS-NET-DIFF-SIGN
039280991005           END-IF
039290001012
039300980521RF4638     ADD AT-DSC
039310971223               AT-COMMISSION       GIVING  AT-SALES-CHARGE.
039320011120
039330011010R11127     COMPUTE WS-NON-TAX-DEDUCTIONS =  AT-GROSS-NET-DIFF
039340011120                                         -  AT-TAX.
039350011120           IF WS-NON-TAX-DEDUCTIONS      IS LESS THAN ZEROES
039360061003              MOVE "-"                   TO AT-NON-TAX-DEDUCT-SIGN
039370061003R35540     ELSE
039380011120R35540        MOVE " "                   TO AT-NON-TAX-DEDUCT-SIGN
039390011120           END-IF.
039400011120
039410170112R11127     MOVE WS-NON-TAX-DEDUCTIONS    TO AT-NON-TAX-DEDUCTIONS.
039420170112166016     IF WS-STM79-FLAG NOT = "Y"
039430170112166016        MOVE AT-NON-TAX-DEDUCTIONS TO
039440170112166016                            WS-TEMP-AT-NON-TAX-DEDUCTIONS
039450030422166016     END-IF.
039460030422
039470030422R16990     MOVE WS-TRANS-TOTAL-DEDUCTIONS TO AT-TOTAL-DEDUCTIONS.
039480030422  ¦        IF WS-TRANS-TOTAL-DEDUCTIONS   IS LESS THAN ZEROES
039490061003  v           MOVE "-"                    TO AT-TOTAL-DEDUCTIONS-SIGN
039500061003R35540     ELSE
039510030422R35540        MOVE " "                    TO AT-TOTAL-DEDUCTIONS-SIGN
039520030422R16990     END-IF.
039530060829
03954006082934072      MOVE ln_trn_total_redem_charge TO AT-REDEM-CHARGE.
039550060829  ¦        IF (ln_trn_total_redem_charge < 0 )
039560061003             MOVE "-"       TO AT-REDEM-CHARGE-SIGN
039570061003R35540     ELSE
039580060829R35540       MOVE " "       TO AT-REDEM-CHARGE-SIGN
039590971223           END-IF.
039600971223      *****    If processing a capital gain transaction for a fixed
039610971223      *****    price fund which has no units and is for a non-base
039620971223      *****    currency, the transaction is to be suppressed.  If the
039630971223      *****    transaction is to be suppressed and belongs to a
039640971223      *****    registered account type, the capital gain amount is to be
039650971223      *****    accumulated to populate the Account Detail record.
039660971223      *****    Please note that the amount is to be stored in Canadian
039670971223      *****    dollars using the Exchange Rate Multiple file.
039680971223      *****
039690001123
039700001123           IF  (TRANS-TYPE-CODE OF TRANS-REC  NOT EQUAL TO  "CPG" AND
039710991005                TRANS-TYPE-CODE OF TRANS-REC  NOT EQUAL TO  "CPL")
039720991005           OR  WS-IG-FIXVAR (IG)   IS NOT EQUAL TO  "F"
039730190626           OR  AT-NO-OF-UNITS      IS NOT EQUAL TO  ZEROES
039740991005183443     OR  AT-UNIT-PRICE       IS EQUAL TO ZEROS
039750991005           OR  CC                  IS EQUAL TO  WS-CC-BSE
039760991005               GO TO DPR-0060-0020
039770991005           END-IF
039780991005
039790991005           IF  WS-AT-RULE (AT1)      IS NOT EQUAL TO  "1"
039800991005               GO TO DPR-0060-0010
039810991005           END-IF
039820971223
039830971223           INITIALIZE MFAEXRHMP.
039840971223           MOVE WS-IC-CURR (IC)        TO  CURRENCY-DDS
039850971223                                           OF EXCHANGE-RATE-M-REC.
039860971223           MOVE TRADE-DATE
039870971223                OF TRANS-REC           TO  TRADE-DATE
039880971223                                           OF EXCHANGE-RATE-M-REC.
039890971223           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
039900971223                                           OF EXCHANGE-RATE-M-REC.
039910971223           READ EXCHANGE-RATE-M
039920971223               INVALID KEY
039930971223                   MOVE 1              TO  EXCHANGE-RATE
039940971223                                           OF EXCHANGE-RATE-M-REC.
039950991005
039960991005           IF EXCHANGE-RATE OF EXCHANGE-RATE-M-REC IS EQUAL TO ZEROES
039970991005              MOVE 1         TO  EXCHANGE-RATE OF EXCHANGE-RATE-M-REC
039980971223           END-IF
039990971223
040000971229           COMPUTE WS-INV-CPG ROUNDED   =  WS-INV-CPG
040010971229                                        +  (GROSS-AMT
040020971223                                            OF TRANS-REC
040030971223                                        /   EXCHANGE-RATE
040040971223                                            OF EXCHANGE-RATE-M-REC).
040050971223
040060991004       DPR-0060-0010.
040070991004
040080970705           GO TO DPR-0090.
040090971223
040100991202       DPR-0060-0020.
040110001013
040120001013RF4638     IF PURCHASE-TRANSACTION
040130001013              PERFORM POPULATE-CDSC-SCHEDULE      THRU PCS-EXIT
040140020131           END-IF
040150030625R12102*** Populate AT-PHANTOM-FUND-NUMBER field.
040160991202R16881     MOVE WS-AT-PHANTOM-FUND-NUMBER  TO AT-PHANTOM-FUND-NUMBER.
040170991202RF5962     IF NOT REINVESTED-ONLY
040180991202              GO TO DPR-0060-0030
040190991229           END-IF
040200991202      *** POPULATE TRANSACTION DETAILS RECORD
040210991202           PERFORM POPULATE-DISTRIBUTION-ROC      THRU PDR-EXIT.
040220160225       DPR-0060-0030.
040230160324148326     PERFORM PREPARE-SECTION80-NEW-FIELD-A THRU PSNFA-EXIT.
040240160328148326     IF TRANSFER-IN-OUT-ONLY AND
040250160324148326          WS-CC-BASE (CC) IS NOT EQUAL TO  "Y"
040260160225148326          PERFORM COMPUTE-SPOT-EXCHANGE-RATE    THRU CSER-EXIT
040270160225148326          IF WS-SPOT-EXCHANGE-RATE IS NOT EQUAL TO ZEROES
040280160225148326             MOVE WS-SPOT-EXCHANGE-RATE TO AT-EXCHANGE-RATE
040290160225148326          END-IF
040300060621148326     END-IF.
040310030826R18147     MOVE ACCOUNT-TXN-SECTION TO STATEMENT-REC(ISR).
040320061004R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
040330061004R34848**RFS34848 - Start
040340061004      *****    If  Deduction-Code-Description parameter on the
040350061004      *****    confirmation extract file parameter table(MFACONPARM) is
040360061004      *****    equal to 'Y', then for each deduction of the current
040370061004      *****    transaction, load section 81.
040380061004      *****
040390061004           IF WS-LDA-STMT-CNFM-FLAG = lnc_C   AND
040400061004              lc-LdaSection81  =  lnc_Y
040410061004              COMPUTE li_DedIndex = 1
040420061004              PERFORM TRANS-DEDUCTION until li_DedIndex > li_DedMax
040430061004           END-IF.
040440970425R34848**RFS34848 - End
040450970425      *****
040460970425      *****    If required, format and create the Institution Detail
040470970425      *****    record using the Institution.
040480971101      *****
040490991004
040500991005           IF WS-LDA-INST-FLAG       IS NOT EQUAL TO  "Y"
040510991013              GO TO DPR-0080
040520991004           END-IF.
040530991004
040540991004           IF TRANS-ORIGIN-CODE OF TRANS-REC  NOT EQUAL TO  "TRK"
040550991005           OR INSTITUTION-CODE OF TRANS-REC   IS EQUAL TO  SPACES
040560991013              GO TO DPR-0080
040570991004           END-IF.
040580970425
040590991004           INITIALIZE MFAINSP.
040600991004
040610991004           MOVE INSTITUTION-CODE OF TRANS-REC
040620970425                       TO  INSTITUTION-CODE OF INSTITUTION-REC.
040630991004           READ INSTITUTION
040640991004             INVALID KEY
040650991004               MOVE "UNKNOWN"          TO  INSTITUTION-NAME
040660991004                                           OF INSTITUTION-REC
040670991004           END-READ
040680970425
040690991004           INITIALIZE AT-INSTITUTION-DETAIL-SECTION.
040700970425
040710970425           MOVE AT-INVESTOR-NO         TO  TI-INVESTOR-NO.
040720970425           MOVE AT-ACCOUNT             TO  TI-ACCOUNT.
040730970425           MOVE 82                     TO  TI-SECTION-NO.
040740970425           MOVE AT-SECTION-SEQUENCE    TO  TI-SECTION-SEQUENCE.
040750970425           MOVE AT-LANGUAGE            TO  TI-LANGUAGE.
040760970425           MOVE AT-DEALER              TO  TI-DEALER.
040770970425           MOVE AT-SALESREP            TO  TI-SALESREP.
040780970425           MOVE INSTITUTION-CODE
040790970425                OF TRANS-REC           TO  TI-INSTITUTION-CODE.
040800970425           MOVE BRANCH-CODE
040810991004                OF TRANS-REC           TO  TI-BRANCH-CODE.
040820970425
040830991004           IF  TI-LANGUAGE   NOT EQUAL TO  "F"
040840970425           OR  INSTITUTION-NAME-FRENCH OF INSTITUTION-REC
040850970425                              IS EQUAL TO  SPACES
040860970425               MOVE INSTITUTION-NAME
040870991004                    OF INSTITUTION-REC TO  TI-INSTITUTION-NAME
040880970425           ELSE
040890991004               MOVE INSTITUTION-NAME-FRENCH
040900991004                    OF INSTITUTION-REC TO  TI-INSTITUTION-NAME
040910991008           END-IF
040920980129           MOVE AT-SECTION-SEQUENCE    TO  TI-SECTION-SEQUENCE-2.
040930980129           MOVE AT-START-DATE          TO  TI-START-DATE.
040940060621           MOVE AT-END-DATE            TO  TI-END-DATE.
040950030826R18147     MOVE AT-INSTITUTION-DETAIL-SECTION TO STATEMENT-REC(ISR).
040960970425R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
040970991004
040980991006991004*****
040990991004      ***** Process an RESP transaction in an RESP Account
041000991004      *****
041010991005
041020991005       DPR-0080.
041030991013
041040991013           IF WS-LDA-RESP-84 IS NOT EQUAL TO "Y"
041050991013              GO TO DPR-0090.
041060991102
041070991102991102     IF WS-LDA-RESP                IS NOT EQUAL TO "Y"
041080991109991102     OR WS-AT-RULE (AT1)           IS NOT EQUAL TO "4"
041090991109              GO TO DPR-0090
041100991109           END-IF
041110991006
041120041105           IF TRANS-TYPE-CODE OF TRANS-REC  IS NOT EQUAL TO
041130991006R24093        "SEL" AND "BUY" AND "TRI" AND "TRO" AND "SWI" AND "SWO"
041140991013              GO TO DPR-0090
041150991006           END-IF.
041160991006
041170991006           MOVE "Y"                    TO    WS-RESP-84.
041180991006           PERFORM GENERATE-BENEFICIARY-REC THRU GBR-EXIT.
041190991004
041200991004      *****
041210991004      *****    Format and Write AT RESP DETAILS SECTION
041220991006      *****
041230991006
041240991004
041250991015           INITIALIZE AT-RESP-DETAIL-SECTION.
041260991015           MOVE AT-INVESTOR-NO          TO  TE-INVESTOR-NO.
041270991004           MOVE AT-ACCOUNT              TO  TE-ACCOUNT.
041280991009           MOVE 84                      TO  TE-SECTION-NO.
041290991015           MOVE AT-SECTION-SEQUENCE     TO  TE-SECTION-SEQUENCE.
041300991015           MOVE AT-LANGUAGE             TO  TE-LANGUAGE.
041310991015           MOVE AT-DEALER               TO  TE-DEALER.
041320020108           MOVE AT-SALESREP             TO  TE-SALESREP.
041330020108
041340020108r12620     IF  REVERSAL
041350020108               SUBTRACT GROSS-AMT OF TRANS
041360020108                    FROM  ZEROS    GIVING  GROSS-AMT OF TRANS
041370020108           END-IF
041380030429
041390020108R17199     PERFORM GENERATE-RESP-BENEFICIARY-INFO THRU GRBI-EXIT.
041400020108
041410020108           IF  REVERSAL
041420020108               SUBTRACT GROSS-AMT OF TRANS
041430020108                    FROM  ZEROS    GIVING  GROSS-AMT OF TRANS
041440020108r12620     END-IF
041450991009
041460991009           MOVE TE-SECTION-SEQUENCE     TO  TE-SECTION-SEQUENCE-2.
041470991009           MOVE AT-START-DATE           TO  TE-START-DATE.
041480991009           MOVE AT-END-DATE             TO  TE-END-DATE.
041490060621
041500030826R18147     MOVE AT-RESP-DETAIL-SECTION TO STATEMENT-REC(ISR).
041510991004R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
041520991004
041530991004       DPR-0090.
041540980209
041550000000           GO TO DPR-NEXT-TXN.
041560991004
041570991004      **********
041580000000
041590000000       DPR-EXIT.
041600061004           EXIT.
041610061004R34848**RFS34848 - Start
041620061004      *****************************************************
041630061004      ***  Load section 81.
041640061004      ***  For client extract file, the key position of
041650061004      ***  DT-SECTION-SEQUENCE-2 is ahead of DT-SECTION-SEQUENCE.
041660061004      *****************************************************
041670061004       TRANS-DEDUCTION.
041680061004
041690061004           INITIALIZE TRANS-DED-SECTION.
041700061004           MOVE AT-INVESTOR-NO                 TO DT-INVESTOR-NO.
041710061004           MOVE AT-ACCOUNT                     TO DT-ACCOUNT.
041720061004           MOVE lnc_81                         TO DT-SECTION-NO.
041730061004           MOVE li_DedIndex                    TO DT-SECTION-SEQUENCE.
041740061004           MOVE AT-LANGUAGE                    TO DT-LANGUAGE.
041750061004           MOVE AT-DEALER                      TO DT-DEALER.
041760061004           MOVE AT-SALESREP                    TO DT-SALESREP.
041770061004           MOVE ln_TransDedCharge(li_DedIndex) TO DT-DEDUCTION-AMOUNT.
041780061004           MOVE lc_TransDedCode(li_DedIndex)   TO DT-DEDUCTION-CODE.
041790061004      *****
041800061004      ***** Default description to blank if the code is not defined in
041810061004      ***** the description table.
041820061004      *****
041830061004           IF li_TdLst  >  ZEROES
041840061004              SET li_IxTrnDed         TO 1
041850061004              SEARCH lc_TrndepEnt     VARYING  li_IxTrnDed
041860061004              AT END
041870061004                 MOVE SPACE   TO DT-DEDUCTION-DESC-SHORT
041880061004                 MOVE SPACE   TO DT-DEDUCTION-DESC-LONG
041890061004              WHEN (lc_DedCode (li_IxTrnDed)  = DT-DEDUCTION-CODE)
041900061004               AND (lc_LangCode (li_IxTrnDed) = DT-LANGUAGE)
041910061004                 MOVE lc_DedShortDesc (li_IxTrnDed)
041920061004                            TO DT-DEDUCTION-DESC-SHORT
041930061004                 MOVE lc_DedLongDesc (li_IxTrnDed)
041940061004                            TO DT-DEDUCTION-DESC-LONG
041950061004              END-SEARCH
041960061004           END-IF.
041970061004           MOVE AT-SECTION-SEQUENCE        TO DT-SECTION-SEQUENCE-2.
041980061004           MOVE AT-START-DATE              TO DT-START-DATE.
041990061004           MOVE AT-END-DATE                TO DT-END-DATE.
042000061004           MOVE TRANS-DED-SECTION          TO STATEMENT-REC(ISR).
042010061004           PERFORM INSERT-STATEMENT-REC    THRU ISR-EXIT.
042020061004           COMPUTE li_DedIndex = li_DedIndex + 1.
042030991004R34848**RFS34848 - End
042040991004
042050991004      **********
042060011106
042070011106R11623 BYPASS-CLOSED-ACCOUNT-RTN.
042080030825
042090030825      **** If the account was closed after the statement start date
042100030825      **** do not bypass the account.
042110030825
042120030825R18147     MOVE "BYPASS-CLOSED-ACCOUNT " TO WS-SQLERR-STATEMENT.
042130030825           EXEC SQL
042140030825             OPEN IVRCLC1
042150030825           END-EXEC.
042160030825
042170030825           EXEC SQL
042180030825             FETCH NEXT FROM IVRCLC1
042190030825             INTO :WS-BYPASS-ACCOUNT
042200030825           END-EXEC.
042210030825
042220030825           IF SQLCODE = 100
042230030825             MOVE "Y" TO WS-BYPASS-ACCOUNT
042240030825           END-IF.
042250030825
042260030825           EXEC SQL
042270030825             CLOSE IVRCLC1
042280030825           END-EXEC.
042290030825
042300030825       BCAR-EXIT.
042310030825            EXIT.
042320011106
042330991004R11623**********
042340030429      /
042350030429R17199 GENERATE-RESP-BENEFICIARY-INFO.
042360030429  ¦
042370131212  ¦        INITIALIZE  TRANS-RESP-DETAILS-REC.
042380131212130414* Removed the changes added in RFS 119949
042390131212119949*    INITIALIZE  WS-TE-DIF-AMOUNT.
042400030429119949*    INITIALIZE  WS-TE-ACC-AMOUNT.
042410030429  ¦
042420030429  ¦        MOVE PLACEMENT-DATE OF TRANS-REC
042430030429  ¦                TO PLACEMENT-DATE OF TRANS-RESP-DETAILS-REC.
042440030429  ¦        MOVE TRANS-NO OF TRANS-REC
042450030429  ¦                TO TRANS-NO OF TRANS-RESP-DETAILS-REC.
042460030429  ¦        MOVE LOW-VALUES
042470030429  ¦                TO REPORTED OF TRANS-RESP-DETAILS-REC.
042480131212  ¦
042490131212130414* Removed the changes added in RFS 80564
042500030429r80564*    MOVE ZEROES               TO  WS-TE-AMOUNT-tot.
042510030429  ¦        MOVE GROSS-AMT OF TRANS-REC  TO WS-TE-GROSS-AMOUNT.
042520030429  ¦
042530030429  ¦        START TRANS-RESP-DETAILS
042540030429  ¦          KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
042550030429  ¦            INVALID KEY
042560030429  ¦              GO TO GRBI-EXIT
042570030429  ¦        END-START
042580030429  ¦
042590030429  ¦        READ TRANS-RESP-DETAILS NEXT
042600030429  ¦           AT END
042610030429  ¦              GO TO GRBI-EXIT
042620030429  ¦        END-READ
042630030429  ¦
042640030429  ¦        IF PLACEMENT-DATE OF TRANS-RESP-DETAILS-REC IS NOT EQUAL
042650030429  ¦                          TO PLACEMENT-DATE OF TRANS-REC
042660030429  ¦        OR TRANS-NO OF TRANS-RESP-DETAILS-REC  IS NOT EQUAL
042670030429  ¦                          TO TRANS-NO OF TRANS-REC
042680030429  ¦              GO TO GRBI-EXIT
042690030429  ¦        END-IF
042700030429  ¦
042710030429  ¦        INITIALIZE ACCOUNT-BENEFICIARY-SPLIT-REC.
042720030429  ¦
042730030429  ¦        MOVE ACCOUNT-NO OF TRANS-RESP-DETAILS-REC
042740030429  ¦             TO ACCOUNT-NO OF ACCOUNT-BENEFICIARY-SPLIT-REC.
042750030429  ¦        MOVE BENEFICIARY-SPLIT-CODE OF TRANS-RESP-DETAILS-REC
042760030429  ¦         TO BENEFICIARY-SPLIT-CODE OF ACCOUNT-BENEFICIARY-SPLIT-REC.
042770030429  ¦        MOVE HRDC-FILE-DATE         OF TRANS-RESP-DETAILS-REC
042780030429  ¦         TO HRDC-FILE-DATE         OF ACCOUNT-BENEFICIARY-SPLIT-REC.
042790030429  ¦        MOVE ZEROS                 TO BENEFICIARY-SEQ-NO
042800030429  ¦                                   OF ACCOUNT-BENEFICIARY-SPLIT-REC.
042810030429  ¦
042820030429  ¦        START ACCOUNT-BENEFICIARY-SPLIT
042830030429  ¦           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
042840030429  ¦           INVALID KEY
042850030429  ¦                GO TO GRBI-EXIT
042860030429  ¦        END-START
042870030429  ¦        MOVE ZEROES               TO WS-RESP-BENEFICIARY-CNT.
042880030429  ¦        MOVE ZEROES               TO WS-RESP-BENEFICIARY-SEQ.
042890030429  ¦
042900030429  ¦    GRBI-READ.
042910030429  ¦
042920030429  ¦        READ ACCOUNT-BENEFICIARY-SPLIT NEXT
042930030429  ¦             AT END
042940030429  ¦                GO TO GRBI-EXIT
042950030429  ¦        END-READ.
042960030429  ¦
042970030429  ¦        IF ACCOUNT-NO OF ACCOUNT-BENEFICIARY-SPLIT-REC IS NOT
042980030429  ¦                EQUAL TO  ACCOUNT-NO OF TRANS-RESP-DETAILS-REC
042990030429  ¦        OR BENEFICIARY-SPLIT-CODE OF ACCOUNT-BENEFICIARY-SPLIT-REC
043000030429  ¦                     IS NOT EQUAL TO BENEFICIARY-SPLIT-CODE
043010030429  ¦                                         OF TRANS-RESP-DETAILS-REC
043020030429  ¦        OR HRDC-FILE-DATE OF ACCOUNT-BENEFICIARY-SPLIT-REC IS NOT
043030030429  ¦              EQUAL TO    HRDC-FILE-DATE OF TRANS-RESP-DETAILS-REC
043040030429  ¦              GO TO GRBI-EXIT
043050030429  ¦        END-IF.
043060030429  ¦
043070030429  ¦    GRBI-WRITE.
043080030429  ¦
043090030429  ¦        ADD 1                     TO WS-RESP-BENEFICIARY-CNT.
043100030429  ¦        MOVE BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-SPLIT-REC
043110030429  ¦                                  TO WS-RESP-BENEFICIARY-SEQ.
043120030429  ¦
043130030429  ¦        MOVE BENEFICIARY-PERCENT OF ACCOUNT-BENEFICIARY-SPLIT-REC
043140131212  ¦                                  TO WS-TE-PERCENT.
043150030429  ¦   *RFS130414- Start- Removed the changes of RFS 80564 and 119949
043160131212  ¦        COMPUTE  WS-TE-AMOUNT ROUNDED  = WS-TE-PERCENT
043170030429130414*    COMPUTE  WS-TE-AMOUNT = WS-TE-PERCENT
043180030429  ¦                                     * WS-TE-GROSS-AMOUNT
043190131212  ¦                                     / 100.
043200131212R80564*    IF WS-TE-PERCENT not equal 033.34
043210131212  ¦   *    AND WS-RESP-BENEFICIARY-CNT not equal 3
043220131212  |   *        Add  WS-TE-AMOUNT   to  WS-TE-AMOUNT-tot
043230131212  |   *    END-IF
043240131212  ¦   *    IF WS-TE-PERCENT = 033.34
043250131212  ¦   *    AND WS-RESP-BENEFICIARY-CNT = 3
043260131212  ¦   *        COMPUTE  WS-TE-AMOUNT ROUNDED  =
043270131212  v   *          WS-TE-GROSS-AMOUNT - WS-TE-AMOUNT-tot
043280130607R80564*    END-IF
043290131212      *RFS119949 - Start
043300131212      *    COMPUTE WS-TE-ACC-AMOUNT =
043310131212      *         WS-TE-AMOUNT + WS-TE-ACC-AMOUNT
043320131212      *    IF WS-TE-ACC-AMOUNT > WS-TE-GROSS-AMOUNT
043330131212      *       COMPUTE  WS-TE-DIF-AMOUNT =
043340131212      *          WS-TE-ACC-AMOUNT - WS-TE-GROSS-AMOUNT
043350131212      *       IF WS-TE-DIF-AMOUNT < 1
043360131212      *          COMPUTE  WS-TE-AMOUNT =
043370131212      *             WS-TE-AMOUNT - WS-TE-DIF-AMOUNT
043380131212      *       END-IF
043390131212      *    END-IF
043400131212      *    IF WS-TE-ACC-AMOUNT < WS-TE-GROSS-AMOUNT
043410131212      *       COMPUTE  WS-TE-DIF-AMOUNT =
043420131212      *          WS-TE-GROSS-AMOUNT - WS-TE-ACC-AMOUNT
043430131212      *       IF WS-TE-DIF-AMOUNT < 1
043440131212      *          COMPUTE  WS-TE-AMOUNT =
043450131212      *             WS-TE-AMOUNT + WS-TE-DIF-AMOUNT
043460131212      *       END-IF
043470131212      *    END-IF
043480130607      *RFS130414- End-Removed the changes of RFS 80564 and 119949
043490030429      *RFS119949 - End
043500030429  ¦        IF WS-RESP-BENEFICIARY-CNT   IS GREATER THAN  50
043510030429  ¦           GO TO GRBI-EXIT
043520030429  ¦        END-IF
043530030429  ¦   ***********************************************
043540030429  ¦   **** Load RESP Benefiary Amounts in to an Array
043550030429  ¦   ***********************************************
043560030429  ¦        SET BEN                     TO  WS-RESP-BENEFICIARY-SEQ
043570030429  ¦
043580030429  ¦        MOVE  WS-RESP-BENEFICIARY-SEQ TO WS-BEN-SEQ-NO (BEN)
043590051003  ¦
043600030429R14153     IF WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  1
043610030429  ¦         COMPUTE  WS-BEN-AMT-TOT-LTD-CONTR (BEN) = WS-TE-AMOUNT  +
043620060206  ¦                WS-BEN-AMT-TOT-LTD-CONTR (BEN)
043630060206  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN
043640030429  ¦                             WS-CURYTDSTRDTE
043650030429  ¦           COMPUTE  WS-BEN-AMT-TOT-YTD-CONTR (BEN) = WS-TE-AMOUNT  +
043660030429  ¦                 WS-BEN-AMT-TOT-YTD-CONTR (BEN)
043670030429  ¦          END-IF
043680051003  ¦        END-IF
043690041105R14153     IF WS-CONTR-REDEM-CODE-RULE
043700030429R24093             IS EQUAL TO  3 OR 6 OR 7 OR 8 OR 11 OR 12 OR 47
043710030429  ¦         COMPUTE  WS-BEN-AMT-TOT-LTD-WITHD (BEN) = WS-TE-AMOUNT  +
043720060206  ¦                 WS-BEN-AMT-TOT-LTD-WITHD (BEN)
043730060206  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN
043740030429  ¦                             WS-CURYTDSTRDTE
043750030429  ¦           COMPUTE  WS-BEN-AMT-TOT-YTD-WITHD (BEN) = WS-TE-AMOUNT  +
043760030429  ¦                 WS-BEN-AMT-TOT-YTD-WITHD (BEN)
043770030429  ¦          END-IF
043780051003  ¦        END-IF
043790030429R14153     IF WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  5
043800030429  ¦          COMPUTE  WS-BEN-AMT-TOT-LTD-CESG (BEN) = WS-TE-AMOUNT  +
043810060206  ¦                 WS-BEN-AMT-TOT-LTD-CESG (BEN)
043820060206  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN
043830030429  ¦                             WS-CURYTDSTRDTE
043840030429  ¦           COMPUTE  WS-BEN-AMT-TOT-YTD-CESG (BEN) = WS-TE-AMOUNT  +
043850030429  ¦                 WS-BEN-AMT-TOT-YTD-CESG (BEN)
043860030429  ¦          END-IF
043870101104  ¦        END-IF
043880101104R83788     IF WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  15
043890101104  ¦          COMPUTE WS-BEN-AMT-TOT-LTD-CLB (BEN) = WS-TE-AMOUNT  +
043900101104  ¦                  WS-BEN-AMT-TOT-LTD-CLB (BEN)
043910101104  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN WS-CURYTDSTRDTE
043920101104  ¦           COMPUTE WS-BEN-AMT-TOT-YTD-CLB (BEN) = WS-TE-AMOUNT  +
043930101104  ¦                   WS-BEN-AMT-TOT-YTD-CLB (BEN)
043940101104  ¦          END-IF
043950101104  ¦        END-IF.
043960101104  |
043970150908  |        IF WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  16
043980150908146193     OR WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  32
043990101104146193     OR WS-CONTR-REDEM-CODE-RULE          IS EQUAL TO  37
044000101104  ¦          COMPUTE WS-BEN-AMT-TOT-LTD-PGRANT (BEN) = WS-TE-AMOUNT  +
044010101104  ¦                  WS-BEN-AMT-TOT-LTD-PGRANT (BEN)
044020101104  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN WS-CURYTDSTRDTE
044030101104  ¦           COMPUTE WS-BEN-AMT-TOT-YTD-PGRANT (BEN) = WS-TE-AMOUNT  +
044040101104  ¦                   WS-BEN-AMT-TOT-YTD-PGRANT (BEN)
044050101104  ¦          END-IF
044060101104  ¦        END-IF.
044070101104  |        IF WS-CONTR-REDEM-CODE-RULE   IS EQUAL TO  25 OR 26
044080101104  ¦          COMPUTE WS-BEN-AMT-TOT-LTD-IQEE (BEN) = WS-TE-AMOUNT  +
044090101104  ¦                  WS-BEN-AMT-TOT-LTD-IQEE (BEN)
044100101104  ¦          IF  TRADE-DATE OF TRANS IS GREATER  THAN WS-CURYTDSTRDTE
044110101104  ¦           COMPUTE WS-BEN-AMT-TOT-YTD-IQEE (BEN) = WS-TE-AMOUNT  +
044120140806  ¦                   WS-BEN-AMT-TOT-YTD-IQEE (BEN)
044130140806133489       END-IF
044140140806  |        END-IF.
044150140806  |        IF WS-CONTR-REDEM-CODE-RULE
044160150908  |           IS EQUAL TO  6 OR 7 OR 17 OR 18 OR 28 OR 30
044170140806146193                       OR 33 OR 38
044180140806  |          COMPUTE WS-BEN-AMT-TOT-LTD-EAP  (BEN) = WS-TE-AMOUNT  +
044190140806  |                  WS-BEN-AMT-TOT-LTD-EAP  (BEN)
044200140806  |          IF  TRADE-DATE OF TRANS IS GREATER  THAN WS-CURYTDSTRDTE
044210140806  |           COMPUTE WS-BEN-AMT-TOT-YTD-EAP  (BEN) = WS-TE-AMOUNT  +
044220140806  |                   WS-BEN-AMT-TOT-YTD-EAP  (BEN)
044230140806  |          END-IF
044240140806  |        END-IF.
044250140806  |        IF WS-CONTR-REDEM-CODE-RULE   IS EQUAL TO  12
044260140806  |          COMPUTE WS-BEN-AMT-TOT-LTD-PSE  (BEN) = WS-TE-AMOUNT  +
044270140806  |                  WS-BEN-AMT-TOT-LTD-PSE  (BEN)
044280140806  |          IF  TRADE-DATE OF TRANS IS GREATER  THAN WS-CURYTDSTRDTE
044290140806  V           COMPUTE WS-BEN-AMT-TOT-YTD-PSE  (BEN) = WS-TE-AMOUNT  +
044300101104133489                WS-BEN-AMT-TOT-YTD-PSE  (BEN)
044310101104  V          END-IF
044320160201R83788     END-IF.
044330160201148326     IF WS-CONTR-REDEM-CODE-RULE IS EQUAL TO  6
044340160201148326        COMPUTE WS-BEN-AMT-TOT-LTD-CEAP  (BEN) = WS-TE-AMOUNT  +
044350030430148326                WS-BEN-AMT-TOT-LTD-CEAP  (BEN).
044360030429  ¦        IF WS-RESP-84                IS NOT EQUAL TO "Y"
044370030429  ¦           GO TO GRBI-READ
044380030429  ¦        END-IF
044390030429  ¦        EVALUATE  WS-RESP-BENEFICIARY-SEQ
044400030429  ¦          WHEN 1
044410030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY1 TO TE-ACCOUNT-BENEFICIARY1
044420030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT1
044430030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN1
044440030429  ¦            MOVE BENEFICIARY-PERCENT OF
044450030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT1
044460030429  ¦          WHEN 2
044470030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY2 TO TE-ACCOUNT-BENEFICIARY2
044480030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT2
044490030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN2
044500030429  ¦            MOVE BENEFICIARY-PERCENT OF
044510030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT2
044520030429  ¦          WHEN 3
044530030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY3 TO TE-ACCOUNT-BENEFICIARY3
044540030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT3
044550030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN3
044560030429  ¦            MOVE BENEFICIARY-PERCENT OF
044570030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT3
044580030429  ¦          WHEN 4
044590030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY4 TO TE-ACCOUNT-BENEFICIARY4
044600030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT4
044610030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN4
044620030429  ¦            MOVE BENEFICIARY-PERCENT OF
044630030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT4
044640030429  ¦          WHEN 5
044650030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY5 TO TE-ACCOUNT-BENEFICIARY5
044660030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT5
044670030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN5
044680030429  ¦            MOVE BENEFICIARY-PERCENT OF
044690030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT5
044700030429  ¦          WHEN 6
044710030429  ¦            MOVE RE-ACCOUNT-BENEFICIARY6 TO TE-ACCOUNT-BENEFICIARY6
044720030429  ¦            MOVE WS-TE-AMOUNT            TO TE-AMOUNT6
044730030429  ¦            MOVE AT-GROSS-SIGN           TO TE-AMOUNT-SIGN6
044740030429  ¦            MOVE BENEFICIARY-PERCENT OF
044750030429  ¦                 ACCOUNT-BENEFICIARY-SPLIT-REC  TO TE-PERCENT6
044760030429  ¦        END-EVALUATE.
044770030429  ¦        GO TO GRBI-READ.
044780030429  ¦   **********
044790030429  ¦    GRBI-EXIT.
044800030429  ¦         EXIT.
044810011102R17199**********
044820011102R10605 FORMAT-ACC-DLR-REP-NAME.
044830011102      *------------------------------------------------*
044840011102      *  GET AND FORMAT REP NAME                       *
044850011102      *------------------------------------------------*
044860011120           MOVE SPACES                 TO  WS-REP-NAME-ACC.
044870031006           MOVE SPACES                 TO  WS-REP-NAME-ACC-TEMP.
044880011102R18368     INITIALIZE MFADEAREP OF DEALER-REP-REC.
044890011102           MOVE WS-ACCOUNT-DLRCDE      TO  DEALER-CODE
044900011102                                           OF DEALER-REP-REC.
044910011102           MOVE WS-ACCOUNT-DLRREPCDE   TO  DEALER-REP-CODE
044920011102                                           OF DEALER-REP-REC.
044930011102           READ DEALER-REP
044940011102                INVALID KEY
044950090309                GO TO FADRN-EXIT.
04496009030966105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
04497009030966105      Set pb-adrName to True.
04498009030966105      Move SALUTATION-CODE OF DEALER-REP-REC  to pc-InSalutation.
04499009030966105      Move FIRST-NAME      OF DEALER-REP-REC  to pc-InFirstName.
04500009030966105      Move INITIALS        OF DEALER-REP-REC  to pc-InInitial.
04501009030966105      Move LAST-NAME       OF DEALER-REP-REC  to pc-InLastName.
04502009030966105      Call "FXSTRTADR" using pt-StreetAddressAction,
04503009030966105                             pt-StreetAddressIn,
04504009030566105                             pt-StreetAddressOut.
04505009050666105
04506001112066105      Move pc-OutName(1:40) To WS-REP-NAME-ACC.
045070011102R12105     MOVE WS-REP-NAME-ACC    TO  WS-REP-NAME-ACC-TEMP.
045080011102      **********
045090011102       FADRN-EXIT.
045100011102             EXIT.
045110011102R10605**********
045120011102R10605 GET-DLR-REP-NAME-FOR-TXN.
045130011102      *------------------------------------------------*
045140011102      *  GET AND FORMAT REP NAME                       *
045150011102      *------------------------------------------------*
045160011120           MOVE SPACES                 TO  WS-REP-NAME-TXN.
045170031006           MOVE SPACES                 TO  WS-REP-NAME-TXN-TEMP.
045180011102R18368     INITIALIZE MFADEAREP OF DEALER-REP-TXN-REC.
045190031006           MOVE WS-TRANS-DLRCDE        TO  DEALER-CODE
045200011102R18368                                     OF DEALER-REP-TXN-REC.
045210031006           MOVE WS-TRANS-DLRREPCDE     TO  DEALER-REP-CODE
045220031006R18368                                     OF DEALER-REP-TXN-REC.
045230011102R18368     READ DEALER-REP-TXN
045240011210                INVALID KEY
045250090309r12351          GO TO GDRNT-EXIT.
04526009030966105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
04527009030966105      Set pb-adrName to True.
04528009030966105      Move SALUTATION-CODE OF DEALER-REP-TXN-REC to pc-InSalutation
04529009030966105      Move FIRST-NAME      OF DEALER-REP-TXN-REC to pc-InFirstName
04530009030966105      Move INITIALS        OF DEALER-REP-TXN-REC to pc-InInitial
04531009030966105      Move LAST-NAME       OF DEALER-REP-TXN-REC to pc-InLastName
04532009030966105      Call "FXSTRTADR" using pt-StreetAddressAction,
04533009030966105                             pt-StreetAddressIn,
04534009030566105                             pt-StreetAddressOut.
04535009050666105
04536009030566105      Move pc-OutName(1:40) To WS-REP-NAME-TXN.
04537009030566105 *    IF  SALUTATION-CODE
04538009030566105 *        OF DEALER-REP-TXN-REC
04539009030566105 *                   IS NOT EQUAL TO  SPACES
04540009030566105 *        STRING SALUTATION-CODE
04541009030566105 *               OF DEALER-REP-TXN-REC
04542009030566105 *                      DELIMITED BY  "  "
04543009030566105 *                              INTO  WS-REP-NAME-TXN.
04544009030566105 *
04545009030566105 *    IF  WS-REP-NAME-TXN IS EQUAL TO  SPACES
04546009030566105 *        STRING FIRST-NAME
04547009030566105 *               OF DEALER-REP-TXN-REC
04548009030566105 *                      DELIMITED BY  "  "
04549009030566105 *                              INTO  WS-REP-NAME-TXN
04550009030566105 *    ELSE
04551009030566105 *        STRING WS-REP-NAME-TXN
04552009030566105 *                      DELIMITED BY  "  "
04553009030566105 *               " "    DELIMITED BY  SIZE
04554009030566105 *               FIRST-NAME
04555009030566105 *               OF DEALER-REP-TXN-REC
04556009030566105 *                      DELIMITED BY  "  "
04557009030566105 *                              INTO  WS-REP-NAME-TXN-TEMP
04558009030566105 *        MOVE WS-REP-NAME-TXN-TEMP TO  WS-REP-NAME-TXN.
04559009030566105 *
04560009030566105 *    IF  WS-REP-NAME-TXN IS EQUAL TO  SPACES
04561009030566105 *        STRING INITIALS
04562009030566105 *               OF DEALER-REP-TXN-REC
04563009030566105 *                      DELIMITED BY  "  "
04564009030566105 *                              INTO  WS-REP-NAME-TXN
04565009030566105 *    ELSE
04566009030566105 *        STRING WS-REP-NAME-TXN
04567009030566105 *                      DELIMITED BY  "  "
04568009030566105 *               " "    DELIMITED BY  SIZE
04569009030566105 *               INITIALS
04570009030566105 *               OF DEALER-REP-TXN-REC
04571009030566105 *                      DELIMITED BY  "  "
04572009030566105 *                              INTO  WS-REP-NAME-TXN-TEMP
04573009030566105 *        MOVE WS-REP-NAME-TXN-TEMP TO  WS-REP-NAME-TXN.
04574009030566105 *
04575009030566105 *    IF  WS-REP-NAME-TXN IS EQUAL TO  SPACES
04576009030566105 *        STRING LAST-NAME
04577009030566105 *               OF DEALER-REP-TXN-REC
04578009030566105 *                      DELIMITED BY  "  "
04579009030566105 *                              INTO  WS-REP-NAME-TXN
04580009030566105 *    ELSE
04581009030566105 *        STRING WS-REP-NAME-TXN
04582009030566105 *                      DELIMITED BY  "  "
04583009030566105 *               " "    DELIMITED BY  SIZE
04584009030566105 *               LAST-NAME
04585009030566105 *               OF DEALER-REP-TXN-REC
04586009030566105 *                      DELIMITED BY  "  "
04587009030566105 *                              INTO  WS-REP-NAME-TXN-TEMP
04588001110266105 *               MOVE WS-REP-NAME-TXN-TEMP TO  WS-REP-NAME-TXN.
045890011102           MOVE WS-REP-NAME-TXN    TO  AT-REP-NAME.
045900011102      **********
045910011102       GDRNT-EXIT.
045920011102             EXIT.
045930000000R10605**********
045940000000      /
045941210914      *RFS186199 Starts*
045942210914       LOAD-FUND-LONG-DESC-ARRAY.
045943210914           EXEC SQL
045944210914             DECLARE FNDLDESC CURSOR FOR
045945210914             SELECT INVP.INVESTMENT_CODE,
045946210914                    CHAR(COALESCE(MAPTXTPE.TARGET_VALUE, " " ),80),
045947210914                    CHAR(COALESCE(MAPTXTPF.TARGET_VALUE, " " ),80)
045948210914             FROM MFAINVP INVP
045949210914             LEFT OUTER JOIN MFAMAPTXTP MAPTXTPE on
045950210914             MAPTXTPE.MAPPING_CODE = "FUND-DESC" AND
045951210914             MAPTXTPE.MAPPING_SUB_CODE = "FUND-LNAME" AND
045952210914             MAPTXTPE.SOURCE_VALUE = INVP.INVESTMENT_CODE AND
045953210914             MAPTXTPE.LANGUAGE_CODE = "E"
045954210914             LEFT OUTER JOIN MFAMAPTXTP MAPTXTPF on
045955210914             MAPTXTPF.MAPPING_CODE = "FUND-DESC" AND
045956210914             MAPTXTPF.MAPPING_SUB_CODE = "FUND-LNAME" AND
045957210914             MAPTXTPF.SOURCE_VALUE = INVP.INVESTMENT_CODE AND
045958210914             MAPTXTPF.LANGUAGE_CODE = "F"
045959210914           END-EXEC.
045960210914
045961210914           MOVE "OPEN FNDLDESC CURSOR" TO WS-SQLERR-STATEMENT.
045962210914           EXEC SQL
045963210914                OPEN FNDLDESC
045964210914           END-EXEC.
045965210914
045966210914           MOVE "READ FNDLDESC CUSROR" TO WS-SQLERR-STATEMENT.
045967210914      ** FETCH CURSOR FNDLDESC until EOF or End of Array **
045968210914           MOVE "N"            TO lc-FNDLDESC-EOF.
045969210914           MOVE 1              TO  ln-FNDLDESC-Array-size.
045970210914           SET FNDLDESC-IDX    TO 1.
045971210914
045972210914           PERFORM VARYING FNDLDESC-CNT FROM 1 BY 1
045973210914            UNTIL FNDLDESC-CNT > FNDLDESC-MAX OR lc-FNDLDESC-EOF = 'Y'
045974210914
045975210914           INITIALIZE WS-FNDLDESC-ENGLISH(FNDLDESC-IDX),
045976210914                      WS-FNDLDESC-FRENCH(FNDLDESC-IDX),
045977210914                      WS-FNDLDESC-INVESTMENT-CODE(FNDLDESC-IDX),
045978210914                      lc-FNDLDESC-INVESTMENT-CODE,
045979210914                      lc-FNDLDESC-ENGLISH,
045980210914                      lc-FNDLDESC-FRENCH
045981210914
045982210914           EXEC SQL
045983210914                FETCH NEXT
045984210914                FROM FNDLDESC
045985210914                INTO :lc-FNDLDESC-INVESTMENT-CODE,
045986210914                     :lc-FNDLDESC-ENGLISH,
045987210914                     :lc-FNDLDESC-FRENCH
045988210914           END-EXEC
045989210914
045990210914           IF SQLCODE = 0
045991210914              MOVE lc-FNDLDESC-ENGLISH
045992210914                    TO WS-FNDLDESC-ENGLISH(FNDLDESC-IDX)
045993210914              MOVE lc-FNDLDESC-FRENCH
045994210914                    TO WS-FNDLDESC-FRENCH(FNDLDESC-IDX)
045995210914              MOVE lc-FNDLDESC-INVESTMENT-CODE
045996210914                    TO WS-FNDLDESC-INVESTMENT-CODE(FNDLDESC-IDX)
045997210914              SET  FNDLDESC-IDX UP BY  1
045998210914              ADD  1    TO ln-FNDLDESC-Array-Size
045999210914           ELSE
046000210914              MOVE 'Y' TO lc-FNDLDESC-EOF
046001210914              INITIALIZE WS-FNDLDESC-DTL(FNDLDESC-IDX)
046002210914              MOVE HIGH-VALUE
046003210914                    TO WS-FNDLDESC-INVESTMENT-CODE(FNDLDESC-IDX)
046004210914              SET FNDLDESC-IDX DOWN BY 1
046005210914           END-IF
046006210914           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
046007210914                GO TO SQLLOG
046008210914           END-IF
046009210914           END-PERFORM.
046010210914
046011210914           MOVE "CLOSE FNDLDESC CURSOR" TO WS-SQLERR-STATEMENT.
046012210914           EXEC SQL
046013210914                CLOSE FNDLDESC
046014210914           END-EXEC.
046015210914
046016210914       LFLD-EXIT.
046017210914             EXIT.
046018210914      *RFS186199 Ends*
046019000000       FORMAT-TXN-OUTPUT-RECORD.
046020000000      ******************************************************************
046021000000      *                                                                *
046022000000      *    F O R M A T   T R A N S A C T I O N   R E C O R D   R T N . *
046023000000      *                                                                *
046024000000      ******************************************************************
046025991005           INITIALIZE ACCOUNT-TXN-SECTION.
046026991005           MOVE IVIVRNO                TO  AT-INVESTOR-NO.
046030991005           MOVE ACACTNO                TO  AT-ACCOUNT.
046040161101           MOVE 80                     TO  AT-SECTION-NO.
046050010607156507     IF WS-STM79-FLAG NOT = "Y"
046060010607R10404     IF WS-PT-RULE (PT)          IS  EQUAL TO  "7"
046070010607              ADD 1                    TO  WS-TRANSACTION-COUNT-DII
046080010607              MOVE WS-TRANSACTION-COUNT-DII TO  AT-SECTION-SEQUENCE
046090010607           ELSE
046100010607              ADD 1                         TO  WS-TRANSACTION-COUNT
046110010607              MOVE WS-TRANSACTION-COUNT     TO  AT-SECTION-SEQUENCE
046120161026           END-IF.
046130161026156507     IF WS-STM79-FLAG = "Y"
046140161026156507           MOVE 79                    TO  AT-SECTION-NO
046150161026156507           ADD 1                      TO  WS-TRANS79-COUNT
046160161026156507           MOVE WS-TRANS79-COUNT      TO  AT-SECTION-SEQUENCE
046170140417156507     END-IF.
046180140417      *RFS129378 - Start
046190140417           IF WS-PT-RULE (PT)          IS EQUAL TO "2"
046200140417              PERFORM POPULATE-GIC-INTRATE-MATDATE THRU GICIM-EXIT
046210140417           END-IF.
046220020103      *RFS129378 - End
046230020103r12482     IF WS-LDA-STMT-CNFM-FLAG   IS EQUAL TO  "C"
046240020103           AND ACNOMINEE OF INVESTOR-JOIN  = "Y"
046250020103           AND NOCONFPRT OF INVESTOR-JOIN  = "N"
046260020103              MOVE AD-LANGUAGE            TO  AT-LANGUAGE
046270020103           ELSE
046280020103              MOVE II-LANGUAGE-CODE       TO  AT-LANGUAGE
046290140925r12482     END-IF.
046300070914130038     MOVE SUPPRESS-CONFIRMATION OF TRANS TO AT-OMS-SUPPRESS.
046310070914      * RFS 39466 Begin
046320070914           If lc_SegSysMat = lncc_Yes AND
046330070914              Trans-origin-code of Trans = lncc_MAT
046340070914            Evaluate True
046350070914                WHEN Entered-by of Trans = lncc_EnteredByCMT OR
046360070914                     Entered-by of Trans = lncc_EnteredByCMTPre
046370070914                     Move 'C' to  AT-MATURITY-TYPE
046380070914                WHEN Entered-by of Trans = lncc_EnteredByDMT OR
046390070914                     Entered-by of Trans = lncc_EnteredByDMTPre
046400070914                     Move 'D' to  AT-MATURITY-TYPE
046410070914                WHEN OTHER
046420070914                     Move Space to AT-MATURITY-TYPE
046430070914            End-Evaluate
046440070914            Move Spaces to lc-ContractXref
046450070914            Move Placement-Date of Trans-Rec to WS-PLACEMENT-DATE
046460070914            Move Trans-No   of Trans-Rec     to WS-TRANS-NO
046470070914            Move Account-No of Trans-Rec     to WS-ACCOUNT-NO
046480070914            EXEC SQL
046490070914            SELECT CONTRACT_XREF, CONTRACT_NO
046500070914             INTO :lc-ContractXref, :ln-ContractNo
046510070914             FROM MFAACCONP
046520070914             WHERE ACCOUNT_NO  = :WS-ACCOUNT-NO AND
046530070914                   CONTRACT_NO =
046540070914                    (SELECT COALESCE(MIN(CONTRACT_NO),0) FROM MFATRCODP
046550070914                       WHERE PLACEMENT_DATE = :WS-PLACEMENT-DATE AND
046560070914                             TRANS_NO = :WS-TRANS-NO)
046570070914             END-EXEC
046580070914              Move ln-ContractNo    to AT-CONTRACT-NO
046590070914              If lc-ContractXref  is not = Spaces
046600070914                Move lc-ContractXref  to AT-CONTRACT-XREF
046610070914              End-If
046620070914           End-If.
046630080425      * RFS 39466 End
046640080425      * RFS47406 Start
046650080425           IF lc_SegGLWBYes
046660080425              MOVE Investment-Code OF TRANS TO lc_InvestmentCode
046670101018              MOVE SPACE                    TO lc_InvSeries
046680101018 84572        MOVE 0                        TO lc_dfltage
046690080425 84572        MOVE SPACES                   TO lc_seriestype
046700080425              EXEC SQL
046710080425                SELECT INVESTMENT_SERIES
046720080425                  INTO :lc_InvSeries
046730080425                  FROM MFAINVSGP
046740080425                 WHERE INVESTMENT_CODE = :lc_InvestmentCode
046750080425              END-EXEC
046760101018              IF lc_InvSeries NOT = SPACE
046770101018      * RFS84572 Start
046780101018              EXEC SQL
046790101018                 SELECT DEC(SUBSTR( SERIES_RULES,11,3)),
046800101018                       Coalesce(SUBSTR(Series_Rules, 70, 4), " ")
046810101018                       INTO :lc_dfltage,  :lc_seriestype
046820101018                       FROM MFASERRLP
046830101018                       WHERE INVESTMENT_SERIES  = :lc_InvSeries
046840101018               END-EXEC
046850101018                IF lc_seriestype = "GLWB" AND lc_dfltage > 0
046860101018                  PERFORM SetGLWBTrans
046870101018                END-IF
046880080425      * RFS84572 end
046890080425              END-IF
046900080425           END-IF.
046910991005      * RFS47406 End
046920991005           MOVE ACDEALER               TO  AT-DEALER.
046930991005           MOVE ACDEALREP              TO  AT-SALESREP.
046940970710           MOVE WS-ACCOUNT-TYPE        TO  AT-ACCOUNT-TYPE.
046950970710           IF  ACNOMINEE      IS EQUAL TO  "Y"
046960991005               MOVE ANSPOUSAL          TO  AT-SPOUSAL
046970991005           ELSE
046980991005               MOVE ACSPOUSAL          TO  AT-SPOUSAL
046990991005           END-IF
047000991005           MOVE ACLOCKIN               TO  AT-LOCKED-IN.
047010991005           MOVE ACNOMINEE              TO  AT-NOMINEE.
047020991005           MOVE ACGROUP                TO  AT-GROUP.
047030991005           IF  WS-SPOUSE-FOUND         IS NOT EQUAL TO  "Y"
047040991005           OR  AT-SPOUSAL              IS NOT EQUAL TO  "Y"
047050991005               GO TO FTR-0000-0000-0020
047060090309           END-IF
04707009030966105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
04708009030966105      Set pb-adrLastNameFirst to True.
04709009030966105      Move FIRST-NAME      OF INVESTOR-SPOUSE  to pc-InFirstName
04710009030966105      Move INITIALS        OF INVESTOR-SPOUSE  to pc-InInitial
04711009030966105      Move LAST-NAME       OF INVESTOR-SPOUSE  to pc-InLastName
04712009030966105      Move ","                                 to pc-InComma
04713009030966105      Call "FXSTRTADR" using pt-StreetAddressAction,
04714009030966105                             pt-StreetAddressIn,
04715009030566105                             pt-StreetAddressOut.
04716009050666105
04717009030566105      Move pc-OutName(1:40) To AT-SPOUSAL-CONTRIB.
04718099100566105 *    MOVE SPACES                 TO  WS-ADRTMP.
047190090305
04720009030566105 *    IF FIRST-NAME OF INVESTOR-SPOUSE    IS EQUAL TO  SPACES
04721009030566105 *       STRING INITIALS OF INVESTOR-SPOUSE
04722009030566105 *                      DELIMITED BY  SIZE
04723009030566105 *                              INTO  WS-ADRTMP
04724009030566105 *    ELSE
04725009030566105 *       STRING FIRST-NAME OF INVESTOR-SPOUSE
04726009030566105 *                      DELIMITED BY  "  ",
04727009030566105 *               " "    DELIMITED BY  SIZE,
04728009030566105 *               INITIALS OF INVESTOR-SPOUSE
04729009030566105 *                      DELIMITED BY  SIZE
04730009030566105 *                              INTO  WS-ADRTMP
04731009030566105 *    END-IF
04732009030566105 *    IF  LAST-NAME OF INVESTOR-SPOUSE    IS NOT EQUAL TO  SPACES
04733009030566105 *    AND WS-ADRTMP                       IS NOT EQUAL TO  SPACES
04734009030566105 *        STRING LAST-NAME OF INVESTOR-SPOUSE
04735009030566105 *                      DELIMITED BY  "  ",
04736009030566105 *               ", "   DELIMITED BY  SIZE
04737009030566105 *               WS-ADRTMP
04738009030566105 *                      DELIMITED BY  "  "
04739009030566105 *                              INTO  AT-SPOUSAL-CONTRIB
04740009030566105 *        GO TO FTR-0000-0000-0010
04741009030566105 *    END-IF
04742009030566105 *    IF  LAST-NAME OF INVESTOR-SPOUSE   IS NOT EQUAL TO  SPACES
04743009030566105 *        STRING LAST-NAME
04744009030566105 *               OF INVESTOR-SPOUSE
04745009030566105 *                      DELIMITED BY  "  "
04746009030566105 *                              INTO  AT-SPOUSAL-CONTRIB
04747009030566105 *    ELSE
04748009030566105 *        STRING WS-ADRTMP
04749009030566105 *                      DELIMITED BY  "  "
04750009030566105 *                              INTO  AT-SPOUSAL-CONTRIB
04751097020566105 *    END-IF.
047520991005       FTR-0000-0000-0010.
047530970205
047540970205           MOVE SOCIAL-INSURANCE-NO
047550000000                OF INVESTOR-SPOUSE     TO  AT-SPOUSAL-SIN.
047560970205
047570991005       FTR-0000-0000-0020.
047580971024
047590000000           STRING WS-LDA-MGMT-COM-CDE
047600970428                             DELIMITED BY  SIZE
047610000000                  WS-IC-FUND (IC)
047620000000                             DELIMITED BY  " "
047630031007                                     INTO  AT-FUND-NO.
047640031007R18485     IF WS-IC-NAME-FLAG = "F"
047650031007   |          MOVE WS-IC-NAME-F(IC)  TO  AT-INVESTMENT-NAME
047660031007   |       ELSE
047670031007   V          MOVE WS-IC-NAME-E(IC)  TO  AT-INVESTMENT-NAME
047680000000R18485     END-IF.
047690040526
047700040526R18194     MOVE WS-CC-CODE (CC)        TO  AT-CURRENCY.
047710040526   ¦       IF AT-CURRENCY         IS EQUAL TO SPACES
047720060621   ¦          MOVE "***"               TO  AT-CURRENCY
047730200609R18194     END-IF.
047740200609
047750200715      * RFS185916 - Begins
047760200715      * RFS1102439 - Begins
047770200715      *    MOVE WS-IC-PROD(CC)            TO  AT-PROD-TYPE-CODE.
047780200715           MOVE WS-IC-PROD(IC)            TO  AT-PROD-TYPE-CODE.
047790200715      * RFS1102439 - Ends
047800060621      * RFS185916 - Ends
047810970121
047820991005       FTR-0000-0010.
047830971024
047840991005           MOVE WS-LDA-STRDTE          TO  AT-OPEN-DATE.
047850991005           MOVE TRANS-TYPE-CODE OF TRANS-REC
047860970428                                       TO  AT-TRANS-TYPE-CODE.
047870970428
047880970428           IF  WS-TT-LST NOT GREATER THAN  ZEROES
047890970428               GO TO FTR-0000-0030.
047900970428
047910970428           SET TT                      TO  1.
047920970513
047930991005       FTR-0000-0020.
047940970428
047950970428           IF  TRANS-TYPE-CODE
047960970428               OF TRANS-REC   IS EQUAL TO  WS-TT-CODE (TT)
047970970428           AND TRANS-STATUS-CODE
047980020717               OF TRANS-REC   IS EQUAL TO  WS-TT-STAT (TT)
047990020717R12865     AND TRANS-ORIGIN-CODE
048000970513               OF TRANS-REC   IS EQUAL TO  WS-TT-ORIGIN-CODE (TT)
048010970428           AND AT-LANGUAGE    IS EQUAL TO  WS-TT-LANG (TT)
048020991005               MOVE WS-TT-DESC (TT)    TO  AT-TRANS-TYPE
048030991005               GO TO FTR-0000-0040
048040020717           END-IF
048050970428
048060970428           IF  TT            IS LESS THAN  WS-TT-LST
048070991005               SET TT               UP BY  1
048080991005               GO TO FTR-0000-0020
048090020717           END-IF.
048100020717
048110020717R12865     SET TT                      TO  1.
048120020717  ¦
048130020717  ¦    FTR-0000-0020-A.
048140020717  ¦
048150020717  ¦        IF  TRANS-TYPE-CODE
048160020717  ¦            OF TRANS-REC   IS EQUAL TO  WS-TT-CODE (TT)
048170020717  ¦        AND TRANS-STATUS-CODE
048180020717  ¦            OF TRANS-REC   IS EQUAL TO  WS-TT-STAT (TT)
048190020717  ¦        AND WS-ORIGIN-CODE
048200020717  ¦                           IS EQUAL TO  WS-TT-ORIGIN-CODE (TT)
048210020717  ¦        AND AT-LANGUAGE    IS EQUAL TO  WS-TT-LANG (TT)
048220020717  ¦            MOVE WS-TT-DESC (TT)    TO  AT-TRANS-TYPE
048230020717  ¦            GO TO FTR-0000-0040
048240020717  ¦        END-IF
048250020717  ¦
048260020717  ¦        IF  TT            IS LESS THAN  WS-TT-LST
048270020717  ¦            SET TT               UP BY  1
048280020717  ¦            GO TO FTR-0000-0020-A
048290020717R12865     END-IF.
048300970428
048310970428
048320991005       FTR-0000-0030.
048330970428
048340970428           MOVE ALL "*"                TO  AT-TRANS-TYPE.
048350970428
048360991005       FTR-0000-0040.
048370020731
048380020731           MOVE WS-CURR-UNIT-BAL       TO AT-UNIT-BALANCE
048390991005                                          AD-NO-OF-UNITS-EX.
048400161104           MOVE UNIT-AMT OF TRANS      TO AT-NO-OF-UNITS.
048410031113156507     IF WS-STM79-FLAG NOT = "Y"
048420031113R19311     IF (HISTORY AND REDEMPTION-TRANSACTION) OR
048430031113  ¦           (REVERSAL AND PURCHASE-TRANSACTION)
048440031113  ¦          SUBTRACT UNIT-AMT OF TRANS FROM WS-NO-OF-UNITS-CURR
048450031113  ¦        ELSE
048460060621  ¦          ADD  UNIT-AMT OF TRANS      TO WS-NO-OF-UNITS-CURR
048470000000R19311     END-IF.
048480061005
048490061003      * RFS35540 - Starts
048500061003      **   IF (HISTORY AND REDEMPTION-TRANSACTION) OR
048510061003      **      (REVERSAL AND PURCHASE-TRANSACTION)
048520061003           IF (UNIT-AMT OF TRANS  NOT = 0)  AND
048530061003             ((HISTORY AND REDEMPTION-TRANSACTION) OR
048540061005              (REVERSAL AND PURCHASE-TRANSACTION))
048550000000      * RFS35540 - Ends
048560061003             MOVE "-"       TO AT-NO-OF-UNITS-SIGN
048570061003R35540     ELSE
048580000000R35540       MOVE " "       TO AT-NO-OF-UNITS-SIGN
048590000000           END-IF.
048600000000
048610000000           MOVE UNIT-PRICE OF TRANS TO AT-UNIT-PRICE.
048620000000
048630000000      *------------------------------------------------*
048640000000      *  DATES                                         *
048650000000      *                                                *
048660000000      *------------------------------------------------*
048670000000           MOVE TRADE-DATE OF TRANS
048680000000                             TO AT-TRADE-DATE.
048690000000           MOVE PROCESS-DATE OF TRANS
048700000000                             TO AT-PROCESS-DATE.
048710000000
048720000000
048730000000      *------------------------------------------------*
048740000000      *  GROSS AMOUNT                                  *
048750000000      *                                                *
048760000000      *------------------------------------------------*
048770000000           MOVE GROSS-AMT OF TRANS
048780000000                             TO AT-GROSS.
048790061005
048800061003      * RFS35540 - Starts
048810061003      **   IF (HISTORY AND REDEMPTION-TRANSACTION) OR
048820061003      **      (REVERSAL AND PURCHASE-TRANSACTION)
048830061003           IF (GROSS-AMT OF TRANS  NOT = 0)  AND
048840061003             ((HISTORY AND REDEMPTION-TRANSACTION) OR
048850061005              (REVERSAL AND PURCHASE-TRANSACTION))
048860000000      * RFS35540 - Ends
048870061003             MOVE "-"       TO AT-GROSS-SIGN
048880061003R35540     ELSE
048890000000R35540       MOVE " "       TO AT-GROSS-SIGN
048900000000           END-IF.
048910000000
048920000000      *------------------------------------------------*
048930000000      *  NET AMOUNT                                    *
048940000000      *                                                *
048950000000      *------------------------------------------------*
048960000000           MOVE NET-AMT   OF TRANS
048970161104                             TO AT-NET.
048980031113156507     IF WS-STM79-FLAG NOT = "Y"
048990031113R19311     IF (HISTORY AND REDEMPTION-TRANSACTION) OR
049000031113  ¦           (REVERSAL AND PURCHASE-TRANSACTION)
049010031113  ¦          SUBTRACT NET-AMT OF TRANS  FROM WS-NET-AMOUNT-CURR
049020031113  ¦        ELSE
049030060621  ¦          ADD NET-AMT OF TRANS  TO WS-NET-AMOUNT-CURR
049040000000R19311     END-IF.
049050061005
049060061003      * RFS35540 - Starts
049070061003      **   IF (HISTORY AND REDEMPTION-TRANSACTION) OR
049080061003      **      (REVERSAL AND PURCHASE-TRANSACTION)
049090061003           IF (NET-AMT OF TRANS  NOT = 0)  AND
049100061003             ((HISTORY AND REDEMPTION-TRANSACTION) OR
049110061005              (REVERSAL AND PURCHASE-TRANSACTION))
049120000000      * RFS35540 - Ends
049130061003             MOVE "-"       TO AT-NET-SIGN
049140061003R35540     ELSE
049150000000R35540       MOVE " "       TO AT-NET-SIGN
049160000000           END-IF.
049170000000
049180000000      *------------------------------------------------*
049190000000      *  AVERAGE COST                                  *
049200000000      *                                                *
049210000000      *------------------------------------------------*
049220000000           MOVE WS-LAST-ACB-PRICE TO AT-ACB-PRICE.
049230000000
049240000000      *****
049250000000      *****    Calculate the capital gain/loss if processing a
049260000000      *****    Redemption Transaction which is a taxable event.
049270971223      *****
049280971223
049290000000           MOVE ZEROES                 TO  WS-CPTL-GAIN.
049300000000
049310961231           IF  NOT REDEMPTION-TRANSACTION
049320961231           OR  AVERAGE-UNIT-COST
049330000000               OF TRANS-REC   IS EQUAL TO  ZEROES
049340000000               GO TO FTR-0020.
049350000000
049360000000           MOVE SPACES                 TO  TAXABLE-EVENT-RECD.
049370000000           MOVE ACACTYP                TO  ACCOUNT-TYPE-CODE
049380000000                                           OF TAXABLE-EVENT-RECD.
049390000000           MOVE CONTR-REDEM-CODE
049400000000                OF TRANS-REC           TO  CONTR-REDEM-CODE
049410000000                                           OF TAXABLE-EVENT-RECD.
049420000000           MOVE TRANS-TYPE-CODE
049430000000                OF TRANS-REC           TO  TRANS-TYPE-CODE
049440000000                                           OF TAXABLE-EVENT-RECD.
049450000000           READ TAXABLE-EVENT
049460000000               INVALID KEY
049470000000                   GO TO FTR-0010.
049480961230
049490961230           IF  TAXABLE-EVENT-INDICATOR
049500961230                          IS NOT EQUAL TO  "D"
049510000000               GO TO FTR-0020.
049520000000
049530011106       FTR-0010.
049540011106           COMPUTE WS-CPTL-GAIN ROUNDED =  (UNIT-PRICE
049550011106                                            OF TRANS-REC
049560011106                                        -   AVERAGE-UNIT-COST
049570011106                                            OF TRANS-REC)
049580011106                                        *  UNIT-AMT
049590011106                                           OF TRANS-REC.
049600000000
049610000000           IF  WS-CPTL-GAIN  IS LESS THAN  ZEROES
049620000000               SUBTRACT WS-CPTL-GAIN FROM  ZEROES
049630000000                                   GIVING  AT-CPTL-GAIN
049640030826               MOVE "-"                TO  AT-CPTL-GAIN-SIGN
049650030826           ELSE
049660061003               MOVE WS-CPTL-GAIN       TO  AT-CPTL-GAIN
049670030826R35540         MOVE " "                TO  AT-CPTL-GAIN-SIGN
049680980519           END-IF.
049690980519
049700980519980514     MOVE AT-CPTL-GAIN           TO  AT-CPTL-GAIN-BASE.
049710980519980514     MOVE AT-CPTL-GAIN-SIGN      TO  AT-CPTL-GAIN-BASE-SIGN.
049720000000
049730180926       FTR-0020.
049740180926      * RFS176735 - Starts
049750180926           INITIALIZE ln_lnkIntAmt
049760180926                      ln_lnkNetProceeds
049770180926                      li_LnkPlacementDate
049780180926                      li_LnkTransNo.
049790180926
049800180926           MOVE PLACEMENT-DATE OF TRANS TO  li_LnkPlacementDate.
049810180926           MOVE TRANS-NO OF TRANS       TO  li_LnkTransNo.
049820190114
049830190114      * RFS1008483 - Starts
049840190114           IF REVERSAL
049850190114              EXEC SQL
049860190114                SELECT COALESCE(TRLNKCP.INTEREST_AMT, 0) ,
049870190114                       COALESCE(TRLNKCP.NET_PROCEEDS, 0)
049880190114                 INTO :ln_lnkIntAmt,
049890190114                      :ln_lnkNetProceeds
049900190114                FROM MFATRNTGP TRNTGP
049910190114                LEFT OUTER JOIN MFATRLNKCP TRLNKCP ON
049920190114                TRNTGP.PLACEMENT_DATE = TRLNKCP.PLACEMENT_DATE AND
049930190114                TRNTGP.TRANS_NO       = TRLNKCP.TRANS_NO
049940190114                WHERE TRNTGP.PLACEMENT_DATE_2  = :li_LnkPlacementDate
049950190114                  AND TRNTGP.TRANS_NO_2        = :li_LnkTransNo
049960190114                  AND TRNTGP.RELATIONSHIP_TYPE = "RVS"
049970190114                END-EXEC
049980190114           ELSE
049990180926      * RFS1008483 - Ends
050000181009           EXEC SQL
050010181009             SELECT COALESCE(INTEREST_AMT, 0),
050020180926                    COALESCE(NET_PROCEEDS, 0)
050030180926               INTO :ln_lnkIntAmt,
050040181007                    :ln_lnkNetProceeds
050050180926               FROM MFATRLNKCP
050060180926               WHERE PLACEMENT_DATE = : li_LnkPlacementDate
050070190114                 AND TRANS_NO       = : li_LnkTransNo
050080190114      * RFS1008483 - Starts
050090190114      *    END-EXEC.
050100190114           END-EXEC
050110190114           END-IF.
050120181009      * RFS1008483 - Ends
050130181009
050140181009           IF SQLCODE = 0
050150181009              MOVE ln_lnkIntAmt        TO  AT-INTEREST-AMT
050160181009              MOVE ln_lnkNetProceeds   TO  AT-NET-PROCEEDS
050170181009           ELSE
050180181009              MOVE ZEROS               TO  AT-INTEREST-AMT
050190181009              MOVE ZEROS               TO  AT-NET-PROCEEDS
050200180926           END-IF.
050210970121      * RFS176735 - Ends
050220190924           MOVE ACACTYP                TO  AT-ACCOUNT-TYPE-SHORT.
050230190919      *RFS184715 - Begin:  Added condition and removed period below
050240190924184715     IF lb_STMATL_EditExists
050250190924183449     INITIALIZE Lc-Acct-Type-Code
050260190924183449                Lc-Acct-Type-Code-Lang                            184715
050270190924183449     MOVE ACACTYP                TO Lc-Acct-Type-Code             184715
050280190924183449     PERFORM Get-Acct-Type-Lang
050290190924183449     IF  Lc-Acct-Type-Code-Lang  NOT = SPACES
050300190924183449         Move Lc-Acct-Type-Code-Lang to AT-ACCOUNT-TYPE-SHORT
050310190919183449     END-IF
050320190924184715     END-IF.
050330970530      *RFS184715 - End
050340180201           MOVE AT-UNIT-PRICE          TO  AT-UNIT-PRICE-BASE.
050350180201      ** RFS177079 - Start **
050360180201175147*    INITIALIZE ln_GrossAmount.
050370161104      ** RFS177079 - End   **
050380131021156507     IF WS-STM79-FLAG NOT = "Y"
050390980731125153     MOVE GROSS-AMT OF TRANS-REC to ln_GrossAmount.
050400980731      *****
050410980731      *****    Determine if the net amount should be used for the market
050420980731      *****    value or should it be calculated.
050430980731      *****
050440991005
050450010411           IF WS-LDA-MGMT-COM-CDE        IS NOT EQUAL TO  "AIC"
050460991005RF9964     AND WS-LDA-MGMT-COM-CDE       IS NOT EQUAL TO  "TAI"
050470991005           OR UNIT-AMT OF TRANS-REC  NOT EQUAL TO  CLOSING-UNIT-BAL
050480991005                                                      OF TRANS-REC
050490991005               GO TO FTR-0030
050500991005           END-IF
050510980731
050520980731           IF  NOT CONTRIBS-ONLY
050530991005           AND NOT TRANSFER-IN-ONLY
050540991005               GO TO FTR-0030
050550980731           END-IF
050560101202
05057010120283717      IF BUY-SELL-ADJUSTMENT AND
05058010120283717         NET-AMT OF TRANS-REC = 0
05059010120283717         GO TO FTR-0030
05060002073183717      END-IF
050610980731           MOVE NET-AMT OF TRANS-REC           TO  AT-MKT-VALUE.
050620980731           GO TO FTR-0040.
050630980731
050640991029       FTR-0030.
050650991029
050660161215991029     MOVE ZEROS                      TO  WS-TEMP-TRANS-PRICE
050670161215      *RFS165077 START
050680161215159642*    IF TRANS-TYPE-CODE OF TRANS IS EQUAL TO "INC" OR "CPG"
050690161215  |   *                                                  OR "INT"
050700161215  |   *           AND TRANS-STATUS-CODE OF TRANS-REC  IS EQUAL TO  "RVS"
050710161215  |   *           AND CLOSING-UNIT-BAL OF TRANS-REC  IS ZERO
050720161215  |   *           AND UNIT-AMT OF TRANS-REC IS EQUAL TO ZERO
050730161215  |   *               MOVE ZERO TO AT-MKT-VALUE
050740161215159642*    ELSE
050750991028      *RFS165077 END
050760101202991028     IF AT-NO-OF-UNITS      IS EQUAL TO  AT-UNIT-BALANCE
05077099102883717         AND NET-AMT OF TRANS-REC NOT = 0
050780991029991028        MOVE NET-AMT OF TRANS-REC    TO  AT-MKT-VALUE
050790991028991029        MOVE AT-UNIT-PRICE           TO  WS-TEMP-TRANS-PRICE
050800991028991028     ELSE
050810991028              MULTIPLY AT-UNIT-BALANCE     BY  AT-UNIT-PRICE
050820161215                                       GIVING  AT-MKT-VALUE ROUNDED
050830161215      *RFS165077 START
050840161215159642*    END-IF
050850991028      *RFS165077 END
050860080623991028     END-IF.
050870080623R48660     If Capital-Gain and lc-OriginCode = "DTH"
050880080623R48660        Move 0 to AT-MKT-VALUE
050890991028R48660     End-If.
050900980731
050910991005       FTR-0040.
050920970530
050930970424           MOVE AT-MKT-VALUE           TO  AT-MKT-VALUE-BASE.
050940970424           MOVE WS-ACB-UNITS-TRANSACTED
050950970530                                       TO  AT-ACB-UNITS-TRANSACTED.
050960970424           MOVE 1                      TO  AT-EXCHANGE-RATE.
050970161109
050980161109156507     IF WS-STM79-FLAG NOT = "Y"
050990161109156507     MOVE WS-CURR-UNIT-BAL        TO WS-TEMP-AT-UNIT-BALANCE
051000161109156507     MOVE UNIT-AMT OF TRANS       TO WS-TEMP-AT-NO-OF-UNITS
051010161109156507     MOVE AT-NO-OF-UNITS-SIGN     TO WS-TEMP-AT-NO-OF-UNITS-SIGN
051020161109156507     MOVE AT-NON-TAX-DEDUCTIONS   TO WS-TEMP-AT-NON-TAX-DEDUCTIONS
051030180201156507     MOVE AT-ACB-UNITS-TRANSACTED TO WS-TEMP-AT-ACB-UNITS-TRANS
051040161109177079     MOVE AT-UNIT-PRICE           TO WS-TEMP-AT-UNIT-PRICE
051050970424156507     END-IF.
051060970424      *****
051070970424      *****    Format the adjustment reason, if required.
051080970424      *****
051090991005
051100991005           IF  TRANS-STATUS-CODE OF TRANS-REC  IS NOT EQUAL TO  "RVS"
051110991005           AND REVERSAL-CODE OF TRANS-REC      IS EQUAL TO  SPACES
051120991005           AND ADJUST OF TRANS-REC             IS NOT EQUAL TO  "Y"
051130991005               GO TO FTR-0070
051140991005           END-IF
051150970424
051160991005           IF  WS-RR-LST NOT GREATER THAN  ZEROES
051170991005               GO TO FTR-0070
051180970424           END-IF
051190030611
051200030611R16913     PERFORM GET-REVERSAL-REASON-RTN  THRU GRRR-EXIT.
051210060621  ¦
051220030611R16913     MOVE WS-RR-DESC (RR)    TO  AT-ADJUSTMENT-REASON.
051230970424
051240970424       FTR-0070.
051250970424      *****
051260970424      *****    Format the contribution/redemption decsription.
051270970424      *****
051280970424
051290991005           IF  WS-CR-LST NOT GREATER THAN  ZEROES
051300031007               GO TO FTR-0090
051310970424           END-IF.
051320031007
051330031007R18485     SET CR TO 1.
051340031007 ¦         SEARCH  WS-CTBRED-ENT   VARYING CR
051350031007 |            AT END
051360031007 |            GO TO FTR-0090
051370031007 |            WHEN (WS-CR-CODE (CR) = CONTR-REDEM-CODE OF TRANS-REC)
051380031007 |             AND (WS-CR-LANG (CR) = AT-LANGUAGE)
051390031007 |            MOVE WS-CR-CODE (CR) TO  AT-CONTR-REDEMP-CODE
051400031007 |            MOVE WS-CR-DESC (CR) TO  AT-CONTR-REDEMP-DESCRIPTION
051410060621 |            GO TO FTR-0090
051420970424R18485     END-SEARCH.
051430970424
051440991005       FTR-0090.
051450970424
051460970424           MOVE PAYMENT-TYPE-CODE
051470970424                OF TRANS-REC           TO  AT-PAYMENT-TYPE-CODE.
051480970424
051490030825
051500030825      *****
051510030825      *****    If the transaction type is not a switch or transfer,
051520030825      *****    bypass formatting the OTHER fields.
051530030825      *****
051540160520
051550030825R18147     IF TRANSFER-IN-OUT-ONLY
051560110519               GO TO FTR-0100.
051570110519      *RFS93759 Begin
051580110519           IF (BUY-ONLY OR CAPITAL-GAIN) AND lc-OriginCode = 'MAT'
051590110519              PERFORM GET-AND-PUT-TARGET-INFO THRU GAPTI-EXIT
051600110519           END-IF.
051610160520      *RFS93759 End
051620170531      *RFS159146 - Begin
051630170526      *RFS169000 - Starts
051640170526      *    IF BUY-ONLY OR SEL-ONLY
051650170526           IF BUY-ONLY OR SEL-ONLY OR FEES
051660170526      *RFS169000 - Ends
051670160520           GO TO FTR-0140-0020.
051680170526      *RFS159146 - End
051690170526
051700970424           GO TO FTR-0150.
051710970424
051720970424       FTR-0100.
051730030825
051740030825      *****
051750030825      *****    If no opposite side skip Other side processing.
051760030825      *****
051770030825R18147     IF WS-TARGET-ERROR= "Y"
051780030825  |           GO TO FTR-0150
051790970424R18147     END-IF.
051800030825
051810030825           MOVE ACCOUNT-NO OF TRANS-T-REC TO AT-OTHER-ACCOUNT.
051820970428           SET ICT TO  1.
051830970428
051840030825       FTR-0140-0010.
051850030825           IF  INVESTMENT-CODE OF TRANS-T-REC = WS-IC-CODE (ICT)
051860030825               STRING WS-LDA-MGMT-COM-CDE DELIMITED BY  SIZE
051870030825                      WS-IC-FUND (ICT) DELIMITED BY  " "
051880031007                 INTO AT-OTHER-FUND-NO
051890031007               IF WS-IC-NAME-FLAG = "F"
051900031007                  MOVE WS-IC-NAME-F(ICT) TO AT-OTHER-INVESTMENT-NAME
051910031007               ELSE
051920031007                  MOVE WS-IC-NAME-E(ICT) TO AT-OTHER-INVESTMENT-NAME
051930030825               END-IF
051940030825               GO TO FTR-0140-0020
051950970428           END-IF.
051960030825
051970030825           IF  ICT <  WS-IC-LST
051980030825               SET ICT UP BY  1
051990030825               GO TO FTR-0140-0010
052000970428           END-IF.
052010030825
052020030825           STRING WS-LDA-MGMT-COM-CDE DELIMITED BY  SIZE
052030030825                  "***" DELIMITED BY  SIZE
052040030825                  INTO  AT-OTHER-FUND-NO.
052050970530           MOVE ALL "*" TO  AT-OTHER-INVESTMENT-NAME.
052060970530
052070970530       FTR-0140-0020.
052080970530
052090970530      *****    If the IN/OUT transaction is for a different currency
052100970530      *****    than the offsetting OUT/IN transaction, retrieve the
052110970530      *****    exchange rate to be applied.  Initially read the
052120970530      *****    Transaction Exchange Rate.  If it is not found, use the
052130160630      *****    Exchange Rate Multiple for the non-base currency fund.
052140160630      *RFS160982 - Begin
052150160630      *    IF  WS-IC-CURR (IC)   EQUAL TO  WS-IC-CURR (ICT)
052160160630160510*    AND TRANSFER-IN-OUT-ONLY
052170160630      *        GO TO FTR-0150.
052180970530      *RFS160982 - End
052190970530      *****
052200970530      *****    Use the Transaction Exchange Rate for the non-base
052210970530      *****    currency transaction.
052220970530      *****
052230970530           INITIALIZE MFATREXRP.
052240160614           IF  CC             IS EQUAL TO  WS-CC-BSE
052250970530160510     AND TRANSFER-IN-OUT-ONLY
052260970530               MOVE PLACEMENT-DATE
052270970530                    OF TRANS-T-REC     TO  PLACEMENT-DATE
052280970530                                           OF TRANS-EXCHANGE-RATE-REC
052290970530               MOVE TRANS-NO
052300970530                    OF TRANS-T-REC     TO  TRANS-NO
052310970530                                           OF TRANS-EXCHANGE-RATE-REC
052320970530             ELSE
052330970530               MOVE PLACEMENT-DATE
052340970530                    OF TRANS-REC       TO  PLACEMENT-DATE
052350970530                                           OF TRANS-EXCHANGE-RATE-REC
052360970530               MOVE TRANS-NO
052370970530                    OF TRANS-REC       TO  TRANS-NO
052380970530                                           OF TRANS-EXCHANGE-RATE-REC.
052390970530           READ TRANS-EXCHANGE-RATE
052400970530               INVALID KEY
052410970530                   GO TO FTR-0140-0030.
052420970530           MOVE EXCHANGE-RATE
052430970530                OF TRANS-EXCHANGE-RATE-REC
052440170531                                       TO  AT-EXCHANGE-RATE.
052450170531      *RFS169000 - Starts
052460170531159146*    IF BUY-ONLY OR SEL-ONLY
052470170531           IF BUY-ONLY OR SEL-ONLY OR FEES
052480160527      *RFS169000 - Ends
052490970530159146             GO TO FTR-0150.
052500970530           GO TO FTR-0140-0060.
052510970530       FTR-0140-0030.
052520970530      *****
052530970530      *****    The Transaction Exchange Rate for the non-base currency
052540970530      *****    transaction was not found.  Therefore, read the Exchange
052550970530      *****    Rate Multiple for the non-base currency transaction.  If
052560970530      *****    this record is not found, exchange rate will not be
052570970530      *****    updated.
052580970530      *****
052590970530           SET CCT                     TO  1.
052600970530       FTR-0140-0040.
052610970530           IF  WS-CC-CODE (CCT)  EQUAL TO  WS-IC-CURR (ICT)
052620970530               GO TO FTR-0140-0050.
052630970530
052640970530           IF  CCT           IS LESS THAN  WS-CC-LST
052650970530               SET CCT              UP BY  1
052660970530               GO TO FTR-0140-0040.
052670970530       FTR-0140-0050.
052680970530           INITIALIZE MFAEXRHMP.
052690160614           IF  CC             IS EQUAL TO  WS-CC-BSE
052700970530160510     AND TRANSFER-IN-OUT-ONLY
052710970530               MOVE WS-IC-CURR (ICT)   TO  CURRENCY-DDS
052720970530                                           OF EXCHANGE-RATE-M-REC
052730970530               MOVE TRADE-DATE
052740970530                    OF TRANS-T-REC     TO  TRADE-DATE
052750970530                                           OF EXCHANGE-RATE-M-REC
052760970530               MOVE WS-CC-RTETYP (CCT) TO  EXCHANGE-RATE-TYPE
052770970530                                           OF EXCHANGE-RATE-M-REC
052780970530             ELSE
052790970530               MOVE WS-IC-CURR (IC)    TO  CURRENCY-DDS
052800970530                                           OF EXCHANGE-RATE-M-REC
052810970530               MOVE TRADE-DATE
052820970530                    OF TRANS-REC       TO  TRADE-DATE
052830970530                                           OF EXCHANGE-RATE-M-REC
052840970530               MOVE WS-CC-RTETYP (CC)  TO  EXCHANGE-RATE-TYPE
052850970530                                           OF EXCHANGE-RATE-M-REC.
052860970530           READ EXCHANGE-RATE-M
052870970530               INVALID KEY
052880970530                   GO TO FTR-0150.
052890970530           MOVE EXCHANGE-RATE
052900170531                OF EXCHANGE-RATE-M-REC TO  AT-EXCHANGE-RATE.
052910170531      *RFS169000 - Starts
052920170531159146*    IF BUY-ONLY OR SEL-ONLY
052930170531           IF BUY-ONLY OR SEL-ONLY OR FEES
052940160527      *RFS169000 - Ends
052950970530159146             GO TO FTR-0150.
052960970530       FTR-0140-0060.
052970970530      *****
052980970530      *****    If processing the non-base currency transaction,
052990970530      *****    calculate the base unit price and market value using the
053000970530      *****    retrieved transaction exchange rate.
053010970530      *****
053020970530           IF  CC         IS NOT EQUAL TO  WS-CC-BSE
053030970530               DIVIDE AT-UNIT-PRICE    BY  AT-EXCHANGE-RATE
053040970530                                   GIVING  AT-UNIT-PRICE-BASE ROUNDED
053050980519               DIVIDE AT-MKT-VALUE     BY  AT-EXCHANGE-RATE
053060980519                                   GIVING  AT-MKT-VALUE-BASE ROUNDED
053070980519980514         DIVIDE AT-CPTL-GAIN     BY  AT-EXCHANGE-RATE
053080970424980514                             GIVING  AT-CPTL-GAIN-BASE ROUNDED.
053090970424
053100991005       FTR-0150.
053110971215
053120971215           MOVE TRANS-STATUS-CODE
053130971215                OF TRANS-REC           TO  AT-TRANS-STATUS-CODE.
053140971215           IF  REVERSE
053150971215               OF TRANS-REC   IS EQUAL TO  "Y"
053160971215               MOVE "Y"                TO  AT-REVERSAL-INDICATOR
053170971215             ELSE
053180971215               MOVE "N"                TO  AT-REVERSAL-INDICATOR.
053190971215           MOVE TRANS-ORIGIN-CODE
053200981030                OF TRANS-REC           TO  AT-TRANS-ORIGIN-CODE.
053210101217
053220101217R86495     MOVE PLACEMENT-DATE OF TRANS-REC TO AT-PLACEMENT-DATE.
053230150416R86495     MOVE TRANS-NO       OF TRANS-REC TO AT-TRANS-NO.
053240110610142884     PERFORM PREPARE-SECTION80-NEW-FIELD.
053250210127      *RFS186446 Starts*
053260210127           INITIALIZE li-Purchase-Trans-Count, AT-FIRST-PURCHASE.
053270210127           IF (AT-TRANS-TYPE-CODE = "BUY" OR "SWI" OR "TRI") AND
053280210127              (AT-TRANS-STATUS-CODE = "HST" OR "HSC") AND
053290210127               AT-REVERSAL-INDICATOR NOT = "Y"
053300210127              PERFORM Check-Previous-Purchase
053310210127              IF li-Purchase-Trans-Count = 0
053320210127                  MOVE "Y"                TO   AT-FIRST-PURCHASE
053330210127              ELSE
053340210127                  MOVE "N"                TO   AT-FIRST-PURCHASE
053350210127              END-IF
053360210127           END-IF.
053370210127      *RFS186446 Ends*
053380110610      * RFS92477 Starts
053390110610           Initialize lt-SubTypeArea.
053400110610           MOVE PLACEMENT-DATE  OF TRANS-REC TO li-PlacementDate.
053410110610           MOVE TRANS-NO        OF TRANS-REC TO li-TransNo.
053420120321           MOVE TRANS-TYPE-CODE OF TRANS-REC TO lc-TransType.
05343012032193662      MOVE TRANS-ORIGIN-CODE OF TRANS-REC TO lc-TransOriginCode.
05344011061093662      MOVE CONTR-REDEM-CODE  OF TRANS-REC TO lc-ContribRedeemCode.
053450110610           EXEC SQL
053460110610              SELECT COALESCE(a.Trans_Sub_Type, " "),
053470110610                     COALESCE(b.Trans_Sub_Type_Desc, " ")
053480110610              INTO :lc-TransSubType,
053490110610                   :lc-TransSubTypeDesc
053500110610              FROM Mfatrnmscp a
053510110610              INNER JOIN Mfatrnstap b on
053520110610                   a.Trans_Sub_Type = b.Trans_Sub_Type AND
053530110610                   b.Trans_Type_Code = :lc-TransType
053540110610              WHERE a.Placement_Date = :li-PlacementDate         AND
053550110610                    a.Trans_No = :li-TransNo
053560110610           END-EXEC
053570110610           MOVE lc-TransSubType        TO AT-TRANS-SUB-TYPE.
053580110610           MOVE lc-TransSubTypeDesc    TO AT-TRANS-SUB-TYPE-DESC.
053590101217      * RFS92477 Ends
053600981030
053610981030      ****
053620981030      ****  Format AT-ASSIGNMENT-INDICATOR & AT-ASSIGNED-UNITS.
053630981030      ****  Default is "N" and ZEROES
053640981030      ****
053650981030           MOVE "N"                    TO  AT-ASSIGNMENT-INDICATOR.
053660981030
053670981030           IF TRANS-TYPE-CODE OF TRANS-REC IS EQUAL TO "SEL"
053680981030           AND SPLIT-OPTION-CODE OF TRANS-REC IS EQUAL TO "A"
053690981030           AND TRANS-STATUS-CODE OF TRANS-REC IS NOT EQUAL TO "RVS"
053700981030           AND UNIT-AMT OF TRANS-REC IS NOT EQUAL TO
053710981030               CLOSING-UNIT-BAL OF TRANS-REC
053720981030               MOVE "Y"         TO AT-ASSIGNMENT-INDICATOR
053730981030               MOVE CLOSING-UNIT-BAL OF TRANS-REC
053740981030                                TO AT-ASSIGNED-UNITS.
053750120126
053760120126      *RFS93662 Start
053770120202           IF lb_OMSEXTYes
053780120202              MOVE WS-LDA-MGMT-COM-CDE  TO AT-OMS-CMPCDE
053790120202              MOVE AT-REVERSAL-INDICATOR
053800120314                                        TO AT-OMS-REVERSE
053810120321              MOVE WS-IC-FUND (IC)      TO AT-OMS-FUND-NO
053820120321              IF lc-TransOriginCode = space
053830120321                 MOVE "DIR" to lc-TransOriginCode
053840120321              End-If
053850120202              MOVE lc-TransOriginCode   TO AT-OMS-TRANS-ORIGIN-CODE
053860120126                                           lc_TransOriginOMS
053870120202              MOVE lc-TransType         TO AT-OMS-TRANS-TYPE-CODE
053880120321                                           lc_TransTypeOMS
053890120202              MOVE lc-TransSubType      TO AT-OMS-TRANS-SUB-TYPE
053900120321                                           lc_TransSubTypeOMS
053910120210              MOVE lc-ContribRedeemCode TO lc_ContrRedeemOMS
053920120210              MOVE SPACES               TO AT-OMS-CONTR-REDEEM
053930120126              Move ZEROES               TO li_CountOMS
053940120126              Exec SQL
053950120202                   Select Count(*)
053960120126                     into      :li_CountOMS
053970120202                     From MFATRNADP
053980120202                    where Trans_type_code   = :lc_TransTypeOMS
053990120202                      and Trans_sub_type    = :lc_TransSubTypeOMS
054000120202                      and Trans_origin_code = :lc_TransOriginOMS
054010120126                      and CONTR_REDEM_CODE  = :lc_ContrRedeemOMS
054020120210              End-Exec
054030120321              If li_CountOMS > ZEROES
054040120126                 MOVE lc-ContribRedeemCode TO AT-OMS-CONTR-REDEEM
054050120126              End-If
054060120126           END-IF.
054070060621      *RFS93662 End
054080051003R14153 FTR-0160.
054090051003  ¦
054100051003  ¦   *****
054110051003  ¦   *****    Retrieve the INV-GRP-CATEGORY description.
054120051003  ¦   *****
054130051003  ¦
054140051003  ¦        MOVE ALL "*"                TO WS-INVGC-GRP-DESCR.
054150051003  ¦
054160051003  ¦        IF WS-INVGC-LST NOT GREATER THAN  ZEROES
054170051003  ¦           GO TO FTR-0170
054180051003  ¦        END-IF.
054190051003  ¦
054200051003  ¦        SET INVGC TO 1.
054210051003  ¦        SEARCH WS-INV-GRP-CAT-ENT VARYING INVGC
054220051003  ¦           AT END GO TO FTR-0170
054230051003  ¦           WHEN (WS-INVGC-CATEGORY (INVGC) = WS-IG-CAT (IG))
054240051003  ¦            AND (WS-INVGC-LANGUAGE (INVGC) = AD-LANGUAGE)
054250051003  ¦           MOVE WS-INVGC-DESCR     (INVGC) TO WS-INVGC-GRP-DESCR
054260051003  ¦           GO TO FTR-0170
054270051003  ¦        END-SEARCH.
054280051003  v
054290051003R14153 FTR-0170.
054300990518
054310051003           MOVE WS-IG-CAT (IG)         TO  AT-INVESTMENT-GRP-CATEGORY.
054320991009R14153     MOVE WS-INVGC-GRP-DESCR     TO  AT-INVESTMENT-GRP-CAT-DESC.
054330980129           MOVE AT-SECTION-SEQUENCE    TO  AT-SECTION-SEQUENCE-2.
054340980129           MOVE CURR-START-DATE        TO  AT-START-DATE.
054350161102           MOVE CURR-END-DATE          TO  AT-END-DATE.
054360161102156507     IF WS-STM79-FLAG = "Y"
054370161122156507        INITIALIZE WS-STM79-FLAG
054380161102156507        MOVE ZEROS TO  AT-SECTION-SEQUENCE-2
054390161102156507     END-IF.
054400991005
054410991005      **********
054420000000
054430000000       FTOR-EXIT.
054440991005           EXIT.
054450991005      **********
054460210127      *RFS186446 Starts *
054470210127       CHECK-PREVIOUS-PURCHASE.
054480970121
054490210127           INITIALIZE WS-AT-ACCOUNT-NO, WS-AT-TRADE-DTE.
054500210127           MOVE AT-ACCOUNT        TO WS-AT-ACCOUNT-NO.
054510210127           MOVE AT-TRADE-DATE     TO WS-AT-TRADE-DTE.
054520210127           EXEC SQL
054530210127             SELECT COUNT(*)  INTO :li-Purchase-Trans-Count
054540210127               FROM MFATRNP TRNP
054550210127               INNER JOIN MFAINVP INVP ON
054560210127               TRNP.INVESTMENT_CODE = INVP.INVESTMENT_CODE
054570210127               INNER JOIN MFAPRTCDP PRTCDP ON
054580210127               INVP.PRODUCT_TYPE_CODE = PRTCDP.PRODUCT_TYPE_CODE
054590210127              WHERE TRNP.Account_No = :WS-AT-ACCOUNT-NO  AND
054600210127                    TRNP.Trade_Date < :WS-AT-TRADE-DTE  AND
054610210127                    TRNP.Trans_Type_Code in (:lnc_BUY,
054620210127                                  :lnc_SWI, :lnc_TRI) AND
054630210127                    TRNP.Trans_Status_Code in ("HST", "HSC") AND
054640210127                    TRNP.Reverse <> "Y" AND
054650210127                    PRTCDP.PRODUCT_TYPE_RULE = :CURR-PT-RULE
054660210127           END-EXEC.
054670210127           MOVE SQLSTATE   TO lc_sqlStates
054680210127           IF lncc_sqlSuccessful OR lncc_sqlEnd
054690210127                CONTINUE
054700210127           ELSE
054710210127           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
054720210127                GO TO SQLLOG
054730210127           END-IF.
054740210127      *RFS186446 Ends *
054750210127
054760000000      /
054770970424       COMPUTE-AVG-COST-UNIT-BALANCE.
054780970424
054790970424      ******************************************************************
054800970424      *                                                                *
054810970424      *    C O M P U T E   A V E R A G E   C O S T   U N I T   B A L . *
054820970424      *                                                                *
054830160210      ******************************************************************
054840980624148326     INITIALIZE ln-ACB-UNIT-TRANSACTED
054850980624           IF  CORRECT-AVE-UNIT-COST
054860980624               OF ACCOUNT-INVESTMENT-REC
054870980624                          IS NOT EQUAL TO  "Y"
054880980624               MOVE ZEROES             TO  WS-ACB-UNIT-PRICE-BASE
054890980624               MOVE ZEROES             TO  WS-ACB-UNITS-TRANSACTED
054900980624               MOVE ZEROES             TO  WS-LAST-ACB-PRICE
054910980624               GO TO CACUB-0010.
054920990601           IF  REVERSE
054930980624               OF TRANS-REC   IS EQUAL TO  "Y"
054940980624               GO TO CACUB-0010.
054950980624           MOVE RESULTANT-AVERAGE-UNIT-COST
054960980624                OF TRANS-REC           TO  WS-ACB-UNIT-PRICE-BASE.
054970160215           MOVE AVERAGE-UNIT-COST
054980160210148326          OF TRANS-REC           TO  WS-ACB-UNITS-TRANSACTED
054990030213148326                                     ln-ACB-UNIT-TRANSACTED.
055000030213           MOVE RESULTANT-AVERAGE-UNIT-COST
055010160215                OF TRANS-REC           TO  WS-LAST-ACB-PRICE.
055020160215148326     INITIALIZE  MFATAJUCP
055030160215148326                OF TransAdjustmentUnitCostRec
055040160215148326     MOVE PLACEMENT-DATE
055050160304148326          OF TRANS-REC  TO  PLACEMENT-DATE
055060160215148326                             OF TransAdjustmentUnitCostRec
055070160215148326     MOVE TRANS-NO
055080160304148326         OF TRANS-REC   TO  TRANS-NO
055090160215148326                             OF TransAdjustmentUnitCostRec
055100160215148326     READ TransAdjustmentUnitCost
055110160215148326          INVALID KEY
055120160215148326            GO TO CACUB-0005.
055130160304148326     MOVE Average-Unit-Cost
055140160215148326         OF TransAdjustmentUnitCostRec
055150160215148326                               TO  ln-ACB-UNIT-TRANSACTED.
055160160215148326    CACUB-0005.
055170980627           IF  WS-CC-RTECLS (CC) EQUAL TO  1
055180980624           OR  WS-CC-RTECLS (CC) EQUAL TO  ZEROES
055190980624               GO TO CACUB-0010.
055200980624           INITIALIZE  MFATRNCUP
055210980624                       OF TRANS-CURR-UNIT-COST-REC.
055220980624           MOVE PLACEMENT-DATE
055230980624                OF TRANS-REC           TO  PLACEMENT-DATE
055240980624                                           OF TRANS-CURR-UNIT-COST-REC.
055250980624           MOVE TRANS-NO
055260980624                OF TRANS-REC           TO  TRANS-NO
055270980624                                           OF TRANS-CURR-UNIT-COST-REC.
055280980624           READ TRANS-CURRENCY-UNIT-COST
055290980624               INVALID KEY
055300980624                   GO TO CACUB-0010.
055310980624           MOVE RESULTANT-AVERAGE-UNIT-COST
055320980624                OF TRANS-CURR-UNIT-COST-REC
055330980624                                       TO  WS-ACB-UNIT-PRICE-BASE.
055340990615       CACUB-0010.
055350990615           MULTIPLY WS-ACB-UNIT-PRICE-BASE
055360990615                             BY  CLOSING-UNIT-BAL
055370990615                             OF TRANS-REC
055380190806                             GIVING  WS-BOOK-TOTAL-INV ROUNDED.
055390190806      * RFS1015600 - Begin
055400190806           IF WS-SUM-CNT = 1
055410190806            IF WS-ACCOUNT-NO-SUM =
055420190806               ACCOUNT-NO OF TRANS-REC  AND
055430190806               WS-INVEST-CODE-SUM =
055440190910               INVESTMENT-CODE OF TRANS-REC AND
055450190910               WS-ACB-UNIT-PRICE-BASE =
055460190806               UNIT-PRICE OF TRANS-REC AND
055470190806               WS-NET-AMT-SUM =
055480190806               NET-AMT OF TRANS-REC AND
055490190806               WS-NET-AMT-SUM > 0
055500190806                 MOVE WS-NET-AMT-SUM TO
055510190806                 WS-BOOK-TOTAL-INV
055520190806            END-IF
055530190806           END-IF.
055540990302      * RFS1015600 - End
055550970428
055560000000           IF  WS-IC-FRGN (IC)   EQUAL TO  "Y"
055570970523               MOVE WS-BOOK-TOTAL-INV TO WS-BOOK-FGN-INV.
055580050923           MOVE CLOSING-UNIT-BAL OF TRANS TO WS-CURR-UNIT-BAL.
055590990304R29732     IF  WS-LDA-MGMT-COM-CDE = "IAF"
055600990304           AND PROCESS-DATE OF TRANS-REC IS <= 19980801
055610990304               MOVE CLOSING-UNIT-BAL OF TRANS-REC
055620990304                            TO WS-AUG-UNIT-BAL
055630990304               MOVE RESULTANT-AVERAGE-UNIT-COST OF TRANS-REC
055640990304                            TO WS-AUG-ACB-PRICE.
055650011012
055660011012R11562     IF PROCESS-DATE OF TRANS-REC IS <= WS-PRV-Y-END-DATE
055670011012             MOVE CLOSING-UNIT-BAL OF TRANS TO WS-TEMP-CLOSING-UNIT-BAL
055680011012R11562     END-IF.
055690990517           IF  PROCESS-DATE OF TRANS-REC IS > WS-PRV-Y-END-DATE
055700990528           AND WS-PTRANS-PROCESS-DATE IS <= WS-PRV-Y-END-DATE
055710011012               MOVE WS-PRV-CLOSING-UNIT-BAL
055720011012                           TO WS-TEMP-CLOSING-UNIT-BAL
055730990517           END-IF.
055740990517           MOVE PROCESS-DATE OF TRANS-REC TO WS-PTRANS-PROCESS-DATE.
055750990517           MOVE CLOSING-UNIT-BAL OF TRANS-REC
055760000000                                 TO WS-PRV-CLOSING-UNIT-BAL.
055770000000       CACUB-EXIT.
055780000000           EXIT.
055790080425      /
055800080425      * RFS47406 Start
055810080501       SetGLWBTrans.
055820080501           MOVE Placement-Date OF Trans-Rec TO WS-PLACEMENT-DATE.
055830080501           MOVE Trans-No   OF Trans-Rec     TO WS-TRANS-NO.
055840090505           MOVE Account-No OF Trans-Rec     TO WS-ACCOUNT-NO.
05585009050566141      Initialize ln_GWAContractNo,
05586009050566141                 ln_GuarWithdrawalAmt,
05587009050566141                 ln_GuarWithdrawalExcess,
05588009050566141                 ln_OldGuarWthdwlBaseVal,
05589009050566141                 ln_GWBaseChange,
05590009050566141                 lc_GWBaseCalcMethod,
05591009050566141                 ln_OldGuarWthdwlBalance,
05592009050566141                 ln_GWBalanceChange,
05593008050166141                 lc_FIEBaseCalcMethod.
055940080502           EXEC SQL
055950080502                 SELECT COALESCE(CONTRACT_NO, 0),
055960080502                        COALESCE(GUAR_WITHDRAWAL_AMOUNT, 0),
055970080502                        COALESCE(GUAR_WITHDRAWAL_EXCESS, 0),
055980080502                        COALESCE(OLD_GUAR_WITHDRAWAL_BASE_VALUE, 0),
055990080501                        COALESCE(GW_BASE_CHANGE, 0),
056000080502                        GWBASE_CALC_METHOD,
056010080502                        COALESCE(OLD_GUAR_WITHDRAWAL_BALANCE, 0),
056020080501                        COALESCE(GW_BALANCE_CHANGE, 0),
056030080506                        FIEBASE_CALC_METHOD
056040080501                   INTO :ln_GWAContractNo,
056050080501                        :ln_GuarWithdrawalAmt,
056060080501                        :ln_GuarWithdrawalExcess,
056070080501                        :ln_OldGuarWthdwlBaseVal,
056080080501                        :ln_GWBaseChange,
056090080501                        :lc_GWBaseCalcMethod,
056100080501                        :ln_OldGuarWthdwlBalance,
056110080501                        :ln_GWBalanceChange,
056120080501                        :lc_FIEBaseCalcMethod
056130080501                   FROM MFATRCODP
056140080501                  WHERE PLACEMENT_DATE = :WS-PLACEMENT-DATE AND
056150120614                              TRANS_NO = :WS-TRANS-NO
056160120614      *RFS 107786 - Begin
056170120614                   Order by Contract_No
056180120614                   Fetch First 1 Row Only
056190080501      *RFS 107786 - End
056200080508           END-EXEC.
056210080508           MOVE ZERO   TO ld_StartDate.
056220080508           MOVE ZERO   TO ld_GLWAStartDte.
056230080508           MOVE ZERO   TO ld_GWAStartDate.
056240080508           MOVE ZERO   TO li_GLWAInitDepDays.
056250090305           MOVE ZERO   TO ld_GLWAInitDepEndDte.
05626008050866141      If ln_GWAContractNo > 0
056270080508           EXEC SQL
056280080508            SELECT COALESCE(START_DATE, 0),
056290080508                   COALESCE(GWA_START_DATE, 0),
056300080508                   COALESCE(INITIAL_DEPOSIT_DAYS, 0)
056310080508              INTO :ld_GLWAStartDte, :ld_GWAStartDate,
056320080501                   :li_GLWAInitDepDays
056330080501              FROM MFAACCONP
056340080506             WHERE ACCOUNT_NO  = :WS-ACCOUNT-NO   AND
056350080501                   CONTRACT_NO = :ln_GWAContractNo
056360080605           END-EXEC.
056370080605
05638008060547406 * Fix defect 7 - If Initial Day 0, then use MFASGGWRLP
056390080605
056400080605           If li_GLWAInitDepDays <= 0
056410080818
056420080819      *RFS50993.2 - Start
056430080605              MOVE " "   TO lc_GLWAInitDepDays
056440080818              EXEC SQL
056450080818      *        SELECT COALESCE(INITIAL_DEPOSIT_DAYS, 0)
056460080818      *          INTO :li_GLWAInitDepDays
056470080818      *          FROM MFASGGWRLP
056480080818               SELECT COALESCE(SUBSTR(Series_Rules,21,3)," ")
056490080818                 INTO :lc_GLWAInitDepDays
056500080818                 FROM MFASERRLP
056510080605                WHERE INVESTMENT_SERIES = :lc_InvSeries
056520080818              END-EXEC
056530080818
056540080818              IF lc_GLWAInitDepDays = " "
056550080818                 MOVE ZERO               TO li_GLWAInitDepDays
056560080819              ELSE
056570080818                 INSPECT lc_GLWAInitDepDays REPLACING ALL " " BY "0"
056580080818                 MOVE lc_GLWAInitDepDays TO li_GLWAInitDepDays
056590080818              END-IF
056600080605      *RFS50993.2 - End
056610080605           End-If.
05662008050847406 * Fix defect 7 - End
056630080508      *Calculate Initial deposit end date.
056640080508           IF ld_GLWAStartDte  > 0
056650080508               MOVE ld_GLWAStartDte TO ld_StartDate
056660080508               MOVE ld_StartDate    TO ld_CCYYMMDD
056670080508               MOVE FUNCTION ADD-DURATION (ld_CCYYMMDD DAYS
056680080508                    li_GLWAInitDepDays )
056690080508                 TO ld_GLWAInitDepEndDte
056700080429           END-IF.
056710080508           MOVE SPACE                TO AT-DEPOSIT-INDICATOR.
056720080508           MOVE ZERO                 TO AT-GLWB-DEPOSIT-ALLOCATION.
056730080507           MOVE ZERO                 TO AT-GLWA-DEPOSIT.
056740080507           IF TRANS-TYPE-CODE OF TRANS = lnc_BUY OR lnc_SWI OR lnc_TRI
056750080508                                         OR lnc_PAC
056760080508             PERFORM DetermineDepositInd
056770080506             EXEC SQL
056780080506              SELECT COALESCE(SUM(Gross_Amt), 0)
056790080506               INTO :ln_GrossAmtSum
056800080506               FROM  MFATRNP  Trnp
056810080508              WHERE Trnp.Account_No = :WS-ACCOUNT-NO            AND
056820080506                    Trnp.Process_Date = :ld_ProcessDate         AND
056830080506                    Trnp.Trans_Type_Code in (:lnc_BUY, :lnc_PAC,
056840080506                                  :lnc_SWI, :lnc_TRI)           AND
056850080508                    Trnp.Trans_Status_Code = :lnc_HST
056860080508             END-EXEC
056870080508             IF ln_GrossAmtSum > 0
056880080506                Compute AT-GLWB-Deposit-Allocation =
056890080508                      (Gross-Amt of TRANS / ln_GrossAmtSum ) * 100
056900080508             END-IF
056910080508             MOVE ln_GuarWithdrawalAmt  TO AT-GLWA-DEPOSIT
056920080501           END-IF.
056930080501           MOVE lncc_No              TO AT-FIRST-WTHDRWL-AFT-ELIG-AGE.
056940080506           IF TRANS-TYPE-CODE OF TRANS = lnc_SEL OR lnc_SWO OR lnc_TRO
056950080501              IF PROCESS-DATE OF TRANS = ld_GWAStartDate AND
056960080501                 ln_GuarWithdrawalAmt  > ZERO
056970080501                 MOVE lncc_Yes       TO AT-FIRST-WTHDRWL-AFT-ELIG-AGE
056980080501              END-IF
056990080501              MOVE ln_GuarWithdrawalAmt    TO AT-GLWA-WITHDRAWN
057000080501              MOVE ln_GuarWithdrawalExcess TO AT-EXCESS-GLWA-WITHDRAWN
057010080430           END-IF.
057020080501           MOVE ln_OldGuarWthdwlBaseVal TO AT-GW-BASE-BEFORE-TRADE.
057030080501           IF lc_GWBaseCalcMethod     = lnc_Dollar
057040080501              MOVE lnc_For                 TO AT-GW-BASE-CAL-METHOD
057050080501           ELSE
057060080501              IF lc_GWBaseCalcMethod  = lnc_P
057070080501                 MOVE lnc_Proportional     TO AT-GW-BASE-CAL-METHOD
057080080430           END-IF.
057090080501           MOVE ln_OldGuarWthdwlBalance TO AT-FIE-BASE-BEFORE-TRADE.
057100080501           IF lc_FIEBaseCalcMethod    = lnc_Dollar
057110080501              MOVE lnc_For                 TO AT-FIE-BASE-CAL-METHOD
057120080501           ELSE
057130080501              IF lc_FIEBaseCalcMethod = lnc_P
057140080501                 MOVE lnc_Proportional     TO AT-FIE-BASE-CAL-METHOD
057150080501           END-IF.
057160080501           MOVE ZERO                    TO AT-GW-BASE-AFTER-TRADE.
057170080501           MOVE ZERO                    TO AT-FIE-BASE-AFTER-TRADE.
057180080501           IF TRANS-TYPE-CODE OF TRANS = lnc_BUY OR lnc_SWI OR lnc_TRI
057190080501                                         OR lnc_PAC
057200080501              Compute AT-GW-BASE-AFTER-TRADE =
057210080501                      ln_OldGuarWthdwlBaseVal + ln_GWBaseChange
057220080501              Compute AT-FIE-BASE-AFTER-TRADE =
057230080501                      ln_OldGuarWthdwlBalance + ln_GWBalanceChange.
057240080501           IF TRANS-TYPE-CODE OF TRANS = lnc_SEL OR lnc_SWO OR lnc_TRO
057250080501              Compute AT-GW-BASE-AFTER-TRADE =
057260080501                      ln_OldGuarWthdwlBaseVal - ln_GWBaseChange
057270080501              Compute AT-FIE-BASE-AFTER-TRADE =
057280080507                      ln_OldGuarWthdwlBalance - ln_GWBalanceChange.
057290080507       DetermineDepositInd.
057300080507           MOVE ZERO                           TO li_RecordCnt.
057310080507           MOVE PROCESS-DATE OF TRANS-REC      TO ld_ProcessDate.
057320080507           MOVE TRANS-PROC-SEQ-NO of TRANS-REC TO li_TransProcSeqNo.
057330080507      * Determine if current transaction is the first.
057340080507           EXEC SQL
057350080507             SELECT COUNT(*)  INTO :li_RecordCnt
057360080507               FROM MFATRNP TRNP
057370080507              WHERE Trnp.Account_No = :WS-ACCOUNT-NO     AND
057380080507                    Trnp.process_date < :ld_ProcessDate  AND
057390080507                    Trnp.Trans_Type_Code in (:lnc_BUY, :lnc_PAC,
057400080507                                  :lnc_SWI, :lnc_TRI)
057410080507           END-EXEC.
057420080507      * To check for multiple transactions on the same process date.
057430080507           IF li_RecordCnt = ZERO
057440080507              EXEC SQL
057450080507                SELECT COUNT(*)  INTO :li_RecordCnt
057460080507                  FROM MFATRNP TRNP
057470080507                 WHERE Trnp.Account_No = :WS-ACCOUNT-NO     AND
057480080507                       Trnp.Process_Date = :ld_ProcessDate  AND
057490080507                       Trnp.Trans_Type_Code in (:lnc_BUY, :lnc_PAC,
057500080507                                  :lnc_SWI, :lnc_TRI)       AND
057510080507                       Trnp.Trans_Proc_Seq_No < :li_TransProcSeqNo
057520080507              END-EXEC
057530080507              IF li_RecordCnt = ZERO
057540080507                 MOVE lnc_First  TO AT-DEPOSIT-INDICATOR
057550080507              END-IF
057560080507           END-IF.
057570080508           IF AT-DEPOSIT-INDICATOR = SPACE
057580080508              IF REVERSAL-CODE of TRANS-REC = lnc_INIT          OR
057590080508                 (PROCESS-DATE of TRANS-REC >= ld_GLWAStartDte  AND
057600080508                  PROCESS-DATE of TRANS-REC <= ld_GLWAInitDepEndDte)
057610080508                 MOVE lnc_Initial TO AT-DEPOSIT-INDICATOR
057620080508           END-IF.
057630080508           IF AT-DEPOSIT-INDICATOR = SPACE                  AND
057640080508              REVERSAL-CODE of TRANS-REC  NOT = lnc_INIT    AND
057650080508              PROCESS-DATE of TRANS-REC       > ld_GLWAInitDepEndDte
057660080508                 MOVE lnc_Additional  TO AT-DEPOSIT-INDICATOR
057670080508           END-IF.
057680080507           IF  TRANS-STATUS-CODE of TRANS-REC = lnc_RVS
057690080507                 MOVE lnc_Reversal    TO AT-DEPOSIT-INDICATOR
057700080425           END-IF.
057710000000      * RFS47406 End
057720000000       COMPUTE-CONTRIBS-REDEMPTS.
057730000000
057740000000      ******************************************************************
057750000000      *                                                                *
057760000000      *    C O M P U T E   C O N T R I B S / R E D E M P T S   R T N . *
057770000000      *                                                                *
057780000000      ******************************************************************
057790090930
057800090930 72750     MOVE lnc_N   TO lc_NotionalTrans.
057810090930 72750     IF DISTRIBUTION-ONLY AND
057820090930 72750        UNIT-PRICE OF TRANS = 0 AND UNIT-AMT OF TRANS = 0
057830090930 72750        MOVE lnc_Y   TO lc_NotionalTrans
057840000000 72750     END-IF.
057850000000      *---------------------------------------------------------
057860000000      * CALCULATE THE CONTRIBUTIONS,REDEMPTIONS,REINVESTS
057870000000      * SINCE INCEPTION.
057880000000      *---------------------------------------------------------
057890000000           EVALUATE TRUE
057900000000             WHEN CONTRIBS-ONLY
057910991230               ADD GROSS-AMT OF TRANS TO WS-INV-PUR-INCEPT
057920990619RF5905         ADD GROSS-AMT OF TRANS TO WS-INV-PUR-INCEPT-P
057930061103               ADD WS-GROSS-AMT-EX    TO WS-INV-PUR-INCEPT-EX
057940170619R36342         IF BUY-ONLY AND lb-LdaAccountAdditionalInfoYes
057950170619167932*           IF PROCESS-DATE OF TRANS-REC
057960051006167932            IF ld_SelectDateLR1
057970051006   ¦                  IS GREATER THAN OR EQUAL TO LAST-12-MONTHS-DATE
057980051014   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-PURCH-LAST-12-MONTHS
057990160301   ¦              END-IF
058000160229148326          ADD GROSS-AMT OF TRANS TO ln-AAI-ORG-COST-INF
058010000000R28931         END-IF
058020000000             WHEN REDEMPTS-ONLY
058030990619               ADD GROSS-AMT OF TRANS TO WS-INV-RED-INCEPT
058040061103               ADD WS-GROSS-AMT-EX    TO WS-INV-RED-INCEPT-EX
058050170619R36342         IF (SEL-ONLY OR FEES) AND lb-LdaAccountAdditionalInfoYes
058060170619      *RFS167932 - Starts
058070170619R28931*           IF PROCESS-DATE OF TRANS-REC
058080170619   ¦  *                IS GREATER THAN OR EQUAL TO LAST-12-MONTHS-DATE
058090170619                  IF ld_SelectDateLR1
058100170619                       IS GREATER THAN OR EQUAL TO LAST-12-MONTHS-DATE
058110051014      *RFS167932 - Ends
058120051014   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-REDEM-LAST-12-MONTHS
058130051014   ¦              END-IF
058140061030R28931         END-IF
058150061030      *RFS36342 - Starts
058160061103               IF SEL-ONLY
058170160301                 IF lb-LdaAccountAdditionalInfoYes
058180080623148326           SUBTRACT GROSS-AMT OF TRANS   FROM ln-AAI-ORG-COST-INF
058190170619R50936            IF WS-TAXABLE-EVENT-INDICATOR  = lnc_D
058200170619167932*            IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
058210061101167932             IF ld_SelectDateLR1       >=  WS-CURYTDSTRDTE
058220061101                     COMPUTE ln_InvGrossSoldYtdBase ROUNDED =
058230061030                             ln_InvGrossSoldYtdBase +
058240061030                             WS-GROSS-AMT-EX
058250170619                   END-IF
058260170619167932*            IF PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
058270061101167932             IF ld_SelectDateLR1       >=  WS-LDA-STRDTE
058280061101                     COMPUTE ln_InvGrossSoldCurrBase ROUNDED =
058290061030                             ln_InvGrossSoldCurrBase +
058300061030                             WS-GROSS-AMT-EX
058310080623
058320061030R50936*              IF WS-TAXABLE-EVENT-INDICATOR  =  lnc_D
058330061030                       COMPUTE ln_CurrDispProceedsBase ROUNDED =
058340061030                               ln_CurrDispProceedsBase +
058350061030                               WS-GROSS-AMT-EX
058360061030                       COMPUTE ln_InvCurrDispBookValueBase ROUNDED =
058370061030                               ln_InvCurrDispBookValueBase +
058380061030                               ln_CurrDispBookValueBase
058390061030                     END-IF
058400061030                   END-IF
058410061030                 END-IF
058420061030               END-IF
058430001005      *RFS36342 - Ends
058440000000RF7777       WHEN TRANSFER-IN
058450991230               ADD GROSS-AMT OF TRANS TO WS-INV-TRI-INCEPT
058460990619RF5905         ADD GROSS-AMT OF TRANS TO WS-INV-TRI-INCEPT-P
058470020923               ADD WS-GROSS-AMT-EX    TO WS-INV-TRI-INCEPT-EX
058480040127
058490040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
058500030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
058510030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-INCEPT-PH
058520170619  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-INCEPT-PH-EX
058530170619167932*           IF PROCESS-DATE OF TRANS     >  WS-CURYTDSTRDTE
058540030624167932            IF ld_SelectDateLR1          >  WS-CURYTDSTRDTE
058550030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-YTD-PH
058560030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRI-YTD-PH-EX
058570030624  v               END-IF
058580030624R16881         END-IF
058590020923
058600020923R14556         IF WS-TRANSFER-AT-AVERAGE-IND   IS EQUAL TO "Y"
058610020923                  ADD WS-TRI-TRO-INCEPT-COST TO WS-INV-TRI-INCEPT-COST
058620020923                  ADD WS-TRI-TRO-INCEPT-COST-EX
058630030319                                          TO WS-INV-TRI-INCEPT-COST-EX
058640030319R16256         ELSE
058650030319   ¦              ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-INCEPT-MKT
058660020923R16256            ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-INCEPT-MKT-EX
058670010309R14556         END-IF
058680170620
058690170620      *RFS167932 - Starts
058700170620RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
058710170620               IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
058720010309      *RFS167932 - Ends
058730010309                  ADD WS-GROSS-AMT-EX TO WS-INV-TRI-YTD-EX
058740061103RF8633         END-IF
058750170620R36342         IF lb-LdaAccountAdditionalInfoYes
058760170620167932*           IF PROCESS-DATE OF TRANS-REC
058770051006167932            IF ld_SelectDateLR1
058780051006   ¦                  IS GREATER THAN OR EQUAL TO LAST-12-MONTHS-DATE
058790051014   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-TRI-LAST-12-MONTHS
058800160301   ¦              END-IF
058810051014148326         ADD GROSS-AMT OF TRANS   TO ln-AAI-ORG-COST-INF
058820001005R28931         END-IF
058830000000RF7777       WHEN TRANSFER-OUT
058840990619               ADD GROSS-AMT OF TRANS TO WS-INV-TRO-INCEPT
058850010309               ADD WS-GROSS-AMT-EX    TO WS-INV-TRO-INCEPT-EX
058860040127
058870040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
058880030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
058890030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-INCEPT-PH
058900170620  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-INCEPT-PH-EX
058910170620167932*           IF PROCESS-DATE OF TRANS     >  WS-CURYTDSTRDTE
058920030624167932            IF ld_SelectDateLR1          >  WS-CURYTDSTRDTE
058930030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-YTD-PH
058940030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRO-YTD-PH-EX
058950030624  v               END-IF
058960030624R16881         END-IF
058970020923
058980020923R14556         IF WS-TRANSFER-AT-AVERAGE-IND   IS EQUAL TO "Y"
058990020923                  ADD WS-TRI-TRO-INCEPT-COST TO WS-INV-TRO-INCEPT-COST
059000020923                  ADD WS-TRI-TRO-INCEPT-COST-EX
059010030319                                          TO WS-INV-TRO-INCEPT-COST-EX
059020030319R16256         ELSE
059030030319   ¦              ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-INCEPT-MKT
059040020923R16256            ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-INCEPT-MKT-EX
059050020923R14556         END-IF
059060170620
059070170620      *RFS167932 - Starts
059080170620RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
059090170620               IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
059100010309      *RFS167932 - Ends
059110010309                  ADD WS-GROSS-AMT-EX TO WS-INV-TRO-YTD-EX
059120021202RF8633         END-IF
059130021203
059140021228
059150021203R15022     ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
059160021202   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
059170170620   ¦
059180170620167932*       IF PROCESS-DATE OF TRANS-REC
059190021202167932        IF ld_SelectDateLR1
059200021203   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
059210021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
059220021202   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
059230021202   ¦         END-IF
059240170620   ¦
059250170620167932*       IF PROCESS-DATE OF TRANS-REC
059260021202167932        IF ld_SelectDateLR1
059270021203   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
059280021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
059290021228   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
059300061103R15022        END-IF
059310170620R36342       IF lb-LdaAccountAdditionalInfoYes
059320170620167932*         IF PROCESS-DATE OF TRANS-REC
059330051006167932          IF ld_SelectDateLR1
059340051006   ¦                  IS GREATER THAN OR EQUAL TO LAST-12-MONTHS-DATE
059350051006   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-TRO-LAST-12-MONTHS
059360160301   ¦            END-IF
059370051006148326       SUBTRACT GROSS-AMT OF TRANS   FROM ln-AAI-ORG-COST-INF
059380050830R28931       END-IF
059390001005
059400001005RF7777       WHEN SWITCHES-IN
059410001005               ADD GROSS-AMT OF TRANS TO WS-INV-SWI-INCEPT
059420001005RF5905         ADD GROSS-AMT OF TRANS TO WS-INV-SWI-INCEPT-P
059430010309               ADD WS-GROSS-AMT-EX    TO WS-INV-SWI-INCEPT-EX
059440040127
059450040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
059460030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
059470030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-INCEPT-PH
059480170620  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-INCEPT-PH-EX
059490170620167932*           IF PROCESS-DATE OF TRANS     >  WS-CURYTDSTRDTE
059500030624167932            IF ld_SelectDateLR1          >  WS-CURYTDSTRDTE
059510030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-YTD-PH
059520030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRI-YTD-PH-EX
059530030624  v               END-IF
059540160301R16881         END-IF
059550160301148326         IF lb-LdaAccountAdditionalInfoYes
059560160301148326         ADD GROSS-AMT OF TRANS   TO ln-AAI-ORG-COST-INF
059570170620148326         END-IF
059580170620      *RFS167932 - Starts
059590170620RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
059600170620               IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
059610010309      *RFS167932 - Ends
059620010309                  ADD WS-GROSS-AMT-EX TO WS-INV-SWI-YTD-EX
059630001005RF8633         END-IF
059640001005RF7777       WHEN SWITCHES-OUT
059650001005               ADD GROSS-AMT OF TRANS TO WS-INV-SWO-INCEPT
059660040127               ADD WS-GROSS-AMT-EX    TO WS-INV-SWO-INCEPT-EX
059670040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
059680030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
059690030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-INCEPT-PH
059700170620  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-INCEPT-PH-EX
059710170620167932*           IF PROCESS-DATE OF TRANS     >  WS-CURYTDSTRDTE
059720030624167932            IF ld_SelectDateLR1          >  WS-CURYTDSTRDTE
059730030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-YTD-PH
059740030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRO-YTD-PH-EX
059750030624  v               END-IF
059760030624R16881         END-IF
059770170620
059780170620      *RFS167932 - Starts
059790170620RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
059800170620               IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
059810010309      *RFS167932 - Ends
059820011003                  ADD WS-GROSS-AMT-EX TO WS-INV-SWO-YTD-EX
059830011003R11127            IF  WS-TAXABLE-EVENT-INDICATOR   IS EQUAL TO "D"
059840011003                      ADD WS-GROSS-AMT-EX TO WS-INV-DISP-PROCEEDS-BASE
059850011003                      ADD WS-YTD-DISP-BOOK-VALUE-BASE
059860011003                              TO  WS-INV-DISP-BOOK-VALUE-BASE rounded
059870010309R11127            END-IF
059880021203RF8633         END-IF
059890021228
059900021203R15022     ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
059910021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
059920170620   ¦
059930170620167932*       IF PROCESS-DATE OF TRANS-REC
059940021203167932        IF ld_SelectDateLR1
059950021203   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
059960021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
059970021203   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
059980021203   ¦         END-IF
059990170620   ¦
060000170620167932*       IF PROCESS-DATE OF TRANS-REC
060010021203167932        IF ld_SelectDateLR1
060020021203   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
060030021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
060040021228   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
060050021202R15022        END-IF
060060061024
060070061103      *RFS36342 - Starts
060080160301               IF lb-LdaAccountAdditionalInfoYes
060090160301148326             SUBTRACT GROSS-AMT OF TRANS
060100080623                                 FROM ln-AAI-ORG-COST-INF
060110170620R50936          IF WS-TAXABLE-EVENT-INDICATOR   = lnc_D
060120170620167932*          IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
060130061101167932           IF ld_SelectDateLR1       >=  WS-CURYTDSTRDTE
060140061101                   COMPUTE ln_InvGrossSoldYtdBase ROUNDED =
060150061024                           ln_InvGrossSoldYtdBase +
060160061024                           WS-GROSS-AMT-EX
060170061024                 END-IF
060180170620
060190170620167932*          IF PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
060200061101167932           IF ld_SelectDateLR1       >=  WS-LDA-STRDTE
060210061101                   COMPUTE ln_InvGrossSoldCurrBase ROUNDED =
060220061024                           ln_InvGrossSoldCurrBase +
060230080623                           WS-GROSS-AMT-EX
060240061024R50936*            IF WS-TAXABLE-EVENT-INDICATOR  =  lnc_D
060250061024                     COMPUTE ln_CurrDispProceedsBase ROUNDED =
060260061024                             ln_CurrDispProceedsBase +
060270061024                             WS-GROSS-AMT-EX
060280061024                     COMPUTE ln_InvCurrDispBookValueBase ROUNDED =
060290061024                             ln_InvCurrDispBookValueBase +
060300061024                             ln_CurrDispBookValueBase
060310061024                   END-IF
060320061024                 END-IF
060330061024               END-IF
060340970523      *RFS36342 - Ends
060350090902             WHEN INTEREST
06036009090272750             AND (Edit_Stmdis_No OR
06037097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
060380990619               ADD GROSS-AMT OF TRANS TO WS-INV-INT-INCEPT
060390990125               ADD WS-GROSS-AMT-EX    TO WS-INV-INT-INCEPT-EX
060400970523               ADD UNIT-AMT OF TRANS TO WS-UNITS-DIV
060410090902             WHEN INCOME
06042009090272750             AND (Edit_Stmdis_No OR
06043097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
060440990619               ADD GROSS-AMT OF TRANS TO WS-INV-INC-INCEPT
060450990303               ADD WS-GROSS-AMT-EX    TO WS-INV-INC-INCEPT-EX
060460970523               ADD UNIT-AMT  OF TRANS TO WS-UNITS-DIV
060470090902             WHEN CAPITAL-GAIN
06048009090272750             AND (Edit_Stmdis_No OR
06049097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
060500990619               ADD GROSS-AMT OF TRANS TO WS-INV-CPG-INCEPT
060510990303               ADD WS-GROSS-AMT-EX    TO WS-INV-CPG-INCEPT-EX
060520001123               ADD UNIT-AMT  OF TRANS TO WS-UNITS-DIV
060530001123             WHEN CAPITAL-LOSS
060540001123               SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-CPG-INCEPT
060550001123               SUBTRACT WS-GROSS-AMT-EX    FROM WS-INV-CPG-INCEPT-EX
060560000000               SUBTRACT UNIT-AMT  OF TRANS FROM WS-UNITS-DIV
060570090902            END-EVALUATE.
060580090902
060590090902      *RFS 72750 - begin
060600090902            IF (Edit_Stmdis AND DISTRIBUTION-ONLY AND
060610090902                      UNIT-AMT OF TRANS = 0 AND
060620090930                      UNIT-PRICE OF TRANS NOT = 0)
060630090930               ADD GROSS-AMT OF TRANS TO WS-INV-RED-INCEPT
060640090902               ADD WS-GROSS-AMT-EX    TO WS-INV-RED-INCEPT-EX
060650090902            END-IF.
060660980521      *RFS 72750 - begin
060670090501
060680090501R61356     IF WS-AT-RULE (AT1)      IS EQUAL TO  "9"
060690090501  |           IF WS-CONTR-REDEM-CODE-RULE = "1"
060700170620  |              ADD WS-GROSS-AMT-EX      TO WS-ACC-LTD-CONTRIBUTION
060710170620167932*          IF PROCESS-DATE OF TRANS >= WS-CURYTDSTRDTE
060720090501167932           IF ld_SelectDateLR1      >= WS-CURYTDSTRDTE
060730090501  |                 ADD WS-GROSS-AMT-EX   TO WS-ACC-YTD-CONTRIBUTION
060740090501  |              END-IF
060750090501  |           END-IF
060760090501  |
060770090501  |           IF WS-CONTR-REDEM-CODE-RULE = "2"
060780170620  |              ADD WS-GROSS-AMT-EX      TO WS-ACC-LTD-WITHDRAWALS
060790170620167932*          IF PROCESS-DATE OF TRANS >= WS-CURYTDSTRDTE
060800090501167932           IF ld_SelectDateLR1      >= WS-CURYTDSTRDTE
060810090501  |                 ADD WS-GROSS-AMT-EX   TO WS-ACC-YTD-WITHDRAWALS
060820090501  |              END-IF
060830090501  v           END-IF
060840090501R61356     END-IF.
060850021008
060860021018R14858       IF BUY-ADJUSTMENT
060870021018  ¦             MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
060880180131  ¦              GIVING WS-BAJ-UNIT-AMT
060890180131176253           ROUNDED
060900180131      ** RFS176758 - Start **
060910180131                 IF Lc_STMLTD = "Y"
060920180131                    MOVE GROSS-AMT OF TRANS TO WS-BAJ-UNIT-AMT
060930180131                 END-IF
060940021018      ** RFS176758 - End   **
060950170620  ¦            ADD WS-BAJ-UNIT-AMT TO WS-INV-BAJ-INCEPT
060960170620167932*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
060970021021167932         IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
060980021021  ¦               ADD WS-BAJ-UNIT-AMT    TO WS-INV-BAJ-YTD
060990021018  ¦            END-IF
061000170224R14858       END-IF
061010170224
061020170224167730         IF SEL-ADJUSTMENT
061030170224  |               INITIALIZE WS-SAJ-UNIT-AMT
061040170224  |               MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
061050180131  |               GIVING WS-SAJ-UNIT-AMT
061060180131176253            ROUNDED
061070180131      ** RFS176758 - Start **
061080180131                  IF Lc_STMLTD = "Y"
061090180131                      MOVE GROSS-AMT OF TRANS TO WS-SAJ-UNIT-AMT
061100180131                  END-IF
061110170224      ** RFS176758 - End   **
061120170224  |               ADD WS-SAJ-UNIT-AMT TO WS-INV-SAJ-INCEPT
061130170224167730         END-IF.
061140021008
061150021018R14858       IF BALANCE-FORWARD
061160021018  ¦             MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
061170180131  ¦              GIVING WS-BFW-UNIT-AMT
061180021018176253           ROUNDED
061190170620  ¦            ADD WS-BFW-UNIT-AMT TO WS-INV-BFW-INCEPT
061200170620167932*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
061210021021167932         IF ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
061220021021  ¦               ADD WS-BFW-UNIT-AMT    TO WS-INV-BFW-YTD
061230021018  ¦            END-IF
061240021008R14858       END-IF
061250011011
061260170620R11127      IF  SEL-ONLY
061270170620167932*     AND PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
061280011011167932      AND ld_SelectDateLR1      IS GREATER THAN WS-CURYTDSTRDTE
061290011011            AND WS-TAXABLE-EVENT-INDICATOR   IS EQUAL TO "D"
061300011011                ADD WS-GROSS-AMT-EX  TO   WS-INV-DISP-PROCEEDS-BASE
061310011011                ADD WS-YTD-DISP-BOOK-VALUE-BASE
061320011011                          TO  WS-INV-DISP-BOOK-VALUE-BASE
061330021202R11127      END-IF.
061340021228
061350021203R15022      IF WS-TRANS-TYPE = "FEE"
061360021203   ¦       ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
061370021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
061380170620   ¦
061390170620167932*       IF PROCESS-DATE OF TRANS-REC
061400021203167932        IF ld_SelectDateLR1
061410021203   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
061420021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
061430021203   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
061440021203   ¦         END-IF
061450170620   ¦
061460170620167932*       IF PROCESS-DATE OF TRANS-REC
061470021203167932        IF ld_SelectDateLR1
061480021203   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
061490021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
061500021203   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
061510021202   ¦          END-IF
061520031114R15022     END-IF
061530021202
061540021228
061550021203R15022      IF WS-TRANS-TYPE = "TFE"
061560021203   ¦       ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
061570021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
061580170620   ¦
061590170620167932*       IF PROCESS-DATE OF TRANS-REC
061600021203167932        IF ld_SelectDateLR1
061610021203   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
061620021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
061630021203   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
061640021203   ¦         END-IF
061650170620   ¦
061660170620167932*       IF PROCESS-DATE OF TRANS-REC
061670021203167932        IF ld_SelectDateLR1
061680021203   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
061690021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
061700021203   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
061710021224   ¦          END-IF
061720021224R15022     END-IF
061730021224
061740040921R15022     IF WS-TRANS-TYPE = "SEL"
061750040921   ¦          ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
061760021224   ¦          ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
061770170620   ¦
061780170620167932*       IF PROCESS-DATE OF TRANS-REC
061790021224167932        IF ld_SelectDateLR1
061800040921   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
061810040921   ¦             ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
061820040921   ¦             ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
061830021224   ¦          END-IF
061840170620   ¦
061850170620167932*       IF PROCESS-DATE OF TRANS-REC
061860021224167932        IF ld_SelectDateLR1
061870040921   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
061880040921   ¦             ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
061890021224   ¦             ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
061900040921R15022        END-IF
061910011011R22879      END-IF.
061920990129
061930040921            IF CONTRIB-U
061940040921               ADD UNIT-AMT OF TRANS TO WS-UNITS-BOUGHT
061950040921R22879      END-IF.
061960990129
061970040921            IF REDEMPT-U
061980040921               ADD UNIT-AMT OF TRANS TO WS-UNITS-SOLD
061990990129R22879      END-IF.
062000050923
062010170620R29732      IF WS-LDA-MGMT-COM-CDE = "IAF"
062020170620167932*     AND PROCESS-DATE OF TRANS-REC > 19980801
062030990304167932      AND ld_SelectDateLR1          > 19980801
062040990305
062050990305                IF CONTRIBS-ONLY
062060990305                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-PUR-INCEPT
062070990305                END-IF
062080990304
062090990304                IF CONTRIB-U
062100990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-BOUGHT
062110990304                END-IF
062120990305
062130990305                IF REDEMPTS-ONLY
062140990305                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-RED-INCEPT
062150990305                END-IF
062160990304
062170990304                IF REDEMPT-U
062180990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-SOLD
062190990304                END-IF
062200990315
062210990315                IF REDEMPTION-TRANSACTION
062220990316                   INITIALIZE WS-TRN-BOOK-VALUE
062230990315                   MULTIPLY AVERAGE-UNIT-COST OF
062240990315                            TRANS-REC BY UNIT-AMT
062250990316                            OF TRANS-REC
062260990315                            GIVING WS-TRN-BOOK-VALUE ROUNDED
062270990315                   ADD WS-TRN-BOOK-VALUE TO WS-P-AUG-BOOK-VALUE
062280990315                END-IF
062290990304
062300990304                IF INTEREST
062310990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-INT-INCEPT
062320990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
062330990304                END-IF
062340990304
062350990304                IF INCOME
062360990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-INC-INCEPT
062370990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
062380990304                END-IF
062390990304
062400990304                IF CAPITAL-GAIN
062410990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-CPG-INCEPT
062420990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
062430990304                END-IF
062440001123
062450001123                IF CAPITAL-LOSS
062460001123                   SUBTRACT GROSS-AMT OF TRANS
062470001123                   FROM WS-AUG-INV-CPG-INCEPT
062480001123                   SUBTRACT UNIT-AMT OF TRANS FROM WS-AUG-UNITS-DIV
062490001123                END-IF
062500990304
062510990304                IF TRANSFER-IN-ONLY
062520990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-TRI-INCEPT
062530990304                END-IF
062540990304
062550990304                IF TRANSFER-OUT-ONLY
062560990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-TRO-INCEPT
062570990305                END-IF
062580990304            END-IF.
062590980624
062600980624           IF  WS-CC-RTECLS (CC) EQUAL TO  ZEROES
062610980624               GO TO CR-0000-0010.
062620980624
062630980624980514     IF  ORIGINAL-COST-IN
062640980624               COMPUTE WS-IN-AMT ROUNDED
062650980624                                        =  WS-IN-AMT
062660980624                                        +  (GROSS-AMT
062670980626                                            OF TRANS-REC
062680980624                                        /   WS-CC-RTECLS (CC)).
062690980624980514     IF  ORIGINAL-COST-OUT
062700980624               COMPUTE WS-OUT-AMT ROUNDED
062710980624                                        =  WS-OUT-AMT
062720980624                                        +  (GROSS-AMT
062730980626                                            OF TRANS-REC
062740980624                                        /   WS-CC-RTECLS (CC)).
062750980624           GO TO CR-0000-0020.
062760980624
062770980521       CR-0000-0010.
062780980521980514     IF  ORIGINAL-COST-IN
062790980521               ADD GROSS-AMT
062800980521                   OF TRANS-REC        TO  WS-IN-AMT.
062810980521           IF  ORIGINAL-COST-OUT
062820980521               ADD GROSS-AMT
062830980624                   OF TRANS-REC        TO  WS-OUT-AMT.
062840980624
062850000000       CR-0000-0020.
062860970115           IF  RRSP-CONTRIBUTION
062870000000           OR  RRSP-CONTRIBUTION-BPI
062880990619               ADD GROSS-AMT
062890990619                   OF TRANS-REC        TO  WS-INV-REG-CTB-INCPT
062900970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-REG-CTB-INCPT-EX.
062910970422
062920970422      *****
062930970422      *****    Accumulate the year-to-date totals, if applicable.
062940970422      *****
062950170620
062960170620      *RFS167932 - Starts
062970170620      *    IF  PROCESS-DATE
062980170620      *        OF TRANS-REC  IS LESS THAN  WS-YTDSTRDTE
062990170620           IF  ld_SelectDateLR1
063000170620                             IS LESS THAN  WS-YTDSTRDTE
063010970422      *RFS167932 - Ends
063020970422               GO TO CR-0010.
063030970422
063040090902           IF  CAPITAL-GAIN
06305009090272750             AND (Edit_Stmdis_No OR
06306097042272750                  (Edit_Stmdis AND lc_NotionalTrnNo))
063070990619               ADD GROSS-AMT
063080990619                   OF TRANS-REC        TO  WS-INV-CPG-YTD
063090001123               ADD WS-GROSS-AMT-EX     TO  WS-INV-CPG-YTD-EX.
063100001123           IF  CAPITAL-LOSS
063110001123               SUBTRACT GROSS-AMT
063120001123                   OF TRANS-REC         FROM  WS-INV-CPG-YTD
063130970422               SUBTRACT WS-GROSS-AMT-EX FROM  WS-INV-CPG-YTD-EX.
063140090902           IF  INCOME
06315009090272750             AND (Edit_Stmdis_No OR
06316097042272750                  (Edit_Stmdis AND lc_NotionalTrnNo))
063170990619               ADD GROSS-AMT
063180990619                   OF TRANS-REC        TO  WS-INV-INC-YTD
063190970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-INC-YTD-EX.
063200090902           IF  INTEREST
06321009090272750             AND (Edit_Stmdis_No OR
06322097042272750                  (Edit_Stmdis AND lc_NotionalTrnNo))
063230990619               ADD GROSS-AMT
063240990619                   OF TRANS-REC        TO  WS-INV-INT-YTD
063250970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-INT-YTD-EX.
063260970422           IF  CONTRIBS-ONLY
063270990619               ADD GROSS-AMT
063280990619                   OF TRANS-REC        TO  WS-INV-PUR-YTD
063290970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-PUR-YTD-EX.
063300090902           IF  REDEMPTS-ONLY
06331009090272750             OR (Edit_Stmdis AND DISTRIBUTION-ONLY AND
06332009090272750                 UNIT-AMT OF TRANS = 0             AND
06333097042272750                 UNIT-PRICE OF TRANS NOT = 0)
063340990619               ADD GROSS-AMT
063350990619                   OF TRANS-REC        TO  WS-INV-RED-YTD
063360970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-RED-YTD-EX.
063370970422
063380970422       CR-0010.
063390000000           CONTINUE.
063400000000
063410000000       CR-EXIT.
063420000000           EXIT.
063430011031      /
063440000000
063450000000       COMPUTE-CURRENT-PERIOD.
063460000000      ******************************************************************
063470000000      *                                                                *
063480000000      *    C O M P U T E   C U R R E N T   P E R I O D   R O U T I N E *
063490000000      *                                                                *
063500170615      ******************************************************************
063510170615      *RFS167932 - Starts
063520170621           INITIALIZE ld_SelectDateCurr
063530170620           IF lc-LdaSelectDate = "T" AND
063540170615              WS-LDA-STMT-CNFM-FLAG = "S"
063550170615              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDateCurr
063560170615           ELSE
063570170615              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDateCurr
063580170615           END-IF
063590170615
063600090930      *RFS167932 - End
063610090930 72750     MOVE lnc_N   TO lc_NotionalTrans.
063620090930 72750     IF DISTRIBUTION-ONLY AND
063630090930 72750        UNIT-PRICE OF TRANS = 0 AND UNIT-AMT OF TRANS = 0
063640090930 72750        MOVE lnc_Y   TO lc_NotionalTrans
063650000000 72750     END-IF.
063660000000      *---------------------------------------------------------
063670000000      * CALCULATE THE CURRENT CONTRIBUTIONS,REDEMPTIONS,REINVESTS
063680000000      * ADD THOSE TO ABOVE INCEPTION BUCKETS ALSO
063690090902      *---------------------------------------------------------
063700000000
063710000000           EVALUATE TRUE
063720000000             WHEN CONTRIBS-ONLY
063730000000               ADD GROSS-AMT OF TRANS TO WS-INV-PUR-CURRENT
063740020517                                         WS-INV-PUR-INCEPT
063750020517               ADD WS-GROSS-AMT-EX    TO WS-INV-PUR-CURRENT-EX
063760061103                                         WS-INV-PUR-INCEPT-EX
063770051006R36342         IF BUY-ONLY AND lb-LdaAccountAdditionalInfoYes
063780051014   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-PURCH-LAST-12-MONTHS
063790000000R28931         END-IF
063800000000             WHEN REDEMPTS-ONLY
063810000000               ADD GROSS-AMT OF TRANS TO WS-INV-RED-CURRENT
063820020517                                         WS-INV-RED-INCEPT
063830020517               ADD WS-GROSS-AMT-EX    TO WS-INV-RED-CURRENT-EX
063840061103                                         WS-INV-RED-INCEPT-EX
063850060630R36342         IF (SEL-ONLY OR FEES) AND lb-LdaAccountAdditionalInfoYes
063860051014R28931           ADD GROSS-AMT OF TRANS TO WS-INV-REDEM-LAST-12-MONTHS
063870061030R28931         END-IF
063880061030      *RFS36342 - Starts
063890061103               IF SEL-ONLY
063900080623                 IF lb-LdaAccountAdditionalInfoYes
063910170615R50936            IF WS-TAXABLE-EVENT-INDICATOR  = lnc_D
063920170615167932*            IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
063930061101167932             IF ld_SelectDateCurr      >=  WS-CURYTDSTRDTE
063940061101                     COMPUTE ln_InvGrossSoldYtdBase ROUNDED =
063950061030                             ln_InvGrossSoldYtdBase +
063960061030                             WS-GROSS-AMT-EX
063970061030                   END-IF
063980170615
063990170615167932*            IF PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
064000061101167932             IF ld_SelectDateCurr      >=  WS-LDA-STRDTE
064010061101                     COMPUTE ln_InvGrossSoldCurrBase ROUNDED =
064020061030                             ln_InvGrossSoldCurrBase +
064030061030                             WS-GROSS-AMT-EX
064040080623
064050061030R50936*              IF WS-TAXABLE-EVENT-INDICATOR  =  lnc_D
064060061030                       COMPUTE ln_CurrDispProceedsBase ROUNDED =
064070061030                               ln_CurrDispProceedsBase +
064080061030                               WS-GROSS-AMT-EX
064090061030                       COMPUTE ln_InvCurrDispBookValueBase ROUNDED =
064100061030                               ln_InvCurrDispBookValueBase +
064110061030                               ln_CurrDispBookValueBase
064120061030                     END-IF
064130061030                   END-IF
064140061030                 END-IF
064150061030               END-IF
064160001006      *RFS36342 - Ends
064170000000RF7777       WHEN TRANSFER-IN
064180000000               ADD GROSS-AMT OF TRANS TO WS-INV-TRI-CURRENT
064190020517                                         WS-INV-TRI-INCEPT
064200020517               ADD WS-GROSS-AMT-EX    TO WS-INV-TRI-CURRENT-EX
064210020923                                         WS-INV-TRI-INCEPT-EX
064220040127
064230040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
064240030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
064250030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-CUR-PH
064260030624  ¦                                          WS-INV-TRI-INCEPT-PH
064270030624  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-CUR-PH-EX
064280170615  ¦                                          WS-INV-TRI-INCEPT-PH-EX
064290170615167932*           IF PROCESS-DATE OF TRANS     > WS-CURYTDSTRDTE
064300030624167932            IF ld_SelectDateCurr         > WS-CURYTDSTRDTE
064310030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-YTD-PH
064320030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRI-YTD-PH-EX
064330030624  v               END-IF
064340030624R16881         END-IF
064350020923
064360020923R14556         IF WS-TRANSFER-AT-AVERAGE-IND   IS EQUAL TO "Y"
064370020923                  ADD WS-TRI-TRO-INCEPT-COST TO WS-INV-TRI-INCEPT-COST
064380020923                  ADD WS-TRI-TRO-INCEPT-COST-EX
064390030319                                          TO WS-INV-TRI-INCEPT-COST-EX
064400030319R16256         ELSE
064410030319   ¦              ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-INCEPT-MKT
064420020923R16256            ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-INCEPT-MKT-EX
064430020923R14556         END-IF
064440170615
064450170615      *RFS167932 - Starts
064460170615RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
064470170615               IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
064480010327      *RFS167932 - Ends
064490010327RF8633            ADD WS-GROSS-AMT-EX TO WS-INV-TRI-YTD-EX
064500051006RF8633         END-IF
064510061103
064520051014R36342         IF lb-LdaAccountAdditionalInfoYes
064530051014   ¦              ADD GROSS-AMT OF TRANS TO WS-INV-TRI-LAST-12-MONTHS
064540050921R28931         END-IF
064550001006
064560000000RF7777       WHEN TRANSFER-OUT
064570000000               ADD GROSS-AMT OF TRANS TO WS-INV-TRO-CURRENT
064580020517                                         WS-INV-TRO-INCEPT
064590020517               ADD WS-GROSS-AMT-EX    TO WS-INV-TRO-CURRENT-EX
064600020923                                         WS-INV-TRO-INCEPT-EX
064610040127
064620040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
064630030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
064640030624R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-CUR-PH
064650030624  ¦                                          WS-INV-TRO-INCEPT-PH
064660030624  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-CUR-PH-EX
064670170615  ¦                                          WS-INV-TRO-INCEPT-PH-EX
064680170615167932*           IF PROCESS-DATE OF TRANS     > WS-CURYTDSTRDTE
064690030624167932            IF ld_SelectDateCurr         > WS-CURYTDSTRDTE
064700030624  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-YTD-PH
064710030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRO-YTD-PH-EX
064720030624  v               END-IF
064730030624R16881         END-IF
064740020923
064750020923R14556         IF WS-TRANSFER-AT-AVERAGE-IND   IS EQUAL TO "Y"
064760020923                  ADD WS-TRI-TRO-INCEPT-COST TO WS-INV-TRO-INCEPT-COST
064770020923                  ADD WS-TRI-TRO-INCEPT-COST-EX
064780030319                                          TO WS-INV-TRO-INCEPT-COST-EX
064790030319R16256         ELSE
064800030319   ¦              ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-INCEPT-MKT
064810020923R16256            ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-INCEPT-MKT-EX
064820020923R14556         END-IF
064830170615
064840170615      *RFS167932 - Starts
064850170615RF8633*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
064860170615               IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
064870010327      *RFS167932 - Ends
064880010327RF8633            ADD WS-GROSS-AMT-EX TO WS-INV-TRO-YTD-EX
064890021202RF8633         END-IF
064900021203
064910021203R15022     ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
064920021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
064930170615   ¦
064940170615      *RFS167932 - Starts
064950170615   ¦  *       IF PROCESS-DATE OF TRANS-REC
064960170615   ¦  *                           IS GREATER THAN WS-CURYTDSTRDTE
064970170615   ¦          IF ld_SelectDateCurr
064980170615   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
064990021203      *RFS167932 - Ends
065000021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
065010021203   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
065020021203   ¦         END-IF
065030170615   ¦
065040170615      *RFS167932 - Starts
065050170615   ¦  *       IF PROCESS-DATE OF TRANS-REC
065060170615   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
065070170615   ¦          IF ld_SelectDateCurr
065080170615   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
065090021203      *RFS167932 - Ends
065100021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
065110021203   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
065120010327R15022        END-IF
065130061103
065140051014R36342        IF lb-LdaAccountAdditionalInfoYes
065150051014   ¦             ADD GROSS-AMT OF TRANS TO WS-INV-TRO-LAST-12-MONTHS
065160001006R28931        END-IF
065170010309RF7777       WHEN SWITCHES-IN
065180001006RF8633         ADD GROSS-AMT OF TRANS TO WS-INV-SWI-CURRENT
065190010309                                         WS-INV-SWI-INCEPT
065200010309rf8113         ADD WS-GROSS-AMT-EX    TO WS-INV-SWI-CURRENT-EX
065210030626                                         WS-INV-SWI-INCEPT-EX
065220040127
065230040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
065240030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
065250030626R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-CUR-PH
065260030626  ¦                                          WS-INV-TRI-INCEPT-PH
065270030626  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRI-CUR-PH-EX
065280170615  ¦                                          WS-INV-TRI-INCEPT-PH-EX
065290170615167932*           IF PROCESS-DATE OF TRANS     > WS-CURYTDSTRDTE
065300030626167932            IF ld_SelectDateCurr         > WS-CURYTDSTRDTE
065310030626  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRI-YTD-PH
065320030626  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRI-YTD-PH-EX
065330030626  v               END-IF
065340030626R16881         END-IF
065350170615
065360170615167932*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
065370010327167932         IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
065380010327RF8633            ADD WS-GROSS-AMT-EX TO WS-INV-SWI-YTD-EX
065390010327RF8633         END-IF
065400001006
065410010309RF7777       WHEN SWITCHES-OUT
065420001006RF8633         ADD GROSS-AMT OF TRANS TO WS-INV-SWO-CURRENT
065430010309                                         WS-INV-SWO-INCEPT
065440010309               ADD WS-GROSS-AMT-EX    TO WS-INV-SWO-CURRENT-EX
065450030624rf8113                                   WS-INV-SWO-INCEPT-EX
065460040127
065470040127R20573         IF WS-ACCT-CHG                  IS EQUAL TO "Y" AND
065480030912R20573            (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4")
065490030626R16881            ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-CUR-PH
065500030626  ¦                                          WS-INV-TRO-INCEPT-PH
065510030626  ¦               ADD WS-GROSS-AMT-EX     TO WS-INV-TRO-CUR-PH-EX
065520170615  ¦                                          WS-INV-TRO-INCEPT-PH-EX
065530170615167932*           IF PROCESS-DATE OF TRANS     > WS-CURYTDSTRDTE
065540030626167932            IF ld_SelectDateCurr         > WS-CURYTDSTRDTE
065550030626  ¦                  ADD GROSS-AMT OF TRANS  TO WS-INV-TRO-YTD-PH
065560030624  ¦                  ADD WS-GROSS-AMT-EX  TO WS-INV-TRO-YTD-PH-EX
065570030624  v               END-IF
065580030624R16881         END-IF
065590170615
065600170615167932*        IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
065610010327167932         IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
065620011003RF8633            ADD WS-GROSS-AMT-EX TO WS-INV-SWO-YTD-EX
065630011003R11127            IF  WS-TAXABLE-EVENT-INDICATOR   IS EQUAL TO "D"
065640011003   ¦                  ADD WS-GROSS-AMT-EX TO WS-INV-DISP-PROCEEDS-BASE
065650011003   ¦                  ADD WS-YTD-DISP-BOOK-VALUE-BASE
065660011003   ¦                                   TO  WS-INV-DISP-BOOK-VALUE-BASE
065670010327R11127            END-IF
065680021203RF8633         END-IF
065690021203R15022     ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
065700021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
065710170616   ¦
065720170616      *RFS167932 - Starts
065730170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
065740170616   ¦  *                           IS GREATER THAN WS-CURYTDSTRDTE
065750170616              IF ld_SelectDateCurr
065760170616                                  IS GREATER THAN WS-CURYTDSTRDTE
065770021203      *RFS167932 - Ends
065780021203   ¦           ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
065790021203   ¦           ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
065800021203   ¦         END-IF
065810170616   ¦
065820170616      *RFS167932 - Starts
065830170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
065840170616   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
065850170616              IF ld_SelectDateCurr
065860170616                         IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
065870021203      *RFS167932 - Ends
065880021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
065890021203   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
065900021202R15022        END-IF
065910061024
065920061103      *RFS36342 - Starts
065930080623               IF lb-LdaAccountAdditionalInfoYes
065940170616R50936          IF WS-TAXABLE-EVENT-INDICATOR  = lnc_D
065950170616167932*          IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
065960061101167932           IF ld_SelectDateCurr      >=  WS-CURYTDSTRDTE
065970061101                   COMPUTE ln_InvGrossSoldYtdBase ROUNDED =
065980061024                           ln_InvGrossSoldYtdBase +
065990061024                           WS-GROSS-AMT-EX
066000061024                 END-IF
066010170616
066020170616167932*          IF PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
066030061101167932           IF ld_SelectDateCurr      >=  WS-LDA-STRDTE
066040061101                   COMPUTE ln_InvGrossSoldCurrBase ROUNDED =
066050061024                           ln_InvGrossSoldCurrBase +
066060061024                           WS-GROSS-AMT-EX
066070080623
066080061024R50936*            IF WS-TAXABLE-EVENT-INDICATOR  =  lnc_D
066090061024                     COMPUTE ln_CurrDispProceedsBase ROUNDED =
066100061024                             ln_CurrDispProceedsBase +
066110061024                             WS-GROSS-AMT-EX
066120061024                     COMPUTE ln_InvCurrDispBookValueBase ROUNDED =
066130061024                             ln_InvCurrDispBookValueBase +
066140061024                             ln_CurrDispBookValueBase
066150061024                   END-IF
066160061024                 END-IF
066170061024               END-IF
066180061024      *RFS36342 - Ends
066190970523
066200090902             WHEN INTEREST
06621009090272750             AND (Edit_Stmdis_No OR
06622097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
066230000000               ADD GROSS-AMT OF TRANS TO WS-INV-INT-CURRENT
066240990619                                         WS-INV-INT-INCEPT
066250990619               ADD WS-GROSS-AMT-EX    TO WS-INV-INT-CURRENT-EX
066260990125                                         WS-INV-INT-INCEPT-EX
066270970523               ADD UNIT-AMT OF TRANS TO WS-UNITS-DIV
066280090902             WHEN INCOME
06629009090272750             AND (Edit_Stmdis_No OR
06630097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
066310000000               ADD GROSS-AMT OF TRANS TO WS-INV-INC-CURRENT
066320990619                                         WS-INV-INC-INCEPT
066330990619               ADD WS-GROSS-AMT-EX    TO WS-INV-INC-CURRENT-EX
066340990125                                         WS-INV-INC-INCEPT-EX
066350970523               ADD UNIT-AMT OF TRANS TO WS-UNITS-DIV
066360090902             WHEN CAPITAL-GAIN
06637009090272750             AND (Edit_Stmdis_No OR
06638097052372750                  (Edit_Stmdis AND lc_NotionalTrnNo))
066390000000               ADD GROSS-AMT OF TRANS TO WS-INV-CPG-CURRENT
066400990619                                         WS-INV-CPG-INCEPT
066410990619               ADD WS-GROSS-AMT-EX    TO WS-INV-CPG-CURRENT-EX
066420990125                                         WS-INV-CPG-INCEPT-EX
066430001123               ADD UNIT-AMT OF TRANS TO WS-UNITS-DIV
066440001123             WHEN CAPITAL-LOSS
066450001123               SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-CPG-CURRENT
066460001123                                                WS-INV-CPG-INCEPT
066470001123               SUBTRACT WS-GROSS-AMT-EX    FROM WS-INV-CPG-CURRENT-EX
066480001123                                                WS-INV-CPG-INCEPT-EX
066490000000               SUBTRACT UNIT-AMT OF TRANS  FROM WS-UNITS-DIV
066500090902            END-EVALUATE.
066510090902
066520090902      *RFS 72750 - begin
066530090902            IF (Edit_Stmdis AND DISTRIBUTION-ONLY AND
066540090902                      UNIT-AMT OF TRANS = 0 AND
066550090902                      UNIT-PRICE OF TRANS NOT = 0)
066560090902               ADD GROSS-AMT OF TRANS TO WS-INV-RED-CURRENT
066570090902                                         WS-INV-RED-INCEPT
066580090902               ADD WS-GROSS-AMT-EX    TO WS-INV-RED-CURRENT-EX
066590090902                                         WS-INV-RED-INCEPT-EX
066600090902            END-IF.
066610050921      *RFS 72750 - begin
066620090501
066630090501R61356     IF WS-AT-RULE (AT1)      IS EQUAL TO  "9"
066640090501  |           IF WS-CONTR-REDEM-CODE-RULE = "1"
066650170616  |              ADD WS-GROSS-AMT-EX      TO WS-ACC-LTD-CONTRIBUTION
066660170616167932*          IF PROCESS-DATE OF TRANS >= WS-CURYTDSTRDTE
066670090501167932           IF ld_SelectDateCurr     >= WS-CURYTDSTRDTE
066680090501  |                 ADD WS-GROSS-AMT-EX   TO WS-ACC-YTD-CONTRIBUTION
066690090501  |              END-IF
066700090501  |           END-IF
066710090501  |
066720090501  |           IF WS-CONTR-REDEM-CODE-RULE = "2"
066730170616  |              ADD WS-GROSS-AMT-EX      TO WS-ACC-LTD-WITHDRAWALS
066740170616167932*          IF PROCESS-DATE OF TRANS >= WS-CURYTDSTRDTE
066750090501167932           IF ld_SelectDateCurr     >= WS-CURYTDSTRDTE
066760090501  |                 ADD WS-GROSS-AMT-EX   TO WS-ACC-YTD-WITHDRAWALS
066770090501  |              END-IF
066780090501  v           END-IF
066790090501R61356     END-IF.
066800040921
066810040921R14858     IF BUY-ADJUSTMENT
066820040921  ¦           MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
066830180131  ¦             GIVING WS-BAJ-UNIT-AMT
066840180131176253          ROUNDED
066850180131      ** RFS176758 - Start **
066860180131              IF Lc_STMLTD = "Y"
066870180131                 MOVE GROSS-AMT OF TRANS TO WS-BAJ-UNIT-AMT
066880180131              END-IF
066890040921      ** RFS176758 - End   **
066900040921  ¦           ADD WS-BAJ-UNIT-AMT    TO WS-INV-BAJ-CUR
066910021018  ¦                                     WS-INV-BAJ-INCEPT
066920170616  ¦
066930170616167932*       IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
066940040921167932        IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
066950040921  ¦              ADD WS-BAJ-UNIT-AMT    TO WS-INV-BAJ-YTD
066960040921R14858        END-IF
066970161208R22879     END-IF.
066980161208
066990161208164374       IF SEL-ADJUSTMENT
067000161208  |             INITIALIZE WS-SAJ-UNIT-AMT
067010161208  |             MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
067020180131  |             GIVING WS-SAJ-UNIT-AMT
067030180131176253          ROUNDED
067040180131      ** RFS176758 - Start **
067050180131                IF Lc_STMLTD = "Y"
067060180131                   MOVE GROSS-AMT OF TRANS TO WS-SAJ-UNIT-AMT
067070180131                END-IF
067080161208      ** RFS176758 - End   **
067090161208  |             ADD WS-SAJ-UNIT-AMT TO WS-INV-SAJ-INCEPT
067100021008164374       END-IF
067110040921
067120040921R14858     IF BALANCE-FORWARD
067130040921  ¦           MULTIPLY UNIT-AMT OF TRANS  BY UNIT-PRICE OF TRANS
067140180131  ¦            GIVING WS-BFW-UNIT-AMT
067150040921176253         ROUNDED
067160040921  ¦           ADD WS-BFW-UNIT-AMT    TO WS-INV-BFW-CUR
067170021018  ¦                                     WS-INV-BFW-INCEPT
067180170616  ¦
067190170616167932*       IF PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
067200040921167932        IF ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
067210040921  ¦              ADD WS-BFW-UNIT-AMT    TO WS-INV-BFW-YTD
067220040921R14858        END-IF
067230050921R22879     END-IF.
067240011011
067250170616R11127     IF  SEL-ONLY
067260170616167932*    AND PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
067270011011167932     AND ld_SelectDateCurr     IS GREATER THAN WS-CURYTDSTRDTE
067280011011           AND WS-TAXABLE-EVENT-INDICATOR   IS EQUAL TO "D"
067290011011                  ADD WS-GROSS-AMT-EX TO WS-INV-DISP-PROCEEDS-BASE
067300011011                  ADD WS-YTD-DISP-BOOK-VALUE-BASE
067310170616                                       TO  WS-INV-DISP-BOOK-VALUE-BASE
067320040921      *RFS167932 - Starts
067330031118R18312         IF PROCESS-DATE OF TRANS-REC
067340170616   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067350170616R18312         IF ld_SelectDateCurr
067360170616   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067370040921      *RFS167932 - Ends
067380040921   ¦              ADD GROSS-AMT OF TRANS     TO WS-INV-SEL-CURRENT
067390040921R18312         END-IF
067400031118R22879     END-IF.
067410040921
067420170616R18312     IF WS-TRANS-TYPE = "BUY"
067430170616      *RFS167932 - Starts
067440170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
067450170616   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067460170616   ¦          IF ld_SelectDateCurr
067470170616   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067480040921      *RFS167932 - Ends
067490031118   ¦             ADD GROSS-AMT OF TRANS    TO WS-INV-BUY-CURRENT
067500040921   ¦          END-IF
067510021202R18312     END-IF.
067520040921
067530021228R15022     IF WS-TRANS-TYPE = "FEE"
067540021203   ¦       ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
067550021203   ¦       ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
067560170616   ¦
067570170616      *RFS167932 - Starts
067580170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
067590170616   ¦  *                           IS GREATER THAN WS-CURYTDSTRDTE
067600170616   ¦          IF ld_SelectDateCurr
067610170616   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
067620040921      *RFS167932 - Ends
067630040921   ¦             ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
067640040921   ¦             ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
067650021203   ¦          END-IF
067660170616   ¦
067670170616      *RFS167932 - Starts
067680170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
067690170616   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067700170616   ¦          IF ld_SelectDateCurr
067710170616   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067720021203      *RFS167932 - Ends
067730021203   ¦           ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
067740040921   ¦           ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
067750040921R15022        END-IF
067760021202R22879     END-IF.
067770040921
067780040921R15022     IF WS-TRANS-TYPE = "TFE"
067790040921   ¦          ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
067800021203   ¦          ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
067810170616   ¦
067820170616      *RFS167932 - Starts
067830170616   ¦  *       IF PROCESS-DATE OF TRANS-REC
067840170616   ¦  *                           IS GREATER THAN WS-CURYTDSTRDTE
067850170616   ¦          IF ld_SelectDateCurr
067860170616   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
067870040921      *RFS167932 - Ends
067880040921   ¦             ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
067890040921   ¦             ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
067900021203   ¦          END-IF
067910170619   ¦
067920170619      *RFS167932 - Starts
067930170619   ¦  *       IF PROCESS-DATE OF TRANS-REC
067940170619   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067950170619   ¦          IF ld_SelectDateCurr
067960170619   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
067970040921      *RFS167932 - Ends
067980040921   ¦             ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
067990040921   ¦             ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR-EX
068000040921R15022        END-IF
068010021228R22879     END-IF.
068020021228
068030040921R15022      IF WS-TRANS-TYPE = "SEL"
068040040921   ¦           ADD  WS-GAIN-LOSS      TO WS-INV-DISP-GAIN-LOSS-INC
068050021228   ¦           ADD  WS-GAIN-LOSS-EX   TO WS-INV-DISP-GAIN-LOSS-INC-EX
068060170619   ¦
068070170619      *RFS167932 - Starts
068080170619   ¦  *        IF PROCESS-DATE OF TRANS-REC
068090170619   ¦  *                           IS GREATER THAN WS-CURYTDSTRDTE
068100170619   ¦           IF ld_SelectDateCurr
068110170619   ¦                              IS GREATER THAN WS-CURYTDSTRDTE
068120040921      *RFS167932 - Ends
068130040921   ¦              ADD WS-GAIN-LOSS     TO  WS-INV-DISP-GAIN-LOSS-YTD
068140040921   ¦              ADD WS-GAIN-LOSS-EX  TO  WS-INV-DISP-GAIN-LOSS-YTD-EX
068150021228   ¦           END-IF
068160170619   ¦
068170170619      *RFS167932 - Starts
068180170619   ¦  *        IF PROCESS-DATE OF TRANS-REC
068190170619   ¦  *                  IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
068200170619   ¦           IF ld_SelectDateCurr
068210170619   ¦                     IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
068220040921      *RFS167932 - Ends
068230040921   ¦              ADD WS-GAIN-LOSS    TO WS-INV-DISP-GAIN-LOSS-CUR
068240040921   ¦              ADD WS-GAIN-LOSS-EX TO WS-INV-DISP-GAIN-LOSS-CUR-EX
068250040921R15022         END-IF
068260011011R22879     END-IF.
068270990129
068280040921           IF CONTRIB-U
068290040921               ADD UNIT-AMT OF TRANS TO WS-UNITS-BOUGHT
068300040921R22879     END-IF.
068310990129
068320040921           IF REDEMPT-U
068330040921               ADD UNIT-AMT OF TRANS TO WS-UNITS-SOLD
068340990129R22879     END-IF.
068350050923
068360170619R29732     IF WS-LDA-MGMT-COM-CDE = "IAF"
068370170619167932*    AND PROCESS-DATE OF TRANS-REC > 19980801
068380990304167932     AND ld_SelectDateCurr         > 19980801
068390990305
068400990305                IF CONTRIBS-ONLY
068410990305                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-PUR-INCEPT
068420990305                END-IF
068430990304
068440990304                IF CONTRIB-U
068450990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-BOUGHT
068460990304                END-IF
068470990305
068480990305                IF REDEMPTS-ONLY
068490990305                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-RED-INCEPT
068500990305                END-IF
068510990304
068520990304                IF REDEMPT-U
068530990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-SOLD
068540990304                END-IF
068550990315
068560990315                IF REDEMPTION-TRANSACTION
068570990316                   INITIALIZE WS-TRN-BOOK-VALUE
068580990315                   MULTIPLY AVERAGE-UNIT-COST OF
068590990315                            TRANS-REC BY UNIT-AMT
068600990316                            OF TRANS-REC
068610990315                            GIVING WS-TRN-BOOK-VALUE ROUNDED
068620990315                   ADD WS-TRN-BOOK-VALUE TO WS-P-AUG-BOOK-VALUE
068630990315                END-IF
068640990304
068650990304                IF INTEREST
068660990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-INT-INCEPT
068670990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
068680990304                END-IF
068690990304
068700990304                IF INCOME
068710990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-INC-INCEPT
068720990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
068730990304                END-IF
068740990304
068750990304                IF CAPITAL-GAIN
068760990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-CPG-INCEPT
068770990304                   ADD UNIT-AMT OF TRANS TO WS-AUG-UNITS-DIV
068780990304                END-IF
068790001123
068800001123                IF CAPITAL-LOSS
068810001123                   SUBTRACT GROSS-AMT OF TRANS
068820001123                   FROM WS-AUG-INV-CPG-INCEPT
068830001123                   SUBTRACT UNIT-AMT OF TRANS FROM WS-AUG-UNITS-DIV
068840001123                END-IF
068850990304
068860990304                IF TRANSFER-IN-ONLY
068870990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-TRI-INCEPT
068880990304                END-IF
068890990304
068900990304                IF TRANSFER-OUT-ONLY
068910990304                   ADD GROSS-AMT OF TRANS TO WS-AUG-INV-TRO-INCEPT
068920990305                END-IF
068930990304            END-IF.
068940980624
068950980624           IF  WS-TRNCHG-SW   IS EQUAL TO  "Y"
068960980624               GO TO CP-0000-0020.
068970980624
068980980624           IF  WS-CC-RTECLS (CC) EQUAL TO  ZEROES
068990980624               GO TO CP-0000-0010.
069000980624
069010980624980514     IF  ORIGINAL-COST-IN
069020980624               COMPUTE WS-IN-AMT ROUNDED
069030980624                                        =  WS-IN-AMT
069040980624                                        +  (GROSS-AMT
069050980626                                            OF TRANS-REC
069060980624                                        /   WS-CC-RTECLS (CC)).
069070980624980514     IF  ORIGINAL-COST-OUT
069080980624               COMPUTE WS-OUT-AMT ROUNDED
069090980624                                        =  WS-OUT-AMT
069100980624                                        +  (GROSS-AMT
069110980626                                            OF TRANS-REC
069120980624                                        /   WS-CC-RTECLS (CC)).
069130980624           GO TO CP-0000-0020.
069140980624
069150980610       CP-0000-0010.
069160980610980514     IF  ORIGINAL-COST-IN
069170980610               ADD GROSS-AMT
069180980610                   OF TRANS-REC        TO  WS-IN-AMT.
069190980610           IF  ORIGINAL-COST-OUT
069200980610               ADD GROSS-AMT
069210000000                   OF TRANS-REC        TO  WS-OUT-AMT.
069220980624
069230000000       CP-0000-0020.
069240970115           IF  RRSP-CONTRIBUTION
069250000000           OR  RRSP-CONTRIBUTION-BPI
069260000000               ADD GROSS-AMT
069270990619                   OF TRANS-REC        TO  WS-INV-REG-CTB-CUR
069280000000               ADD WS-GROSS-AMT-EX     TO  WS-INV-REG-CTB-CUR-EX
069290990619               ADD GROSS-AMT
069300990619                   OF TRANS-REC        TO  WS-INV-REG-CTB-INCPT
069310090902               ADD WS-GROSS-AMT-EX     TO  WS-INV-REG-CTB-INCPT-EX.
069320970422
069330970422      *****
069340970422      *****    Accumulate the year-to-date totals, if applicable.
069350170619      *****
069360170619      *RFS167932 - Starts
069370170619      *    IF  PROCESS-DATE
069380170619      *        OF TRANS-REC  IS LESS THAN  WS-YTDSTRDTE
069390170619           IF  ld_SelectDateCurr
069400170619                             IS LESS THAN  WS-YTDSTRDTE
069410970422      *RFS167932 - Ends
069420970422               GO TO CP-0010.
069430970422
069440090902           IF  CAPITAL-GAIN
06945009090272750            AND (Edit_Stmdis_No OR
06946099061972750                 (Edit_Stmdis AND lc_NotionalTrnNo))
069470970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-CPG-YTD-EX
069480990619               ADD GROSS-AMT
069490001123                   OF TRANS-REC        TO  WS-INV-CPG-YTD.
069500001123           IF  CAPITAL-LOSS
069510001123               SUBTRACT WS-GROSS-AMT-EX   FROM  WS-INV-CPG-YTD-EX
069520001123               SUBTRACT GROSS-AMT
069530970422                   OF TRANS-REC           FROM  WS-INV-CPG-YTD.
069540090902           IF  INCOME
06955009090272750            AND (Edit_Stmdis_No OR
06956099061972750                 (Edit_Stmdis AND lc_NotionalTrnNo))
069570970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-INC-YTD-EX
069580970422               ADD GROSS-AMT
069590970422                   OF TRANS-REC        TO  WS-INV-INC-YTD.
069600090902           IF  INTEREST
069610090902                 AND (Edit_Stmdis_No OR
069620990619                      (Edit_Stmdis AND lc_NotionalTrnNo))
069630970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-INT-YTD-EX
069640970422               ADD GROSS-AMT
069650970422                   OF TRANS-REC        TO  WS-INV-INT-YTD.
069660990619           IF  CONTRIBS-ONLY
069670970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-PUR-YTD-EX
069680970422               ADD GROSS-AMT
069690970422                   OF TRANS-REC        TO  WS-INV-PUR-YTD.
069700090902           IF  REDEMPTS-ONLY
06971009090272750          OR (Edit_Stmdis AND DISTRIBUTION-ONLY AND
06972099061972750            UNIT-AMT OF TRANS = 0 AND UNIT-PRICE OF TRANS NOT = 0)
069730970422               ADD WS-GROSS-AMT-EX     TO  WS-INV-RED-YTD-EX
069740970422               ADD GROSS-AMT
069750970422                   OF TRANS-REC        TO  WS-INV-RED-YTD.
069760970422
069770970422       CP-0010.
069780000000           CONTINUE.
069790170619
069800000000       CP-EXIT.
069810051026           EXIT.
069820051026
069830051026R30514/
069840051026  ¦    COMPUTE-DISTRIBUTION-ROC.
069850170629  ¦
069860170629      *RFS167932 - Starts
069870170629           INITIALIZE ld_SelectDateROC
069880170629           IF lc-LdaSelectDate = "T" AND
069890170629              WS-LDA-STMT-CNFM-FLAG = "S"
069900170629              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDateROC
069910170629           ELSE
069920170629              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDateROC
069930170629           END-IF
069940170629      *RFS167932 - Ends
069950051026
069960051026  ¦        MOVE "Y"    TO WS-ROC-FOUND.
069970051026  ¦        MOVE ZEROS  TO WS-ROC-CALC-AMT.
069980051026  ¦        INITIALIZE  TRANS-ROC-APPLIED-REC.
069990051026  ¦        MOVE PLACEMENT-DATE OF TRANS-REC
070000051026  ¦                     TO PLACEMENT-DATE OF TRANS-ROC-APPLIED-REC.
070010051026  ¦        MOVE TRANS-NO       OF TRANS-REC
070020051026  ¦                     TO TRANS-NO       OF TRANS-ROC-APPLIED-REC.
070030051026  ¦        MOVE WS-IC-CURR (IC)
070040051026  ¦                     TO CURRENCY-DDS   OF TRANS-ROC-APPLIED-REC.
070050051026  ¦
070060051026  ¦        READ TRANS-ROC-APPLIED
070070051026  ¦           INVALID KEY
070080051026  ¦             MOVE "N"  TO WS-ROC-FOUND
070090051026  ¦             GO TO CDR-EXIT
070100051026  ¦        END-READ.
070110051026  ¦
070120051026  ¦        COMPUTE WS-ROC-CALC-AMT = GROSS-AMT OF TRANS-REC
070130051026  ¦                                - TOTAL-ROC-ADJUSTED
070140051026  ¦                                  OF TRANS-ROC-APPLIED-REC.
070150051026  ¦
070160051026  ¦   **  Calculate the ROC since INCEPT, YTD, and CUR.
070170051028  ¦
070180051028  ¦        IF WS-LDA-REPORT-ROC IS NOT EQUAL TO "Y"
070190051028  ¦           GO TO CDR-EXIT
070200051028  ¦        END-IF.
070210051104  ¦
070220051026  ¦        ADD WS-ROC-CALC-AMT     TO WS-INV-ROC-INCEPT.
070230170619  ¦
070240170629
070250170619      *RFS167932 - Starts
070260170619  ¦   *    IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
070270051026  ¦        IF ld_SelectDateROC          > WS-CURYTDSTRDTE
070280051104  ¦           ADD WS-ROC-CALC-AMT  TO WS-INV-ROC-YTD
070290051026  ¦        END-IF.
070300170619  ¦
070310170619  ¦   *    IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
070320170619  ¦        IF ld_SelectDateROC          >= WS-LDA-STRDTE
070330051026      *RFS167932 - Ends
070340051026  ¦           ADD WS-ROC-CALC-AMT  TO WS-INV-ROC-CUR
070350051026  ¦        END-IF.
070360051026  ¦
070370051026  ¦   **********
070380051026  ¦
070390051026  ¦    CDR-EXIT.
070400051026  ¦        EXIT.
070410051026  v
070420000000R30514**********
070430000000      /
070440000000       ACCUM-CONTRIB-WITHDRAW.
070450000000      ******************************************************************
070460000000      *                                                                *
070470000000      *    A C C U M   C O N T R I B   /   W I T H D R A W   R T N .   *
070480000000      *                                                                *
070490990616      ******************************************************************
070500990616           IF  RRSP-CONTRIBUTION
070510990615           OR  RRSP-CONTRIBUTION-BPI
070520990615               GO TO ACW-0005.
070530990615
070540990615           IF TRANS-ORIGIN-CODE OF TRANS-REC IS EQUAL TO "EEC"
070550990615              ADD GROSS-AMT OF TRANS-REC TO WS-EEC-TOTAL.
070560990615
070570990615           IF TRANS-ORIGIN-CODE OF TRANS-REC IS EQUAL TO "ERC"
070580990615              ADD GROSS-AMT OF TRANS-REC TO WS-ERC-TOTAL.
070590990615
070600990615       ACW-0005.
070610970206
070620970206      *****
070630970206      *****    Determine if processing a RRSP Contribution.
070640970206      *****
070650180521
070660180521      *RFS178765 -Starts
070670180521           MOVE TRADE-DATE OF TRANS      TO ln_TradeDate.
070680180521           MOVE INVESTMENT-CODE OF TRANS TO lc_Investment_Code.
070690180521           PERFORM GET-EXCHANGE-RATE THRU GER-EXIT.
070700180521      *RFS178765 -Ends
070710970206
070720970206           IF  RRSP-CONTRIBUTION
070730970206           OR  RRSP-CONTRIBUTION-BPI
070740970206               GO TO ACW-0010.
070750970206
070760970206      *****
070770970206      *****    Determine if processing a Withdrawal.
070780030702      *****
070790030702
070800030702           IF  WITHDRAWAL OR
070810030702R17767        TRANSFER-OUT-ONLY OR
070820030702  ¦           (SWITCHES-OUT AND SWITCH-DIFF-ACCT)
070830030702  V            GO TO ACW-0030
070840970206R17767     END-IF.
070850970206
070860970206      *****
070870970206      *****    Not processing a RRSP Contribution or a Withdrawal,
070880970206      *****    therefore exit.
070890970206      *****
070900970206
070910970206           GO TO ACW-EXIT.
070920970206
070930970206       ACW-0010.
070940970206
070950970206      *****
070960970206      *****    Processing a RRSP Contribution.  If the request covers
070970970206      *****    multiple years, always accumulate to the remainder of the
070980970206      *****    year total.
070990970206      *****
071000980521
071010980521           IF  WS-LDA-STRDTE-YY  EQUAL TO  WS-LDA-ENDDTE-YY
071020980521               GO TO ACW-0010-0010.
071030180712
071040180712      *RFS178202 - Starts
071050180712      *****    Processing a RRSP Contribution.  If the request covers
071060180712      *****    multiple years,Accumulate the RRSP Contribution to either
071070180712      *****    the first 60 days of the statement period end year total
071080180712      *****    or the remainder of the statement period end year total,
071090180712      *****    based on the contribution code. Keep EEC and ERC
071100180712      *****    calculation same as exist.
071110180717
071120180712      *    ADD GROSS-AMT
071130180712      *        OF TRANS-REC            TO  WS-REMAINDER.
071140180712      *    ADD WS-GROSS-AMT-EX         TO  WS-REMAINDER-EX.
071150180712           IF (RRSP-CONTRIBUTION     AND
071160180712               WS-CONTR-REDEM-YY-2 = WS-LDA-ENDDTE-YY)
071170180712           OR (RRSP-CONTRIBUTION-BPI AND
071180180712               WS-CONTR-REDEM-YY-3 = WS-LDA-ENDDTE-YY)
071190180712               IF  FIRST-60
071200180712               OR  FIRST-60-BPI
071210180712                   ADD GROSS-AMT
071220180712                       OF TRANS-REC            TO  WS-1ST-60
071230180712                   ADD WS-GROSS-AMT-EX         TO  WS-1ST-60-EX
071240180712               ELSE
071250180712                   ADD GROSS-AMT
071260180712                       OF TRANS-REC            TO  WS-REMAINDER
071270180712                   ADD WS-GROSS-AMT-EX         TO  WS-REMAINDER-EX
071280180712               END-IF
071290180712           END-IF.
071300180521      *RFS178202 - Ends
071310980521
071320980521           IF  TRANS-ORIGIN-CODE
071330180521               OF TRANS-REC   IS EQUAL TO  "EEC"
071340180521      *RFS178765 -Starts
071350180521      *        ADD GROSS-AMT
071360180521      *            OF TRANS-REC        TO  WS-EEC-REMAINDER.
071370180521               INITIALIZE  ln_TempGross
071380180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
071390180521                                        ln_ExchangeRate
071400180521               ADD ln_TempGross        TO  WS-EEC-REMAINDER.
071410980521      *RFS178765 - Ends
071420980521           IF  TRANS-ORIGIN-CODE
071430180521               OF TRANS-REC   IS EQUAL TO  "ERC"
071440180521      *RFS178765 -Starts
071450180521      *        ADD GROSS-AMT
071460180521      *            OF TRANS-REC        TO  WS-ERC-REMAINDER.
071470180521               INITIALIZE  ln_TempGross
071480180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
071490180521                                        ln_ExchangeRate
071500180521               ADD ln_TempGross        TO  WS-ERC-REMAINDER.
071510980521      *RFS178765 - Ends
071520980521           GO TO ACW-0020.
071530980521
071540970206       ACW-0010-0010.
071550970206
071560970206      *****
071570970206      *****    The request is for a specific year.  If the year of the
071580970206      *****    contribution code is not the same as the requested year,
071590970206      *****    do not accumulate the contribution.
071600970206      *****
071610970206
071620970206           IF  RRSP-CONTRIBUTION
071630971024           AND WS-CONTR-REDEM-YY-2
071640970206                          IS NOT EQUAL TO  WS-LDA-STRDTE-YY
071650970206               GO TO ACW-0020.
071660970206
071670970206           IF  RRSP-CONTRIBUTION-BPI
071680971024           AND WS-CONTR-REDEM-YY-3
071690970206                          IS NOT EQUAL TO  WS-LDA-STRDTE-YY
071700970206               GO TO ACW-0020.
071710970206
071720970206      *****
071730970206      *****    The year of the contribution code is for the requested
071740970206      *****    year.  Accumulate the RRSP Contribution to either the
071750970206      *****    first 60 days of the year total or the remainder of the
071760970206      *****    year total, based on the contribution code.
071770970206      *****
071780970206
071790970206           IF  FIRST-60
071800980521           OR  FIRST-60-BPI
071810980521               GO TO ACW-0010-0020.
071820980521
071830980521           ADD GROSS-AMT
071840990619               OF TRANS-REC            TO  WS-REMAINDER.
071850980521           ADD WS-GROSS-AMT-EX         TO  WS-REMAINDER-EX.
071860980521           IF  TRANS-ORIGIN-CODE
071870180521               OF TRANS-REC   IS EQUAL TO  "EEC"
071880180521      *RFS178765 -Starts
071890180521      *        ADD GROSS-AMT
071900180521      *            OF TRANS-REC        TO  WS-EEC-REMAINDER.
071910180521               INITIALIZE  ln_TempGross
071920180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
071930180521                                        ln_ExchangeRate
071940180521               ADD ln_TempGross        TO  WS-EEC-REMAINDER.
071950980521      *RFS178765 - Ends
071960980521           IF  TRANS-ORIGIN-CODE
071970180521               OF TRANS-REC   IS EQUAL TO  "ERC"
071980180521      *RFS178765 -Starts
071990180521      *        ADD GROSS-AMT
072000180521      *            OF TRANS-REC        TO  WS-ERC-REMAINDER.
072010180521               INITIALIZE  ln_TempGross
072020180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
072030180521                                        ln_ExchangeRate
072040180521               ADD ln_TempGross        TO   WS-ERC-REMAINDER.
072050980521      *RFS178765 - Ends
072060980521           GO TO ACW-0020.
072070980521
072080980521       ACW-0010-0020.
072090980521           ADD GROSS-AMT
072100990619               OF TRANS-REC            TO  WS-1ST-60.
072110980521           ADD WS-GROSS-AMT-EX         TO  WS-1ST-60-EX.
072120980521           IF  TRANS-ORIGIN-CODE
072130180521               OF TRANS-REC   IS EQUAL TO  "EEC"
072140180521      *RFS178765 -Starts
072150180521      *        ADD GROSS-AMT
072160180521      *            OF TRANS-REC        TO  WS-EEC-1ST60.
072170180521               INITIALIZE  ln_TempGross
072180180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
072190180521                                        ln_ExchangeRate
072200180521               ADD ln_TempGross        TO  WS-EEC-1ST60.
072210980521      *RFS178765 - Ends
072220980521           IF  TRANS-ORIGIN-CODE
072230180521               OF TRANS-REC   IS EQUAL TO  "ERC"
072240180521      *RFS178765 -Starts
072250180521      *        ADD GROSS-AMT
072260180521      *            OF TRANS-REC        TO  WS-ERC-1ST60.
072270180521               INITIALIZE  ln_TempGross
072280180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
072290180521                                        ln_ExchangeRate
072300180521               ADD ln_TempGross        TO  WS-ERC-1ST60.
072310970206      *RFS178765 - Ends
072320970206
072330970206       ACW-0020.
072340970206            GO TO ACW-EXIT.
072350970206
072360970206       ACW-0030.
072370970206
072380970206      *****
072390970206      *****    Processing a withdrawal.  If it is a RRIF Minimum or a
072400970206      *****    Tax Withdraw, accumulate it to the withdrawals total.
072410970206      *****
072420060621
072430041216R24058     IF  WS-CONTR-REDEM-CODE-RULE IS EQUAL TO "26"
072440970422R24058     OR  WS-CONTR-REDEM-CODE-RULE IS EQUAL TO "27"
072450970422               GO TO ACW-0040.
072460970422
072470970422           GO TO ACW-EXIT.
072480970422
072490970422       ACW-0040.
072500971024      *RFS1003368 -Starts
072510970422
072520970422           MOVE TRADE-DATE      OF TRANS TO ln_TradeDate.
072530970422           MOVE INVESTMENT-CODE OF TRANS TO lc_Investment_Code.
072540970422           PERFORM GET-EXCHANGE-RATE THRU GER-EXIT.
072550970422
072560970422           IF  TRADE-DATE
072570970422               OF TRANS-REC NOT LESS THAN  WS-LDA-STRDTE
072580180521               INITIALIZE  ln_TempGross
072590180521               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS-REC /
072600180521                                             ln_ExchangeRate
072610180521               ADD ln_TempGross        TO  WS-WITHDRAWALS.
072620180521      *        ADD GROSS-AMT
072630180521      *            OF TRANS-REC        TO  WS-WITHDRAWALS.
072640180521
072650180521           IF  TRADE-DATE
072660000000               OF TRANS-REC  GREATER THAN  WS-YTDSTRDTE
072670000000               INITIALIZE  ln_TempGross
072680000000               COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS-REC /
072690041216                                             ln_ExchangeRate
072700041216               ADD ln_TempGross        TO  WS-WITHDRAWALS-YTD.
072710041216      *        ADD GROSS-AMT
072720041216      *            OF TRANS-REC        TO  WS-WITHDRAWALS-YTD.
072730051003      *RFS178765 -Starts
072740051003      *    MOVE TRADE-DATE OF TRANS      TO ln_TradeDate.
072750051003      *    MOVE INVESTMENT-CODE OF TRANS TO lc_Investment_Code.
072760051003      *    PERFORM GET-EXCHANGE-RATE THRU GER-EXIT.
072770051003      *    COMPUTE  WS-WITHDRAWALS   = WS-WITHDRAWALS / ln_ExchangeRate.
072780051003      *    COMPUTE  WS-WITHDRAWALS-YTD =WS-WITHDRAWALS-YTD  /
072790051003      *                                 ln_ExchangeRate.
072800051003      *RFS178765 -Ends
072810051003
072820051003      *RFS1003368 -Ends
072830051003       ACW-EXIT.
072840051003           EXIT.
072850051003
072860051003R24058 GET-CONTR-REDEM-RULE.
072870051003   ¦
072880051003   ¦
072890051003R14153*****
072900051003  ¦   *****    Retrieve the Contr-Redem-Code-Rules.
072910051003  ¦   *****
072920051003  ¦
072930041216  ¦        MOVE SPACES                 TO WS-CONTR-REDEM-CODE-RULE.
072940041216  ¦
072950041216  ¦        IF WS-CRC-LST NOT GREATER THAN  ZEROES
072960041216  ¦           GO TO GCRR-EXIT
072970010305  ¦        END-IF.
072980010305  ¦
072990010305  ¦        SET CRC TO 1.
073000010305  ¦        SEARCH WS-CONTR-REDEM-ENT VARYING CRC
073010010305  ¦           AT END
073020010305  ¦           MOVE SPACES                TO WS-CONTR-REDEM-CODE-RULE
073030010305  ¦           WHEN (WS-CRC-ACCTYPCODE (CRC) = ACACTYP)
073040170615  ¦            AND (WS-CRC-REDEMCODE (CRC)  = WS-CONTR-REDEM-CODE)
073050170615  ¦           MOVE WS-CRC-REDEMRULE (CRC) TO WS-CONTR-REDEM-CODE-RULE
073060170621  v           GO TO GCRR-EXIT
073070170619R14153     END-SEARCH.
073080170615
073090170615   ¦   GCRR-EXIT.
073100170615   ¦        EXIT.
073110170615   v
073120170615R24058**********
073130180521
073140180521RF8633******************************************************************
073150180521      *    ACCUMULATE ALL FEE TRANSACTIONS TO PROFESSIONAL FEE.        *
073160180521      ******************************************************************
073170180521
073180180521       GET-PROFESSIONAL-FEE.
073190180521
073200180521      *RFS167932 - Starts
073210180521           INITIALIZE ld_SelectDateFee.
073220180521           IF lc-LdaSelectDate =  "T"  AND
073230180521              WS-LDA-STMT-CNFM-FLAG = "S"
073240180521              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDateFee
073250170615           ELSE
073260170615              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDateFee
073270170615           END-IF.
073280170615      *RFS167932 - Ends
073290170615
073300180521      *RFS178765 -Starts
073310180521           MOVE TRADE-DATE OF TRANS      TO ln_TradeDate.
073320180521           MOVE INVESTMENT-CODE OF TRANS TO lc_Investment_Code.
073330180521           PERFORM GET-EXCHANGE-RATE THRU GER-EXIT.
073340180521      *    ADD GROSS-AMT OF TRANS
073350180521      *                               TO WS-PROFESSIONAL-FEE-INCEPT.
073360180521           INITIALIZE  ln_TempGross
073370180521           COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
073380010315                                        ln_ExchangeRate
073390010315           ADD ln_TempGross        TO  WS-PROFESSIONAL-FEE-INCEPT.
073400170615      *RFS178765 -Ends
073410170615      *RFS167932 - Starts
073420170615      *    IF PROCESS-DATE OF TRANS-REC
073430170615      *                           IS GREATER THAN WS-CURYTDSTRDTE
073440170615           IF ld_SelectDateFee    IS GREATER THAN WS-CURYTDSTRDTE
073450170615      *RFS167932 - Ends
073460180521      *RFS178765 -Starts
073470180521      *       ADD GROSS-AMT OF TRANS
073480180521      *                           TO WS-PROFESSIONAL-FEE-YTD
073490180521           INITIALIZE  ln_TempGross
073500180521           COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
073510180521                                        ln_ExchangeRate
073520180521           ADD ln_TempGross        TO  WS-PROFESSIONAL-FEE-YTD
073530180521      *RFS178765 -Ends
073540010315           END-IF
073550010305
073560010305      *RFS167932 - Starts
073570010305R14317*    IF PROCESS-DATE OF TRANS-REC
073580010305R14317*                   IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
073590010305           IF ld_SelectDateFee
073600010305                          IS GREATER THAN OR EQUAL TO WS-LDA-STRDTE
073610010305      *RFS167932 - Ends
073620010305      *RFS178765 -Starts
073630010305      *       ADD GROSS-AMT OF TRANS
073640011002      *                        TO WS-PROFESSIONAL-FEE-CUR
073650021202           INITIALIZE  ln_TempGross
073660011002           COMPUTE ln_TempGross ROUNDED = GROSS-AMT OF TRANS /
073670011002                                        ln_ExchangeRate
073680011002           ADD ln_TempGross        TO  WS-PROFESSIONAL-FEE-CUR
073690011002      *RFS178765 -Ends
073700011002           END-IF.
073710011002
073720010305    **********
073730011002
073740011002       GPF-EXIT.
073750011002           EXIT.
073760011002
073770011002    **********
073780011002    *** End RF8633
073790011002
073800011002      /
073810020923R11127 GET-TAXABLE-EVENT-IND.
073820011002
073830030605      ******************************************************************
073840030605      *                                                                *
073850030605      *  F U N D   T A X A B L E   E V E N T  I N D I C A T O R        *
073860030605      *                                                                *
073870030605      ******************************************************************
073880030605
073890030605      *****
073900030605      *****    To determine if a SELL or SWO is a disposition, the
073910030605      *****    Taxable Event Codes table need to be checked. Only
073920030605      *****    entries in this table with a Taxable Event Indicator
073930030605      *****    = "N" are not dispositions.
073940030605      *****
073950030605
073960030605           MOVE SPACES                 TO  WS-TAXABLE-EVENT-INDICATOR.
073970110325R14556     MOVE SPACES                 TO  WS-TRANSFER-AT-AVERAGE-IND.
073980110325
073990030605R17542*****
074000030605   ¦  *****    For TRI, the target (TRO) will be retrieved to get the
074010030605   ¦  *****    TRANSFER-AT-AVERAGE flag. Because TAXABLE-EVENT table
074020030605   ¦  *****    was not set up for TRI.
074030030605   ¦  *****
074040030605   ¦
074050030605   ¦       IF TRANSFER-IN
074060030605   ¦          INITIALIZE ACCOUNT-REC
074070030605   ¦          MOVE ACCOUNT-NO OF TRANS-T-REC
074080030605   ¦                               TO ACCOUNT-NO OF ACCOUNT-REC
074090030605   ¦          READ ACCOUNT
074100030605   ¦             INVALID KEY
074110011002   ¦               INITIALIZE ACCOUNT-REC
074120011002   ¦               MOVE SPACES     TO ACCOUNT-TYPE-CODE OF ACCOUNT-REC
074130011002R88823             MOVE ZEROS      TO ACCOUNT-NO OF ACCOUNT-REC
074140011002R88823             MOVE ZEROS      TO INVESTOR-NO OF ACCOUNT-REC
074150011002   ¦          END-READ
074160011002   ¦
074170011002   ¦          MOVE SPACES                 TO  TAXABLE-EVENT-RECD
074180011002   ¦          MOVE ACCOUNT-TYPE-CODE OF ACCOUNT-REC
074190011002   ¦                    TO  ACCOUNT-TYPE-CODE OF TAXABLE-EVENT-RECD
074200030605   ¦          MOVE CONTR-REDEM-CODE  OF TRANS-T-REC
074210030605   ¦                    TO  CONTR-REDEM-CODE OF TAXABLE-EVENT-RECD
074220011002   ¦          MOVE TRANS-TYPE-CODE   OF TRANS-T-REC
074230011002   ¦                    TO  TRANS-TYPE-CODE OF TAXABLE-EVENT-RECD
074240011002   v          GO TO CYTDD-READ
074250011002R17542     END-IF.
074260011002
074270011002           MOVE SPACES                 TO  TAXABLE-EVENT-RECD.
074280011002           MOVE ACACTYP                TO  ACCOUNT-TYPE-CODE
074290020923                                           OF TAXABLE-EVENT-RECD.
074300020923           MOVE CONTR-REDEM-CODE
074310020923                OF TRANS-REC           TO  CONTR-REDEM-CODE
074320020923                                           OF TAXABLE-EVENT-RECD.
074330020923           MOVE TRANS-TYPE-CODE
074340020923                OF TRANS-REC           TO  TRANS-TYPE-CODE
074350020923                                           OF TAXABLE-EVENT-RECD.
074360020923R17542 CYTDD-READ.
074370020923
074380020923           READ TAXABLE-EVENT
074390020923               INVALID KEY
074400011002                   MOVE SPACES         TO  TAXABLE-EVENT-RECD
074410011002                   MOVE "D"            TO  WS-TAXABLE-EVENT-INDICATOR
074420011002                   GO TO CYTDD-EXIT
074430011002           END-READ.
074440011002
074450011002           IF SWITCHES-OUT OR SEL-ONLY
074460011002              MOVE TAXABLE-EVENT-INDICATOR OF TAXABLE-EVENT-RECD
074470000000                                       TO  WS-TAXABLE-EVENT-INDICATOR
074480020131           END-IF.
074490020131
074500020131           IF TRANSFER-IN OR TRANSFER-OUT
074510020131              MOVE TRANSFER-AT-AVERAGE OF TAXABLE-EVENT-RECD
074520020131                                  TO  WS-TRANSFER-AT-AVERAGE-IND
074530020131           END-IF.
074540020131
074550020131
074560020131    **********
074570020131
074580020131       CYTDD-EXIT.
074590030624             EXIT.
074600030910
074610020131r11127********
074620020131
074630020131      /
074640020131R12102 POPULATE-PHANTOM-FUND-NUMBER.
074650030521
074660030521      ******************************************************************
074670030624      *                                                                *
074680030624      *  G E T     P H A N T O M     F U N D     N U M B E R           *
074690030624      *                                                                *
074700040105      ******************************************************************
074710030912
074720030912      *****
074730030912           MOVE PLACEMENT-DATE  OF TRANS-REC   TO  WS-PLACEMENT-DATE.
074740030912           MOVE TRANS-NO        OF TRANS-REC   TO  WS-TRANS-NO.
074750030910R16881     MOVE "S"                          TO WS-PH-MODE.
074760020131R16881     MOVE TRANS-TYPE-CODE OF TRANS-REC TO WS-PH-TRANS-TYPE.
074770020131
074780030625           CALL "PHANTOMFND"  USING
074790020131                              WS-PLACEMENT-DATE
074800020131                              WS-TRANS-NO
074810020131R17130                        WS-PROCESS-SEQUENCE
074820020131R17130                        WS-TOTAL-ALLOC-TO-PROC
074830020131                              WS-PHANTOM-FUND-NUMBER
074840020131R16881                        WS-PH-MODE
074850020131   ¦                          WS-PH-TRANS-TYPE
074860020131                              WS-ACCT-CHG
074870020131R17891                        WS-DEALER-PROCESS-SEQ
074880020131   |                          WS-DEALER-TOTAL-AA-PROC
074890020131   |                          WS-INTERM-PROCESS-SEQ
074900000000   V                          WS-INTERM-TOTAL-AA-PROC
074910000000R17495                        WS-DECLARE-PHANTOMFND.
074920000000
074930000000           IF WS-PHANTOM-FUND-NUMBER  IS NOT EQUAL TO SPACES
074940000000              MOVE WS-PHANTOM-FUND-NUMBER  TO WS-AT-PHANTOM-FUND-NUMBER
074950000000              MOVE WS-PHANTOM-FUND-NUMBER  TO WS-AD-PHANTOM-FUND-NUMBER
074960000000           END-IF.
074970000000
074980000000    **********
074990980624
075000970108        PPFN-EXIT.
075010970108             EXIT.
075020970108
075030970108R12102********
075040970108
075050991004      /
075060991004       LEVEL-REINIT-1.
075070991004
075080000000      ******************************************************************
075090000000      *                                                                *
075100000000      *    L E V E L   R E I N I T I A L I Z A T I O N   1   R T N .   *
075110000000      *                                                                *
075120990517      *        INVESTMENT-CODE                                         *
075130980624      *                                                                *
075140970424      ******************************************************************
075150971223
075160990619      *****
075170970422      *****    If the account being processed is to be bypassed, exit.
075180970422      *****
075190970422
075200990619           IF  WS-LR2BYP-SW   IS EQUAL TO  "Y"
075210990619               GO TO LR1-EXIT
075220990619           END-IF
075230990619
075240990619      *****
075250990619      *****    Initialize the level accumulators.
075260990619      *****
075270990619
075280990619           MOVE ZEROES                 TO  WS-PTRANS-PROCESS-DATE.
075290990619           MOVE ZEROES                 TO  WS-ACB-UNIT-PRICE-BASE.
075300990619           MOVE ZEROES                 TO  WS-ACB-UNITS-TRANSACTED.
075310990619           MOVE ZEROES                 TO  WS-INV-CPG.
075320990619
075330970516           MOVE ZEROES                 TO  WS-INV-CPG-YTD.
075340970423           MOVE ZEROES                 TO  WS-INV-INC-YTD.
075350970423           MOVE ZEROES                 TO  WS-INV-INT-YTD.
075360970423           MOVE ZEROES                 TO  WS-INV-PUR-YTD.
075370971024           MOVE ZEROES                 TO  WS-INV-RED-YTD.
075380990619           MOVE ZEROES                 TO  WS-INV-REG-CTB-CUR.
075390990619           MOVE ZEROES                 TO  WS-INV-REG-CTB-INCPT.
075400970423
075410970423           MOVE ZEROES                 TO  WS-INV-CPG-YTD-EX.
075420970423           MOVE ZEROES                 TO  WS-INV-INC-YTD-EX.
075430990125           MOVE ZEROES                 TO  WS-INV-INT-YTD-EX.
075440990125           MOVE ZEROES                 TO  WS-INV-PUR-YTD-EX.
075450980604           MOVE ZEROES                 TO  WS-INV-RED-YTD-EX.
075460990125           MOVE ZEROES                 TO  WS-INV-REG-CTB-CUR-EX.
075470990125           MOVE ZEROES                 TO  WS-INV-REG-CTB-INCPT-EX.
075480990125
075490990618           MOVE ZEROES                 TO  WS-INV-MVP.
075500990813           MOVE ZEROES                 TO  WS-INV-NRTAX-CUR.
075510990125           MOVE ZEROES                 TO  WS-INV-NRTAX-INC.
075520041216           MOVE ZEROES                 TO  WS-INV-NRTAX-YTD.
075530041216           MOVE ZEROES                 TO  WS-INV-OPNMKTVAL.
075540990618
075550990618
075560000000           MOVE ZEROES                 TO  WS-INV-WHTAX-CUR.
075570000000           MOVE ZEROES                 TO  WS-INV-WHTAX-INC.
075580990305           MOVE ZEROES                 TO  WS-INV-WHTAX-YTD.
075590000000           MOVE ZEROES                 TO  WS-INV-WHTAX-PRV.
075600001110           MOVE ZEROES                 TO  WS-INV-TINCOME-PRV.
075610001113           MOVE "N"                    TO  WS-INVAUC-SW.
075620000000           MOVE ZEROES                 TO  WS-IN-AMT.
075630990305           MOVE ZEROES                 TO  WS-OUT-AMT.
075640000000           MOVE ZEROES                 TO  WS-ORIGIN-COST-F.
075650990305           MOVE ZEROES                 TO  WS-CERT-UNITS.
075660990125           MOVE "Y"                    TO  WS-BKVAL-SW.
075670990125
075680990125R24058     MOVE ACACTYP                TO  WS-ACCOUNT-TYPE-CODE.
075690990304
075700990304           MOVE CERT-UNITS OF ACCOUNT-INVESTMENT-REC
075710990304                                       TO  WS-CERT-UNITS.
075720200928           INITIALIZE           WS-MARKET-START
075730200928      *RFS1104542 STarts *
075740200928                                WS-MARKET-START-EX
075750990517      *RFS1104542 Ends   *
075760990517                                WS-CURR-UNIT-BAL
075770990517                                WS-AUG-UNIT-BAL
075780990530                                WS-BOOK-TOTAL-INV
075790000117RF8359                          WS-BOOK-VALUE-US
075800000117RF8359                          WS-BOOK-VALUE-CND
075810000118                                WS-BOOK-FGN-INV
075820000117                                WS-AUG-BOOK-VALUE
075830031003                                WS-LAST-ACB-PRICE
075840031003                                WS-AUG-ACB-PRICE
075850031003                                WS-UNITS-BOUGHT
075860161208                                WS-UNITS-SOLD
075870180201                                WS-UNITS-DIV
075880000000                                WS-AUG-UNITS-BOUGHT
075890161101                                WS-AUG-UNITS-SOLD
075900161101                                WS-AUG-UNITS-DIV
075910171017                                WS-INV-MKT-VALUE-LAST-YE
075920000000                                WS-PRV-CLOSING-UNIT-BAL
075930980309                                WS-TEMP-CLOSING-UNIT-BAL
075940020131                                WS-UNIT-PRICE-LAST-YEND
075950020920                                WS-ACCOUNT-INVESTMENT-TOTALS
075960031216RF6234                          WS-IUP-OPENING-PRICE
075970171004                                WS-IUP-DATE
075980171004                                WS-IUP-CLOSING-PRICE
075990171004R17527                          WS-IUP-LASTYEND-PRICE
076000171004   ¦                            WS-NO-OF-UNITS-CURR
076010171004R17527                          WS-NET-AMOUNT-CURR.
076020171004164374     INITIALIZE           WS-INV-SAJ-INCEPT.
076030970428177079     INITIALIZE           ln_GrossAmount.
076040031007           MOVE "N"          TO WS-WRITE-INVESTMENT-LEVEL.
076050970428156507     MOVE "N"          TO WS-WRITE-INVEST-SEC79.
076060970428156507     MOVE "N"          TO WS-KEY-INFO-FILL.
076070000120172229     MOVE "N"          TO WS-WRITE-INVEST-CWT.
076080000118           MOVE "N"          TO WS-TXNS-IN-RANGE.
076090000119           MOVE SPACES                 TO  WS-MFATRNP-KEYLST.
076100000118R12102     MOVE SPACES                 TO  WS-AD-PHANTOM-FUND-NUMBER.
076110000118R14920     MOVE SPACES                 TO  WS-AT-PHANTOM-FUND-NUMBER.
076120000119R18832     MOVE WS-LDA-ENDDTE          TO  WS-LDA-ENDDTE-SV.
076130000119      ** RFS171359 - Start **
076140000119           MOVE WS-LDA-ROR-FLAG             TO pc_Report_ROC
076150000119           MOVE WS-LDA-INVESTOR-12          TO pc_Section12_Enabled
076160970423           MOVE lc_Edit_Stmdis              TO pc_Edit_Stmdis
076170970423           MOVE lb-LdaAccountAdditionalInfo TO pc_LDA-AAI
076180970423      ** RFS171359 - End   **
076190970423           SET IC                      TO  ICG.
076200970423R18485     MOVE II-LANGUAGE-CODE  TO  WS-IC-NAME-FLAG
076210970423           SET IG                      TO  IGG.
076220970423
076230991004      *****
076240991004      *****    Format the investment unit price for Opening,
076250970423      *****    Closing, and Last year end if it is a Mass run.
076260970423      *****
076270970423
076280970423RF6234     IF WS-LDA-REQUEST-SCOPE          IS EQUAL TO "A"
076290991004              PERFORM GET-OPEN-CLOSE-LAST-PRICE       THRU GIUP-EXIT
076300190806           END-IF
076310190806      * RFS1015600 - Begin
076320190806      *  For open bal, check if acct/inv only have 1 trans before open date
076330190806      *  Need to determine using process date or trade date to determine.
076340190806           INITIALIZE WS-ACCOUNT-NO-SUM WS-INVEST-CODE-SUM
076350190806             WS-ACC-INV-CLSUNIT-BAL-SUM WS-UNIT-AMT-SUM
076360191128             WS-UNIT-PRC-SUM WS-RES-AVG-UNIT-COST-SUM
076370191128      *RFS1020558-Starts
076380191128      *      WS-GRS-AMT-SUM WS-NET-AMT-SUM WS-SUM-CNT WS-SUM-CNT-STR.
076390191128             WS-GRS-AMT-SUM WS-NET-AMT-SUM WS-SUM-CNT WS-SUM-CNT-STR
076400191128             WS-UNIT-PRICE.
076410190806      *RFS1020558-Ends
076420190806             IF lc-LdaSelectDate = "T"
076430190806             EXEC SQL
076440190806              SELECT ACCOUNT_NO, INVESTMENT_CODE,
076450190806                     SUM(CLOSING_UNIT_BAL), SUM(UNIT_AMT),
076460190806                     SUM(UNIT_PRICE), SUM(RESULTANT_AVERAGE_UNIT_COST),
076470190806                     SUM(GROSS_AMT), SUM(NET_AMT), SUM(1)
076480190806                INTO :WS-ACCOUNT-NO-SUM, :WS-INVEST-CODE-SUM,
076490190806                     :WS-ACC-INV-CLSUNIT-BAL-SUM, :WS-UNIT-AMT-SUM,
076500190806                     :WS-UNIT-PRC-SUM, :WS-RES-AVG-UNIT-COST-SUM,
076510190806                     :WS-GRS-AMT-SUM, :WS-NET-AMT-SUM, :WS-SUM-CNT
076520190806                 FROM  MFATRNP
076530190806                 WHERE  Account_No     =  :CURR-ACCOUNT
076540190806                  AND  Investment_Code =  :CURR-INVESTMENT
076550190806                  AND  Trade_date      <= :WS-END-DTE-STMT
076560190806                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
076570190806                 Group by account_no, investment_code
076580190806             END-EXEC
076590190806
076600190806             EXEC SQL
076610190806              SELECT ACCOUNT_NO, INVESTMENT_CODE,
076620190806                     SUM(1)
076630190806                INTO :WS-ACCOUNT-NO-SUM, :WS-INVEST-CODE-SUM,
076640190806                     :WS-SUM-CNT-STR
076650190806                 FROM  MFATRNP
076660190806                 WHERE  Account_No     = :CURR-ACCOUNT
076670190919                  AND  Investment_Code = :CURR-INVESTMENT
076680190806                  AND  Trade_date      < :WS-STR-DTE-STMT
076690190806                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
076700190806                 Group by account_no, investment_code
076710191128             END-EXEC
076720191128      *RFS1020558-Starts
076730191128      *Get the unit price
076740191128             IF WS-SUM-CNT = 1
076750191128             EXEC SQL
076760191128              SELECT UNIT_PRICE
076770191128                INTO :WS-UNIT-PRICE
076780191128                 FROM MFATRNP
076790191128                 WHERE  Account_No     =  :CURR-ACCOUNT
076800191128                  AND  Investment_Code =  :CURR-INVESTMENT
076810191128                  AND  Trade_date      <= :WS-END-DTE-STMT
076820191128                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
076830191128                 FETCH FIRST ROW ONLY
076840191128             END-EXEC
076850191128             END-IF
076860190806      *RFS1020558-Ends
076870190806
076880190806             ELSE
076890190806             EXEC SQL
076900190806              SELECT ACCOUNT_NO, INVESTMENT_CODE,
076910190806                     SUM(CLOSING_UNIT_BAL), SUM(UNIT_AMT),
076920190806                     SUM(UNIT_PRICE), SUM(RESULTANT_AVERAGE_UNIT_COST),
076930190806                     SUM(GROSS_AMT), SUM(NET_AMT), SUM(1)
076940190806                INTO :WS-ACCOUNT-NO-SUM, :WS-INVEST-CODE-SUM,
076950190806                     :WS-ACC-INV-CLSUNIT-BAL-SUM, :WS-UNIT-AMT-SUM,
076960190806                     :WS-UNIT-PRC-SUM, :WS-RES-AVG-UNIT-COST-SUM,
076970190806                     :WS-GRS-AMT-SUM, :WS-NET-AMT-SUM, :WS-SUM-CNT
076980190806                 FROM  MFATRNP
076990190806                 WHERE  Account_No     =  :CURR-ACCOUNT
077000190806                  AND  Investment_Code =  :CURR-INVESTMENT
077010190806                  AND  Process_date    <= :WS-END-DTE-STMT
077020190806                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
077030190806                 Group by account_no, investment_code
077040190806             END-EXEC
077050190806
077060190806             EXEC SQL
077070190806              SELECT ACCOUNT_NO, INVESTMENT_CODE,
077080190806                     SUM(1)
077090190806                INTO :WS-ACCOUNT-NO-SUM, :WS-INVEST-CODE-SUM,
077100190806                     :WS-SUM-CNT-STR
077110190806                 FROM  MFATRNP
077120190806                 WHERE  Account_No     = :CURR-ACCOUNT
077130190806                  AND  Investment_Code = :CURR-INVESTMENT
077140190806                  AND  Process_date    < :WS-STR-DTE-STMT
077150190806                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
077160190806                 Group by account_no, investment_code
077170191128             END-EXEC
077180191128
077190191128      *RFS1020558-Starts
077200191128      *Get the unit price
077210191128             IF WS-SUM-CNT = 1
077220191128             EXEC SQL
077230191128              SELECT UNIT_PRICE
077240191128                INTO :WS-UNIT-PRICE
077250191128                 FROM MFATRNP
077260191128                 WHERE  Account_No     =  :CURR-ACCOUNT
077270191128                  AND  Investment_Code =  :CURR-INVESTMENT
077280191128                  AND  Process_date    <= :WS-END-DTE-STMT
077290191128                  AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
077300191128                 FETCH FIRST ROW ONLY
077310191128             END-EXEC
077320191128             END-IF
077330190806      *RFS1020558-Ends
077340190806             END-IF.
077350190806      * RFS1015600 - End
077360991004
077370991004      *****
077380991004      *****    Determine the currency of the investment.  If it is not
077390970423      *****    found, default to the base currency, set up in the
077400970423      *****    Initial-Logic routine.
077410991004      *****
077420991004
077430970423           IF  WS-CC-LST NOT GREATER THAN  ZEROES
077440970423               GO TO LR1-0000-0020
077450991004           END-IF
077460970423
077470970423           SET CC                      TO  1.
077480970423
077490991004       LR1-0000-0010.
077500171006
077510171006           IF  WS-CC-CODE (CC)   EQUAL TO  WS-IC-CURR (IC)
077520171006               GO TO LR1-0000-0030
077530171006           END-IF
077540171006
077550171011           IF  CC            IS LESS THAN  WS-CC-LST
077560171011               SET CC               UP BY  1
077570171012               GO TO LR1-0000-0010
077580171006           END-IF.
077590171006
077600171006       LR1-0000-0020.
077610171012
077620171017           SET CC                      TO  WS-CC-BSE.
077630171006
077640171006       LR1-0000-0030.
077650171006
077660171006      ** RFS171359 - Start **
077670171006           IF Lc_STMLTD = "Y"
077680171006              INITIALIZE ILT-Fields-Info
077690171006                         pn_Placement_Date
077700171006                         pn_Trans_No
077710171017                         pn_Trans_Arr_Count
077720171017                         pn_Start_Date
077730171017
077740171017              IF WS-LDA-INCEPT-TOT = "N"
077750171017                 MOVE WS-PTDSTRDTE  TO pn_Start_Date
077760171017              END-IF
077770171201
077780171201              MOVE "N"                      TO pc_Txns_In_Range
077790171201              MOVE WS-LDA-STRDTE            TO pn_End_Date
077800171201              MOVE ACACTNO                  TO pn_Account_No
077810171201              MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
077820171201                                            TO pc_Investment_Code
077830171201              MOVE "N"                      TO pn_Generate_Section80
077840171201              CALL "CWTINPLTD" using CWT-PARAMETERS,
077850171017                                     ILT-Fields-Info,
077860171017                                     ILT-TRANS-ARRAY
077870171010
077880171006              IF pd_First_Trade_Transaction <
077890171006                  WS-FIRST-TRADE-TRANSACTION
077900991004                  MOVE pd_First_Trade_Transaction
077910170622                    TO WS-FIRST-TRADE-TRANSACTION
077920170622              END-IF
077930170622      ** RFS175900 - Start **
077940010301              IF pd_First_Purchase_Date < WS-FIRST-PURCHASE-DATE
077950980521                MOVE pd_First_Purchase_Date TO WS-FIRST-PURCHASE-DATE
077960991004                INITIALIZE WS-IS2-BUY-FIRST-N
077970991004                           WS-IS2-TRI-FIRST-N
077980170614                           WS-IS2-SWI-FIRST-N
077990170622              END-IF
078000170622      ** RFS175900 - End   **
078010170622              PERFORM CALCULATE-RORTRNP-SUMMARY THRU CRS-EXIT
078020170622              MOVE pc_Txns_In_Range TO WS-TXNS-IN-RANGE
078030170622           END-IF.
078040170622      ** RFS171359 - End   **
078050980622
078060980622           INITIALIZE MFATRNP OF TRANS-REC.
078070980622           MOVE ACACTNO                TO  ACCOUNT-NO OF TRANS-REC.
078080010301           MOVE INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-REC
078090010301                                  TO  INVESTMENT-CODE OF TRANS-REC.
078100010301
078110010301           IF  WS-LDA-INCEPT-TOT EQUAL TO  "N"
078120170622               GO TO LR1-INCEPT-TOT-N
078130991004           END-IF
078140170622
078150170622           START TRANS
078160170622              KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
078170170622               INVALID KEY
078180170622               GO TO LR1-OPENING
078190991004           END-START
078200980622
078210980622           GO TO LR1-BAL-NEXT.
078220980622
078230991004       LR1-INCEPT-TOT-N.
078240170622      ***
078250170622      ***  WS-PTDSTRDTE was one year early than the End-date year of
078260170622      ***               Statement run date.
078270980624
078280980624           MOVE WS-PTDSTRDTE          TO PROCESS-DATE OF TRANS-REC.
078290980624
078300980624           START TRANS
078310980624                 KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
078320980624                 INVALID KEY
078330980624                   GO TO LR1-INCEPT-TOT-N-0001
078340980622           END-START
078350980622
078360980622           GO TO LR1-INCEPT-TOT-N-0002.
078370980622
078380991004       LR1-INCEPT-TOT-N-0001.
078390170622
078400170622           READ TRANS LAST RECORD
078410170622                   AT END
078420980624                    GO TO LR1-OPENING.
078430980624
078440980624           IF  INVESTMENT-CODE
078450980624               OF TRANS-REC  NOT EQUAL TO  INVESTMENT-CODE
078460980624                                           OF ACCOUNT-INVESTMENT-REC
078470980624           OR  ACCOUNT-NO
078480980624               OF TRANS-REC  NOT EQUAL TO  ACACTNO
078490980622               GO TO LR1-OPENING.
078500030213
078510030213           GO TO LR1-BAL-NEXT-0001.
078520030213
078530030213       LR1-INCEPT-TOT-N-0002.
078540030213
078550030213           READ TRANS PRIOR RECORD
078560030213                  AT END
078570030213                     GO TO LR1-INCEPT-TOT-N-0003.
078580030213
078590030213           IF  INVESTMENT-CODE
078600030213               OF TRANS-REC  NOT EQUAL TO  INVESTMENT-CODE
078610030213                                           OF ACCOUNT-INVESTMENT-REC
078620030213           OR  ACCOUNT-NO
078630030213               OF TRANS-REC  NOT EQUAL TO  ACACTNO
078640030213               GO TO LR1-INCEPT-TOT-N-0003.
078650030213
078660030213      *****
078670030213      *****  If the last transaction's REVERSE = "Y", bypass it and
078680030213      *****  get the prior record until REVERSE = "N".
078690030213      *****
078700030213
078710980622R16425     IF  REVERSE  OF TRANS-REC   IS EQUAL TO  "Y"
078720980622    |        INITIALIZE MFATRNP OF TRANS-REC
078730980622    |        MOVE ACACTNO           TO  ACCOUNT-NO OF TRANS-REC
078740980622    |        MOVE INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-REC
078750980622    |                               TO  INVESTMENT-CODE OF TRANS-REC
078760170622    |
078770170622    |        START TRANS
078780170622    |           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
078790170622    |            INVALID KEY
078800170622    |            GO TO LR1-OPENING
078810170622    |        END-START
078820170622    |
078830170622    |        GO TO LR1-BAL-NEXT
078840170622    |      END-IF.
078850170622R16425*****
078860170622
078870170622           GO TO LR1-BAL-NEXT-0001.
078880980622
078890000000       LR1-INCEPT-TOT-N-0003.
078900170622           INITIALIZE MFATRNP
078910170622                      OF TRANS-REC.
078920170622           MOVE ACACTNO                TO  ACCOUNT-NO
078930980622                                           OF TRANS-REC.
078940980622           MOVE INVESTMENT-CODE
078950000000                OF ACCOUNT-INVESTMENT-REC
078960000000                                       TO  INVESTMENT-CODE
078970000000                                           OF TRANS-REC.
078980000000           MOVE WS-PTDSTRDTE           TO  PROCESS-DATE
078990000000                                       OF TRANS-REC.
079000971128           START TRANS
079010171006           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
079020171016           INVALID KEY
079030171016             GO TO LR1-OPENING.
079040171006
079050180323       LR1-BAL-NEXT.
079060180323           READ TRANS NEXT RECORD
079070180323           AT END
079080180323           GO TO LR1-OPENING.
079090180323
079100180323       LR1-BAL-NEXT-0001.
079110180323           IF (ACCOUNT-NO OF TRANS IS NOT EQUAL ACACTNO) OR
079120180323           (INVESTMENT-CODE OF TRANS IS NOT EQUAL INVESTMENT-CODE
079130180323           OF ACCOUNT-INVESTMENT)
079140180323             GO TO LR1-OPENING
079150180323           END-IF.
079160180323
079170180323      ** RFS171359 - Start **
079180180323           IF Lc_STMLTD = "Y" AND
079190171006              PLACEMENT-DATE OF TRANS = pn_Placement_Date AND
079200171006              TRANS-NO OF TRANS =  pn_Trans_No
079210180626      * 1001329 - Begin
079220180626      * 1002905 - Begin:Comment out changes from 1001329 and add new
079230180626      *      IF PROCESS-DATE OF TRANS-REC IS <= WS-PRV-Y-END-DATE
079240180626      *        MOVE CLOSING-UNIT-BAL OF TRANS
079250180626      *         TO WS-TEMP-CLOSING-UNIT-BAL
079260180626      *      END-IF
079270180626      *      IF  PROCESS-DATE OF TRANS-REC IS > WS-PRV-Y-END-DATE
079280180626      *       AND WS-PTRANS-PROCESS-DATE IS <= WS-PRV-Y-END-DATE
079290180626      *           MOVE WS-PRV-CLOSING-UNIT-BAL
079300180626      *                      TO WS-TEMP-CLOSING-UNIT-BAL
079310180626      *      END-IF
079320180626      *      MOVE PROCESS-DATE OF TRANS-REC TO WS-PTRANS-PROCESS-DATE
079330180626      *      MOVE CLOSING-UNIT-BAL OF TRANS-REC
079340180626      *                          TO WS-PRV-CLOSING-UNIT-BAL
079350180626      * 1002905 - End
079360180626      * 1002905 - Begin
079370180626             PERFORM COMPUTE-AVG-COST-UNIT-BALANCE THRU CACUB-EXIT
079380980624      * 1002905 - End
079390080623      * 1001329 - End
079400980624              GO TO LR1-BAL-NEXT
079410030825           END-IF.
079420971128      ** RFS171359 - End   **
079430980527
079440031002      *****
079450041216      *****    Bypass the transaction if it does not posses a valid
079460041216      *****    status.
079470031002      *****
079480031002           MOVE CONTR-REDEM-CODE
079490031006                OF TRANS-REC           TO  WS-CONTR-REDEM.
079500031002R24058     MOVE CONTR-REDEM-CODE OF TRANS-REC TO  WS-CONTR-REDEM-CODE.
079510031006           MOVE TRANS-STATUS-CODE
079520031002                OF TRANS-REC           TO  WS-TRANS-STATUS.
079530031002           MOVE TRANS-TYPE-CODE
079540031002                OF TRANS-REC           TO  WS-TRANS-TYPE.
079550031002R48660     MOVE TRANS-ORIGIN-CODE OF TRANS-REC TO  lc-OriginCode.
079560031002
079570031002
079580031002           IF  NOT VALID-STATUS
079590031002               GO TO LR1-0010-0050.
079600031002
079610031002R24058     PERFORM GET-CONTR-REDEM-RULE       THRU GCRR-EXIT.
079620110107
079630110107R17495     MOVE PLACEMENT-DATE OF TRANS-REC TO WS-PLACEMENT-DATE.
079640110107R17495     MOVE TRANS-NO OF TRANS-REC TO WS-TRANS-NO.
079650110302
079660110107R18594     IF TRANSFER-IN-OUT-ONLY OR REVERSAL OR FEES OR TRUSTEE-FEES
079670110107R18830       OR  REVERSE OF TRANS = "Y"
079680110107  |           IF  REVERSE OF TRANS = "Y"      AND
079690980604  |               HIDDEN-TRANS OF TRANS = "Y" AND
079700030611  |               WS-LDA-STMT-CNFM-FLAG = "S"
079710030611  |               MOVE "Y" TO  WS-HIDDEN-FLAG
079720030611  |           ELSE
079730030611  |               MOVE "N" TO  WS-HIDDEN-FLAG
079740030611  |           END-IF
079750030611  |
079760030611  |           PERFORM GET-TARGET-TRANSACTION THRU GTT-EXIT
079770030611R18594     END-IF.
079780030611
079790030611R88823     IF TRANSFER-IN-OUT-ONLY
079800030611  |        AND WS-TARGET-ERROR    = "Y"
079810030611  |        AND Lc_BYPSTMTrn       = "Y"
079820030611  V           GO TO LR1-0010-0050
079830030611R88823     END-IF.
079840030611
079850030611
079860030611R16913*****
079870030611  ¦   ***** If a LSIF Rollover TRI/SWI or TRO/SWO transaction,
079880030611  ¦   ***** changed it to a BUY or SEL.
079890030611  ¦   *****
079900030611  ¦
079910030611  ¦    LR1-0000-0040-0010.
079920030611  ¦
079930030611  ¦        IF WS-IC-PROD (ICG)      IS NOT EQUAL TO "LBS"
079940080623  ¦           GO TO  LR1-0000-0040-0030
079950030611  ¦        END-IF.
079960030611  ¦
079970030611  ¦        IF NOT TRANSFER-IN-ONLY AND NOT TRANSFER-OUT-ONLY
079980030611  ¦           GO TO  LR1-0000-0040-0030
079990170629  ¦        END-IF.
080000170629  ¦
080010170629  ¦        PERFORM GET-REVERSAL-REASON-RTN  THRU GRRR-EXIT.
080020170629  ¦
080030170629  ¦        IF WS-RR-RULE (RR)   EQUAL TO  "5"
080040170629  ¦           IF TRANSFER-OUT-ONLY
080050170629  ¦             MOVE "SEL"      TO  TRANS-TYPE-CODE OF TRANS-REC
080060170629  ¦           ELSE
080070170629  ¦             MOVE "BUY"      TO  TRANS-TYPE-CODE OF TRANS-REC
080080170629  ¦           END-IF
080090030304  ¦           MOVE TRANS-TYPE-CODE OF TRANS-REC TO  WS-TRANS-TYPE
080100030304R48660        MOVE TRANS-ORIGIN-CODE OF TRANS-REC TO  lc-OriginCode
080110030304  ¦        END-IF.
080120030304  v
080130030304R16913 LR1-0000-0040-0030.
080140030304
080150030304      *RFS167932 - Starts
080160030304           INITIALIZE ld_SelectDateLR1
080170030304           IF lc-LdaSelectDate = "T"  AND
080180030304              WS-LDA-STMT-CNFM-FLAG = "S"
080190030617              MOVE TRADE-DATE OF TRANS-REC    TO ld_SelectDateLR1
080200030617           ELSE
080210150414              MOVE PROCESS-DATE OF TRANS-REC  TO ld_SelectDateLR1
080220150414           END-IF
080230150414
080240150414      *RFS167932 - Ends
080250150414R16033*****
080260030617   ¦  ***** If TRI/TRO of GIC, bypass the transaction in Statement.
080270030617   ¦  *****
080280030304   ¦
080290030304   ¦       IF  WS-LDA-STMT-CNFM-FLAG          IS EQUAL TO "S"
080300030304   ¦       AND WS-PT-RULE (PT)                IS EQUAL TO "2"
080310980604   ¦       AND (TRANSFER-IN OR TRANSFER-OUT)
080320980604   ¦          MOVE "N"                        TO WS-GIC-SAME-FUND-FLAG
080330980604   ¦          PERFORM GET-GIC-OPPOSITE-SIDE   THRU GGOS-EXIT
080340971128   ¦          IF WS-GIC-SAME-FUND-FLAG        IS EQUAL TO "Y"
080350981214R17566           IF GROSS-AMT OF TRANS-REC =
080360981214R17566              GROSS-AMT OF TRANS-T-REC  AND
080370980527      *RFS143400 STARTS
080380060621R17566*             NET-AMT OF TRANS-REC = NET-AMT OF TRANS-T-REC
080390041216                    NET-AMT OF TRANS-REC = NET-AMT OF TRANS-T-REC AND
080400041216                    LC-INC-GIC-REN-TRN = 'N'
080410041216      *RFS143400 ENDS
080420981214R17566              GO TO LR1-0010-0050
080430191018R17566           END-IF
080440991004   ¦          END-IF
080450191018R16033     END-IF.
080460191018      *RFS 1018526 STARTS
080470191018           IF lc-LdaSelectDate = "T"  AND
080480191018              WS-LDA-STMT-CNFM-FLAG = "S"
080490191018              IF ld_SelectDateLR1 IS GREATER THAN WS-LDA-ENDDTE AND
080500191018                 Reverse of Trans = "Y"
080510191018                 GO TO LR1-0010-0050
080520191018              END-IF
080530191018           END-IF
080540980527      *RFS 1018526 Ends
080550170629
080560170614           IF  TRANS-TYPE-CODE
080570170614               OF TRANS-REC   IS EQUAL TO  "BFW"
080580170614               MOVE "Y"                TO  WS-INVAUC-SW.
080590170614
080600170614           IF  NOT ORIGINAL-COST-OUT
080610170614               GO TO LR1-0000-0050.
080620170614
080630991004R24058     IF WS-CONTR-REDEM-CODE-RULE = "27"
080640991004   v          GO TO LR1-0000-0050
080650991004R24058     END-IF.
080660981214
080670980527           IF  REVERSE OF TRANS = "Y"
080680980527               GO TO LR1-0000-0050
080690980527           END-IF
080700051024
080710051024      *RFS167932 - Starts
080720051024
080730051024      *    IF PROCESS-DATE OF TRANS-REC  IS LESS THAN  WS-TAX-S-DATE-P
080740051024      *    OR PROCESS-DATE OF TRANS-REC NOT LESS THAN  WS-TAX-S-DATE
080750051024
080760051024           IF ld_SelectDateLR1  IS LESS THAN  WS-TAX-S-DATE-P
080770051024           OR ld_SelectDateLR1 NOT LESS THAN  WS-TAX-S-DATE
080780010604      *RFS167932 - Ends
080790010612               GO TO LR1-0000-0050
080800010604           END-IF
080810010604
080820010612           ADD GROSS-AMT OF TRANS      TO  WS-INV-TINCOME-PRV.
080830010612
080840010612       LR1-0000-0050.
080850010604
080860010604R30514***    Pupulate the FIRST-TRADE-DATE for an account.
080870010604  ¦
080880010604  ¦         IF HISTORY AND TRADE-DATE OF TRANS-REC IS LESS THAN
080890010604  ¦                                   WS-FIRST-TRADE-TRANSACTION
080900010604  ¦            MOVE TRADE-DATE OF TRANS-REC TO
080910010604  v                                   WS-FIRST-TRADE-TRANSACTION
080920971128R30514     END-IF.
080930971128
080940971128      ***
080950971128R10243***    Pupulate CD-FIRST-TRADE-DATE only for BUY or TRI or SWI.
080960971128      ***
080970971128           IF (TRANS-TYPE-CODE OF TRANS-REC  IS EQUAL TO "BUY"
080980170614           OR TRANS-TYPE-CODE OF TRANS-REC   IS EQUAL TO "TRI"
080990170803           OR TRANS-TYPE-CODE OF TRANS-REC   IS EQUAL TO "SWI")
081000170803           AND REVERSE OF TRANS-REC          IS NOT EQUAL TO "Y"
081010170614           AND TRADE-DATE OF TRANS-REC      IS LESS THAN
081020991004                                                WS-FIRST-TRADE-DATE
081030991004              MOVE TRADE-DATE OF TRANS-REC   TO WS-FIRST-TRADE-DATE
081040991004           END-IF.
081050170614
081060170803R10243*** End of RFS10243
081070170803
081080170614      *****
081090991004      *****    If the process date of the transaction is equal to or
081100991004      *****    greater than the statement start date, determine if it
081110980209      *****    is within the date range.  Then, continue processing
081120980209      *****    the investment.
081130980304      *****
081140980209      *RFS167932 - Starts
081150980209      *    IF PROCESS-DATE OF TRANS-REC  IS LESS THAN  WS-LDA-STRDTE
081160980209           IF ld_SelectDateLR1 IS LESS THAN  WS-LDA-STRDTE
081170991004      *RFS167932 - Ends
081180991004              GO TO LR1-0010
081190991004           END-IF
081200010525
081210030131      *RFS167932 - Starts
081220030131      *    IF PROCESS-DATE OF TRANS-REC IS GREATER THAN WS-LDA-ENDDTE
081230030203           IF ld_SelectDateLR1 IS GREATER THAN WS-LDA-ENDDTE
081240030131      *RFS167932 - Ends
081250030203              GO TO LR1-OPENING
081260030203           END-IF
081270991004
081280991004      *****
081290030131      *****  IF DAILY CONFIRM HOLD MAIL OR SUPPRESS FOR
081300031029      *****  BOTH DAILY AND DUPLICATE, WRITE CONTROL REPORT
081310991004      *****  AND BY PASS IT
081320991004      *****
081330991004           IF HOLD-MAIL OF ADDRESS-RECD = "Y"
081340991004           AND WS-LDA-STMT-CNFM-FLAG = "C"
081350991004           AND WS-LDA-CNFM-DUP-FLAG = "N"
081360991004rf9523     AND WS-LDA-HOLD-MAIL       IS NOT EQUAL TO "Y"
081370991004R14871      IF  ACIVRNO OF INVESTOR-JOIN IS NOT EQUAL TO
081380991004  ¦                                WS-ACIVRNO-TEMP
081390991004  ¦         OR  ACACTNO OF INVESTOR-JOIN IS NOT EQUAL TO
081400991004  ¦                                WS-ACACTNO-TEMP
081410991004  ¦         OR  TRANS-NO OF TRANS-REC    IS NOT EQUAL TO
081420991004R14871                             WS-TRANSNO-TEMP
081430991004               PERFORM CONTROL-WRITE  THRU CW-EXIT
081440980209               MOVE "Y" TO WS-CTLREP-W-FLAG
081450041122R14871      END-IF
081460000000R18512         GO TO LR1-0010
081470971128           END-IF
081480010301
081490991004           IF  WS-LDA-STMT-CNFM-FLAG   IS EQUAL TO  "C"
081500080623               MOVE ACCOUNT-NO OF TRANS-REC
081510991004                                       TO  WS-KL-ACCOUNT-NO
081520041216               MOVE INVESTMENT-CODE OF TRANS-REC
081530020920                                       TO  WS-KL-INVESTMENT-CODE
081540020920               MOVE PROCESS-DATE OF TRANS-REC
081550020920                                       TO  WS-KL-PROCESS-DATE
081560020920               MOVE TRANS-PROC-SEQ-NO OF TRANS-REC
081570031229                                       TO  WS-KL-TRANS-PROC-SEQ-NO
081580020920           END-IF
081590020920
081600020920           MOVE "Y" TO WS-TXNS-IN-RANGE.
081610020920           GO TO LR1-OPENING.
081620020920
081630971030       LR1-0010.
081640971030
081650971030           MOVE TRANS-TYPE-CODE OF TRANS   TO WS-TRANS-TYPE.
081660971030R48660     MOVE TRANS-ORIGIN-CODE OF TRANS TO lc-OriginCode.
081670980731           MOVE CONTR-REDEM-CODE OF TRANS  TO WS-CONTR-REDEM.
081680980731R24058     MOVE CONTR-REDEM-CODE OF TRANS  TO WS-CONTR-REDEM-CODE.
081690000000
081700000000R14920*** Get PHANTOM-FUND-NUMBER since trans inception.
081710000000
081720000000           IF WS-PT-RULE (PT)          IS  EQUAL TO  "4"
081730000120R19074     OR WS-PT-RULE (PT)          IS  EQUAL TO  "3"
081740000117           AND NOT DISTRIBUTION
081750000117               INITIALIZE           WS-PHANTOM-FUND-PARMS
081760000117               PERFORM POPULATE-PHANTOM-FUND-NUMBER   THRU PPFN-EXIT
081770000119R14920     END-IF.
081780000119
081790970115      *****
081800970115      *****    If this is not a contribution or a transfer in, indicate
081810970115      *****    the Book Value will have to be calculated.
081820970115      *****
081830970115           IF  WS-BKVAL-SW    IS EQUAL TO  "Y"
081840970115               PERFORM BOOK-VALUE-RTN THRU BVR-EXIT.
081850990128
081860970115      *---FIND OPENING UNIT BALANCE ETC.----------
081870970115
081880970115           PERFORM COMPUTE-AVG-COST-UNIT-BALANCE THRU CACUB-EXIT.
081890990620
081900990126RF6234     IF WS-LDA-REQUEST-SCOPE          IS EQUAL TO "A"
081910990126              MOVE WS-IUP-LASTYEND-PRICE    TO WS-UNIT-PRICE-LAST-YEND
081920990126           ELSE
081930990128             PERFORM FIND-MARKET-VALUE-LAST-YEND THRU FMVLY-EXIT
081940051003           END-IF
081950051003
081960051003      *****
081970051003      *****    If processing a REVERSAL, the amount will decrease, not
081980051003      *****    increase, the accumulated contributions/redemptions.
081990051003      *****
082000051003
082010051003           IF  REVERSAL
082020051003               SUBTRACT GROSS-AMT
082030051003                        OF TRANS     FROM  ZEROES
082040990619                                   GIVING  GROSS-AMT
082050990619                                           OF TRANS
082060011001               SUBTRACT UNIT-AMT
082070011001                        OF TRANS     FROM  ZEROES
082080011001                                   GIVING  UNIT-AMT
082090011001                                           OF TRANS.
082100011001
082110011001R14153**** The following part was moved from LR1-0000-0030. The sub
082120011001  ¦  ***** routine was also modifed not read the Trans file again since
082130011001  ¦  ***** it was read in the first level.
082140020923  ¦
082150020923  ¦        IF WS-LDA-RESP IS EQUAL TO "Y"
082160021202  ¦        AND WS-AT-RULE (AT1) IS EQUAL TO "4"
082170020923  v            PERFORM GEN-CURR-YEAR-RESP THRU GCYR-EXIT
082180020923R14153     END-IF.
082190021202
082200021202           PERFORM COMPUTE-EXCHANGE-RATE
082210020923                                     THRU CER-EXIT.
082220020923
082230030825R11127*****
082240030825      *****   RFS11127 If SEL/SWO and the Taxable-event-indicator in
082250030825      *****   the Taxable-Event-Code file = "D" or " "(means record not
082260051026      *****   fund), then the SEL/SWO was Disposition. For each SEL or
082270051026      *****   SWO, read the MFAACTEVP file
082280051026      *****
082290051026
082300010326R14556*****
082310010326      *****   Added TRANSFER-IN and TRANSFER-OUT to
082320010326      *****   GET-TAXABLE-EVENT-IND routine
082330010326      *****
082340010326R14556     IF SWITCHES-OUT OR SEL-ONLY OR TRANSFER-IN OR TRANSFER-OUT
082350010326R14556        OR FEES OR TRUSTEE-FEES
082360010326R15022        PERFORM GET-TAXABLE-EVENT-IND        THRU CYTDD-EXIT
082370010326           END-IF.
082380030825
082390010326R17495     PERFORM TRANS-CHARGES-TAXES-CDSC THRU TCTC-EXIT.
082400010326
082410010309           PERFORM COMPUTE-CONTRIBS-REDEMPTS THRU CR-EXIT.
082420010309
082430010309R30514     IF REINVESTED-ONLY
082440010309  ¦           PERFORM COMPUTE-DISTRIBUTION-ROC THRU CDR-EXIT
082450010309R30514     END-IF.
082460010309
082470090501      *****
082480090501      *****   RFS9466 If SWI/SWO and the Account-no is defferenet on
082490051028      *****   each side of the trade, the transactions should be
082500051028      *****   considered as TRI/TRO and be included in TRI/TRO instead
082510051026      *****   of in SWI/SWO. Because the amount have been calculated
082520010309      *****   before, therefore, recalculates are required.
082530010309      *****
082540160321RF9466     IF SWITCHES-IN OR SWITCHES-OUT
082550160321              PERFORM RECOMPUTE-SWI-SWO  THRU RSS-EXIT
082560160209           END-IF.
082570010420
082580010420RF8633***
082590010420      ***  For every transaction before the start date
082600010420      ***  TRANS-DISTR-DETAILS to get the
082610010420      ***  DISTR-OPTION-CODE for Section 12.
082620160811      ***
082630010420R61356     IF (WS-LDA-INVESTOR-12    IS EQUAL TO "Y"
082640010420R61356     OR WS-AT-RULE (AT1)      IS EQUAL TO  "9")
082650010420 ¦         AND DISTRIBUTION
082660010420 v            PERFORM INVESTOR-SUMMARY-SECTION2 THRU ISS2-EXIT
082670010420R30514     END-IF.
082680011031
082690011031      ***  End RFS8633
082700190725148326     IF WS-LDA-INVESTOR-12    IS EQUAL TO "Y" AND
082710190725      * RFS 1016703 - start
082720190725              ((REVERSE OF TRANS-REC IS EQUAL TO "Y" OR "N" OR " "
082730190725                 AND
082740190725                lc-LDASelectDate = "T"               AND
082750190725                WS-LDA-STMT-CNFM-FLAG = "S") OR
082760190725               (REVERSE OF TRANS-REC  IS NOT EQUAL TO "Y" AND
082770190725                lc-LDASelectDate = "P"))
082780190725148326*       REVERSE OF TRANS-REC  IS NOT EQUAL TO "Y"
082790011101      * RFS 1016703 - end
082800011101148326        PERFORM INVESTOR-SUMMARY-SECTION2-MER THRU ISSM-EXIT.
082810011101
082820011101      ***
082830011101RF8633***    Pupulate Professional Service Fee fields in Section10.
082840011101      ***
082850011101           IF TRANS-TYPE-CODE OF TRANS             IS EQUAL TO "FEE"
082860011101158609        OR TRANS-TYPE-CODE OF TRANS  IS EQUAL TO "TFE"
082870011101              PERFORM GET-PROFESSIONAL-FEE         THRU GPF-EXIT
082880041105           END-IF.
082890011101
082900011101RF8633*** End of rf8633
082910011101
082920030430RF9318*    Calculate LTD CONTRIBUTION/WITHDRAWALS/CESG for each RESP
082930030429      *    beneficiary
082940011101
082950011101           IF WS-LDA-RESP-84 IS NOT EQUAL TO "Y"
082960011101              GO TO LR1-0010-0000.
082970990128
082980970115           IF WS-LDA-RESP                IS NOT EQUAL TO "Y"
082990970115           OR WS-AT-RULE (AT1)           IS NOT EQUAL TO "4"
083000970115              GO TO LR1-0010-0000
083010990126           END-IF
083020990126
083030990126           IF TRANS-TYPE-CODE OF TRANS-REC  IS NOT EQUAL TO
083040990126R24093        "SEL" AND "BUY" AND "TRI" AND "TRO" AND "SWI" AND "SWO"
083050990126              GO TO LR1-0010-0000
083060970423           END-IF.
083070970423
083080970115R17199     MOVE "N"                     TO WS-RESP-84.
083090970115R17199     PERFORM GENERATE-RESP-BENEFICIARY-INFO THRU GRBI-EXIT.
083100970115
083110970115RF9318 LR1-0010-0000.
083120970115
083130970422           IF  REVERSAL
083140970422               SUBTRACT GROSS-AMT
083150970423                        OF TRANS     FROM  ZEROES
083160970115                                   GIVING  GROSS-AMT
083170970115                                           OF TRANS
083180970115               SUBTRACT UNIT-AMT
083190970115                        OF TRANS     FROM  ZEROES
083200970115                                   GIVING  UNIT-AMT
083210970115                                           OF TRANS.
083220990619
083230970115       LR1-0010-0040.
083240970115      *****
083250981214      *****    If processing a REVERSAL, the amount will decrease, not
083260970115      *****    increase, the accumulated contributions and withdrawals.
083270970115      *****
083280970115
083290970115           IF  TRADE-DATE
083300970115               OF TRANS-REC  IS LESS THAN  WS-YTDSTRDTE
083310981215               GO TO LR1-0010-0050.
083320970423
083330000000           IF  REVERSAL
083340000000               SUBTRACT GROSS-AMT
083350000000                        OF TRANS     FROM  ZEROES
083360010525                                   GIVING  GROSS-AMT
083370010525                                           OF TRANS.
083380010525           PERFORM COMPUTE-EXCHANGE-RATE THRU CER-EXIT.
083390010525           PERFORM ACCUM-CONTRIB-WITHDRAW
083400010525                                      THRU ACW-EXIT.
083410020220
083420010525           IF  REVERSAL
083430010525               SUBTRACT GROSS-AMT
083440010525                        OF TRANS     FROM  ZEROES
083450010525                                   GIVING  GROSS-AMT
083460010525                                           OF TRANS.
083470010525
083480010525       LR1-0010-0050.
083490010525           GO TO LR1-BAL-NEXT.
083500010525
083510081205       LR1-OPENING.
083520081205
083530081205R10423     IF ACCREATDAT       IS GREATER THAN   WS-LDA-ENDDTE
083540081205           AND WS-LDA-STMT-CNFM-FLAG    IS EQUAL TO "S"
083550081218           AND (WS-LDA-REQUEST-SCOPE    IS EQUAL TO "A"
083560081205           OR  WS-LDA-REQUEST-SCOPE     IS EQUAL TO "R")
083570081205R11751     AND WS-LDA-DOR-FUND          IS EQUAL TO "Y"
083580081205              GO TO LR1-EXIT
083590081205           END-IF.
083600081205
083610081205           IF  WS-CURR-UNIT-BAL IS EQUAL TO ZERO
083620081205           AND WS-TXNS-IN-RANGE IS EQUAL TO "N"
083630081205           AND WS-LDA-DOR-FUND  IS NOT EQUAL TO "Y"
083640081205               GO TO LR1-EXIT
083650081205R10423     END-IF.
083660081205
083670081218      * RFS 50492 - Begin
083680081205      ** Include year to date dormant funds.
083690111215      ** Step one - Account must have financial activity within
083700081205      **            statement period.
083710081205      ** RFS62153   Or the Closing Units > 0
083720081205      ** Step two - Include dormant fund if financial activity is
083730081205      **            within statement year.
083740081205           MOVE SPACES TO lc_FndFinActivity.
083750081205           IF  Edit-Drfytd
083760111220           AND WS-CURR-UNIT-BAL IS EQUAL TO ZERO
083770081205           AND WS-LDA-DOR-FUND  IS EQUAL TO "Y"
083780081218           AND WS-TXNS-IN-RANGE IS EQUAL TO "N"
083790081218      ** RFS 61342 - Begin
083800081218               IF ln_PrevAccountNo  NOT = WS-ACCOUNT-NO
083810081218                  MOVE WS-ACCOUNT-NO TO ln_PrevAccountNo
083820081218                  MOVE SPACES        TO lc_AccFinActivity
083830081218R62153            MOVE ZEROS         TO Ln_AccTotalBal
083840081218                  MOVE WS-LDA-STRDTE TO ln_DorFndStrDte
083850081205R90088            MOVE WS-LDA-ENDDTE TO ln_DorFndEndDte
083860081205                  EXEC SQL
083870081218                    SELECT DISTINCT CHAR("Y",1)
083880081205                      INTO  :lc_AccFinActivity
083890111215                      FROM  MFAACCIVP
083900081205                     WHERE  Account_No               = :WS-ACCOUNT-NO
083910081205                       AND  Last_Financial_Activity >= :ln_DorFndStrDte
083920081205R90088                 AND  Last_Financial_Activity <= :ln_DorFndEndDte
083930081205                  END-EXEC
083940081205R62153***** Get the Total of CURR_UNIT_BAL of MFAACCIVP.
083950081205  |               EXEC SQL
083960081205  |                 SELECT SUM(CURR_UNIT_BAL)
083970111220  |                   INTO  :Ln_AccTotalBal
083980081205  |                   FROM  MFAACCIVP
083990081205  V                  WHERE  Account_No               = :WS-ACCOUNT-NO
084000081205R62153            END-EXEC
084010081205               END-IF
084020081205               IF AccFinActivity
084030081205R62153         OR Ln_AccTotalBal > 0
084040081205                  MOVE WS-CURYTDSTRDTE  TO ln_DorFndStrDte
084050081205R90088            MOVE WS-LDA-ENDDTE    TO ln_DorFndEndDte
084060081120                  EXEC SQL
084070970516                    SELECT DISTINCT CHAR("Y",1)
084080970516                      INTO  :lc_FndFinActivity
084090970516                      FROM  MFATRNP
084100991005                     WHERE  Account_No      = :WS-ACCOUNT-NO
084110970516                       AND  Investment_Code = :Curr-Investment
084120991005                       AND  Process_Date   >= :ln_DorFndStrDte
084130991005R90088                 AND  Process_Date   <= :ln_DorFndEndDte
084140991005                  END-EXEC
084150991005               END-IF
084160980311      ** RFS 61342 - End
084170980311               IF NOT FndFinActivity
084180980311                  GO TO LR1-EXIT
084190980311               END-IF
084200980311           END-IF.
084210980311      * RFS 50492 - End
084220980311
084230980311      *****
084240981126      *****    If a transaction is required within the range and no
084250980311      *****    transaction exists within the range, bypass the
084260000000      *****    investment.
084270990621      *****
084280990827           IF  WS-LDA-RNG-ACT-RQD             IS EQUAL TO  "Y"
084290991020           AND WS-TXNS-IN-RANGE               IS EQUAL TO  "N"
084300990817               GO TO LR1-EXIT
084310991020           END-IF
084320990827
084330990622      *****
084340990621      *****    If this is a confirmation run and no transaction exists
084350990621      *****    within the range, bypass the investment.
084360990621      *****
084370000000           IF  WS-LDA-STMT-CNFM-FLAG
084380000000                              IS EQUAL TO  "C"
084390000000           AND WS-TXNS-IN-RANGE  EQUAL TO  "N"
084400000117           AND WS-LDA-RNG-ACT-RQD EQUAL TO "Y"
084410000120               GO TO LR1-EXIT.
084420000118
084430000120      *****
084440000120      *****    If HOLD MAIL, no transaction within the range,
084450000117      *****    and confirm, bypass it.
084460000118      *****
084470000118           IF  WS-LDA-STMT-CNFM-FLAG  EQUAL TO "C"
084480000120           AND HOLD-MAIL OF ADDRESS-RECD IS EQUAL TO "Y"
084490000118           AND WS-LDA-CNFM-DUP-FLAG EQUAL TO "N"
084500000120           AND WS-TXNS-IN-RANGE EQUAL TO "N"
084510000120           GO TO LR1-EXIT.
084520000120
084530000120      *-----------------------------------------------------
084540000117      * GET STARTING UNIT-PRICE AND CALCULATE MV-START
084550000000
084560000000RF6234     IF WS-LDA-REQUEST-SCOPE          IS EQUAL TO "A"
084570000000              MOVE WS-IUP-DATE             TO WS-OPENING-DATE
084580000000              MOVE WS-IUP-OPENING-PRICE    TO WS-OPENING-PRICE
084590991005              COMPUTE WS-MARKET-START ROUNDED = WS-OPENING-PRICE
084600991005                                              * WS-CURR-UNIT-BAL
084610991005           ELSE
084620991005              PERFORM FIND-FIRST-MARKET-VALUE-PRICE    THRU FFMVP-EXIT
084630170622              MOVE TRADE-DATE  OF INVESTMENT-PRICE-REC
084640170622                                           TO WS-OPENING-DATE
084650170622              MOVE UNIT-PRICE OF INVESTMENT-UNIT-PRICE
084660170622                                           TO WS-OPENING-PRICE
084670170622              COMPUTE WS-MARKET-START ROUNDED = UNIT-PRICE
084680170622                      OF INVESTMENT-UNIT-PRICE * WS-CURR-UNIT-BAL
084690170622           END-IF
084700200928
084710200928      *RFS1104542 Starts*
084720200928           DIVIDE WS-MARKET-START       BY  WS-CC-RTEOPN (CC)
084730200928                                GIVING  WS-MARKET-START-EX ROUNDED.
084740200928      *    ADD WS-MARKET-START TO WS-ACCT-MARKET-START.
084750200928           ADD WS-MARKET-START-EX TO WS-ACCT-MARKET-START.
084760170622      *RFS1104542 Ends*
084770170622
084780170622           MOVE "Y"          TO WS-WRITE-INVESTMENT-LEVEL.
084790170622
084800170614      ***
084810161024      ***  Starting transactions from the start-date.
084820161024      ***  Reading will be in Detail-processing Routine.
084830161024      ***
084840161024           MOVE ACACTNO      TO ACCOUNT-NO OF TRANS.
084850991126           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
084860000000                             TO INVESTMENT-CODE OF TRANS.
084870000000           MOVE WS-LDA-STRDTE          TO  PROCESS-DATE
084880000000                                           OF TRANS-REC.
084890000000           MOVE 0          TO TRANS-PROC-SEQ-NO OF TRANS.
084900140925
084910991005           START TRANS
084920000000               KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
084930000000               INVALID KEY
084940991005                  GO TO LR1-OPENING-NEXT
084950991005           END-START.
084960991005           LR1-OPENING-NEXT.
084970080623      *RFS156507 - Starts
084980000000      *Code from para LR1-OPENING-NEXT till LR1-0040 is moved CPYSTMSLR1
084990140925           PERFORM LEVEL-REINIT-1-KEYINFO THRU LR1-KEY-EXIT.
085000971125      *RFS156507 - Ends
085010971125       LR1-0080.
085020970522      *------------------------------------------------*
085030151014      *  GENERATE OPENING BALANCE TXN RECORD           *
085040151014      *   BY SETTING UP TRANS RECORD                   *
085050151014      *------------------------------------------------*
085060151014130038     MOVE SUPPRESS-CONFIRMATION OF TRANS TO lc_supprconf.
085070151014           INITIALIZE MFATRNP OF TRANS-REC.
085080151014           MOVE "BFW"           TO TRANS-TYPE-CODE OF TRANS
085090151014           MOVE "HST"           TO TRANS-STATUS-CODE OF TRANS
085100151014           MOVE "N"             TO  REVERSE OF TRANS-REC.
085110151014           MOVE TRANS-STATUS-CODE OF TRANS  TO  WS-TRANS-STATUS.
085120151014           MOVE TRANS-TYPE-CODE OF TRANS    TO  WS-TRANS-TYPE.
085130180430R48660     MOVE TRANS-ORIGIN-CODE OF TRANS  TO  lc-OriginCode.
085140180430           PERFORM FORMAT-TXN-OUTPUT-RECORD THRU FTOR-EXIT.
085150180430130038     MOVE lc_supprconf           TO  AT-OMS-SUPPRESS.
085160180430           MOVE WS-LDA-STRDTE          TO  AT-TRADE-DATE.
085170180430           MOVE WS-LDA-STRDTE          TO  AT-PROCESS-DATE.
085180180430           MOVE WS-OPENING-DATE        TO  AT-OPEN-DATE.
085190180430      * RFS147156 - Start
085200180430           IF WS-LDA-REQUEST-SCOPE IS EQUAL TO "A"        AND
085210180430              (TRANS-TYPE-CODE OF TRANS IS EQUAL TO "BFW" OR
085220180430               AT-TRANS-TYPE-CODE IS EQUAL TO "BFW")
085230180430              MOVE WS-IUP-OPENING-PRICE TO AT-UNIT-PRICE
085240180430           ELSE
085250180430              MOVE WS-OPENING-PRICE     TO AT-UNIT-PRICE
085260180430      *    MOVE WS-OPENING-PRICE TO AT-UNIT-PRICE.
085270180430           END-IF.
085280180430      * RFS147156 - Ends
085290180430      * RFS1001592 - Starts
085300180430           IF lc-LdaSelectDate = "T" AND
085310180430              WS-LDA-STMT-CNFM-FLAG = "S"
085320180430                    INITIALIZE ln-CLOSING-BAL-T
085330180430                               WS-OPN-STRDTE-T
085340180430                    MOVE WS-LDA-STRDTE TO WS-OPN-STRDTE-T
085350180430              EXEC SQL
085360971125                    SELECT CLOSING_UNIT_BAL
085370971125                      INTO  :ln-CLOSING-BAL-T
085380970530                      FROM  MFATRNP
085390970530                     WHERE  Account_No      = :CURR-ACCOUNT
085400970703                       AND  Investment_Code = :CURR-INVESTMENT
085410970703                       AND  Trade_date      < :WS-OPN-STRDTE-T
085420131021                       AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
085430970530                     ORDER BY Trade_Date DESC, Process_date  DESC,
085440970530                              Trans_Proc_Seq_No DESC
085450970530                     FETCH FIRST ROW ONLY
085460970530              END-EXEC
085470970520              IF AT-TRANS-TYPE-CODE IS EQUAL TO "BFW"
085480970516                  MOVE ln-CLOSING-BAL-T  TO  AT-UNIT-BALANCE
085490971024              END-IF
085500971024           END-IF.
085510150817      * RFS1001592 - Ends
085520150817           MOVE AT-UNIT-BALANCE        TO  AT-NO-OF-UNITS.
085530150817           MOVE AT-UNIT-BALANCE-SIGN   TO  AT-NO-OF-UNITS-SIGN.
085540150817           DIVIDE AT-UNIT-PRICE        BY  WS-CC-RTEOPN (CC)
085550150817                                   GIVING  AT-UNIT-PRICE-BASE ROUNDED.
085560160225           MULTIPLY AT-UNIT-BALANCE    BY  AT-UNIT-PRICE
085570190807                                   GIVING  AT-MKT-VALUE ROUNDED.
085580190806      * RFS1015600 - Begin
085590190806      * If there is only one transaction before opening and there is
085600190806      * only one transaction for this account investment. Just use
085610190806      * the gross amount from the transaction.
085620190806           IF WS-SUM-CNT = 1 AND WS-SUM-CNT-STR = 1
085630190806            IF WS-GRS-AMT-SUM > 0 AND
085640190806             (WS-ACC-INV-CLSUNIT-BAL-SUM = WS-UNIT-AMT-SUM) AND
085650190806             (WS-UNIT-PRC-SUM = AT-UNIT-PRICE)
085660190806                MOVE WS-GRS-AMT-SUM TO AT-MKT-VALUE
085670190806            END-IF
085680190807           END-IF.
085690150619      * RFS1015600 - End
085700150619125153     MOVE AT-MKT-VALUE           to ln_GrossAmount.
085710150619           DIVIDE AT-MKT-VALUE         BY  WS-CC-RTEOPN (CC)
085720150619                                   GIVING  AT-MKT-VALUE-BASE ROUNDED.
085730150619           MOVE WS-CC-RTEOPN (CC)      TO  AT-EXCHANGE-RATE.
085740150619
085750160329           MULTIPLY AT-UNIT-BALANCE    BY  AT-UNIT-PRICE
085760190807                                   GIVING  WS-INV-MVP ROUNDED.
085770190806      * RFS1015600 - Begin
085780190806      * If there is only one transaction before opening and there is
085790190806      * only one transaction for this account investment. Just use
085800190806      * the gross amount from the transaction.
085810190806           IF WS-SUM-CNT = 1 AND WS-SUM-CNT-STR = 1
085820190806            IF WS-NET-AMT-SUM > 0 AND
085830190806             (WS-ACC-INV-CLSUNIT-BAL-SUM = WS-UNIT-AMT-SUM) AND
085840190806             (WS-UNIT-PRC-SUM = WS-RES-AVG-UNIT-COST-SUM) AND
085850190806             (WS-UNIT-PRC-SUM = AT-UNIT-PRICE)
085860190806                MOVE WS-NET-AMT-SUM TO WS-INV-MVP
085870190919            END-IF
085880190807           END-IF.
085890160329      * RFS1015600 - End
085900160329           DIVIDE AT-MKT-VALUE         BY  WS-CC-RTEOPN (CC)
085910160329                                   GIVING  WS-INV-OPNMKTVAL ROUNDED.
085920160329      * RFS150035 STARTS
085930160329            IF CURR-ACCOUNT NOT EQUAL TO PREV-ACCOUNT
085940150619               MOVE ZEROES TO ln_S20RetrnInterest1
085950150619            END-IF.
085960130614      * RFS150035 ENDS
085970001212155381      INITIALIZE ln_S20RetrnInterest.
085980150817      * RFS147810 STARTS
085990150619            MOVE CURR-PT-RULE           TO PREV-PT-RULE.
086000160614            MOVE AT-FUND-NO             TO AD-FUND-NO.
086010020731              If Prev-Pt-Rule = lnc_2 or
086020020731                 Prev-Pt-Rule = lnc_7
086030061003                 Move 0 to ln_S20RetrnInterest
086040061003152312*          Call "FXGIDIOINT" using Prev-Pt-Rule,
086050020731152312*                                  Ad-Account,
086060030625152312*                                  Ad-Fund-No,
086070180329152312*                                  Ws-Lda-StrDte,
086080180329152312*                                  ln_S20RetrnInterest
086090180329152312            PERFORM Call-INTCLC-RTN THRU CIR-EXIT
086100180329              End-If
086110180329      * RFS147810 ENDS
086120180329117038     MOVE "Y"                    TO  lc_Section80.
086130180329RF8113     MOVE WS-INV-MVP             TO  AD-MARKET-VALUE-PRIOR.
086140180329150035     ADD  ln_S20RetrnInterest    TO  ln_S20RetrnInterest1.
086150180329147810     ADD  ln_S20RetrnInterest    TO  AD-MARKET-VALUE-PRIOR
086160180329159123     ADD  ln_S20RetrnInterest    TO  AT-MKT-VALUE-BASE
086170180329R13637     IF   WS-INV-MVP      IS LESS THAN 0
086180180329  ¦             MOVE "-" TO AD-MARKET-VALUE-PRIOR-SIGN
086190180329R35540     ELSE
086200180329R35540          MOVE " " TO AD-MARKET-VALUE-PRIOR-SIGN
086210180329R13637     END-IF.
086220180329R16881     MOVE WS-AT-PHANTOM-FUND-NUMBER TO AT-PHANTOM-FUND-NUMBER.
086230180329      **RFS177875 - Starts
086240180329      **calculate market prior start date using opening exchnage rate
086250970530      **instead of closing exchange rate for non-base currency fund
086260970530000105*    IF WS-CC-RTECLS (CC) EQUAL TO  ZEROES
086270991202R18194*       MOVE WS-INV-MVP         TO  WS-INV-MVP-TOT-CUR
086280991202      *    ELSE
086290991202      *       DIVIDE WS-INV-MVP       BY  WS-CC-RTECLS (CC)
086300991202R18194*                            GIVING WS-INV-MVP-TOT-CUR
086310991202000105*                                    ROUNDED
086320991005      *    END-IF.
086330060621            IF WS-CC-RTEOPN (CC) EQUAL TO  ZEROES
086340030825               MOVE WS-INV-MVP         TO  WS-INV-MVP-TOT-CUR
086350030825            ELSE
086360991005               DIVIDE WS-INV-MVP       BY  WS-CC-RTEOPN (CC)
086370991005                                    GIVING WS-INV-MVP-TOT-CUR
086380060621                                            ROUNDED
086390030825            END-IF.
086400991005      **RFS177875 - Ends
086410991005      *****    If requested, write out the opening balance transaction
086420000000      *****    record.
086430000000RF5962     IF NOT REINVESTED-ONLY
086440991005              GO TO LR1-0090
086450980731           END-IF
086460980731           PERFORM POPULATE-DISTRIBUTION-ROC      THRU PDR-EXIT.
086470980731       LR1-0090.
086480980731           IF WS-LDA-OPN-TXN-BAL           IS EQUAL TO  "A"
086490980731R18147        MOVE ACCOUNT-TXN-SECTION TO STATEMENT-REC(ISR)
086500980731R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
086510980731           END-IF.
086520130219           IF  WS-LDA-OPN-TXN-BAL         IS  EQUAL TO  "Y"
086530130219           AND WS-TXNS-IN-RANGE           IS  EQUAL TO  "Y"
086540130219R18147        MOVE ACCOUNT-TXN-SECTION TO STATEMENT-REC(ISR)
086550130219R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
086560130219           END-IF.
086570130219      **********
086580980731       LR1-EXIT.
086590980731           EXIT.
086600991210      **********
086610991210      /
086620991210       BOOK-VALUE-RTN.
086630000328      ******************************************************************
086640000328      *                                                                *
086650000328      *    B O O K   V A L U E   R O U T I N E                         *
086660120328      *                                                                *
086670120328      ******************************************************************
086680120328      *****
086690120328      *****    Force BV to be calculated when edit code CLCBV is on
086700120328      *****
086710120328101829     If Lc_CLCBV = "Y"
086720120328101829        GO TO  BVR-0040
086730120328101829     END-IF
086740120328      *****    If this is not a contribution or a transfer in, indicate
086750120328      *****    that the book value is to be calculatled.
086760120328RF5931     IF WS-LDA-INCEPT-TOT          IS EQUAL TO  "N"
086770120328              GO TO  BVR-0040
086780120328           END-IF
086790120328RF6774     IF BUY-ADJUSTMENT
086800120328              GO TO  BVR-0040
086810991210           END-IF
086820980731R93365     IF BUY-ONLY
086830980731    |           MOVE PLACEMENT-DATE OF TRANS-REC TO li_PlacementDate
086840980731    |           MOVE TRANS-NO  OF TRANS-REC      TO li_TransNo
086850980731    |           MOVE 0 TO ln_CountlnKind
086860980731    |           EXEC SQL
086870980731    |            Select Count(1)
086880980731    |              into :ln_CountlnKind
086890980731    |            from MFATAJUCP
086900980731    |              where placement_date = :li_PlacementDate
086910980731    |              and   trans_no       = :li_TransNo
086920980731    |           END-EXEC
086930980731    |           IF ln_CountlnKind > 0
086940980731    |              GO TO BVR-0040
086950980731    |           END-IF
086960980731R93365     END-IF
086970980731           IF NOT CONTRIBS-ONLY
086980980731970716     AND NOT TRANSFER-IN-ONLY
086990980731               GO TO BVR-0040.
087000980731      *****
087010980731      *****    If processing a switch/transfer in transaction with a
087020980731      *****    merge in contribution code, use the Transfer at Average
087030991112      *****    from the Taxable Event table to determine if the book
087040980731      *****    value is to be calculated.  In order to read the Taxable
087050051028      *****    Event record,
087060051028      *****         1. Read the Transaction Target to identify the
087070051028      *****            corresponding switch/transfer out transaction.
087080051028      *****         2. Read the switch/transfer out Transaction to
087090030825      *****            retrieve the contribution code and transaction
087100030826      *****            type.
087110030825      *****         3. If the account number of the switch/transfer out
087120980731      *****            transaction is different than the account number
087130980731      *****            of the switch/transfer in transaction, read the
087140980731      *****            Account for the switch/transfer out transaction
087150980731      *****            to retrieve the account type.  If the account
087160980731      *****            number is the same, use the switch/transfer in
087170980731      *****            account account type.
087180980731      *****         4. Read the Taxable Event record.
087190980731           IF  NOT TRANSFER-IN-ONLY
087200980731               GO TO BVR-0030.
087210980731R30514     IF WS-HIDDEN-FLAG = "Y"
087220980731  ¦           MOVE "N" TO  WS-HIDDEN-FLAG
087230980731  v           PERFORM GET-TARGET-TRANSACTION  THRU GTT-EXIT
087240980731R30514     END-IF.
087250980731  |        IF WS-TARGET-ERROR= "Y"
087260980731  V           GO TO BVR-0030
087270980731R18147     END-IF.
087280980731           IF  ACCOUNT-NO
087290980731               OF TRANS-T-REC IS EQUAL TO  ACCOUNT-NO
087300980731                                           OF TRANS-REC
087310980731               MOVE ACACTYP
087320980731                    OF INVESTOR-J-REC  TO  ACCOUNT-TYPE-CODE
087330980731                                           OF ACCOUNT-T-REC
087340980731               GO TO BVR-0020.
087350980731           INITIALIZE  MFAACCNTP
087360980731                       OF ACCOUNT-T-REC.
087370980731           MOVE ACCOUNT-NO
087380980731                OF TRANS-T-REC         TO  ACCOUNT-NO
087390980731                                           OF ACCOUNT-T-REC.
087400980731           READ ACCOUNT-T
087410980731               INVALID KEY
087420980731                   GO TO BVR-0030.
087430980731       BVR-0020.
087440980731           INITIALIZE  MFAACTEVP
087450980731                       OF TAXABLE-EVENT-RECD.
087460980731           MOVE ACCOUNT-TYPE-CODE
087470980731                OF ACCOUNT-T-REC       TO  ACCOUNT-TYPE-CODE
087480980731                                           OF TAXABLE-EVENT-RECD.
087490980731           MOVE CONTR-REDEM-CODE
087500980731                OF TRANS-T-REC         TO  CONTR-REDEM-CODE
087510980731                                           OF TAXABLE-EVENT-RECD.
087520980731           MOVE TRANS-TYPE-CODE
087530980731                OF TRANS-T-REC         TO  TRANS-TYPE-CODE
087540980731                                           OF TAXABLE-EVENT-RECD.
087550980731           READ TAXABLE-EVENT
087560980731               INVALID KEY
087570980731                   GO TO BVR-0030.
087580000000           IF  TRANSFER-AT-AVERAGE
087590000000                              IS EQUAL TO  "Y"
087600000000               GO TO BVR-0040.
087610000000       BVR-0030.
087620000000      *****
087630000000      *****    The book value does not need to be calculated, therefore
087640000000970716*****    exit.
087650000000      *****
087660970428           GO TO BVR-EXIT.
087670110128       BVR-0040.
087680970428      *****
087690970428      *****    Indicate that the book value is to be calculated.
087700000000      *****
087710031117           MOVE "N"                    TO  WS-BKVAL-SW.
087720031117       BVR-EXIT.
087730031117           EXIT.
087740031117      /
087750031117       FIND-LAST-MARKET-VALUE-PRICE.
087760000000
087770000000      ******************************************************************
087780000000      *                                                                *
087790971024      *    F I N D   L A S T   M A R K E T   V A L U E   P R I C E     *
087800971024      *                                                                *
087810000000      ******************************************************************
087820970418           IF  WS-IG-FIXVAR (IG) EQUAL TO  "F"
087830000000R89704     AND WS-LDA-REQUEST-SCOPE      IS NOT EQUAL TO "I"
087840970418               MOVE WS-IG-PRC (IG)     TO  UNIT-PRICE
087850970418                                           OF  INVESTMENT-PRICE-REC
087860970418               GO TO FLMVP-EXIT.
087870970418R18643     MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
087880970418   ¦                            TO WS-PRICE-INVESTMENT-CODE.
087890970418   ¦       MOVE WS-LDA-ENDDTE   TO WS-PRICE-TRADE-DATE.
087900970418   v       PERFORM GET-INVESTMENT-UNIT-PRICE-RTE THRU GIUPR-EXIT.
087910970418R18643     GO TO FLMVP-EXIT.
087920970418           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
087930000000                             TO INVESTMENT-CODE
087940000113                             OF INVESTMENT-UNIT-PRICE.
087950000000           MOVE WS-LDA-ENDDTE          TO  TRADE-DATE
087960000000                                           OF INVESTMENT-PRICE-REC.
087970000000           START INVESTMENT-UNIT-PRICE
087980000000               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
087990970418               INVALID KEY
088000970418                   GO TO FLMVP-0010.
088010970418           GO TO FLMVP-PRICE-PRIOR.
088020970418       FLMVP-0010.
088030970418           READ INVESTMENT-UNIT-PRICE LAST
088040970418                                       AT  END
088050970418               MOVE ZEROES             TO  UNIT-PRICE
088060970418                                           OF INVESTMENT-PRICE-REC
088070971024               GO TO FLMVP-EXIT.
088080971024           GO TO FLMVP-0030.
088090971024       FLMVP-PRICE-PRIOR.
088100080219           READ INVESTMENT-UNIT-PRICE PRIOR RECORD
088110971024           AT END
088120000000           MOVE ZEROES       TO UNIT-PRICE
088130000000                             OF INVESTMENT-UNIT-PRICE
088140000000           GO TO FLMVP-EXIT.
088150000000       FLMVP-0030.
088160000000           IF  INVESTMENT-CODE
088170000000               OF INVESTMENT-PRICE-REC
088180000000                          IS NOT EQUAL TO  INVESTMENT-CODE
088190000000                                           OF ACCOUNT-INVESTMENT-REC
088200000000               MOVE ZEROES             TO  UNIT-PRICE
088210000000                                           OF INVESTMENT-PRICE-REC
088220000000               GO TO FLMVP-EXIT.
088230000000           IF  TRADE-DATE
088240000000               OF INVESTMENT-PRICE-REC
088250000000                          IS GREATER THAN  WS-LDA-ENDDTE
08826000000042749          OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
088270971024               GO TO FLMVP-PRICE-PRIOR.
088280971024
088290970522       FLMVP-EXIT.
088300970522           EXIT.
088310970522      /
088320970522       FIND-FIRST-MARKET-VALUE-PRICE.
088330970522
088340970522      ******************************************************************
088350970522      *                                                                *
088360970522      *    F I N D   F I R S T   M A R K E T   V A L U E   P R I C E   *
088370970522      *                                                                *
088380970522      ******************************************************************
088390971122
088400970702           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
088410970522                             TO INVESTMENT-CODE
088420970522                             OF INVESTMENT-UNIT-PRICE.
088430970522           MOVE WS-LDA-STRDTE          TO  TRADE-DATE
088440970522                                           OF INVESTMENT-PRICE-REC.
088450970522           START INVESTMENT-UNIT-PRICE
088460000000               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
088470000000               INVALID KEY
088480970702                   GO TO FFMVP-0010.
088490970702
088500971122           GO TO FFMVP-PRICE-PRIOR.
088510970702
088520970702       FFMVP-0010.
088530970702           READ INVESTMENT-UNIT-PRICE LAST
088540970702                                       AT  END
088550000000               MOVE WS-LDA-STRDTE      TO  TRADE-DATE
088560970522                                           OF INVESTMENT-PRICE-REC
088570970522               MOVE ZEROES             TO  UNIT-PRICE
088580970522                                           OF INVESTMENT-PRICE-REC
088590970522               GO TO FFMVP-EXIT.
088600970522
088610971122           GO TO FFMVP-0030.
088620970702
088630970522       FFMVP-PRICE-PRIOR.
088640970522           READ INVESTMENT-UNIT-PRICE PRIOR
088650970522                                       AT  END
088660970522               MOVE WS-LDA-STRDTE      TO  TRADE-DATE
088670970522                                           OF INVESTMENT-PRICE-REC
088680970522               MOVE ZEROES             TO  UNIT-PRICE
088690971024                                           OF INVESTMENT-PRICE-REC
088700080219               GO TO FFMVP-EXIT.
088710970522
088720000000       FFMVP-0030.
088730000000           IF  INVESTMENT-CODE
088740000000               OF INVESTMENT-PRICE-REC
088750991202                          IS NOT EQUAL TO  INVESTMENT-CODE
088760000119                                           OF ACCOUNT-INVESTMENT-REC
088770000119               MOVE WS-LDA-STRDTE      TO  TRADE-DATE
088780000119                                           OF INVESTMENT-PRICE-REC
088790000119               MOVE ZEROES             TO  UNIT-PRICE
088800000119                                           OF INVESTMENT-PRICE-REC
088810991202               GO TO FFMVP-EXIT.
088820991202
088830051026           IF  TRADE-DATE
088840051026               OF INVESTMENT-PRICE-REC
088850051026                         IS NOT LESS THAN  WS-LDA-STRDTE
08886005102642749          OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
088870051026               GO TO FFMVP-PRICE-PRIOR.
088880051026
088890051026       FFMVP-EXIT.
088900051026           EXIT.
088910051026
088920051026      ******************************************************************
088930051026      *
088940051026      *    POPULATE AT-DISTRIBUTION-ROC FIELD      THRU PDR-EXIT
088950051026      *
088960061003      ******************************************************************
088970051026
088980051026RF5962 POPULATE-DISTRIBUTION-ROC.
088990051026  ¦
089000051026R30514     IF WS-ROC-FOUND IS NOT EQUAL TO  "Y"
089010051026  ¦           GO TO PDR-EXIT
089020051026  ¦        END-IF.
089030051026  ¦
089040061003  ¦        MOVE ZEROS                   TO      WS-TAXABLE-AMOUNT.
089050051026  ¦        MOVE TOTAL-ROC-ADJUSTED OF TRANS-ROC-APPLIED-REC
089060051026  ¦                                     TO WS-TAXABLE-AMOUNT
089070051026  ¦
089080051026  ¦        IF WS-ROC-CALC-AMT            IS LESS THAN ZEROS
089090000623  ¦           MOVE "-"                   TO AT-DISTRIBUTION-ROC-SIGN
089100991203  ¦           COMPUTE AT-DISTRIBUTION-ROC = WS-ROC-CALC-AMT * -1
089110050923  ¦        ELSE
089120050923R35540        MOVE " "                   TO AT-DISTRIBUTION-ROC-SIGN
089130050923  ¦           COMPUTE AT-DISTRIBUTION-ROC = WS-ROC-CALC-AMT * 1
089140061003  ¦        END-IF.
089150061003  ¦
089160050923  ¦        IF WS-TAXABLE-AMOUNT          IS LESS THAN ZEROS
089170991202  ¦           MOVE "-"                   TO AT-TAXABLE-AMOUNT-SIGN
089180991202  ¦           COMPUTE AT-TAXABLE-AMOUNT = WS-TAXABLE-AMOUNT * -1
089190991202  ¦        ELSE
089200991202R35540        MOVE " "                   TO AT-TAXABLE-AMOUNT-SIGN
089210991202  ¦           COMPUTE AT-TAXABLE-AMOUNT = WS-TAXABLE-AMOUNT * 1
089220991202  ¦        END-IF.
089230991202  v
089240001013R30514     ADD WS-ROC-CALC-AMT           TO WS-INV-DISTRIBUTION-ROC.
089250001013RF7172     ADD WS-TAXABLE-AMOUNT         TO WS-INV-TAXABLE-AMOUNT.
089260001013
089270001013R28692     MOVE ROC-RATE OF TRANS-ROC-APPLIED-REC TO AT-ROC-RATE.
089280001013   ¦       IF ROC-RATE OF TRANS-ROC-APPLIED-REC IS LESS THAN ZERO
089290001013   ¦          MOVE "-" TO AT-ROC-RATE-SIGN
089300001013R35540     ELSE
089310001013R35540        MOVE " " TO AT-ROC-RATE-SIGN
089320001013R28692     END-IF.
089330001013      **********
089340001013
089350001103       PDR-EXIT.
089360001013           EXIT.
089370001103
089380001013      **********
089390001103
089400001103
089410001013      ******************************************************************
089420001013      *
089430001013      *    POPULATE-CDSC-SCHEDULE      THRU PCS-EXIT
089440001013      *
089450001013      ******************************************************************
089460001013
089470001013RF4638 POPULATE-CDSC-SCHEDULE.
089480001013
089490001013           INITIALIZE TRANS-CDSC-PURCHASE-REC.
089500001013
089510001013           MOVE PLACEMENT-DATE OF TRANS TO PLACEMENT-DATE
089520001013                                        OF TRANS-CDSC-PURCHASE-REC.
089530001013           MOVE TRANS-NO OF TRANS       TO TRANS-NO
089540001013                                        OF TRANS-CDSC-PURCHASE-REC.
089550001103           MOVE ZEROS                   TO CDSC-SEQ-NO
089560001013                                        OF TRANS-CDSC-PURCHASE-REC.
089570001103
089580001013           START TRANS-CDSC-PURCHASE
089590001013               KEY IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
089600001013                 INVALID KEY
089610001013                 MOVE SPACES         TO CDSC-SCHEDULE OF
089620001013                                     TRANS-CDSC-PURCHASE-REC
089630001013                 GO TO PCS-EXIT
089640001013           END-START.
089650001013
089660001013           READ TRANS-CDSC-PURCHASE NEXT RECORD
089670001013                AT END
089680001013                 GO TO PCS-EXIT
089690001013           END-READ.
089700001013
089710001013           IF PLACEMENT-DATE OF TRANS-CDSC-PURCHASE-REC
089720000119                  IS NOT EQUAL TO PLACEMENT-DATE OF TRANS
089730000119           OR TRANS-NO       OF TRANS-CDSC-PURCHASE-REC
089740000119                  IS NOT EQUAL TO TRANS-NO OF TRANS
089750000119                 MOVE SPACES         TO CDSC-SCHEDULE OF
089760000119                                     TRANS-CDSC-PURCHASE-REC
089770000119           END-IF.
089780031007
089790031007           MOVE CDSC-SCHEDULE OF TRANS-CDSC-PURCHASE-REC
089800031007                              TO AT-DSC-SCHEDULE.
089810031007
089820031007      **********
089830031007
089840031007       PCS-EXIT.
089850031007           EXIT.
089860031007
089870031007      **********
089880031007      ******************************************************************
089890031007      *    GET OPEN  CLOSE  AND LAST YEAR UNIT PRICE
089900000119      ******************************************************************
089910000119
089920000119RF6234 GET-OPEN-CLOSE-LAST-PRICE.
089930010301
089940160201           SET IUP TO 1
089950160201           SEARCH  WS-INVUPE-ENT VARYING IUP
089960160316                AT END
089970010305                GO TO GIUP-EXIT
089980020821                WHEN WS-IUP-CODE(IUP) IS EQUAL TO
089990020821                            INVESTMENT-CODE OF ACCOUNT-INVESTMENT-REC
090000020821                     MOVE WS-IUP-OPENING(IUP) TO WS-IUP-OPENING-PRICE
090010020821                     MOVE WS-IUP-OPENING-DATE(IUP) TO  WS-IUP-DATE
090020020821                     MOVE WS-IUP-CLOSING(IUP) TO WS-IUP-CLOSING-PRICE
090030020821                     MOVE WS-IUP-LASTYEND(IUP) TO WS-IUP-LASTYEND-PRICE
090040051104                     GO TO GIUP-EXIT
090050020821R18485     END-SEARCH.
090060051104
090070051104       GIUP-EXIT.
090080051104            EXIT.
090090020821
090100051104148326*INVESTOR-SUMMARY-SECTION2.
090110051104148326*This para INVESTOR-SUMMARY-SECTION2 thru ISS2-EXIT is moved to CPYANSC12B
090120051104148326*Similrly GET-INTEREST-SECTION12 & GET-CAPITAL-GAIN-SECTION12to CPYANSC12B
090130021007
090140040414R14136******************************************************************
090150061027      *    GET-MF-REBATE-SECTION12-SUMMARY-SECTION-2
090160040414      ******************************************************************
090170040414
090180040414       GET-MF-REBATE-SECTION12.
090190051026
090200051026           ADD  WS-GROSS-AMT-EX      TO WS-IS2-MFR-INCEPT.
090210051026
090220051026           IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
090230051026              ADD WS-GROSS-AMT-EX    TO WS-IS2-MFR-YTD
090240051026           END-IF.
090250051026
090260051104           IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
090270051026              ADD WS-GROSS-AMT-EX    TO WS-IS2-MFR-CUR
090280051026           END-IF.
090290051026
090300051026      **  Check if the ROC is setup to be reported  **
090310051026R20758     IF WS-LDA-REPORT-ROC IS NOT = "Y"
090320051026  ¦           GO TO GMFR12-EXIT
090330051026  ¦        END-IF.
090340051026  ¦
090350040414R30514***** ROC was from COMPUTE-DISTRIBUTION-ROC subroutine.
090360021007  ¦   ***** Accumulate the ROC  for INCEPT, YTD, and CUR
090370021007  ¦   *****
090380021007  ¦        IF WS-ROC-FOUND IS NOT EQUAL TO  "Y"
090390021007  ¦           GO TO GMFR12-EXIT
090400021007  ¦        END-IF.
090410021007  ¦
090420020821  ¦        ADD WS-ROC-CALC-AMT     TO WS-IS2-ROC-INCEPT.
090430021004  ¦
090440021004  ¦        IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
090450021004  ¦           ADD WS-ROC-CALC-AMT  TO WS-IS2-ROC-YTD
090460021004  ¦        END-IF.
090470021004  ¦
090480021018  ¦        IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
090490180323  v           ADD WS-ROC-CALC-AMT  TO WS-IS2-ROC-CUR
090500180323R30514     END-IF.
090510180131
090520180323      **********
090530180323
090540180323       GMFR12-EXIT.
090550180323              EXIT.
090560180323
090570180323      **********
090580180323
090590180323R14858******************************************************************
090600180323      *    GET-BUY-ADJUSTMENT-SECTION12-SUMMARY-SECTION-2
090610180323      ******************************************************************
090620180323
090630180323       GET-BUY-ADJUSTMENT-SECTION12.
090640180131
090650180131      ** RFS177423 - Start **
090660180131      *    MULTIPLY UNIT-PRICE OF TRANS BY UNIT-AMT OF TRANS
090670180131176253*             GIVING WS-BAJ-UNIT-AMT.
090680180131176253*             GIVING WS-BAJ-UNIT-AMT ROUNDED
090690160316
090700021004           MOVE TRADE-DATE OF TRANS      TO ln_TradeDate.
090710160316           MOVE INVESTMENT-CODE OF TRANS TO lc_Investment_Code.
090720160316
090730051104           PERFORM GET-EXCHANGE-RATE THRU GER-EXIT.
090740051104
090750051104           COMPUTE WS-BAJ-UNIT-AMT ROUNDED = (UNIT-PRICE OF TRANS *
090760021004                                              UNIT-AMT OF TRANS) /
090770051104                                              ln_ExchangeRate
090780051104      ** RFS177423 - End   **
090790170823
090800160321      ** RFS176758 - Start **
090810170823           IF Lc_STMLTD = "Y"
090820051104              MOVE GROSS-AMT OF TRANS TO WS-BAJ-UNIT-AMT
090830021007           END-IF
090840021007      ** RFS176758 - End   **
090850021007           ADD  WS-BAJ-UNIT-AMT      TO WS-IS2-BAJ-INCEPT
090860021007
090870021007148326     IF TRADE-DATE OF TRANS-REC >= 19980101
090880021007148326        ADD  WS-BAJ-UNIT-AMT   TO WS-IS2-BAJ-INCEPT-98.
090890021007           IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
090900021004              ADD WS-BAJ-UNIT-AMT    TO WS-IS2-BAJ-YTD
090910021004           END-IF.
090920021004
090930021004           IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
090940021004              ADD WS-BAJ-UNIT-AMT    TO WS-IS2-BAJ-CUR
090950021004148326        IF REVERSE OF TRANS-REC  IS NOT EQUAL TO "Y"
090960021018148326           ADD WS-BAJ-UNIT-AMT TO WS-IS2-BAJ-CUR-HST
090970051104148326        END-IF
090980180131           END-IF.
090990180131
091000051104      **********
091010021004
091020051104       GBUY12-EXIT.
091030051104              EXIT.
091040051104
091050021004      **********
091060051104
091070051104R14858******************************************************************
091080051104      *    GET-BALANCE-FORWARD-SECTION12-SUMMARY-SECTION-2
091090021007      ******************************************************************
091100021007
091110021007       GET-BALANCE-FORWARD-SECTION12.
091120021007
091130021007           MULTIPLY UNIT-PRICE OF TRANS BY UNIT-AMT OF TRANS
091140021007176253*             GIVING WS-BFW-UNIT-AMT.
091150021007176253              GIVING WS-BFW-UNIT-AMT ROUNDED
091160010305           ADD  WS-BFW-UNIT-AMT     TO WS-IS2-BFW-INCEPT.
091170010305
091180010305           IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
091190010305              ADD WS-BFW-UNIT-AMT   TO WS-IS2-BFW-YTD
091200010305           END-IF.
091210010305
091220051104           IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
091230051104              ADD WS-BFW-UNIT-AMT    TO WS-IS2-BFW-CUR
091240051104           END-IF.
091250020219
091260010410      **********
091270010410
091280051104       GBAL12-EXIT.
091290020219              EXIT.
091300010410
091310010410      **********
091320020219RF8633******************************************************************
091330160316      *    GET-INCOME-IN-INVESTOR-SUMMARY-SECTION-2
091340170727      ******************************************************************
091350170727
091360160316       GET-INCOME-SECTION12.
091370170727
091380170727R16363     IF DISTR-OPTION-CODE OF TRANS-DISTR-DETAILS-REC = "R"
091390160316              ADD WS-GROSS-AMT-EX  TO WS-IS2-INC-INCEPT-REINV
091400051104              IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
091410020219                 ADD  WS-GROSS-AMT-EX   TO WS-IS2-INC-YTD-REINV
091420010315              END-IF
091430010305
091440160321R14317        IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
091450020131                 ADD WS-GROSS-AMT-EX TO WS-IS2-INC-CURRENT-REINV
091460170823              END-IF
091470170727           ELSE
091480170727              ADD WS-GROSS-AMT-EX  TO WS-IS2-INC-INCEPT-CASH
091490160321148326        IF TRADE-DATE OF TRANS-REC >= 19980101
091500170727      *RFS169965 - Starts
091510170823              IF lb_DSRNo OR (lb_DSRYes AND lb_DSROtherAccYes)
091520170823148326           ADD WS-GROSS-AMT-EX  TO WS-IS2-INC-INCEPT-CASH-98
091530010315              END-IF
091540010305      *RFS169965 - Starts
091550010305148326        END-IF
091560040414              IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
091570061027                 ADD WS-GROSS-AMT-EX  TO WS-IS2-INC-YTD-CASH
091580040414              END-IF
091590040414
091600040414R14317        IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
091610051026R12175           ADD WS-GROSS-AMT-EX    TO WS-IS2-INC-CURRENT-CASH
091620051026148326           IF REVERSE OF TRANS-REC IS NOT EQUAL TO "Y"
091630051026      *RFS169965 - Starts
091640051026                 IF lb_DSRNo OR (lb_DSRYes AND lb_DSROtherAccYes)
091650051026148326              ADD WS-GROSS-AMT-EX TO WS-IS2-INC-CURRENT-CASH-HST
091660051026                 END-IF
091670051026      *RFS169965 - Ends
091680051104148326           END-IF
091690051026              END-IF
091700051026           END-IF.
091710051026
091720051026      **  Check if the ROC is setup to be reported  **
091730051026R20758     IF WS-LDA-REPORT-ROC IS NOT = "Y"
091740051026  ¦           GO TO GINC12-EXIT
091750051026  ¦        END-IF.
091760051026  ¦
091770051026R30514***** ROC was from COMPUTE-DISTRIBUTION-ROC subroutine.
091780010305  ¦   ***** Accumulate the ROC  for INCEPT, YTD, and CUR
091790010305  ¦   *****
091800010305  ¦        IF WS-ROC-FOUND IS NOT EQUAL TO  "Y"
091810010305  ¦           GO TO GINC12-EXIT
091820010305  ¦        END-IF.
091830010305  ¦
091840010305  ¦        ADD WS-ROC-CALC-AMT     TO WS-IS2-ROC-INCEPT.
091850010301  ¦
091860010301  ¦        IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
091870010326  ¦           ADD WS-ROC-CALC-AMT  TO WS-IS2-ROC-YTD
091880010326  ¦        END-IF.
091890010326  ¦
091900010326  ¦        IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
091910010326  v           ADD WS-ROC-CALC-AMT  TO WS-IS2-ROC-CUR
091920010326R30514     END-IF.
091930010326
091940170620      **********
091950170620
091960170621       GINC12-EXIT.
091970170620              EXIT.
091980170620
091990170620      **********
092000170620
092010170620      ***   End RFS8633
092020170620
092030170620
092040010326RF9466******************************************************************
092050051104      *    RECOMPUTE SWI/SWI TO TRI/TRO
092060010326      ******************************************************************
092070010326
092080010326       RECOMPUTE-SWI-SWO.
092090010326
092100051028      *RFS167932 - Starts
092110051028             INITIALIZE ld_SelectDateRecom
092120051028             IF lc-LdaSelectDate = "T" AND
092130051028                 WS-LDA-STMT-CNFM-FLAG = "S"
092140051028                MOVE TRADE-DATE OF TRANS-REC   TO ld_SelectDateRecom
092150051104             ELSE
092160051104                MOVE PROCESS-DATE OF TRANS-REC TO ld_SelectDateRecom
092170051104             END-IF
092180051104      *RFS167932 - Ends
092190051104
092200051104      *****
092210051104      *****    Processing a switch in OR swich out trade Using the
092220051104      *****    Transaction Target and the offsetting Transaction, format
092230051104      *****    the OTHER fields.
092240051104      *****
092250051104
092260170620R30514     IF WS-HIDDEN-FLAG = "Y"
092270170620  ¦           INITIALIZE                   WS-SWITCH-TRANSFER-PARMS
092280051104  ¦           MOVE "N" TO  WS-HIDDEN-FLAG
092290051104  v           PERFORM GET-TARGET-TRANSACTION  THRU GTT-EXIT
092300051104R30514     END-IF.
092310051104  ¦
092320170620  ¦        IF ACCOUNT-NO OF TRANS-T-REC IS NOT EQUAL TO
092330170620  ¦           ACCOUNT-NO OF TRANS-REC
092340170620  ¦           IF SWITCHES-IN
092350051104  ¦              SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-SWI-INCEPT
092360170620  ¦                                               WS-INV-SWI-INCEPT-P
092370170620  ¦              SUBTRACT WS-GROSS-AMT-EX    FROM WS-INV-SWI-INCEPT-EX
092380051104  ¦              ADD GROSS-AMT OF TRANS       TO  WS-INV-TRI-INCEPT
092390051104  ¦                                               WS-INV-TRI-INCEPT-P
092400051104  ¦              ADD WS-GROSS-AMT-EX          TO  WS-INV-TRI-INCEPT-EX
092410051104  ¦
092420061103167932*          IF PROCESS-DATE OF TRANS > WS-CURYTDSTRDTE
092430170620167932           IF ld_SelectDateRecom    > WS-CURYTDSTRDTE
092440170620  ¦                 SUBTRACT WS-GROSS-AMT-EX  FROM WS-INV-SWI-YTD-EX
092450060630  ¦                 ADD WS-GROSS-AMT-EX       TO   WS-INV-TRI-YTD-EX
092460060630  ¦              END-IF
092470051104  ¦
092480051104167932*          IF PROCESS-DATE OF TRANS >= WS-LDA-STRDTE
092490051104167932           IF ld_SelectDateRecom    >= WS-LDA-STRDTE
092500051104  ¦                 SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-SWI-CURRENT
092510051104  ¦                 SUBTRACT WS-GROSS-AMT-EX FROM WS-INV-SWI-CURRENT-EX
092520051104167932*             IF PROCESS-DATE OF TRANS-T-REC >= WS-LDA-STRDTE
092530170620167932              IF ld_SelectDateRecom          >= WS-LDA-STRDTE
092540170620  ¦                    ADD GROSS-AMT OF TRANS  TO  WS-INV-TRI-CURRENT
092550051104  ¦                    ADD WS-GROSS-AMT-EX  TO  WS-INV-TRI-CURRENT-EX
092560051104  ¦                 END-IF
092570051104  ¦              END-IF
092580051104R36342           IF  lb-LdaAccountAdditionalInfoYes
092590170620167932*          AND PROCESS-DATE OF TRANS-REC >= LAST-12-MONTHS-DATE
092600170620167932           AND ld_SelectDateRecom        >= LAST-12-MONTHS-DATE
092610051104  v                 ADD GROSS-AMT OF TRANS TO WS-INV-TRI-LAST-12-MONTHS
092620051104R35042           END-IF
092630170620  ¦           ELSE
092640170620  ¦              SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-SWO-INCEPT
092650051104  ¦              SUBTRACT WS-GROSS-AMT-EX   FROM WS-INV-SWO-INCEPT-EX
092660051104  ¦              ADD GROSS-AMT OF TRANS     TO WS-INV-TRO-INCEPT
092670051104  ¦              ADD WS-GROSS-AMT-EX        TO WS-INV-TRO-INCEPT-EX
092680051104  ¦
092690061103167932*          IF PROCESS-DATE OF TRANS > WS-CURYTDSTRDTE
092700170620167932           IF ld_SelectDateRecom    > WS-CURYTDSTRDTE
092710170620  ¦                 SUBTRACT WS-GROSS-AMT-EX FROM WS-INV-SWO-YTD-EX
092720060630  ¦                 ADD      WS-GROSS-AMT-EX TO   WS-INV-TRO-YTD-EX
092730060630  ¦              END-IF
092740060630  ¦
092750060630167932*          IF PROCESS-DATE OF TRANS >= WS-LDA-STRDTE
092760060630167932           IF ld_SelectDateRecom    >= WS-LDA-STRDTE
092770060630  ¦                 SUBTRACT GROSS-AMT OF TRANS FROM WS-INV-SWO-CURRENT
092780060630  ¦                 SUBTRACT WS-GROSS-AMT-EX FROM WS-INV-SWO-CURRENT-EX
092790060630167932*             IF PROCESS-DATE OF TRANS-T-REC >= WS-LDA-STRDTE
092800060630167932              IF ld_SelectDateRecom          >= WS-LDA-STRDTE
092810060630  ¦                    ADD GROSS-AMT OF TRANS TO WS-INV-TRO-CURRENT
092820060630  ¦                    ADD WS-GROSS-AMT-EX    TO WS-INV-TRO-CURRENT-EX
092830060630  ¦                 END-IF
092840060630  v              END-IF
092850060630R36342           IF  lb-LdaAccountAdditionalInfoYes
092860010326167932*          AND PROCESS-DATE OF TRANS-REC >= LAST-12-MONTHS-DATE
092870010326167932           AND ld_SelectDateRecom        >= LAST-12-MONTHS-DATE
092880010326  ¦                 ADD GROSS-AMT OF TRANS TO WS-INV-TRO-LAST-12-MONTHS
092890170620  ¦              END-IF
092900010326  ¦           END-IF
092910010326R35602*    ELSE
092920010326  ¦   *       IF WS-LDA-LAST-12-MONTHS = "Y"
092930010326  ¦   *       AND PROCESS-DATE OF TRANS-REC >= LAST-12-MONTHS-DATE
092940020417  ¦   *         IF SWITCHES-IN
092950020417  ¦   *           ADD GROSS-AMT OF TRANS TO WS-INV-PURCH-LAST-12-MONTHS
092960020417  ¦   *         ELSE
092970020417  ¦   *           ADD GROSS-AMT OF TRANS TO WS-INV-REDEM-LAST-12-MONTHS
092980020417  v   *         END-IF
092990020417R35602*       END-IF
093000020417R35042     END-IF.
093010020417
093020020417      **********
093030020417
093040020417       RSS-EXIT.
093050020417           EXIT.
093060040511
093070040511      **********
093080020417
093090020417      ***   End RFS9466
093100020417
093110020417R13017****************************************************************
093120020417      *   If Adhoc in Batch, for every record in Statement Request   *
093130020417      *   file, the initial process must be ferformed.               *
093140020417      ****************************************************************
093150040511
093160040511       ADHOC-IN-BATCH-INITIALIZE.
093170040511
093180040511           IF WS-ADHOC-B-FLAG            > 0
093190040511              OPEN INPUT                 CURRENCY-CODE
093200040511           END-IF.
093210040511
09322004051118194      PERFORM MASS-ADHOC-TABLE-INITIALIZE     THRU MATI-EXIT.
093230040511
093240040511      **********
093250040511
093260040511       AIBI-EXIT.
093270040511            EXIT.
093280040511
093290040511R13017**********
093300040511
093310040511R18194****************************************************************
093320040511   ¦  *   This is the common initialize routine for all Statements   *
093330040511   ¦  *   and Confirm/Duplicate.                                     *
093340040511   ¦  ****************************************************************
093350040511   ¦   MASS-ADHOC-TABLE-INITIALIZE.
093360040511   ¦
093370040511   ¦       MOVE WS-LDA-ENDDTE            TO  WS-MKTVALUE-Q-DATE.
093380040511   ¦       MOVE ZEROS                    TO  WS-LOOP-DATE-NUM.
093390040511   ¦
093400040511   ¦  ***
093410040511   ¦  *** GIC/DII Accrued interest was calculated more than one day
093420040511   ¦  *** of the Statement end date.
093430040511   ¦
093440040511   ¦       MOVE WS-LDA-ENDDTE            TO  G2J-GREGORIAN
093450040511   ¦       MOVE ZEROS                    TO  G2J-JULIAN.
093460040511   ¦
093470040511   ¦       CALL "GRTOJUPRG" USING
093480040511   ¦                              G2J-GREGORIAN
093490040511   ¦                              G2J-JULIAN.
093500040511   ¦
093510040511   ¦       ADD 1                         TO  G2J-JULIAN.
093520040511   ¦       MOVE G2J-JULIAN               TO  J2G-JULIAN.
093530040511   ¦       MOVE ZEROS                    TO  J2G-GREGORIAN.
093540040511   ¦
093550040511   ¦       CALL "JUTOGRPRG" USING
093560040511   ¦                              J2G-JULIAN
093570040511   ¦                              J2G-GREGORIAN.
093580040511   ¦       MOVE J2G-GREGORIAN            TO  WS-GIC-DII-END-DATE.
093590040511   ¦
093600040511   ¦   MATI-0002.
093610040511   ¦
093620040511   ¦       PERFORM GET-MKT-Q-YYMMDD      THRU GMKTQYMD-EXIT.
093630040511   ¦
093640040511   ¦       EVALUATE WS-LOOP-DATE-NUM
093650040511   ¦          WHEN 0
093660040511   ¦              MOVE WS-MKT-Q-DATE     TO  WS-MKT-Q1-DATE
093670040511   ¦          WHEN 1
093680040511   ¦              MOVE WS-MKT-Q-DATE     TO  WS-MKT-Q2-DATE
093690040511   ¦          WHEN 2
093700040511   ¦              MOVE WS-MKT-Q-DATE     TO  WS-MKT-Q3-DATE
093710040511   ¦          WHEN 3
093720040511   ¦              MOVE WS-MKT-Q-DATE     TO  WS-MKT-Q4-DATE
093730040511   ¦       END-EVALUATE.
093740040511   ¦
093750040511   ¦       ADD 1                         TO  WS-LOOP-DATE-NUM.
093760040511   ¦
093770040511   ¦       IF WS-LOOP-DATE-NUM  < 4
093780040511   ¦          GO TO  MATI-0002
093790040511   ¦       END-IF.
093800040511   ¦
093810040511   ¦       MOVE ZEROS                    TO  WS-LOOP-DATE-NUM.
093820040511   ¦
093830040511   ¦  *****
093840040511   ¦  *****  GET LAST YEAR END DATE
093850040511   ¦  *****
093860040511   ¦
093870040511   ¦       MOVE WS-LDA-ENDDTE     TO WS-PRV-Y-END-DATE.
093880040511   ¦       SUBTRACT 1             FROM WS-PYED-CCYY.
093890040511   ¦       MOVE 12                TO WS-PYED-MM.
093900040511   ¦       MOVE 31                TO WS-PYED-DD.
093910040511   ¦
093920040511   ¦  *****
093930040511   ¦  *****  ZERO OUT CONTROL REPORT COUNTERS
093940040511   ¦  *****
093950040511   ¦
093960040511   ¦       MOVE ZEROES       TO WS-HOLDMAIL-CNT.
093970040511   ¦       MOVE ZEROES       TO WS-SUPPRESS-CNT.
093980040511   ¦       MOVE ZEROES       TO WS-LINE-CNT.
093990040511   ¦       MOVE ZEROES       TO WS-PAGE-CNT.
094000040511   ¦       MOVE 1            TO WS-SKIP-LN.
094010040511   ¦       MOVE "N"          TO WS-CTLREP-W-FLAG.
094020040511   ¦       IF WS-ADHOC-B-FLAG            < 1
094030040511   ¦       MOVE LOW-VALUES   TO CURR-CONTROLS
094040040511   ¦                            PREV-CONTROLS.
094050040511   ¦
094060040511   ¦       MOVE 99           TO WS-LINE-CNT.
094070040511   ¦       MOVE "N"                    TO  WS-TRNCHG-SW.
094080040511   ¦
094090040511   ¦  *****
094100040511   ¦  *****    Retrieve the system date, with century, to determine if
094110040511   ¦  *****    an alternate address is in effect.  The QCENTURY field,
094120040511   ¦  *****    accessed by the DATCCFETCH CL program, is not available
094130040511   ¦  *****    on the previous version.  Therefore, the CALL will be
094140040511   ¦  *****    replaced with hard-coding until all clients are on the
094150040511   ¦  *****    current version.
094160040511   ¦  *****
094170040511   ¦
094180040511   ¦       ACCEPT WS-DATE-YYMMDD     FROM  DATE.
094190040511   ¦
094200040511   ¦       IF  WS-DATE-YYMMDD   LESS THAN  460101
094210040511   ¦           MOVE 20                 TO  WS-DATE-CC
094220040511   ¦         ELSE
094230040511   ¦           MOVE 19                 TO  WS-DATE-CC.
094240040511   ¦
094250040511   ¦       MOVE WS-LDA-STRDTE          TO  WS-TAX-S-DATE.
094260040511   ¦       MOVE 01                     TO  WS-TAX-S-MM.
094270040511   ¦       MOVE 01                     TO  WS-TAX-S-DD.
094280040511   ¦       COMPUTE WS-TAX-S-CCYY-P = WS-TAX-S-CCYY - 1.
094290040511   ¦       MOVE 01                     TO  WS-TAX-S-MM-P.
094300040511   ¦       MOVE 01                     TO  WS-TAX-S-DD-P.
094310040511   ¦
094320040511   ¦       MOVE WS-LDA-ENDDTE          TO  WS-CURYTDSTRDTE.
094330040511   ¦       MOVE ZEROS                  TO  WS-CURYTDSTRDTE-MMDD.
094340040511   ¦
094350040511   ¦       MOVE WS-LDA-ENDDTE          TO  WS-YTDSTRDTE.
094360040511   ¦       MOVE ZEROES                 TO  WS-YTDSTRDTE-MMDD.
094370040511   ¦
094380040511   ¦       MOVE WS-YTDSTRDTE           TO  WS-PTDSTRDTE.
094390040511   ¦       SUBTRACT 1                FROM  WS-PTDSTRDTE-CCYY.
094400040511   ¦
094410040511   ¦  ****
094420040511   ¦  **** Add account based statement generation for an investor
094430040511   ¦  **** Read in investor no from account file
094440040511   ¦  ****
094450040723   ¦
094460070720   ¦   MATI-0090.
094470070720   ¦  /
094480070720   ¦  *****
094490070720   ¦  *****    Retrieve the Program Exchange Rate type.  If the record
094500040723   ¦  *****    is not found, default to the NOON rate type.
094510081103   ¦  *****
094520081103   ¦
094530081104   ¦       INITIALIZE MFAPRGERP.
094540081110   ¦       MOVE "ANNSTMTJ"             TO  PROGRAM-CODE
094550081110   ¦                                       OF PROGRAM-EXCHANGE-REC.
094560081104   ¦       MOVE "DEFAULT   "           TO  PROGRAM-ACTION
094570081104   ¦                                       OF PROGRAM-EXCHANGE-REC.
094580081104   ¦       READ PROGRAM-EXCHANGE-RATE
094590081104   ¦           INVALID KEY
094600081103   ¦               MOVE "N"            TO  EXCHANGE-RATE-TYPE
094610040723R18194                                     OF PROGRAM-EXCHANGE-REC.
094620040723      *** RFS43223 - Start
094630040723           MOVE EXCHANGE-RATE-TYPE OF PROGRAM-EXCHANGE-REC TO
094640040723             lc_ExchangeRateType
094650040723      *** RFS43223 - End
094660040723
094670040723R59263* Get Latest Exchange Rate Date
094680040723
094690040723R59263     EXEC SQL
094700040723R60069         SELECT  COALESCE(Max(Trade_Date), 0)
094710040723R59263* R60069 SELECT  Max(Trade_Date)
094720040723  |            INTO  :ld_LastTradeDate
094730040723  |            FROM  MFAEXRHMP
094740040511  |            WHERE Exchange_Rate_Type = :lc_ExchangeRateType
094750040511R59263     END-EXEC.
094760040511
094770040511R21815*****  Save the USD currency before loading the new rate  *****
094780040511
094790040511R21815     IF AIB-NOT-FIRST-USD
094800040511  ¦           SEARCH WS-CURCDE-ENT VARYING CC
094810040511  ¦             AT END MOVE ZEROES TO WS-PRV-USD-RTECLS
094820040511  ¦             WHEN WS-CC-CODE(CC) = WS-CURRENCY-USD
094830040511  ¦               MOVE WS-CC-RTECLS(CC) TO WS-PRV-USD-RTECLS
094840040511  ¦           END-SEARCH
094850040511  ¦        ELSE
094860040511  V           MOVE ZEROES TO WS-PRV-USD-RTECLS
094870040511R21815     END-IF.
094880040511
094890040511R21814*****
094900040511   ¦  *****    Load the currency code entries.  The Exchange Rate
094910040511   ¦  *****    History will be used to retrieve the exchange rate.
094920040511   ¦  *****
094930040511   ¦
094940040511R18194     INITIALIZE                      WS-CURS20-TBL.
094950040511   ¦       MOVE SPACES                 TO  WS-CURCDE-TBL.
094960040511   ¦       MOVE ZEROES                 TO  WS-CC-BSE.
094970040511   ¦       MOVE ZEROES                 TO  WS-CC-LST.
094980040511R18194     MOVE ZEROES                 TO  WS-CS20-LST.
094990040511   ¦
095000040511   ¦   MATI-0100.
095010040511   ¦
095020040511   ¦       READ CURRENCY-CODE          AT  END
095030040511   ¦           GO TO MATI-0140
095040040511   ¦       END-READ.
095050040511   ¦
095060040511   ¦       IF CURRENCY-STATUS OF CURRENCY-CODE-REC IS NOT EQUAL TO "A"
095070040511   ¦          GO TO MATI-0100
095080040511   ¦       END-IF.
095090040511   ¦
095100040511   ¦       IF  WS-CC-LST IS NOT LESS THAN  WS-CC-MAX
095110040511   ¦           DISPLAY "CURRENCY CODES (MFACURP) EXCEED PROGRAM MAXIMUM"
095120040511   ¦           GO TO MATI-0150.
095130040511   ¦
095140040511   ¦       ADD 1                       TO  WS-CC-LST
095150040511   ¦                                       WS-CS20-LST.
095160040511   ¦       SET CC                      TO  WS-CC-LST.
095170040511   ¦       SET CS20                    TO  WS-CS20-LST.
095180040511   ¦
095190040511   ¦       IF WS-CC-LST  = 1
095200040511   ¦          MOVE ZEROES              TO  WS-CS20-DTL(CS20)
095210040511   ¦          MOVE 199999              TO  WS-CS20-TOT-TOT(CS20)
095220040511   ¦       ELSE
095230040511   ¦          COMPUTE WS-CS20-DTL(CS20)     = 100000 * WS-CC-LST
095240040511   ¦          COMPUTE WS-CS20-TOT-TOT(CS20) = 99999
095250040511   ¦                                        + WS-CS20-DTL(CS20)
095260040511   ¦       END-IF.
095270040511   ¦
095280040511   ¦       MOVE CURRENCY-DDS
095290040511   ¦            OF CURRENCY-CODE-REC   TO  WS-CC-CODE (CC)
095300040511   ¦                                       WS-CS20-CODE (CS20).
095310040511   ¦       MOVE CURRENCY-DESCR
095320040511   ¦            OF CURRENCY-CODE-REC   TO  WS-CC-DESCR (CC).
095330040511   ¦       MOVE BASE-CURRENCY
095340040511   ¦            OF CURRENCY-CODE-REC   TO  WS-CC-BASE (CC).
095350040511   ¦       MOVE 1                      TO  WS-CC-RTECLS (CC).
095360040511   ¦       MOVE 1                      TO  WS-CC-RTEOPN (CC).
095370040511   ¦       MOVE 1                      TO  WS-CC-RTELYE (CC).
095380040511   ¦       MOVE EXCHANGE-RATE-TYPE
095390040511   ¦            OF PROGRAM-EXCHANGE-REC
095400040511   ¦                                   TO  WS-CC-RTETYP (CC).
095410040511   ¦
095420040511   ¦       IF  WS-CC-BASE (CC)   EQUAL TO  "Y"
095430040511   ¦           MOVE WS-CC-LST          TO  WS-CC-BSE
095440040511   ¦           GO TO MATI-0130
095450040511   V       END-IF.
095460040511
095470040511      *****
095480040511      *****    Retrieve the closing exchange rate using the requested
095490040511      *****    statement end date.
095500040511      *****
095510040511
095520040511           INITIALIZE MFAEXRHMP.
095530040511           MOVE WS-CC-CODE (CC)        TO  CURRENCY-DDS
095540040511                                           OF EXCHANGE-RATE-M-REC.
095550040511           MOVE WS-LDA-ENDDTE          TO  TRADE-DATE
095560040511                                           OF EXCHANGE-RATE-M-REC.
095570040511           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
095580040511                                           OF EXCHANGE-RATE-M-REC.
095590040511           START EXCHANGE-RATE-M
095600040511               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
095610040511               INVALID KEY
095620040511                   GO TO MATI-0110.
095630040511
095640040511           GO TO MATI-0120.
095650040511
095660040511       MATI-0110.
095670040511           READ EXCHANGE-RATE-M LAST   AT  END
095680040511               GO TO MATI-0120-0020.
095690040511
095700040511           GO TO MATI-0120-0010.
095710040511
095720040511       MATI-0120.
095730040511           READ EXCHANGE-RATE-M PRIOR  AT  END
095740040511               GO TO MATI-0120-0020.
095750040511
095760040511       MATI-0120-0010.
095770040511           IF  CURRENCY-DDS
095780040511               OF EXCHANGE-RATE-M-REC
095790040511                          IS NOT EQUAL TO  WS-CC-CODE (CC)
095800040511               GO TO MATI-0120-0020.
095810040511
095820040511           IF  EXCHANGE-RATE-TYPE
095830040511               OF EXCHANGE-RATE-M-REC
095840040511                          IS NOT EQUAL TO  WS-CC-RTETYP (CC)
095850040511               GO TO MATI-0120.
095860040511
095870040511           MOVE EXCHANGE-RATE
095880040511                OF EXCHANGE-RATE-M-REC TO  WS-CC-RTECLS (CC).
095890040511
095900040511       MATI-0120-0020.
095910040511
095920040511      *****
095930040511      *****    Retrieve the opening exchange rate using the requested
095940040511      *****    statement start date.
095950040511      *****
095960040511
095970040511           INITIALIZE MFAEXRHMP.
095980040511           MOVE WS-CC-CODE (CC)        TO  CURRENCY-DDS
095990040511                                           OF EXCHANGE-RATE-M-REC.
096000040511           MOVE WS-LDA-STRDTE          TO  TRADE-DATE
096010040511                                           OF EXCHANGE-RATE-M-REC.
096020040511           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
096030040511                                           OF EXCHANGE-RATE-M-REC.
096040040511           START EXCHANGE-RATE-M
096050040511               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
096060040511               INVALID KEY
096070040511                   GO TO MATI-0120-0030.
096080040511
096090040511           GO TO MATI-0120-0040.
096100040511
096110040511       MATI-0120-0030.
096120040511           READ EXCHANGE-RATE-M LAST   AT  END
096130040511               GO TO MATI-0125-0020.
096140040511
096150040511           GO TO MATI-0120-0050.
096160040511
096170040511       MATI-0120-0040.
096180040511           READ EXCHANGE-RATE-M PRIOR  AT  END
096190040511               GO TO MATI-0125-0020.
096200040511
096210040511       MATI-0120-0050.
096220040511           IF  CURRENCY-DDS
096230040511               OF EXCHANGE-RATE-M-REC
096240040511                          IS NOT EQUAL TO  WS-CC-CODE (CC)
096250040511               GO TO MATI-0125-0020.
096260040511
096270040511           IF  EXCHANGE-RATE-TYPE
096280040511               OF EXCHANGE-RATE-M-REC
096290040511                          IS NOT EQUAL TO  WS-CC-RTETYP (CC)
096300040511               GO TO MATI-0120-0040.
096310040511
096320040511           MOVE EXCHANGE-RATE
096330040511                OF EXCHANGE-RATE-M-REC TO  WS-CC-RTEOPN (CC).
096340040511
096350040511       MATI-0125-0020.
096360040511
096370040511      *****
096380040511      *****    Retrieve the Last Year End Date exchange rate using
096390040511      *****    Last-year-end-date.
096400040511      *****
096410040511
096420040511           INITIALIZE MFAEXRHMP.
096430040511           MOVE WS-CC-CODE (CC)        TO  CURRENCY-DDS
096440040511                                           OF EXCHANGE-RATE-M-REC.
096450040511           MOVE WS-PRV-Y-END-DATE      TO  TRADE-DATE
096460040511                                           OF EXCHANGE-RATE-M-REC.
096470040511           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
096480040511                                           OF EXCHANGE-RATE-M-REC.
096490040511           READ EXCHANGE-RATE-M
096500040511                INVALID KEY
096510040511                GO TO MATI-0125-0025
096520040511           END-READ.
096530040511
096540040511           GO TO MATI-0125-0050.
096550040511
096560040511       MATI-0125-0025.
096570040511
096580040511           INITIALIZE MFAEXRHMP.
096590040511           MOVE WS-CC-CODE (CC)        TO  CURRENCY-DDS
096600040511                                           OF EXCHANGE-RATE-M-REC.
096610040511           MOVE WS-PRV-Y-END-DATE      TO  TRADE-DATE
096620040511                                           OF EXCHANGE-RATE-M-REC.
096630040511           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
096640040511                                           OF EXCHANGE-RATE-M-REC.
096650040511           START EXCHANGE-RATE-M
096660040511               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
096670040511               INVALID KEY
096680040511                   GO TO MATI-0125-0030.
096690040511
096700040511           GO TO MATI-0125-0040.
096710040511
096720040511       MATI-0125-0030.
096730040511           READ EXCHANGE-RATE-M LAST   AT  END
096740040511               GO TO MATI-0130.
096750040511
096760040511           GO TO MATI-0125-0050.
096770040511
096780040511       MATI-0125-0040.
096790040511           READ EXCHANGE-RATE-M PRIOR  AT  END
096800040511               GO TO MATI-0130.
096810040511
096820040511       MATI-0125-0050.
096830040511           IF  CURRENCY-DDS
096840040511               OF EXCHANGE-RATE-M-REC
096850040511                          IS NOT EQUAL TO  WS-CC-CODE (CC)
096860040511               GO TO MATI-0130.
096870040511
096880040511           IF  EXCHANGE-RATE-TYPE
096890040511               OF EXCHANGE-RATE-M-REC
096900040511                          IS NOT EQUAL TO  WS-CC-RTETYP (CC)
096910040511               GO TO MATI-0125-0040.
096920040511
096930040511           MOVE EXCHANGE-RATE
096940040511                OF EXCHANGE-RATE-M-REC TO  WS-CC-RTELYE (CC).
096950040511
096960040511       MATI-0130.
096970040511
096980040511           MOVE WS-CC-LST          TO  WS-CC-CUR (CC).
096990040511           GO TO MATI-0100.
097000040511
097010040511       MATI-0140.
097020040511           IF  WS-CC-LST NOT GREATER THAN  ZEROES
097030040511               DISPLAY "NO CURRENCY CODES (MFACURP) FOUND"
097040040511               MOVE HIGH-VALUES        TO  CURR-CONTROLS
097050040511               GO TO MATI-EXIT.
097060040511
097070040511       MATI-0150.
097080040511
097090040511      *****
097100040511      *****    If the base currency was not found, abort.
097110040511      *****
097120040511
097130040511           IF  WS-CC-BSE      IS EQUAL TO  ZEROES
097140040511               DISPLAY "NO BASE CURRENCY CODE (MFACURP) FOUND"
097150040511               MOVE HIGH-VALUES        TO  CURR-CONTROLS
097160040511               GO TO MATI-EXIT.
097170040511
097180040511      *****
097190040511      *****    If the Canadian dollar currency was not found, set it to
097200040511      *****    the base currency.
097210040511      *****
097220040511
097230060621       MATI-0150-0010.
097240040511
097250040511           SET CC                      TO  1.
097260040511
097270040511       MATI-0150-0020.
097280040511
097290040511           IF  WS-CC-CUR (CC) IS EQUAL TO  ZEROES
097300040511               DISPLAY "NO CURRENCY CODE: " WS-CC-CODE (CC)
097310040511               DISPLAY "FOUND in (MFACURP)"
097320040511               MOVE WS-CC-BSE          TO  WS-CC-CUR(CC)
097330040511           END-IF.
097340040511
097350040511           IF  CC            IS LESS THAN  WS-CC-LST
097360040511               SET CC               UP BY  1
097370040511               GO TO MATI-0150-0020
097380040511           END-IF.
097390040511
097400040511      *****
097410040511      *****    If the US dollar currency was not found, set it to the
097420040511      *****    base currency.
097430040511      *****
097440040511
09745004051118194 *****
097460040511  ¦   *****    If the EUR dollar currency was not found, set it to the
097470040511  ¦   *****    base currency.
097480040511  ¦   *****
097490040511  ¦
097500040511      /
097510040511      *****
097520040511      *****    Determine if accrued interest is applicable using the
097530040511      *****    statement range end date, the system as at date and the
097540040511      *****    Business Day.  Accrued Interest is only applicable for
097550040511      *****    the current month, unless it is the period end date.
097560040511      *****
097570040511
097580040511           MOVE "N"                    TO  WS-ACCINT-SW.
097590040511
097600040511           MOVE WS-LDA-ENDDTE          TO  WS-ACCINTDTE.
097610040511           MOVE ZEROES                 TO  WS-ACCINTDTE-DD.
097620040511           IF WS-ACCINTDTE-MM          IS GREATER THAN  11
097630040511              ADD 1                    TO  WS-ACCINTDTE-CCYY
097640040511              MOVE 1                   TO  WS-ACCINTDTE-MM
097650040511           ELSE
097660040511              ADD 1                    TO  WS-ACCINTDTE-MM
097670040511           END-IF.
097680040511
097690040511           IF  WS-LDA-ENDDTE IS LESS THAN  WS-LDA-AS-AT-DATE
097700040511               GO TO MATI-0170.
097710040511
097720040511           INITIALIZE MFABUSDAP.
097730040511           MOVE WS-LDA-ENDDTE          TO  BUSINESS-DAY
097740040511                                           OF BUSINESS-DAY-REC.
097750040511           START BUSINESS-DAY-FILE
097760040511               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
097770040511               INVALID KEY
097780040511                   GO TO MATI-0170.
097790040511
097800040511       MATI-0160.
097810040511           READ BUSINESS-DAY-FILE NEXT AT  END
097820040511               GO TO MATI-0170.
097830040511
097840040511           IF  ALLOW-TRADING
097850040511               OF BUSINESS-DAY-REC
097860040511                          IS NOT EQUAL TO  "Y"
097870040511               GO TO MATI-0160.
097880040511
097890040511           IF  BUSINESS-DAY
097900040511               OF BUSINESS-DAY-REC
097910040511                      IS NOT GREATER THAN  WS-ACCINTDTE
097920040511               MOVE "Y"                TO  WS-ACCINT-SW.
097930040511
097940040511       MATI-0170.
097950040511
097960040511      *****
097970040511      *****    If GIC requested, the end date of GIC need to be
097980040511      *****    re-calculated.
097990040511      *****
098000040511
098010040511           IF WS-LDA-GIC-25               IS EQUAL TO  "Y"
098020020708              PERFORM GET-GIC-END-DATE         THRU GGED-EXIT
098030020708           END-IF.
098040020708
098050020708           IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
098060020708           AND WS-LDA-STMT-CNFM-FLAG = "S"
098070020708           AND WS-ADHOC-B-FLAG < 1
098080020708              PERFORM ADHOC-IN-BATCH-ASSET-CLASS     THRU AIBAC-EXIT
098090020708           END-IF.
098100020709   ¦
098110020709   ¦  **********
098120020709   ¦
098130020708   ¦   MATI-EXIT.
098140020708   ¦        EXIT.
098150020708   v
098160020708R18194**********
098170020708
098180020708R14142****************************************************************
098190020708      *   If Adhoc in Batch, for every record in Statement Request   *
098200020708      *   file, the initial process of Investment-Group must be      *
098210020708      *   performed for every Account.                               *
098220020708      ****************************************************************
098230020708
098240020708       ADHOC-IN-BATCH-ASSET-CLASS.
098250020708
098260020708R14142     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
098270020708           AND WS-LDA-STMT-CNFM-FLAG = "S"
098280020708           AND WS-ADHOC-B-FLAG            > 0
098290020708              OPEN INPUT                 INVESTMENT-GROUP
098300200330           END-IF.
098310200319      * RFS1027733 - Start
098320200330           PERFORM CREATE-INVESTMENT-GROUPS THRU CIG-EXIT.
098330020708      * RFS1027733 - End
098340020708       AIBAC-0230.
098350020708      /
098360020708      *****
098370020708      *****    Load the investment group entries and the asset class
098380020708      *****    entries.  The driving file is the Investment Group.  For
098390020708      *****    each record, create a table entry as follows.
098400020708      *****       1. Format the table entry using the Investment Group.
098410020708      *****       2. Read the Investment Group Category for the
098420020708      *****          description.
098430020708      *****       3. Using the passed AS AT DATE and the Investment
098440020708      *****          Group Weighting Header, determine which date of
098450020708      *****          weighting is to be used, if any.
098460020708      *****       4. If weighting is applicable for the group, read
098470020708      *****          through the Investment Group Weighting Detail.  For
098480020708      *****          each record read, the following will be executed.
098490020708      *****             a) Find the Asset Class Code table entry.  If it
098500020708      *****                is not found, create the new Asset Class Code
098510020708      *****                table entry using the Account Class
098520020708      *****                Description.
098530020708      *****             b) Read through the Investment Group Weighting
098540020708      *****                Sub-class Detail.  For each sub-class found,
098550020708      *****                find the Asset Sub-class Code, in the Asset
098560020708      *****                Class Code table, entry.  If it is not found,
098570020708      *****                create the new Asset Sub-class table entry
098580020708      *****                using the Account Class Description.  If the
098590020708      *****                sub-class percentage total does not equal
098600020708      *****                zero or 100%, the difference will be assigned
098610020708      *****                to the undefined sub-class.
098620020708      *****             c) If the class percentage total does not equal
098630020708      *****                zero or 100%, the difference will be assigned
098640020708      *****                to the undefined class.
098650020708      *****       5. If weighting is applicable, the following checks
098660020708      *****          will be performed.  If an error is detected, the
098670020708      *****          specified action will be performed.
098680020708      *****             a) All investment groups must have at least one
098690020708      *****                Asset Class specified.  If an investment
098700020708      *****                group is not specified, it will be assigned
098710020708      *****                to the undefined asset class.
098720020708      *****             b) If an Account Class has at least one
098730020708      *****                Sub-class speicifed, all investment groups
098740020708      *****                with the Account Class must also have at
098750020708      *****                least one Sub-class specified.  If an
098760020708      *****                investment group with the Account Class is
098770020708      *****                found without a Sub-class, it will be
098780020708      *****                assigned to the undefined asset sub-class.
098790020708      *****
098800020708
098810020708           MOVE SPACES                 TO  WS-INVGRP-TBL.
098820020708           MOVE ZEROES                 TO  WS-IG-LST.
098830020708
098840020708           MOVE SPACES                 TO  WS-ASTCLS-TBL.
098850020708           MOVE ZEROES                 TO  WS-AC-LST.
098860020708
098870020708       AIBAC-0240.
098880020708           READ INVESTMENT-GROUP       AT  END
098890020708               GO TO AIBAC-0250.
098900020708
098910020708           IF  WS-IG-LST IS NOT LESS THAN  WS-IG-MAX
098920020708               DISPLAY "INVESTMENT GROUPS (MFAINVGRP) EXCEED PGM MAX"
098930020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
098940020708               GO TO AIBAC-EXIT.
098950020708
098960020708           ADD 1                       TO  WS-IG-LST.
098970020708           SET IG                      TO  WS-IG-LST.
098980020708           MOVE INVESTMENT-GROUP-CODE
098990020708                OF INVESTMENT-GROUP-REC
099000020708                                       TO  WS-IG-CODE (IG).
099010020708           MOVE INVESTMENT-GROUP-CATEGORY
099020020708                OF INVESTMENT-GROUP-REC
099030020708                                       TO  WS-IG-CAT (IG).
099040020708           MOVE FIXED-OR-VARIABLE
099050020708                OF INVESTMENT-GROUP-REC
099060020708                                       TO  WS-IG-FIXVAR (IG).
099070020708           MOVE FIXED-PRICE
099080020708                OF INVESTMENT-GROUP-REC
099090020708                                       TO  WS-IG-PRC (IG).
099100020708           MOVE ZEROES                 TO  WS-IG-CLST (IG).
099110020708
099120020708           INITIALIZE MFAINVGTP.
099130020708           MOVE WS-IG-CAT (IG)         TO  INVESTMENT-GROUP-CATEGORY
099140020708                                           OF INV-CATEGORY-REC.
099150020708           READ INV-CATEGORY
099160020708               INVALID KEY
099170020708                   MOVE ALL "*"        TO  INVESTMENT-GROUP-CAT-DESCR
099180020708                                           OF INV-CATEGORY-REC.
099190020708
099200020708           MOVE INVESTMENT-GROUP-CAT-DESCR
099210020708                OF INV-CATEGORY-REC    TO  WS-IG-DESC (IG).
099220020708
099230020708      *****
099240020708      *****    Investment Group Weighting Header.
099250020708      *****
099260020708
099270020708           INITIALIZE MFAINGWHP.
099280020708           MOVE INVESTMENT-GROUP-CODE
099290020708                OF INVESTMENT-GROUP-REC
099300020708                                       TO  INVESTMENT-GROUP-CODE
099310020708                                           OF INV-GRP-WGHT-HDR-REC.
099320020708           MOVE WS-LDA-ENDDTE          TO  AS-AT-DATE
099330020708                                           OF INV-GRP-WGHT-HDR-REC.
099340020708           START INV-GROUP-WEIGHTING-HEADER
099350020708               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
099360020708               INVALID KEY
099370020708                   GO TO AIBAC-0240-0010.
099380020708
099390020708           READ INV-GROUP-WEIGHTING-HEADER PRIOR
099400020708                                       AT  END
099410020708               GO TO AIBAC-0240-0010.
099420020708
099430020708           GO TO AIBAC-0240-0020.
099440020708
099450020708       AIBAC-0240-0010.
099460020708           READ INV-GROUP-WEIGHTING-HEADER LAST
099470020708                                       AT  END
099480020708               GO TO AIBAC-0240-0240.
099490020708
099500020708       AIBAC-0240-0020.
099510020708           IF  INVESTMENT-GROUP-CODE
099520020708               OF INV-GRP-WGHT-HDR-REC
099530020708                          IS NOT EQUAL TO  INVESTMENT-GROUP-CODE
099540020708                                           OF INVESTMENT-GROUP-REC
099550020708               GO TO AIBAC-0240-0240.
099560020708
099570020708      *****
099580020708      *****    Investment Group Weighting Detail.
099590020708      *****
099600020708
099610020708           MOVE ZEROES                 TO  WS-AC-PCTTOT.
099620020708
099630020708           INITIALIZE MFAINGWDP.
099640020708           MOVE INVESTMENT-GROUP-CODE
099650020708                OF INV-GRP-WGHT-HDR-REC
099660020708                                       TO  INVESTMENT-GROUP-CODE
099670020708                                           OF INV-GRP-WGHT-DTL-REC.
099680020708           MOVE AS-AT-DATE
099690020708                OF INV-GRP-WGHT-HDR-REC
099700020708                                       TO  AS-AT-DATE
099710020708                                           OF INV-GRP-WGHT-DTL-REC.
099720020708           START INV-GROUP-WEIGHTING-DETAIL
099730020708               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
099740020708               INVALID KEY
099750020708                   GO TO AIBAC-0240-0240.
099760020708
099770020708       AIBAC-0240-0030.
099780020708           READ INV-GROUP-WEIGHTING-DETAIL NEXT
099790020708                                       AT  END
099800020708               GO TO AIBAC-0240-0200.
099810020708
099820020708           IF  AS-AT-DATE
099830020708               OF INV-GRP-WGHT-DTL-REC
099840020708                          IS NOT EQUAL TO  AS-AT-DATE
099850020708                                           OF INV-GRP-WGHT-HDR-REC
099860020708           OR  INVESTMENT-GROUP-CODE
099870020708               OF INV-GRP-WGHT-DTL-REC
099880020708                          IS NOT EQUAL TO  INVESTMENT-GROUP-CODE
099890020708                                           OF INV-GRP-WGHT-HDR-REC
099900020708               GO TO AIBAC-0240-0200.
099910020708
099920020708           IF  ASSET-CLASS-PERCENTAGE
099930020708               OF INV-GRP-WGHT-DTL-REC
099940020708                              IS EQUAL TO  00000.00
099950020708               GO TO AIBAC-0240-0190.
099960020708
099970020708           SET AC                      TO  1.
099980020708
099990020708       AIBAC-0240-0040.
100000020708           IF  AC         IS GREATER THAN  WS-AC-LST
100010020708               GO TO AIBAC-0240-0050.
100020020708
100030020708           IF  ASSET-CLASS-CODE
100040020708               OF INV-GRP-WGHT-DTL-REC
100050020708                              IS EQUAL TO  WS-AC-CODE (AC)
100060160613               GO TO AIBAC-0240-0080.
100070020708
100080020708           SET AC                   UP BY  1.
100090020708           GO TO AIBAC-0240-0040.
100100020708
100110020708       AIBAC-0240-0050.
100120020708           IF  WS-AC-LST IS NOT LESS THAN  WS-AC-MAX
100130020708               DISPLAY "ASSET CLASSES (MFAINGW*P) EXCEED PROGRAM MAX"
100140020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
100150020708               GO TO AIBAC-EXIT.
100160020708
100170020708           MOVE ASSET-CLASS-CODE
100180020708                OF INV-GRP-WGHT-DTL-REC
100190020708                                       TO  WS-AC-CODE (AC).
100200020708           MOVE ZEROES                 TO  WS-AC-PCT (AC).
100210020708           MOVE ZEROES                 TO  WS-AC-VAL (AC).
100220020708156335     MOVE ZEROES                 TO  WS-AC-BOK-VAL (AC).
100230020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 1).
100240020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 2).
100250020708           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
100260020708           MOVE ZEROES                 TO  WS-AC-SLST (AC).
100270020708
100280020708           INITIALIZE MFAACLSDP.
100290020708           MOVE WS-AC-CODE (AC)        TO  ASSET-CLASS-CODE
100300020708                                           OF ASSET-CLASS-DESCR-REC.
100310020708           MOVE SPACES                 TO  ASSET-SUB-CLASS-CODE
100320020708                                           OF ASSET-CLASS-DESCR-REC.
100330020708           START ASSET-CLASS-DESCRIPTION
100340020708               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
100350020708               INVALID KEY
100360020708                   GO TO AIBAC-0240-0070.
100370020708
100380020708       AIBAC-0240-0060.
100390020708           READ ASSET-CLASS-DESCRIPTION NEXT
100400020708                                       AT  END
100410020708               GO TO AIBAC-0240-0070.
100420020708
100430020708           IF  ASSET-SUB-CLASS-CODE
100440020708               OF ASSET-CLASS-DESCR-REC
100450020708                          IS NOT EQUAL TO  SPACES
100460020708           OR  ASSET-CLASS-CODE
100470020708               OF ASSET-CLASS-DESCR-REC
100480020708                          IS NOT EQUAL TO  WS-AC-CODE (AC)
100490020708               GO TO AIBAC-0240-0070.
100500020708
100510020708           IF  LANGUAGE-CODE
100520020708               OF ASSET-CLASS-DESCR-REC
100530020708                              IS EQUAL TO  "E"
100540020708               SET ACL                 TO  1
100550020708               MOVE DESCRIPTION
100560020708                    OF ASSET-CLASS-DESCR-REC
100570020708                                       TO  WS-AC-DESC (AC, ACL).
100580020708
100590020708           IF  LANGUAGE-CODE
100600020708               OF ASSET-CLASS-DESCR-REC
100610020708                              IS EQUAL TO  "F"
100620020708               SET ACL                 TO  2
100630020708               MOVE DESCRIPTION
100640020708                    OF ASSET-CLASS-DESCR-REC
100650020708                                       TO  WS-AC-DESC (AC, ACL).
100660020708
100670020708           GO TO AIBAC-0240-0060.
100680020708
100690020708       AIBAC-0240-0070.
100700020708           ADD 1                       TO  WS-AC-LST.
100710020708
100720020708       AIBAC-0240-0080.
100730020708           ADD 1                       TO  WS-IG-CLST (IG).
100740020708
100750020708           SET IGC                     TO  WS-IG-CLST (IG).
100760020708           SET WS-IGC-AC (IG, IGC)     TO  AC.
100770020708           DIVIDE ASSET-CLASS-PERCENTAGE
100780020708                  OF INV-GRP-WGHT-DTL-REC
100790020708                                       BY  100
100800020708                                   GIVING  WS-IGC-PCT (IG, IGC).
100810020708           MOVE ZEROES                 TO  WS-IGC-SLST (IG, IGC).
100820020708           ADD WS-IGC-PCT (IG, IGC)    TO  WS-AC-PCTTOT.
100830020708
100840020708      *****
100850020708      *****    Investment Group Weighting Sub-class Detail.
100860020708      *****
100870020708
100880020708           MOVE ZEROES                 TO  WS-ACS-PCTTOT.
100890020708
100900020708           INITIALIZE MFAINGWSP.
100910020708           MOVE INVESTMENT-GROUP-CODE
100920020708                OF INV-GRP-WGHT-DTL-REC
100930020708                                       TO  INVESTMENT-GROUP-CODE
100940020708                                           OF INV-GRP-WGHT-SCD-REC.
100950020708           MOVE AS-AT-DATE
100960020708                OF INV-GRP-WGHT-DTL-REC
100970020708                                       TO  AS-AT-DATE
100980020708                                           OF INV-GRP-WGHT-SCD-REC.
100990020708           MOVE ASSET-CLASS-CODE
101000020708                OF INV-GRP-WGHT-DTL-REC
101010020708                                       TO  ASSET-CLASS-CODE
101020020708                                           OF INV-GRP-WGHT-SCD-REC.
101030020708           START INV-GROUP-WEIGHTING-SUBCLS-DTL
101040020708               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
101050020708               INVALID KEY
101060020708                   GO TO AIBAC-0240-0190.
101070020708
101080020708       AIBAC-0240-0090.
101090020708           READ INV-GROUP-WEIGHTING-SUBCLS-DTL NEXT
101100020708                                       AT  END
101110020708               GO TO AIBAC-0240-0150.
101120020708
101130020708           IF  ASSET-CLASS-CODE
101140020708               OF INV-GRP-WGHT-SCD-REC
101150020708                          IS NOT EQUAL TO  ASSET-CLASS-CODE
101160020708                                           OF INV-GRP-WGHT-DTL-REC
101170020708           OR  AS-AT-DATE
101180020708               OF INV-GRP-WGHT-SCD-REC
101190020708                          IS NOT EQUAL TO  AS-AT-DATE
101200020708                                           OF INV-GRP-WGHT-DTL-REC
101210020708           OR  INVESTMENT-GROUP-CODE
101220020708               OF INV-GRP-WGHT-SCD-REC
101230020708                          IS NOT EQUAL TO  INVESTMENT-GROUP-CODE
101240040107                                           OF INV-GRP-WGHT-DTL-REC
101250020708               GO TO AIBAC-0240-0150.
101260020708
101270020708           IF  ASSET-SUB-CLASS-PERCENT
101280020708               OF INV-GRP-WGHT-SCD-REC
101290020708                              IS EQUAL TO  00000.00
101300020708               GO TO AIBAC-0240-0140-0010.
101310040107
101320020708           SET ACS                     TO  1.
101330020708
101340020708       AIBAC-0240-0100.
101350020708           IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
101360020708               GO TO AIBAC-0240-0110.
101370020708
101380020708           IF  ASSET-SUB-CLASS-CODE
101390040107               OF INV-GRP-WGHT-SCD-REC
101400040107R20205                        IS EQUAL TO  WS-ACS-CODE (AC, ACS)
101410040107               GO TO AIBAC-0240-0140.
101420160630
101430040107           SET ACS                  UP BY  1.
101440040107           GO TO AIBAC-0240-0100.
101450020708
101460020708       AIBAC-0240-0110.
101470040107R20205     IF  WS-AC-SLST (AC)
101480020708                         IS NOT LESS THAN  WS-AC-SMAX
101490040107               DISPLAY "ASSET SUB-CLASSES (MFAINGW*P) EXCEED PGM MAX"
101500020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
101510020708               GO TO AIBAC-EXIT.
101520020708
101530020708           MOVE ASSET-SUB-CLASS-CODE
101540020708                OF INV-GRP-WGHT-SCD-REC
101550020708R20205                                 TO  WS-ACS-CODE (AC, ACS).
101560020708  ¦        MOVE ZEROES                 TO  WS-ACS-PCT (AC, ACS).
101570020708  ¦        MOVE ZEROES                 TO  WS-ACS-VAL (AC, ACS).
101580020708161108     MOVE ZEROES                 TO  WS-ACS-BOK-VAL (AC, ACS).
101590020708  ¦        MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 1).
101600020708  V        MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 2).
101610020708
101620020708           INITIALIZE MFAACLSDP.
101630040107R20205     MOVE WS-AC-CODE (AC)        TO  ASSET-CLASS-CODE
101640020708                                           OF ASSET-CLASS-DESCR-REC.
101650020708R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  ASSET-SUB-CLASS-CODE
101660040107                                           OF ASSET-CLASS-DESCR-REC.
101670020708           START ASSET-CLASS-DESCRIPTION
101680020708               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
101690020708               INVALID KEY
101700020708                   GO TO AIBAC-0240-0130.
101710020708
101720020708       AIBAC-0240-0120.
101730020708           READ ASSET-CLASS-DESCRIPTION NEXT
101740020708                                       AT  END
101750040107               GO TO AIBAC-0240-0130.
101760020708
101770020708           IF  ASSET-SUB-CLASS-CODE
101780020708               OF ASSET-CLASS-DESCR-REC
101790020708R20205                    IS NOT EQUAL TO  WS-ACS-CODE (AC, ACS)
101800020708           OR  ASSET-CLASS-CODE
101810020708               OF ASSET-CLASS-DESCR-REC
101820020708R20205                    IS NOT EQUAL TO  WS-AC-CODE (AC)
101830040107               GO TO AIBAC-0240-0130.
101840020708
101850020708           IF  LANGUAGE-CODE
101860020708               OF ASSET-CLASS-DESCR-REC
101870020708                              IS EQUAL TO  "E"
101880040107               SET ACSL                TO  1
101890020708               MOVE DESCRIPTION
101900020708                    OF ASSET-CLASS-DESCR-REC
101910020708R20205                                 TO  WS-ACS-DESC (AC, ACS, ACSL).
101920020708
101930020708           IF  LANGUAGE-CODE
101940020708               OF ASSET-CLASS-DESCR-REC
101950020708                              IS EQUAL TO  "F"
101960020708               SET ACSL                TO  2
101970020708               MOVE DESCRIPTION
101980020708                    OF ASSET-CLASS-DESCR-REC
101990020708R20205                                 TO  WS-ACS-DESC (AC, ACS, ACSL).
102000020708
102010020708           GO TO AIBAC-0240-0120.
102020020708
102030020708       AIBAC-0240-0130.
102040020708R20205     ADD 1                       TO  WS-AC-SLST (AC).
102050020708
102060020708       AIBAC-0240-0140.
102070200319           ADD 1                       TO  WS-IGC-SLST (IG, IGC).
102080200319      * RFS1027733 - Start: use temp file/new program as I/O
102090200319      *     SET IGCS                    TO  WS-IGC-SLST (IG, IGC).
102100200319      *     SET WS-IGCS-ACS (IG, IGC, IGCS)
102110200319      *                                 TO  ACS.
102120200319           MOVE WS-IGC-SLST (IG, IGC)   TO IGCS
102130020708           MOVE ACS                     TO WS-IGCS-ACS
102140020708           DIVIDE ASSET-SUB-CLASS-PERCENT
102150020708                  OF INV-GRP-WGHT-SCD-REC
102160200319                                       BY  100
102170200319      *                            GIVING  WS-IGCS-PCT (IG, IGC, IGCS).
102180200319                                   GIVING  WS-IGCS-PCT.
102190200319           PERFORM INSERT-INVESTMENT-GROUP THRU IIG-EXIT.
102200200319      *     ADD WS-IGCS-PCT (IG, IGC, IGCS)
102210200319            ADD WS-IGCS-PCT
102220020708      * RFS1027733 - End
102230020708                                       TO  WS-ACS-PCTTOT.
102240020708
102250020708       AIBAC-0240-0140-0010.
102260040107           GO TO AIBAC-0240-0090.
102270020708
102280020708       AIBAC-0240-0150.
102290040107           IF  WS-ACS-PCTTOT  IS EQUAL TO  ZEROES
102300020708           OR  WS-ACS-PCTTOT  IS EQUAL TO  1.0000
102310020708               GO TO AIBAC-0240-0190.
102320020708
102330020708      *****
102340020708      *****    The sub-class weighting for the investment group class
102350020708      *****    does not total 100%.  Therefore, place the difference in
102360020708      *****    the undefined sub-class.  If it is not found, add it.
102370040107      *****
102380020708
102390020708           SET ACS                     TO  1.
102400020708
102410020708       AIBAC-0240-0160.
102420020708R20205     IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
102430040107               GO TO AIBAC-0240-0170.
102440040107
102450040107R20205     IF  WS-ACS-CODE (AC, ACS)
102460160630                              IS EQUAL TO  "******"
102470040107               GO TO AIBAC-0240-0180.
102480040107
102490020708           SET ACS                  UP BY  1.
102500040107           GO TO AIBAC-0240-0160.
102510020708
102520020708       AIBAC-0240-0170.
102530020708R20205     IF  WS-AC-SLST (AC)
102540020708                         IS NOT LESS THAN  WS-AC-SMAX
102550020708               DISPLAY "ASSET SUB-CLASSES (MFAINGW*P) EXCEED PGM MAX"
102560020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
102570020708               GO TO AIBAC-EXIT.
102580020708
102590020708R20205     MOVE "******"               TO  WS-ACS-CODE (AC, ACS).
102600020708  ¦        MOVE ZEROES                 TO  WS-ACS-PCT (AC, ACS).
102610020708  ¦        MOVE ZEROES                 TO  WS-ACS-VAL (AC, ACS).
102620020708161108     MOVE ZEROES                 TO  WS-ACS-BOK-VAL (AC, ACS).
102630020708  ¦        MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 1).
102640020708  V        MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 2).
102650020708
102660020708R20205     ADD 1                       TO  WS-AC-SLST (AC).
102670020708
102680020708       AIBAC-0240-0180.
102690200319           ADD 1                       TO  WS-IGC-SLST (IG, IGC).
102700200319      * RFS1027733 - Start: use file instead of array
102710200319      *    SET IGCS                    TO  WS-IGC-SLST (IG, IGC).
102720200319      *    SET WS-IGCS-ACS (IG, IGC, IGCS)
102730200319      *                                TO  ACS.
102740200319           MOVE WS-IGC-SLST (IG, IGC) TO IGCS
102750020708           MOVE ACS                   TO WS-IGCS-ACS
102760200319           SUBTRACT WS-ACS-PCTTOT    FROM  1.0000
102770200319                                   GIVING  WS-IGCS-PCT.
102780200319           PERFORM INSERT-INVESTMENT-GROUP THRU IIG-EXIT.
102790200319      *                             GIVING  WS-IGCS-PCT (IG, IGC, IGCS).
102800020708      * RFS1027733 - End
102810020708
102820020708       AIBAC-0240-0190.
102830020708           GO TO AIBAC-0240-0030.
102840020708
102850020708       AIBAC-0240-0200.
102860020708           IF  WS-AC-PCTTOT   IS EQUAL TO  ZEROES
102870020708           OR  WS-AC-PCTTOT   IS EQUAL TO  1.0000
102880020708               GO TO AIBAC-0240-0240.
102890020708
102900020708      *****
102910020708      *****    The class weighting for the investment group does not
102920020708      *****    total 100%.  Therefore, place the difference in the
102930020708      *****    undefined class.  If it is not found, add it.
102940020708      *****
102950020708
102960020708           SET AC                      TO  1.
102970020708
102980020708       AIBAC-0240-0210.
102990020708           IF  AC         IS GREATER THAN  WS-AC-LST
103000020708               GO TO AIBAC-0240-0220.
103010160613
103020020708           IF  WS-AC-CODE (AC)   EQUAL TO  "******"
103030020708               GO TO AIBAC-0240-0230.
103040020708
103050020708           SET AC                   UP BY  1.
103060020708           GO TO AIBAC-0240-0210.
103070020708
103080020708       AIBAC-0240-0220.
103090020708           IF  WS-AC-LST IS NOT LESS THAN  WS-AC-MAX
103100020708               DISPLAY "ASSET CLASSES (MFAINGW*P) EXCEED PROGRAM MAX"
103110020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
103120020708               GO TO AIBAC-EXIT.
103130020708
103140020708           MOVE "******"               TO  WS-AC-CODE (AC).
103150020708           MOVE ZEROES                 TO  WS-AC-PCT (AC).
103160020708           MOVE ZEROES                 TO  WS-AC-VAL (AC).
103170020708156335     MOVE ZEROES                 TO  WS-AC-BOK-VAL (AC).
103180020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 1).
103190020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 2).
103200020708           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
103210020708           MOVE ZEROES                 TO  WS-AC-SLST (AC).
103220020708           ADD 1                       TO  WS-AC-LST.
103230020708
103240020708       AIBAC-0240-0230.
103250020708           ADD 1                       TO  WS-IG-CLST (IG).
103260020708
103270020708           SET IGC                     TO  WS-IG-CLST (IG).
103280020708           SET WS-IGC-AC (IG, IGC)     TO  AC.
103290020708           SUBTRACT WS-AC-PCTTOT     FROM  1.0000
103300020708                                   GIVING  WS-IGC-PCT (IG, IGC).
103310020708           MOVE ZEROES                 TO  WS-IGC-SLST (IG, IGC).
103320020708
103330020708       AIBAC-0240-0240.
103340020708           GO TO AIBAC-0240.
103350020708
103360020708       AIBAC-0250.
103370020708           IF  WS-IG-LST NOT GREATER THAN  ZEROES
103380020708               DISPLAY "NO INVESTMENT GROUPS (MFAINVGRP) FOUND"
103390020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
103400020708               GO TO AIBAC-EXIT.
103410020708
103420020708      *****
103430020708      *****    If weighting is applicable, verify that all investment
103440020708      *****    groups are assigned at least one asset class and that if
103450020708      *****    an asset class has at least one sub-class specified that
103460020708      *****    all references to the asset class also have sub-classes.
103470020708      *****
103480020708
103490020708           IF  WS-AC-LST NOT GREATER THAN  ZEROES
103500020708               GO TO AIBAC-EXIT.
103510020708
103520020708           SET IG                      TO  1.
103530020708
103540020708       AIBAC-0250-0010.
103550020708           IF  WS-IG-CLST (IG)
103560020708                          IS GREATER THAN  ZEROES
103570020708               GO TO AIBAC-0250-0050.
103580020708
103590020708           SET AC                      TO  1.
103600020708
103610020708       AIBAC-0250-0020.
103620020708           IF  AC         IS GREATER THAN  WS-AC-LST
103630020708               GO TO AIBAC-0250-0030.
103640160613
103650020708           IF  WS-AC-CODE (AC)   EQUAL TO  "******"
103660020708               GO TO AIBAC-0250-0040.
103670020708
103680020708           SET AC                   UP BY  1.
103690020708           GO TO AIBAC-0250-0020.
103700020708
103710020708       AIBAC-0250-0030.
103720020708           IF  WS-AC-LST IS NOT LESS THAN  WS-AC-MAX
103730020708               DISPLAY "ASSET CLASSES (MFAINGW*P) EXCEED PROGRAM MAX"
103740020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
103750020708               GO TO AIBAC-EXIT.
103760020708
103770020708           MOVE "******"               TO  WS-AC-CODE (AC).
103780020708           MOVE ZEROES                 TO  WS-AC-PCT (AC).
103790020708           MOVE ZEROES                 TO  WS-AC-VAL (AC).
103800020708156335     MOVE ZEROES                 TO  WS-AC-BOK-VAL (AC).
103810020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 1).
103820020708           MOVE ALL "*"                TO  WS-AC-DESC (AC, 2).
103830020708           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
103840020708           MOVE ZEROES                 TO  WS-AC-SLST (AC).
103850020708           ADD 1                       TO  WS-AC-LST.
103860020708       AIBAC-0250-0040.
103870020708           ADD 1                       TO  WS-IG-CLST (IG).
103880020708           SET IGC                     TO  WS-IG-CLST (IG).
103890020708           SET WS-IGC-AC (IG, IGC)     TO  AC.
103900020708           MOVE 1.0000                 TO  WS-IGC-PCT (IG, IGC).
103910020708           MOVE ZEROES                 TO  WS-IGC-SLST (IG, IGC).
103920020708           GO TO AIBAC-0250-0110.
103930040107
103940020708       AIBAC-0250-0050.
103950020708           SET IGC                     TO  1.
103960040107
103970020708       AIBAC-0250-0060.
103980020708           IF  WS-IGC-SLST (IG, IGC)
103990020708                          IS GREATER THAN  ZEROES
104000020708               GO TO AIBAC-0250-0100.
104010020708
104020020708           SET AC                      TO  WS-IGC-AC (IG, IGC).
104030020708           IF  WS-AC-SLST (AC)   EQUAL TO  ZEROES
104040040107               GO TO AIBAC-0250-0100.
104050020708
104060020708           SET ACS                     TO  1.
104070020708
104080020708       AIBAC-0250-0070.
104090020708R20205     IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
104100040107               GO TO AIBAC-0250-0080.
104110040107
104120040107R20205     IF  WS-ACS-CODE (AC, ACS)
104130160630                              IS EQUAL TO  "******"
104140040107               GO TO AIBAC-0250-0090.
104150040107
104160020708           SET ACS                  UP BY  1.
104170020708           GO TO AIBAC-0250-0070.
104180020708
104190020708       AIBAC-0250-0080.
104200020708R20205     IF  WS-AC-SLST (AC)
104210020708                         IS NOT LESS THAN  WS-AC-SMAX
104220020708               DISPLAY "ASSET SUB-CLASSES (MFAINGW*P) EXCEED PGM MAX"
104230020708               MOVE HIGH-VALUES        TO  CURR-CONTROLS
104240020708               GO TO AIBAC-EXIT.
104250020708
104260020708R20205     MOVE "******"               TO  WS-ACS-CODE (AC, ACS).
104270020708  ¦        MOVE ZEROES                 TO  WS-ACS-PCT (AC, ACS).
104280020708  ¦        MOVE ZEROES                 TO  WS-ACS-VAL (AC, ACS).
104290020708161108     MOVE ZEROES                 TO  WS-ACS-BOK-VAL (AC, ACS).
104300020708  ¦        MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 1).
104310020708R20205     MOVE ALL "*"                TO  WS-ACS-DESC (AC, ACS, 2).
104320020708           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
104330020708           ADD 1                       TO  WS-AC-SLST (AC).
104340020708
104350020708       AIBAC-0250-0090.
104360200319           ADD 1                       TO  WS-IGC-SLST (IG, IGC).
104370200319      * RFS1027733 - Start: use file I/O instead of array
104380200319      *     SET IGCS                    TO  WS-IGC-SLST (IG, IGC).
104390200319      *     SET WS-IGCS-ACS (IG, IGC, IGCS)
104400200319      *                                 TO  ACS.
104410200319      *     MOVE 1.0000                 TO  WS-IGCS-PCT (IG, IGC, IGCS).
104420200319            MOVE WS-IGC-SLST (IG, IGC)  TO IGCS
104430200319            MOVE ACS                    TO WS-IGCS-ACS
104440200319            MOVE 1.0000                 TO WS-IGCS-PCT
104450200319            PERFORM INSERT-INVESTMENT-GROUP THRU IIG-EXIT.
104460020708      * RFS1027733 - End
104470020708
104480020708       AIBAC-0250-0100.
104490000000           IF  IGC           IS LESS THAN  WS-IG-CLST (IG)
104500000000               SET IGC              UP BY  1
104510000000               GO TO AIBAC-0250-0060.
104520000000
104530000000       AIBAC-0250-0110.
104540000000           IF  IG            IS LESS THAN  WS-IG-LST
104550000000               SET IG               UP BY  1
104560000000               GO TO AIBAC-0250-0010.
104570970108
104580970108       AIBAC-EXIT.
104590200319             EXIT.
104600200319      * RFS1027733 - Start
104610200319       CREATE-INVESTMENT-GROUPS.
104620200319             SET pncc_invgrCRTTBL TO TRUE
104630200319             PERFORM CALL-FXINVGR-PROGRAM THROUGH CFP-EXIT.
104640200319       CIG-EXIT. EXIT.
104650200319
104660200319       INSERT-INVESTMENT-GROUP.
104670200319           MOVE IG          TO  pn_invgrIG
104680200319           MOVE IGC         TO  pn_invgrIGC
104690200319           MOVE IGCS        TO  pn_invgrIGCS
104700200319           MOVE WS-IGCS-ACS TO  pn_invgrIGCS_ACS
104710200319           MOVE WS-IGCS-PCT TO  pn_invgrIGCS_PCT.
104720200319           SET pncc_invgrINSGRP TO TRUE
104730200319           PERFORM CALL-FXINVGR-PROGRAM THROUGH CFP-EXIT.
104740200319       IIG-EXIT. EXIT.
104750200319
104760200319       GET-INVESTMENT-GROUP-DATA.
104770200319           MOVE IG          TO  pn_invgrIG
104780200319           MOVE IGC         TO  pn_invgrIGC
104790200319           MOVE IGCS        TO  pn_invgrIGCS
104800200319           SET pncc_invgrGETGRP TO TRUE
104810200831           PERFORM CALL-FXINVGR-PROGRAM THROUGH CFP-EXIT.
104820200831      * RFS1102446 - Start: populate returned values
104830200831           MOVE  pn_invgrIGCS_ACS   TO WS-IGCS-ACS.
104840200831           MOVE  pn_invgrIGCS_PCT   TO WS-IGCS-PCT.
104850200319      * RFS1102446 - End
104860200319       GIGD-EXIT. EXIT.
104870200319
104880200319       CALL-FXINVGR-PROGRAM.
104890200319      * Call investment group program to I/O with temp file
104900200319             CALL "FXINVGR" USING pc_invgrActionCode
104910200319                                  pn_invgrIG
104920200319                                  pn_invgrIGC
104930200319                                  pn_invgrIGCS
104940200319                                  pn_invgrIGCS_ACS
104950200319                                  pn_invgrIGCS_PCT
104960200319                                  pn_invgrErrCode.
104970200319
104980200319       CFP-EXIT. EXIT.
104990970108      * RFS1027733 - End
105000970108R14142**********
105010970108      /
105020970108       LEVEL-REINIT-2.
105030971203
105040971203      ******************************************************************
105050030825      *                                                                *
105060970108      *    L E V E L   R E I N I T I A L I Z A T I O N   2   R T N .   *
105070040712      *                                                                *
105080040712      *        ACACTNO:    Account Number                              *
105090040712      *                                                                *
105100980406      ******************************************************************
105110980406
105120980407      *****
105130990615      *****    The account will be bypassed if:
105140990621      *****     1. The investor is being bypassed;
105150990615      *****     2. This is an ALL INVESTOR run for Investor statements,
105160990615      *****        it is a nominee account and the statement is to only
105170990615      *****        be sent to the nominee.
105180980407      *****
105190980406
105200980406           MOVE "Y"                    TO  WS-PRTSTM-SW.
105210980406R18143     MOVE "N" TO WS-CLTSPR-SW.
105220980406
105230980406R21714     MOVE "N"  TO WS-CLTSTCLT-FLAG, WS-CLTSTREP-FLAG.
105240980406R21714     MOVE "Y"  TO WS-CLTSTSPR-FLAG, WS-NOMREPSP-FLAG.
105250980406
105260980406           IF  WS-LR3BYP-SW   IS EQUAL TO  "Y"
105270980406               GO TO LR2-0010-0050.
105280030825
105290031124           MOVE ACACTYP       TO WS-ACACTYP.
105300031124
105310031124           IF  WS-LDA-STMT-CNFM-FLAG NOT = "S"
105320031124               OR WS-LDA-REQUEST-SCOPE NOT = "A"
105330031124               GO TO LR2-0006.
105340031124
105350031124980403     MOVE "N"                    TO WS-CLTSPR-SW.
105360060621980403     IF ACNOMINEE    = "Y"
105370031124980403        GO TO LR2-0000-0030.
105380031216
105390031124      *****
105400031124      *****    Processing a non-nominee account.  Initially read through
105410031124      *****    the Dealer Mailing Instruction.  If the form CLTSTSPR is
105420031124      *****    found, the client copy statement is to be suppressed.
105430031124      *****
105440031124      ***** START R18143
105450031124
105460031124R81312     IF WS-LDA-CPYSELECT  = "D"
105470031124  ¦        MOVE "DLRSTSPR  "           TO WS-FORM-CODE
105480031124  ¦        PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT
105490031124  ¦        IF WS-RETURN-CODE = "00"
105500031124  ¦           GO TO LR2-0000-0019
105510030825  ¦        END-IF
105520030825R81312     END-IF.
105530030825
105540040712R18312     IF WS-LDA-CPYSELECT  = "R"
105550040712  ¦        MOVE "REPSTSPR  "           TO WS-FORM-CODE
105560040712  ¦        PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT
105570040712  ¦        IF WS-RETURN-CODE = "00"
105580040712  ¦           GO TO LR2-0000-0019
105590040712  ¦        END-IF
105600030825  ¦
105610030825  ¦        PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
105620030825  ¦        IF WS-RETURN-CODE = "00"
105630030825  ¦           GO TO LR2-0000-0019
105640040712R18312     END-IF
105650040712R18312     END-IF.
105660040712
105670040712           MOVE "CLTSTSPR  "           TO WS-FORM-CODE.
105680040712           PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
105690040712           IF WS-RETURN-CODE = "00"
105700031124R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
105710031124R21714           MOVE "N" TO WS-CLTSTSPR-FLAG
105720030825R21714           GO TO LR2-0000-0020
105730031114R21714        ELSE
105740030825                 GO TO LR2-0000-0019
105750030825R21714        END-IF
105760030825           END-IF.
105770030825
105780980406           PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT.
105790980406           IF WS-RETURN-CODE = "00"
105800980406R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
105810980406R21714           MOVE "N" TO WS-CLTSTSPR-FLAG
105820980406R21714           GO TO LR2-0000-0020
105830980406R21714        ELSE
105840980406                 GO TO LR2-0000-0019
105850980406R21714        END-IF
105860980406           ELSE
105870980406              GO TO LR2-0000-0020
105880980406           END-IF.
105890980406
105900040712
105910040712       LR2-0000-0019.
105920980407           MOVE "Y"                    TO  WS-CLTSPR-SW.
105930980406      ***** END R18143
105940031125
105950061027       LR2-0000-0020.
105960061027           GO TO LR2-0000-0050.
105970061027
105980040924       LR2-0000-0030.
105990040924
106000040924      *****
106010031125      *****    Processing a nominee account.  Read through the Nominee
106020031125      *****    Mailing Instruction.  If the form CLTSTCLT is not found,
106030040712      *****    the client copy statement is to be suppressed.
106040040712      *****
106050040712
106060040712R21714     MOVE SPACES TO WS-SUPP-NOMINEE.
106070040712
106080040712           IF  ANNOMCODE OF INVESTOR-JOIN  EQUAL TO  SPACES
106090040712               GO TO LR2-0000-0050.
106100040712
106110040712R22848     IF  WS-LDA-NOM-FORM-CHK IS = "N" AND
106120040712  ¦            (WS-LDA-CPYSELECT IS = "R" OR WS-LDA-CPYSELECT IS = "D")
106130040712  ¦            MOVE "N" TO WS-SUPP-NOMINEE
106140031125  ¦            GO TO LR2-0000-0039
106150030825R22848     END-IF.
106160040924
106170040924R18143     MOVE "CLTSTCLT  "           TO WS-FORM-CODE.
106180031124   ¦       PERFORM GET-NOMINEE-MAILING-INST THRU GNMI-EXIT.
106190031124R18143     IF WS-RETURN-CODE = "00"
106200031124R21714        MOVE "N" TO WS-SUPP-NOMINEE
106210031114  ¦           IF WS-SKIP-CODE-VALIDATION = "Y"
106220031114  V              MOVE "Y" TO WS-CLTSTCLT-FLAG
106230031124R21714        ELSE
106240031124R18143           GO TO LR2-0000-0050
106250031114R21714        END-IF
106260031216R21714     ELSE
106270031124R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
106280031124R21714           MOVE "N" TO WS-SUPP-NOMINEE
106290031114R21714        END-IF
106300040712R18143     END-IF.
106310040712
106320040712R22848 LR2-0000-0039.
106330040712
106340040712R81312     IF WS-LDA-CPYSELECT  = "D"
106350040712   ¦       MOVE "NOMDLRSP  "           TO WS-FORM-CODE
106360031124   ¦       PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT
106370031124   ¦       IF WS-RETURN-CODE = "00"
106380031124   ¦          GO TO LR2-0000-0040
106390031124   ¦       END-IF
106400031124R18312     END-IF.
106410040712
106420040712R18312     IF WS-LDA-CPYSELECT  = "R"
106430040712   ¦       MOVE "NOMREPSP  "           TO WS-FORM-CODE
106440040712   ¦       PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT
106450040712   ¦       IF WS-RETURN-CODE = "00"
106460040712R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
106470031124  ¦              MOVE "N" TO WS-NOMREPSP-FLAG
106480031124  V              GO TO LR2-0000-0050
106490040712R21714        ELSE
106500040712   ¦             GO TO LR2-0000-0040
106510040712R21714        END-IF
106520040712   ¦       END-IF
106530040712   ¦
106540980406   ¦       MOVE "NOMREPSP  "           TO WS-FORM-CODE
106550980406   ¦       PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
106560980406   ¦       IF WS-RETURN-CODE = "00"
106570980406R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
106580030825  ¦              MOVE "N" TO WS-NOMREPSP-FLAG
106590030825  V              GO TO LR2-0000-0050
106600030825R21714        ELSE
106610030825   ¦             GO TO LR2-0000-0040
106620030825R21714        END-IF
106630030825   ¦       END-IF
106640030825R18312     END-IF.
106650040712
106660040712R21714     IF WS-SUPP-NOMINEE =  "N"
106670040712R21714        GO TO  LR2-0000-0050
106680030825R21714     END-IF.
106690030825
106700030825       LR2-0000-0040.
106710030825           MOVE "Y"                    TO  WS-CLTSPR-SW.
106720030825
106730030825       LR2-0000-0050.
106740030825      ***** START R18143
106750030825           INITIALIZE DLRREP-MAILING-INST-REC.
106760030825
106770030825           MOVE "CLTSTREP  " TO WS-FORM-CODE.
106780030825       LR2-0001.
106790030825           PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
106800030825           IF WS-RETURN-CODE = "00"
106810030825R21714        IF WS-SKIP-CODE-VALIDATION = "Y"
106820030825R21714           MOVE "Y" TO WS-CLTSTREP-FLAG
106830030825R21714        END-IF
106840030825              MOVE CORR MFADEAMIP OF DEALER-MAILING-INST-REC
106850040712                     TO MFADERMIP OF DLRREP-MAILING-INST-REC
106860030825              MOVE ACDEALREP
106870040712                     TO DEALER-REP-CODE OF DLRREP-MAILING-INST-REC
106880040712              GO TO LR2-0003
106890040712           END-IF.
106900030825
106910030825       LR2-0002.
106920040712           PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
106930040712           IF WS-RETURN-CODE NOT = "00"
106940040712                 GO TO LR2-0005
106950040712           END-IF.
106960040712
106970040712       LR2-0003.
106980040712           MOVE "CLTSTDLR  " TO WS-FORM-CODE.
106990040712           PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
107000040712           IF WS-RETURN-CODE NOT = "00"
107010040712R20804       IF WS-DLRREP-FREQ NOT = "Y"
107020040712              GO TO LR2-0005
107030040712R20804       ELSE
107040040712   |          GO TO LR2-0004
107050040712R20804       END-IF
107060040712           END-IF.
107070040712      ***** END R18143
107080040712
107090040712R20804 LR2-0004.
107100040712   |       IF WS-DLRREP-FREQ = "Y"
107110040712   |         MOVE "SUPSTREP  " TO WS-FORM-CODE
107120030825   |         PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
107130030825   |         IF WS-RETURN-CODE = "00"
107140030825   |            GO TO LR2-0010-0050
107150030825   |         END-IF
107160030825   |
107170030825   |         MOVE "CLTSTREP  " TO WS-FORM-CODE
107180030825   |         PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
107190991129   |         IF WS-RETURN-CODE NOT = "00"
107200991129   |            MOVE "CLTSTREP  " TO WS-FORM-CODE
107210991129   |            PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT
107220991129   |            IF WS-RETURN-CODE NOT = "00"
107230980407   |               GO TO LR2-0010-0050
107240990602   |            END-IF
107250980929   |         END-IF
107260980929R20804     END-IF.
107270980929
107280971024       LR2-0005.
107290970108           IF  WS-CLTSPR-SW = "Y"
107300970108991129     AND WS-LDA-STMT-VERSION NOT = "E"
107310970108R18143     AND FREQUENCY-CODE OF DEALER-MAILING-INST-REC = " "
107320980929R18143     AND FREQUENCY-CODE OF DLRREP-MAILING-INST-REC = " "
107330970108               GO TO LR2-0010-0050.
107340970108
107350971122           IF  WS-CLTSPR-SW = "Y"
107360971122           AND WS-LDA-STMT-VERSION = "E"
107370971122               GO TO LR2-0010-0050.
107380971122
107390971122       LR2-0006.
107400971122           IF  WS-LDA-NOM-FORM-CHK IS EQUAL TO "Y"
107410030826           AND ACNOMINEE IS EQUAL TO "Y"
107420030826               GO TO LR2-0007.
107430030826
107440030826           IF  WS-LDA-ALLTYP NOT EQUAL TO  "I"
107450030826           OR  ACNOMINEE  IS NOT EQUAL TO  "Y"
107460030826               GO TO LR2-0020.
107470030826
107480030826       LR2-0007.
107490030826           IF  ANNOMCODE      IS EQUAL TO  SPACES
107500030826               GO TO LR2-0020.
107510970108
107520970108      *****
107530971203      *****    The Nominee Mailing Instructions will be read depending
107540971203      *****    on whether this is a confirmation or a statement run.
107550971203      *****
107560971203
107570971203           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO  "C"
107580971203              MOVE "CONFMCLT  "       TO  WS-FORM-CODE
107590971203           ELSE
107600971203              MOVE "CLTSTCLT  "       TO  WS-FORM-CODE
107610971203           END-IF.
107620971203
107630971203R18143     PERFORM GET-NOMINEE-MAILING-INST THRU GNMI-EXIT.
107640971203   |       IF WS-RETURN-CODE = "00"
107650971203   V          GO TO LR2-0020
107660971203R18143     END-IF.
107670971203
107680971203       LR2-0010.
107690971203
107700971203      *****
107710971203      *****    If duplicate mailing is applicable, a statement must be
107720971203      *****    produced if the account is part of a duplicate mailing.
107730971203      *****    Use the Mailing List Header and the Mailing List Detail
107740971203      *****    to determine if the account is part of a duplicate
107750971203      *****    mailing.
107760971203      *****
107770971203
107780971203           IF  WS-LDA-DUP-MAIL
107790971203                          IS NOT EQUAL TO  "Y"
107800971203               GO TO LR2-0010-0050.
107810971203
107820971203           INITIALIZE MFAMLSHDP
107830971203                      OF MAIL-LIST-HEADER-REC.
107840971203           MOVE CURR-INVESTOR          TO  INVESTOR-NO
107850971203                                           OF MAIL-LIST-HEADER-REC.
107860971203           START MAIL-LIST-HEADER
107870971203               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
107880971203               INVALID KEY
107890971203                   GO TO LR2-0010-0050.
107900971203
107910971203       LR2-0010-0010.
107920971203           READ MAIL-LIST-HEADER NEXT  AT  END
107930971203               GO TO LR2-0010-0050.
107940971203
107950971203           IF  INVESTOR-NO
107960971203               OF MAIL-LIST-HEADER-REC
107970971203                          IS NOT EQUAL TO  CURR-INVESTOR
107980971203               GO TO LR2-0010-0050.
107990971203
108000971203           INITIALIZE MFAMLSDTP
108010971203                      OF MAIL-LIST-DETAILS-REC.
108020971203           MOVE MAIL-NO
108030971203                OF MAIL-LIST-HEADER-REC
108040971203                                       TO  MAIL-NO
108050030218                                           OF MAIL-LIST-DETAILS-REC.
108060030218           START MAIL-LIST-DETAILS
108070971203               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
108080971203               INVALID KEY
108090971203                   GO TO LR2-0010-0040.
108100971203
108110971203       LR2-0010-0020.
108120971203           READ MAIL-LIST-DETAILS NEXT AT  END
108130971203               GO TO LR2-0010-0040.
108140971203
108150971203           IF  MAIL-NO
108160971203               OF MAIL-LIST-DETAILS-REC
108170971203                          IS NOT EQUAL TO  MAIL-NO
108180971203                                           OF MAIL-LIST-HEADER-REC
108190971203               GO TO LR2-0010-0040.
108200971203
108210971203R16107     IF  FORM-CODE OF MAIL-LIST-DETAILS-REC NOT = "CLTSTCLT  " OR
108220971203R16107         FORM-CODE OF MAIL-LIST-DETAILS-REC NOT = "CONFMCLT  "
108230971203               GO TO LR2-0010-0030.
108240971203
108250970108           IF  SELECT-ALL-ACCTS
108260970108               OF MAIL-LIST-DETAILS-REC
108270970108                              IS EQUAL TO  "Y"
108280970108           OR  ACCOUNT-NO
108290970108               OF MAIL-LIST-DETAILS-REC
108300970526                              IS EQUAL TO  CURR-ACCOUNT
108310970526               MOVE "N"                TO  WS-PRTSTM-SW
108320990330               GO TO LR2-0020.
108330000000
108340010418       LR2-0010-0030.
108350010919           GO TO LR2-0010-0020.
108360010418
108370010418       LR2-0010-0040.
108380010418           GO TO LR2-0010-0010.
108390010418
108400010418       LR2-0010-0050.
108410010418           MOVE "Y"                    TO  WS-LR2BYP-SW.
108420010418           GO TO LR2-EXIT.
108430010418
108440010418       LR2-0020.
108450010418           MOVE "N"                    TO  WS-LR2BYP-SW.
108460010418           MOVE SPACES                 TO  WS-ACCDTL-TBL.
108470010418           MOVE ZEROES                 TO  WS-AD-LST.
108480010418           MOVE "N"                    TO  WS-WRITE-ACCOUNT-LEVEL.
108490010418
108500010418RF6725     MOVE SPACES         TO WS-MAILING-ADDRESS-INDICATOR.
108510010418
108520010418      /***  Check STMT-PRINT-OPTION for Statement Run          */
108530010418
108540010418RF9415 LR2-0020-0010-0010.
108550010418
108560010418           IF WS-LDA-STMT-CNFM-FLAG NOT = "C"
108570010418              IF ACNOMINEE OF INVESTOR-JOIN NOT = "N"
108580010418                 INITIALIZE NOMINEE-MISC-DETAILS-REC
108590010418                 MOVE NONOCODE OF INVESTOR-JOIN
108600040330                      TO NOMINEE-CODE OF NOMINEE-MISC-DETAILS-REC
108610010418                 READ NOMINEE-MISC-DETAILS
108620010418                    INVALID KEY
108630010418                     MOVE SPACES TO STMT-PRINT-OPTION
108640010418                               OF NOMINEE-MISC-DETAILS-REC
108650010418                 END-READ
108660010418                 IF STMT-PRINT-OPTION OF NOMINEE-MISC-DETAILS-REC
108670010418                               IS EQUAL TO "N"
108680010418                    PERFORM FORMAT-NOMINEE-ADDRESS   THRU  FNA-EXIT
108690040330                    MOVE "N"   TO WS-MAILING-ADDRESS-INDICATOR
108700010418                 ELSE
108710010418                    MOVE SPACES    TO
108720010418                            WS-NOMINEE-ADDR1
108730010418                            WS-NOMINEE-ADDR2
108740010418                            WS-NOMINEE-ADDR3
108750010418                            WS-NOMINEE-ADDR4
108760010418R21637                      WS-NOMINEE-CO-ATTN
108770010418                    MOVE "I"   TO WS-MAILING-ADDRESS-INDICATOR
108780010418                 END-IF
108790010418              ELSE
108800010418                 MOVE SPACES    TO
108810010418                            WS-NOMINEE-ADDR1
108820010418                            WS-NOMINEE-ADDR2
108830000624                            WS-NOMINEE-ADDR3
108840000624                            WS-NOMINEE-ADDR4
108850000624R21637                      WS-NOMINEE-CO-ATTN
108860000624                 MOVE "I"            TO WS-MAILING-ADDRESS-INDICATOR
108870040330              END-IF
108880010418              GO TO LR2-0020-0010-0030
108890020108           END-IF.
108900010418
108910020103      /***  Check CNFM-PRINT-OPTION for Confirm   Run          */
108920010418
108930010418RF9415 LR2-0020-0010-0020.
108940010418
108950000624           IF WS-LDA-STMT-CNFM-FLAG   IS EQUAL TO  "C"
108960141009              IF ACNOMINEE OF INVESTOR-JOIN NOT = "Y"
108970141009              OR NOCONFPRT OF INVESTOR-JOIN NOT = "N"
108980141009                 MOVE SPACES    TO
108990141009                            WS-NOMINEE-ADDR1
109000141009                            WS-NOMINEE-ADDR2
109010980908                            WS-NOMINEE-ADDR3
109020980908                            WS-NOMINEE-ADDR4
109030980908R21637                      WS-NOMINEE-CO-ATTN
109040980908                 MOVE "I"            TO WS-MAILING-ADDRESS-INDICATOR
109050980908r12482           MOVE IVLANCODE      TO  II-LANGUAGE-CODE
109060010418              ELSE
109070010418r12482           MOVE NOLANCD OF INVESTOR-JOIN  TO II-LANGUAGE-CODE
109080980921                 PERFORM FORMAT-NOMINEE-ADDRESS   THRU  FNA-EXIT
109090980908                 MOVE "N"            TO WS-MAILING-ADDRESS-INDICATOR
109100980908              END-IF
109110980908           END-IF.
109120980908      *RFS140552 - Begins *
109130980908           IF LNCC-POLICYCONFIRMS-YES
109140001212              MOVE IVLANCODE TO II-LANGUAGE-CODE
109150001212           END-IF.
109160001212      *RFS140552
109170001212      ****
109180001212      ****  Format confirm address for each account when an investor
109190980908      ****  has multiple accounts
109200980908      ****
109210980908
109220980908RF9415 LR2-0020-0010-0030.
109230980908
109240980908           IF WS-LDA-INV-ACC-FLAG   NOT = "Y"
109250980908              GO TO LR2-0029.
109260980918
109270980918           MOVE ZEROES TO II-ACCOUNT2.
109280980908           MOVE SPACES TO II-DEALER.
109290980908           MOVE SPACES TO II-DEALER-REP-CODE.
109300980908
109310980908      *** For Confirm, II-LANGUAGE-CODE should use Investor's
109320980908      ***              language.
109330980908
109340980908
109350980908           MOVE SPACES TO II-INVESTOR-NAME.
109360980908           MOVE SPACES TO II-INVESTOR-NAME-2.
109370980908           MOVE SPACES TO II-INVESTOR-ADDRESS1.
109380980908           MOVE SPACES TO II-INVESTOR-ADDRESS2.
109390980908           MOVE SPACES TO II-INVESTOR-ADDRESS3.
109400980908           MOVE SPACES TO II-INVESTOR-ADDRESS4.
109410980908           MOVE SPACES TO II-INVESTOR-ADDRESS5.
109420980908           MOVE SPACES TO II-FUND-986.
109430980908           MOVE SPACES TO II-FUND-902.
109440980908           MOVE SPACES TO II-HOLD-MAIL.
109450980908           MOVE SPACES TO II-POSTAL-CODE.
109460980908           MOVE SPACES TO II-COUNTRY-CODE.
109470980908
109480980908           MOVE CURR-ACCOUNT TO II-ACCOUNT2.
109490980908
109500980908      *****
109510980908      *****    Normally, the language code will be based on the
109520980908      *****    investor.  If this is an ad-hoc dealer request, override
109530980908      *****    it with the language of the dealer.
109540980908      *****
109550980908
109560980908           IF  WS-LDA-REQUEST-SCOPE
109570980908                          IS NOT EQUAL TO  "D"
109580980908           OR  WS-LDA-DLRREP-LANG
109590980908                              IS EQUAL TO  "I"
109600980908               GO TO LR2-0020-0010.
109610980908
109620980908           INITIALIZE MFADEAP.
109630980908           MOVE ACDEALER               TO  DEALER-CODE
109640980908                                           OF DEALER-REC.
109650980908           READ DEALER
109660980908               INVALID KEY
109670980908                   MOVE IVLANCODE      TO  LANGUAGE-CODE
109680980908                                           OF DEALER-REC.
109690980908
109700980908           MOVE LANGUAGE-CODE
109710980908                OF DEALER-REC          TO  II-LANGUAGE-CODE.
109720031006
109730980908       LR2-0020-0010.
109740980908
109750980908      *****
109760980908      *****    Normally, the language code will be based on the
109770980908      *****    investor.  If this is an ad-hoc dealer representative
109780980908      *****    request, override it with the language of the dealer
109790980908      *****    representative.
109800980908      *****
109810980908
109820980908           IF  WS-LDA-REQUEST-SCOPE
109830980908                          IS NOT EQUAL TO  "R"
109840980908           OR  WS-LDA-DLRREP-LANG
109850980908                              IS EQUAL TO  "I"
109860980908               GO TO LR2-0020-0020.
109870980908
109880980908R18368     INITIALIZE MFADEAREP OF DEALER-REP-REC.
109890980908           MOVE ACDEALER               TO  DEALER-CODE
109900980908                                           OF DEALER-REP-REC.
109910980908           MOVE ACDEALREP              TO  DEALER-REP-CODE
109920980908                                           OF DEALER-REP-REC.
109930980908           READ DEALER-REP
109940980908               INVALID KEY
109950980908                   MOVE IVLANCODE      TO  LANGUAGE-CODE
109960000216                                           OF DEALER-REP-REC.
109970000216
109980000216           MOVE LANGUAGE-CODE
109990000216                OF DEALER-REP-REC      TO  II-LANGUAGE-CODE.
110000000216
110010000216       LR2-0020-0020.
110020000216
110030980908      *****
110040980908      *****    If the Investor Language is not English and is not
110050980908      *****    French, default it to English.
110060980908      *****
110070980908
110080980908           IF  II-LANGUAGE-CODE
110090980908                          IS NOT EQUAL TO  "E"
110100980908           AND II-LANGUAGE-CODE
110110980908                          IS NOT EQUAL TO  "F"
110120980908               MOVE "E"                TO  II-LANGUAGE-CODE
110130980908           END-IF
110140980908
110150980908RF6362     IF WS-LDA-REQUEST-SCOPE     IS EQUAL TO  "T"
110160980908              MOVE WS-LDA-LANGUAGE-CODE   TO II-LANGUAGE-CODE
110170980908           END-IF
110180980908
110190980908      *****
110200980908      *****    Format the investor name depending on the investor
110210980908      *****    type category.
110220980908      *****
110230980908           IF  WS-IT-LST NOT GREATER THAN  ZEROES
110240980908               MOVE ALL "*"            TO  WS-INVESTOR-TYPE
110250980908               GO TO LR2-0020-0070.
110260980908
110270980908           SET IT                      TO  1.
110280980908
110290980908       LR2-0020-0050.
110300980908           IF  WS-IT-CODE (IT)   EQUAL TO  IVIVTYPCD
110310980908               MOVE WS-IT-DESC (IT)    TO  WS-INVESTOR-TYPE
110320980908               GO TO LR2-0020-0060.
110330980908
110340980908           IF  IT            IS LESS THAN  WS-IT-LST
110350980908               SET IT               UP BY  1
110360090505               GO TO LR2-0020-0050.
110370090505
110380090505           MOVE ALL "*"                TO  WS-INVESTOR-TYPE.
110390090505           GO TO LR2-0020-0070.
110400090505
110410090505       LR2-0020-0060.
110420090505           IF  WS-IT-CAT (IT)
110430090505                          IS NOT EQUAL TO  "I"
110440090505               GO TO LR2-0020-0070.
110450090505
110460090505           IF  IVFIRNAME      IS EQUAL TO  SPACES
110470090505           AND IVINITIALS     IS EQUAL TO  SPACES
110480980908           AND IVLANAME       IS EQUAL TO  SPACES
110490980908               GO TO LR2-0020-0070.
110500980908
110510980908           MOVE SPACES                 TO  WS-ADRTMP.
110520980908
11053098090866105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
11054098090866105      Set pb-adrName to True.
11055098090866105      Move IVFIRNAME                          to pc-InFirstName.
11056098090866105      Move IVINITIALS                         to pc-InInitial.
11057098090866105      Move IVLANAME                           to pc-InLastName.
110580980908
11059098090866105      Call "FXSTRTADR" using pt-StreetAddressAction,
11060098090866105                             pt-StreetAddressIn,
11061098090866105                             pt-StreetAddressOut.
11062098090866105
11063098090866105      Move pc-OutName To WS-ADRTMP.
110640980908
110650980908           MOVE WS-ADRTMP              TO  II-INVESTOR-NAME.
110660980908           GO TO LR2-0020-0080.
110670980908
110680980908       LR2-0020-0070.
110690980908           MOVE IVLEGALNM              TO  II-INVESTOR-NAME.
110700980908
110710980908       LR2-0020-0080.
110720980908           MOVE IVLEGALNM2             TO  II-INVESTOR-NAME-2.
110730980908
110740980908      *****
110750980908      *****    Determine if an alternate address exists for the
110760980908      *****    Investor.
110770980908      *****
110780980908
110790980908           INITIALIZE MFAIVRADP.
110800980908           MOVE CURR-INVESTOR          TO  INVESTOR-NO
110810980908                                           OF INVESTOR-ADDRESS-RECD.
110820980908           MOVE "IVA"                  TO  ADDR-TYPE-CODE
110830980908                                           OF INVESTOR-ADDRESS-RECD.
110840980908           READ INVESTOR-ADDRESS-FILE
110850980908               INVALID KEY
110860980908                   GO TO LR2-0021.
110870980908
110880980908      *****
110890010115      *****    An alternate address exists for the Investor.  Read the
110900010115      *****    Address to determine if it is effective, an ACTIVE START
110910010115      *****    DATE of zeroes or an ACTIVE END DATE of zeroes will be
110920010115      *****    deemed effective.  If it is, use the alternate address in
110930010115      *****    place of the regular address.
110940010115      *****
110950010115
110960010115           INITIALIZE MFAADDP.
110970010115           MOVE ADDR-NO
110980010115                OF INVESTOR-ADDRESS-RECD
110990980908                                       TO  ADDR-NO
111000980908                                           OF ADDRESS-RECD.
111010980908           READ ADDRESS-FILE
111020980908               INVALID KEY
111030980908                   GO TO LR2-0021.
111040980908
111050980908RF9060     IF  ACTIVE-START-DATE
111060980908               OF ADDRESS-RECD   NOT NUMERIC
111070980908                 MOVE ZEROES TO ACTIVE-START-DATE OF ADDRESS-RECD
111080980908           END-IF
111090980908
111100980908           IF (ACTIVE-END-DATE OF ADDRESS-RECD   NOT NUMERIC)
111110980908           OR (ACTIVE-END-DATE OF ADDRESS-RECD = ZEROES     )
111120980908                 MOVE 20991231 TO ACTIVE-END-DATE OF ADDRESS-RECD
111130980908           END-IF
111140980908
111150980908           IF  WS-DATE       IS LESS THAN  ACTIVE-START-DATE
111160980908                                           OF ADDRESS-RECD
111170980908           OR  WS-DATE    IS GREATER THAN  ACTIVE-END-DATE
111180980908                                           OF ADDRESS-RECD
111190980908               GO TO LR2-0021.
111200980908
111210980908           GO TO LR2-0022.
111220980908
111230980908       LR2-0021.
111240980908
111250980908      *****
111260980908      *****    If an alternate address does not exist or exists but is
111270980908      *****    not in effect, use the regular investor address.
111280980908      *****
111290980908
111300980908           INITIALIZE MFAIVRADP.
111310980908           MOVE CURR-INVESTOR          TO  INVESTOR-NO
111320980908                                           OF INVESTOR-ADDRESS-RECD.
111330980908           MOVE "IVR"                  TO  ADDR-TYPE-CODE
111340980908                                           OF INVESTOR-ADDRESS-RECD.
111350980908           READ INVESTOR-ADDRESS-FILE
111360980908               INVALID KEY
111370980908                   INITIALIZE MFAADDP
111380980908                   GO TO LR2-0022.
111390980908
111400000621           INITIALIZE MFAADDP.
111410000621           MOVE ADDR-NO
111420980908                OF INVESTOR-ADDRESS-RECD
111430980908                                       TO  ADDR-NO
111440980908                                           OF ADDRESS-RECD.
111450980908           READ ADDRESS-FILE
111460980908               INVALID KEY
111470980908                   INITIALIZE MFAADDP
111480980908                   GO TO LR2-0022.
111490980908
111500980908       LR2-0022.
111510980908
111520980908      ****
111530980908      ****   Read in Nominee Address File
111540980908      ****
111550980908
111560980908           GO TO LR2-0022-0000-0001.
111570980908
111580980908           MOVE NOLANCD OF INVESTOR-JOIN  TO II-LANGUAGE-CODE.
111590980908           MOVE NOLANCD OF INVESTOR-JOIN  TO AD-LANGUAGE.
111600980908
111610980908           MOVE SPACES                    TO II-INVESTOR-NAME.
111620980908           MOVE NONONAME OF INVESTOR-JOIN TO II-INVESTOR-NAME.
111630980908
111640980908           INITIALIZE INSTITUTION-BRANCH-REC.
111650980908           MOVE NOINSTIT OF INVESTOR-JOIN TO INSTITUTION-CODE
111660980908                                          OF INSTITUTION-BRANCH.
111670980908           MOVE NOBRANCH OF INVESTOR-JOIN TO BRANCH-CODE
111680980908                                          OF INSTITUTION-BRANCH.
111690980908           READ INSTITUTION-BRANCH
111700980908                INVALID KEY
111710980908                INITIALIZE MFAADDP
111720980908                INITIALIZE ADDRESS-RECD
111730980908                GO TO LR2-0022-0000-0005
111740980908           END-READ.
111750980908
111760980908           INITIALIZE INSTITUTION-ADDR-REC.
111770980908           MOVE ADDR-NO OF INSTITUTION-BRANCH TO ADDR-NO
111780980908                                   OF INSTITUTION-ADDRESS.
111790980908           READ INSTITUTION-ADDRESS
111800980908                INVALID KEY
111810980908                INITIALIZE MFAADDP
111820980908                INITIALIZE ADDRESS-RECD
111830980908                GO TO LR2-0022-0000-0005
111840980908           END-READ.
111850980908
111860980908           INITIALIZE         ADDRESS-RECD.
111870980908           MOVE INSTITUTION-ADDR-REC          TO ADDRESS-RECD.
111880980908
111890980908      *****
111900980908      *****    Format the nominee address line 1 with the Investor
111910980908      *****    Legal Name
111920980908      *****
111930980908
111940980908           MOVE SPACES                 TO  II-INVESTOR-ADDRESS1.
111950980908           MOVE IVLEGALNM              TO  II-INVESTOR-ADDRESS1.
111960980908           GO TO LR2-0022-0000-0005.
111970980908
111980980908       LR2-0022-0000-0001.
111990980908
112000980908      *****
112010980908      *****    Format the investor address line 1 with the Investor
112020980908      *****    Legal Name 2.
112030980908      *****
112040980908
112050980908980417     IF WS-LDA-STMT-VERSION NOT = "E"
112060980908980417        MOVE IVLEGALNM2          TO  II-INVESTOR-ADDRESS1.
112070980908
112080980908       LR2-0022-0000-0005.
112090090309
112100090309      *****
112110090309      *****    Format the investor address line 2 with the Care of /
112120090309      *****    Attention name.
112130090309      *****
112140090309
112150090309           MOVE CO-OR-ATTENTION
112160090309                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS2.
112170090309
112180090306      *****
112190090309      *****    Format the investor address line 3 with the street
112200090306      *****    number, street name, street type and street direction.
112210090305      *****    Each fields will be handled separately in case one or
112220090309      *****    more of the fields contain spaces.
112230090309      *****
112240090309
11225009030566105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
11226009030966105      Set pb-adrStreet   to True.
11227098090866105      Set pb-adrProvince to True.
11228009030566105      Move STREET-NO        OF ADDRESS-RECD to pc-InStreetNo.
11229009030566105      Move STREET-NAME      OF ADDRESS-RECD to pc-InStreetName.
11230009030566105      Move STREET-TYPE-CODE OF ADDRESS-RECD to pc-InStreetTypeCode.
11231009030566105      Move PROVINCE-CODE    OF ADDRESS-RECD to pc-InProvinceCode.
11232009030566105      Move CITY              OF ADDRESS-RECD to pc-InCity.
11233098090866105      Move STREET-DIRCT-CODE OF ADDRESS-RECD to pc-InDirectionCode.
11234009030566105      If COUNTRY-CODE OF ADDRESS-RECD Not = "CAN"
11235009030566105         Move COUNTRY-CODE OF ADDRESS-RECD to pc-InCountry
11236009030566105      End-If
112370980908
11238009030566105      Call "FXSTRTADR" using pt-StreetAddressAction,
11239009030566105                             pt-StreetAddressIn,
11240009030566105                             pt-StreetAddressOut.
11241009030566105
11242009030566105      Move pc-OutStreet To II-INVESTOR-ADDRESS3.
112430090305
11244009030566105 *    MOVE SPACES                 TO  WS-ADRTMP.
11245009030566105 *    STRING STREET-NO
11246009030566105 *           OF ADDRESS-RECD
11247009030566105 *                      DELIMITED BY  "  "
11248009030566105 *                              INTO  WS-ADRTMP.
112490090305
11250009030566105 *    IF  PROVINCE-CODE
11251009030566105 *        OF ADDRESS-RECD   EQUAL TO  "QC"
11252009030566105 *        GO TO LR2-0022-0000-0010.
112530980908
11254009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11255009030566105 *        STRING STREET-NAME
11256009030566105 *               OF ADDRESS-RECD
11257009030566105 *                      DELIMITED BY  "  "
11258009030566105 *                              INTO  WS-ADRTMP
11259009030566105 *      ELSE
11260009030566105 *        STRING WS-ADRTMP
11261009030566105 *                      DELIMITED BY  "  ",
11262009030566105 *               " "    DELIMITED BY  SIZE,
11263009030566105 *               STREET-NAME
11264009030566105 *               OF ADDRESS-RECD
11265009030566105 *                      DELIMITED BY  "  "
11266009030566105 *                              INTO  II-INVESTOR-ADDRESS3
11267009030566105 *        MOVE II-INVESTOR-ADDRESS3
11268009030566105 *                                TO  WS-ADRTMP.
112690980908
11270009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11271009030566105 *        STRING STREET-TYPE-CODE
11272009030566105 *               OF ADDRESS-RECD
11273009030566105 *                      DELIMITED BY  "  "
11274009030566105 *                              INTO  WS-ADRTMP
11275009030566105 *      ELSE
11276009030566105 *        STRING WS-ADRTMP
11277009030566105 *                      DELIMITED BY  "  ",
11278009030566105 *               " "    DELIMITED BY  SIZE,
11279009030566105 *               STREET-TYPE-CODE
11280009030566105 *               OF ADDRESS-RECD
11281009030566105 *                      DELIMITED BY  "  "
11282009030566105 *                              INTO  II-INVESTOR-ADDRESS3
11283009030566105 *        MOVE II-INVESTOR-ADDRESS3
11284009030566105 *                                TO  WS-ADRTMP.
112850090305
11286009030566105 *    GO TO LR2-0022-0000-0020.
11287009030566105 *
11288098090866105 *LR2-0022-0000-0010.
11289009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11290009030566105 *        STRING STREET-TYPE-CODE
11291009030566105 *               OF ADDRESS-RECD
11292009030566105 *                      DELIMITED BY  "  "
11293009030566105 *                              INTO  WS-ADRTMP
11294009030566105 *      ELSE
11295009030566105 *        STRING WS-ADRTMP
11296009030566105 *                      DELIMITED BY  "  ",
11297009030566105 *               " "    DELIMITED BY  SIZE,
11298009030566105 *               STREET-TYPE-CODE
11299009030566105 *               OF ADDRESS-RECD
11300009030566105 *                      DELIMITED BY  "  "
11301009030566105 *                              INTO  II-INVESTOR-ADDRESS3
11302009030566105 *        MOVE II-INVESTOR-ADDRESS3
11303009030566105 *                                TO  WS-ADRTMP.
113040090305
11305009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11306009030566105 *        STRING STREET-NAME
11307009030566105 *               OF ADDRESS-RECD
11308009030566105 *                      DELIMITED BY  "  "
11309009030566105 *                              INTO  WS-ADRTMP
11310009030566105 *      ELSE
11311009030566105 *        STRING WS-ADRTMP
11312009030566105 *                      DELIMITED BY  "  ",
11313009030566105 *               " "    DELIMITED BY  SIZE,
11314009030566105 *               STREET-NAME
11315009030566105 *               OF ADDRESS-RECD
11316009030566105 *                      DELIMITED BY  "  "
11317009030566105 *                              INTO  II-INVESTOR-ADDRESS3
11318009030566105 *        MOVE II-INVESTOR-ADDRESS3
11319009030566105 *                                TO  WS-ADRTMP.
11320009030566105 *LR2-0022-0000-0020.
11321009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11322098090866105 *        STRING STREET-DIRCT-CODE
11323098090866105 *               OF ADDRESS-RECD
11324098090866105 *                      DELIMITED BY  "  "
11325098090866105 *                              INTO  WS-ADRTMP
11326098090866105 *      ELSE
11327098090866105 *        STRING WS-ADRTMP
11328098090866105 *                      DELIMITED BY  "  ",
11329098090866105 *               " "    DELIMITED BY  SIZE,
11330098090866105 *               STREET-DIRCT-CODE
11331098090866105 *               OF ADDRESS-RECD
11332098090866105 *                      DELIMITED BY  "  "
11333098090866105 *                              INTO  II-INVESTOR-ADDRESS3
11334098090866105 *        MOVE II-INVESTOR-ADDRESS3
11335098090866105 *                                TO  WS-ADRTMP.
11336098090866105 *
11337098090866105 *    MOVE WS-ADRTMP              TO  II-INVESTOR-ADDRESS3.
113380980908
113390980908      *****
113400980908      *****    Format the investor address line 4 with the miscellaneous
113410980908      *****    first address.
113420980908      *****
113430980908
113440980908           MOVE MISC-FIRST-ADDR-LINE
113450980908                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS4.
113460980908
113470090309      *****
113480090306      *****    Format the investor address line 5 with the miscellaneous
113490090306      *****    second address.
113500090306      *****
113510090306
113520090306           MOVE MISC-SECOND-ADDR-LINE
113530980908                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS5.
113540090306
113550090306      *****
113560090306      *****    Format the investor address line 6 with the city and
113570980908      *****    province/state code.  If this is not a Canadian or an
113580090306      *****    American address, the province/state code will not be
113590090306      *****    included.
113600090306      *****
113610090306
113620090306           MOVE SPACES                 TO  WS-II-INVESTOR-ADDRESS6.
11363009030666105      Move pc-OutProvince         TO  WS-II-INVESTOR-ADDRESS6.
11364009030666105 *    MOVE SPACES                 TO  WS-ADRTMP.
11365098090866105 *    STRING CITY
11366009030666105 *           OF ADDRESS-RECD
11367009030666105 *                       DELIMITED BY "  "
11368009030666105 *                              INTO  WS-ADRTMP.
113690090306
11370009030666105 *    IF  PROVINCE-CODE
11371009030666105 *        OF ADDRESS-RECD   EQUAL TO  SPACES
11372009030666105 *        GO TO LR2-0022-0010.
113730090306
11374009030666105 *    IF  COUNTRY-CODE
11375009030666105 *        OF ADDRESS-RECD
11376009030666105 *                   IS NOT EQUAL TO  "CAN"
11377009030666105 *    AND COUNTRY-CODE
11378009030666105 *        OF ADDRESS-RECD
11379009030666105 *                   IS NOT EQUAL TO  "USA"
11380009030666105 *        GO TO LR2-0022-0010.
113810980908
11382009030666105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
11383009030666105 *        STRING PROVINCE-CODE
11384098090866105 *               OF ADDRESS-RECD
11385098090866105 *                      DELIMITED BY  "  "
11386098090866105 *                              INTO  WS-ADRTMP
11387098090866105 *      ELSE
11388098090866105 *        STRING WS-ADRTMP
11389098090866105 *                      DELIMITED BY  "  ",
11390098090866105 *               "  "   DELIMITED BY  SIZE,
11391098090866105 *               PROVINCE-CODE
11392098090866105 *               OF ADDRESS-RECD
11393098090866105 *                      DELIMITED BY  "  "
11394098090866105 *                              INTO  WS-II-INVESTOR-ADDRESS6
11395098090866105 *        MOVE WS-II-INVESTOR-ADDRESS6
11396098090866105 *                                TO  WS-ADRTMP.
113970980908
11398098090866105 *LR2-0022-0010.
11399098090866105 *    MOVE WS-ADRTMP              TO  WS-II-INVESTOR-ADDRESS6.
114000980908
114010980908      *****
114020980908      *****    If processing an investor address which is not Canadian,
114030980908      *****    the country code or name is to be printed on a separate
114040980908      *****    line.  If at least two blank lines exist, the country
114050980908      *****    code will be formatted on address line 6.
114060980908      *****
114070980908
114080980908           MOVE SPACES                 TO  WS-II-INVESTOR-ADDRESS7.
114090980908
114100980908           IF  COUNTRY-CODE
114110980908               OF ADDRESS-RECD   EQUAL TO  "CAN"
114120980908               GO TO LR2-0022-0040.
114130980908
114140980908           MOVE ZEROES                 TO  WS-IVRADRCNT.
114150980908           IF  II-INVESTOR-ADDRESS1
114160980908                              IS EQUAL TO  SPACES
114170980908               ADD 1                   TO  WS-IVRADRCNT.
114180980908           IF  II-INVESTOR-ADDRESS2
114190980908                              IS EQUAL TO  SPACES
114200980908               ADD 1                   TO  WS-IVRADRCNT.
114210980908           IF  II-INVESTOR-ADDRESS3
114220980908                              IS EQUAL TO  SPACES
114230090309               ADD 1                   TO  WS-IVRADRCNT.
114240090506           IF  II-INVESTOR-ADDRESS4
114250090506                              IS EQUAL TO  SPACES
114260090506               ADD 1                   TO  WS-IVRADRCNT.
114270090309           IF  II-INVESTOR-ADDRESS5
114280090309                              IS EQUAL TO  SPACES
114290090309               ADD 1                   TO  WS-IVRADRCNT.
114300090306
114310090306           IF  WS-IVRADRCNT  GREATER THAN  1
114320090306               GO TO LR2-0022-0020.
114330090306
114340090306      *****
114350090306      *****    Less than two blank lines exist, therefore the country
114360980908      *****    code will be formatted on address line 6.
114370980908      *****
114380980908
11439098090866105      Move Spaces           to lc-Line80.
11440098090866105      String function trim(WS-II-INVESTOR-ADDRESS6) "   "
11441098090866105             COUNTRY-CODE OF ADDRESS-RECD
11442098090866105             Delimited by Size
11443098090866105        Into lc-Line80.
11444098090866105      Move lc-Line80 (1:40) to WS-II-INVESTOR-ADDRESS6.
11445098090866105
11446098090866105 *    STRING WS-ADRTMP  DELIMITED BY  "   ",
11447009030966105 *           "   "      DELIMITED BY  SIZE,
11448009030666105 *           COUNTRY-CODE
11449009030666105 *           OF ADDRESS-RECD
11450009030666105 *                      DELIMITED BY  SIZE
11451009030666105 *                              INTO  WS-II-INVESTOR-ADDRESS6.
114520090306           GO TO LR2-0022-0040.
114530090306
114540980908       LR2-0022-0020.
114550090306
114560090306      *****
114570090306      *****    At least two blank lines exist, therefore format the
114580090306      *****    country on a separate line.  If American, use the country
114590090306      *****    code.  Otherwise, read the Country record and use the
114600090306      *****    full country name.
114610090306      *****
114620090306
11463009030666105      Move pc-OutCountry          TO  WS-II-INVESTOR-ADDRESS7.
114640090306
11465098090866105 *    IF  COUNTRY-CODE
11466009030666105 *        OF ADDRESS-RECD   EQUAL TO  "USA"
11467009030666105 *        MOVE COUNTRY-CODE
11468098090866105 *             OF ADDRESS-RECD    TO  WS-II-INVESTOR-ADDRESS7
11469098090866105 *        GO TO LR2-0022-0040.
114700980908
11471098090866105 *    INITIALIZE MFACOUP.
11472098090866105 *    MOVE COUNTRY-CODE
11473098090866105 *         OF ADDRESS-RECD        TO  COUNTRY-CODE
11474098090866105 *                                    OF COUNTRY-RECD.
11475098090866105 *    READ COUNTRY-FILE
11476098090866105 *        INVALID KEY
11477098090866105 *            MOVE COUNTRY-CODE
11478098090866105 *                 OF ADDRESS-RECD
11479098090866105 *                                TO  WS-II-INVESTOR-ADDRESS7
11480098090866105 *            GO TO LR2-0022-0040.
114810980908
11482098090866105 *    MOVE COUNTRY-NAME
11483098090866105 *         OF COUNTRY-RECD        TO  WS-II-INVESTOR-ADDRESS7.
114840980908
114850980908       LR2-0022-0040.
114860980908
114870980908      *****
114880980908      *****    Compress the investor address lines.
114890980908      *****
114900980908
114910980908           IF  II-INVESTOR-ADDRESS1
114920980908                          IS NOT EQUAL TO  SPACES
114930980908               GO TO LR2-0023.
114940980908
114950980908           IF  II-INVESTOR-ADDRESS2
114960980908                          IS NOT EQUAL TO  SPACES
114970980908               MOVE II-INVESTOR-ADDRESS2
114980980908                                       TO  II-INVESTOR-ADDRESS1
114990980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS2
115000980908               GO TO LR2-0023.
115010980908
115020980908           IF  II-INVESTOR-ADDRESS3
115030980908                          IS NOT EQUAL TO  SPACES
115040980908               MOVE II-INVESTOR-ADDRESS3
115050980908                                       TO  II-INVESTOR-ADDRESS1
115060980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS3
115070980908               GO TO LR2-0023.
115080980908
115090980908           IF  II-INVESTOR-ADDRESS4
115100980908                          IS NOT EQUAL TO  SPACES
115110980908               MOVE II-INVESTOR-ADDRESS4
115120980908                                       TO  II-INVESTOR-ADDRESS1
115130980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
115140980908               GO TO LR2-0023.
115150980908
115160980908           IF  II-INVESTOR-ADDRESS5
115170980908                          IS NOT EQUAL TO  SPACES
115180980908               MOVE II-INVESTOR-ADDRESS5
115190980908                                       TO  II-INVESTOR-ADDRESS1
115200980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
115210980908               GO TO LR2-0023.
115220980908
115230980908           IF  WS-II-INVESTOR-ADDRESS6
115240980908                          IS NOT EQUAL TO  SPACES
115250980908               MOVE WS-II-INVESTOR-ADDRESS6
115260980908                                       TO  II-INVESTOR-ADDRESS1
115270980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
115280980908               GO TO LR2-0023.
115290980908
115300980908           IF  WS-II-INVESTOR-ADDRESS7
115310980908                          IS NOT EQUAL TO  SPACES
115320980908               MOVE WS-II-INVESTOR-ADDRESS7
115330980908                                       TO  II-INVESTOR-ADDRESS1
115340980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
115350980908
115360980908           GO TO LR2-0026.
115370980908
115380980908       LR2-0023.
115390980908           IF  II-INVESTOR-ADDRESS2
115400980908                          IS NOT EQUAL TO  SPACES
115410980908               GO TO LR2-0024.
115420980908
115430980908           IF  II-INVESTOR-ADDRESS3
115440980908                          IS NOT EQUAL TO  SPACES
115450980908               MOVE II-INVESTOR-ADDRESS3
115460980908                                       TO  II-INVESTOR-ADDRESS2
115470980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS3
115480980908               GO TO LR2-0024.
115490980908
115500980908           IF  II-INVESTOR-ADDRESS4
115510980908                          IS NOT EQUAL TO  SPACES
115520980908               MOVE II-INVESTOR-ADDRESS4
115530980908                                       TO  II-INVESTOR-ADDRESS2
115540980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
115550980908               GO TO LR2-0024.
115560980908
115570980908           IF  II-INVESTOR-ADDRESS5
115580980908                          IS NOT EQUAL TO  SPACES
115590980908               MOVE II-INVESTOR-ADDRESS5
115600980908                                       TO  II-INVESTOR-ADDRESS2
115610980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
115620980908               GO TO LR2-0024.
115630980908
115640980908           IF  WS-II-INVESTOR-ADDRESS6
115650980908                          IS NOT EQUAL TO  SPACES
115660980908               MOVE WS-II-INVESTOR-ADDRESS6
115670980908                                       TO  II-INVESTOR-ADDRESS2
115680980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
115690980908               GO TO LR2-0024.
115700980908
115710980908           IF  WS-II-INVESTOR-ADDRESS7
115720980908                          IS NOT EQUAL TO  SPACES
115730980908               MOVE WS-II-INVESTOR-ADDRESS7
115740980908                                       TO  II-INVESTOR-ADDRESS2
115750980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
115760980908
115770980908           GO TO LR2-0026.
115780980908
115790980908       LR2-0024.
115800980908           IF  II-INVESTOR-ADDRESS3
115810980908                          IS NOT EQUAL TO  SPACES
115820980908               GO TO LR2-0025.
115830980908
115840980908           IF  II-INVESTOR-ADDRESS4
115850980908                          IS NOT EQUAL TO  SPACES
115860980908               MOVE II-INVESTOR-ADDRESS4
115870980908                                       TO  II-INVESTOR-ADDRESS3
115880980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
115890980908               GO TO LR2-0025.
115900980908
115910980908           IF  II-INVESTOR-ADDRESS5
115920980908                          IS NOT EQUAL TO  SPACES
115930980908               MOVE II-INVESTOR-ADDRESS5
115940980908                                       TO  II-INVESTOR-ADDRESS3
115950980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
115960980908               GO TO LR2-0025.
115970980908
115980980908           IF  WS-II-INVESTOR-ADDRESS6
115990980908                          IS NOT EQUAL TO  SPACES
116000980908               MOVE WS-II-INVESTOR-ADDRESS6
116010980908                                       TO  II-INVESTOR-ADDRESS3
116020980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
116030980908               GO TO LR2-0025.
116040980908
116050980908           IF  WS-II-INVESTOR-ADDRESS7
116060980908                          IS NOT EQUAL TO  SPACES
116070980908               MOVE WS-II-INVESTOR-ADDRESS7
116080980908                                       TO  II-INVESTOR-ADDRESS3
116090980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
116100980908
116110980908           GO TO LR2-0026.
116120980908
116130980908       LR2-0025.
116140980908           IF  II-INVESTOR-ADDRESS4
116150980908                          IS NOT EQUAL TO  SPACES
116160980908               GO TO LR2-0025-0010.
116170980908
116180980908           IF  II-INVESTOR-ADDRESS5
116190980908                          IS NOT EQUAL TO  SPACES
116200980908               MOVE II-INVESTOR-ADDRESS5
116210980908                                       TO  II-INVESTOR-ADDRESS4
116220980908               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
116230980908               GO TO LR2-0025-0010.
116240980908
116250980908           IF  WS-II-INVESTOR-ADDRESS6
116260980908                          IS NOT EQUAL TO  SPACES
116270980908               MOVE WS-II-INVESTOR-ADDRESS6
116280980908                                       TO  II-INVESTOR-ADDRESS4
116290980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
116300980908               GO TO LR2-0025-0010.
116310980908
116320980908           IF  WS-II-INVESTOR-ADDRESS7
116330980908                          IS NOT EQUAL TO  SPACES
116340980908               MOVE WS-II-INVESTOR-ADDRESS7
116350980908                                       TO  II-INVESTOR-ADDRESS4
116360980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
116370980908
116380980908           GO TO LR2-0026.
116390980908
116400980908       LR2-0025-0010.
116410980908           IF  II-INVESTOR-ADDRESS5
116420980908                          IS NOT EQUAL TO  SPACES
116430980908               GO TO LR2-0026.
116440980908
116450980908           IF  WS-II-INVESTOR-ADDRESS6
116460980908                          IS NOT EQUAL TO  SPACES
116470980908               MOVE WS-II-INVESTOR-ADDRESS6
116480980908                                       TO  II-INVESTOR-ADDRESS5
116490980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
116500980908               GO TO LR2-0026.
116510980908
116520980908           IF  WS-II-INVESTOR-ADDRESS7
116530980908                          IS NOT EQUAL TO  SPACES
116540980908               MOVE WS-II-INVESTOR-ADDRESS7
116550980908                                       TO  II-INVESTOR-ADDRESS5
116560980908               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
116570980908
116580980908       LR2-0026.
116590980908
116600980908      *****
116610980908      *****    Format the postal code, depending on the country code.
116620980908      *****
116630980908
116640980908           MOVE POSTAL-CODE
116650980908                OF ADDRESS-RECD        TO  WS-POSTAL.
116660980908           MOVE SPACES                 TO  WS-POSTAL-OUT.
116670980908
116680980908           IF  COUNTRY-CODE
116690980908               OF ADDRESS-RECD   EQUAL TO  "CAN"
116700980908               MOVE WS-POSTAL1         TO  WS-POSTAL-OUT1
116710141201               MOVE WS-POSTAL2         TO  WS-POSTAL-OUT2
116720141201               GO TO LR2-0027.
116730980908
116740990125           IF  COUNTRY-CODE
116750980908               OF ADDRESS-RECD
116760990125                          IS NOT EQUAL TO  "USA"
116770990125               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
116780990726               GO TO LR2-0027.
116790990125
116800980908           IF  WS-POSTALU2    IS EQUAL TO  SPACES
116810980908           OR  WS-POSTALU3    IS EQUAL TO  "-"
116820980914               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
116830980908               GO TO LR2-0027.
116840980918
116850980917           MOVE WS-POSTALU1            TO  WS-POSTAL-OUTU1.
116860980917           MOVE "-"                    TO  WS-POSTAL-OUTU2.
116870980917138436*    MOVE WS-POSTALU2            TO  WS-POSTAL-OUTU3.
116880980917138436     MOVE WS-POSTALU4            TO  WS-POSTAL-OUTU3.
116890980917       LR2-0027.
116900980914           MOVE WS-POSTAL-OUT          TO II-POSTAL-CODE.
116910970421           MOVE HOLD-MAIL
116920970421                OF ADDRESS-RECD        TO II-HOLD-MAIL.
116930970421           MOVE ACDEALER               TO II-DEALER.
116940970421           MOVE ACDEALREP              TO WS-II-SALESREP.
116950970421           MOVE ACDEALREP              TO II-DEALER-REP-CODE.
116960970421           MOVE COUNTRY-CODE
116970970429                OF ADDRESS-RECD        TO  II-COUNTRY-CODE.
116980970421           ADD  1                      TO  WS-II-ACCOUNT-COUNT.
116990970429           MOVE WS-II-ACCOUNT-COUNT    TO  II-SECTION-SEQUENCE.
117000970421
117010970429           INITIALIZE                      WS-II-SECTION-ACC.
117020970421           MOVE INVESTOR-INFO-SECTION  TO  WS-II-SECTION-ACC.
117030970421           INITIALIZE                      INVESTOR-INFO-SECTION.
117040970424           MOVE WS-II-SECTION-INV      TO  INVESTOR-INFO-SECTION.
117050970513
117060970424       LR2-0029.
117070970429      *****
117080970421      *****    Format the account type description depending on whether
117090970424      *****    a client account type or a nominee account type is being
117100970424      *****    processed.
117110970429      *****
117120970424
117130970429           MOVE SPACES                 TO  WS-ACCOUNT-TYPE.
117140970522
117150970421           SET AT1                     TO  1.
117160970429           IF  WS-AT-LST NOT GREATER THAN  ZEROES
117170970429               GO TO LR2-0030-0010.
117180970429
117190970429       LR2-0030.
117200970429           IF  ACACTYP        IS EQUAL TO  WS-AT-CODE (AT1)
117210970429           AND II-LANGUAGE-CODE  EQUAL TO  "F"
117220970429               SET ATL                 TO  2
117230970429               GO TO LR2-0030-0010.
117240970429
117250970429           IF  ACACTYP        IS EQUAL TO  WS-AT-CODE (AT1)
117260970421               SET ATL                 TO  1
117270970421               GO TO LR2-0030-0010.
117280970421
117290970421           SET AT1                  UP BY  1.
117300970421           IF  AT1    IS NOT GREATER THAN  WS-AT-LST
117310970421               GO TO LR2-0030.
117320970421
117330970421       LR2-0030-0010.
117340970421           IF  ACNOMINEE      IS EQUAL TO  "Y"
117350970513               GO TO LR2-0040.
117360970421
117370970421           IF  AT1        IS GREATER THAN  WS-AT-LST
117380970421               GO TO LR2-0060.
117390970421
117400970421           MOVE WS-AT-DESC (AT1, ATL)  TO  WS-ACCOUNT-TYPE.
117410970421           GO TO LR2-0070.
117420970421
117430970421       LR2-0040.
117440970421           IF  WS-NA-LST NOT GREATER THAN  ZEROES
117450970421               GO TO LR2-0060.
117460970421
117470970421           SET NA                      TO  1.
117480970422
117490031014       LR2-0050.
117500031014           IF  WS-NA-TYPE (NA)   EQUAL TO  ANACTYP
117510031014           AND WS-NA-LANG (NA)   EQUAL TO  II-LANGUAGE-CODE
117520031014               MOVE SPACES             TO  WS-ACCOUNT-TYPE
117530031014               MOVE WS-NA-DESC (NA)    TO  WS-ACCOUNT-TYPE
117540031014               GO TO LR2-0070.
117550031014
117560031014           IF  NA            IS LESS THAN  WS-NA-LST
117570031015               SET NA               UP BY  1
117580031015               GO TO LR2-0050.
117590031015
117600031014       LR2-0060.
117610031014           MOVE ALL "*"                TO  WS-ACCOUNT-TYPE.
117620031014
117630031014       LR2-0070.
117640031014
117650031014R17626*****
117660031014  |   *****  Load the Quarter end table WS-QRTEND-TBL.
117670031015  |   *****
117680160818  |        IF WS-LDA-FUND-ROR-FRQ       IS NOT EQUAL TO  "Y"
117690161013  |           OR  WS-LDA-ACCOUNT-ROR-FRQ  IS NOT EQUAL TO "Y"
117700160818  |             GO TO QRTEND-EXIT
117710161013  |        END-IF.
117720161013  |
117730161013  |        SET QRT    TO 1.
117740160818  |        MOVE  ZEROES TO   WS-QRT-LST.
117750031014  |        INITIALIZE WS-QRTEND-TBL.
117760031015  |
117770031015  |   *****                              *****
117780031015  |   *****  Format the start month date *****
117790031015  |   *****  using Account Creation date *****
117800031015  |   *****                              *****
117810031015  |
117820031015  |    GET-START-DATI.
117830031015  |        MOVE ACCREATDAT     TO  WS-LDA-YY-MM-DD.
117840031015  |   *RFS159955 - STARTS
117850031015      *RFS162650 - STARTS
117860031015  |        MOVE ACCREATDAT     TO WS-STR-YY-MM-DD
117870031015  |   *    MOVE 01             TO WS-STR-MM
117880031015  |   *    MOVE 01             TO WS-STR-DD
117890031015      *RFS162650 - ENDS
117900031015  |   *RFS159955 - ENDS
117910031015  |
117920031015  |   *****  Determine start date period.
117930031015  |
117940031015  |        COMPUTE WS-STR-YY = WS-LDA-YY.
117950031015  |
117960031015  |        IF WS-LDA-MM  =  1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12
117970031015  |           IF WS-LDA-DD NOT = 31
117980031015  |              COMPUTE WS-STR-MM = WS-LDA-MM + 1
117990031015  |           END-IF
118000031015  |        END-IF.
118010031015  |
118020031017  |        IF WS-LDA-MM  =  4 OR 6 OR 9 OR 11
118030031015  |           IF WS-LDA-DD NOT = 30
118040031015  |              COMPUTE WS-STR-MM = WS-LDA-MM + 1
118050031015  |           END-IF
118060031015  |        END-IF.
118070031015  |
118080031015  |        IF WS-LDA-MM  =  2
118090031015  |           IF WS-LDA-DD NOT = 28 OR 29
118100031015  |              COMPUTE WS-STR-MM = WS-LDA-MM + 1
118110031015  |           END-IF
118120031015  |        END-IF.
118130031015  |
118140031015  |    QTR-DATE-VALIDATION.
118150031015  |
118160031015  |        IF WS-STR-MM > 12
118170031015  |            MOVE 3 TO WS-STR-MM
118180031015  |            COMPUTE WS-STR-YY = WS-STR-YY + 1
118190031015  |        END-IF.
118200031015  |
118210031015  |        IF WS-STR-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12
118220031015  |            MOVE 31 TO WS-STR-DD
118230031014  |        END-IF.
118240031014  |
118250031014  |        IF WS-STR-MM = 4 OR 6 OR 9 OR 11
118260031015  |            MOVE 30 TO WS-STR-DD
118270031015  |        END-IF.
118280031014  |
118290031015  |        IF WS-STR-MM = 2
118300031014  |            DIVIDE WS-LDA-YY BY 4 GIVING WS-LEAP-YEAR
118310031015  |              REMAINDER WS-LEAP-YR-REMAINDER
118320031015  |            IF WS-LEAP-YR-REMAINDER = 0
118330031015  |               MOVE 29 TO WS-STR-DD
118340031015  |            ELSE
118350031015  |               MOVE 28 TO WS-STR-DD
118360031015  |            END-IF
118370031015  |        END-IF.
118380031014  |
118390031015  |   *****  Load the  formated date to the QRT-ENDDATE table
118400031015  |    LOAD-QRT-END-TABLE-ENTRY.
118410031015  |
118420031015  |        SET  WS-QRT-LST  TO  QRT.
118430031015  |        IF   WS-QRT-LST  IS GREATER THAN  WS-QRT-MAX
118440031015  |             GO TO  QRTEND-EXIT
118450031015  |        END-IF.
118460031015  |
118470031015  |        MOVE WS-STR-YY-MM-DD   TO     WS-QRT-ENDDATE (QRT).
118480031015  |
118490031015  |        IF WS-STR-MM = 3 OR 6 OR 9 OR 12
118500031015  |           MOVE "3M"  TO  WS-QRT-FREQ (QRT)
118510031015  |        ELSE
118520031015  |           MOVE "1M"  TO  WS-QRT-FREQ (QRT)
118530031014  |        END-IF.
118540031015  |
118550031014  |    NEXT-QRT-END-TABLE-ENTRY.
118560031014  |
118570031003  |        IF WS-STR-YY-MM-DD < WS-END-YY-MM-DD
118580031003  |           SET QRT   UP BY   1
118590031003  |
118600031003  |           IF WS-STR-MM = 3 OR 6 OR 9 OR 12
118610031003  |              ADD 3 TO WS-STR-MM
118620031003  |           ELSE
118630031003  |              ADD 1 TO WS-STR-MM
118640031003  |           END-IF
118650031003  |
118660031003  |           GO TO   QTR-DATE-VALIDATION
118670031003  |        END-IF.
118680031003  |
118690031003  |    QRTEND-EXIT.
118700031003  V
118710031003R17626
118720031003
118730031003R17527*****************************************************************
118740031003   ¦  *    Get IPS Group ID from MFACONSAP                            *
118750031003   ¦  *****************************************************************
118760031003   ¦
118770031003   ¦       IF WS-LDA-IPS-STMT      IS NOT EQUAL TO     "Y"
118780031003   ¦          GO TO LR2-0070-0010
118790031003   ¦       END-IF.
118800031003   ¦
118810031003   ¦       MOVE  CURR-ACCOUNT     TO WS-STMT-IPS-ACCOUNT-NO.
118820031003   ¦       MOVE "OPEN IPSGRPIDC1" TO WS-SQLERR-STATEMENT.
118830031003   ¦
118840031003   ¦       EXEC SQL
118850031003   ¦         OPEN IPSGRPIDC1
118860031003   ¦       END-EXEC.
118870031003   ¦
118880031003   ¦       MOVE "FETCH IPSGRPIDC1" TO WS-SQLERR-STATEMENT.
118890031003   ¦
118900031003   ¦       EXEC SQL
118910031125   ¦         FETCH NEXT FROM IPSGRPIDC1
118920031125   ¦         INTO  :WS-IPS-GROUP-ID-FETCH,
118930031003   ¦               :WS-EFFECTIVE-DATE-FETCH
118940970422   ¦       END-EXEC.
118950970422   ¦
118960970422   ¦       IF SQLCODE  = 0
118970970422   ¦          MOVE WS-IPS-GROUP-ID-FETCH TO  WS-IPS-GROUP-ID
118980970422   ¦       ELSE
118990970422   ¦          MOVE SPACES                TO  WS-IPS-GROUP-ID
119000970422   ¦       END-IF.
119010970422   ¦
119020970422   ¦       EXEC SQL
119030970422   ¦         CLOSE IPSGRPIDC1
119040970422   ¦       END-EXEC.
119050970422   v
119060970422R17527 LR2-0070-0010.
119070970422
119080970422R18515***********************************************************
119090970422
119100970422      *****
119110970422      *****    Read the Account Attribute.
119120970422      *****
119130970422
119140970422           INITIALIZE MFAACCATP.
119150970422           MOVE CURR-ACCOUNT           TO  ACCOUNT-NO
119160970422                                           OF ACCOUNT-ATTRIBUTE-REC.
119170970422           START ACCOUNT-ATTRIBUTE
119180070816               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
119190970422               INVALID KEY
119200970422                   MOVE SPACES         TO  ACCOUNT-ATTRIBUTE-CODE
119210970422                                           OF ACCOUNT-ATTRIBUTE-REC
119220970422                   GO TO LR2-0080.
119230970422
119240970422           READ ACCOUNT-ATTRIBUTE NEXT AT  END
119250970422               MOVE SPACES             TO  ACCOUNT-ATTRIBUTE-CODE
119260970422                                           OF ACCOUNT-ATTRIBUTE-REC
119270970422               GO TO LR2-0080.
119280031215
119290031215           IF  ACCOUNT-NO
119300031215               OF ACCOUNT-ATTRIBUTE-REC
119310031215                          IS NOT EQUAL TO  CURR-ACCOUNT
119320031215               MOVE SPACES             TO  ACCOUNT-ATTRIBUTE-CODE
119330031215                                           OF ACCOUNT-ATTRIBUTE-REC.
119340031215
119350031215
119360150731       LR2-0080.
119370031215
119380031215      *****
119390031215      *****    Read the Account Beneficiary.
119400031215      *****
119410031215
119420031215           MOVE SPACES                 TO  WS-ACCOUNT-BENEFICIARY.
119430031215
119440031215R19502*** Start
119450031215           MOVE CURR-ACCOUNT TO WS-ACCOUNT-NO.
119460031215
119470031215       LR2-OPEN-ACCBENC1.
119480031215           MOVE "OPEN ACCBENC1 LR2" TO WS-SQLERR-STATEMENT.
119490031215           EXEC SQL
119500031215             OPEN ACCBENC1
119510031215           END-EXEC.
119520031215149292     SET CURSOR-ACCBENC1-OPENED TO TRUE.
119530031215
119540031215       LR2-GET-ACCOUNT-BENEFICIARY.
119550031215           MOVE "FETCH ACCBENC1 LR2" TO WS-SQLERR-STATEMENT.
119560031215           EXEC SQL
119570031215            FETCH NEXT FROM ACCBENC1
119580031215            FOR :ACCBENMAX ROWS
119590031215            INTO :ABN-ACCBENC1-FIELDS
119600061027           END-EXEC.
119610061027
119620031215           IF SQLCODE > 0
119630031215              GO TO LR2-CLOSE-ACCBENC1
119640031215           END-IF.
119650031215
119660031215           COMPUTE WS-SQL-INDEX = 0.
119670031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3).
119680031215
119690031215       LR2-INCREMENT-WS-SQL-INDEX.
119700031215           ADD 1 TO WS-SQL-INDEX.
119710031215
119720031215           IF WS-SQL-INDEX > WS-SQL-ACTUAL
119730031215              GO TO LR2-GET-ACCOUNT-BENEFICIARY
119740031215           END-IF.
119750970422
119760970422           IF ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "A" AND
119770970422              ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "I"
119780030430              GO TO LR2-INCREMENT-WS-SQL-INDEX
119790030825           END-IF.
119800140417           IF ABN-FIRST-NAME(WS-SQL-INDEX) IS EQUAL TO SPACES AND
119810140417              ABN-INITIALS(WS-SQL-INDEX) IS EQUAL TO SPACES   AND
119820971223              ABN-LAST-NAME(WS-SQL-INDEX) IS EQUAL TO SPACES
119830970423               GO TO LR2-INCREMENT-WS-SQL-INDEX
119840970516           END-IF.
119850000817           PERFORM FORMAT-BENEFICIARY-NAME THRU FBN-EXIT.
119860000817       LR2-CLOSE-ACCBENC1.
119870000817           MOVE "CLOSE ACCBENC1 LR2" TO WS-SQLERR-STATEMENT.
119880000817           EXEC SQL
119890970422             CLOSE ACCBENC1
119900970422           END-EXEC
119910970422      *****
119920990619      *****    Initialize the level accumulators.
119930990619      *****
119940990619R17199     INITIALIZE  WS-BENEF-TBL.
119950990619R18147     INITIALIZE  ACMBVALU-EXCHANGE-ARRAY.
119960990619129378     INITIALIZE  lc_GICMatVAlue.
119970990619129378     INITIALIZE  li_PopMATidx.
119980990619           MOVE ZEROES                 TO  WS-ACC-CDN-CPG.
119990990619           MOVE ZEROES                 TO  WS-ACC-CDN-MVB.
120000990619           MOVE ZEROES                 TO  WS-ACC-CDN-MVP.
120010990619RF7503     MOVE ZEROES                 TO  WS-ACC-CDN-MVB-Q1.
120020990619           MOVE ZEROES                 TO  WS-ACC-CDN-MVB-Q2.
120030971024           MOVE ZEROES                 TO  WS-ACC-CDN-MVB-Q3.
120040970423           MOVE ZEROES                 TO  WS-ACC-CDN-MVB-Q4.
120050970423           MOVE ZEROES                 TO  WS-ACC-CPG-YTD.
120060970423           MOVE ZEROES                 TO  WS-ACC-INC-YTD.
120070971223           MOVE ZEROES                 TO  WS-ACC-INT-YTD.
120080970423           MOVE ZEROES                 TO  WS-ACC-PUR-YTD.
120090970423           MOVE ZEROES                 TO  WS-ACC-RED-YTD.
120100970423           MOVE ZEROES                 TO  WS-ACC-REG-CTB-CUR.
120110981215           MOVE ZEROES                 TO  WS-ACC-REG-CTB-INCPT.
120120981215           MOVE ZEROES                 TO  WS-ACC-CPG-YTD-EX.
120130990615           MOVE ZEROES                 TO  WS-ACC-INC-YTD-EX.
120140990615           MOVE ZEROES                 TO  WS-ACC-INT-YTD-EX.
120150030324           MOVE ZEROES                 TO  WS-ACC-PUR-YTD-EX.
120160980521           MOVE ZEROES                 TO  WS-ACC-RED-YTD-EX.
120170980521           MOVE ZEROES                 TO  WS-ACC-REG-CTB-CUR-EX.
120180980521           MOVE ZEROES                 TO  WS-ACC-REG-CTB-INCPT-EX.
120190980521           MOVE ZEROES                 TO  WS-ACC-OPNMKTVAL.
120200980627           MOVE ZEROES                 TO  WS-ACC-NRTAX-CUR.
120210980604           MOVE ZEROES                 TO  WS-ACC-NRTAX-INC.
120220980604           MOVE ZEROES                 TO  WS-ACC-NRTAX-YTD.
120230981215           MOVE ZEROES                 TO  WS-ACC-USD-CPG.
120240970422           MOVE ZEROES                 TO  WS-ACC-WHTAX-CUR.
120250981215           MOVE ZEROES                 TO  WS-ACC-WHTAX-INC.
120260981216           MOVE ZEROES                 TO  WS-ACC-WHTAX-YTD.
120270981215           MOVE ZEROES                 TO  WS-ACC-WHTAX-PRV.
120280010604           MOVE ZEROES                 TO  WS-ACC-TINCOME-PRV.
120290051024           MOVE ZEROES                 TO  WS-EEC-TOTAL.
120300171011           MOVE ZEROES                 TO  WS-ERC-TOTAL.
120310171011           MOVE ZEROES                 TO  WS-EEC-ERC-TOTAL.
120320171011           MOVE ZEROES                 TO  WS-EEC-REMAINDER.
120330171011           MOVE ZEROES                 TO  WS-EEC-1ST60.
120340171011           MOVE ZEROES                 TO  WS-ERC-REMAINDER.
120350171011           MOVE ZEROES                 TO  WS-ERC-1ST60.
120360171013           MOVE "N"                    TO  WS-INVAUCACC-SW.
120370171201           MOVE "N"                    TO  WS-INVAUCCDN-SW.
120380171011           MOVE "N"                    TO  WS-INVAUCUSD-SW.
120390171011           MOVE ZEROES                 TO  WS-ORIGIN-COST-A.
120400000000           MOVE ZEROES                 TO  WS-WITHDRAWALS-YTD.
120410000000           MOVE ZEROES                 TO  WS-RE-CURR-YEAR-CONTRIB.
120420000000           MOVE ZEROES                 TO  WS-RE-PREV-YEAR-CONTRIB.
120430000000           MOVE ZEROES                 TO  WS-RE-CES-GRANT-AMOUNT.
120440030910R10243     MOVE 99999999               TO  WS-FIRST-TRADE-DATE.
120450030910R30514     MOVE 99999999               TO  WS-FIRST-TRADE-TRANSACTION.
120460030910      ** RFS171359 - Start **
120470010308           INITIALIZE pc_First_Trade_Flag
120480010308                      WS-IS2-BUY-FIRST-N
120490000000                      WS-IS2-TRI-FIRST-N
120500990620                      WS-IS2-SWI-FIRST-N
120510000000           MOVE 99999999               TO  pd_First_Trade_Transaction.
120520990620           MOVE 99999999               TO  pd_First_Purchase_Date.
120530000000175900     MOVE 99999999               TO  WS-FIRST-PURCHASE-DATE.
120540000000      ** RFS171359 - End **
120550000000
120560000000      *------------------------------------------------*
120570000000      *  RECORD HOUSEKEEPING                           *
120580000000      *                                                *
120590001110      *------------------------------------------------*
120600000000R16511     IF WS-LDA-SECTION-17         IS EQUAL TO  "Y"
120610990517  ¦           INITIALIZE ACCOUNT-IPS-DETAILS
120620991108R16511     END-IF.
120630991108           INITIALIZE INVESTOR-SUMMARY-SECTION
120631210914RF8633                INVESTOR-SUMMARY-SECTION-2
120632210914186199                INVESTOR-SUMMARY-SECTION-3
120633210914186199                INVESTOR-SUMMARY-SECTION14-FMT.
120650020821           INITIALIZE           WS-1ST-60
120660030911                                WS-1ST-60-EX
120670040511                                WS-REMAINDER
120680040511                                WS-REMAINDER-EX
120690040511                                WS-WITHDRAWALS
120700040511                                WS-TOTAL-VALUE
120710040511                                WS-MKT-CHANGE-CURRENT
120720040511                                WS-MKT-CHANGE-INCEPT
120730031216                                WS-ACCT-MARKET-START
120740040511                                WS-BOOK-TOTAL-ACCT
120750160202RF8359                          WS-BOOK-VALUE-US-ACCT
120760160316                                WS-BOOK-FGN-ACCT
120770161013                                WS-ACC-MKT-VALUE-LAST-YE
120780161208                                WS-ACCOUNT-TOTALS
120790000000                                WS-IS-ENTERED-BY
120800000000                                WS-ENTERED-BY
120810000000R14136                          WS-INVESTOR-SUMMARY-SEC12
120820030704RF9850                          WS-INVESTMENT-STRUCTURE-CODE
120830000000R18401                          WS-INTERNAL-AMT-PREV
120840000000R18312                          WS-WITHD-TOT
120850000000R18312                          WS-DEPOSIT-TOT
120860000000R18312                          WS-WITHD-TOT-CAD
120870000000R18312                          WS-DEPOSIT-TOT-CAD
120880000000R18312                          WS-WITHD-TOT-USD
120890000000R18312                          WS-DEPOSIT-TOT-USD.
120900030910R18194     INITIALIZE      WS-ACCOUNT-TOTALS-TBLS.
120910030910148326     INITIALIZE      WS-INVESTOR-SUMMARY-SEC12-NEW.
120920030910148326     INITIALIZE      WS-INVESTOR-SUMMARY-SEC12-98.
120930030910163171     MOVE   "Y"      TO WS-FIRST-TRADE-FLG.
120940030910164374     INITIALIZE      WS-ACC-SAJ-INCEPT.
120950030910      *------------------------------------------------*
120960000000      *  KEY INFO                                      *
120970040712      *------------------------------------------------*
120980040712R17783     MOVE CURR-USER-ID           TO PREV-USER-ID.
120990040712           MOVE CURR-INVESTOR TO IS-INVESTOR-NO.
121000040712           MOVE ZEROES        TO IS-ACCOUNT.
121010020108           MOVE CURR-ACCOUNT  TO IS-ACCOUNT2.
121020020108           MOVE 10            TO IS-SECTION-NO.
121030020108           ADD 1             TO WS-ACCOUNT-COUNT.
121040030910           MOVE WS-ACCOUNT-COUNT
121050030910                              TO IS-SECTION-SEQUENCE.
121060030910R16511     IF WS-LDA-SECTION-17         IS EQUAL TO  "Y"
121070141009  ¦           MOVE WS-ACCOUNT-COUNT  TO  IPS-SECTION-SEQUENCE
121080141009  ¦           MOVE II-LANGUAGE-CODE  TO  IPS-LANGUAGE
121090141009  ¦           MOVE II-DEALER           TO IPS-DEALER
121100141009  ¦           MOVE II-DEALER-REP-CODE  TO IPS-SALESREP
121110141009R16511     END-IF.
121120141009           MOVE II-LANGUAGE-CODE  TO IS-LANGUAGE.
121130141009R21714     MOVE WS-CLTSTCLT-FLAG TO IS-CLTSTCLT-FLAG.
121140141009R21714     MOVE WS-CLTSTREP-FLAG TO IS-CLTSTREP-FLAG.
121150141009R21714     MOVE WS-CLTSTSPR-FLAG TO IS-CLTSTSPR-FLAG.
121160000000R21714     MOVE WS-NOMREPSP-FLAG TO IS-NOMREPSP-FLAG.
121170000000r12482     IF  WS-LDA-STMT-CNFM-FLAG = "C"
121180150526    ¦      AND ACNOMINEE OF INVESTOR-JOIN = "Y"
121190160603    ¦      AND NOCONFPRT OF INVESTOR-JOIN = "N"
121200150526R16511         IF WS-LDA-SECTION-17         IS EQUAL TO  "Y"
121210150526  ¦               MOVE NOLANCD OF INVESTOR-JOIN  TO IPS-LANGUAGE
121220150526R16511         END-IF
121230150526r12482         MOVE NOLANCD OF INVESTOR-JOIN  TO IS-LANGUAGE.
121240150526      *RFS140552 - Begins *
121250150526           IF LNCC-POLICYCONFIRMS-YES
121260150526               IF WS-LDA-SECTION-17         IS EQUAL TO  "Y"
121270160603                  MOVE II-LANGUAGE-CODE TO IPS-LANGUAGE
121280150526                END-IF
121290150526              MOVE II-LANGUAGE-CODE TO IS-LANGUAGE
121300010308           END-IF.
121310010308      *RFS140552 - Ends  *
121320010308           MOVE II-DEALER         TO IS-DEALER.
121330010327           MOVE II-DEALER-REP-CODE  TO IS-SALESREP.
121340010308      *RFS 143106 - Begins.
121350010308160284     INITIALIZE li_AccCrtDate
121360010308           MOVE CURR-ACCOUNT TO ACCOUNT-NO OF ACCOUNT-T-REC
121370150526           READ ACCOUNT-T
121380150526           AT END
121390150526             CONTINUE
121400150526           NOT AT END
121410010308             MOVE DEALER-CODE OF ACCOUNT-T TO IS-DEALER
121420000000             MOVE DEALER-REP-CODE OF ACCOUNT-T TO IS-SALESREP
121430000000160284       MOVE CREATION-DATE OF ACCOUNT-T TO li_AccCrtDate
121440970710           END-READ.
121450970710      *RFS 143106 - Ends.
121460970710RF8633     IF WS-LDA-INVESTOR-12     IS EQUAL TO   "Y"
121470970710              MOVE CURR-INVESTOR       TO IS2-INVESTOR-NO
121480000000              MOVE ZEROES              TO IS2-ACCOUNT
121490000000              MOVE CURR-ACCOUNT        TO IS2-ACCOUNT2
121500000000              MOVE 12                  TO IS2-SECTION-NO
121510961231              MOVE WS-ACCOUNT-COUNT    TO IS2-SECTION-SEQUENCE
121520120126              MOVE II-LANGUAGE-CODE    TO IS2-LANGUAGE
121530120126143106*       MOVE II-DEALER           TO IS2-DEALER
121540120314143106*       MOVE II-DEALER-REP-CODE  TO IS2-SALESREP
121550120213143106        MOVE IS-DEALER           TO IS2-DEALER
121560120202143106        MOVE IS-SALESREP         TO IS2-SALESREP
121570120202           END-IF.
121580190924           MOVE ACACTYP      TO IS-ACCOUNT-TYPE-SHORT.
121590190919      *RFS184715 - Begin:  Added condition and removed period below
121600190924184715     IF lb_STMATL_EditExists
121610190924183449     INITIALIZE Lc-Acct-Type-Code
121620190924183449                Lc-Acct-Type-Code-Lang                            184715
121630190924183449     MOVE ACACTYP                TO Lc-Acct-Type-Code             184715
121640190924183449     PERFORM Get-Acct-Type-Lang
121650190924183449     IF  Lc-Acct-Type-Code-Lang  NOT = SPACES
121660190924183449         Move Lc-Acct-Type-Code-Lang to IS-ACCOUNT-TYPE-SHORT
121670190919183449     END-IF
121680190924184715     END-IF.
121690120202      *RFS184715 - End
121700120202           MOVE WS-ACCOUNT-TYPE  TO IS-ACCOUNT-TYPE.
121710120126           IF  ACNOMINEE      IS EQUAL TO  "Y"
121720120202               MOVE ANSPOUSAL          TO  IS-SPOUSAL
121730120126             ELSE
121740120202               MOVE ACSPOUSAL          TO  IS-SPOUSAL.
121750120126           MOVE ACLOCKIN     TO IS-LOCKED-IN.
121760120202           MOVE ACNOMINEE    TO IS-NOMINEE.
121770120126           MOVE ACGROUP      TO IS-GROUP.
121780120126           MOVE ACDLRACTNO             TO  IS-DEALER-ACCOUNT-NO.
121790120210      *RFS93662 Start
121800120202           IF lb_OMSEXTYes
121810120210              MOVE SPACES              TO IS-OMS-NOMINEE-TYPE-CODE
121820120126              MOVE WS-LDA-MGMT-COM-CDE TO IS-OMS-CMPCDE
121830120126              MOVE ACLOCKIN            TO IS-OMS-LOCKED-IN  lc_lockinOMS
121840120202              MOVE ACNOMINEE           TO IS-OMS-NOMINEE  lc_NomineeOMS
121850190919              MOVE ACGROUP             TO IS-OMS-GROUP  lc_GroupOMS
121860190919183449*       MOVE IS-ACCOUNT-TYPE-SHORT  To lc_AccountTypeCodeOMS
121870190919183449*                                   IS-OMS-ACCOUNT-TYPE-CODE
121880190919183449        MOVE ACACTYP               TO lc_AccountTypeCodeOMS
121890120202183449        MOVE IS-ACCOUNT-TYPE-SHORT TO IS-OMS-ACCOUNT-TYPE-CODE
121900120301              MOVE IS-SPOUSAL          TO IS-OMS-SPOUSAL  lc_SpousalOMS
121910120301              IF RECIPIENT-TYPE of INVESTOR-TYPE-REC = lnc_2
121920120301                 MOVE lnc_Y            TO IS-OMS-JOINT  lc_JointOMS
121930120301              ELSE
121940120301                 MOVE lnc_N            TO IS-OMS-JOINT  lc_JointOMS
121950120126              END-IF
121960120210      * check whether nominee account type matter on the mapping
121970120126              If IS-OMS-NOMINEE = lnc_Y
121980120126                 Move ANACTYP               to lc_NomineeTypeCodeOMS
121990120126                 Move ZEROES                to li_CountOMS
122000120126                 Exec SQL
122010120126                   Select Count(*)
122020961231                     into :li_CountOMS
122030961231                     From MFAACTPTP
122040961231                     where account_type_code   = :lc_AccountTypeCodeOMS
122050961231                       and nominee_type_code   = :lc_NomineeTypeCodeOMS
122060961231                       and Nominee_indicator   = :lc_NomineeOMS
122070961231                       and Spousal_indicator   = :lc_SpousalOMS
122080961231                       and Group_indicator     = :lc_GroupOMS
122090021002                       and Locked_in_indicator = :lc_lockinOMS
122100021002                       and Joint_indicator     = :lc_JointOMS
122110021002                 End-Exec
122120021002                 If li_CountOMS > ZEROES
122130190923                   MOVE ANACTYP             TO IS-OMS-NOMINEE-TYPE-CODE
122140190924184715             IF lb_STMATL_EditExists
122150190924183449             INITIALIZE Lc-Nominee-Acct-Type
122160190924183449                        Lc-Nominee-Acct-Type-Lang
122170190924183449             MOVE ANACTYP TO Lc-Nominee-Acct-Type
122180190924183449             PERFORM Get-Nominee-Acct-Type-Lang
122190190924183449             IF  Lc-Nominee-Acct-Type-Lang NOT = SPACES
122200190924183449                 Move Lc-Nominee-Acct-Type-Lang
122210190924183449                   TO IS-OMS-NOMINEE-TYPE-CODE
122220190923183449              END-IF
122230021002184715              END-IF
122240971231                 End-If
122250971231              End-If
122260971231           END-IF.
122270971231      *RFS93662 End
122280970422           IF  ACNOMINEE      IS EQUAL TO  "Y"
122290970422           AND NONONAME       IS EQUAL TO  SPACES
122300970422               MOVE "NOMINEE"          TO  NONONAME.
122310970422           IF  ACNOMINEE      IS EQUAL TO  "Y"
122320970422               MOVE ANNOMCODE          TO  IS-NOMINEE-CODE
122330980521               MOVE NONONAME           TO  IS-NOMINEE-NAME
122340971024               MOVE ANNOMACTNO         TO  IS-NOMINEES-ACCT-NO.
122350971215R14787     IF  ACNOMINEE      IS EQUAL TO  "Y"
122360991108  ¦           IF  IVLANCODE OF INVESTOR-JOIN IS EQUAL TO "F"
122370000621  ¦              MOVE NONONAMEF          TO  IS-NOMINEE-NAME
122380000621  ¦           END-IF
122390010910R14787     END-IF
122400991203           IF  ACNOMINEE      IS EQUAL TO  "Y"
122410991203           AND IS-NOMINEES-ACCT-NO
122420020709                              IS EQUAL TO  SPACES
122430020709               MOVE ACDLRACTNO         TO  IS-NOMINEES-ACCT-NO.
122440020709           MOVE ACCOUNT-ATTRIBUTE-CODE
122450020709                OF ACCOUNT-ATTRIBUTE-REC
122460020709                                       TO  IS-ACCOUNT-ATTRIBUTE-CODE.
122470020904           MOVE WS-ACCOUNT-BENEFICIARY TO  IS-ACCOUNT-BENEFICIARY.
122480020904           MOVE ACPROVAG               TO  IS-PROVINCE-OF-AGREEMENT.
122490020904           MOVE WS-PRTSTM-SW           TO  IS-PRINT-STATEMENT.
122500020904           MOVE II-COUNTRY-CODE        TO  IS-COUNTRY-CODE.
122510020904           MOVE ACCREATDAT             TO  IS-CREATION-DATE.
122520020904           MOVE SPACES                 TO  IS-ENTERED-BY.
122530020904RF6725     MOVE WS-MAILING-ADDRESS-INDICATOR
122540020904                                   TO  IS-MAILING-ADDRESS-INDICATOR.
122550020904R10605     MOVE IVBIRTH                TO  IS-DATE-OF-BIRTH.
122560020904RF5962     MOVE ACPROVAG               TO  WS-PROVINCE-OF-AGREEMENT.
122570020904RF5962     MOVE ACCOUNTAG              TO  WS-COUNTRY-OF-AGREEMENT.
122580020904R13756*****
122590020904      *****    If Master-Acct-Process of Dealer-Misc-Details(MFADEAMDP)
122600020904      *****    = 'Y', get the Master-Account-No from Master-Account
122610020904      *****    (MFAMACCP).
122620020904      *****
122630020709           IF WS-LDA-STMT-CNFM-FLAG    IS NOT EQUAL TO "S"
122640020709              GO TO LR2-0095
122650970430           END-IF.
122660970430           INITIALIZE              DEALER-MISC-DETAILS-REC.
122670970430           MOVE ACDEALER           TO DEALER-CODE
122680970430                                   OF DEALER-MISC-DETAILS-REC.
122690970430           READ DEALER-MISC-DETAILS
122700970430              INVALID KEY
122710970430                  INITIALIZE DEALER-MISC-DETAILS-REC
122720970430                       MOVE SPACES     TO MASTER-ACCT-PROCESS
122730970430                                          OF DEALER-MISC-DETAILS-REC
122740160613           END-READ.
122750970703           IF MASTER-ACCT-PROCESS OF DEALER-MISC-DETAILS-REC
122760970430                                              IS EQUAL TO "Y"
122770970430              PERFORM GET-MASTER-ACCOUNT-RTN  THRU GMAR-EXIT
122780970430           END-IF.
122790970430R13756*****End of RFS13756
122800970430R13756 LR2-0095.
122810040107      *****
122820040107      *****    Initialize the asset class totals.
122830160630      *****
122840970430           IF  WS-AC-LST NOT GREATER THAN  ZEROES
122850970430               GO TO LR2-0140.
122860970430           SET AC                      TO  1.
122870970430       LR2-0110.
122880970430           MOVE ZEROES                 TO  WS-AC-PCT (AC).
122890970430           MOVE ZEROES                 TO  WS-AC-VAL (AC).
122900970430156335     MOVE ZEROES                 TO  WS-AC-BOK-VAL (AC).
122910970430           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
122920970430           IF  WS-AC-SLST (AC)
122930000000                      IS NOT GREATER THAN  ZEROES
122940000000               GO TO LR2-0130.
122950020709           SET ACS                     TO  1.
122960020709       LR2-0120.
122970020709R20205     MOVE ZEROES                 TO  WS-ACS-PCT (AC, ACS).
122980020709R20205     MOVE ZEROES                 TO  WS-ACS-VAL (AC, ACS).
122990020709161108     MOVE ZEROES                 TO  WS-ACS-BOK-VAL (AC, ACS).
123000020709           IF  ACS           IS LESS THAN  WS-AC-SLST (AC)
123010020709               SET ACS              UP BY  1
123020020709               GO TO LR2-0120.
123030020709       LR2-0130.
123040020709           IF  AC            IS LESS THAN  WS-AC-LST
123050020709               SET AC               UP BY  1
123060020709               GO TO LR2-0110.
123070020709       LR2-0140.
123080020709           CONTINUE.
123090020709       LR2-EXIT.
123100190919           EXIT.
123110190919      *RFS183449 - Begin
123120190919       Get-Acct-Type-Lang.
123130190919           MOVE IS-LANGUAGE TO Lc-Lang-Code.
123140190919           EXEC SQL
123150190919                SELECT ACCOUNT_TYPE_CODE_LANG
123160190919                  INTO :Lc-Acct-Type-Code-Lang
123170190919                  FROM MFAACTYLP
123180190919                 WHERE ACCOUNT_TYPE_CODE  = :Lc-Acct-Type-Code  AND
123190190919                       LANGUAGE_CODE      = :Lc-Lang-Code
123200190919           END-EXEC.
123210190919
123220190919       Get-Nominee-Acct-Type-Lang.
123230190919           MOVE IS-LANGUAGE TO Lc-Lang-Code.
123240190919           EXEC SQL
123250190919                SELECT NOMINEE_ACCOUNT_TYPE_LANG
123260190919                  INTO :Lc-Nominee-Acct-Type-Lang
123270190919                  FROM MFANMTPYP
123280190919                 WHERE NOMINEE_ACCOUNT_TYPE = :Lc-Nominee-Acct-Type AND
123290190919                       LANGUAGE_CODE        = :Lc-Lang-Code
123300190919           END-EXEC.
123310000000      *RFS183449 - End
123320000000R13756****** Populate IS-MASTER-ACCOUNT-NO at Section 10.
123330000000       GET-MASTER-ACCOUNT-RTN.
123340000000           INITIALIZE              MASTER-ACCOUNT-REC.
123350000000           MOVE ACACTNO         TO ACCOUNT-NO OF MASTER-ACCOUNT-REC.
123360000000           READ MASTER-ACCOUNT
123370000000              INVALID KEY
123380000000                INITIALIZE              MASTER-ACCOUNT-REC
123390000000                MOVE ZEROES TO MASTER-ACCOUNT-NO OF MASTER-ACCOUNT-REC
123400970108           END-READ.
123410970108           MOVE MASTER-ACCOUNT-NO OF MASTER-ACCOUNT-REC
123420970108                                       TO IS-MASTER-ACCOUNT-NO.
123430970108      **********
123440970108       GMAR-EXIT.
123450970108            EXIT.
123460970108R13756**********
123470970108      /
123480970108       LEVEL-REINIT-3.
123490970108      ******************************************************************
123500970108      *                                                                *
123510970108      *    L E V E L   R E I N I T I A L I Z A T I O N   3   R T N .   *
123520970108      *                                                                *
123530970108      *        ACIVRNO:    Investor Number                             *
123540970108      *                                                                *
123550970108      ******************************************************************
123560970108      *****
123570970108      *****    The investor will be bypassed if:
123580030826      *****     1. The Dealer Representative is being bypassed;
123590980406      *****     2. This is an ALL INVESTOR run for Investor statements
123600030826      *****        and all investor statements for the investors' dealer
123610980406      *****        are to be suppressed.
123620000628      *****     3. This is an ALL INVESTOR run for Investor statements
123630000628      *****        and all investor statements for the investors' dealer
123640000628      *****        representative are to be suppressed.
123650000628      *****     4. This is an ALL DEALER REPRESENTATIVE run for Investor
123660000628      *****        statements and the investor is flagged as HOLD MAIL.
123670000628      *****     5. This is an ALL DEALER run for Investor statements and
123680000628      *****        the investor is flagged as HOLD MAIL.
123690971024      *****
123700970108      *****    Please note that items 4 and 5 above will be checked
123710971122      *****    later on within this routine.  This is due to the fact
123720020709      *****    that the HOLD MAIL flag is not available at this point.
123730020709      *****
123740020709R18143     MOVE "N" TO WS-LR3BYP-SW.
123750020709           IF  WS-LR4BYP-SW   IS EQUAL TO  "Y"
123760020709               GO TO LR3-0000-0020.
123770020709
123780020709     *** For AIC/BPI/PHN/IRI, WS-LDA-ALLTYP was set to "I", others
123790020709     *** were set to " " before the first ANNSTMTJSI call in JOBSTMTJSI
123800020709     *** Therefore, AIC/BPI/PHN/IRI will go through the following      .
123810020709     *** check if it was a Mass Statement run; For Confirm/Duplicate,  .
123820020709     *** WS-LDA-ALLTYP was only set to "I", therefore, it will go      .
123830020709     *** through the following check.
123840030826
123850030826           IF  WS-LDA-ALLTYP NOT EQUAL TO  "I"
123860030826               GO TO LR3-0000-0040.
123870030826
123880030826R11326*****
123890030826      *****    If Mass Statement, do not check CLTSTSPR at Investor
123900030826      *****    level. The check will be performed at Account level.
123910030826      *****    Investor will be suppressed only if all Accounts of
123920030826      *****    the Investor are suppressed.
123930030826      *****
123940030826
123950030826R11326     IF  WS-LDA-STMT-CNFM-FLAG  = "S"
123960030826           AND WS-LDA-REQUEST-SCOPE   = "A"
123970030826               GO TO LR3-0000-0040
123980030826R11326     END-IF.
123990030826
124000030826      ***** START R18143
124010030826
124020030826           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO  "C"
124030030826              MOVE "CONFMSPR  " TO WS-FORM-CODE
124040970108           ELSE
124050030826              MOVE "CLTSTSPR  " TO WS-FORM-CODE
124060970108           END-IF.
124070970108
124080970108           PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
124090000000           IF WS-RETURN-CODE = "00"
124100000000              GO TO LR3-0000-0020
124110000000           END-IF.
124120000000
124130000000           PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT.
124140000000           IF WS-RETURN-CODE = "00"
124150000000              GO TO LR3-0000-0020
124160991123           END-IF.
124170991125
124180031008           GO TO LR3-0000-0040.
124190031008
124200000824       LR3-0000-0020.
124210001019           MOVE "Y" TO WS-LR3BYP-SW.
124220001020           GO TO LR3-0000-0040.
124230001020
124240001021       LR3-0000-0040.
124250010607      *------------------------------------------------*
124260991005      *  RECORD HOUSEKEEPING                           *
124270161026      *------------------------------------------------*
124280020910
124290020821           MOVE "N"          TO WS-WRITE-INVESTOR-LEVEL.
124300010309           MOVE ZEROES       TO WS-INVESTOR-COUNT
124310160202                                WS-ACCOUNT-COUNT
124320010305RF5148                          WS-ACC-PERF-COUNT
124330130203RF5148                          WS-FUND-PERF-COUNT
124340000000R17626                          WS-ACC-FRQ-COUNT
124350000000R17626                          WS-FUND-FRQ-COUNT
124360060621RF6697                          WS-ACC-GIC-COUNT
124370040511RF4638                          WS-ACC-SEG43-COUNT
124380040511                                WS-ACC-SEG40-COUNT
124390040511                                WS-ACC-SEG45-COUNT
124400040511                                WS-ACC-SEG90-COUNT
124410040511                                WS-II-ACCOUNT-COUNT
124420040511                                WS-TRANSACTION-COUNT
124430040511156507                          WS-TRANS79-COUNT
124440040511                                WS-RESP-TRANSACTION-CNT
124450040511R14136                          WS-INVESTOR-SUMMARY-SEC12-TOT.
124460040511RF8633*                         WS-INVESTOR-SUMMARY-SEC12-TOT.
124470040511148326     MOVE ZEROES       TO WS-INVEST-SUMMARY-SEC12-TOT-N.
124480040511
124490010607118007     Move 10000       to li_Seq_No_Cnt.
124500010607
124510010607      *  RESET COUNTS FOR SORTING INVESTMENTS BY CURRENCY.
124520000000R18194     INITIALIZE        WS-CURS20T-TBL.
124530000000   ¦
124540000000   ¦       SET CS20T    TO 1.
124550000000   ¦       SET CS20     TO 1.
124560000000   ¦
124570000000   ¦   LR3-0000-0040-0000-0010.
124580000000   ¦
124590000000   ¦       IF CS20       IS NOT GREATER THAN WS-CS20-LST
124600000000   ¦          MOVE WS-CURS20-ENT(CS20) TO WS-CURS20T-ENT(CS20T)
124610000000   ¦          SET CS20T    UP BY 1
124620000000   ¦          SET CS20     UP BY 1
124630000000   v          GO TO LR3-0000-0040-0000-0010
124640000000R18194     END-IF.
124650000000
124660000000R10404*  RESET COUNTS FOR SORTING DII TRANSACTIONS BY SEQUENCE NUMBER.
124670991222           MOVE 300000       TO WS-TRANSACTION-COUNT-DII.
124680000000
124690000000           INITIALIZE INVESTOR-INFO-SECTION.
124700000000
124710000000      *------------------------------------------------*
124720000000      *  KEY INFO                                      *
124730000000      *                                                *
124740000000      *------------------------------------------------*
124750980128           MOVE CURR-INVESTOR TO II-INVESTOR-NO.
124760980128           MOVE ZEROES        TO II-ACCOUNT.
124770081121           MOVE 01            TO II-SECTION-NO.
124780081121
124790081121           MOVE WS-INVESTOR-COUNT    TO II-SECTION-SEQUENCE.
124800081121
124810081121           MOVE "Y"          TO WS-SPOUSE-FOUND.
124820000216           MOVE IVIVRNO      TO INVESTOR-NO OF INVESTOR-SPOUSE.
124830000216RF5962     MOVE IVBIRTH      TO WS-INVESTOR-DOB.
124840000216
124850000216           READ INVESTOR-SPOUSE
124860000216               INVALID KEY
124870000216               MOVE "N"          TO WS-SPOUSE-FOUND.
124880970513
124890970513           ADD 1             TO WS-INVESTOR-COUNT.
124900970513
124910970513           MOVE WS-LDA-STRDTE          TO  II-START-DATE-D.
124920970513           MOVE WS-LDA-ENDDTE          TO  II-END-DATE-D.
124930970513
124940970513R52815     IF  WS-SPOUSE-FOUND = "Y"
124950971128  |           MOVE DATE-OF-BIRTH OF INVESTOR-SPOUSE TO
124960971128  |                II-IVR-Spouse-DOB
124970971128R52815     END-IF.
124980971128
124990971128RF6362     IF WS-LDA-REQUEST-SCOPE     IS  EQUAL TO "T"
125000971128              MOVE WS-LDA-LANGUAGE-CODE   TO II-LANGUAGE-CODE
125010971128           ELSE
125020971128              MOVE IVLANCODE           TO  II-LANGUAGE-CODE
125030971128           END-IF
125040971128
125050971128      *****
125060970421      *****    Normally, the language code will be based on the
125070970421      *****    investor.  If this is an ad-hoc dealer request, override
125080970421      *****    it with the language of the dealer.
125090970421      *****
125100970421
125110970421
125120970421      *****
125130970422      *****    If the Investor Language is not English and is not
125140970421      *****    French, default it to English.
125150970421      *****
125160970421
125170970421           IF  II-LANGUAGE-CODE
125180970421                          IS NOT EQUAL TO  "E"
125190970421           AND II-LANGUAGE-CODE
125200970422                          IS NOT EQUAL TO  "F"
125210970421               MOVE "E"                TO  II-LANGUAGE-CODE.
125220970421
125230970421      *****
125240970421      *****    Format the investor name depending on the investor
125250970421      *****    type category.
125260970421      *****
125270970422
125280970421           IF  WS-IT-LST NOT GREATER THAN  ZEROES
125290970421               MOVE ALL "*"            TO  WS-INVESTOR-TYPE
125300970421               GO TO LR3-0000-0070.
125310970421
125320970421           SET IT                      TO  1.
125330970421
125340970421       LR3-0000-0050.
125350970421           IF  WS-IT-CODE (IT)   EQUAL TO  IVIVTYPCD
125360970421               MOVE WS-IT-DESC (IT)    TO  WS-INVESTOR-TYPE
125370970421               GO TO LR3-0000-0060.
125380970421
125390970421           IF  IT            IS LESS THAN  WS-IT-LST
125400970421               SET IT               UP BY  1
125410090505               GO TO LR3-0000-0050.
125420090505
125430090505           MOVE ALL "*"                TO  WS-INVESTOR-TYPE.
125440090505           GO TO LR3-0000-0070.
125450090505
125460090505       LR3-0000-0060.
125470090505           IF  WS-IT-CAT (IT)
125480090505                          IS NOT EQUAL TO  "I"
125490090505               GO TO LR3-0000-0070.
125500090505
125510090505           IF  IVFIRNAME      IS EQUAL TO  SPACES
125520090505           AND IVINITIALS     IS EQUAL TO  SPACES
125530970421           AND IVLANAME       IS EQUAL TO  SPACES
125540970421               GO TO LR3-0000-0070.
125550970421
125560970421           MOVE SPACES                 TO  WS-ADRTMP.
125570970421
12558097042166105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
12559097042166105      Set pb-adrName to True.
12560097042166105      Move IVFIRNAME                          to pc-InFirstName.
12561097042266105      Move IVINITIALS                         to pc-InInitial.
12562000000066105      Move IVLANAME                           to pc-InLastName.
125630000000
12564000000066105      Call "FXSTRTADR" using pt-StreetAddressAction,
12565000000066105                             pt-StreetAddressIn,
12566000000066105                             pt-StreetAddressOut.
12567000000066105
12568000000066105      Move pc-OutName To WS-ADRTMP.
125690000000
125700000000           MOVE WS-ADRTMP              TO  II-INVESTOR-NAME.
125710970117           GO TO LR3-0000-0080.
125720000000
125730000000       LR3-0000-0070.
125740000000           MOVE IVLEGALNM              TO  II-INVESTOR-NAME.
125750000000
125760000000       LR3-0000-0080.
125770000000           MOVE IVLEGALNM2             TO  II-INVESTOR-NAME-2.
125780000000
125790961223      *****
125800961223      *****    Determine if an alternate address exists for the
125810961223      *****    Investor.
125820961223      *****
125830000000
125840000000           INITIALIZE MFAIVRADP.
125850000000           MOVE CURR-INVESTOR          TO  INVESTOR-NO
125860000000                                           OF INVESTOR-ADDRESS-RECD.
125870000000           MOVE "IVA"                  TO  ADDR-TYPE-CODE
125880000000                                           OF INVESTOR-ADDRESS-RECD.
125890000000           READ INVESTOR-ADDRESS-FILE
125900000000               INVALID KEY
125910000000                   GO TO LR3-0010.
125920000000
125930000000      *****
125940000000      *****    An alternate address exists for the Investor.  Read the
125950000000      *****    Address to determine if it is effective, an ACTIVE START
125960000000      *****    DATE of zeroes or an ACTIVE END DATE of zeroes will be
125970000000      *****    deemed effective.  If it is, use the alternate address in
125980000000      *****    place of the regular address.
125990000000      *****
126000000000
126010000000           INITIALIZE MFAADDP.
126020010115           MOVE ADDR-NO
126030010115                OF INVESTOR-ADDRESS-RECD
126040010115                                       TO  ADDR-NO
126050010115                                           OF ADDRESS-RECD.
126060010115           READ ADDRESS-FILE
126070010115               INVALID KEY
126080010115                   GO TO LR3-0010.
126090010115
126100010115      *****
126110010115      *****    When running this program against NFC, a data decimal
126120000000      *****    error was detected due to the ACTIVE-START-DATE and/or
126130000000      *****    the ACTIVE-END-DATE containing spaces.  If either field
126140000000      *****    contains spaces, it will be deemed active.  When the file
126150000000      *****    is corrected, this logic can be removed.
126160000000      *****
126170000000
126180000000RF9060     IF  ACTIVE-START-DATE
126190000000               OF ADDRESS-RECD   NOT NUMERIC
126200000000                 MOVE ZEROES TO ACTIVE-START-DATE OF ADDRESS-RECD
126210000000           END-IF
126220000000
126230000000           IF (ACTIVE-END-DATE OF ADDRESS-RECD   NOT NUMERIC)
126240000000           OR (ACTIVE-END-DATE OF ADDRESS-RECD = ZEROES     )
126250000000                 MOVE 20991231 TO ACTIVE-END-DATE OF ADDRESS-RECD
126260000000           END-IF
126270000000
126280000000           IF  WS-DATE       IS LESS THAN  ACTIVE-START-DATE
126290000000                                           OF ADDRESS-RECD
126300000000           OR  WS-DATE    IS GREATER THAN  ACTIVE-END-DATE
126310000000                                           OF ADDRESS-RECD
126320000000               GO TO LR3-0010.
126330000000
126340000000           GO TO LR3-0020.
126350000000
126360000000       LR3-0010.
126370000000
126380000000      *****
126390000000      *****    If an alternate address does not exist or exists but is
126400000000      *****    not in effect, use the regular investor address.
126410000000      *****
126420000000
126430000000           INITIALIZE MFAIVRADP.
126440000000           MOVE CURR-INVESTOR          TO  INVESTOR-NO
126450000000                                           OF INVESTOR-ADDRESS-RECD.
126460000000           MOVE "IVR"                  TO  ADDR-TYPE-CODE
126470000000                                           OF INVESTOR-ADDRESS-RECD.
126480980323           READ INVESTOR-ADDRESS-FILE
126490980323               INVALID KEY
126500980323                   INITIALIZE MFAADDP
126510980323                   GO TO LR3-0020.
126520980402
126530000621           INITIALIZE MFAADDP.
126540000621           MOVE ADDR-NO
126550980324                OF INVESTOR-ADDRESS-RECD
126560980323                                       TO  ADDR-NO
126570980211                                           OF ADDRESS-RECD.
126580980211           READ ADDRESS-FILE
126590980211               INVALID KEY
126600980211                   INITIALIZE MFAADDP
126610980211                   GO TO LR3-0020.
126620990401
126630990401       LR3-0020.
126640000000
126650980325      ****
126660980324      ****   Read in Nominee Address File
126670000000      ****
126680980211
126690970512           GO TO LR3-0020-0000-0001.
126700000000
126710000000       LR3-0020-0000-0001.
126720970512
126730980211      *****
126740000000      *****    Format the investor address line 1 with the Investor
126750000000      *****    Legal Name 2.
126760980211      *****
126770970120
126780970120           IF WS-LDA-STMT-VERSION NOT = "E"
126790970120              MOVE IVLEGALNM2          TO  II-INVESTOR-ADDRESS1.
126800000000
126810980324       LR3-0020-0000-0005.
126820090309
126830090309      *****
126840090309      *****    Format the investor address line 2 with the Care of /
126850090309      *****    Attention name.
126860090309      *****
126870090309
126880090309           MOVE CO-OR-ATTENTION
126890090309                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS2.
126900090309
126910090306      *****
126920090309      *****    Format the investor address line 3 with the street
126930090306      *****    number, street name, street type and street direction.
126940090305      *****    Each fields will be handled separately in case one or
126950090309      *****    more of the fields contain spaces.
126960090309      *****
126970090309
12698009030566105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
12699009030966105      Set pb-adrStreet   to True.
12700000000066105      Set pb-adrProvince to True.
12701009030566105      Move STREET-NO        OF ADDRESS-RECD to pc-InStreetNo.
12702009030566105      Move STREET-NAME      OF ADDRESS-RECD to pc-InStreetName.
12703009030566105      Move STREET-TYPE-CODE OF ADDRESS-RECD to pc-InStreetTypeCode.
12704009030566105      Move PROVINCE-CODE    OF ADDRESS-RECD to pc-InProvinceCode.
12705009030566105      Move CITY              OF ADDRESS-RECD to pc-InCity.
12706009030566105      Move STREET-DIRCT-CODE OF ADDRESS-RECD to pc-InDirectionCode.
12707009030566105      If COUNTRY-CODE OF ADDRESS-RECD Not = "CAN"
12708009030566105         Move COUNTRY-CODE OF ADDRESS-RECD to pc-InCountry
12709009030566105      End-If
127100090305
12711009030566105      Call "FXSTRTADR" using pt-StreetAddressAction,
12712009030566105                             pt-StreetAddressIn,
12713009030566105                             pt-StreetAddressOut.
12714009030566105
12715009030566105      Move pc-OutStreet To II-INVESTOR-ADDRESS3.
127160090305
12717009030566105 *    MOVE SPACES                 TO  WS-ADRTMP.
12718009030566105 *    STRING STREET-NO
12719009030566105 *           OF ADDRESS-RECD
12720009030566105 *                      DELIMITED BY  "  "
12721009030566105 *                              INTO  WS-ADRTMP.
12722009030566105 *
12723009030566105 *    IF  PROVINCE-CODE
12724009030566105 *        OF ADDRESS-RECD   EQUAL TO  "QC"
12725009030566105 *        GO TO LR3-0020-0000-0010.
12726009030566105 *
12727009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12728009030566105 *        STRING STREET-NAME
12729009030566105 *               OF ADDRESS-RECD
12730009030566105 *                      DELIMITED BY  "  "
12731009030566105 *                              INTO  WS-ADRTMP
12732009030566105 *      ELSE
12733009030566105 *        STRING WS-ADRTMP
12734009030566105 *                      DELIMITED BY  "  ",
12735009030566105 *               " "    DELIMITED BY  SIZE,
12736009030566105 *               STREET-NAME
12737009030566105 *               OF ADDRESS-RECD
12738009030566105 *                      DELIMITED BY  "  "
12739009030566105 *                              INTO  II-INVESTOR-ADDRESS3
12740009030566105 *        MOVE II-INVESTOR-ADDRESS3
12741009030566105 *                                TO  WS-ADRTMP.
12742009030566105 *
12743009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12744009030566105 *        STRING STREET-TYPE-CODE
12745009030566105 *               OF ADDRESS-RECD
12746009030566105 *                      DELIMITED BY  "  "
12747009030566105 *                              INTO  WS-ADRTMP
12748009030566105 *      ELSE
12749009030566105 *        STRING WS-ADRTMP
12750009030566105 *                      DELIMITED BY  "  ",
12751009030566105 *               " "    DELIMITED BY  SIZE,
12752009030566105 *               STREET-TYPE-CODE
12753009030566105 *               OF ADDRESS-RECD
12754009030566105 *                      DELIMITED BY  "  "
12755009030566105 *                              INTO  II-INVESTOR-ADDRESS3
12756009030566105 *        MOVE II-INVESTOR-ADDRESS3
12757009030566105 *                                TO  WS-ADRTMP.
12758009030566105 *
12759009030566105 *    GO TO LR3-0020-0000-0020.
12760009030566105 *
12761097121266105 *LR3-0020-0000-0010.
12762009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12763009030566105 *        STRING STREET-TYPE-CODE
12764009030566105 *               OF ADDRESS-RECD
12765009030566105 *                      DELIMITED BY  "  "
12766009030566105 *                              INTO  WS-ADRTMP
12767009030566105 *      ELSE
12768009030566105 *        STRING WS-ADRTMP
12769009030566105 *                      DELIMITED BY  "  ",
12770009030566105 *               " "    DELIMITED BY  SIZE,
12771009030566105 *               STREET-TYPE-CODE
12772009030566105 *               OF ADDRESS-RECD
12773009030566105 *                      DELIMITED BY  "  "
12774009030566105 *                              INTO  II-INVESTOR-ADDRESS3
12775009030566105 *        MOVE II-INVESTOR-ADDRESS3
12776009030566105 *                                TO  WS-ADRTMP.
127770090305
12778009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12779009030566105 *        STRING STREET-NAME
12780009030566105 *               OF ADDRESS-RECD
12781009030566105 *                      DELIMITED BY  "  "
12782009030566105 *                              INTO  WS-ADRTMP
12783009030566105 *      ELSE
12784009030566105 *        STRING WS-ADRTMP
12785009030566105 *                      DELIMITED BY  "  ",
12786009030566105 *               " "    DELIMITED BY  SIZE,
12787009030566105 *               STREET-NAME
12788009030566105 *               OF ADDRESS-RECD
12789009030566105 *                      DELIMITED BY  "  "
12790009030566105 *                              INTO  II-INVESTOR-ADDRESS3
12791009030566105 *        MOVE II-INVESTOR-ADDRESS3
12792009030566105 *                                TO  WS-ADRTMP.
12793009030566105 *LR3-0020-0000-0020.
12794009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12795000000066105 *        STRING STREET-DIRCT-CODE
12796000000066105 *               OF ADDRESS-RECD
12797098021166105 *                      DELIMITED BY  "  "
12798000000066105 *                              INTO  WS-ADRTMP
12799000000066105 *      ELSE
12800000000066105 *        STRING WS-ADRTMP
12801000000066105 *                      DELIMITED BY  "  ",
12802098021166105 *               " "    DELIMITED BY  SIZE,
12803000000066105 *               STREET-DIRCT-CODE
12804000000066105 *               OF ADDRESS-RECD
12805098021166105 *                      DELIMITED BY  "  "
12806000000066105 *                              INTO  II-INVESTOR-ADDRESS3
12807000000066105 *        MOVE II-INVESTOR-ADDRESS3
12808000000066105 *                                TO  WS-ADRTMP.
12809000000066105 *
12810098021166105 *    MOVE WS-ADRTMP              TO  II-INVESTOR-ADDRESS3.
128110000000
128120000000      *****
128130980211      *****    Format the investor address line 4 with the miscellaneous
128140970512      *****    first address.
128150970512      *****
128160970512
128170000000           MOVE MISC-FIRST-ADDR-LINE
128180970120                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS4.
128190980211
128200090309      *****
128210090306      *****    Format the investor address line 5 with the miscellaneous
128220090306      *****    second address.
128230090306      *****
128240090306
128250090306           MOVE MISC-SECOND-ADDR-LINE
128260970120                OF ADDRESS-RECD        TO  II-INVESTOR-ADDRESS5.
128270090306
128280090306      *****
128290090306      *****    Format the investor address line 6 with the city and
128300970512      *****    province/state code.  If this is not a Canadian or an
128310090306      *****    American address, the province/state code will not be
128320090306      *****    included.
128330090306      *****
128340090306
128350090306           MOVE SPACES                 TO  WS-II-INVESTOR-ADDRESS6.
12836009030666105      Move pc-OutProvince         TO  WS-II-INVESTOR-ADDRESS6.
12837009030666105 *    MOVE SPACES                 TO  WS-ADRTMP.
12838097012066105 *    STRING CITY
12839009030666105 *           OF ADDRESS-RECD
12840009030666105 *                      DELIMITED BY  "  "
12841009030666105 *                              INTO  WS-ADRTMP.
128420090306
12843009030666105 *    IF  PROVINCE-CODE
12844009030666105 *        OF ADDRESS-RECD   EQUAL TO  SPACES
12845009030666105 *        GO TO LR3-0020-0010.
128460090306
12847009030666105 *    IF  COUNTRY-CODE
12848009030666105 *        OF ADDRESS-RECD
12849009030666105 *                   IS NOT EQUAL TO  "CAN"
12850009030666105 *    AND COUNTRY-CODE
12851009030666105 *        OF ADDRESS-RECD
12852009030666105 *                   IS NOT EQUAL TO  "USA"
12853009030666105 *        GO TO LR3-0020-0010.
128540970120
12855009030666105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
12856009030666105 *        STRING PROVINCE-CODE
12857097051266105 *               OF ADDRESS-RECD
12858097051266105 *                      DELIMITED BY  "  "
12859097051266105 *                              INTO  WS-ADRTMP
12860097051266105 *      ELSE
12861098021166105 *        STRING WS-ADRTMP
12862098021166105 *                      DELIMITED BY  "  ",
12863097051266105 *               "  "   DELIMITED BY  SIZE,
12864097051266105 *               PROVINCE-CODE
12865098021166105 *               OF ADDRESS-RECD
12866097051266105 *                      DELIMITED BY  "  "
12867097051266105 *                              INTO  WS-II-INVESTOR-ADDRESS6
12868097051266105 *        MOVE WS-II-INVESTOR-ADDRESS6
12869097051266105 *                                TO  WS-ADRTMP.
128700980211
12871098021166105 *LR3-0020-0010.
12872098021166105 *    MOVE WS-ADRTMP              TO  WS-II-INVESTOR-ADDRESS6.
128730980211
128740980211      *****
128750980211      *****    If processing an investor address which is not Canadian,
128760980211      *****    the country code or name is to be printed on a separate
128770980211      *****    line.  If at least two blank lines exist, the country
128780980211      *****    code will be formatted on address line 6.
128790980211      *****
128800980211
128810980211           MOVE SPACES                 TO  WS-II-INVESTOR-ADDRESS7.
128820980211
128830980211           IF  COUNTRY-CODE
128840980211               OF ADDRESS-RECD   EQUAL TO  "CAN"
128850980211               GO TO LR3-0020-0040.
128860980211
128870980211           MOVE ZEROES                 TO  WS-IVRADRCNT.
128880980211           IF  II-INVESTOR-ADDRESS1
128890970512                              IS EQUAL TO  SPACES
128900970512               ADD 1                   TO  WS-IVRADRCNT.
128910970512           IF  II-INVESTOR-ADDRESS2
128920980211                              IS EQUAL TO  SPACES
128930980211               ADD 1                   TO  WS-IVRADRCNT.
128940970512           IF  II-INVESTOR-ADDRESS3
128950970512                              IS EQUAL TO  SPACES
128960090309               ADD 1                   TO  WS-IVRADRCNT.
128970090506           IF  II-INVESTOR-ADDRESS4
128980090506                              IS EQUAL TO  SPACES
128990090506               ADD 1                   TO  WS-IVRADRCNT.
129000090309           IF  II-INVESTOR-ADDRESS5
129010090309                              IS EQUAL TO  SPACES
129020090306               ADD 1                   TO  WS-IVRADRCNT.
129030970512
129040970120           IF  WS-IVRADRCNT  GREATER THAN  1
129050970120               GO TO LR3-0020-0020.
129060961223
129070961223      *****
129080980211      *****    Less than two blank lines exist, therefore the country
129090980211      *****    code will be formatted on address line 6.
129100980211      *****
129110980211
12912096122366105      Move Spaces           to lc-Line80.
12913097051266105      String function trim(WS-II-INVESTOR-ADDRESS6) "   "
12914009030966105             COUNTRY-CODE OF ADDRESS-RECD
12915009030666105             Delimited by Size
12916097012066105        Into lc-Line80.
12917097051266105      Move lc-Line80 (1:40) to WS-II-INVESTOR-ADDRESS6.
129180970512
129190970512           GO TO LR3-0020-0040.
129200970512
129210970512       LR3-0020-0020.
129220961223
129230961223      *****
129240961223      *****    At least two blank lines exist, therefore format the
129250961223      *****    country on a separate line.  If American, use the country
129260961223      *****    code.  Otherwise, read the Country record and use the
129270961223      *****    full country name.
129280961223      *****
129290961223
12930096122366105      Move pc-OutCountry          TO  WS-II-INVESTOR-ADDRESS7.
129310961223
129320961223       LR3-0020-0040.
129330961223
129340961223      *****
129350961223      *****    Compress the investor address lines.
129360961223      *****
129370961223
129380961223           IF  II-INVESTOR-ADDRESS1
129390961223                          IS NOT EQUAL TO  SPACES
129400961223               GO TO LR3-0030.
129410961223
129420961223           IF  II-INVESTOR-ADDRESS2
129430961223                          IS NOT EQUAL TO  SPACES
129440961223               MOVE II-INVESTOR-ADDRESS2
129450970512                                       TO  II-INVESTOR-ADDRESS1
129460970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS2
129470970512               GO TO LR3-0030.
129480970512
129490970512           IF  II-INVESTOR-ADDRESS3
129500970512                          IS NOT EQUAL TO  SPACES
129510970512               MOVE II-INVESTOR-ADDRESS3
129520970512                                       TO  II-INVESTOR-ADDRESS1
129530970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS3
129540970512               GO TO LR3-0030.
129550970512
129560970512           IF  II-INVESTOR-ADDRESS4
129570970512                          IS NOT EQUAL TO  SPACES
129580980211               MOVE II-INVESTOR-ADDRESS4
129590980211                                       TO  II-INVESTOR-ADDRESS1
129600980211               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
129610980211               GO TO LR3-0030.
129620980211
129630980211           IF  II-INVESTOR-ADDRESS5
129640980211                          IS NOT EQUAL TO  SPACES
129650980211               MOVE II-INVESTOR-ADDRESS5
129660961223                                       TO  II-INVESTOR-ADDRESS1
129670970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
129680961223               GO TO LR3-0030.
129690961223
129700961223           IF  WS-II-INVESTOR-ADDRESS6
129710961223                          IS NOT EQUAL TO  SPACES
129720961223               MOVE WS-II-INVESTOR-ADDRESS6
129730961223                                       TO  II-INVESTOR-ADDRESS1
129740961223               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
129750961223               GO TO LR3-0030.
129760961223
129770961223           IF  WS-II-INVESTOR-ADDRESS7
129780961223                          IS NOT EQUAL TO  SPACES
129790961223               MOVE WS-II-INVESTOR-ADDRESS7
129800961223                                       TO  II-INVESTOR-ADDRESS1
129810961223               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
129820961223
129830961223           GO TO LR3-0060.
129840961223
129850961223       LR3-0030.
129860970512           IF  II-INVESTOR-ADDRESS2
129870970512                          IS NOT EQUAL TO  SPACES
129880970512               GO TO LR3-0040.
129890970512
129900970512           IF  II-INVESTOR-ADDRESS3
129910970512                          IS NOT EQUAL TO  SPACES
129920970512               MOVE II-INVESTOR-ADDRESS3
129930970512                                       TO  II-INVESTOR-ADDRESS2
129940970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS3
129950970512               GO TO LR3-0040.
129960970512
129970970512           IF  II-INVESTOR-ADDRESS4
129980970512                          IS NOT EQUAL TO  SPACES
129990980211               MOVE II-INVESTOR-ADDRESS4
130000980211                                       TO  II-INVESTOR-ADDRESS2
130010980211               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
130020980211               GO TO LR3-0040.
130030980211
130040980211           IF  II-INVESTOR-ADDRESS5
130050980211                          IS NOT EQUAL TO  SPACES
130060980211               MOVE II-INVESTOR-ADDRESS5
130070961223                                       TO  II-INVESTOR-ADDRESS2
130080970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
130090961223               GO TO LR3-0040.
130100961223
130110961223           IF  WS-II-INVESTOR-ADDRESS6
130120961223                          IS NOT EQUAL TO  SPACES
130130961223               MOVE WS-II-INVESTOR-ADDRESS6
130140961223                                       TO  II-INVESTOR-ADDRESS2
130150961223               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
130160961223               GO TO LR3-0040.
130170961223
130180961223           IF  WS-II-INVESTOR-ADDRESS7
130190961223                          IS NOT EQUAL TO  SPACES
130200961223               MOVE WS-II-INVESTOR-ADDRESS7
130210970512                                       TO  II-INVESTOR-ADDRESS2
130220970512               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
130230970512
130240970512           GO TO LR3-0060.
130250970512
130260970512       LR3-0040.
130270970512           IF  II-INVESTOR-ADDRESS3
130280970512                          IS NOT EQUAL TO  SPACES
130290970512               GO TO LR3-0050.
130300970512
130310970512           IF  II-INVESTOR-ADDRESS4
130320970512                          IS NOT EQUAL TO  SPACES
130330980211               MOVE II-INVESTOR-ADDRESS4
130340980211                                       TO  II-INVESTOR-ADDRESS3
130350980211               MOVE SPACES             TO  II-INVESTOR-ADDRESS4
130360980211               GO TO LR3-0050.
130370980211
130380980211           IF  II-INVESTOR-ADDRESS5
130390980211                          IS NOT EQUAL TO  SPACES
130400980211               MOVE II-INVESTOR-ADDRESS5
130410970512                                       TO  II-INVESTOR-ADDRESS3
130420970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
130430961223               GO TO LR3-0050.
130440961223
130450970512           IF  WS-II-INVESTOR-ADDRESS6
130460970512                          IS NOT EQUAL TO  SPACES
130470970512               MOVE WS-II-INVESTOR-ADDRESS6
130480970512                                       TO  II-INVESTOR-ADDRESS3
130490970512               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
130500970512               GO TO LR3-0050.
130510970512
130520970512           IF  WS-II-INVESTOR-ADDRESS7
130530970512                          IS NOT EQUAL TO  SPACES
130540970512               MOVE WS-II-INVESTOR-ADDRESS7
130550970512                                       TO  II-INVESTOR-ADDRESS3
130560970512               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
130570970512
130580970512           GO TO LR3-0060.
130590970512
130600980211       LR3-0050.
130610980211           IF  II-INVESTOR-ADDRESS4
130620980211                          IS NOT EQUAL TO  SPACES
130630980211               GO TO LR3-0050-0010.
130640980211
130650980211           IF  II-INVESTOR-ADDRESS5
130660980211                          IS NOT EQUAL TO  SPACES
130670980211               MOVE II-INVESTOR-ADDRESS5
130680970512                                       TO  II-INVESTOR-ADDRESS4
130690970512               MOVE SPACES             TO  II-INVESTOR-ADDRESS5
130700970512               GO TO LR3-0050-0010.
130710970512
130720970512           IF  WS-II-INVESTOR-ADDRESS6
130730970512                          IS NOT EQUAL TO  SPACES
130740970512               MOVE WS-II-INVESTOR-ADDRESS6
130750970512                                       TO  II-INVESTOR-ADDRESS4
130760970512               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
130770970512               GO TO LR3-0050-0010.
130780970512
130790970512           IF  WS-II-INVESTOR-ADDRESS7
130800980211                          IS NOT EQUAL TO  SPACES
130810980211               MOVE WS-II-INVESTOR-ADDRESS7
130820980211                                       TO  II-INVESTOR-ADDRESS4
130830980211               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
130840980211
130850980211           GO TO LR3-0060.
130860980211
130870980211       LR3-0050-0010.
130880970512           IF  II-INVESTOR-ADDRESS5
130890961223                          IS NOT EQUAL TO  SPACES
130900000000               GO TO LR3-0060.
130910000000
130920970512           IF  WS-II-INVESTOR-ADDRESS6
130930000000                          IS NOT EQUAL TO  SPACES
130940000000               MOVE WS-II-INVESTOR-ADDRESS6
130950000000                                       TO  II-INVESTOR-ADDRESS5
130960000000               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS6
130970000000               GO TO LR3-0060.
130980970512
130990970120           IF  WS-II-INVESTOR-ADDRESS7
131000970120                          IS NOT EQUAL TO  SPACES
131010970120               MOVE WS-II-INVESTOR-ADDRESS7
131020970120                                       TO  II-INVESTOR-ADDRESS5
131030970512               MOVE SPACES             TO  WS-II-INVESTOR-ADDRESS7.
131040970512
131050970512       LR3-0060.
131060970512
131070970512      *****
131080970512      *****    Format the postal code, depending on the country code.
131090970512      *****
131100970512
131110970512           MOVE POSTAL-CODE
131120970512                OF ADDRESS-RECD        TO  WS-POSTAL.
131130970512           MOVE SPACES                 TO  WS-POSTAL-OUT.
131140970512
131150970512           IF  COUNTRY-CODE
131160970512               OF ADDRESS-RECD   EQUAL TO  "CAN"
131170970512               MOVE WS-POSTAL1         TO  WS-POSTAL-OUT1
131180141201               MOVE WS-POSTAL2         TO  WS-POSTAL-OUT2
131190141201               GO TO LR3-0190.
131200970512
131210970512           IF  COUNTRY-CODE
131220961230               OF ADDRESS-RECD
131230961230                          IS NOT EQUAL TO  "USA"
131240970108               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
131250110128               GO TO LR3-0190.
131260110128
131270110128           IF  WS-POSTALU2    IS EQUAL TO  SPACES
131280110128           OR  WS-POSTALU3    IS EQUAL TO  "-"
131290000623               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
131300000623               GO TO LR3-0190.
131310000623
131320000623           MOVE WS-POSTALU1            TO  WS-POSTAL-OUTU1.
131330000623           MOVE "-"                    TO  WS-POSTAL-OUTU2.
131340000623138436*    MOVE WS-POSTALU2            TO  WS-POSTAL-OUTU3.
131350010418138436     MOVE WS-POSTALU4            TO  WS-POSTAL-OUTU3.
131360010418       LR3-0190.
131370010418           MOVE WS-POSTAL-OUT          TO  II-POSTAL-CODE.
131380010418           MOVE HOLD-MAIL
131390010418                OF ADDRESS-RECD        TO  II-HOLD-MAIL.
131400010418
131410010418R91915     MOVE PROVINCE-CODE OF ADDRESS-RECD
131420010418                               TO  II-INVESTOR-PROVINCE-CODE.
131430010418R91915     MOVE CITY OF ADDRESS-RECD   TO  II-INVESTOR-CITY.
131440010418
131450010418RF6725     MOVE SPACES    TO
131460010418                            DL-NOMINEE-ADDR1
131470010418                            DL-NOMINEE-ADDR2
131480010418                            DL-NOMINEE-ADDR3
131490010418                            DL-NOMINEE-ADDR4.
131500010418
131510010418RF9145     MOVE "I"            TO WS-MAILING-ADDRESS-INDICATOR.
131520010418
131530010418      /***  Check STMT-PRINT-OPTION for Statement Run          */
131540010418
131550010418RF9415 LR3-0195-0010.
131560010418
131570010418           IF WS-LDA-STMT-CNFM-FLAG NOT = "C"
131580010418              IF ACNOMINEE OF INVESTOR-JOIN NOT = "N"
131590010418                 INITIALIZE NOMINEE-MISC-DETAILS-REC
131600010418                 MOVE NONOCODE OF INVESTOR-JOIN
131610010418                      TO NOMINEE-CODE OF NOMINEE-MISC-DETAILS-REC
131620010418                 READ NOMINEE-MISC-DETAILS
131630010418                    INVALID KEY
131640010418                     MOVE SPACES TO STMT-PRINT-OPTION
131650010418                               OF NOMINEE-MISC-DETAILS-REC
131660010418                 END-READ
131670010418                 IF STMT-PRINT-OPTION OF NOMINEE-MISC-DETAILS-REC
131680010418                               IS EQUAL TO "N"
131690010418                    PERFORM FORMAT-NOMINEE-ADDRESS   THRU  FNA-EXIT
131700010418                    MOVE "N"   TO WS-MAILING-ADDRESS-INDICATOR
131710010418                 END-IF
131720010418              END-IF
131730010418              GO TO LR3-0195-0030
131740010418           END-IF.
131750010418
131760010418      /***  Check CNFM-PRINT-OPTION for Confirm   Run          */
131770010418
131780970108RF9415 LR3-0195-0020.
131790970108
131800970108           IF WS-LDA-STMT-CNFM-FLAG   IS EQUAL TO  "C"
131810970108           AND ACNOMINEE OF INVESTOR-JOIN NOT = "N"
131820970108           AND NOCONFPRT OF INVESTOR-JOIN NOT = "I"
131830970108               PERFORM FORMAT-NOMINEE-ADDRESS   THRU  FNA-EXIT
131840970108               MOVE "N"            TO WS-MAILING-ADDRESS-INDICATOR
131850000000           END-IF.
131860000000
131870990726      ****
131880000000      ****  Format confirm address for each account when an investor
131890981109      ****  has multiple accounts
131900150416      ****
131910981110
131920981110RF9415 LR3-0195-0030.
131930010411
131940981110      *****
131950981111      *****    The HOLD MAIL flag is now available.  If the investor is
131960981111      *****    flagged as HOLD MAIL and this is the ALL DEALER or the
131970981110      *****    ALL DEALER REPRESENTATIVE run for Investor statements,
131980981110      *****    indicate that the investor is to be bypassed and exit.
131990981110      *****
132000981110
132010981110           MOVE IVSINNO      TO II-SIN-NO.
132020981110           MOVE ACDEALER     TO II-DEALER.
132030981110           MOVE ACDEALREP    TO WS-II-SALESREP.
132040981110           MOVE ACDEALREP    TO II-DEALER-REP-CODE.
132050981110           MOVE IVLEGALNM    TO II-LEGAL-NAME.
132060981110142884     PERFORM PREPARE-SECTION01-NEW-FIELD.
132070981110
132080981110           IF WS-LDA-MGMT-COM-CDE IS NOT EQUAL TO "AIC"
132090981109RF9964     AND WS-LDA-MGMT-COM-CDE       IS NOT EQUAL TO  "TAI"
132100981109              GO TO LR3-0190-0001.
132110981109           IF WS-IT-CAT (IT) NOT = "J"
132120981109              GO TO LR3-0190-0001.
132130981109
132140981109      ***                                    ***
132150981110      ***    AIC Legal Name Check.           ***
132160981110      ***                                    ***
132170981110
132180981110           MOVE SPACES        TO WS-LEGAL-NAME.
132190981110           MOVE II-LEGAL-NAME TO WS-LEGAL-NAME.
132200981110           MOVE SPACES        TO WS-LEGAL-LAST-NAME.
132210981110           MOVE IVLANAME      TO WS-LEGAL-LAST-NAME.
132220981110           IF WS-LEGAL-LNAME IS EQUAL TO WS-FIRST-THREE
132230981110              GO TO LR3-0190-0001.
132240981110
132250981110           INITIALIZE MFAIVRTEP OF INVESTOR-TENANT-REC.
132260981110           MOVE IVIVRNO      TO INVESTOR-NO
132270981110                                OF INVESTOR-TENANT-REC.
132280981120           START INVESTOR-TENANT
132290981120            KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
132300981110            INVALID KEY
132310981110            GO TO LR3-0190-0001.
132320981003
132330981003           READ INVESTOR-TENANT NEXT AT END
132340981003                GO TO LR3-0190-0001.
132350981003
132360981003           IF INVESTOR-NO OF INVESTOR-TENANT-REC IS
132370981003              NOT EQUAL TO IVIVRNO OF INVESTOR-JOIN
132380981003              GO TO LR3-0190-0001.
132390981003
132400981003              STRING LAST-NAME OF INVESTOR-TENANT-REC
132410981003                     DELIMITED BY " ",
132420981003                     " " DELIMITED BY SIZE,
132430981003                     FIRST-NAME OF INVESTOR-TENANT-REC
132440981003                         DELIMITED BY SIZE
132450981003                         INTO II-LEGAL-NAME.
132460981003
132470981003       LR3-0190-0001.
132480981003      ******************************************************
132490981003      *  AVOID PRINTING LEGAL NAME TWICE                   *
132500981003      ******************************************************
132510981003
132520981003           IF II-INVESTOR-NAME IS EQUAL TO II-INVESTOR-NAME-2
132530981003           AND II-INVESTOR-NAME-2 IS EQUAL TO II-INVESTOR-ADDRESS1
132540980917               MOVE SPACES TO II-INVESTOR-NAME-2
132550970115               MOVE SPACES TO II-INVESTOR-ADDRESS1
132560970115               GO TO LR3-0200.
132570970422
132580110128           IF II-INVESTOR-NAME-2 IS EQUAL TO II-INVESTOR-ADDRESS1
132590110128           AND WS-LDA-STMT-VERSION IS EQUAL TO "E"
132600110128               MOVE SPACES TO II-INVESTOR-ADDRESS1.
132610110128
132620110128           IF II-INVESTOR-NAME-2 IS EQUAL TO II-INVESTOR-ADDRESS1
132630970422           AND WS-LDA-STMT-VERSION IS NOT EQUAL TO "E"
132640970422               MOVE SPACES TO II-INVESTOR-NAME-2.
132650970422
132660970422           IF II-INVESTOR-NAME IS EQUAL TO II-INVESTOR-NAME-2
132670970422               MOVE SPACES TO II-INVESTOR-NAME-2.
132680970422
132690970422       LR3-0200.
132700970422
132710970422           MOVE COUNTRY-CODE
132720970422                OF ADDRESS-RECD        TO  II-COUNTRY-CODE.
132730970422           MOVE WS-INVESTOR-TYPE       TO  II-INVESTOR-TYPE.
132740970422R91915*Start the following 3 lines moved to above
132750970422R82793*    MOVE PROVINCE-CODE OF ADDRESS-RECD
132760970422      *                        TO  II-INVESTOR-PROVINCE-CODE.
132770970422R82793*    MOVE CITY OF ADDRESS-RECD   TO  II-INVESTOR-CITY.
132780970422R91915*Start
132790970422
132800970422      *****
132810970422      *****    Read the Investor Attribute.
132820970422      *****
132830970422
132840970422           INITIALIZE MFAIVRATP.
132850970422           MOVE CURR-INVESTOR          TO  INVESTOR-NO
132860970422                                           OF INVESTOR-ATTRIBUTE-REC.
132870970422           START INVESTOR-ATTRIBUTE
132880970422               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
132890970422               INVALID KEY
132900970422                   MOVE SPACES         TO  INVESTOR-ATTRIBUTE-CODE
132910970422                                           OF INVESTOR-ATTRIBUTE-REC
132920970422                   GO TO LR3-0210.
132930970422
132940970422           READ INVESTOR-ATTRIBUTE NEXT
132950980129                                       AT  END
132960980129               MOVE SPACES             TO  INVESTOR-ATTRIBUTE-CODE
132970980129                                           OF INVESTOR-ATTRIBUTE-REC
132980001005               GO TO LR3-0210.
132990001005
133000001005           IF  INVESTOR-NO
133010001005               OF INVESTOR-ATTRIBUTE-REC
133020001005                          IS NOT EQUAL TO  CURR-INVESTOR
133030001005               MOVE SPACES             TO  INVESTOR-ATTRIBUTE-CODE
133040001005                                           OF INVESTOR-ATTRIBUTE-REC.
133050981128
133060981128       LR3-0210.
133070031006           MOVE INVESTOR-ATTRIBUTE-CODE
133080990312                OF INVESTOR-ATTRIBUTE-REC
133090990312                                       TO  II-INVESTOR-ATTRIBUTE-CODE.
133100990312           MOVE IVSTMFREQ              TO  II-STATEMENT-FREQUENCY.
133110990312           MOVE IVLANAME OF INVESTOR-JOIN    TO II-LAST-NAME.
133120990312           MOVE IVFIRNAME OF INVESTOR-JOIN   TO II-FIRST-NAME.
133130990312           MOVE IVINITIALS OF INVESTOR-JOIN  TO II-INITIALS.
133140990312
133150990312
133160990312RF7703     IF IVSALCODE  OF INVESTOR-JOIN  IS NOT EQUAL TO SPACES
133170990312              MOVE IVSALCODE OF INVESTOR-JOIN  TO II-SALUTATION-CODE
133180990312           ELSE
133190981128              MOVE SPACES                      TO II-SALUTATION-CODE
133200990519           END-IF.
133210980611
133220990312           IF WS-LDA-ALLTYP  IS EQUAL TO  "R"
133230980722R18368        INITIALIZE MFADEAREP OF DEALER-REP-REC
133240980722              MOVE ACDEALER               TO  DEALER-CODE
133250980724                                          OF DEALER-REP-REC
133260980724              MOVE ACDEALREP              TO  DEALER-REP-CODE
133270980724                                          OF DEALER-REP-REC
133280980724              READ DEALER-REP
133290980724                  INVALID KEY
133300980724                  MOVE SPACES TO  II-DELIVERY-METHOD
133310980724              END-READ
133320980724              MOVE METHOD-OF-DELIVERY OF DEALER-REP-REC
133330980724                                  TO  II-DELIVERY-METHOD.
133340990525
133350990512           IF WS-LDA-ALLTYP  IS EQUAL TO  "D"
133360990525               MOVE WS-DELIVERY-METHOD-DLR
133370990512                                       TO  II-DELIVERY-METHOD.
133380990512
133390990512           MOVE IVSTAFF OF INVESTOR-JOIN     TO II-STAFF.
133400990512           MOVE IVCRTDAT OF INVESTOR-JOIN    TO II-CREATION-DATE.
133410990512
133420990512           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO "S"
133430990525              MOVE "N"                       TO II-NEW-INVESTOR-FLAG.
133440990512
133450990512           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO "S"
133460990512           AND II-CREATION-DATE IS NOT LESS THAN CURR-START-DATE
133470980129           AND II-CREATION-DATE IS NOT GREATER THAN CURR-END-DATE
133480980129              MOVE "Y"                       TO II-NEW-INVESTOR-FLAG.
133490980914
133500980917           INITIALIZE MFAIVRMKP OF INVESTOR-MARKET-INFO-REC.
133510980917           MOVE II-INVESTOR-NO         TO  INVESTOR-NO
133520980914                            OF INVESTOR-MARKET-INFO-REC.
133530970422           READ INVESTOR-MARKETING-INFO
133540970422                  INVALID KEY
133550970422                   MOVE SPACES TO II-SOLICITATION-CODE
133560970422                   GO TO LR3-0220
133570971024           END-READ.
133580970422
133590980520           MOVE SOLICITATION-CODE OF INVESTOR-MARKET-INFO-REC
133600980520                              TO  II-SOLICITATION-CODE.
133610000000
133620000000       LR3-0220.
133630000000           MOVE CURR-START-DATE              TO II-START-DATE.
133640990620           MOVE CURR-END-DATE                TO II-END-DATE.
133650990620
133660001103           INITIALIZE                      WS-II-SECTION-INV.
133670001103           MOVE INVESTOR-INFO-SECTION   TO WS-II-SECTION-INV.
133680001103
133690001103      *****
133700001103      *****    Initialize the level accumulators.
133710990620      *****
133720980717
133730990106           MOVE ZEROES                 TO  WS-IVR-OPNMKTVAL.
133740990619           MOVE ZEROES                 TO  WS-IVR-WITHDRAWALS-YTD.
133750990619980514     MOVE ZEROES                 TO  WS-ORIGIN-COST-I.
133760990619
133770990619           INITIALIZE WS-IVR-TOTAL-VALUE
133780990619                      WS-IVR-1ST-60
133790990619                      WS-IVR-REMAINDER
133800990619                      WS-IVR-1ST-60-EX
133810990619                      WS-IVR-REMAINDER-EX
133820990619
133830990619RF8276                WS-IVR-BKVAL-CDN-TOT
133840990619                      WS-IVR-BKVAL-FGN-TOT
133850990619                      WS-IVR-MKTVAL-CHGINC-TOT
133860990619                      WS-IVR-MKTVAL-CHGCUR-TOT
133870990619
133880990619                      WS-IVR-WITHDRAWALS
133890990619                      WS-INVESTOR-TOTALS
133900990619                      WS-IVR-CPG-YTD
133910990106                      WS-IVR-INC-YTD
133920000000                      WS-IVR-INT-YTD
133930000000                      WS-IVR-RED-YTD
133940970108                      WS-IVR-PUR-YTD
133950970108                      WS-IVR-REG-CTB-CUR
133960970108                      WS-IVR-REG-CTB-INCPT
133970970108                      WS-IVR-CPG-YTD-EX
133980970108                      WS-IVR-INC-YTD-EX
133990970108                      WS-IVR-INT-YTD-EX
134000970108                      WS-IVR-RED-YTD-EX
134010970108                      WS-IVR-PUR-YTD-EX
134020970108                      WS-IVR-REG-CTB-CUR-EX
134030970108                      WS-IVR-REG-CTB-INCPT-EX
134040970108
134050970108                      WS-IVR-WHTAX-YTD
134060970108                      WS-IVR-NRTAX-YTD.
134070970108
134080970108       LR3-EXIT.
134090970108           EXIT.
134100970108      /
134110970108       LEVEL-REINIT-4.
134120970108
134130970108      ******************************************************************
134140970108      *                                                                *
134150970108      *    L E V E L   R E I N I T I A L I Z A T I O N   4   R T N .   *
134160980610      *                                                                *
134170980610      *        ACDEALREP:  Dealer Representative                       *
134180970108      *                                                                *
134190030826      ******************************************************************
134200030826
134210030826      *****
134220030826      *****    Remember, this level is only to be used for INVESTOR type
134230030826      *****    statements, indicated by position 610 of the LDA contains
134240030826      *****    a value of 'D' (Dealer) or 'R' (Dealer Representative).
134250040712      *****
134260030826      *****    The dealer representative will be bypassed if:
134270040712      *****     1. The Dealer is being bypassed;
134280030826      *****     2. This is an ALL DEALER REPRESENTATIVE run for Investor
134290980708      *****        statements and neither the dealer nor the dealer
134300040712      *****        representative is to have statements generated.
134310030826      *****
134320030826
134330030826           MOVE "Y"                    TO  WS-LR4BYP-SW.
134340980610
134350040712R18143     IF  WS-LDA-REQUEST-SCOPE IS EQUAL TO "E" OR "C" OR "T"
134360040712   |           MOVE "N"                TO  WS-LR4BYP-SW
134370040712   |           GO TO LR4-0030
134380040712   V       END-IF.
134390040712
134400040712           IF  WS-LR5BYP-SW = "Y"
134410040712R20804       IF WS-DLRREP-FREQ NOT = "Y"
134420030826               GO TO LR4-0030
134430030826R20804       END-IF
134440030826           END-IF.
134450030826
134460040712R20804     IF  WS-LDA-STMT-CNFM-FLAG = "C"
134470040712               MOVE "N"  TO  WS-LR4BYP-SW
134480040712               GO TO LR4-0030
134490040712           END-IF.
134500040712
134510040712R20804     IF  WS-LDA-ALLTYP NOT = "R"
134520040712   |         IF WS-DLRREP-FREQ NOT = "Y"
134530040712   |           MOVE "N"  TO  WS-LR4BYP-SW
134540030826   |           GO TO LR4-0030
134550030826   |         END-IF
134560970108R20804     END-IF.
134570030826
134580040713      *****
134590040712      *****    The Dealer Mailing Instructions will be read depending
134600040713      *****    on whether this is a confirmation or a statement run.
134610040713      *****
134620040712
134630040712R21714     IF WS-LDA-STMT-CNFM-FLAG = "S"
134640040712  ¦           IF WS-SKIP-CODE-VALIDATION = "Y"
134650040712  ¦              MOVE "N" TO WS-LR4BYP-SW
134660040712  ¦              GO TO LR4-0040
134670040712  V           END-IF
134680040712R21714     END-IF.
134690040712
134700040712           MOVE "CLTSTREP  "       TO  WS-FORM-CODE.
134710040712
134720040712       LR4-0010.
134730040712R18143     PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
134740030826R18143     IF WS-RETURN-CODE = "00"
134750030826R20804      IF WS-DLRREP-FREQ NOT = "Y"
134760030826R18143        MOVE "N" TO WS-LR4BYP-SW
134770030826R18143        GO TO LR4-0030
134780030826R20804      ELSE
134790030826  |           MOVE "N" TO WS-LR4BYP-SW
134800030826  |           PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT
134810030826  |           IF WS-RETURN-CODE = "00"
134820030826  |              GO TO LR4-0030
134830030826  |           ELSE
134840030826  |              IF WS-RETURN-CODE = "98"
134850030826  |                 MOVE "Y" TO WS-LR4BYP-SW
134860030826  |              END-IF
134870030826  |              GO TO LR4-0030
134880030826  |           END-IF
134890030826R20804      END-IF
134900030826R18143     END-IF.
134910030826
134920030826       LR4-0020.
134930030826R18143     PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT.
134940030826   |       IF WS-RETURN-CODE = "00"
134950030826   |          MOVE "N" TO WS-LR4BYP-SW
134960030826   V          GO TO LR4-0030
134970030826R18143     END-IF.
134980030826
134990030826       LR4-0030.
135000000413RF6654     IF WS-LDA-ALLTYP NOT EQUAL TO  "R"
135010000413              GO TO LR4-EXIT
135020031006           END-IF.
135030000413
135040030826           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO "C"
135050030826              MOVE "SUPCNREP"         TO  WS-FORM-CODE
135060030826           ELSE
135070000413              MOVE "SUPSTREP  "       TO  WS-FORM-CODE
135080000413           END-IF.
135090000413
135100000413R18143     PERFORM GET-DEALER-REP-MAILING-INST THRU GDRMI-EXIT.
135110000413   |       IF WS-RETURN-CODE = "00"
135120030826   |          MOVE "Y" TO WS-LR4BYP-SW
135130000413   V          GO TO LR4-0040
135140000413R18143     END-IF.
135150000413
135160970108RF6633 LR4-0040.
135170970108
135180970108R18368     INITIALIZE MFADEAREP OF DEALER-REP-REC.
135190970108
135200970108           MOVE ACDEALER  TO DEALER-CODE OF DEALER-REP-REC.
135210970108           MOVE ACDEALREP TO DEALER-REP-CODE OF DEALER-REP-REC.
135220970108
135230970108           READ DEALER-REP
135240970108               INVALID KEY
135250970108                   DISPLAY "INVALID REP CODE WAS FOUND"
135260970108           END-READ.
135270970108
135280970108           IF DEALER-REP-STATUS OF DEALER-REP-REC NOT = "A"
135290970108               MOVE "Y"                TO  WS-LR4BYP-SW
135300970108           END-IF.
135310970108
135320970108       LR4-EXIT.
135330970108           EXIT.
135340970108      /
135350970108       LEVEL-REINIT-5.
135360970108
135370970108      ******************************************************************
135380970108      *                                                                *
135390971024      *    L E V E L   R E I N I T I A L I Z A T I O N   5   R T N .   *
135400970108      *                                                                *
135410971122      *        ACDEALER:   Dealer                                      *
135420980708      *                                                                *
135430971122      ******************************************************************
135440971122
135450971122      *****
135460971122      *****    Remember, this level is only to be used for INVESTOR type
135470971122      *****    statements, indicated by position 610 of the LDA contains
135480030826      *****    a value of 'D' (Dealer) or 'R' (Dealer Representative).
135490030826      *****
135500030826      *****    The dealer will be bypassed if:
135510040712      *****     1. This is an ALL DEALER run for Investor statements and
135520040712      *****        the dealer is not to have statements generated.
135530040712      *****
135540040712
135550040712           IF  WS-LDA-ALLTYP NOT EQUAL TO  "D"
135560040712               GO TO LR5-0020.
135570990519
135580990519
135590990519      *****
135600030826      *****    The Dealer Mailing Instructions will be read depending
135610040712      *****    on whether this is a confirmation or a statement run.
135620040712      *****
135630040712
135640030826R18143     MOVE SPACES TO WS-DELIVERY-METHOD-DLR.
135650970108R18143     MOVE "N" TO WS-LR5BYP-SW.
135660030826
135670030826R21714     IF WS-LDA-STMT-CNFM-FLAG = "S"
135680030826  ¦           IF WS-SKIP-CODE-VALIDATION = "Y"
135690030826  ¦              GO TO LR5-0020
135700030826  V           END-IF
135710030826R21714     END-IF.
135720030826
135730970108           IF WS-LDA-STMT-CNFM-FLAG IS EQUAL TO "C"
135740030826              MOVE "CONFMDLR"         TO  WS-FORM-CODE
135750030826           ELSE
135760030826              MOVE "CLTSTDLR  "       TO  WS-FORM-CODE
135770990210R20804        IF WS-DLR-FREQ = "Y"
135780970108   |             MOVE "CLTSTREP  "    TO  WS-FORM-CODE
135790970108R20804        END-IF
135800970108           END-IF.
135810970108
135820980626R18143     PERFORM GET-DEALER-MAILING-INSTRUCTION THRU GDMI-EXIT.
135830980626   |       IF WS-RETURN-CODE = "00"
135840980626   |          MOVE METHOD-OF-DELIVERY OF DEALER-MAILING-INST-REC
135850980626   |            TO WS-DELIVERY-METHOD-DLR
135860980626   V          GO TO LR5-0020
135870980626R18143     END-IF.
135880030826
135890030826       LR5-0010.
135900980626RF6362     IF  WS-LDA-REQUEST-SCOPE = "C" OR "E" OR "T"
135910030826               GO TO LR5-0020
135920030826           END-IF.
135930980626
135940980626           MOVE "Y"                    TO  WS-LR5BYP-SW.
135950980626           GO TO LR5-EXIT.
135960980626
135970030826       LR5-0020.
135980030826
135990030826      *****
136000030826      *****    Read the appropriate files and format the dealer address
136010030826      *****    lines.
136020030826      *****
136030030826
136040980626           INITIALIZE  MFAINADDP OF INSTITUTION-ADDR-REC.
136050980626           INITIALIZE  MFADEAP OF DEALER-REC.
136060980626
136070980626           MOVE CURR-DEALER TO DEALER-CODE OF DEALER-REC.
136080030826
136090030826           READ DEALER
136100030826               INVALID KEY
136110980626                   GO TO LR5-0030.
136120980626
136130030826           INITIALIZE  MFAINSBRP OF INSTITUTION-BRANCH-REC.
136140030826
136150030826           MOVE INSTITUTION-CODE OF DEALER-REC
136160980626             TO  INSTITUTION-CODE OF INSTITUTION-BRANCH-REC.
136170980626           MOVE BRANCH-CODE OF DEALER-REC
136180980626             TO  BRANCH-CODE OF INSTITUTION-BRANCH-REC.
136190980626
136200980626           READ INSTITUTION-BRANCH
136210980626               INVALID KEY
136220980626                   GO TO LR5-0030.
136230020423
136240980626           MOVE ADDR-NO OF INSTITUTION-BRANCH-REC
136250980626             TO  ADDR-NO OF INSTITUTION-ADDR-REC.
136260980626
136270980626           READ INSTITUTION-ADDRESS
136280980626               INVALID KEY
136290980626                   INITIALIZE MFAINADDP OF INSTITUTION-ADDR-REC
136300980626                   GO TO LR5-0030
136310980626           END-READ.
136320090309
136330090309       LR5-0030.
136340090309           MOVE SPACES                 TO  WS-DEALER-ADDR1.
136350090309           MOVE SPACES                 TO  WS-DEALER-ADDR2.
136360090305           MOVE SPACES                 TO  WS-DEALER-ADDR3.
136370090309           MOVE SPACES                 TO  WS-DEALER-ADDR4.
136380090305           MOVE SPACES                 TO  WS-DEALER-ADDR5.
136390090309R13011     MOVE SPACES                 TO  WS-ADDR4-SEPARATE.
136400090305
136410090309      *****
136420090305      *****    Format dealer address line 1 using the Street Number, the
136430090309      *****    Street Name, the Street Type and the Street Direction.
136440090305      *****    Each field will be handled separately in case one or more
136450090309      *****    of the fields contain spaces.
136460090306      *****
136470090309
13648009030666105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
13649009030966105      Set pb-adrStreet   to True.
13650009030666105      Set pb-adrProvince to True.
13651009030566105      Move ","               to pc-InComma
13652009030966105      Move STREET-NO         OF INSTITUTION-ADDR-REC
13653009030966105                             to pc-InStreetNo.
13654009030966105      Move STREET-NAME       OF INSTITUTION-ADDR-REC
13655009030566105                             to pc-InStreetName.
13656009030966105      Move STREET-TYPE-CODE  OF INSTITUTION-ADDR-REC
13657009030566105                             to pc-InStreetTypeCode.
13658009030566105      Move PROVINCE-CODE     OF INSTITUTION-ADDR-REC
13659009030566105                             to pc-InProvinceCode.
13660009030566105      Move STREET-DIRCT-CODE OF INSTITUTION-ADDR-REC
13661009030566105                             to pc-InDirectionCode.
13662009030566105      Move CITY              OF INSTITUTION-ADDR-REC
13663098062666105                             to pc-InCity.
13664009030566105      If COUNTRY-CODE OF INSTITUTION-ADDR-REC Not = "CAN"
13665009030566105         Move COUNTRY-CODE OF INSTITUTION-ADDR-REC to pc-InCountry
13666009030566105      End-If
136670090305
13668009030566105      Call "FXSTRTADR" using pt-StreetAddressAction,
13669009030566105                             pt-StreetAddressIn,
13670009030566105                             pt-StreetAddressOut.
13671009030566105
13672009030566105      Move pc-OutStreet To WS-DEALER-ADDR1.
136730090305
13674009030566105 *    MOVE SPACES                 TO  WS-ADRTMP.
13675009030566105 *    STRING STREET-NO
13676009030566105 *        OF INSTITUTION-ADDR-REC
13677009030566105 *                      DELIMITED BY  "  "
13678009030566105 *                              INTO  WS-ADRTMP.
136790090305
13680009030566105 *    IF  PROVINCE-CODE
13681009030566105 *        OF INSTITUTION-ADDR-REC
13682009030566105 *                       IS EQUAL TO  "QC"
13683009030566105 *        GO TO LR5-0040.
13684009030566105 *
13685009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13686009030566105 *        STRING STREET-NAME
13687009030566105 *               OF INSTITUTION-ADDR-REC
13688009030566105 *                      DELIMITED BY  "  "
13689009030566105 *                              INTO  WS-ADRTMP
13690009030566105 *      ELSE
13691009030566105 *        STRING WS-ADRTMP
13692009030566105 *                      DELIMITED BY  "  ",
13693009030566105 *               " "    DELIMITED BY  SIZE,
13694009030566105 *               STREET-NAME
13695009030566105 *               OF INSTITUTION-ADDR-REC
13696009030566105 *                      DELIMITED BY  "  "
13697009030566105 *                              INTO  WS-DEALER-ADDR1
13698009030566105 *        MOVE WS-DEALER-ADDR1    TO  WS-ADRTMP.
13699009030566105 *
13700009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13701009030566105 *        STRING STREET-TYPE-CODE
13702009030566105 *               OF INSTITUTION-ADDR-REC
13703009030566105 *                      DELIMITED BY  "  "
13704009030566105 *                              INTO  WS-ADRTMP
13705009030566105 *      ELSE
13706009030566105 *        STRING WS-ADRTMP
13707009030566105 *                      DELIMITED BY  "  ",
13708009030566105 *               " "    DELIMITED BY  SIZE,
13709009030566105 *               STREET-TYPE-CODE
13710009030566105 *               OF INSTITUTION-ADDR-REC
13711009030566105 *                      DELIMITED BY  "  "
13712009030566105 *                              INTO  WS-DEALER-ADDR1
13713009030566105 *        MOVE WS-DEALER-ADDR1    TO  WS-ADRTMP.
13714009030566105 *
13715009030566105 *    GO TO LR5-0050.
13716009030566105 *
13717009030566105 *LR5-0040.
13718009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13719009030566105 *        STRING STREET-TYPE-CODE
13720009030566105 *               OF INSTITUTION-ADDR-REC
13721009030566105 *                      DELIMITED BY  "  "
13722009030566105 *                              INTO  WS-ADRTMP
13723009030566105 *      ELSE
13724009030566105 *        STRING WS-ADRTMP
13725009030566105 *                      DELIMITED BY  "  ",
13726009030566105 *               " "    DELIMITED BY  SIZE,
13727009030566105 *               STREET-TYPE-CODE
13728009030566105 *               OF INSTITUTION-ADDR-REC
13729009030566105 *                      DELIMITED BY  "  "
13730009030566105 *                              INTO  WS-DEALER-ADDR1
13731009030566105 *        MOVE WS-DEALER-ADDR1    TO  WS-ADRTMP.
13732009030566105 *
13733009030566105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13734009030566105 *        STRING STREET-NAME
13735009030566105 *               OF INSTITUTION-ADDR-REC
13736009030566105 *                      DELIMITED BY  "  "
13737009030566105 *                              INTO  WS-ADRTMP
13738009030566105 *      ELSE
13739009030566105 *        STRING WS-ADRTMP
13740009030566105 *                      DELIMITED BY  "  ",
13741009030566105 *               " "    DELIMITED BY  SIZE,
13742009030566105 *               STREET-NAME
13743009030566105 *               OF INSTITUTION-ADDR-REC
13744009030566105 *                      DELIMITED BY  "  "
13745009030566105 *                              INTO  WS-DEALER-ADDR1
13746009030566105 *        MOVE WS-DEALER-ADDR1    TO  WS-ADRTMP.
13747009030566105 *
13748009030566105 *LR5-0050.
13749098062666105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13750098062666105 *        STRING STREET-DIRCT-CODE
13751098062666105 *               OF INSTITUTION-ADDR-REC
13752098062666105 *                      DELIMITED BY  "  "
13753098062666105 *                              INTO  WS-ADRTMP
13754098062666105 *      ELSE
13755098062666105 *        STRING WS-ADRTMP
13756098062666105 *                      DELIMITED BY  "  ",
13757098062666105 *               " "    DELIMITED BY  SIZE,
13758098062666105 *               STREET-DIRCT-CODE
13759098062666105 *               OF INSTITUTION-ADDR-REC
13760098062666105 *                      DELIMITED BY  "  "
13761003091766105 *                              INTO  WS-DEALER-ADDR1
13762098062666105 *        MOVE WS-DEALER-ADDR1    TO  WS-ADRTMP.
13763098062666105 *
13764098062666105 *    MOVE WS-ADRTMP              TO  WS-DEALER-ADDR1.
137650980626      *****
137660980626      *****    Format dealer address lines 2, 3 and 4.
137670980626      *****
137680980626
137690980626           MOVE MISC-FIRST-ADDR-LINE
137700980626                OF INSTITUTION-ADDR-REC
137710980626                                       TO  WS-DEALER-ADDR2.
137720980626           MOVE MISC-SECOND-ADDR-LINE
137730980626                OF INSTITUTION-ADDR-REC
137740980626                                       TO  WS-DEALER-ADDR3.
137750980626           MOVE CO-OR-ATTENTION
137760980626                OF INSTITUTION-ADDR-REC
137770090306R17380                                 TO  WS-DEALER-CO-ATTN.
137780090306
137790090306      *****
137800090306      *****    Format dealer address line 5 using the City, the Province
137810090306      *****    and the Postal Code.  Each field will be handled
137820090306      *****    separately in case one or more of the fields contain
137830090306      *****    spaces.
137840090306      *****
137850090306
137860090306           MOVE POSTAL-CODE
137870090306                OF INSTITUTION-ADDR-REC
137880090306                                       TO  WS-PSTLCDI.
137890090306           MOVE SPACES                 TO  WS-PSTLCDO.
137900090306           MOVE WS-PSTLCDI1            TO  WS-PSTLCDO1.
137910090306           MOVE WS-PSTLCDI2            TO  WS-PSTLCDO2.
137920090306
13793009030666105 *    MOVE SPACES                 TO  WS-ADRTMP.
13794009030666105 *    STRING CITY
13795009030666105 *        OF INSTITUTION-ADDR-REC
13796009030666105 *                      DELIMITED BY  "  "
13797009030666105 *                              INTO  WS-ADRTMP.
13798009030666105 *
13799009030666105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13800009030666105 *        STRING PROVINCE-CODE
13801009030666105 *               OF INSTITUTION-ADDR-REC
13802009030666105 *                      DELIMITED BY  "  "
13803009030666105 *                              INTO  WS-ADRTMP
13804009030666105 *        GO TO LR5-0060.
13805009030666105 *
13806009030666105 *    IF  PROVINCE-CODE
13807009030666105 *        OF INSTITUTION-ADDR-REC
13808009030666105 *                       IS EQUAL TO  SPACES
13809009030666105 *        GO TO LR5-0060.
13810009030666105 *
13811009030666105 *    STRING WS-ADRTMP  DELIMITED BY  "  ",
13812009030666105 *           ", "       DELIMITED BY  SIZE,
13813009030666105 *           PROVINCE-CODE
13814009030666105 *           OF INSTITUTION-ADDR-REC
13815009030666105 *                      DELIMITED BY  "  "
13816009030666105 *                              INTO  WS-DEALER-ADDR5.
13817009030666105 *    MOVE WS-DEALER-ADDR5        TO  WS-ADRTMP.
13818098062666105 *
13819009030666105 *LR5-0060.
13820009030666105 *    IF  WS-ADRTMP      IS EQUAL TO  SPACES
13821009030966105 *        STRING WS-PSTLCDO
13822009050466105 *                      DELIMITED BY  "  "
13823009030966105 *                              INTO  WS-ADRTMP
13824009030966105 *      ELSE
13825009050466105 *        STRING WS-ADRTMP
13826009030966105 *                      DELIMITED BY  "  ",
13827009030966105 *               "  "   DELIMITED BY  SIZE,
13828009030966105 *               WS-PSTLCDO
13829009030666105 *                      DELIMITED BY  "  "
13830003091866105 *                              INTO  WS-DEALER-ADDR5
13831002042366105 *        MOVE WS-DEALER-ADDR5    TO  WS-ADRTMP.
13832003091866105 *
13833002042366105 *    MOVE WS-ADRTMP              TO  WS-DEALER-ADDR5.
138340030918
13835003121966105      Move WS-PSTLCDO to lc-PostalCode
138360030918
13837002042366105      Move Spaces           to lc-Line80.
13838098062666105      String function trim(ws-Dealer-Addr5) "  "
13839098062666105             pc-OutProvince Delimited by Size
13840098062666105        Into lc-Line80.
13841098062666105      String function trim(lc-Line80) "  "
13842098062666105             lc-PostalCode  Delimited by Size
13843098062666105        Into lc-Line80.
13844098062666105      Move lc-Line80 (1:40) to ws-Dealer-Addr5.
138450980626
138460980626R13011     IF WS-LDA-SEG-DEALER-ADD = "Y"
138470980626              MOVE CITY          OF INSTITUTION-ADDR-REC
138480980626                                     TO WS-ADDR4-SEPARATE-CITY
138490980626              MOVE PROVINCE-CODE OF INSTITUTION-ADDR-REC
138500980626                                     TO WS-ADDR4-SEPARATE-PROV
138510980626R17991        MOVE WS-PSTLCDO        TO WS-ADDR4-SEPARATE-POST
138520980626R13011     END-IF.
138530980626
138540980626      *****
138550980626      *****    Compress the address lines, removing all blank lines.
138560980626      *****
138570980626
138580980626           IF  WS-DEALER-ADDR1
138590980626                          IS NOT EQUAL TO  SPACES
138600980626               GO TO LR5-0070.
138610980626
138620980626           IF  WS-DEALER-ADDR2
138630980626                          IS NOT EQUAL TO  SPACES
138640030917               MOVE WS-DEALER-ADDR2    TO  WS-DEALER-ADDR1
138650030918               MOVE SPACES             TO  WS-DEALER-ADDR2
138660020423               GO TO LR5-0070.
138670010406
138680010406           IF  WS-DEALER-ADDR3
138690010406                          IS NOT EQUAL TO  SPACES
138700980626               MOVE WS-DEALER-ADDR3    TO  WS-DEALER-ADDR1
138710980626               MOVE SPACES             TO  WS-DEALER-ADDR3
138720010406               GO TO LR5-0070.
138730010406
138740980626           IF  WS-DEALER-ADDR4
138750010402                          IS NOT EQUAL TO  SPACES
138760980626               MOVE WS-DEALER-ADDR4    TO  WS-DEALER-ADDR1
138770980626               MOVE SPACES             TO  WS-DEALER-ADDR4
138780980626               GO TO LR5-0070.
138790980626
138800980626RF9408     IF  WS-DEALER-ADDR5 IS NOT EQUAL TO  SPACES
138810980626           AND WS-LDA-SEG-DEALER-ADD = "Y"
138820980626R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-DEALER-ADDR4
138830980626                  MOVE SPACES             TO  WS-DEALER-ADDR5
138840980626RF9408            GO TO LR5-0100.
138850980626
138860980626           IF  WS-DEALER-ADDR5
138870980626                          IS NOT EQUAL TO  SPACES
138880980626               MOVE WS-DEALER-ADDR5    TO  WS-DEALER-ADDR1
138890980626               MOVE SPACES             TO  WS-DEALER-ADDR5.
138900980626
138910980626           GO TO LR5-0100.
138920980626
138930980626       LR5-0070.
138940010406           IF  WS-DEALER-ADDR2
138950030918                          IS NOT EQUAL TO  SPACES
138960020423               GO TO LR5-0080.
138970010406
138980010406           IF  WS-DEALER-ADDR3
138990010406                          IS NOT EQUAL TO  SPACES
139000980626               MOVE WS-DEALER-ADDR3    TO  WS-DEALER-ADDR2
139010980626               MOVE SPACES             TO  WS-DEALER-ADDR3
139020010406               GO TO LR5-0080.
139030010406
139040980626           IF  WS-DEALER-ADDR4
139050010402                          IS NOT EQUAL TO  SPACES
139060980626               MOVE WS-DEALER-ADDR4    TO  WS-DEALER-ADDR2
139070980626               MOVE SPACES             TO  WS-DEALER-ADDR4
139080980626               GO TO LR5-0080.
139090980626
139100980626RF9408     IF  WS-DEALER-ADDR5 IS NOT EQUAL TO  SPACES
139110980626           AND WS-LDA-SEG-DEALER-ADD = "Y"
139120980626R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-DEALER-ADDR4
139130980626                  MOVE SPACES             TO  WS-DEALER-ADDR5
139140980626RF9408            GO TO LR5-0100.
139150980626
139160980626           IF  WS-DEALER-ADDR5
139170010406                          IS NOT EQUAL TO  SPACES
139180030918               MOVE WS-DEALER-ADDR5    TO  WS-DEALER-ADDR2
139190020423               MOVE SPACES             TO  WS-DEALER-ADDR5.
139200010406
139210010406           GO TO LR5-0100.
139220010406
139230980626       LR5-0080.
139240980626           IF  WS-DEALER-ADDR3
139250010406                          IS NOT EQUAL TO  SPACES
139260010406               GO TO LR5-0090.
139270980626           IF  WS-DEALER-ADDR4
139280980626                          IS NOT EQUAL TO  SPACES
139290980626               MOVE WS-DEALER-ADDR4    TO  WS-DEALER-ADDR3
139300980626               MOVE SPACES             TO  WS-DEALER-ADDR4
139310010406               GO TO LR5-0090.
139320010406
139330030918RF9408     IF  WS-DEALER-ADDR5 IS NOT EQUAL TO  SPACES
139340010406           AND WS-LDA-SEG-DEALER-ADD = "Y"
139350020423R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-DEALER-ADDR4
139360010406                  MOVE SPACES             TO  WS-DEALER-ADDR5
139370010406RF9408            GO TO LR5-0100.
139380980626
139390980626           IF  WS-DEALER-ADDR5
139400010406                          IS NOT EQUAL TO  SPACES
139410010406               MOVE WS-DEALER-ADDR5    TO  WS-DEALER-ADDR3
139420010406               MOVE SPACES             TO  WS-DEALER-ADDR5.
139430010406
139440020423           GO TO LR5-0100.
139450010406
139460010406       LR5-0090.
139470010406
139480980626RF9408     IF  WS-DEALER-ADDR4 IS NOT EQUAL TO  SPACES
139490980626           AND WS-LDA-SEG-DEALER-ADD = "Y"
139500010406                  MOVE SPACES             TO  WS-DEALER-ADDR4
139510010406R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-DEALER-ADDR4
139520980626                  MOVE SPACES             TO  WS-DEALER-ADDR5
139530980626RF9408            GO TO LR5-0100.
139540980626           IF  WS-DEALER-ADDR4
139550970108                          IS NOT EQUAL TO  SPACES
139560970108               GO TO LR5-0100.
139570970108
139580000000RF9408     IF  WS-DEALER-ADDR5 IS NOT EQUAL TO  SPACES
139590000000           AND WS-LDA-SEG-DEALER-ADD = "Y"
139600000000R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-DEALER-ADDR4
139610000000                  MOVE SPACES             TO  WS-DEALER-ADDR5
139620000000RF9408            GO TO LR5-0100.
139630000000
139640000000           IF  WS-DEALER-ADDR5
139650000000                          IS NOT EQUAL TO  SPACES
139660000000               MOVE WS-DEALER-ADDR5    TO  WS-DEALER-ADDR4
139670000000               MOVE SPACES             TO  WS-DEALER-ADDR5.
139680970108
139690970108       LR5-0100.
139700970108           CONTINUE.
139710970108
139720160523       LR5-EXIT.
139730160523           EXIT.
139740970108      /
139750970108       LEVEL-SUMMARY-1.
139760980624
139770980717      ******************************************************************
139780980717      *                                                                *
139790981222      *    L E V E L   S U M M A R I Z A T I O N   1   R O U T I N E   *
139800980717      *                                                                *
139810980717      *        INVESTMENT-CODE                                         *
139820981222      *                                                                *
139830981222      ******************************************************************
139840981222
139850011203      *****
139860991230      *****    If the account being processed is to be bypassed, exit.
139870981222      *****
139880981222
139890001006
139900991230           IF  WS-LR2BYP-SW   IS EQUAL TO  "Y"
139910001006               GO TO LS1-EXIT.
139920981222
139930001006      *****
139940020923      *****    Accumulate the incept total of fund to the account
139950020923      *****    level and YTD total of fund to the account
139960030317      *****
139970030317
139980030624           ADD WS-INV-CPG-INCEPT       TO  WS-ACC-CPG-INCEPT.
139990030624           ADD WS-INV-INC-INCEPT       TO  WS-ACC-INC-INCEPT.
140000030624           ADD WS-INV-INT-INCEPT       TO  WS-ACC-INT-INCEPT.
140010030624           ADD WS-INV-PUR-INCEPT       TO  WS-ACC-PUR-INCEPT.
140020030624RF5905     ADD WS-INV-PUR-INCEPT-P     TO  WS-ACC-PUR-INCEPT-P.
140030030624           ADD WS-INV-RED-INCEPT       TO  WS-ACC-RED-INCEPT.
140040030624           ADD WS-INV-TRI-INCEPT       TO  WS-ACC-TRI-INCEPT.
140050030624RF7777     ADD WS-INV-SWI-INCEPT       TO  WS-ACC-SWI-INCEPT.
140060030624RF5905     ADD WS-INV-TRI-INCEPT-P     TO  WS-ACC-TRI-INCEPT-P.
140070030624RF7777     ADD WS-INV-SWI-INCEPT-P     TO  WS-ACC-SWI-INCEPT-P.
140080030624           ADD WS-INV-TRO-INCEPT       TO  WS-ACC-TRO-INCEPT.
140090030624RF7777     ADD WS-INV-SWO-INCEPT       TO  WS-ACC-SWO-INCEPT.
140100021202R14556     ADD WS-INV-TRI-INCEPT-COST  TO  WS-ACC-TRI-INCEPT-COST.
140110021202R14556     ADD WS-INV-TRO-INCEPT-COST  TO  WS-ACC-TRO-INCEPT-COST.
140120021202R16256     ADD WS-INV-TRI-INCEPT-MKT   TO  WS-ACC-TRI-INCEPT-MKT.
140130021202R16256     ADD WS-INV-TRO-INCEPT-MKT   TO  WS-ACC-TRO-INCEPT-MKT.
140140021202R16881     ADD WS-INV-TRI-INCEPT-PH    TO  WS-ACC-TRI-INCEPT-PH.
140150021202   ¦       ADD WS-INV-TRI-YTD-PH       TO  WS-ACC-TRI-YTD-PH.
140160990619   ¦       ADD WS-INV-TRI-CUR-PH       TO  WS-ACC-TRI-CUR-PH.
140170990619   ¦       ADD WS-INV-TRI-INCEPT-PH-EX TO  WS-ACC-TRI-INCEPT-PH-EX.
140180990619   ¦       ADD WS-INV-TRI-YTD-PH-EX    TO  WS-ACC-TRI-YTD-PH-EX.
140190990619   ¦       ADD WS-INV-TRI-CUR-PH-EX    TO  WS-ACC-TRI-CUR-PH-EX.
140200990619   ¦       ADD WS-INV-TRO-INCEPT-PH    TO  WS-ACC-TRO-INCEPT-PH.
140210990619   ¦       ADD WS-INV-TRO-YTD-PH       TO  WS-ACC-TRO-YTD-PH.
140220001006   ¦       ADD WS-INV-TRO-CUR-PH       TO  WS-ACC-TRO-CUR-PH.
140230990619   ¦       ADD WS-INV-TRO-INCEPT-PH-EX TO  WS-ACC-TRO-INCEPT-PH-EX.
140240001006   v       ADD WS-INV-TRO-YTD-PH-EX    TO  WS-ACC-TRO-YTD-PH-EX.
140250020923R16881     ADD WS-INV-TRO-CUR-PH-EX    TO  WS-ACC-TRO-CUR-PH-EX.
140260020923
140270030317R15022     ADD WS-INV-DISP-GAIN-LOSS-CUR TO WS-ACC-DISP-GAIN-LOSS-CUR
140280030317R15022     ADD WS-INV-DISP-GAIN-LOSS-YTD TO WS-ACC-DISP-GAIN-LOSS-YTD
140290021202R15022     ADD WS-INV-DISP-GAIN-LOSS-INC TO
140300021202R15022     WS-ACC-DISP-GAIN-LOSS-INC
140310021202
140320021202           ADD WS-INV-CPG-INCEPT-EX    TO  WS-ACC-CPG-INCEPT-EX.
140330021202           ADD WS-INV-INC-INCEPT-EX    TO  WS-ACC-INC-INCEPT-EX.
140340021202           ADD WS-INV-INT-INCEPT-EX    TO  WS-ACC-INT-INCEPT-EX.
140350021202           ADD WS-INV-PUR-INCEPT-EX    TO  WS-ACC-PUR-INCEPT-EX.
140360021202           ADD WS-INV-RED-INCEPT-EX    TO  WS-ACC-RED-INCEPT-EX.
140370010309           ADD WS-INV-TRI-INCEPT-EX    TO  WS-ACC-TRI-INCEPT-EX.
140380010309RF7777     ADD WS-INV-SWI-INCEPT-EX    TO  WS-ACC-SWI-INCEPT-EX.
140390010309           ADD WS-INV-TRO-INCEPT-EX    TO  WS-ACC-TRO-INCEPT-EX.
140400010309RF7777     ADD WS-INV-SWO-INCEPT-EX    TO  WS-ACC-SWO-INCEPT-EX.
140410990619R14556     ADD WS-INV-TRI-INCEPT-COST-EX TO WS-ACC-TRI-INCEPT-COST-EX.
140420981222R14556     ADD WS-INV-TRO-INCEPT-COST-EX TO WS-ACC-TRO-INCEPT-COST-EX.
140430981222R16256     ADD WS-INV-TRI-INCEPT-MKT-EX  TO WS-ACC-TRI-INCEPT-MKT-EX.
140440981222R16256     ADD WS-INV-TRO-INCEPT-MKT-EX  TO WS-ACC-TRO-INCEPT-MKT-EX.
140450981222
140460981222R15022     ADD WS-INV-DISP-GAIN-LOSS-CUR-EX
140470990619R15022                TO WS-ACC-DISP-GAIN-LOSS-CUR-EX
140480990619R15022     ADD WS-INV-DISP-GAIN-LOSS-YTD-EX
140490990619R15022                TO WS-ACC-DISP-GAIN-LOSS-YTD-EX
140500990619R15022     ADD WS-INV-DISP-GAIN-LOSS-INC-EX
140510990619R15022                TO WS-ACC-DISP-GAIN-LOSS-INC-EX
140520990619
140530990619RF8633     ADD WS-INV-TRI-YTD-EX       TO  WS-ACC-TRI-YTD-EX.
140540981222RF8633     ADD WS-INV-SWI-YTD-EX       TO  WS-ACC-SWI-YTD-EX.
140550990619RF8633     ADD WS-INV-TRO-YTD-EX       TO  WS-ACC-TRO-YTD-EX.
140560990517RF8633     ADD WS-INV-SWO-YTD-EX       TO  WS-ACC-SWO-YTD-EX.
140570990517
140580990517           ADD WS-INV-CPG-YTD          TO  WS-ACC-CPG-YTD.
140590990517           ADD WS-INV-INC-YTD          TO  WS-ACC-INC-YTD.
140600020417           ADD WS-INV-INT-YTD          TO  WS-ACC-INT-YTD.
140610020417           ADD WS-INV-PUR-YTD          TO  WS-ACC-PUR-YTD.
140620020417           ADD WS-INV-RED-YTD          TO  WS-ACC-RED-YTD.
140630020417
140640020417           ADD WS-INV-CPG-YTD-EX       TO  WS-ACC-CPG-YTD-EX.
140650011203           ADD WS-INV-INC-YTD-EX       TO  WS-ACC-INC-YTD-EX.
140660011203           ADD WS-INV-INT-YTD-EX       TO  WS-ACC-INT-YTD-EX.
140670011203           ADD WS-INV-PUR-YTD-EX       TO  WS-ACC-PUR-YTD-EX.
140680011203           ADD WS-INV-RED-YTD-EX       TO  WS-ACC-RED-YTD-EX.
140690050330
140700050330           ADD WS-INV-WHTAX-YTD        TO  WS-ACC-WHTAX-YTD.
140710050330           ADD WS-INV-NRTAX-YTD        TO  WS-ACC-NRTAX-YTD.
140720050330      *****
140730050330      *****    Find the market value of last year end.
140740050330      *****
140750050330
140760050330r13017     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
140770050330           AND WS-LDA-STMT-CNFM-FLAG IS EQUAL TO  "S"
140780011203               PERFORM GET-CURRENCY-EXCHANGE-RATE     THRU GCER-EXIT
140790011203R13017     END-IF.
140800011203
140810011203           MULTIPLY WS-UNIT-PRICE-LAST-YEND
140820011203                       BY WS-TEMP-CLOSING-UNIT-BAL
140830011203                       GIVING WS-INV-MKT-VALUE-LAST-YE ROUNDED.
140840990517
140850990517      * RFS26213 Start
140860080922           IF WS-LDA-PRIQT                   IS EQUAL TO "Y"
140870980624             MOVE WS-TEMP-CLOSING-UNIT-BAL
140880980624               TO AD-UNIT-BALANCE-PRIOR-YE
140890980624             MOVE WS-UNIT-PRICE-LAST-YEND
140900980624               TO AD-UNIT-PRICE-PRIOR-YE
140910980624           END-IF.
140920980624      * RFS26213 End
140930980624
140940980624R10701     IF WS-CC-RTELYE (CC) IS NOT EQUAL TO  ZEROES
140950980624              DIVIDE  WS-INV-MKT-VALUE-LAST-YE BY
140960980627                                          WS-CC-RTELYE (CC)
140970980627                      GIVING WS-INV-MKT-VALUE-LAST-YE ROUNDED
140980161110R10701     END-IF.
140990161110
141000171014           ADD WS-INV-MKT-VALUE-LAST-YE
141010171017                           TO WS-ACC-MKT-VALUE-LAST-YE.
141020161110
141030171015      *****
141040161110      *****    Compute the original cost for the fund and accumulate to
141050171017      *****    the account level.  This is done prior to determining if
141060171017      *****    the fund is to be processed due to the original cost is
141070171017      *****    based on all transactions since inception.
141080161110      *****
141090161110
141100161110           ADD WS-IN-AMT               TO  WS-ORIGIN-COST-A.
141110161110           SUBTRACT WS-OUT-AMT       FROM  WS-ORIGIN-COST-A.
141120161110           IF  WS-INVAUC-SW   IS EQUAL TO  "Y"
141130161110               MOVE "Y"                TO  WS-INVAUCACC-SW.
141140161110      ** RFS156507 - Start **
141150161110           IF WS-WRITE-INVESTMENT-LEVEL IS EQUAL "N"
141160161110           AND WS-WRITE-INVEST-SEC79    IS EQUAL "N"
141170180201172229     AND WS-WRITE-INVEST-CWT      IS EQUAL "N"
141180161110             GO TO LS1-EXIT
141190161110           END-IF.
141200161110           IF WS-WRITE-INVESTMENT-LEVEL IS EQUAL "N"
141210161110172229*    AND WS-WRITE-INVEST-SEC79    IS EQUAL "Y"
141220180201172229     AND (WS-WRITE-INVEST-SEC79 IS EQUAL "Y" OR
141230161110172229         WS-WRITE-INVEST-CWT   IS EQUAL "Y")
141240161101             GO TO LS1-0000-0040
141250000000           END-IF.
141260000000      *** Not to impact BCL Transaction due to Section-79 processing
141270000000      *** after Last Section-80 Transaction
141280970516             MOVE WS-TEMP-AT-UNIT-BALANCE       TO AT-UNIT-BALANCE
141290970516             MOVE WS-TEMP-AT-NO-OF-UNITS        TO AT-NO-OF-UNITS
141300970516             MOVE WS-TEMP-AT-NO-OF-UNITS-SIGN   TO AT-NO-OF-UNITS-SIGN
141310970516             MOVE WS-TEMP-AT-NON-TAX-DEDUCTIONS TO AT-NON-TAX-DEDUCTIONS
141320970516             MOVE WS-TEMP-AT-ACB-UNITS-TRANS TO AT-ACB-UNITS-TRANSACTED
141330970516177079       MOVE WS-TEMP-AT-UNIT-PRICE      TO AT-UNIT-PRICE
141340970530             INITIALIZE  WS-TEMP-AT-UNIT-BALANCE WS-TEMP-AT-NO-OF-UNITS
141350971024                         WS-TEMP-AT-NO-OF-UNITS-SIGN
141360971024                         WS-TEMP-AT-NON-TAX-DEDUCTIONS
141370970530                         WS-TEMP-AT-ACB-UNITS-TRANS
141380970516177079                   WS-TEMP-AT-UNIT-PRICE
141390971024      ** RFS156507 - End   **
141400971024
141410970530           IF WS-WRITE-INVESTMENT-LEVEL IS EQUAL "N"
141420970530             GO TO LS1-EXIT
141430970530           END-IF.
141440991126
141450970516      *****
141460970530      *****    If a balance closing transaction is requested, simply use
141470010607      *****    the last created transaction and update the required
141480010607      *****    fields.
141490010607      *****
141500010607
141510010607           IF  WS-LDA-CLS-TXN-BAL
141520010607                              IS EQUAL TO  "A"
141530010607               GO TO LS1-0000-0000-0010.
141540010607
141550010607           IF  WS-LDA-CLS-TXN-BAL
141560031216                              IS EQUAL TO  "Y"
141570031216           AND WS-TXNS-IN-RANGE  EQUAL TO  "Y"
141580970516               GO TO LS1-0000-0000-0010.
141590161026
141600080612           GO TO LS1-0000-0040.
141610080612
141620080612       LS1-0000-0000-0010.
141630080612
141640080612R10404     IF PREV-PT-RULE           IS  EQUAL TO  "7"
141650080612              ADD 1                    TO  WS-TRANSACTION-COUNT-DII
141660080612              MOVE WS-TRANSACTION-COUNT-DII TO  AT-SECTION-SEQUENCE
141670080612           ELSE
141680080612              ADD 1                         TO  WS-TRANSACTION-COUNT
141690080612              MOVE WS-TRANSACTION-COUNT     TO  AT-SECTION-SEQUENCE
141700080612           END-IF.
141710080612
141720120328           MOVE WS-LDA-ENDDTE-SV       TO  AT-TRADE-DATE.
141730120328           MOVE WS-LDA-ENDDTE-SV       TO  AT-PROCESS-DATE.
141740120328           MOVE "BCL"                  TO  AT-TRANS-TYPE-CODE.
141750181023156507     MOVE 80                     TO  AT-SECTION-NO.
141760181023176735     MOVE ZERO                   TO  AT-INTEREST-AMT.
141770180628176735     MOVE ZERO                   TO  AT-NET-PROCEEDS.
141780180628      *RFS1002966 - Starts
141790180628           IF lc-LdaSelectDate      = "T"   AND
141800180628              WS-LDA-STMT-CNFM-FLAG = "S"   AND
141810180628              AT-TRANS-TYPE-CODE    = "BCL"
141820180628              MOVE WS-LDA-ENDDTE TO WS-ENDDTE-TXN-T
141830180628              EXEC SQL
141840180628                 SELECT CLOSING_UNIT_BAL
141850180628                   INTO  :WS-CLOBAL-TXN-T
141860180628                   FROM  MFATRNP
141870180628                  WHERE  Account_No      = :PREV-ACCOUNT
141880180628                    AND  Investment_Code = :PREV-INVESTMENT
141890180628                    AND  Trade_date     <= :WS-ENDDTE-TXN-T
141900190830                    AND  Trans_Status_Code IN ("HST", "RVS", "HSC")
141910190830101647*           ORDER BY Trade_Date DESC, Process_date  DESC,
141920180628101647            ORDER BY Process_date  DESC, Trade_Date DESC,
141930180628                           Trans_Proc_Seq_No DESC
141940180628                  FETCH FIRST ROW ONLY
141950180628              END-EXEC
141960180628              MOVE WS-CLOBAL-TXN-T   TO  AT-UNIT-BALANCE
141970180628           END-IF
141980120328      *RFS1002966 - Ends
14199012032847406      MOVE SPACE                  TO  AT-DEPOSIT-INDICATOR.
14200012032847406      MOVE ZERO                   TO  AT-GLWB-DEPOSIT-ALLOCATION
14201012032847406      MOVE ZERO                   TO  AT-GLWA-DEPOSIT
14202012032847406      MOVE SPACE                  TO  AT-FIRST-WTHDRWL-AFT-ELIG-AGE
14203012032847406      MOVE ZERO                   TO  AT-GLWA-WITHDRAWN
14204012032847406      MOVE ZERO                   TO  AT-EXCESS-GLWA-WITHDRAWN
14205097051647406      MOVE ZERO                   TO  AT-GW-BASE-BEFORE-TRADE
14206097051647406      MOVE ZERO                   TO  AT-GW-BASE-AFTER-TRADE
14207097051647406      MOVE SPACE                  TO  AT-GW-BASE-CAL-METHOD
14208097051647406      MOVE ZERO                   TO  AT-FIE-BASE-BEFORE-TRADE
14209097051647406      MOVE ZERO                   TO  AT-FIE-BASE-AFTER-TRADE
14210097051647406      MOVE SPACE                  TO  AT-FIE-BASE-CAL-METHOD
142110970516      *RFS93662 Start
142120970516           IF lb_OMSEXTYes
142130020717              MOVE "N"                  TO AT-OMS-REVERSE
142140970516              MOVE "DIR"                TO AT-OMS-TRANS-ORIGIN-CODE
142150970516              MOVE AT-TRANS-TYPE-CODE   TO AT-OMS-TRANS-TYPE-CODE
142160970516              MOVE SPACES               TO AT-OMS-TRANS-SUB-TYPE
142170970516                                           AT-OMS-CONTR-REDEEM
142180970516           End-If
142190970516      *RFS93662 End
142200970516
142210020717           IF  WS-TT-LST NOT GREATER THAN  ZEROES
142220020717               GO TO LS1-0000-0020.
142230020717
142240020717           SET TT                      TO  1.
142250020717
142260020717       LS1-0000-0010.
142270020717           IF  WS-TT-CODE (TT)   EQUAL TO  "BCL"
142280020717           AND WS-TT-STAT (TT)   EQUAL TO  "HST"
142290020717R12865     AND WS-TT-ORIGIN-CODE (TT)  EQUAL TO  AT-TRANS-ORIGIN-CODE
142300020717           AND WS-TT-LANG (TT)   EQUAL TO  AT-LANGUAGE
142310020717               MOVE WS-TT-DESC (TT)    TO  AT-TRANS-TYPE
142320020717               GO TO LS1-0000-0030.
142330020717
142340020717           IF  TT            IS LESS THAN  WS-TT-LST
142350020717               SET TT               UP BY  1
142360970516               GO TO LS1-0000-0010.
142370991005
142380970516R12865     SET TT                      TO  1.
142390970516  ¦
142400970516  ¦    LS1-0000-0010-A.
142410991005  ¦        IF  WS-TT-CODE (TT)   EQUAL TO  "BCL"
142420970528  ¦        AND WS-TT-STAT (TT)   EQUAL TO  "HST"
142430970528  ¦        AND WS-TT-ORIGIN-CODE (TT)  EQUAL TO  WS-ORIGIN-CODE
142440001012  ¦        AND WS-TT-LANG (TT)   EQUAL TO  AT-LANGUAGE
142450001012  ¦            MOVE WS-TT-DESC (TT)    TO  AT-TRANS-TYPE
142460970528  ¦            GO TO LS1-0000-0030.
142470970528  ¦
142480000911  ¦        IF  TT            IS LESS THAN  WS-TT-LST
142490000911  ¦            SET TT               UP BY  1
142500970528R12865         GO TO LS1-0000-0010-A.
142510970528
142520970528       LS1-0000-0020.
142530970528
142540151014           MOVE ALL "*"                TO  AT-TRANS-TYPE.
142550151014
142560151014       LS1-0000-0030.
142570151014
142580151014           MOVE ZEROES                 TO  AT-GROSS.
142590151014           MOVE SPACES                 TO  AT-GROSS-SIGN.
142600151014RF4638     MOVE ZEROES                 TO  AT-DSC.
142610151014RF4638     MOVE SPACES                 TO  AT-DSC-SIGN.
142620151014           MOVE ZEROES                 TO  AT-TAX.
142630151014           MOVE SPACES                 TO  AT-TAX-SIGN.
142640970702RF6697     MOVE ZEROES                 TO  AT-GST.
142650011120           MOVE ZEROES                 TO  AT-PST.
142660180314           MOVE ZEROES                 TO  AT-COMMISSION.
142670991029           MOVE SPACES                 TO  AT-COMMISSION-SIGN.
142680991029           MOVE ZEROES                 TO  AT-NET.
142690131021           MOVE SPACES                 TO  AT-NET-SIGN.
142700180314      * RFS147156 - Start
142710971125           IF WS-LDA-REQUEST-SCOPE IS EQUAL TO "A"          AND
142720971125              (TRANS-TYPE-CODE OF TRANS  IS EQUAL TO "BCL"  OR
142730970528               AT-TRANS-TYPE-CODE IS EQUAL TO "BCL")
142740980519              MOVE WS-IUP-CLOSING-PRICE TO AT-UNIT-PRICE
142750980519           ELSE
142760980519              MOVE WS-IC-LSTPRC (IC)    TO  AT-UNIT-PRICE
142770980519      *    MOVE WS-IC-LSTPRC (IC)      TO  AT-UNIT-PRICE.
142780980519           END-IF.
142790970530      * RFS147156 - Ends
142800970530           MOVE SPACES                 TO  AT-UNIT-PRICE-SIGN.
142810970530R12105     MOVE SPACES                 TO  AT-REP-NAME.
142820190919163004*991029     IF  WS-TEMP-TRANS-PRICE  IS  NOT EQUAL TO AT-UNIT-PRICE
142830190919      *RFS1015600-Starts
142840190919      *        MULTIPLY AT-UNIT-BALANCE    BY  AT-UNIT-PRICE
142850190919      *                            GIVING  AT-MKT-VALUE ROUNDED
142860190919125153*        MOVE AT-MKT-VALUE           to ln_GrossAmount
142870980720      *RFS1015600-Ends
142880190919163004*    END-IF
142890190919      *RFS1015600-Starts
142900190919           IF  WS-SUM-CNT = 1                        AND
142910190919               WS-SUM-CNT-STR = 0                    AND
142920190919               AT-UNIT-PRICE   = UNIT-PRICE OF TRANS AND
142930200831               AT-UNIT-BALANCE = UNIT-AMT OF TRANS
142940200831      *RFS1102978-Starts
142950200831               AND
142960200831             ((lc-LdaSelectDate = "T" AND
142970200831               TRADE-DATE OF TRANS >= WS-STR-DTE-STMT AND
142980200831               TRADE-DATE OF TRANS <= WS-END-DTE-STMT) OR
142990200831              (lc-LdaSelectDate NOT = "T"             AND
143000200831                PROCESS-DATE OF TRANS >= WS-STR-DTE-STMT AND
143010200831                PROCESS-DATE OF TRANS <= WS-END-DTE-STMT))
143020190919      *RFS1102978-Ends
143030190919               MOVE GROSS-AMT OF TRANS TO ln_GrossAmount
143040190919           ELSE
143050190919             IF WS-SUM-CNT = 1                       AND
143060191128                WS-SUM-CNT-STR = 1
143070191128      *RFS1020558-Starts
143080191128                AND AT-UNIT-PRICE   = UNIT-PRICE OF TRANS
143090191128                AND AT-UNIT-BALANCE = UNIT-AMT OF TRANS
143100190919      *RFS1020558-Ends
143110190919                MOVE WS-GRS-AMT-SUM    TO ln_GrossAmount
143120190919             ELSE
143130190919               MULTIPLY AT-UNIT-BALANCE    BY  AT-UNIT-PRICE
143140190919                                   GIVING  AT-MKT-VALUE ROUNDED
143150190919               MOVE AT-MKT-VALUE           to ln_GrossAmount
143160190919             END-IF
143170190919           END-IF
143180970528      *RFS1015600-Ends
143190970528           MOVE AT-UNIT-BALANCE        TO  AT-NO-OF-UNITS.
143200970528           MOVE AT-UNIT-BALANCE-SIGN   TO  AT-NO-OF-UNITS-SIGN.
143210970528           MOVE ZEROES                 TO  AT-CPTL-GAIN.
143220970528           MOVE SPACES                 TO  AT-CPTL-GAIN-SIGN.
143230970705980514     MOVE ZEROES                 TO  AT-CPTL-GAIN-BASE.
143240970705980514     MOVE SPACES                 TO  AT-CPTL-GAIN-BASE-SIGN.
143250971215980514     MOVE ZEROES                 TO  AT-SALES-CHARGE.
143260971215980514     MOVE SPACES                 TO  AT-SALES-CHARGE-SIGN.
143270971215           DIVIDE AT-UNIT-PRICE        BY  WS-CC-RTECLS (CC)
143280060829                                   GIVING  AT-UNIT-PRICE-BASE ROUNDED.
143290060829           DIVIDE AT-MKT-VALUE         BY  WS-CC-RTECLS (CC)
143300991008                                   GIVING  AT-MKT-VALUE-BASE ROUNDED.
143310101217           MOVE WS-CC-RTECLS (CC)      TO  AT-EXCHANGE-RATE.
143320101217           MOVE SPACES                 TO  AT-ADJUSTMENT-REASON.
143330150417           MOVE SPACES                 TO  AT-CONTR-REDEMP-CODE.
143340991008           MOVE SPACES                 TO  AT-CONTR-REDEMP-DESCRIPTION.
143350990618           MOVE SPACES                 TO  AT-PAYMENT-TYPE-CODE.
143360990618           MOVE ZEROES                 TO  AT-OTHER-ACCOUNT.
143370991005           MOVE SPACES                 TO  AT-OTHER-FUND-NO.
143380991005           MOVE SPACES                 TO  AT-OTHER-INVESTMENT-NAME.
143390991202           MOVE ZEROES                 TO  AT-GROSS-NET-DIFF.
143400000725           MOVE SPACES                 TO  AT-GROSS-NET-DIFF-SIGN.
143410000725           MOVE "HST"                  TO  AT-TRANS-STATUS-CODE.
143420000623           MOVE "N"                    TO  AT-REVERSAL-INDICATOR.
143430991229           MOVE SPACES                 TO  AT-TRANS-ORIGIN-CODE.
14344000062334072      MOVE ZEROES                 TO  AT-REDEM-CHARGE.
14345000062334072      MOVE SPACES                 TO  AT-REDEM-CHARGE-SIGN.
143460000623           MOVE AT-SECTION-SEQUENCE    TO  AT-SECTION-SEQUENCE-2.
143470061003R86495     MOVE 0                      TO AT-PLACEMENT-DATE.
143480061003R86495     MOVE 0                      TO AT-TRANS-NO.
143490000623142884     PERFORM PREPARE-SECTION80-NEW-FIELD-O.
143500991229
143510991229           IF WS-LDA-REQUEST-SCOPE IS EQUAL TO "A"
143520061003              MOVE "Y"                 TO  AT-ASSIGNMENT-INDICATOR
143530061003              MOVE WS-CERT-UNITS       TO  AT-ASSIGNED-UNITS
143540991229           END-IF
143550991202
143560160212      *** The following POPULATE-DISTRIBUTION-ROC was commented
143570160324      *** on 2000/07/25/ when working on RF7172.It is a bug.
143580160328
143590160324           MOVE WS-INV-DISTRIBUTION-ROC      TO AT-DISTRIBUTION-ROC.
143600160225RF7172     MOVE WS-INV-TAXABLE-AMOUNT        TO AT-TAXABLE-AMOUNT.
143610160225           IF WS-INV-TAXABLE-AMOUNT       IS LESS THAN ZEROS
143620160225              MOVE "-"                    TO AT-TAXABLE-AMOUNT-SIGN
143630160324R35540     ELSE
143640060621R35540        MOVE " "                    TO AT-TAXABLE-AMOUNT-SIGN
143650030825           END-IF.
143660970516           IF WS-INV-DISTRIBUTION-ROC     IS LESS THAN ZEROS
143670980731              MOVE "-"                    TO AT-DISTRIBUTION-ROC-SIGN
143680980731R35540     ELSE
143690980731R35540        MOVE " "                    TO AT-DISTRIBUTION-ROC-SIGN
143700980731           END-IF.
143710980731       LS1-0000-0030-0010.
143720980731148326     PERFORM PREPARE-SECTION80-NEW-FIELD-A THRU PSNFA-EXIT.
143730980731148326     IF TRANSFER-IN-OUT-ONLY AND
143740980731148326          WS-CC-BASE (CC) IS NOT EQUAL TO  "Y"
143750971030148326          PERFORM COMPUTE-SPOT-EXCHANGE-RATE   THRU CSER-EXIT
143760990531148326          IF WS-SPOT-EXCHANGE-RATE IS NOT EQUAL TO ZEROES
143770990531148326             MOVE WS-SPOT-EXCHANGE-RATE TO AT-EXCHANGE-RATE
143780001006148326          END-IF
143790001110148326     END-IF.
143800001110R18147     MOVE ACCOUNT-TXN-SECTION TO STATEMENT-REC(ISR).
143810971030R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
143820971030       LS1-0000-0040.
143830971030      *****
143840000000      *****    If the investment contained only contribution and
143850020731      *****    transfer in transactions exist for the investment and the
143860020731      *****    accumulate (instead of calculate) Book Value option was
143870061003      *****    requested, override the calculated Book Value with the
143880061003      *****    actual purchases.
143890190117      *****
143900190123      *1005872-Starts
143910190118      *Do not override BV base when CLCBV and STMLTD edit exists
143920190117           IF Lc_CLCBV = "Y" AND Lc_STMLTD = "Y"
143930190123              MOVE "N" TO WS-BKVAL-SW
143940190117           END-IF.
143950190117      *1005872-Ends
143960020731
143970000000           IF  WS-BKVAL-SW   NOT EQUAL TO  "Y"
143980020730               GO TO LS1-0000-0050.
143990020730           IF  WS-CC-RTECLS (CC) IS EQUAL TO 1
144000061003               ADD WS-INV-PUR-INCEPT
144010061003RF7777             WS-INV-SWI-INCEPT
144020020730                   WS-INV-TRI-INCEPT   GIVING  WS-BOOK-TOTAL-INV
144030001113           END-IF.
144040020731           IF  WS-IC-FRGN (IC)   EQUAL TO  "Y"
144050001006               MOVE WS-BOOK-TOTAL-INV  TO  WS-BOOK-FGN-INV.
144060020731       LS1-0000-0050.
144070020731           MOVE AT-UNIT-BALANCE  TO AD-NO-OF-UNITS.
144080061003R13637     IF   AD-NO-OF-UNITS-EX     IS LESS THAN 0
144090061003  ¦             MOVE "-" TO AD-NO-OF-UNITS-SIGN
144100020731R35540     ELSE
144110020731R35540          MOVE " " TO AD-NO-OF-UNITS-SIGN
144120031003R13637     END-IF.
144130031003           MOVE WS-LAST-ACB-PRICE TO AD-ACB-UNIT-PRICE.
144140031003R13637     IF   WS-LAST-ACB-PRICE     IS LESS THAN 0
144150061003  ¦             MOVE "-" TO AD-ACB-UNIT-PRICE-SIGN
144160061003R35540     ELSE
144170031003R35540          MOVE " " TO AD-ACB-UNIT-PRICE-SIGN
144180031003R13637     END-IF.
144190031003RF8359     MOVE WS-BOOK-TOTAL-INV      TO  AD-BOOK-VALUE.
144200031003
144210031003RF7776     MOVE WS-BOOK-TOTAL-INV      TO  AD-BOOK-VALUE-BASE.
144220061003R13637     IF   WS-BOOK-TOTAL-INV      IS LESS THAN 0
144230061003  ¦             MOVE "-" TO AD-BOOK-VALUE-SIGN
144240031003R35540     ELSE
144250001113R35540          MOVE " " TO AD-BOOK-VALUE-SIGN
144260040511R13637     END-IF.
144270001212
144280001212R17527     MOVE WS-NO-OF-UNITS-CURR   TO AD-NO-OF-UNITS-CURR.
144290001212  ¦        IF WS-NO-OF-UNITS-CURR     IS LESS THAN 0
144300001212  ¦           MOVE "-" TO AD-NO-OF-UNITS-CURR-SIGN
144310001212R35540     ELSE
144320001212R35540        MOVE " " TO AD-NO-OF-UNITS-CURR-SIGN
144330001212  ¦        END-IF.
144340001212  ¦
144350001212  ¦        MOVE WS-NET-AMOUNT-CURR    TO AD-NET-AMOUNT-CURR.
144360001212  ¦        IF WS-NET-AMOUNT-CURR      IS LESS THAN 0
144370000121  v           MOVE "-" TO AD-NET-AMOUNT-CURR-SIGN
144380161215R35540     ELSE
144390161215R35540        MOVE " " TO AD-NET-AMOUNT-CURR-SIGN
144400161215R17527     END-IF.
144410161215
144420161215R18194     IF WS-CC-BASE (CC) IS NOT EQUAL TO  "Y"
144430161215001208        IF WS-BKVAL-SW   NOT EQUAL TO  "Y"
144440161215                 COMPUTE  WS-BOOK-VALUE-US ROUNDED  =  AD-NO-OF-UNITS
144450161215                                                   *  AD-ACB-UNIT-PRICE
144460161215                 MOVE WS-BOOK-VALUE-US    TO  AD-BOOK-VALUE
144470000121              ELSE
144480000121               ADD WS-INV-PUR-INCEPT
144490000121                   WS-INV-SWI-INCEPT
144500131021                   WS-INV-TRI-INCEPT   GIVING  AD-BOOK-VALUE
144510131021              END-IF
144520000119           END-IF.
144530000121RF6234     IF WS-LDA-REQUEST-SCOPE     IS NOT EQUAL TO "A"
144540000121      *RFS165077 START
144550000121159642*       IF TRANS-TYPE-CODE OF TRANS IS EQUAL TO "INC" OR "CPG"
144560161215  |   *                                                  OR "INT"
144570161215  |   *       AND TRANS-STATUS-CODE OF TRANS-REC  IS EQUAL TO  "RVS"
144580000121  |   *       AND CLOSING-UNIT-BAL OF TRANS-REC  IS ZERO
144590161215  |   *       AND UNIT-AMT OF TRANS-REC IS EQUAL TO ZERO
144600161215  |   *           MOVE ZERO TO AT-MKT-VALUE
144610161215159642*       ELSE
144620190919      *RFS165077 END
144630190919      *RFS1015600-Starts
144640190919      *       IF  AT-NO-OF-UNITS    IS EQUAL      TO  AT-UNIT-BALANCE
144650190919      *       AND UNIT-PRICE OF INVESTMENT-UNIT-PRICE
144660161215      *                             IS  EQUAL     TO AT-UNIT-PRICE
144670190919125153****       MOVE AT-MKT-VALUE                TO  AD-MARKET-VALUE
144680190919125153*          MOVE ln_GrossAmount              TO  AD-MARKET-VALUE
144690190919      *       ELSE
144700190919      *          COMPUTE AD-MARKET-VALUE ROUNDED = AD-NO-OF-UNITS *
144710190919      *                         UNIT-PRICE OF INVESTMENT-UNIT-PRICE
144720190919      *       END-IF
144730190919
144740190919      *transaction within statement range
144750190919              IF  WS-SUM-CNT = 1                        AND
144760190919                  WS-SUM-CNT-STR = 0                    AND
144770190919                  AT-NO-OF-UNITS  IS EQUAL  TO  AT-UNIT-BALANCE AND
144780191128                  UNIT-PRICE OF INVESTMENT-UNIT-PRICE
144790191128      *RFS1020558-Starts
144800191128      *                             IS  EQUAL     TO AT-UNIT-PRICE
144810191128                                    IS  EQUAL     TO WS-UNIT-PRICE
144820190919      *RFS1020558-Ends
144830190919                  MOVE ln_GrossAmount             TO AD-MARKET-VALUE
144840190919      *transaction prior to statement range
144850190919              ELSE
144860190919                IF WS-SUM-CNT = 1                       AND
144870191128                   WS-SUM-CNT-STR = 1
144880191128      *RFS1020558-Starts
144890191128                   AND AT-NO-OF-UNITS
144900191128                                    IS EQUAL  TO  AT-UNIT-BALANCE
144910191128                   AND UNIT-PRICE OF INVESTMENT-UNIT-PRICE
144920191128                                    IS  EQUAL     TO WS-UNIT-PRICE
144930190919      *RFS1020558-Ends
144940190919                   MOVE WS-GRS-AMT-SUM            TO AD-MARKET-VALUE
144950190919                ELSE
144960190919                  IF  AT-NO-OF-UNITS    IS EQUAL  TO  AT-UNIT-BALANCE
144970190919                  AND UNIT-PRICE OF INVESTMENT-UNIT-PRICE
144980190919                                    IS  EQUAL     TO AT-UNIT-PRICE
144990190919                    MOVE ln_GrossAmount           TO  AD-MARKET-VALUE
145000190919                  ELSE
145010190919                    COMPUTE AD-MARKET-VALUE ROUNDED = AD-NO-OF-UNITS *
145020190919                                UNIT-PRICE OF INVESTMENT-UNIT-PRICE
145030190919                  END-IF
145040190919                END-IF
145050190919              END-IF
145060000121      *RFS1015600-Ends
145070000121      *RFS165077 START
145080000121159642*    END-IF
145090000121           ELSE
145100161215159642*       IF TRANS-TYPE-CODE OF TRANS IS EQUAL TO "INC" OR "CPG"
145110161215  |   *                                                  OR "INT"
145120161215  |   *       AND TRANS-STATUS-CODE OF TRANS-REC  IS EQUAL TO  "RVS"
145130000121  |   *       AND CLOSING-UNIT-BAL OF TRANS-REC  IS ZERO
145140000121  |   *       AND UNIT-AMT OF TRANS-REC IS EQUAL TO ZERO
145150970530  |   *           MOVE ZERO TO AT-MKT-VALUE
145160970423159642*       ELSE
145170190919      *RFS165077 END
145180190919      *RFS1015600-Starts
145190190919      *       IF  AT-NO-OF-UNITS        IS  EQUAL TO  AT-UNIT-BALANCE
145200040723      *       AND WS-IUP-CLOSING-PRICE  IS  EQUAL TO  AT-UNIT-PRICE
145210190919125153*****      MOVE AT-MKT-VALUE                TO  AD-MARKET-VALUE
145220190919125153*          MOVE ln_GrossAmount              TO  AD-MARKET-VALUE
145230190919      *       ELSE
145240190919      *          COMPUTE AD-MARKET-VALUE ROUNDED = AD-NO-OF-UNITS
145250190919      *                                          * WS-IUP-CLOSING-PRICE
145260190919      *        END-IF
145270190919
145280190919      *RFS1015600-Starts
145290190919      *transaction within statement range
145300190919              IF  WS-SUM-CNT = 1                        AND
145310190919                  WS-SUM-CNT-STR = 0                    AND
145320191128                  AT-NO-OF-UNITS  IS EQUAL  TO  AT-UNIT-BALANCE AND
145330191128      *RFS1020558-Starts
145340191128      *           WS-IUP-CLOSING-PRICE  IS  EQUAL TO AT-UNIT-PRICE
145350191128                  WS-IUP-CLOSING-PRICE  IS  EQUAL TO WS-UNIT-PRICE
145360190919      *RFS1020558-Ends
145370190919                  MOVE ln_GrossAmount             TO AD-MARKET-VALUE
145380190919      *transaction prior to statement range
145390190919              ELSE
145400190919                IF WS-SUM-CNT = 1                       AND
145410191128                   WS-SUM-CNT-STR = 1
145420191128      *RFS1020558-Starts
145430191128                   AND AT-NO-OF-UNITS
145440191128                                        IS  EQUAL TO  AT-UNIT-BALANCE
145450191128                   AND WS-IUP-CLOSING-PRICE
145460191128                                        IS  EQUAL TO  WS-UNIT-PRICE
145470190919      *RFS1020558-Ends
145480190919                   MOVE WS-GRS-AMT-SUM            TO AD-MARKET-VALUE
145490190919                ELSE
145500190919                  IF  AT-NO-OF-UNITS       IS  EQUAL TO  AT-UNIT-BALANCE
145510190919                  AND WS-IUP-CLOSING-PRICE IS  EQUAL TO  AT-UNIT-PRICE
145520190919                    MOVE ln_GrossAmount              TO  AD-MARKET-VALUE
145530190919                  ELSE
145540190919                    COMPUTE AD-MARKET-VALUE ROUNDED = AD-NO-OF-UNITS
145550190919                                                 * WS-IUP-CLOSING-PRICE
145560190919                  END-IF
145570190919                END-IF
145580190919              END-IF
145590040723      *RFS1015600-Ends
145600040723      *RFS165077 START
145610040723159642*       END-IF
145620040723      *RFS165077 END
145630040723           END-IF
145640980624
145650990813           IF  WS-CC-RTECLS (CC) EQUAL TO  ZEROES
145660990813               MOVE AD-MARKET-VALUE    TO  AD-MARKET-VALUE-BASE
145670020730             ELSE
145680020730R21815         IF WS-CC-CODE (CC)       = WS-CURRENCY-USD           AND
145690061003  ¦               WS-LDA-REQUEST-SCOPE  = "B"                       AND
145700061003  ¦               WS-LDA-STMT-CNFM-FLAG = "S"                       AND
145710020730  ¦               ACCOUNT-NO OF STMT-PRINT-REQ-REC NOT = AD-ACCOUNT AND
145720020730  ¦               CURR-CONTROLS     NOT = HIGH-VALUES
145730000817  ¦               DIVIDE AD-MARKET-VALUE BY WS-PRV-USD-RTECLS
145740000817  V                 GIVING AD-MARKET-VALUE-BASE ROUNDED
145750000817R21815         ELSE
145760000817                  DIVIDE AD-MARKET-VALUE  BY  WS-CC-RTECLS (CC)
145770000913                    GIVING  AD-MARKET-VALUE-BASE ROUNDED
145780000818R21815         END-IF
145790000817R21815     END-IF.
145800000817
145810000817           MOVE WS-ACB-UNIT-PRICE-BASE
145820000817                                       TO  AD-ACB-UNIT-PRICE-BASE.
145830000817R13637     IF   WS-ACB-UNIT-PRICE-BASE   IS LESS THAN 0
145840010607  ¦             MOVE "-" TO AD-ACB-UNIT-PRICE-BASE-SIGN
145850000908R35540     ELSE
145860010625R35540          MOVE " " TO AD-ACB-UNIT-PRICE-BASE-SIGN
145870010625R13637     END-IF.
145880000908
145890000907RF7503***** Call MKTVALUE to get the Market-Value for every Quarters
145900980624      ***** over the past 4 Quarters. The Quarters were determined by
145910970530      ***** Statement End Date.
145920970423
145930970423           IF WS-LDA-PRIQT                   IS EQUAL TO "Y"
145940970530              MOVE ZEROES                 TO  WS-MKT-Q-INVESTMENT
145950970424              INITIALIZE WS-MKT-PARMS
145960040723              MOVE PREV-ACCOUNT           TO  WS-MKT-Q-ACCOUNT-NO
145970040723              MOVE PREV-INVESTMENT        TO  WS-MKT-Q-INVESTMENT-CODE
145980040723              PERFORM CALL-MKTVALUE-ROUTINE     THRU CMKTR-EXIT
145990040723           END-IF.
146000040723R10404     IF PREV-PT-RULE                     IS EQUAL TO  "7"
146010040723              PERFORM POPULATE-AD-DII-RATE       THRU PADR-EXIT
146020040723              MOVE ANNUAL-RATE OF INVESTMENT-DII-RATES-REC
146030010606                                            TO AD-DII-RATE
146040010606           END-IF.
146050010606
146060010606       LS1-0000-0060.
146070051109           IF  WS-CC-RTECLS (CC) EQUAL TO  ZEROES
146080051109               MOVE 1                  TO  AD-EXCHANGE-RATE
146090010607             ELSE
146100010607               MOVE WS-CC-RTECLS (CC)  TO  AD-EXCHANGE-RATE.
146110010607
146120051020R21815     IF AD-CURRENCY           = WS-CURRENCY-USD           AND
146130010607  ¦           WS-LDA-REQUEST-SCOPE  = "B"                       AND
146140010615  ¦           WS-LDA-STMT-CNFM-FLAG = "S"                       AND
146150051020  ¦           ACCOUNT-NO OF STMT-PRINT-REQ-REC NOT = AD-ACCOUNT AND
146160051020  ¦           CURR-CONTROLS     NOT = HIGH-VALUES
146170051020  V           MOVE WS-PRV-USD-RTECLS TO AD-EXCHANGE-RATE
146180020709R21815     END-IF.
146190051020R10404*****
146200020709      *****    If GIC, AD-ACCRUED-INTEREST should be calculated
146210020806      *****    by Call INTCLC/GICCALC.
146220010726      *****
146230051020R30514*****    Generate Account-GIC-Details records was moved inside
146240051020R30514*****    GET-GIC-AD-ACCRUED-INT subroutine.
146250061003           IF  WS-LDA-GIC-25                    IS EQUAL TO  "Y"
146260061003           AND PREV-PT-RULE                     IS EQUAL TO  "2"
146270051020               PERFORM  GET-GIC-AD-ACCRUED-INT   THRU GGAAI-EXIT
146280010607
146290010607               MOVE WS-AD-ACCRUED-INTEREST   TO AD-ACCRUED-INTEREST
146300010606               ADD AD-ACCRUED-INTEREST       TO AD-MARKET-VALUE-BASE
146310010606
14632001060613300          IF WS-AD-ACCRUED-INTEREST IS LESS THAN 0
146330010606  ¦               SUBTRACT AD-ACCRUED-INTEREST FROM  AD-MARKET-VALUE
146340010607  ¦            ELSE
146350010607  ¦               ADD AD-ACCRUED-INTEREST    TO AD-MARKET-VALUE
14636001060713300          END-IF
146370010615
146380020709R10992         MOVE WS-AD-BOOK-VALUE-BASE    TO AD-BOOK-VALUE-BASE
146390020709R13637         IF WS-AD-BOOK-VALUE-BASE    IS LESS THAN 0
146400020709  ¦               MOVE "-" TO AD-BOOK-VALUE-SIGN
146410020709R35540         ELSE
146420020709R35540            MOVE " " TO AD-BOOK-VALUE-SIGN
146430010606R13637         END-IF
146440010606               GO TO LS1-0020
146450970424           END-IF.
146460970424      *****
146470970424      *****    If DII, AD-ACCRUED-INTEREST should be calculated
146480970424      *****    by Call INTCLC.
146490970424      *****
146500970428           IF  PREV-PT-RULE                     IS EQUAL TO  "7"
146510970424               PERFORM  GET-DII-AD-ACCRUED-INT   THRU GDAAI-EXIT
146520970424               MOVE WS-AD-ACCRUED-INTEREST   TO AD-ACCRUED-INTEREST
146530010606               ADD AD-ACCRUED-INTEREST       TO AD-MARKET-VALUE-BASE
14654097042413300          IF  WS-AD-ACCRUED-INTEREST IS LESS THAN 0
146550970424  ¦              SUBTRACT AD-ACCRUED-INTEREST FROM  AD-MARKET-VALUE
146560970424  ¦            ELSE
146570970424  ¦              ADD AD-ACCRUED-INTEREST    TO AD-MARKET-VALUE
14658097042413300          END-IF
146590970424               GO TO LS1-0020
146600970424R10404     END-IF.
146610970424      *****
146620970424      *****    If applicable, use the Account Investment Accrual to
146630970424      *****    format the accrued interest.
146640970424      *****
146650970424           IF  WS-ACCINT-SW  NOT EQUAL TO  "Y"
146660970424           OR  WS-IG-FIXVAR (IG)
146670970424                          IS NOT EQUAL TO  "F"
146680970424               GO TO LS1-0020.
146690970424
146700970424           INITIALIZE MFAACCIAP.
146710970424           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
146720970424                                           OF ACCOUNT-INV-ACCRUALS-REC.
146730970424           MOVE PREV-INVESTMENT        TO  INVESTMENT-CODE
146740970424                                           OF ACCOUNT-INV-ACCRUALS-REC.
146750970424           START ACCOUNT-INV-ACCRUALS
146760970424               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
146770970424               INVALID KEY
146780970424                   GO TO LS1-0020.
146790970424
146800970424       LS1-0010.
146810970424           READ ACCOUNT-INV-ACCRUALS NEXT
146820080923                                       AT  END
146830080923               GO TO LS1-0020.
146840080923
146850081027           IF  INVESTMENT-CODE
146860081027               OF ACCOUNT-INV-ACCRUALS-REC
146870081027                          IS NOT EQUAL TO  PREV-INVESTMENT
146880081027           OR  ACCOUNT-NO
146890080923               OF ACCOUNT-INV-ACCRUALS-REC
146900080924                          IS NOT EQUAL TO  PREV-ACCOUNT
146910080924               GO TO LS1-0020.
146920080924
146930080924           ADD ACCRUAL-AMT
146940101217               OF ACCOUNT-INV-ACCRUALS-REC
146950101217                                       TO  AD-ACCRUED-INTEREST.
146960101217           GO TO LS1-0010.
146970101217       LS1-0020.
146980101217R50823*****
146990101217  |   *****    Find the MPA value of the Fund.
147000101217  |   *****
147010101217R50823
147020101217R59263     MOVE 0                  TO WS-INV-GMA-VALUE
147030101217R59263                                WS-INV-GMA-VALUE-EX.
147040101217R50823
147050101217  |        IF lb-LdaAccountAdditionalInfoYes
147060101217  ¦           MOVE 0 TO           Ln-MGAClosingDate
147070101217  ¦           MOVE 0 TO           Ln-MGAUsingDate
147080101217  ¦           MOVE 0 TO           Ln-UnitPrice
147090101217  ¦
147100080925R85453        MOVE PREV-INVESTMENT    TO pc_InvestmentCode
147110080925  |           MOVE WS-LDA-ENDDTE      TO pi_EndDate
147120081104  |           MOVE "00"               TO pc_ReturnCode
147130081104  |
147140081104  |           CALL "FXGETGMP" USING   pc_InvestmentCode
147150081103  |                                   pi_EndDate
147160081105  |                                   pn_UnitPrice
147170081105  |                                   pi_TradeDate
147180081105  |                                   pi_GMPClosingDate
147190081105  |                                   pc_GMPRule
147200081105  |                                   pc_ReturnCode
147210081103  |
147220081105  |           IF pc_ReturnCode = "00"
147230081105  |              MOVE pi_GMPClosingDate TO Ln-MGAClosingDate
147240081105  V              COMPUTE Ln-UnitPrice = pn_UnitPrice
147250081105R85453        END-IF
147260081105  ¦              COMPUTE WS-INV-GMA-VALUE ROUNDED = AD-NO-OF-UNITS
147270081105  ¦                                               * Ln-UnitPrice
147280081105R50823* 59263    IF AD-EXCHANGE-RATE NOT = 0
147290081105R59263           IF WS-CC-CODE (CC) Not = "CAD" AND
147300081103R59263              WS-CC-CODE (CC) Not = " "
147310081103R59263
147320081103R59263              If WS-CC-CODE (CC) Not = Lc-SQLcurrency
147330081105R59263                 or Ln-LastExchangeRate = 0
147340081103R59263
147350081105R59263                 Move WS-CC-CODE (CC) to Lc-SQLcurrency
147360081105R59263                 Move 0               to Ln-LastExchangeRate
147370081105   ¦
147380081105   |                   EXEC SQL
147390081105   |                     SELECT  COALESCE(EXCHANGE_RATE, 0)
147400081105   |                     INTO  :Ln-LastExchangeRate
147410081105   |                     FROM  MFAEXRHMP
147420081105   |                     WHERE Currency           = :Lc-SQLcurrency
147430081105   |                       AND Trade_Date         = :ld_LastTradeDate
147440081103   |                       AND Exchange_Rate_Type = :lc_ExchangeRateType
147450081105   ¦                   END-EXEC
147460081105   |  *
147470081105   |  * If not found, try to find the currency's latest Exchange Rate
147480081105   |  *
147490081105   |                   If Ln-LastExchangeRate = 0
147500081105   |
147510081105   |                      EXEC SQL
147520081105   |                        SELECT COALESCE(Max(Trade_Date), 0)
147530081105   |                        INTO  :ld_LastTradeDate2
147540081103   |                        FROM  MFAEXRHMP
147550081105   |                        WHERE Currency           = :Lc-SQLcurrency
147560081105   |                          AND Exchange_Rate_Type =
147570081104   |                              :lc_ExchangeRateType
147580081105   |                          AND Exchange_Rate      > 0
147590081105   |                      END-EXEC
147600081103   |
147610081103   |                      EXEC SQL
147620081029   |                        SELECT  COALESCE(EXCHANGE_RATE, 0)
147630080925   |                        INTO  :Ln-LastExchangeRate
147640080925   |                        FROM  MFAEXRHMP
147650081031   |                        WHERE Currency      = :Lc-SQLcurrency
147660080925   |                          AND Trade_Date    = :ld_LastTradeDate2
147670080925   |                          AND Exchange_Rate_Type =
147680080925   |                              :lc_ExchangeRateType
147690101217   ¦                      END-EXEC
147700080923   ¦
147710080922R59263                 End-If
147720040511R59263              End-If
147730040511   |  * Still not found, the last resource is to set it to 1
147740040511   |                If Ln-LastExchangeRate = 0
147750040511R59263                Move 1 to Ln-LastExchangeRate
147760040511R59263              End-If
147770040511
147780040511R50823              COMPUTE WS-INV-GMA-VALUE-EX  ROUNDED
147790040511  ¦                                             = (AD-NO-OF-UNITS
147800040511  ¦                                             * Ln-UnitPrice)
147810040511  ¦                                             / Ln-LastExchangeRate
147820040511  ¦              ELSE
147830040511  ¦                 MOVE 0            TO WS-INV-GMA-VALUE-EX
147840040511  |              END-IF
147850040511R85453*       END-IF
147860040511R50823     END-IF.
147870040511
147880040511R18194     SET ACT         TO CC.
147890040511   ¦       MOVE WS-CC-CODE (CC)         TO  WS-INV-CUR-CODE (ACT).
147900040511   ¦       MOVE WS-CC-DESCR(CC)         TO  WS-INV-CUR-DESCR(ACT).
147910040511   ¦       ADD 1                        TO  WS-ACCOUNT-CURRENCY-LST
147920040511   ¦       ADD AD-BOOK-VALUE-BASE       TO  WS-ACC-CUR-BVB (ACT).
147930040511   ¦       ADD AD-BOOK-VALUE            TO  WS-ACC-CUR-BVF (ACT).
147940040511   ¦       ADD WS-INV-CPG               TO  WS-ACC-CUR-CPG (ACT).
147950040511   ¦       ADD AD-MARKET-VALUE-BASE     TO  WS-ACC-CUR-MVB (ACT).
147960040511   ¦       ADD WS-INV-MVP               TO  WS-ACC-CUR-MVP (ACT).
147970040511   ¦       ADD AD-MARKET-VALUE          TO  WS-ACC-CUR-VALUE (ACT).
147980040511   ¦       ADD AD-MARKET-VALUE-PRIOR-Q1 TO  WS-ACC-CUR-MVBQ1 (ACT).
147990040511   ¦       ADD AD-MARKET-VALUE-PRIOR-Q2 TO  WS-ACC-CUR-MVBQ2 (ACT).
148000040511   ¦       ADD AD-MARKET-VALUE-PRIOR-Q3 TO  WS-ACC-CUR-MVBQ3 (ACT).
148010040511   ¦       ADD AD-MARKET-VALUE-PRIOR-Q4 TO  WS-ACC-CUR-MVBQ4 (ACT).
148020040511   ¦
148030040511   ¦       ADD WS-INV-PUR-INCEPT  TO WS-INV-PUR-INCEPT-TOT-CUR (ACT).
148040040511   ¦       ADD WS-INV-RED-INCEPT  TO WS-INV-RED-INCEPT-TOT-CUR (ACT).
148050040511   ¦       ADD WS-INV-TRI-INCEPT  TO WS-INV-TRI-INCEPT-TOT-CUR (ACT).
148060040511   ¦       ADD WS-INV-TRO-INCEPT  TO WS-INV-TRO-INCEPT-TOT-CUR (ACT).
148070040511   ¦       ADD WS-INV-TRI-INCEPT-COST
148080040511   ¦                          TO WS-INV-TRI-INCEPT-COST-TOT-CUR (ACT).
148090040511   ¦       ADD WS-INV-TRO-INCEPT-COST
148100040511   ¦                          TO WS-INV-TRO-INCEPT-COST-TOT-CUR (ACT).
148110040511   ¦       ADD WS-INV-TRI-INCEPT-MKT
148120040511   ¦                          TO WS-INV-TRI-INCEPT-MKT-TOT-CUR (ACT).
148130040511   ¦       ADD WS-INV-TRO-INCEPT-MKT
148140040511   ¦                          TO WS-INV-TRO-INCEPT-MKT-TOT-CUR (ACT).
148150040511   ¦
148160040511   ¦       ADD WS-INV-DISP-GAIN-LOSS-CUR
148170040511   ¦                  TO WS-INV-DISP-GAIN-LOSS-CUR-TCUR (ACT).
148180040511   ¦       ADD WS-INV-DISP-GAIN-LOSS-YTD
148190040511   ¦                  TO WS-INV-DISP-GAIN-LOSS-YTD-TCUR (ACT).
148200040511   ¦       ADD WS-INV-DISP-GAIN-LOSS-INC
148210040511   ¦                  TO WS-INV-DISP-GAIN-LOSS-INC-TCUR (ACT).
148220040511   ¦
148230040511   ¦       ADD WS-INV-SWI-INCEPT  TO WS-INV-SWI-INCEPT-TOT-CUR (ACT).
148240040511   ¦       ADD WS-INV-SWO-INCEPT  TO WS-INV-SWO-INCEPT-TOT-CUR (ACT).
148250040511   ¦       ADD WS-INV-BUY-CURRENT TO WS-INV-BUY-CURRENT-TOT-CUR (ACT).
148260040511   ¦       ADD WS-INV-SEL-CURRENT TO WS-INV-SEL-CURRENT-TOT-CUR (ACT).
148270040511   ¦       ADD WS-INV-PUR-CURRENT TO WS-INV-PUR-CURRENT-TOT-CUR (ACT).
148280040511   ¦       ADD WS-INV-RED-CURRENT TO WS-INV-RED-CURRENT-TOT-CUR (ACT).
148290040511   ¦       ADD WS-INV-TRI-CURRENT TO WS-INV-TRI-CURRENT-TOT-CUR (ACT).
148300040511   ¦       ADD WS-INV-TRO-CURRENT TO WS-INV-TRO-CURRENT-TOT-CUR (ACT).
148310040527   ¦       ADD WS-INV-SWI-CURRENT TO WS-INV-SWI-CURRENT-TOT-CUR (ACT).
148320040527   ¦       ADD WS-INV-SWO-CURRENT TO WS-INV-SWO-CURRENT-TOT-CUR (ACT).
148330040527   ¦       ADD WS-INV-BAJ-CUR     TO WS-INV-BAJ-CUR-TOT-CUR (ACT).
148340040527   ¦       ADD WS-INV-BAJ-YTD     TO WS-INV-BAJ-YTD-TOT-CUR (ACT).
148350040527   ¦       ADD WS-INV-BAJ-INCEPT  TO WS-INV-BAJ-INCEPT-TOT-CUR (ACT).
148360040527   ¦       ADD WS-INV-BFW-CUR     TO WS-INV-BFW-CUR-TOT-CUR (ACT).
148370040813   ¦       ADD WS-INV-BFW-YTD     TO WS-INV-BFW-YTD-TOT-CUR (ACT).
148380040527   ¦       ADD WS-INV-BFW-INCEPT  TO WS-INV-BFW-INCEPT-TOT-CUR (ACT).
148390040813   ¦       ADD WS-INV-TRI-INCEPT-PH
148400040527   ¦                            TO WS-INV-TRI-INCEPT-PH-TOT-CUR (ACT).
148410040813   ¦       ADD WS-INV-TRI-YTD-PH  TO WS-INV-TRI-YTD-PH-TOT-CUR (ACT).
148420040813   ¦       ADD WS-INV-TRI-CUR-PH  TO WS-INV-TRI-CUR-PH-TOT-CUR (ACT).
148430040813   ¦       ADD WS-INV-TRO-INCEPT-PH
148440080925   ¦                            TO WS-INV-TRO-INCEPT-PH-TOT-CUR (ACT).
148450120316   ¦       ADD WS-INV-TRO-YTD-PH  TO WS-INV-TRO-YTD-PH-TOT-CUR (ACT).
148460120316   ¦       ADD WS-INV-TRO-CUR-PH  TO WS-INV-TRO-CUR-PH-TOT-CUR (ACT).
148470120316   ¦       ADD WS-INV-DISP-GAIN-LOSS-CUR
148480160927   ¦                           TO WS-INV-DISP-GAIN-LOSS-CUR-CUR (ACT).
148490160928   ¦       ADD WS-INV-DISP-GAIN-LOSS-YTD
148500140925   ¦                           TO WS-INV-DISP-GAIN-LOSS-YTD-CUR (ACT).
148510140925   ¦       ADD WS-INV-DISP-GAIN-LOSS-INC
148520140925   ¦                           TO WS-INV-DISP-GAIN-LOSS-INC-CUR (ACT).
148530040813   ¦       ADD WS-INV-TRI-INCEPT-MKT
148540040512   ¦                           TO WS-INV-TRI-INCEPT-MKT-CUR (ACT).
148550040512   ¦       ADD WS-INV-TRO-INCEPT-MKT
148560040512   ¦                           TO WS-INV-TRO-INCEPT-MKT-CUR (ACT).
148570040512   ¦       ADD WS-INV-ROC-CUR     TO  WS-INV-ROC-CUR-TOT-CUR (ACT).
148580040511   ¦       ADD WS-INV-ROC-YTD     TO  WS-INV-ROC-YTD-TOT-CUR (ACT).
148590040511   ¦       ADD WS-INV-ROC-INCEPT  TO  WS-INV-ROC-INCEPT-TOT-CUR (ACT).
148600040511R50823     ADD WS-INV-GMA-VALUE   TO  WS-GMA-VALUE-TOT-CUR (ACT).
148610160209102716     ADD WS-INV-CPG-YTD     TO  WS-INV-CPG-YTD-TOT   (ACT).
148620160212102716     ADD WS-INV-INC-YTD     TO  WS-INV-INC-YTD-TOT   (ACT).
148630980604102716     ADD WS-INV-INT-YTD     TO  WS-INV-INT-YTD-TOT   (ACT).
148640970423162904     ADD ln_YTDTrailer      TO  ln_ACC-CPG-YTF-TOT   (ACT).
148650971024
148660970423      * RFS 139952 -begin RM
148670001113           ADD AD-Accrued-Interest TO Ws-Inv-Accr-Int-Tot  (ACT).
148680990615      * RFS 139952 -begin RM
148690040512   ¦
148700140925   ¦       IF WS-INVAUCCUR-SW (ACT)     IS EQUAL TO " "
148710140925   ¦          MOVE "N"            TO WS-INVAUCCUR-SW (ACT)
148720140925   ¦       END-IF.
148730020730   ¦
148740020730   ¦       IF WS-INVAUC-SW   IS EQUAL TO  "Y"
148750020730   v          MOVE "Y"            TO WS-INVAUCCUR-SW (ACT)
148760020730R18194     END-IF.
148770061003148326     IF WS-LDA-INVESTOR-12    IS EQUAL TO "Y"
148780061003148326         PERFORM GET-INV-MER-VALUE THRU GIMV-EXIT.
148790020730       LS1-0020-0000-0020.
148800020730           ADD AD-MARKET-VALUE-BASE    TO  WS-ACC-VALUE.
148810000000           ADD WS-INV-OPNMKTVAL        TO  WS-ACC-OPNMKTVAL.
148820970108           ADD AD-MARKET-VALUE-BASE    TO  WS-TOTAL-VALUE.
148830970108           ADD AD-BOOK-VALUE-BASE      TO  WS-BOOK-TOTAL-ACCT.
148840990813           ADD WS-BOOK-FGN-INV         TO  WS-BOOK-FGN-ACCT.
148850970108R18194     ADD WS-INV-MVP-TOT-CUR      TO  WS-INV-ACC-MVP-TOT-CUR.
148860970108      * RFS 139952 - begin RM
148870970108           ADD AD-Accrued-Interest     TO  Ws-Ad-Accr-Int.
148880990813      * RFS 139952 - end   RM
148890970108
148900980512           MOVE WS-IC-LSTPRC (IC)   TO  AD-LAST-UNIT-PRICE.
148910990813R13637     IF   WS-IC-LSTPRC (IC)   IS LESS THAN 0
148920980512  ¦             MOVE "-" TO AD-LAST-UNIT-PRICE-SIGN
148930980512R35540     ELSE
148940990813R35540          MOVE " " TO AD-LAST-UNIT-PRICE-SIGN
148950980512R13637     END-IF.
148960970523
148970980921           MOVE AT-FUND-NO TO AD-FUND-NO.
148980980918
148990980921      *****
149000980921      *****    If the Fund is 986, update the FUND
149010980921      *****    986 indicator.
149020980918      *****
149030980918           MOVE AD-FUND-NO             TO  WS-FUND-NO.
149040980918           IF  WS-FUND        IS EQUAL TO  "986"
149050980918               MOVE "Y"                TO  II-FUND-986.
149060980921      *****
149070980921      *****    If the Fund is 902, update the FUND
149080980921      *****    902 indicator.
149090980921      *****
149100980921           IF  WS-FUND        IS EQUAL TO  "902"
149110980921               MOVE "Y"                TO  II-FUND-902.
149120980921
149130980921           IF WS-LDA-INV-ACC-FLAG   IS NOT EQUAL TO "Y"
149140980918              GO TO LS1-0020-0000-0030.
149150970523           IF WS-FUND IS NOT EQUAL TO "986"
149160970523           AND WS-FUND IS NOT EQUAL TO "902"
149170970523              GO TO LS1-0020-0000-0030.
149180990518      *****
149190990518      *****    Format Fund 986 and Fund 902 of 01 Record
149200031003      *****    on Account Level
149210051003      *****
149220021004           MOVE INVESTOR-INFO-SECTION TO  WS-II-SECTION-INV.
149230021004           MOVE WS-II-SECTION-ACC     TO  INVESTOR-INFO-SECTION.
149240021004           IF WS-FUND        IS EQUAL TO  "986"
149250061003              MOVE "Y"                   TO  II-FUND-986.
149260061003           IF WS-FUND        IS EQUAL TO  "902"
149270021004              MOVE "Y"                   TO II-FUND-902.
149280021004           MOVE INVESTOR-INFO-SECTION TO  WS-II-SECTION-ACC.
149290021004           MOVE WS-II-SECTION-INV     TO  INVESTOR-INFO-SECTION.
149300021004       LS1-0020-0000-0030.
149310061003      *------------------------------------------------*
149320061003      *  GET INVESTMENT GROUP CATEGORY                 *
149330021004      *------------------------------------------------*
149340021004           MOVE WS-IG-DESC (IG)   TO  AD-ASSET-CLASS.
149350021004           MOVE WS-IG-CAT (IG)    TO  AD-INVESTMENT-GRP-CATEGORY.
149360021004R17527     MOVE WS-IG-CODE (IG)   TO  AD-INVESTMENT-GROUP-CODE.
149370061003R14153     MOVE WS-INVGC-GRP-DESCR TO  AD-INVESTMENT-GRP-CAT-DESC.
149380061003           MOVE WS-INV-BAJ-CUR     TO AD-BAJ-CUR.
149390021004R14858     IF   WS-INV-BAJ-CUR       IS LESS THAN ZEROES
149400021004  ¦           MOVE "-"  TO  AD-BAJ-CUR-SIGN
149410021004R35540     ELSE
149420021004R35540        MOVE " "  TO  AD-BAJ-CUR-SIGN
149430061003R14858     END-IF.
149440061003           MOVE WS-INV-BAJ-YTD     TO AD-BAJ-YTD.
149450021004R14858     IF   WS-INV-BAJ-YTD       IS LESS THAN ZEROES
149460021004  ¦           MOVE "-"  TO  AD-BAJ-YTD-SIGN
149470021004R35540     ELSE
149480021004R35540        MOVE " "  TO  AD-BAJ-YTD-SIGN
149490061003R14858     END-IF.
149500061003           MOVE WS-INV-BAJ-INCEPT  TO AD-BAJ-INCEPT.
149510021004R14858     IF   WS-INV-BAJ-INCEPT    IS LESS THAN ZEROES
149520021004  ¦           MOVE "-"  TO  AD-BAJ-INCEPT-SIGN
149530021004R35540     ELSE
149540021004R35540        MOVE " "  TO  AD-BAJ-INCEPT-SIGN
149550021004R14858     END-IF.
149560061003           MOVE WS-INV-BFW-CUR     TO AD-BFW-CUR.
149570061003R14858     IF   WS-INV-BFW-CUR       IS LESS THAN ZEROES
149580021004  ¦           MOVE "-"  TO  AD-BFW-CUR-SIGN
149590021004R35540     ELSE
149600040414R35540        MOVE " "  TO  AD-BFW-CUR-SIGN
149610040414R14858     END-IF.
149620040414           MOVE WS-INV-BFW-YTD     TO AD-BFW-YTD.
149630061003R14858     IF   WS-INV-BFW-YTD       IS LESS THAN ZEROES
149640061003  ¦           MOVE "-"  TO  AD-BFW-YTD-SIGN
149650040414R35540     ELSE
149660040414R35540        MOVE " "  TO  AD-BFW-YTD-SIGN
149670040414R14858     END-IF.
149680040414
149690040414           MOVE WS-INV-BFW-INCEPT  TO AD-BFW-INCEPT.
149700061003R14858     IF   WS-INV-BFW-INCEPT    IS LESS THAN ZEROES
149710061003  ¦           MOVE "-"  TO  AD-BFW-INCEPT-SIGN
149720040414R35540     ELSE
149730040414R35540        MOVE " "  TO  AD-BFW-INCEPT-SIGN
149740040414R14858     END-IF.
149750040414
149760040414R20758     MOVE WS-INV-ROC-CUR     TO AD-ROC-CUR.
149770061003  ¦        IF   WS-INV-ROC-CUR       IS LESS THAN ZEROES
149780061003  ¦           MOVE "-"  TO  AD-ROC-CUR-SIGN
149790040414R35540     ELSE
149800040414R35540        MOVE " "  TO  AD-ROC-CUR-SIGN
149810061103R20758     END-IF.
149820050921
149830050914R20758     MOVE WS-INV-ROC-YTD     TO AD-ROC-YTD.
149840050914  ¦        IF   WS-INV-ROC-YTD       IS LESS THAN ZEROES
149850061003  ¦           MOVE "-"  TO  AD-ROC-YTD-SIGN
149860061003R35540     ELSE
149870050914R35540        MOVE " "  TO  AD-ROC-YTD-SIGN
149880050914R20758     END-IF.
149890050914
149900050914R20758     MOVE WS-INV-ROC-INCEPT  TO AD-ROC-INCEPT.
149910050914  ¦        IF   WS-INV-ROC-INCEPT    IS LESS THAN ZEROES
149920061003  ¦           MOVE "-"  TO  AD-ROC-INCEPT-SIGN
149930061003R35540     ELSE
149940050914R35540        MOVE " "  TO  AD-ROC-INCEPT-SIGN
149950050914R20758     END-IF.
149960050914
149970050914R36342     IF lb-LdaAccountAdditionalInfoYes
149980050914  ¦        MOVE WS-INV-PURCH-LAST-12-MONTHS TO AAI-PURCH-LAST-12-MONTHS
149990061003  ¦        IF   WS-INV-PURCH-LAST-12-MONTHS   IS LESS THAN ZEROES
150000061003  ¦         MOVE "-"  TO  AAI-PURCH-LAST-12-MONTHS-SIGN
150010050914R35540     ELSE
150020050914R35540      MOVE " "  TO  AAI-PURCH-LAST-12-MONTHS-SIGN
150030050914  ¦        END-IF
150040050914  ¦
150050050914  ¦        MOVE WS-INV-REDEM-LAST-12-MONTHS TO AAI-REDEM-LAST-12-MONTHS
150060061003  ¦        IF   WS-INV-REDEM-LAST-12-MONTHS   IS LESS THAN ZEROES
150070061003  ¦         MOVE "-"  TO  AAI-REDEM-LAST-12-MONTHS-SIGN
150080050921R35540     ELSE
150090061024R35540      MOVE " "  TO  AAI-REDEM-LAST-12-MONTHS-SIGN
150100061024  ¦        END-IF
150110061024  ¦
150120061030  ¦        MOVE WS-INV-TRI-LAST-12-MONTHS TO AAI-TRI-LAST-12-MONTHS
150130061030  ¦        IF   WS-INV-TRI-LAST-12-MONTHS   IS LESS THAN ZEROES
150140061024  ¦         MOVE "-"  TO  AAI-TRI-LAST-12-MONTHS-SIGN
150150061024R35540     ELSE
150160061024R35540      MOVE " "  TO  AAI-TRI-LAST-12-MONTHS-SIGN
150170061024  ¦        END-IF
150180061024  ¦
150190061024  ¦        MOVE WS-INV-TRO-LAST-12-MONTHS TO AAI-TRO-LAST-12-MONTHS
150200061024  ¦        IF   WS-INV-TRO-LAST-12-MONTHS   IS LESS THAN ZEROES
150210061024  ¦         MOVE "-"  TO  AAI-TRO-LAST-12-MONTHS-SIGN
150220061024R35540     ELSE
150230061024R35540      MOVE " "  TO  AAI-TRO-LAST-12-MONTHS-SIGN
150240061024  ¦        END-IF
150250061024
150260061024      *RFS36342 - Starts
150270061024           COMPUTE ln_InvCurrDispProceedsBase ROUNDED =
150280061024                   ln_CurrDispProceedsBase -
150290061024                   ln_InvCurrDispCdscBase
150300061024           MOVE ln_InvCurrDispProceedsBase
150310061024             TO AAI-CURR-DISP-PROCEEDS-BASE
150320061024           IF ln_InvCurrDispProceedsBase  <  0
150330061024              MOVE "-"  TO AAI-CURR-DISP-PROCEEDS-BASE-S
150340061024           ELSE
150350061024              MOVE " "  TO AAI-CURR-DISP-PROCEEDS-BASE-S
150360061024           END-IF
150370061024
150380061024           MOVE ln_InvCurrDispBookValueBase
150390061024             TO AAI-CURR-DISP-BOOK-VAL-BASE
150400061024           IF ln_InvCurrDispBookValueBase  <  0
150410061024              MOVE "-"  TO AAI-CURR-DISP-BOOK-VAL-BASE-S
150420061101           ELSE
150430061101              MOVE " "  TO AAI-CURR-DISP-BOOK-VAL-BASE-S
150440061101           END-IF
150450061024
150460061101           COMPUTE ln_InvCurrDispGainLossBase ROUNDED =
150470061024                   ln_CurrDispProceedsBase -
150480061024                   ln_InvCurrDispCdscBase -
150490061101                   ln_InvCurrDispBookValueBase
150500061101           MOVE ln_InvCurrDispGainLossBase
150510061101             TO AAI-CURR-DISP-GAIN-LOSS-BASE
150520061024           IF ln_InvCurrDispGainLossBase  <  0
150530061101              MOVE "-"  TO AAI-CURR-DISP-GAIN-LOSS-BASE-S
150540061024           ELSE
150550061024              MOVE " "  TO AAI-CURR-DISP-GAIN-LOSS-BASE-S
150560061031           END-IF
150570061024
150580061031           MOVE ln_InvGrossSoldYtdBase  TO AAI-GROSS-SOLD-YTD-BASE
150590061024           IF ln_InvGrossSoldYtdBase  <  0
150600061024              MOVE "-"  TO AAI-GROSS-SOLD-YTD-BASE-SIGN
150610061024           ELSE
150620061024              MOVE " "  TO AAI-GROSS-SOLD-YTD-BASE-SIGN
150630061024           END-IF
150640061031
150650061024           MOVE ln_InvGrossSoldCurrBase  TO AAI-GROSS-SOLD-CURR-BASE
150660061031           IF ln_InvGrossSoldCurrBase  <  0
150670061024              MOVE "-"  TO AAI-GROSS-SOLD-CURR-BASE-SIGN
150680061024           ELSE
150690061024              MOVE " "  TO AAI-GROSS-SOLD-CURR-BASE-SIGN
150700061024           END-IF
150710061024
150720051014           MOVE ln_InvDeductionsCdscYtdBase
150730050915             TO AAI-DEDUCTIONS-DSC-YTD-BASE
150740031114           IF ln_InvDeductionsCdscYtdBase  <  0
150750031114              MOVE "-"  TO AAI-DEDUCTIONS-DSC-YTD-BASE-S
150760031114           ELSE
150770031216              MOVE " "  TO AAI-DEDUCTIONS-DSC-YTD-BASE-S
150780031216           END-IF
150790031216
150800061003           MOVE ln_InvDeductionsCdscCurrBase
150810061003             TO AAI-DEDUCTIONS-DSC-CURR-BASE
150820061003           IF ln_InvDeductionsCdscCurrBase  <  0
150830061003              MOVE "-"  TO AAI-DEDUCTIONS-DSC-CURR-BASE-S
150840031114           ELSE
150850031114              MOVE " "  TO AAI-DEDUCTIONS-DSC-CURR-BASE-S
150860031114           END-IF
150870031114      *RFS36342 - Ends
150880031216R28931     END-IF.
150890031216
150900031216R18312     ADD  WS-INV-BUY-CURRENT
150910061003  ¦             WS-INV-TRI-CURRENT
150920061003  ¦             WS-INV-SWI-CURRENT
150930061003  ¦                 GIVING    AD-DEPOSIT
150940061003  ¦                           WS-DEPOSIT-TOT.
150950031114  ¦        IF   WS-DEPOSIT-TOT  IS LESS THAN  ZEROES
150960970523R18312          MOVE  "-"  TO  AD-DEPOSIT-SIGN
150970020731R35540     ELSE
150980020731R35540          MOVE  " "  TO  AD-DEPOSIT-SIGN
150990061003R35540     END-IF.
151000061003
151010020731R18312     ADD  WS-INV-SEL-CURRENT
151020020731  ¦             WS-INV-TRO-CURRENT
151030970523  ¦             WS-INV-SWO-CURRENT
151040020731  ¦                 GIVING    AD-WITHDRAWALS
151050020731  ¦                           WS-WITHD-TOT.
151060061003  ¦        IF   WS-WITHD-TOT    IS LESS THAN  ZEROES
151070061003R18312          MOVE  "-"  TO  AD-WITHDRAWALS-SIGN
151080020731R35540     ELSE
151090020731R35540          MOVE  " "  TO  AD-WITHDRAWALS-SIGN
151100970523R35540     END-IF.
151110020731
151120020731           MOVE WS-INV-CPG-CURRENT TO AD-CPG-CURRENT.
151130061003R13637     IF   WS-INV-CPG-CURRENT   IS LESS THAN ZEROES
151140061003  ¦           MOVE "-"  TO  AD-CC-SIGN
151150020731R35540     ELSE
151160020731R35540        MOVE " "  TO  AD-CC-SIGN
151170970523R13637     END-IF.
151180970523
151190970523           MOVE WS-INV-INC-CURRENT TO AD-INC-CURRENT.
151200020403R13637     IF   WS-INV-INC-CURRENT   IS LESS THAN ZEROES
151210020403  ¦           MOVE "-"  TO  AD-IC-SIGN
151220020403R35540     ELSE
151230020219R35540        MOVE " "  TO  AD-IC-SIGN
151240061003R13637     END-IF.
151250061003
151260020219           MOVE WS-INV-INT-CURRENT TO AD-INT-CURRENT.
151270020213R13637     IF   WS-INV-INT-CURRENT   IS LESS THAN ZEROES
151280970523  ¦           MOVE "-"  TO  AD-NC-SIGN
151290020730R35540     ELSE
151300020730R35540        MOVE " "  TO  AD-NC-SIGN
151310061003R13637     END-IF.
151320061003
151330020731           ADD  WS-INV-CPG-CURRENT
151340020730                WS-INV-INC-CURRENT
151350970523                WS-INV-INT-CURRENT
151360020730                GIVING AD-DIVS-CURRENT
151370020730R12726                 WS-DIVS-CURRENT-EX.
151380061003  ¦        IF   WS-DIVS-CURRENT-EX  IS LESS THAN ZEROES
151390061003  ¦           MOVE "-"  TO  AD-DC-SIGN
151400020731R35540     ELSE
151410020730R35540        MOVE " "  TO  AD-DC-SIGN
151420970523R12726     END-IF.
151430020730
151440020730           MOVE WS-INV-PUR-CURRENT TO AD-PUR-CURRENT.
151450061003R13637     IF   WS-INV-PUR-CURRENT   IS LESS THAN ZEROES
151460061003  ¦           MOVE "-"  TO  AD-PC-SIGN
151470020731R35540     ELSE
151480020730R35540        MOVE " "  TO  AD-PC-SIGN
151490970523R13637     END-IF.
151500020730
151510020730           MOVE WS-INV-RED-CURRENT TO AD-RED-CURRENT.
151520061003R13637     IF   WS-INV-RED-CURRENT   IS LESS THAN ZEROES
151530061003  ¦           MOVE "-"  TO  AD-RC-SIGN
151540020731R35540     ELSE
151550060621R35540        MOVE " "  TO  AD-RC-SIGN
151560970523R13637     END-IF.
151570020731
151580020731           MOVE WS-INV-TRI-CURRENT TO AD-TRI-CURRENT.
151590061003R13637     IF   WS-INV-TRI-CURRENT   IS LESS THAN ZEROES
151600061003  ¦           MOVE "-"  TO  AD-TC-SIGN
151610020731R35540     ELSE
151620020731R35540        MOVE " "  TO  AD-TC-SIGN
151630970523R13637     END-IF.
151640020731
151650020731           MOVE WS-INV-TRO-CURRENT TO AD-TRO-CURRENT.
151660061003R13637     IF   WS-INV-TRO-CURRENT   IS LESS THAN ZEROES
151670061003  ¦           MOVE "-"  TO  AD-OC-SIGN
151680020731R35540     ELSE
151690020731R35540        MOVE " "  TO  AD-OC-SIGN
151700970523R13637     END-IF.
151710020731
151720020731           MOVE WS-INV-CPG-INCEPT  TO AD-CPG-INCEPT.
151730061003R13637     IF   WS-INV-CPG-INCEPT    IS LESS THAN ZEROES
151740061003  ¦           MOVE "-"  TO  AD-CI-SIGN
151750020731R35540     ELSE
151760020731R35540        MOVE " "  TO  AD-CI-SIGN
151770970523R13637     END-IF.
151780970523
151790970523           MOVE WS-INV-INC-INCEPT  TO AD-INC-INCEPT.
151800021220R13637     IF   WS-INV-INC-INCEPT    IS LESS THAN ZEROES
151810021220  ¦           MOVE "-"  TO  AD-II-SIGN
151820020730R35540     ELSE
151830020730R35540        MOVE " "  TO  AD-II-SIGN
151840061003R13637     END-IF.
151850061003
151860020730           MOVE WS-INV-INT-INCEPT  TO AD-INT-INCEPT.
151870020730R13637     IF   WS-INV-INT-INCEPT    IS LESS THAN ZEROES
151880970523  ¦           MOVE "-"  TO  AD-NI-SIGN
151890020731R35540     ELSE
151900020730R35540        MOVE " "  TO  AD-NI-SIGN
151910061003R13637     END-IF.
151920061003
151930020731           ADD  WS-INV-CPG-INCEPT
151940020730                WS-INV-INC-INCEPT
151950970523                WS-INV-INT-INCEPT
151960020731                GIVING AD-DIVS-INCEPT
151970020730                       AD-DIVS-INCEPT-EX.
151980061003R13637     IF   AD-DIVS-INCEPT-EX   IS LESS THAN ZEROES
151990061003  ¦           MOVE "-"  TO  AD-DI-SIGN
152000020731R35540     ELSE
152010020730R35540        MOVE " "  TO  AD-DI-SIGN
152020020923R13637     END-IF.
152030020923
152040020923           MOVE WS-INV-PUR-INCEPT  TO AD-PUR-INCEPT.
152050061003R13637     IF   WS-INV-PUR-INCEPT   IS LESS THAN ZEROES
152060061003  ¦           MOVE "-"  TO  AD-PI-SIGN
152070020923R35540     ELSE
152080020923R35540        MOVE " "  TO  AD-PI-SIGN
152090020923R13637     END-IF.
152100020923
152110020923           MOVE WS-INV-RED-INCEPT  TO AD-RED-INCEPT.
152120061003R13637     IF   WS-INV-RED-INCEPT   IS LESS THAN ZEROES
152130061003  ¦           MOVE "-"  TO  AD-RI-SIGN
152140020923R35540     ELSE
152150021202R35540        MOVE " "  TO  AD-RI-SIGN
152160030317R13637     END-IF.
152170030317
152180030317R14556     MOVE WS-INV-TRI-INCEPT-COST  TO AD-TRI-INCEPT-COST
152190061003           IF WS-INV-TRI-INCEPT-COST    IS LESS THAN ZEROES
152200061003              MOVE "-"                  TO AD-TRI-INCEPT-COST-SIGN
152210030317R35540     ELSE
152220030317R35540        MOVE " "                  TO AD-TRI-INCEPT-COST-SIGN
152230030317           END-IF.
152240030317
152250030317           MOVE WS-INV-TRO-INCEPT-COST  TO AD-TRO-INCEPT-COST
152260061003           IF WS-INV-TRO-INCEPT-COST    IS LESS THAN ZEROES
152270061003              MOVE "-"                  TO AD-TRO-INCEPT-COST-SIGN
152280030317R35540     ELSE
152290030317R35540        MOVE " "                  TO AD-TRO-INCEPT-COST-SIGN
152300021202R14556     END-IF.
152310021202
152320021202R16256     MOVE WS-INV-TRI-INCEPT-MKT   TO AD-TRI-INCEPT-MKT
152330021202   ¦       IF WS-INV-TRI-INCEPT-MKT     IS LESS THAN ZEROES
152340061003   ¦          MOVE "-"                  TO AD-TRI-INCEPT-MKT-SIGN
152350061003R35540     ELSE
152360021202R35540        MOVE " "                  TO AD-TRI-INCEPT-MKT-SIGN
152370021202   ¦       END-IF.
152380021202   ¦
152390021202   ¦       MOVE WS-INV-TRO-INCEPT-MKT   TO AD-TRO-INCEPT-MKT
152400021202   ¦       IF WS-INV-TRO-INCEPT-MKT     IS LESS THAN ZEROES
152410021202   ¦          MOVE "-"                  TO AD-TRO-INCEPT-MKT-SIGN
152420061003R35540     ELSE
152430061003R35540        MOVE " "                  TO AD-TRO-INCEPT-MKT-SIGN
152440021202R16256     END-IF.
152450021202
152460021202R15022     MOVE WS-INV-DISP-GAIN-LOSS-CUR
152470021202                      TO AD-DISP-GAIN-LOSS-CUR
152480021202           IF WS-INV-DISP-GAIN-LOSS-CUR IS LESS THAN ZEROES
152490021202              MOVE "-"             TO AD-DISP-GAIN-LOSS-CUR-SIGN
152500061003R35540     ELSE
152510061003R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-CUR-SIGN
152520021202R15022     END-IF.
152530021202
152540970523R15022     MOVE WS-INV-DISP-GAIN-LOSS-YTD
152550020731                      TO AD-DISP-GAIN-LOSS-YTD
152560020730           IF WS-INV-DISP-GAIN-LOSS-YTD IS LESS THAN ZEROES
152570061003              MOVE "-"             TO AD-DISP-GAIN-LOSS-YTD-SIGN
152580061003R35540     ELSE
152590020731R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-YTD-SIGN
152600020730R15022     END-IF.
152610001006
152620020730R15022     MOVE WS-INV-DISP-GAIN-LOSS-INC
152630970523                      TO AD-DISP-GAIN-LOSS-INCEPT
152640020730           IF WS-INV-DISP-GAIN-LOSS-INC IS LESS THAN ZEROES
152650020730              MOVE "-"             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
152660061003R35540     ELSE
152670061003R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
152680020730R15022     END-IF.
152690020730
152700001006           MOVE WS-INV-TRI-INCEPT  TO AD-TRI-INCEPT.
152710020403R13637     IF   WS-INV-TRI-INCEPT   IS LESS THAN ZEROES
152720020403  ¦           MOVE "-"  TO  AD-TI-SIGN
152730020403R35540     ELSE
152740061003R35540        MOVE " "  TO  AD-TI-SIGN
152750061003R13637     END-IF.
152760020403
152770020403RF7777     MOVE WS-INV-SWI-INCEPT  TO AD-SWI-INCEPT.
152780020403
152790020403           MOVE WS-INV-TRO-INCEPT  TO AD-TRO-INCEPT.
152800061003R13637     IF   WS-INV-TRO-INCEPT   IS LESS THAN ZEROES
152810061003  ¦           MOVE "-"  TO  AD-OI-SIGN
152820020403R35540     ELSE
152830020403R35540        MOVE " "  TO  AD-OI-SIGN
152840020403R13637     END-IF.
152850020403
152860061003RF7777     MOVE WS-INV-SWO-INCEPT  TO AD-SWO-INCEPT.
152870061003
152880020403R13122     IF   WS-INV-RED-INCEPT   IS LESS THAN ZEROES
152890020403  ¦           MOVE "-"  TO  AD-RI-SIGN
152900020403R35540     ELSE
152910020403R35540        MOVE " "  TO  AD-RI-SIGN
152920061003R13122     END-IF.
152930061003
152940020403R13122     IF   WS-INV-RED-CURRENT  IS LESS THAN ZEROES
152950020403  ¦           MOVE "-"  TO  AD-RC-SIGN
152960020403R35540     ELSE
152970020403R35540        MOVE " "  TO  AD-RC-SIGN
152980061003R13122     END-IF.
152990061003
153000020403R13122     IF   WS-INV-CPG-INCEPT   IS LESS THAN ZEROES
153010050830  ¦           MOVE "-"  TO  AD-CI-SIGN
153020081120R35540     ELSE
153030081120R35540        MOVE " "  TO  AD-CI-SIGN
153040081120R13122     END-IF.
153050081120
153060081120R13122     IF   WS-INV-INC-INCEPT   IS LESS THAN ZEROES
153070050830  ¦           MOVE "-"  TO  AD-II-SIGN
153080050830R35540     ELSE
153090011005R35540        MOVE " "  TO  AD-II-SIGN
153100011005R13122     END-IF.
153110011010
153120011010R13122     IF   WS-INV-INT-INCEPT   IS LESS THAN ZEROES
153130011003  ¦           MOVE "-"  TO  AD-NI-SIGN
153140011010R35540     ELSE
153150011102R35540        MOVE " "  TO  AD-NI-SIGN
153160011102R13122     END-IF.
153170011102
153180011102      *RFS 50492 - Begin
153190011102           IF FndFinActivity
153200011102              MOVE lc_FndFinActivity TO AD-Dormant-Fund
153210011010           END-IF.
153220011010      *RFS 50492 - End
153230061003
153240061003
153250011010R11127     SUBTRACT         WS-INV-DISP-PROCEEDS-BASE
153260011010                    FROM    WS-INV-DISP-CDSC-BASE
153270011010                    GIVING             AD-YTD-DISP-PROCEEDS-BASE.
153280011010
153290061003           MOVE WS-INV-DISP-BOOK-VALUE-BASE
153300061003                                   TO  AD-YTD-DISP-BOOK-VALUE-BASE.
153310011010
153320011010R11127     COMPUTE WS-YTD-DISP-GAIN-LOSS-BASE   =
153330011102               WS-INV-DISP-PROCEEDS-BASE - WS-INV-DISP-CDSC-BASE
153340011005                                         - WS-INV-DISP-BOOK-VALUE-BASE.
153350061003           MOVE WS-YTD-DISP-GAIN-LOSS-BASE to
153360061003                                         AD-YTD-DISP-GAIN-LOSS-BASE.
153370011005           IF AD-YTD-DISP-PROCEEDS-BASE    IS LESS THAN ZEROS
153380011005              MOVE "-"             TO  AD-YTD-DISP-PROCEEDS-BASE-S
153390050923R35540     ELSE
153400990304R35540        MOVE " "             TO  AD-YTD-DISP-PROCEEDS-BASE-S
153410990304           END-IF.
153420990305
153430990304           IF AD-YTD-DISP-BOOK-VALUE-BASE  IS LESS THAN ZEROS
153440990305              MOVE "-"             TO  AD-YTD-DISP-BOOK-VALUE-BASE-S
153450990305R35540     ELSE
153460990305R35540        MOVE " "             TO  AD-YTD-DISP-BOOK-VALUE-BASE-S
153470990305           END-IF.
153480990305
153490990305           IF WS-YTD-DISP-GAIN-LOSS-BASE   IS LESS THAN ZEROS
153500990305              MOVE "-"             TO  AD-YTD-DISP-GAIN-LOSS-BASE-S
153510990305R35540     ELSE
153520990315R35540        MOVE " "             TO  AD-YTD-DISP-GAIN-LOSS-BASE-S
153530990315R11127     END-IF.
153540990304
153550021009R29732     IF WS-LDA-MGMT-COM-CDE IS EQUAL TO "IAF"
153560021009
153570021009              MULTIPLY WS-AUG-ACB-PRICE BY WS-AUG-UNIT-BAL
153580021009                       GIVING  WS-AUG-BOOK-VALUE ROUNDED
153590021009
153600021009              INITIALIZE         AD-PUR-INCEPT
153610021009                                 AD-RED-INCEPT
153620021009                                 AD-TRI-INCEPT
153630021009                                 AD-TRO-INCEPT
153640021009                                 AD-CPG-INCEPT
153650021009                                 AD-INC-INCEPT
153660021009                                 AD-INT-INCEPT
153670021009                                 AD-DIVS-INCEPT
153680021009                                 AD-DSP-BOOK-VALUE-P-AUG
153690021009
153700021009               ADD  WS-AUG-BOOK-VALUE     TO WS-AUG-INV-PUR-INCEPT
153710061003               MOVE WS-AUG-INV-PUR-INCEPT TO AD-PUR-INCEPT
153720061003               MOVE WS-AUG-INV-RED-INCEPT TO AD-RED-INCEPT
153730021009               MOVE WS-AUG-INV-TRI-INCEPT TO AD-TRI-INCEPT
153740021009               MOVE WS-AUG-INV-TRO-INCEPT TO AD-TRO-INCEPT
153750021009               MOVE WS-AUG-INV-CPG-INCEPT TO AD-CPG-INCEPT
153760021009               MOVE WS-AUG-INV-INC-INCEPT TO AD-INC-INCEPT
153770061003               MOVE WS-AUG-INV-INT-INCEPT TO AD-INT-INCEPT
153780061003               MOVE WS-P-AUG-BOOK-VALUE   TO AD-DSP-BOOK-VALUE-P-AUG
153790021009               ADD WS-AUG-INV-CPG-INCEPT
153800021009                   WS-AUG-INV-INC-INCEPT
153810021009                   WS-AUG-INV-INT-INCEPT
153820021009                   GIVING AD-DIVS-INCEPT
153830061003R14747                    WS-AD-DIVS-INCEPT
153840061003  ¦
153850021009  ¦            IF WS-AUG-INV-PUR-INCEPT  IS LESS THAN ZEROES
153860021009  ¦               MOVE "-"  TO  AD-PI-SIGN
153870021009R35540         ELSE
153880021009R35540            MOVE " "  TO  AD-PI-SIGN
153890061003  ¦            END-IF
153900061003  ¦
153910021009  ¦            IF WS-AUG-INV-RED-INCEPT     IS LESS THAN ZEROES
153920021009  ¦               MOVE "-"  TO  AD-RI-SIGN
153930021009R35540         ELSE
153940021009R35540            MOVE " "  TO  AD-RI-SIGN
153950061003  ¦            END-IF
153960061003  ¦
153970021009  ¦            IF WS-AUG-INV-TRI-INCEPT    IS LESS THAN ZEROES
153980021009  ¦               MOVE "-"  TO  AD-TI-SIGN
153990021009R35540         ELSE
154000021009R35540            MOVE " "  TO  AD-TI-SIGN
154010061003  ¦            END-IF
154020061003  ¦
154030021009  ¦            IF WS-AUG-INV-TRO-INCEPT   IS LESS THAN ZEROES
154040021009  ¦               MOVE "-"  TO  AD-OI-SIGN
154050021009R35540         ELSE
154060021009R35540            MOVE " "  TO  AD-OI-SIGN
154070061003  ¦            END-IF
154080061003  ¦
154090021009  ¦            IF WS-AUG-INV-CPG-INCEPT   IS LESS THAN ZEROES
154100021009  ¦               MOVE "-"  TO  AD-CI-SIGN
154110021009R35540         ELSE
154120021009R35540            MOVE " "  TO  AD-CI-SIGN
154130061003  ¦            END-IF
154140061003  ¦
154150021009  ¦            IF WS-AUG-INV-INC-INCEPT    IS LESS THAN ZEROES
154160021009  ¦               MOVE "-"  TO  AD-II-SIGN
154170021009R35540         ELSE
154180021009R35540            MOVE " "  TO  AD-II-SIGN
154190061003  ¦            END-IF
154200061003  ¦
154210021009  ¦            IF WS-AUG-INV-INT-INCEPT   IS LESS THAN ZEROES
154220021009  ¦               MOVE "-"  TO  AD-NI-SIGN
154230021009R35540         ELSE
154240000000R35540            MOVE " "  TO  AD-NI-SIGN
154250030826  ¦            END-IF
154260030826  ¦
154270061003  ¦            IF WS-P-AUG-BOOK-VALUE    IS LESS THAN ZEROES
154280061003  ¦               MOVE "-"  TO  AD-DSP-BOOK-VALUE-P-AUG-SIGN
154290030826R35540         ELSE
154300030826R35540            MOVE " "  TO  AD-DSP-BOOK-VALUE-P-AUG-SIGN
154310000000  ¦            END-IF
154320030826  ¦
154330030826  ¦            IF WS-AD-DIVS-INCEPT   IS LESS THAN ZEROES
154340030826  ¦               MOVE "-"  TO  AD-DI-SIGN
154350061003R35540         ELSE
154360061003R35540            MOVE " "  TO  AD-DI-SIGN
154370030826  ¦            END-IF
154380981222R14747     END-IF.
154390030624
154400030624           MOVE WS-INV-REG-CTB-CUR     TO  AD-REG-CTB-CUR.
154410030624           IF  WS-INV-REG-CTB-CUR < ZEROES
154420061003               MOVE "-"                TO  AD-REG-CTB-CUR-SIGN
154430061003R35540     ELSE
154440030624R35540         MOVE " "                TO  AD-REG-CTB-CUR-SIGN
154450030624           END-IF.
154460030826
154470030624           MOVE WS-INV-REG-CTB-INCPT   TO  AD-REG-CTB-INCPT.
154480030624
154490061003           IF  WS-INV-REG-CTB-INCPT < ZEROES
154500061003               MOVE "-"                TO  AD-REG-CTB-INCPT-SIGN
154510030624R35540     ELSE
154520030624R35540         MOVE " "                TO  AD-REG-CTB-INCPT-SIGN
154530030624           END-IF.
154540030624
154550030624R16881     MOVE WS-INV-TRI-INCEPT-PH    TO AD-TRI-INCEPT-PHANTOM.
154560061003   ¦       IF WS-INV-TRI-INCEPT-PH      IS LESS THAN ZEROES
154570061003   ¦          MOVE "-"                  TO AD-TRI-INCEPT-PHANTOM-SIGN
154580030624R35540     ELSE
154590030624R35540        MOVE " "                  TO AD-TRI-INCEPT-PHANTOM-SIGN
154600030624   ¦       END-IF.
154610030624   ¦
154620030624   ¦       MOVE WS-INV-TRI-YTD-PH       TO AD-TRI-YTD-PHANTOM.
154630061003   ¦       IF WS-INV-TRI-YTD-PH         IS LESS THAN ZEROES
154640061003   ¦          MOVE "-"                  TO AD-TRI-YTD-PHANTOM-SIGN
154650030624R35540     ELSE
154660030624R35540        MOVE " "                  TO AD-TRI-YTD-PHANTOM-SIGN
154670030624   ¦       END-IF.
154680030624   ¦
154690030624   ¦       MOVE WS-INV-TRI-CUR-PH       TO AD-TRI-CUR-PHANTOM.
154700061003   ¦       IF WS-INV-TRI-CUR-PH         IS LESS THAN ZEROES
154710061003   ¦          MOVE "-"                  TO AD-TRI-CUR-PHANTOM-SIGN
154720030624R35540     ELSE
154730030624R35540        MOVE " "                  TO AD-TRI-CUR-PHANTOM-SIGN
154740030624   ¦       END-IF.
154750030624   ¦
154760030624   ¦       MOVE WS-INV-TRO-INCEPT-PH    TO AD-TRO-INCEPT-PHANTOM.
154770061003   ¦       IF WS-INV-TRO-INCEPT-PH      IS LESS THAN ZEROES
154780061003   ¦          MOVE "-"                  TO AD-TRO-INCEPT-PHANTOM-SIGN
154790030624R35540     ELSE
154800030624R35540        MOVE " "                  TO AD-TRO-INCEPT-PHANTOM-SIGN
154810990517   ¦       END-IF.
154820990517   ¦
154830990517   ¦       MOVE WS-INV-TRO-YTD-PH       TO AD-TRO-YTD-PHANTOM
154840990126   ¦       IF WS-INV-TRO-YTD-PH         IS LESS THAN ZEROES
154850981222   ¦          MOVE "-"                  TO AD-TRO-YTD-PHANTOM-SIGN
154860990126R35540     ELSE
154870981222R35540        MOVE " "                  TO AD-TRO-YTD-PHANTOM-SIGN
154880031114   ¦       END-IF.
154890031114   ¦
154900990126   ¦       MOVE WS-INV-TRO-CUR-PH       TO AD-TRO-CUR-PHANTOM.
154910990126   ¦       IF WS-INV-TRO-CUR-PH         IS LESS THAN ZEROES
154920990126   v          MOVE "-"                  TO AD-TRO-CUR-PHANTOM-SIGN
154930161107R35540     ELSE
154940990126R35540        MOVE " "                  TO AD-TRO-CUR-PHANTOM-SIGN
154950990126R16881     END-IF.
154960990620
154970990620      ***
154980001228      ***  GET INVESTMENT GROUP CATEGORY AND DESCRIPTION INFO.
154990001228      ***
155000990619      ************************************************************
155010990619      ** ADD INVESTMENT FINANCIAL TOTALS TO ACCOUNT TOTALS.     **
155020021004      ************************************************************
155030021004
155040021004R18312     ADD WS-INV-BUY-CURRENT      TO  WS-ACC-BUY-CURRENT.
155050021004R18312     ADD WS-INV-SEL-CURRENT      TO  WS-ACC-SEL-CURRENT.
155060021004           ADD WS-INV-CPG-CURRENT      TO  WS-ACC-CPG-CURRENT.
155070021004           ADD WS-INV-INC-CURRENT      TO  WS-ACC-INC-CURRENT.
155080040414           ADD WS-INV-INT-CURRENT      TO  WS-ACC-INT-CURRENT.
155090040414164313     PERFORM DISTRIBUTION-ACCTOT-LEVEL THRU DAL-EXIT.
155100040414           ADD WS-INV-PUR-CURRENT      TO  WS-ACC-PUR-CURRENT.
155110161208           ADD WS-INV-RED-CURRENT      TO  WS-ACC-RED-CURRENT.
155120050914           ADD WS-INV-TRI-CURRENT      TO  WS-ACC-TRI-CURRENT.
155130061103           ADD WS-INV-TRO-CURRENT      TO  WS-ACC-TRO-CURRENT.
155140050921RF8673     ADD WS-INV-SWI-CURRENT      TO  WS-ACC-SWI-CURRENT.
155150050914           ADD WS-INV-SWO-CURRENT      TO  WS-ACC-SWO-CURRENT.
155160050914           ADD WS-INV-REG-CTB-CUR      TO  WS-ACC-REG-CTB-CUR.
155170050914           ADD WS-INV-REG-CTB-INCPT    TO  WS-ACC-REG-CTB-INCPT.
155180050914R14858     ADD WS-INV-BAJ-CUR          TO  WS-ACC-BAJ-CUR.
155190050914  ¦        ADD WS-INV-BAJ-YTD          TO  WS-ACC-BAJ-YTD.
155200050914  ¦        ADD WS-INV-BAJ-INCEPT       TO  WS-ACC-BAJ-INCEPT.
155210050921  ¦        ADD WS-INV-BFW-CUR          TO  WS-ACC-BFW-CUR.
155220061024  ¦        ADD WS-INV-BFW-YTD          TO  WS-ACC-BFW-YTD.
155230061101R14858     ADD WS-INV-BFW-INCEPT       TO  WS-ACC-BFW-INCEPT.
155240061101R20758     ADD WS-INV-ROC-CUR          TO  WS-ACC-ROC-CUR.
155250061101  ¦        ADD WS-INV-ROC-YTD          TO  WS-ACC-ROC-YTD.
155260061101R20758     ADD WS-INV-ROC-INCEPT       TO  WS-ACC-ROC-INCEPT.
155270061101164374     ADD WS-INV-SAJ-INCEPT       TO  WS-ACC-SAJ-INCEPT.
155280061101
155290061101R36342     IF lb-LdaAccountAdditionalInfoYes
155300061101  ¦        ADD WS-INV-PURCH-LAST-12-MONTHS TO
155310061101  ¦                   WS-ACC-PURCH-LAST-12-MONTHS
155320061101  ¦        ADD WS-INV-REDEM-LAST-12-MONTHS TO
155330061101  ¦                   WS-ACC-REDEM-LAST-12-MONTHS
155340061101  ¦        ADD WS-INV-TRI-LAST-12-MONTHS TO
155350061101  ¦                   WS-ACC-TRI-LAST-12-MONTHS
155360061101  ¦        ADD WS-INV-TRO-LAST-12-MONTHS TO
155370061101  ¦                   WS-ACC-TRO-LAST-12-MONTHS
155380061101      *RFS36342 - Starts
155390061101              COMPUTE ln_AccCurrDispProceedsBase   ROUNDED =
155400061101                      ln_AccCurrDispProceedsBase +
155410061101                      ln_InvCurrDispProceedsBase
155420061101              COMPUTE ln_AccCurrDispBookValueBase  ROUNDED =
155430061101                      ln_AccCurrDispBookValueBase +
155440061024                      ln_InvCurrDispBookValueBase
155450081027              COMPUTE ln_AccCurrDispGainLossBase   ROUNDED =
155460081027                      ln_AccCurrDispGainLossBase +
155470081027                      ln_InvCurrDispGainLossBase
155480081027              COMPUTE ln_AccGrossSoldYtdBase       ROUNDED =
155490081027                      ln_AccGrossSoldYtdBase +
155500081027                      ln_InvGrossSoldYtdBase
155510050921              COMPUTE ln_AccGrossSoldCurrBase      ROUNDED =
155520990619                      ln_AccGrossSoldCurrBase +
155530990619                      ln_InvGrossSoldCurrBase
155540990619              COMPUTE ln_AccDeductionsCdscYtdBase  ROUNDED =
155550990619                      ln_AccDeductionsCdscYtdBase +
155560990619                      ln_InvDeductionsCdscYtdBase
155570990620              COMPUTE ln_AccDeductionsCdscCurrBase ROUNDED =
155580990620                      ln_AccDeductionsCdscCurrBase +
155590001228                      ln_InvDeductionsCdscCurrBase
155600001228      *RFS36342 - Ends
155610990619R59263       If  WS-INV-GMA-VALUE-EX = 0
155620990619R59263           ADD WS-INV-GMA-VALUE      TO WS-ACC-GMA-VALUE
155630990619R59263          ELSE
155640970423R59263           ADD WS-INV-GMA-VALUE-EX   TO WS-ACC-GMA-VALUE-EX
155650970423R59263           ADD WS-INV-GMA-VALUE      TO WS-ACC-GMA-VALUE-US
155660970423R59263       End-If
155670970423R28931     END-IF.
155680981222           ADD WS-INV-CPG-CURRENT-EX   TO  WS-ACC-CPG-CURRENT-EX.
155690981222           ADD WS-INV-INC-CURRENT-EX   TO  WS-ACC-INC-CURRENT-EX.
155700160928           ADD WS-INV-INT-CURRENT-EX   TO  WS-ACC-INT-CURRENT-EX.
155710981222           ADD WS-INV-PUR-CURRENT-EX   TO  WS-ACC-PUR-CURRENT-EX.
155720970526           ADD WS-INV-RED-CURRENT-EX   TO  WS-ACC-RED-CURRENT-EX.
155730020731           ADD WS-INV-TRI-CURRENT-EX   TO  WS-ACC-TRI-CURRENT-EX.
155740020731           ADD WS-INV-TRO-CURRENT-EX   TO  WS-ACC-TRO-CURRENT-EX.
155750970705RF8673     ADD WS-INV-SWI-CURRENT-EX   TO  WS-ACC-SWI-CURRENT-EX.
155760970705           ADD WS-INV-SWO-CURRENT-EX   TO  WS-ACC-SWO-CURRENT-EX.
155770020731           ADD WS-INV-REG-CTB-CUR-EX   TO  WS-ACC-REG-CTB-CUR-EX.
155780971223           ADD WS-INV-REG-CTB-INCPT-EX TO  WS-ACC-REG-CTB-INCPT-EX.
155790971223
155800971223           ADD WS-INV-NRTAX-CUR        TO  WS-ACC-NRTAX-CUR.
155810061003           ADD WS-INV-NRTAX-INC        TO  WS-ACC-NRTAX-INC.
155820061003           ADD WS-INV-WHTAX-CUR        TO  WS-ACC-WHTAX-CUR.
155830030826           ADD WS-INV-WHTAX-INC        TO  WS-ACC-WHTAX-INC.
155840990126           ADD WS-INV-TINCOME-PRV      TO  WS-ACC-TINCOME-PRV.
155850980604           ADD WS-INV-WHTAX-PRV        TO  WS-ACC-WHTAX-PRV.
155860990304162904     ADD ln_YTDTrailer           TO  ln_Inv-TRL-AMT.
155870990126
155880990126           MOVE WS-TXNS-IN-RANGE TO AD-TXNS-ON-STATEMENT.
155890030826
155900061003           DIVIDE AD-LAST-UNIT-PRICE   BY  WS-CC-RTECLS (CC)
155910061003                                   GIVING  AD-LAST-UNIT-PRICE-BASE
155920030826                                           ROUNDED.
155930990126
155940990126           MOVE WS-INV-CPG             TO  AD-CPG-FIXED.
155950990126           IF  WS-INV-CPG    IS LESS THAN  ZEROES
155960030826               MOVE "-"                TO  AD-CPG-FIXED-SIGN
155970061003R35540     ELSE
155980061003R35540         MOVE " "                TO  AD-CPG-FIXED-SIGN
155990030826           END-IF.
156000990126           MOVE WS-IC-FRGN(IC)         TO  AD-CONSTITUTE-FOREIGN.
156010990126           MOVE WS-INVAUC-SW           TO  AD-INVALID-AVERAGE-COST.
156020990127
156030030826           MOVE WS-UNITS-BOUGHT        TO  AD-UNITS-BOUGHT-LTD.
156040061003           IF WS-UNITS-BOUGHT IS LESS THAN ZERO
156050061003              MOVE "-"                 TO AD-UNITS-BOUGHT-LTD-SIGN
156060030826R35540     ELSE
156070990126R35540        MOVE " "                 TO AD-UNITS-BOUGHT-LTD-SIGN
156080050923           END-IF.
156090990304
156100990304           MOVE WS-UNITS-SOLD          TO  AD-UNITS-SOLD-LTD.
156110990304           IF WS-UNITS-SOLD IS LESS THAN ZERO
156120990304              MOVE "-"                 TO AD-UNITS-SOLD-LTD-SIGN
156130990304R35540     ELSE
156140990304R35540        MOVE " "                 TO AD-UNITS-SOLD-LTD-SIGN
156150990304           END-IF.
156160990304
156170990304           MOVE WS-UNITS-DIV           TO  AD-UNITS-DIV-LTD.
156180990304           IF WS-UNITS-DIV IS LESS THAN ZERO
156190990304              MOVE "-"                 TO AD-UNITS-DIV-LTD-SIGN
156200061003R35540     ELSE
156210061003R35540        MOVE " "                 TO AD-UNITS-DIV-LTD-SIGN
156220990304           END-IF.
156230990304
156240990715R29732     IF WS-LDA-MGMT-COM-CDE IS EQUAL TO "IAF"
156250990715              INITIALIZE          AD-UNITS-BOUGHT-LTD
156260990304                                  AD-UNITS-BOUGHT-LTD-SIGN
156270061003                                  AD-UNITS-SOLD-LTD
156280061003                                  AD-UNITS-SOLD-LTD-SIGN
156290990304                                  AD-UNITS-DIV-LTD
156300990304                                  AD-UNITS-DIV-LTD-SIGN
156310990715
156320990715              ADD  WS-AUG-UNIT-BAL       TO WS-AUG-UNITS-BOUGHT
156330990304              MOVE WS-AUG-UNITS-BOUGHT   TO AD-UNITS-BOUGHT-LTD
156340061003              IF   WS-AUG-UNITS-BOUGHT IS LESS THAN ZERO
156350061003                MOVE "-"     TO AD-UNITS-BOUGHT-LTD-SIGN
156360990304R35540        ELSE
156370990305R35540          MOVE " "     TO AD-UNITS-BOUGHT-LTD-SIGN
156380990305              END-IF
156390020131
156400020131              MOVE WS-AUG-UNITS-SOLD     TO AD-UNITS-SOLD-LTD
156410020321              IF WS-AUG-UNITS-SOLD IS LESS THAN ZERO
156420980519                MOVE "-"                 TO AD-UNITS-SOLD-LTD-SIGN
156430070912R35540        ELSE
156440070912R35540          MOVE " "                 TO AD-UNITS-SOLD-LTD-SIGN
156450070912              END-IF
156460070912
156470070912              MOVE WS-AUG-UNITS-DIV      TO  AD-UNITS-DIV-LTD
156480070913              IF WS-AUG-UNITS-DIV IS LESS THAN ZERO
156490070913                MOVE "-"                 TO AD-UNITS-DIV-LTD-SIGN
156500070912R35540        ELSE
156510070912R35540          MOVE " "                 TO AD-UNITS-DIV-LTD-SIGN
156520070913              END-IF
156530070913           END-IF.
156540070913
156550070913R12102     MOVE WS-AD-PHANTOM-FUND-NUMBER  TO AD-PHANTOM-FUND-NUMBER.
156560070913
156570070913           MOVE WS-PREV-START-DATE        TO  AD-START-DATE.
156580070913           MOVE PREV-END-DATE          TO  AD-END-DATE.
156590070912
156600070912      * RFS 39466 Begin
156610070912
156620070912           If lc_SegSysMat = lncc_Yes
156630070912
156640070912             Move zeros to ln-Ad-AccCrtDt
156650070913             Move AD-ACCOUNT to ln-Ad-SavAcct
156660070912             Move 'N'       to  AD-APP-RECEIVED
156670070912             Move Zero      to  lc-NOAPP-Cnt
156680070912
156690070913             EXEC SQL
156700070913                  SELECT CREATION_DATE
156710070912                  INTO :ln-Ad-AccCrtDt
156720070912                  FROM MFAACCNTP
156730070912                  WHERE ACCOUNT_NO = :ln-Ad-SavAcct
156740070912             END-EXEC
156750070912
156760070912             EXEC SQL
156770070912                  SELECT COUNT(*)
156780070912                  INTO :lc-NOAPP-Cnt
156790070912                  FROM MFAACCATP
156800000814                  WHERE ACCOUNT_ATTRIBUTE_CODE = :lncc_NOAPP AND
156810031003                        ACCOUNT_NO = :ln-Ad-SavAcct
156820031003             END-EXEC
156830031003
156840031003             If lc-NOAPP-Cnt > 0
156850970526               If (ln-Ad-AccCrtDt >= AD-START-DATE and
156860970531                   ln-Ad-AccCrtDt <= AD-END-DATE)
156870970531                   Move 'N'    to  AD-APP-RECEIVED
156880970531               Else
156890970531                   Move 'Y'    to  AD-APP-RECEIVED
156900140719               End-If
156910140714             Else
156920970531                Move 'Y'    to  AD-APP-RECEIVED
156930970531             End-If
156940140714           End-If.
156950061103      * RFS 39466 End
156960050915
156970160613R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
156980160613   ¦          MOVE WS-IPS-GROUP-ID     TO AD-IPS-GROUP-ID
156990160613R17527     END-IF.
157000160613
157010050915           IF  WS-AD-LST IS NOT LESS THAN  WS-AD-MAX
157020050915               GO TO LS1-0020-0010.
157030050915
157040050915           ADD 1                       TO  WS-AD-LST.
157050050915           SET AD                      TO  WS-AD-LST.
157060050915           INITIALIZE ln_MktValueBase.
157070050915132121     MOVE AD-MARKET-VALUE-BASE   TO  ln_MktValueBase.
157080050915           MOVE ACCOUNT-DETAILS-SECTION
157090050915                                       TO  WS-AD-RECD (AD).
157100050915132121     PERFORM GET-MKT-VALUE.
157110050915R36342     IF lb-LdaAccountAdditionalInfoYes
157120050915  ¦        MOVE AD-INVESTOR-NO       TO AAI-INVESTOR-NO
157130081027156335     MOVE WS-EXT-LOAD-TYP      TO AAI-INVESTMENT-EXT-LOAD-TYPE
157140081027156335     MOVE WS-EXT-LOAD-DESC     TO AAI-INVESTMENT-EXT-LOAD-DESC
157150081027156335     MOVE WS-ASSET-CLASS-CD   TO AAI-ASSET-CLASS-CODE
157160081027156335     MOVE WS-ASSET-CLASS-DESC  TO AAI-ASSET-CLASS-DESCRIPTION
157170081027  ¦        MOVE AD-ACCOUNT           TO AAI-ACCOUNT
157180081027  ¦        MOVE 21                   TO AAI-SECTION-NO
157190081027  ¦        MOVE AD-SECTION-SEQUENCE  TO AAI-SECTION-SEQUENCE
157200081027  ¦        MOVE AD-LANGUAGE          TO AAI-LANGUAGE
157210081027  ¦        MOVE AD-DEALER            TO AAI-DEALER
157220081027  ¦        MOVE AD-SALESREP          TO AAI-SALESREP
157230081027  ¦        MOVE AD-ACCOUNT-TYPE-SHORT TO AAI-ACCOUNT-TYPE-SHORT
157240081027  ¦        MOVE AD-ACCOUNT-TYPE       TO AAI-ACCOUNT-TYPE
157250081027  ¦        MOVE AD-INVESTMENT-NAME    TO AAI-INVESTMENT-NAME
157260080930  ¦        MOVE AD-START-DATE         TO AAI-START-DATE
157270080930  ¦        MOVE AD-END-DATE           TO AAI-END-DATE
157280080930  ¦        MOVE AD-EOR-INDICATOR      TO AAI-EOR-INDICATOR
157290080930R50823     MOVE AD-SECTION-SEQUENCE-2 TO AAI-SECTION-SEQUENCE-2
157300081120R59263     If WS-INV-GMA-VALUE-EX = 0
157310081120R59263        MOVE WS-INV-GMA-VALUE      TO AAI-GMA-VALUE
157320081120R59263        IF WS-INV-GMA-VALUE        IS  LESS THAN ZEROS
157330081120R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
157340081120R59263        END-IF
157350151205R59263       ELSE
157360151222R59263        MOVE WS-INV-GMA-VALUE-EX   TO AAI-GMA-VALUE
157370151223R59263        IF WS-INV-GMA-VALUE-ex     IS  LESS THAN ZEROS
157380151223R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
157390151223R59263        END-IF
157400151218R59263     END-IF
157410160127R50823     MOVE Ln-MGAClosingDate     TO AAI-GMP-CLOSING-DATE
157420160229  |        MOVE Ln-UnitPrice          TO AAI-GMP-PRICE
157430120315  |        IF Ln-UnitPrice            IS  LESS THAN ZEROS
157440120315  V           MOVE "-"                TO AAI-GMP-PRICE-SIGN
157450120315R50823     END-IF
157460120315      *RFS 50492 - Begin
157470120315           IF FndFinActivity
157480120315              MOVE lc_FndFinActivity TO AAI-Dormant-Fund
157490120315           END-IF
157500120315      *RFS 50492 - End
157510120315151145     MOVE lc_CrossRefNumber     TO AAI-CROSS-REF-NUMBER
157520120315      *RFS147795 Starts
157530120315           MOVE ln_YTDTrailer         TO AAI-YTD-TRAILER
157540120315           IF ln_YTDTrailer  IS LESS THAN ZERO
157550120315              MOVE "-"                TO AAI-YTD-TRAILER-SIGN
157560120315           END-IF
157570050915      *RFS147795 End
157580050915148326     PERFORM RETRIEVE-AAI-ORIG-COST-INV THRU RAOCI-EXIT
157590050915102716     MOVE WS-INV-CPG-YTD        TO AAI-CPG-YTD
157600050915  |        IF WS-INV-CPG-YTD IS LESS THAN ZERO
157610050915  |           MOVE "-"                TO AAI-CPG-YTD-SIGN
157620130614  |        END-IF
157630130614  |
157640130614  |        MOVE WS-INV-INC-YTD        TO AAI-INC-YTD
157650130614  |        IF WS-INV-INC-YTD IS LESS THAN ZERO
157660970531  |           MOVE "-"                TO AAI-INC-YTD-SIGN
157670970531  |        END-IF
157680031003  |
157690031003  |        MOVE WS-INV-INT-YTD        TO AAI-INT-YTD
157700031003  |        IF WS-INV-INT-YTD IS LESS THAN ZERO
157710970531  V           MOVE "-"                TO AAI-INT-YTD-SIGN
157720970531102716     END-IF
157730970531  ¦
157740060621  ¦          MOVE ACCOUNT-ADDITIONAL-INFO  TO STATEMENT-REC(ISR)
157750030825  ¦          PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
157760061103  ¦        INITIALIZE ACCOUNT-ADDITIONAL-INFO
157770050914R28931     END-IF.
157771210917      *RFS186199 Starts*
157772210917           IF lncc-LdaFundLongDescYes
157773210917              PERFORM FUND-LONG-DESC-83  THRU FLDSC-EXIT
157774210917              MOVE FUND-LONG-DESC-SECTION TO STATEMENT-REC(ISR)
157775210917              PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
157776210917           END-IF.
157777210917      *RFS186199 Ends*
157780160614117038     If lncc-Section22Yes
157790160614117038        and lc_Section80 = "Y"
157800160614117038        Perform Section-22-Creation
157810160614117038     End-If.
157820050914           GO TO LS1-0020-0020.
157830050914       LS1-0020-0010.
157840050914R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
157850050914   ¦          MOVE WS-IPS-GROUP-ID     TO AD-IPS-GROUP-ID
157860050914R17527     END-IF.
157870050914           DISPLAY "INVESTMENTS FOR ACCOUNT "
157880050914                   PREV-ACCOUNT
157890050914                   " EXCEED PROGRAM MAXIMUM".
157900050914R18147     MOVE ACCOUNT-DETAILS-SECTION TO STATEMENT-REC(ISR).
157910050914R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
157920050914R36342     IF lb-LdaAccountAdditionalInfoYes
157930050914  ¦        MOVE AD-INVESTOR-NO       TO AAI-INVESTOR-NO
157940081027156335     MOVE WS-EXT-LOAD-TYP      TO AAI-INVESTMENT-EXT-LOAD-TYPE
157950081027156335     MOVE WS-EXT-LOAD-DESC     TO AAI-INVESTMENT-EXT-LOAD-DESC
157960081027156335     MOVE WS-ASSET-CLASS-CD   TO AAI-ASSET-CLASS-CODE
157970081027156335     MOVE WS-ASSET-CLASS-DESC  TO AAI-ASSET-CLASS-DESCRIPTION
157980081027  ¦        MOVE AD-ACCOUNT           TO AAI-ACCOUNT
157990081027  ¦        MOVE 21                   TO AAI-SECTION-NO
158000081027  ¦        MOVE AD-SECTION-SEQUENCE  TO AAI-SECTION-SEQUENCE
158010081027  ¦        MOVE AD-LANGUAGE          TO AAI-LANGUAGE
158020081027  ¦        MOVE AD-DEALER            TO AAI-DEALER
158030081027  ¦        MOVE AD-SALESREP          TO AAI-SALESREP
158040081027  ¦        MOVE AD-ACCOUNT-TYPE-SHORT TO AAI-ACCOUNT-TYPE-SHORT
158050081027  ¦        MOVE AD-ACCOUNT-TYPE       TO AAI-ACCOUNT-TYPE
158060081027  ¦        MOVE AD-INVESTMENT-NAME    TO AAI-INVESTMENT-NAME
158070080930  ¦        MOVE AD-START-DATE         TO AAI-START-DATE
158080080930  ¦        MOVE AD-END-DATE           TO AAI-END-DATE
158090080930  ¦        MOVE AD-EOR-INDICATOR      TO AAI-EOR-INDICATOR
158100080930R50823     MOVE AD-SECTION-SEQUENCE-2 TO AAI-SECTION-SEQUENCE-2
158110081120R59263     If WS-INV-GMA-VALUE-EX = 0
158120081120R59263        MOVE WS-INV-GMA-VALUE      TO AAI-GMA-VALUE
158130081120R59263        IF WS-INV-GMA-VALUE        IS  LESS THAN ZEROS
158140081202R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
158150081120R59263        END-IF
158160151205R59263       ELSE
158170160127R59263        MOVE WS-INV-GMA-VALUE-EX   TO AAI-GMA-VALUE
158180160127R59263        IF WS-INV-GMA-VALUE-ex     IS  LESS THAN ZEROS
158190151223R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
158200151223R59263        END-IF
158210160127R59263     END-IF
158220151218R50823     MOVE Ln-MGAClosingDate     TO AAI-GMP-CLOSING-DATE
158230160301  |        MOVE Ln-UnitPrice          TO AAI-GMP-PRICE
158240160301  |        IF Ln-UnitPrice            IS  LESS THAN ZEROS
158250120315  V           MOVE "-"                TO AAI-GMP-PRICE-SIGN
158260120315R50823     END-IF
158270120315      *RFS 50492 - Begin
158280120315           IF FndFinActivity
158290120315              MOVE lc_FndFinActivity TO AAI-Dormant-Fund
158300120315           END-IF
158310120315      *RFS 50492 - End
158320120315151145     MOVE lc_CrossRefNumber     TO AAI-CROSS-REF-NUMBER
158330120315      *RFS147795 Starts
158340120315           MOVE ln_YTDTrailer         TO AAI-YTD-TRAILER
158350120315           IF ln_YTDTrailer  IS LESS THAN ZERO
158360120315              MOVE "-"                TO AAI-YTD-TRAILER-SIGN
158370120315           END-IF
158380050914      *RFS147795 End
158390050914148326     PERFORM RETRIEVE-AAI-ORIG-COST-INV THRU RAOCI-EXIT
158400050914 02716     MOVE WS-INV-CPG-YTD        TO AAI-CPG-YTD
158410080925  |        IF WS-INV-CPG-YTD IS LESS THAN ZERO
158420050914  |           MOVE "-"                TO AAI-CPG-YTD-SIGN
158430130614  |        END-IF
158440130614  |
158450130614  |        MOVE WS-INV-INC-YTD        TO AAI-INC-YTD
158460130614  |        IF WS-INV-INC-YTD IS LESS THAN ZERO
158470970531  |           MOVE "-"                TO AAI-INC-YTD-SIGN
158480000000  |        END-IF
158490031015  |
158500031015  |        MOVE WS-INV-INT-YTD        TO AAI-INT-YTD
158510031015  |        IF WS-INV-INT-YTD IS LESS THAN ZERO
158520031015  V           MOVE "-"                TO AAI-INT-YTD-SIGN
158530031202102716     END-IF
158540031015  ¦
158550031015  ¦          MOVE ACCOUNT-ADDITIONAL-INFO  TO STATEMENT-REC(ISR)
158560031015  ¦          PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
158570031015R50823       INITIALIZE ACCOUNT-ADDITIONAL-INFO
158580031015R28931     END-IF.
158590031015117038     If lncc-Section22Yes
158600031015117038        and lc_Section80 = "Y"
158610031015117038        Perform Section-22-Creation
158620031015117038     End-If.
158630031015       LS1-0020-0020.
158640031015           MOVE "Y"          TO WS-WRITE-ACCOUNT-LEVEL.
158650031015R18682***
158660031015   ¦  ***  Generate IPS fields.
158670031015   ¦  ***
158680031015   ¦       IF WS-LDA-IPS-STMT          IS NOT EQUAL TO "Y"
158690031015R19521     OR WS-LDA-STMT-CNFM-FLAG = "C"
158700031015   ¦          GO TO LS1-0020-0025
158710031015   ¦       END-IF.
158720031015   ¦
158730031015   ¦       INITIALIZE                  CPYALOCCAL-LINKAGE.
158740000823   ¦       MOVE "ANNST"                TO  ALOC-CALLED-BY.
158750000823   ¦       MOVE WS-PREV-START-DATE     TO  ALOC-START-DATE.
158760000823   ¦       MOVE PREV-END-DATE          TO  ALOC-END-DATE.
158770000824   ¦       MOVE "ALOC"                 TO  ALOC-DISTR-METHOD.
158780051020   ¦       MOVE AD-ACCOUNT             TO  ALOC-ACCOUNT-NO.
158790000901   ¦       MOVE PREV-INVESTMENT        TO  ALOC-INVESTMENT.
158800991126   ¦
158810991126   ¦       PERFORM GET-GAIN-LOSS-ACCRUED       THRU GGLA-EXIT.
158820991126   ¦
158830991126   ¦       ADD ALOC-CPTL-GAIN          TO WS-ACC-REALIZED-GAIN.
158840991126   ¦       ADD ALOC-ACCR-INCOME        TO WS-ACC-ACCRUED-INC.
158850991126   ¦       ADD ALOC-FGN-WTHLDNG        TO WS-ACC-WTHLDNG-TAX.
158860991126   ¦       ADD ALOC-CDN-DIVDND
158870031216   ¦           ALOC-FGN-DIVDND         TO WS-ACC-DIVIDENDS.
158880031216   v       ADD ALOC-CDN-INTRST
158890031216R18682         ALOC-FGN-INTRST         TO WS-ACC-INTERESTS.
158900031216      ***
158910040329      ***  Generate Account-GIC-Details records if required.
158920040329      ***
158930040329RF6697 LS1-0020-0025.
158940031216R30514     GO TO LS1-0020-0030.
158950040329      **************************************************************
158960040329RF5148 LS1-0020-0030.
158970040329      ***
158980031216      ***  Generate Account-Fund-Performance records if required.
158990031216      ***
159000031216           IF WS-LDA-FUND-ROR                   IS NOT EQUAL TO  "Y"
159010031216              GO TO LS1-0020-0040
159020031216           END-IF
159030031216           IF WS-LDA-REQUEST-SCOPE  = "B" AND
159040040329              WS-LDA-STMT-CNFM-FLAG = "S" AND
159050040329              WS-LDA-STATEMENT-TYPE = "A" AND
159060040329              AD-ACCOUNT NOT = ACCOUNT-NO OF STMT-PRINT-REQ-REC
159070031216      * RFS21596 Start
159080031216              MOVE PREV-END-DATE TO WS-TMP-ENDDTE
159090031216      * RFS21596 End
159100031216           ELSE
159110031216      * RFS21596 Start
159120031216              MOVE WS-LDA-ENDDTE TO WS-TMP-ENDDTE
159130031216      * RFS21596 End
159140031216           END-IF.
159150031216R18814     MOVE "35"                     TO WS-SECTION-NO-ROR
159160031216  ¦        MOVE SPACES                 TO  WS-IPS-GROUP-ID-ACC
159170031230           CALL "STMTROR" USING
159180031230                          WS-IPS-GROUP-ID-ACC
159190170217                          AD-ACCOUNT
159200170217      * RFS21596 Start
159210170217                          WS-TMP-ENDDTE
159220170217      * RFS21596 End
159230170217                          PREV-INVESTMENT
159240031008                          AD-INVESTOR-NO
159250031008                          WS-SECTION-NO-ROR
159260031008                          AD-LANGUAGE
159270031008                          AD-DEALER
159280031008                          AD-SALESREP
159290031015                          AD-FUND-NO
159300031008                          AD-INVESTMENT-NAME
159310031008                          WS-QRTEND-TBL
159320031008                          AD-START-DATE
159330031216                          AD-END-DATE
159340031216   ¦                      WS-QRT-LST
159350031216      * RFS164528 - Start
159360031216R18814*                   WS-PROGRAM-NAME.
159370031216                          WS-PROGRAM-NAME
159380040329                          LC-LDASECTION31.
159390040329      * RFS164528 - End
159400040329      ***
159410031216      ***  Generate Account-Fund-ROR-FRQ-Section(38). if required.
159420031216      ***
159430031216R17626     IF WS-LDA-FUND-ROR-FRQ               IS NOT EQUAL TO  "Y"
159440031216   ¦          GO TO LS1-0020-0040
159450031216   v       END-IF.
159460031216           IF  WS-QRT-LST IS = ZEROES
159470031216                 GO TO LS1-0020-0040
159480031216           END-IF.
159490031216R18814     MOVE "38"                     TO WS-SECTION-NO-ROR
159500031216   ¦       MOVE SPACES                 TO  WS-IPS-GROUP-ID-ACC
159510031216           CALL "STMTROR" USING
159520031230                          WS-IPS-GROUP-ID-ACC
159530170217                          AD-ACCOUNT
159540170217      * RFS21596 Start
159550170217                          WS-TMP-ENDDTE
159560170217      * RFS21596 End
159570170217                          PREV-INVESTMENT
159580031009                          AD-INVESTOR-NO
159590991126                          WS-SECTION-NO-ROR
159600970430                          AD-LANGUAGE
159610970430                          AD-DEALER
159620970430                          AD-SALESREP
159630970430                          AD-FUND-NO
159640970430                          AD-INVESTMENT-NAME
159650970430                          WS-QRTEND-TBL
159660970430                          AD-START-DATE
159670970430                          AD-END-DATE
159680970430   ¦                      WS-QRT-LST
159690970430      * RFS164528 - Start
159700970430R18814*                   WS-PROGRAM-NAME.
159710970430                          WS-PROGRAM-NAME
159720970430                          LC-LDASECTION31.
159730970430      * RFS164528 - End
159740970430
159750970430       LS1-0020-0040.
159760970430      *****
159770970430      *****    Using the investment market value base and the investment
159780970430      *****    group asset class percentages, accumulate to the asset
159790970430      *****    class totals for the account.  Please note that any
159800970430      *****    rounding errors will be corrected by adjusting the value
159810970430      *****    of the greatest asset class (sub-class).  The following
159820970430      *****    logic is used.
159830970430      *****       1. If the value to be accumulated is zero, or there
159840970430      *****          were no asset classes found, or there were no asset
159850970430      *****          class found for the investment group, bypass.
159860970430      *****       2. For each asset class specified for the investment
159870970430      *****          group,
159880970430      *****             a) Calculate the value for the asset class.
159890970430      *****             b) Accumulate the value.
159900970430      *****             c) If this is the highest value for the
159910970430      *****                investment group, flag it for possible
159920970430      *****                rounding (balancing).
159930970430      *****             d) If asset sub-classes exist for the asset
159940970430      *****                class and the asset class value is not zero,
159950970430      *****                for each asset sub-class specified,
159960160613      *****                   i) Calculate the value for the asset
159970160613      *****                      sub-class.
159980160613      *****                  ii) Accumulate the value.
159990160613      *****                 iii) If this is the highest value for the
160000970430      *****                      asset class, flag it for possible
160010970430      *****                      rounding (balancing).
160020970430      *****                  iv) After all asset sub-classes have been
160030970430      *****                      processed, update the highest asset
160040970430      *****                      sub-class if the total value of the
160050160613      *****                      asset sub-classes do not balance to the
160060970430      *****                      asset class.
160070970430      *****             e) After all asset classes have been processed,
160080970430      *****                update the highest asset class if the total
160090970430      *****                value of the asset classes do not balance to
160100970430      *****                the investment market value base.
160110970430      *****
160120970430156335*    IF  AD-MARKET-VALUE-BASE
160130970430156335*                       IS EQUAL TO  ZEROES
160140970430156335     IF  (AD-MARKET-VALUE-BASE IS EQUAL TO  ZEROES
160150160613156335     AND  AD-BOOK-VALUE-BASE IS EQUAL TO ZEROES)
160160160613           OR  WS-AC-LST NOT GREATER THAN  ZEROES
160170160613           OR  WS-IG-CLST (IG)
160180160613                      IS NOT GREATER THAN  ZEROES
160190970430               GO TO LS1-0060.
160200160613           MOVE ZEROES                 TO  WS-AC-VALTOT.
160210160613156335     MOVE ZEROES                 TO  WS-AC-BOK-VALTOT.
160220970430           MOVE ZEROES                 TO  WS-IGC-VALHGH.
160230970430           SET IGC                     TO  1.
160240970430       LS1-0030.
160250970430           IF  WS-IGC-AC (IG, IGC)
160260970430                              IS EQUAL TO  ZEROES
160270970430               GO TO LS1-0050.
160280160613           MULTIPLY AD-MARKET-VALUE-BASE
160290160613                                       BY  WS-IGC-PCT (IG, IGC)
160300160613                                   GIVING  WS-IGC-VAL ROUNDED.
160310970430156335     MULTIPLY AD-BOOK-VALUE-BASE
160320970430156335                               BY  WS-IGC-PCT (IG, IGC)
160330970430156335                           GIVING  WS-IGC-BOK-VAL ROUNDED.
160340160630           SET AC                      TO  WS-IGC-AC (IG, IGC).
160350970430           ADD WS-IGC-VAL              TO  WS-AC-VAL (AC).
160360970430156335     ADD WS-IGC-BOK-VAL          TO  WS-AC-BOK-VAL (AC).
160370970430156335     ADD WS-IGC-BOK-VAL          TO  WS-AC-BOK-VALTOT.
160380970430           ADD WS-IGC-VAL              TO  WS-AC-VALTOT.
160390970430           IF  WS-IGC-VAL IS GREATER THAN  WS-IGC-VALHGH
160400160613               MOVE WS-IGC-VAL         TO  WS-IGC-VALHGH
160410160613               SET ACR                 TO  AC.
160420970430           IF  WS-IGC-SLST (IG, IGC)
160430040107                      IS NOT GREATER THAN  ZEROES
160440160613156335*    OR  WS-IGC-VAL     IS EQUAL TO  ZEROES
160450160613156335     OR  (WS-IGC-VAL     IS EQUAL TO  ZEROES
160460970430156335     AND  WS-IGC-BOK-VAL IS EQUAL TO  ZEROES)
160470970430               MOVE ZEROES             TO  WS-AC-ACSR (AC)
160480970430               GO TO LS1-0050.
160490970430           MOVE ZEROES                 TO  WS-ACS-VALTOT.
160500970430161108     MOVE ZEROES                 TO  WS-ACS-BOK-VALTOT.
160510200319           MOVE ZEROES                 TO  WS-IGCS-VALHGH.
160520200319      * RFS1027733 - Start: use variable
160530200319      *     SET IGCS                    TO  1.
160540200319            MOVE 1 TO IGCS.
160550970430      * RFS1027733 - End
160560200319       LS1-0040.
160570200319      * RFS1027733 - Start: use I/O Routine
160580200319           PERFORM GET-INVESTMENT-GROUP-DATA THRU GIGD-EXIT
160590200319
160600200319027733*     MULTIPLY WS-IGC-VAL         BY  WS-IGCS-PCT (IG, IGC, IGCS)
160610970430           MULTIPLY WS-IGC-VAL         BY  WS-IGCS-PCT
160620200319                                   GIVING  WS-IGCS-VAL ROUNDED.
160630200319156335*     MULTIPLY WS-IGC-BOK-VAL     BY  WS-IGCS-PCT (IG, IGC, IGCS)
160640040107           MULTIPLY WS-IGC-BOK-VAL     BY  WS-IGCS-PCT
160650200319156335                            GIVING  WS-IGCS-BOK-VAL ROUNDED.
160660200319      *     SET ACS                     TO  WS-IGCS-ACS (IG, IGC, IGCS).
160670200319           SET ACS                     TO  WS-IGCS-ACS
160680970430      * RFS1027733 - End
160690160630R20205     ADD WS-IGCS-VAL             TO  WS-ACS-VAL (AC, ACS).
160700160630156335     ADD WS-IGCS-BOK-VAL         TO  WS-ACS-BOK-VAL (AC, ACS).
160710160630156335     ADD WS-IGCS-BOK-VAL         TO  WS-ACS-BOK-VALTOT.
160720160630           ADD WS-IGCS-VAL             TO  WS-ACS-VALTOT.
160730160630           IF  WS-IGCS-VAL   GREATER THAN  WS-IGCS-VALHGH
160740970430               MOVE WS-IGCS-VAL        TO  WS-IGCS-VALHGH
160750970430               SET ACSR                TO  ACS.
160760200319           IF  IGCS          IS LESS THAN  WS-IGC-SLST (IG, IGC)
160770200319027733          ADD 1 TO IGCS
160780970430027733*              SET IGCS             UP BY  1
160790970430               GO TO LS1-0040.
160800970430           SET WS-AC-ACSR (AC)         TO  ACSR.
160810160630           IF  WS-ACS-VALTOT NOT EQUAL TO  WS-IGC-VAL
160820160630R20205         COMPUTE WS-ACS-VAL (AC, ACSR)
160830970430R20205                                  =  WS-ACS-VAL (AC, ACSR)
160840970430                                        +  (WS-IGC-VAL
160850970430                                        -   WS-ACS-VALTOT).
160860160630161108     IF  WS-ACS-BOK-VALTOT NOT EQUAL TO  WS-IGC-BOK-VAL
160870160630161108         COMPUTE WS-ACS-VAL (AC, ACSR)
160880160630161108                                  =  WS-ACS-VAL (AC, ACSR)
160890970506161108                                  +  (WS-IGC-VAL
160900970430161108                                  -   WS-ACS-VALTOT).
160910970506       LS1-0050.
160920160630           IF  IGC           IS LESS THAN  WS-IG-CLST (IG)
160930160630               SET IGC              UP BY  1
160940160630               GO TO LS1-0030.
160950160630           IF  WS-AC-VALTOT   IS EQUAL TO  AD-MARKET-VALUE-BASE
160960040107               GO TO LS1-0060.
160970040107161108     IF  WS-AC-BOK-VALTOT   IS EQUAL TO  AD-BOOK-VALUE-BASE
160980970430161108         GO TO LS1-0060.
160990970430           COMPUTE WS-AC-VAL (ACR)      =  WS-AC-VAL (ACR)
161000160630                                        +  (AD-MARKET-VALUE-BASE
161010160630                                        -   WS-AC-VALTOT).
161020160630161108     COMPUTE WS-AC-BOK-VAL (ACR)  =  WS-AC-BOK-VAL (ACR)
161030160630161108                                  +  (AD-BOOK-VALUE-BASE
161040160630161108                                  -   WS-AC-BOK-VALTOT).
161050160630           IF  WS-AC-ACSR (ACR)
161060160630                          IS NOT EQUAL TO  ZEROES
161070160630               SET ACSR                TO  WS-AC-ACSR (ACR)
161080970430161108         COMPUTE WS-ACS-BOK-VAL (ACR, ACSR)
161090970430161108                                  =  WS-ACS-BOK-VAL (ACR, ACSR)
161100000000161108                                  +  (AD-BOOK-VALUE-BASE
161110000000161108                                  -   WS-AC-BOK-VALTOT)
161120000814R20205         COMPUTE WS-ACS-VAL (ACR, ACSR)
161130000814R20205                                  =  WS-ACS-VAL (ACR, ACSR)
161140000814                                        +  (AD-MARKET-VALUE-BASE
161150000814                                        -   WS-AC-VALTOT).
161160000815      * RFS161108 changes start
161170000815156335*    IF  WS-ACS-BOK-VALTOT NOT EQUAL TO  WS-IGC-BOK-VAL
161180000815156335*    COMPUTE WS-ACS-VAL (AC, ACSR)
161190000815156335*                                 =  WS-ACS-VAL (AC, ACSR)
161200000815156335*                                 +  (WS-IGC-VAL
161210000815156335*                                 -   WS-ACS-VALTOT).
161220000815      * RFS161108 changes Ends
161230000815
161240000815       LS1-0060.
161250000815           CONTINUE.
161260000815       LS1-EXIT.
161270030825           EXIT.
161280000815RF7503*** CALL-MKTVALUE-ROUTINE was coded in the following:
161290000814       CALL-MKTVALUE-ROUTINE.
161300000814
161310000814           MOVE ZEROS                    TO   WS-LOOP-DATE-NUM.
161320010323       CMKTR-0010.
161330010323           EVALUATE WS-LOOP-DATE-NUM
161340010323              WHEN 0
161350010323                  MOVE WS-MKT-Q1-DATE    TO  WS-MKT-Q1-4-DATE
161360010323              WHEN 1
161370000814                  MOVE WS-MKT-Q2-DATE    TO  WS-MKT-Q1-4-DATE
161380030825              WHEN 2
161390030825                  MOVE WS-MKT-Q3-DATE    TO  WS-MKT-Q1-4-DATE
161400030825              WHEN 3
161410000817                  MOVE WS-MKT-Q4-DATE    TO  WS-MKT-Q1-4-DATE
161420000817           END-EVALUATE.
161430000817R18147     CALL "FXACMBVALU" USING
161440000817                             WS-MKT-Q1-4-DATE
161450000817                             WS-MKT-Q-ACCOUNT-NO
161460000814                             WS-MKT-Q-INVESTMENT-CODE
161470000814                             WS-MKT-Q-INVESTMENT-CURRENCY
161480000817R8537                        WS-MKT-Q-MK-BASE
161490000818R8537                        WS-MKT-Q-BV-BASE
161500050330R8537                        WS-MKT-Q-BV-EXCHANGE
161510050330R8537                        WS-MKT-Q-UNIT-BAL
161520050330R8537                        WS-MKT-Q-UNIT-PRICE
161530050330                             WS-MKT-Q-BASE-CURRENCY
161540000814                             WS-MKT-Q-ERROR-CODE
161550000818R18147                       ACMBVALU-EXCHANGE-ARRAY
161560000818R18147                       WS-DECLARE-ACMBVALU.
161570050330           IF WS-MKT-Q-INVESTMENT-CURRENCY    IS NOT EQUAL TO  ZEROS
161580050330              MOVE WS-MKT-Q-INVESTMENT-CURRENCY TO  WS-MKT-Q-INVESTMENT
161590050330           ELSE
161600050330              MOVE WS-MKT-Q-BASE-CURRENCY       TO  WS-MKT-Q-INVESTMENT
161610000814           END-IF
161620000818           EVALUATE WS-LOOP-DATE-NUM
161630000818              WHEN 0
161640050330                 MOVE WS-MKT-Q-INVESTMENT  TO AD-MARKET-VALUE-PRIOR-Q1
161650050330                 ADD WS-MKT-Q-BASE-CURRENCY       TO WS-ACC-CDN-MVB-Q1
161660050330      * RFS26213 Start
161670050330                 MOVE WS-MKT-Q-UNIT-BAL TO AD-UNIT-BALANCE-PRIOR-Q1
161680000814                 MOVE WS-MKT-Q-UNIT-PRICE TO AD-UNIT-PRICE-PRIOR-Q1
161690000818      * RFS26213 End
161700000818              WHEN 1
161710050330                 MOVE WS-MKT-Q-INVESTMENT  TO AD-MARKET-VALUE-PRIOR-Q2
161720050330                 ADD WS-MKT-Q-BASE-CURRENCY       TO WS-ACC-CDN-MVB-Q2
161730050330      * RFS26213 Start
161740050330                 MOVE WS-MKT-Q-UNIT-BAL TO AD-UNIT-BALANCE-PRIOR-Q2
161750000814                 MOVE WS-MKT-Q-UNIT-PRICE TO AD-UNIT-PRICE-PRIOR-Q2
161760000814      * RFS26213 End
161770000817              WHEN 2
161780000817                 MOVE WS-MKT-Q-INVESTMENT  TO AD-MARKET-VALUE-PRIOR-Q3
161790000814                 ADD WS-MKT-Q-BASE-CURRENCY       TO WS-ACC-CDN-MVB-Q3
161800000814      * RFS26213 Start
161810000814                 MOVE WS-MKT-Q-UNIT-BAL TO AD-UNIT-BALANCE-PRIOR-Q3
161820000814                 MOVE WS-MKT-Q-UNIT-PRICE TO AD-UNIT-PRICE-PRIOR-Q3
161830000814      * RFS26213 End
161840000814              WHEN 3
161850000814                 MOVE WS-MKT-Q-INVESTMENT  TO AD-MARKET-VALUE-PRIOR-Q4
161860000814                 ADD WS-MKT-Q-BASE-CURRENCY       TO WS-ACC-CDN-MVB-Q4
161870000814      * RFS26213 Start
161880000814                 MOVE WS-MKT-Q-UNIT-BAL TO AD-UNIT-BALANCE-PRIOR-Q4
161890000814                 MOVE WS-MKT-Q-UNIT-PRICE TO AD-UNIT-PRICE-PRIOR-Q4
161900000815      * RFS26213 End
161910000815           END-EVALUATE.
161920000815
161930000815           MOVE ZEROS                        TO  WS-MKT-Q-INVESTMENT
161940000815
161950000815           ADD 1                         TO   WS-LOOP-DATE-NUM.
161960000815
161970000815           IF WS-LOOP-DATE-NUM  < 4
161980000815              GO TO  CMKTR-0010
161990000815           END-IF.
162000000815
162010000815      **********
162020000815       CMKTR-EXIT.
162030000815             EXIT.
162040000815      **********
162050000815
162060000815RF7503***  GET-MKT-Q-YYMMDD Routine was coded in the following:
162070000815
162080000815       GET-MKT-Q-YYMMDD.
162090000815
162100000815           IF WS-MKTVALUE-Q-MM < 4
162110000815              COMPUTE WS-MKT-Q-MM       = WS-MKTVALUE-Q-MM - 3 + 12
162120000815              COMPUTE WS-MKT-Q-CCYY     = WS-MKTVALUE-Q-CCYY - 1
162130000815           ELSE
162140000815              COMPUTE WS-MKT-Q-MM       = WS-MKTVALUE-Q-MM - 3
162150000815              COMPUTE WS-MKT-Q-CCYY     = WS-MKTVALUE-Q-CCYY
162160000815           END-IF.
162170000815
162180000815           PERFORM GET-MKT-Q-DD               THRU GMKTQD-EXIT.
162190000815           MOVE WS-MKT-Q-DATE           TO  WS-MKTVALUE-Q-DATE.
162200000815
162210000815      **********
162220000815       GMKTQYMD-EXIT.
162230000815                EXIT.
162240000815      **********
162250000815
162260000815RF7503***  GET-MKT-Q-DD Routine was coded in the following:
162270000815
162280000815       GET-MKT-Q-DD.
162290000815
162300000815           EVALUATE WS-MKT-Q-MM
162310000815              WHEN 01
162320000815                  MOVE DI-JAN     TO WS-MKT-Q-DD
162330000815              WHEN 02
162340000815                  PERFORM CHECK-FOR-LEAP-YEAR          THRU CLY-EXIT
162350000815                  MOVE DI-FEB     TO WS-MKT-Q-DD
162360000815              WHEN 03
162370000815                  MOVE DI-MAR     TO WS-MKT-Q-DD
162380000815              WHEN 04
162390000815                  MOVE DI-APR     TO WS-MKT-Q-DD
162400000815              WHEN 05
162410000815                  MOVE DI-MAY     TO WS-MKT-Q-DD
162420000815              WHEN 06
162430000815                  MOVE DI-JUN     TO WS-MKT-Q-DD
162440000815              WHEN 07
162450000815                  MOVE DI-JUL     TO WS-MKT-Q-DD
162460000815              WHEN 08
162470000815                  MOVE DI-AUG     TO WS-MKT-Q-DD
162480000815              WHEN 09
162490000815                  MOVE DI-SEP     TO WS-MKT-Q-DD
162500000815              WHEN 10
162510000815                  MOVE DI-OCT     TO WS-MKT-Q-DD
162520000815              WHEN 11
162530000815                  MOVE DI-NOV     TO WS-MKT-Q-DD
162540000815              WHEN 12
162550000815                  MOVE DI-DEC     TO WS-MKT-Q-DD
162560000815           END-EVALUATE.
162570000815
162580000815      **********
162590000815       GMKTQD-EXIT.
162600000815              EXIT.
162610000815      **********
162620000815
162630000815RF7503*** CHECK-FOR-LEAP-YEAR Routine coded in the following.
162640000815
162650000815       CHECK-FOR-LEAP-YEAR.
162660000815
162670000815           DIVIDE WS-MKT-Q-CCYY BY 4 GIVING WS-THROW-AWAY
162680000815           REMAINDER WS-REM.
162690000815           IF WS-REM   IS NOT EQUAL 0
162700000815              MOVE 28 TO DI-FEB
162710000815              GO TO CLY-EXIT
162720000815           END-IF.
162730000815
162740000815           DIVIDE WS-MKT-Q-CCYY BY 100 GIVING WS-THROW-AWAY
162750000824           REMAINDER WS-REM.
162760051020           IF WS-REM   IS NOT EQUAL 0
162770000824              MOVE 29 TO DI-FEB
162780010719           ELSE
162790051020              DIVIDE WS-MKT-Q-CCYY BY 400 GIVING WS-THROW-AWAY
162800051020              REMAINDER WS-REM
162810051020              IF WS-REM = ZERO
162820051020                 MOVE 29 TO DI-FEB
162830051020              END-IF
162840051020           END-IF.
162850051020
162860051020      **********
162870051020       CLY-EXIT.
162880051020           EXIT.
162890051020      **********
162900051020
162910051020RF6697*** Generate Account-GIC-Details-Section was in the following:
162920051020R30514***** The following subroutine was streamlined
162930051020       POPULATE-ACCOUNT-GIC-DETAILS.
162940141106
162950141106           INITIALIZE ACCOUNT-GIC-DETAILS-SECTION
162960141106                      INTCLC-PARMS
162970141106                      GICCALC-PARMS.
162980051020
162990051020           ADD  1                      TO WS-ACC-GIC-COUNT.
163000051020           MOVE AD-INVESTOR-NO         TO AG-INVESTOR-NO.
163010051020           MOVE AD-ACCOUNT             TO AG-ACCOUNT.
163020051020           MOVE 25                     TO AG-SECTION-NO.
163030051020           MOVE WS-ACC-GIC-COUNT       TO AG-SECTION-SEQUENCE.
163040051020           MOVE AD-LANGUAGE            TO AG-LANGUAGE.
163050051020           MOVE AD-DEALER              TO AG-DEALER.
163060051020           MOVE AD-SALESREP            TO AG-SALESREP.
163070051020
163080051020           MOVE AT-FUND-NO             TO WS-AD-FUND-CODE.
163090051020           MOVE WS-AD-INDUSTRY-CODE    TO AG-FUND-NO.
163100051020139988     INITIALIZE lc_CERTFCTE_NO
163110051020139988     MOVE CERTIFICATE-ID-NO OF ACCOUNT-GIC-DETAILS-REC
163120051020139988                                 TO lc_CERTFCTE_NO.
163130051020139988     PERFORM GETTERMMAT.
163140051020           MOVE CERTIFICATE-NO OF ACCOUNT-GIC-DETAILS-REC
163150051020                                       TO AG-CERTIFICATE-NO.
163160051020           MOVE CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC
163170051020                                       TO AG-CERTIFICATE-STATUS.
163180051020           MOVE ISSUE-DATE OF ACCOUNT-GIC-DETAILS-REC
163190051020                                       TO AG-ISSUED-DATE.
163200051020           MOVE MATURITY-DATE OF ACCOUNT-GIC-DETAILS-REC
163210051020                                       TO AG-MATURITY-DATE.
163220051020           MOVE TERM-SELECTED OF ACCOUNT-GIC-DETAILS-REC
163230051020                                       TO AG-TERM.
163240051020           MOVE INT-RATE OF ACCOUNT-GIC-DETAILS-REC
163250051020                                       TO AG-RATE.
163260051020           MOVE INITIAL-AMOUNT OF ACCOUNT-GIC-DETAILS-REC
163270051020                                       TO AG-INITIAL-AMOUNT.
163280141106           MOVE INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
163290140417                                       TO AG-INTEREST-PAY-OPTION.
163300140417           MOVE INT-PAYMENT-FREQUENCY OF ACCOUNT-GIC-DETAILS-REC
163310051020                                       TO AG-INTEREST-FREQUENCY.
163320061027           MOVE CAPITAL-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
163330051020                                       TO AG-CAPITAL-PAY-OPTION.
163340051020           MOVE NEXT-TERM-REQUEST OF ACCOUNT-GIC-DETAILS-REC
163350051020                                       TO AG-NEXT-TERM-REQUEST.
163360051020           MOVE AUTOMATIC-RENEWAL-CODE OF ACCOUNT-GIC-DETAILS-REC
163370051020                                       TO AG-AUTOMATIC-RENEWAL.
163380051020           MOVE INT-RATE-CATEGORY OF ACCOUNT-GIC-DETAILS-REC
163390051020                                       TO AG-INTEREST-RATE-CATEGORY.
163400051020           MOVE REDEMPTION-BEF-MATURITY OF ACCOUNT-GIC-DETAILS-REC
163410051020                                       TO AG-EARLY-REDEMPTION-CODE.
163420140417           MOVE MOVABLE-MORTGAGE OF ACCOUNT-GIC-DETAILS-REC
163430051020                                       TO AG-MOVABLE-MORTGAGE.
163440051020139988     MOVE lc_term_mat TO AG-TERM-ACCOUNT-MATURITY.
163450051020129378     PERFORM GIC-MAT-VALUE-SEARCH.
163460160329129378 POPULATE-INTLC-PARMS.
163470160329      ********** INTCLC-PARMS Start **********
163480051020           MOVE "SE"                   TO PASS-MODE.
163490051020           MOVE ACCOUNT-NO      OF ACCOUNT-GIC-DETAILS-REC
163500051020                                       TO PASS-ACCOUNT-NO.
163510051020           MOVE INVESTMENT-CODE OF ACCOUNT-GIC-DETAILS-REC
163520051020                                       TO PASS-INVESTMENT-CODE.
163530051020           MOVE CERTIFICATE-ID-NO OF ACCOUNT-GIC-DETAILS-REC
163540150708                                       TO PASS-CERTIFICATE-ID-NO.
163550150708           MOVE WS-GIC-DII-END-DATE    TO PASS-END-DATE-OPTION.
163560150708           MOVE ZEROS                  TO PASS-GROSS-AMT.
163570051020      ********** INTCLC-PARMS End ************
163580051020129378 NEW-SECTION-25.
163590061003           COMPUTE WS-AG-ACCRUED-INTEREST1 = 0.
163600061003           COMPUTE WS-AG-ACCRUED-INTEREST2 = 0.
163610051020
163620051020152312*    CALL "INTCLC" USING    INTCLC-PARMS.
163630051020152312     PERFORM GET-GIC-INT-END-VAL THRU GGI-EXIT.
163640051020
163650140417      ***
163660051020      *** Certificate's Accrued interest and Balance were returned
163670051020      *** from INTCLC.
163680051020      ***
163690051020           MOVE RETN-ACCRUAL-AMT       TO AG-ACCRUED-INTEREST.
163700140805      * RFS 149062 STARTS
163710141201142884*    MOVE RETN-ACCRUAL-AMT       TO WS-ACINT-SEC25.
163720141201      * RFS 149062 ENDS
163730141201           IF RETN-ACCRUAL-AMT IS LESS THAN ZEROES
163740141201              MOVE "-"                 TO AG-ACCRUED-INTEREST-SIGN
163750141201R35540     ELSE
163760141201R35540        MOVE " "                 TO AG-ACCRUED-INTEREST-SIGN
163770141201           END-IF.
163780141201
163790140805           MOVE RETN-BALANCE           TO AG-BALANCE.
163800140805           MOVE RETN-ACCRUAL-AMT       TO WS-AG-ACCRUED-INTEREST1.
163810140805129378 GIC-VALIDATION.
163820140805           IF INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
163830051020                                 IS EQUAL TO "C" OR "I" OR "E" OR "D"
163840140805              MOVE AG-BALANCE          TO  AG-MATURITY-VALUE
163850140805           END-IF.
163860140805      *RFS 137921- Begins.
163870140805141918*    IF INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
163880140805141918*                                       IS EQUAL TO "A" OR "Y"
163890140805141918*      IF INT-PAYMENT-FREQUENCY OF ACCOUNT-GIC-DETAILS-REC
163900140805141918*                                      IS EQUAL TO "CA"
163910140805141918     IF INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
163920140805141918                                        IS EQUAL TO "A" OR
163930140805141918       (INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC = "Y" AND
163940140805141918        INT-PAYMENT-FREQUENCY OF ACCOUNT-GIC-DETAILS-REC = "MA")
163950140805      ***************************************************************
163960140805      *Commenting the whole logic of calling GICCALC as there is a
163970140805      *discrepancy with ACIGLST screen for maturity value.Changed the
163980051020      *call from GICCALC to GICINTCLC.
163990051020      ********** GICCALC-PARMS Start **********
164000051020      *       MOVE INT-RATE OF ACCOUNT-GIC-DETAILS-REC
164010051020      *                                TO PASS-INTEREST-RATE
164020140805      *       MOVE INT-PAYMENT-OPTION OF ACCOUNT-GIC-DETAILS-REC
164030051020      *                                TO PASS-INTEREST-PAYMENT-OPTION
164040051020      *       MOVE INT-PAYMENT-FREQUENCY OF ACCOUNT-GIC-DETAILS-REC
164050140805      *                                TO PASS-INTEREST-FREQUENCY
164060140805      *       MOVE INITIAL-AMOUNT OF ACCOUNT-GIC-DETAILS-REC
164070140805      *                                TO PASS-CAPITAL-AMOUNT
164080140805      *       MOVE ISSUE-DATE OF ACCOUNT-GIC-DETAILS-REC
164090140805      *                                TO PASS-ISSUE-DATE
164100140805      *                                   PASS-ORIG-ISSUE-DATE
164110140805      *       MOVE MATURITY-DATE OF ACCOUNT-GIC-DETAILS-REC
164120140805      *                                TO PASS-MATURITY-DATE
164130140805      *                                   PASS-ORIG-MATURITY-DATE
164140140805      * RFS19625 - Begin
164150140805      ***  INTCLC Returns the GIC anniverary-date in the P-E-D-O field.
164160140805      ***  CALL TO GICCALC #1, If p-e-d-o <> returned anniverary-date.
164170140805
164180140805      *       SET  PASS-ORIG-CALC-YES     TO TRUE
164190140805      ********** GICCALC-PARMS End **********
164200140805      * RFS19625 - End
164210140805      *       IF INT-PAYMENT-FREQUENCY OF ACCOUNT-GIC-DETAILS-REC
164220140805      *                                       IS EQUAL TO "CA"
164230140805      *          IF WS-GIC-DII-END-DATE NOT = PASS-END-DATE-OPTION
164240140805      *             MOVE WS-GIC-DII-END-DATE   TO PASS-ISSUE-DATE
164250140805      *             MOVE PASS-END-DATE-OPTION  TO PASS-MATURITY-DATE
164260140805      *             MOVE AG-BALANCE            TO PASS-CAPITAL-AMOUNT
164270140805      *             CALL "GICCALC" USING GICCALC-PARMS
164280140805      *             MOVE RETN-TOTAL-INTEREST TO WS-AG-ACCRUED-INTEREST2
164290140805      *          END-IF
164300140805      *          COMPUTE PASS-CAPITAL-AMOUNT = AG-BALANCE
164310141201      *                                      + WS-AG-ACCRUED-INTEREST1
164320141201      *                                      + WS-AG-ACCRUED-INTEREST2
164330141201      *       ELSE
164340141201      *          COMPUTE PASS-CAPITAL-AMOUNT = AG-BALANCE
164350141201      *       END-IF
164360141201      ******  CALL TO GICCALC #2
164370160329      *       MOVE MATURITY-DATE OF ACCOUNT-GIC-DETAILS-REC
164380160329      *                                        TO PASS-MATURITY-DATE
164390160329      *       MOVE PASS-END-DATE-OPTION        TO PASS-ISSUE-DATE
164400160329      *       CALL "GICCALC" USING    GICCALC-PARMS
164410140805      *       ADD  AG-BALANCE
164420140805      *            WS-AG-ACCRUED-INTEREST1
164430140805      *            WS-AG-ACCRUED-INTEREST2
164440141201      *            RETN-TOTAL-INTEREST
164450140805      *                                TO  AG-MATURITY-VALUE
164460140805      *    END-IF.
164470140417141918      MOVE ACCOUNT-NO OF ACCOUNT-GIC-DETAILS-REC
164480140417141918        TO li_Account-No
164490150422141918      MOVE INVESTMENT-CODE OF ACCOUNT-GIC-DETAILS-REC
164500051020141918        TO lc_Investment-Code
164510051020141918      MOVE CERTIFICATE-ID-NO OF ACCOUNT-GIC-DETAILS-REC
164520151130141918        TO li_Certif-ID-No
164530151130152312      MOVE MATURITY-DATE     OF ACCOUNT-GIC-DETAILS-REC
164540151130152312        TO ld_MatDate
164550151130152312      MOVE CERT-STATUS-CODE  OF ACCOUNT-GIC-DETAILS-REC
164560151130152312        TO lc_Cert_Status
164570051020           PERFORM CALCULATE-MATURITY-VALUE
164580051020           COMPUTE AG-MATURITY-VALUE ROUNDED =
164590000824                    RETN-BALANCE + li_IntAccrualAmt
164600000824141918*    END-IF
164610000824           END-IF.
164620000824      *RFS 137921 - Ends.
164630000908129378 VAL-EXIT.
164640000908129378     EXIT.
164650000908142884     PERFORM PREPARE-SECTION25-NEW-FIELD.
164660000908           MOVE WS-PREV-START-DATE     TO  AG-START-DATE.
164670000908           MOVE PREV-END-DATE          TO  AG-END-DATE.
164680000908151413     MOVE MATURITY-DATE OF ACCOUNT-GIC-DETAILS-REC TO
164690000911151413                     li_CertMatureDate.
164700000911151413     IF CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC = "C"
164710000911151413        PERFORM PREPARE-CLS-CERT-FIELDS THRU PCC-EXIT
164720000911151413     END-IF.
164730000908           MOVE ACCOUNT-GIC-DETAILS-SECTION TO STATEMENT-REC(ISR).
164740000908           PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
164750000908      **********
164760000908       PAGIC-EXIT.
164770000908             EXIT.
164780000908      **********
164790000908RF6697*** Populate AD-DII-RATE field.
164800000908       POPULATE-AD-DII-RATE.
164810000908           INITIALIZE INVESTMENT-DII-RATES-REC.
164820010625           SET DIT                     TO  1.
164830010625
164840010625       PADR-0010.
164850010625           IF  WS-DIAT-CODE (DIT)      IS EQUAL TO
164860010625                                       PREV-ACCOUNT-TYPE
164870010625           AND WS-DINT-CODE (DIT)      IS EQUAL TO
164880010625                                       PREV-NOMINEE-ACCOUNT-TYPE
164890010625               MOVE WS-DIST-CODE (DIT) TO   DII-SET
164900010625                                       OF INVESTMENT-DII-RATES-REC
164910010625               GO TO PADR-0020
164920010625           END-IF.
164930010625           IF DIT                      IS LESS THAN  WS-DIT-LST
164940010625              SET DIT                   UP BY  1
164950010625              GO TO PADR-0010
164960010625           END-IF.
164970010625
164980010625       PADR-0020.
164990010625
165000010625           MOVE PREV-INVESTMENT        TO INVESTMENT-CODE
165010010625                                  OF INVESTMENT-DII-RATES-REC
165020010625           MOVE AT-END-DATE            TO EFFECTIV-DATE
165030010625                                  OF INVESTMENT-DII-RATES-REC
165040010625
165050010625           READ INVESTMENT-DII-RATES
165060010625                INVALID KEY
165070010625                   INITIALIZE INVESTMENT-DII-RATES-REC
165080010625                   MOVE WS-DIST-CODE (DIT) TO   DII-SET
165090010625                                  OF INVESTMENT-DII-RATES-REC
165100010625                   MOVE PREV-INVESTMENT        TO INVESTMENT-CODE
165110010625                                  OF INVESTMENT-DII-RATES-REC
165120010625                   MOVE AT-END-DATE            TO EFFECTIV-DATE
165130010625                                  OF INVESTMENT-DII-RATES-REC
165140010625
165150010625                   GO TO PADR-0040
165160010625           END-READ
165170010625           GO TO PADR-EXIT.
165180010625
165190010625r10404 PADR-0040.
165200010625
165210010625           START INVESTMENT-DII-RATES
165220010625                KEY IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
165230010625                INVALID KEY
165240010625                 GO TO PADR-0050
165250010625           END-START.
165260010625
165270010625           GO TO PADR-0060.
165280010625
165290010625       PADR-0050.
165300010625
165310010625           READ INVESTMENT-DII-RATES LAST
165320010625                AT END
165330010625                     MOVE ZEROES         TO ANNUAL-RATE
165340010625                             OF INVESTMENT-DII-RATES-REC
165350010625                     GO TO PADR-EXIT
165360010625           END-READ.
165370010625
165380010625           GO TO PADR-0080.
165390010625
165400010625       PADR-0060.
165410010625
165420010625           READ INVESTMENT-DII-RATES PRIOR  RECORD
165430010625                AT END
165440010625                     MOVE ZEROES         TO ANNUAL-RATE
165450010625                             OF INVESTMENT-DII-RATES-REC
165460010625                     GO TO PADR-EXIT
165470010625           END-READ.
165480010625
165490010625       PADR-0080.
165500000908
165510000908           IF INVESTMENT-CODE OF INVESTMENT-DII-RATES-REC
165520000908                                  IS NOT EQUAL TO  PREV-INVESTMENT
165530010605           OR DII-SET OF INVESTMENT-DII-RATES-REC
165540010605                                  IS NOT EQUAL TO  WS-DIST-CODE (DIT)
165550010605              MOVE ZEROES   TO ANNUAL-RATE
165560051020                             OF INVESTMENT-DII-RATES-REC
165570051020                     GO TO PADR-EXIT
165580051020           END-IF.
165590051020
165600051020           IF EFFECTIV-DATE   OF INVESTMENT-DII-RATES-REC
165610051020                                  IS GREATER THAN  AT-END-DATE
165620051020                     GO TO PADR-0060
165630051020           END-IF.
165640051020
165650051020      **********
165660051020       PADR-EXIT.
165670051020            EXIT.
165680051020      **********
165690051020R10404*** Generate AD-ACCRUED-INTEREST for GIC in Section 20:
165700051020
165710051020       GET-GIC-AD-ACCRUED-INT.
165720051020           INITIALIZE                  WS-AD-ACCRUED-INTEREST
165730051020R10992                                 WS-AD-BOOK-VALUE-BASE
165740051020                                       ACCOUNT-GIC-DETAILS-REC.
165750051020           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
165760051020                                       OF ACCOUNT-GIC-DETAILS-REC.
165770051020           MOVE PREV-INVESTMENT        TO  INVESTMENT-CODE
165780051020                                       OF ACCOUNT-GIC-DETAILS-REC.
165790051020           MOVE SPACES                 TO  CERT-STATUS-CODE
165800051020                                       OF ACCOUNT-GIC-DETAILS-REC.
165810051020           MOVE ZEROES                 TO  MATURITY-DATE
165820051020                                       OF ACCOUNT-GIC-DETAILS-REC.
165830051020           START GIC-CERTIFICATE-DETAILS
165840051020               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
165850051020               INVALID KEY
165860051020                   GO TO GGAAI-EXIT
165870051020           END-START.
165880051020       GGAAI-READ.
165890051020           READ GIC-CERTIFICATE-DETAILS  NEXT
165900051020               AT END
165910051020                   GO TO GGAAI-EXIT
165920051020           END-READ.
165930051020           IF ACCOUNT-NO OF ACCOUNT-GIC-DETAILS-REC
165940051020ptest                    IS NOT EQUAL  TO  PREV-ACCOUNT
165950051020           OR INVESTMENT-CODE OF ACCOUNT-GIC-DETAILS-REC
165960051020                         IS NOT EQUAL TO PREV-INVESTMENT
165970051020                   GO TO GGAAI-EXIT
165980051020           END-IF.
165990151130R10737***
166000051020      ***  GIC status need to be reevaluated for closed Certificatre.
166010051020      ***  For a Closed certificate, both the CERTIFICATE-STATUS-DATE
166020151130      ***  and the ISSUE-DATE need to be checked against Statement
166030151130      ***  end date.
166040151130      ***
166050151130           IF ISSUE-DATE OF ACCOUNT-GIC-DETAILS-REC
166060151130                                IS GREATER  THAN WS-GIC-END-DATE
166070151130                   GO TO GGAAI-READ
166080151130           END-IF.
166090051020           IF  CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC
166100051020                                IS EQUAL TO "C"
166110151130           AND ((CERTIFICATE-STATUS-DATE OF ACCOUNT-GIC-DETAILS-REC
166120051020                                IS LESS THAN WS-GIC-END-DATE)
166130151130R10737     OR  (CERTIFICATE-STATUS-DATE OF ACCOUNT-GIC-DETAILS-REC
166140151130                                IS EQUAL TO  WS-GIC-END-DATE))
166150170104151413     AND WS-LDA-STMT-CNFM-FLAG NOT = "S"
166160170104                   GO TO GGAAI-READ
166170151130           END-IF.
166180151130151413     IF  CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC
166190151130151413                          IS EQUAL TO "C"
166200151130151413     AND WS-LDA-STMT-CNFM-FLAG = "S"
166210051020151413     AND (CERTIFICATE-STATUS-DATE OF ACCOUNT-GIC-DETAILS-REC
166220051020151413                          IS LESS THAN WS-STMT-CFNM-STR-DATE)
166230051020151413             GO TO GGAAI-READ
166240051020151413     END-IF.
166250051020           IF CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC
166260051020                                IS EQUAL TO "C"
166270051020151413       IF WS-LDA-STMT-CNFM-FLAG NOT = "S"
166280051020              MOVE "A" TO CERT-STATUS-CODE OF ACCOUNT-GIC-DETAILS-REC
166290051020151413       ELSE
166300051024151413          IF (CERTIFICATE-STATUS-DATE OF ACCOUNT-GIC-DETAILS-REC
166310051024151413*163757            IS GREATER THAN OR EQUAL TO WS-GIC-END-DATE)
166320140925163757                   IS GREATER THAN WS-GIC-END-DATE)
166330140925151413              MOVE "A" TO CERT-STATUS-CODE OF
166340140925151413                                      ACCOUNT-GIC-DETAILS-REC
166350140925151413          END-IF
166360140925151413       END-IF
166370051020R10737     END-IF.
166380141016R30514*****
166390141016  ¦   ***** Retrieve the value for PASS-GROSS-AMT of INTCLC-PARMS for
166400141016  ¦   ***** INTCLC. The PASS-GROSS-AMT value can be retrieved from
166410051020  ¦   ***** either ACCOUNT-GIC-DETAILS-REC or from executing the
166420010605  ¦   ***** GICCALC module.
166430010605  ¦   *****
166440010605  ¦
166450010605  ¦
166460010605  ¦        PERFORM POPULATE-ACCOUNT-GIC-DETAILS    THRU PAGIC-EXIT.
166470010605  ¦
166480010605  ¦   * RFS 139952 - begin RM
166490010605  ¦   * Comment this out as this is no longer required
166500010605  ¦   *    ADD  RETN-ACCRUAL-AMT       TO  WS-AD-ACCRUED-INTEREST.
166510010605  ¦   *    ADD  RETN-BALANCE           TO  WS-AD-BOOK-VALUE-BASE.
166520051020  ¦   * RFS 139952 - end   RM
166530051020  v
166540051020141122* Sum up accrual int and balance for each certificate
166550051020141122     ADD  AG-ACCRUED-INTEREST    TO  WS-AD-ACCRUED-INTEREST.
166560051020141122     ADD  AG-BALANCE             TO  WS-AD-BOOK-VALUE-BASE.
166570051020R30514     GO TO GGAAI-READ.
166580051020      **********
166590010809       GGAAI-EXIT.
166600160329             EXIT.
166610160329      **********
166620010605      *** Generate AD-ACCRUED-INTEREST for DII in Section 20:
166630010605
166640010605       GET-DII-AD-ACCRUED-INT.
166650010605
166660010605           INITIALIZE WS-AD-ACCRUED-INTEREST
166670010605                      INTCLC-PARMS.
166680010605R30514***** INTCLC-PARMS fields.
166690010605  ¦        MOVE "SE"                   TO  PASS-MODE.
166700010605  ¦        MOVE PREV-ACCOUNT           TO  PASS-ACCOUNT-NO.
166710020417  ¦        MOVE PREV-INVESTMENT        TO  PASS-INVESTMENT-CODE.
166720020417  ¦        MOVE ZEROS                  TO  PASS-CERTIFICATE-ID-NO.
166730020417  v        MOVE WS-GIC-DII-END-DATE    TO  PASS-END-DATE-OPTION.
166740020417R30514     MOVE ZEROS                  TO  PASS-GROSS-AMT.
166750020417
166760020417152312*    CALL "INTCLC" USING    INTCLC-PARMS.
166770020417152312     PERFORM GET-GIC-INT-END-VAL THRU GGI-EXIT.
166780020417
166790020417           MOVE RETN-ACCRUAL-AMT       TO  WS-AD-ACCRUED-INTEREST.
166800020417
166810020417      **********
166820020417
166830020417       GDAAI-EXIT.
166840020417             EXIT.
166850020417
166860020417R10404**********
166870020417
166880020417R13017*** Generate Currency exchanged rate for BCL record at Section 80
166890020417
166900020417       GET-CURRENCY-EXCHANGE-RATE.
166910020417
166920020417           IF  WS-CC-LST NOT GREATER THAN  ZEROES
166930020417               GO TO GCER-0050
166940020417           END-IF
166950020417
166960020417           SET CC                      TO  1.
166970020417
166980020417       GCER-0010.
166990020417
167000020417           IF  WS-CC-CODE (CC)   EQUAL TO  WS-IC-CURR (IC)
167010020417               GO TO GCER-EXIT
167020020417           END-IF
167030020417
167040000000           IF  CC            IS LESS THAN  WS-CC-LST
167050000000               SET CC               UP BY  1
167060000000               GO TO GCER-0010
167070000000           END-IF.
167080000000
167090000000       GCER-0050.
167100000000
167110000000           SET CC                      TO  WS-CC-BSE.
167120000000
167130000000      **********
167140970108
167150970108       GCER-EXIT.
167160970108            EXIT.
167170970108
167180970108R13017**********
167190970108
167200970108      /
167210000000       LEVEL-SUMMARY-2.
167220980717
167230980717      ******************************************************************
167240980717      *                                                                *
167250980825      *    L E V E L   S U M M A R I Z A T I O N   2   R O U T I N E   *
167260990619      *                                                                *
167270990619      *        ACACTNO:    Account Number                              *
167280990619      *                                                                *
167290990619      ******************************************************************
167300990619
167310990619      *****
167320001006      *****    If the account being processed is to be bypassed, exit.
167330990619      *****
167340001006
167350020923           IF  WS-LR2BYP-SW   IS EQUAL TO  "Y"
167360020923               GO TO LS2-EXIT.
167370030317
167380030317      *****
167390030624      *****  Accumulate incept total of account to investor level
167400030624      *****
167410030624
167420030624           ADD WS-ACC-CPG-INCEPT      TO WS-IVR-CPG-INCEPT.
167430030624           ADD WS-ACC-INC-INCEPT      TO WS-IVR-INC-INCEPT.
167440030624           ADD WS-ACC-INT-INCEPT      TO WS-IVR-INT-INCEPT.
167450030624           ADD WS-ACC-PUR-INCEPT      TO WS-IVR-PUR-INCEPT.
167460030624           ADD WS-ACC-RED-INCEPT      TO WS-IVR-RED-INCEPT.
167470030624           ADD WS-ACC-TRI-INCEPT      TO WS-IVR-TRI-INCEPT.
167480030624RF7777     ADD WS-ACC-SWI-INCEPT      TO WS-IVR-SWI-INCEPT.
167490030624           ADD WS-ACC-TRO-INCEPT      TO WS-IVR-TRO-INCEPT.
167500030624RF7777     ADD WS-ACC-SWO-INCEPT      TO WS-IVR-SWO-INCEPT.
167510021202R14556     ADD WS-ACC-TRI-INCEPT-COST TO WS-IVR-TRI-INCEPT-COST.
167520021202R14556     ADD WS-ACC-TRO-INCEPT-COST TO WS-IVR-TRO-INCEPT-COST.
167530021202R16256     ADD WS-ACC-TRI-INCEPT-MKT  TO WS-IVR-TRI-INCEPT-MKT.
167540021202R16256     ADD WS-ACC-TRO-INCEPT-MKT  TO WS-IVR-TRO-INCEPT-MKT.
167550021202R16881     ADD WS-ACC-TRI-INCEPT-PH    TO  WS-IVR-TRI-INCEPT-PH.
167560021202   ¦       ADD WS-ACC-TRI-YTD-PH       TO  WS-IVR-TRI-YTD-PH.
167570021202   ¦       ADD WS-ACC-TRI-CUR-PH       TO  WS-IVR-TRI-CUR-PH.
167580990619   ¦       ADD WS-ACC-TRI-INCEPT-PH-EX TO  WS-IVR-TRI-INCEPT-PH-EX.
167590990619   ¦       ADD WS-ACC-TRI-YTD-PH-EX    TO  WS-IVR-TRI-YTD-PH-EX.
167600990619   ¦       ADD WS-ACC-TRI-CUR-PH-EX    TO  WS-IVR-TRI-CUR-PH-EX.
167610990619   ¦       ADD WS-ACC-TRO-INCEPT-PH    TO  WS-IVR-TRO-INCEPT-PH.
167620990619   ¦       ADD WS-ACC-TRO-YTD-PH       TO  WS-IVR-TRO-YTD-PH.
167630990619   ¦       ADD WS-ACC-TRO-CUR-PH       TO  WS-IVR-TRO-CUR-PH.
167640990619   ¦       ADD WS-ACC-TRO-INCEPT-PH-EX TO  WS-IVR-TRO-INCEPT-PH-EX.
167650001006   v       ADD WS-ACC-TRO-YTD-PH-EX    TO  WS-IVR-TRO-YTD-PH-EX.
167660990619R16881     ADD WS-ACC-TRO-CUR-PH-EX    TO  WS-IVR-TRO-CUR-PH-EX.
167670001006
167680020923R15022     ADD WS-ACC-DISP-GAIN-LOSS-CUR
167690020923R15022                TO WS-IVR-DISP-GAIN-LOSS-CUR
167700020923R15022     ADD WS-ACC-DISP-GAIN-LOSS-YTD
167710020923R15022                TO WS-IVR-DISP-GAIN-LOSS-YTD
167720030317R15022     ADD WS-ACC-DISP-GAIN-LOSS-INC
167730030317R15022                TO WS-IVR-DISP-GAIN-LOSS-INC
167740030317
167750030317           ADD WS-ACC-CPG-INCEPT-EX   TO WS-IVR-CPG-INCEPT-EX.
167760021202           ADD WS-ACC-INC-INCEPT-EX   TO WS-IVR-INC-INCEPT-EX.
167770021202           ADD WS-ACC-INT-INCEPT-EX   TO WS-IVR-INT-INCEPT-EX.
167780021202           ADD WS-ACC-PUR-INCEPT-EX   TO WS-IVR-PUR-INCEPT-EX.
167790021202           ADD WS-ACC-RED-INCEPT-EX   TO WS-IVR-RED-INCEPT-EX.
167800021202           ADD WS-ACC-TRI-INCEPT-EX   TO WS-IVR-TRI-INCEPT-EX.
167810021202RF7777     ADD WS-ACC-SWI-INCEPT-EX   TO WS-IVR-SWI-INCEPT-EX.
167820021202           ADD WS-ACC-TRO-INCEPT-EX   TO WS-IVR-TRO-INCEPT-EX.
167830021202RF7777     ADD WS-ACC-SWO-INCEPT-EX   TO WS-IVR-SWO-INCEPT-EX.
167840010309R14556     ADD WS-ACC-TRI-INCEPT-COST-EX
167850010309                                  TO WS-IVR-TRI-INCEPT-COST-EX.
167860010309R14556     ADD WS-ACC-TRO-INCEPT-COST-EX
167870010309                                  TO WS-IVR-TRO-INCEPT-COST-EX.
167880010309R16256     ADD WS-ACC-TRI-INCEPT-MKT-EX
167890010309                                  TO WS-IVR-TRI-INCEPT-MKT-EX.
167900010309R16256     ADD WS-ACC-TRO-INCEPT-MKT-EX
167910010309                                  TO WS-IVR-TRO-INCEPT-MKT-EX.
167920010309
167930990619R15022     ADD WS-ACC-DISP-GAIN-LOSS-CUR-EX
167940990619R15022                TO WS-IVR-DISP-GAIN-LOSS-CUR-EX
167950030422R15022     ADD WS-ACC-DISP-GAIN-LOSS-YTD-EX
167960030422R15022                TO WS-IVR-DISP-GAIN-LOSS-YTD-EX
167970030422R15022     ADD WS-ACC-DISP-GAIN-LOSS-INC-EX
167980030422R15022                TO WS-IVR-DISP-GAIN-LOSS-INC-EX
167990030422
168000030422RF8633     ADD WS-ACC-TRI-YTD-EX      TO WS-IVR-TRI-YTD-EX.
168010030422RF8633     ADD WS-ACC-SWI-YTD-EX      TO WS-IVR-SWI-YTD-EX.
168020030422RF8633     ADD WS-ACC-TRO-YTD-EX      TO WS-IVR-TRO-YTD-EX.
168030030422RF8633     ADD WS-ACC-SWO-YTD-EX      TO WS-IVR-SWO-YTD-EX.
168040030422RF8633     ADD WS-PROFESSIONAL-FEE-INCEPT
168050030422                                    TO WS-PROFESSIONAL-FEE-INCEPT-TOT.
168060030422RF8633     ADD WS-PROFESSIONAL-FEE-YTD TO WS-PROFESSIONAL-FEE-YTD-TOT.
168070030422RF8633     ADD WS-PROFESSIONAL-FEE-CUR TO WS-PROFESSIONAL-FEE-CUR-TOT.
168080030422
168090030422           ADD WS-ACC-REG-CTB-INCPT-EX
168100040115                                      TO WS-IVR-REG-CTB-INCPT-EX.
168110040115
168120040115R16990     ADD WS-ACC-CPG-CURRENT-EX  TO WS-IVR-CPG-CURRENT-EX
168130001228  ¦                                      WS-IVR-DISTRIBUTION-CURRENT.
168140001228  ¦        ADD WS-ACC-INC-CURRENT-EX  TO WS-IVR-INC-CURRENT-EX
168150990619  ¦                                      WS-IVR-DISTRIBUTION-CURRENT.
168160990619  ¦        ADD WS-ACC-INT-CURRENT-EX  TO WS-IVR-INT-CURRENT-EX
168170990619  ¦                                      WS-IVR-DISTRIBUTION-CURRENT.
168180990619  ¦        ADD WS-ACC-PUR-CURRENT-EX  TO WS-IVR-PUR-CURRENT-EX
168190990619  ¦                                      WS-IVR-NET-ADD-CURRENT.
168200990619  ¦        ADD WS-ACC-TRI-CURRENT-EX  TO WS-IVR-TRI-CURRENT-EX
168210990619  ¦                                      WS-IVR-NET-ADD-CURRENT.
168220990619  ¦        ADD WS-ACC-RED-CURRENT-EX  TO WS-IVR-RED-CURRENT-EX
168230990619  ¦                                      WS-IVR-NET-WITHDRAW-CURRENT.
168240990619  v        ADD WS-ACC-TRO-CURRENT-EX  TO WS-IVR-TRO-CURRENT-EX
168250990619R16990                                   WS-IVR-NET-WITHDRAW-CURRENT.
168260990619R20324     COMPUTE WS-IVR-NET-WITHDRAW-CURRENT
168270990619   ¦                              = WS-IVR-NET-WITHDRAW-CURRENT
168280990619R20324                            - WS-PROFESSIONAL-FEE-CUR.
168290990619RF8673     ADD WS-ACC-SWI-CURRENT-EX  TO WS-IVR-SWI-CURRENT-EX.
168300990619           ADD WS-ACC-SWO-CURRENT-EX  TO WS-IVR-SWO-CURRENT-EX.
168310981223           ADD WS-ACC-REG-CTB-CUR-EX  TO WS-IVR-REG-CTB-CUR-EX.
168320980717
168330010308           ADD WS-ACC-CPG-YTD         TO WS-IVR-CPG-YTD.
168340010308           ADD WS-ACC-INC-YTD         TO WS-IVR-INC-YTD.
168350010308           ADD WS-ACC-INT-YTD         TO WS-IVR-INT-YTD.
168360010308           ADD WS-ACC-PUR-YTD         TO WS-IVR-PUR-YTD.
168370010308           ADD WS-ACC-RED-YTD         TO WS-IVR-RED-YTD.
168380010308
168390010308           ADD WS-ACC-CPG-YTD-EX      TO WS-IVR-CPG-YTD-EX.
168400010308           ADD WS-ACC-INC-YTD-EX      TO WS-IVR-INC-YTD-EX.
168410010308           ADD WS-ACC-INT-YTD-EX      TO WS-IVR-INT-YTD-EX.
168420010308           ADD WS-ACC-PUR-YTD-EX      TO WS-IVR-PUR-YTD-EX.
168430010308           ADD WS-ACC-RED-YTD-EX      TO WS-IVR-RED-YTD-EX.
168440010308
168450010308           ADD WS-ACC-WHTAX-YTD       TO WS-IVR-WHTAX-YTD.
168460010308           ADD WS-ACC-NRTAX-YTD       TO WS-IVR-NRTAX-YTD.
168470010308           ADD WS-WITHDRAWALS-YTD     TO WS-IVR-WITHDRAWALS-YTD.
168480010308
168490010308RF8633     IF WS-LDA-INVESTOR-12      IS EQUAL TO  "Y"
168500010308            ADD WS-IS2-INT-INCEPT-CASH  TO WS-IS2-INT-INCEPT-CASH-TOT
168510010308            ADD WS-IS2-INT-YTD-CASH     TO WS-IS2-INT-YTD-CASH-TOT
168520010308            ADD WS-IS2-INT-CURRENT-CASH TO WS-IS2-INT-CURRENT-CASH-TOT
168530010308            ADD WS-IS2-INT-INCEPT-REINV TO WS-IS2-INT-INCEPT-REINV-TOT
168540010308            ADD WS-IS2-INT-YTD-REINV    TO WS-IS2-INT-YTD-REINV-TOT
168550020821            ADD WS-IS2-INT-CURRENT-REINV
168560020821                                        TO WS-IS2-INT-CURRENT-REINV-TOT
168570020821            ADD WS-IS2-INC-INCEPT-CASH  TO WS-IS2-INC-INCEPT-CASH-TOT
168580020821            ADD WS-IS2-INC-YTD-CASH     TO WS-IS2-INC-YTD-CASH-TOT
168590020821            ADD WS-IS2-INC-CURRENT-CASH TO WS-IS2-INC-CURRENT-CASH-TOT
168600020821            ADD WS-IS2-INC-INCEPT-REINV TO WS-IS2-INC-INCEPT-REINV-TOT
168610020821            ADD WS-IS2-INC-YTD-REINV    TO WS-IS2-INC-YTD-REINV-TOT
168620021004            ADD WS-IS2-INC-CURRENT-REINV
168630021004                                        TO WS-IS2-INC-CURRENT-REINV-TOT
168640021004            ADD WS-IS2-CPG-INCEPT-CASH  TO WS-IS2-CPG-INCEPT-CASH-TOT
168650021004            ADD WS-IS2-CPG-YTD-CASH     TO WS-IS2-CPG-YTD-CASH-TOT
168660021004            ADD WS-IS2-CPG-CURRENT-CASH TO WS-IS2-CPG-CURRENT-CASH-TOT
168670021007            ADD WS-IS2-CPG-INCEPT-REINV TO WS-IS2-CPG-INCEPT-REINV-TOT
168680040414            ADD WS-IS2-CPG-YTD-REINV    TO WS-IS2-CPG-YTD-REINV-TOT
168690040414            ADD WS-IS2-CPG-CURRENT-REINV
168700040414                                        TO WS-IS2-CPG-CURRENT-REINV-TOT
168710160201R14136      ADD  WS-IS2-MFR-CUR         TO  WS-IS2-MFR-CUR-TOT
168720010308  ¦         ADD  WS-IS2-MFR-YTD         TO  WS-IS2-MFR-YTD-TOT
168730010308  ¦         ADD  WS-IS2-MFR-INCEPT      TO  WS-IS2-MFR-INCEPT-TOT
168740000000  ¦         ADD  WS-IS2-FED-WHTAX-CUR   TO  WS-IS2-FED-WHTAX-CUR-TOT
168750000000  ¦         ADD  WS-IS2-FED-WHTAX-YTD   TO  WS-IS2-FED-WHTAX-YTD-TOT
168760000000  ¦         ADD  WS-IS2-PROV-WHTAX-CUR  TO  WS-IS2-PROV-WHTAX-CUR-TOT
168770970526R14136      ADD  WS-IS2-PROV-WHTAX-YTD  TO  WS-IS2-PROV-WHTAX-YTD-TOT
168780970526R14858      ADD  WS-IS2-BAJ-CUR         TO  WS-IS2-BAJ-CUR-TOT
168790970526  ¦         ADD  WS-IS2-BAJ-YTD         TO  WS-IS2-BAJ-YTD-TOT
168800970526  ¦         ADD  WS-IS2-BAJ-INCEPT      TO  WS-IS2-BAJ-INCEPT-TOT
168810980624  ¦         ADD  WS-IS2-BFW-CUR         TO  WS-IS2-BFW-CUR-TOT
168820980624  ¦         ADD  WS-IS2-BFW-YTD         TO  WS-IS2-BFW-YTD-TOT
168830980624R14858      ADD  WS-IS2-BFW-INCEPT      TO  WS-IS2-BFW-INCEPT-TOT
168840970526R20758      ADD  WS-IS2-ROC-CUR         TO  WS-IS2-ROC-CUR-TOT
168850980624  ¦         ADD  WS-IS2-ROC-YTD         TO  WS-IS2-ROC-YTD-TOT
168860970526R20758      ADD  WS-IS2-ROC-INCEPT      TO  WS-IS2-ROC-INCEPT-TOT
168870040511148326      PERFORM LEVEL-SUMMARY-2-NEW THRU LS2N-EXIT
168880980624           END-IF.
168890980624
168900980624           IF WS-WRITE-ACCOUNT-LEVEL IS EQUAL TO "N"
168910980624             GO TO LS2-EXIT
168920980624           END-IF.
168930040511
168940040511      *****
168950040511      *****    Calculate the percentages for the currency values.  If
168960040511      *****    the total percentage is not 100, the currency with the
168970040511      *****    highest value will be adjusted.  GGF uses the book value
168980040511      *****    for account percentages, all other clients use the market
168990040511      *****    value.
169000040511      *****
169010040511
169020040511           MOVE ZEROES                 TO  WS-ACCPCT-TOT.
169030040511R18194     MOVE ZEROES                 TO  WS-ACCBVTOT.
169040040511
169050040511           IF  WS-LDA-MGMT-COM-CDE
169060040511                          IS NOT EQUAL TO  "GGF"
169070040511               GO TO LS2-0000-0000-0000-0000-0010.
169080040511
169090040511R18194     SET CCS     TO       1.
169100040511   ¦
169110040511   ¦   LS2-0000-0000-0000-0000-0000.
169120040511   ¦
169130040511   ¦       IF WS-CC-CODE (CCS)   EQUAL TO  " "
169140040511   ¦          GO TO LS2-0000-0000-0000-0000-0005
169150040511   ¦       END-IF.
169160040511   ¦
169170040511   ¦       SET ACBV    TO       CCS.
169180040511   ¦       SEARCH WS-ACCOUNT-CURRENCY-TOT-ENT VARYING ACBV
169190040511   ¦          AT END
169200040511   ¦           GO TO LS2-0000-0000-0000-0000-0005
169210040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = " "
169220040511   ¦            SET CCS UP BY 1
169230040511   ¦            GO TO LS2-0000-0000-0000-0000-0000
169240040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = WS-CC-CODE(CCS)
169250040511   ¦            ADD WS-ACC-CUR-BVB (ACBV)   TO  WS-ACCBVTOT
169260040511   ¦       END-SEARCH.
169270040511   ¦
169280040511   ¦       SET CCS UP BY 1.
169290040511   ¦       GO TO LS2-0000-0000-0000-0000-0000.
169300040511   ¦
169310040511   ¦   LS2-0000-0000-0000-0000-0005.
169320040511   ¦
169330040511   ¦       SET CCS     TO       1.
169340040511   ¦
169350040511   ¦   LS2-0000-0000-0000-0000-0004.
169360040511   ¦
169370040511   ¦       IF WS-CC-CODE (CCS)   EQUAL TO  " "
169380040511   ¦          GO TO LS2-0000-0000-0000-0000-0020
169390040511   ¦       END-IF.
169400040511   ¦
169410040511   ¦       SET ACBV    TO       CCS.
169420040511   ¦       SEARCH WS-ACCOUNT-CURRENCY-TOT-ENT VARYING ACBV
169430040511   ¦          AT END    GO TO LS2-0000-0000-0000-0000-0020
169440040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = " "
169450040511   ¦            SET CCS UP BY 1
169460040511   ¦            GO TO LS2-0000-0000-0000-0000-0004
169470040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = WS-CC-CODE(CCS)
169480040511   ¦            SET ACP    TO ACBV
169490040511   ¦            IF WS-ACCBVTOT    IS EQUAL TO  ZEROES
169500040511   ¦               MOVE ZEROES             TO  WS-ACCPCT-CUR (ACP)
169510040511   ¦            ELSE
169520040511   ¦               COMPUTE WS-ACCPCT-CUR (ACP) ROUNDED
169530040511   ¦                                     =  (WS-ACC-CUR-BVF (ACBV)
169540040511   ¦                                     *   100)
169550040511   ¦                                     /  WS-ACCBVTOT
169560040511   ¦            END-IF
169570040511   ¦            ADD WS-ACCPCT-CUR (ACP) TO WS-ACCPCT-TOT
169580040511   ¦       END-SEARCH.
169590040511   ¦
169600040511   ¦       SET CCS UP BY 1.
169610040511   ¦       GO TO LS2-0000-0000-0000-0000-0004.
169620040511   ¦
169630040511   ¦   LS2-0000-0000-0000-0000-0010.
169640040511   ¦
169650040511   ¦       SET CCS     TO       1.
169660040511   ¦
169670040511   ¦   LS2-0000-0000-0000-0000-0015.
169680040511   ¦
169690040511   ¦       IF WS-CC-CODE (CCS)   EQUAL TO  " "
169700040511   ¦          GO TO LS2-0000-0000-0000-0000-0020
169710040511   ¦       END-IF.
169720040511   ¦
169730040511   ¦       SET ACBV    TO       CCS.
169740040511   ¦       SEARCH WS-ACCOUNT-CURRENCY-TOT-ENT VARYING ACBV
169750040511   ¦          AT END    GO TO LS2-0000-0000-0000-0000-0020
169760040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = " "
169770040511   ¦            SET CCS UP BY 1
169780040511   ¦            GO TO LS2-0000-0000-0000-0000-0015
169790040511   ¦          WHEN WS-INV-CUR-CODE(ACBV) = WS-CC-CODE(CCS)
169800040511   ¦            SET ACP    TO ACBV
169810040511   ¦            IF WS-TOTAL-VALUE IS EQUAL TO  ZEROES
169820040511   ¦               MOVE ZEROES             TO  WS-ACCPCT-CUR (ACP)
169830040511   ¦            ELSE
169840040511   ¦               IF WS-LDA-PERC-DECIMAL EQUAL TO "S"
169850040511   ¦                  MOVE ZEROES TO WS-ACCPCT-CUR-PHN (ACP)
169860040511   ¦                  COMPUTE WS-ACCPCT-CUR-PHN (ACP) ROUNDED
169870040511   ¦                                    =  (WS-ACC-CUR-MVB (ACBV)
169880040511   ¦                                    *   100)
169890040511   ¦                                    /  WS-TOTAL-VALUE
169900040511   ¦                  MOVE WS-ACCPCT-CUR-PHN (ACP)
169910040511   ¦                                           TO WS-ACCPCT-CUR (ACP)
169920040511   ¦               ELSE
169930040511   ¦                   COMPUTE WS-ACCPCT-CUR (ACP) ROUNDED
169940040511   ¦                                     =  (WS-ACC-CUR-MVB (ACBV)
169950040511   ¦                                     *   100)
169960040511   ¦                                     /  WS-TOTAL-VALUE
169970040511   ¦               END-IF
169980040511   ¦               ADD WS-ACCPCT-CUR (ACP) TO WS-ACCPCT-TOT
169990040511   ¦            END-IF
170000040511   ¦       END-SEARCH.
170010040511   ¦
170020040511   ¦       SET CCS UP BY 1.
170030040511   ¦       GO TO LS2-0000-0000-0000-0000-0015.
170040040511   ¦
170050040511   ¦   LS2-0000-0000-0000-0000-0020.
170060040511   ¦
170070040511   ¦       IF WS-ACCPCT-TOT  IS EQUAL TO  ZEROES
170080000000   ¦          MOVE ZEROES                             TO  WS-ACCPCT
170090000000   ¦       ELSE
170100000000   ¦          SUBTRACT WS-ACCPCT-TOT FROM  100.00 GIVING  WS-ACCPCT
170110000000   ¦       END-IF.
170120990127   ¦
170130990127   ¦       MOVE ZEROES            TO   WS-ACCPCT-HOLD.
170140990127   ¦       SET ACPS     TO 1
170150990127   ¦       SEARCH WS-ACCOUNT-CURRENCY-PERCT-ENT VARYING ACPS
170160990127   ¦           AT END  GO TO LS2-0000-0000-0000-0000-0025
170170990127   ¦           WHEN  WS-ACCPCT-CUR (ACPS)    > WS-ACCPCT-HOLD
170180990302   ¦              MOVE WS-ACCPCT-CUR (ACPS) TO WS-ACCPCT-HOLD
170190990302   ¦              ADD  WS-ACCPCT            TO WS-ACCPCT-CUR (ACPS)
170200990302   ¦       END-SEARCH.
170210040511   v
170220040511R18194 LS2-0000-0000-0000-0000-0025.
170230040511
170240040511      *------------------------------------------------*
170250040511      *  CREATE TOTAL LINES FOR EACH CURRENCY          *
170260040511      *------------------------------------------------*
170270040511
170280040511           MOVE ZEROES                 TO  AD-UNITS-BOUGHT-LTD.
170290040511           MOVE SPACE                  TO  AD-UNITS-BOUGHT-LTD-SIGN.
170300040511           MOVE ZEROES                 TO  AD-UNITS-SOLD-LTD.
170310040511           MOVE SPACE                  TO  AD-UNITS-SOLD-LTD-SIGN.
170320040511           MOVE ZEROES                 TO  AD-UNITS-DIV-LTD.
170330040511           MOVE SPACE                  TO  AD-UNITS-DIV-LTD-SIGN.
170340040511           MOVE ZEROES                 TO  AD-BOOK-VALUE-PRIOR.
170350040511           MOVE SPACE                  TO  AD-BOOK-VALUE-PRIOR-SIGN.
170360040511
170370040511R18194     SET ACBV TO 1.
170380040511   ¦
170390040511   ¦   LS2-0000-0000-0000-0000-0030.
170400040511   ¦
170410040511   ¦       IF WS-INV-CUR-CODE(ACBV) = " "
170420040511   ¦          GO TO LS2-0000-0000-0000-0000-0035
170430040511   ¦       ELSE
170440040511   ¦          SET CC TO 1
170450971223   ¦          SEARCH WS-CURCDE-ENT VARYING CC
170460971223   ¦             AT END GO TO  LS2-0000-0000-0000-0000-0035
170470000000   ¦               WHEN WS-CC-CODE(CC) = WS-INV-CUR-CODE(ACBV)
170480000000   ¦                 PERFORM POPULATE-SECTION20-TOTAL THRU PS20T-EXIT
170490000000   ¦          END-SEARCH
170500010410   ¦       END-IF.
170510010410   ¦
170520010410   ¦   LS2-0000-0000-0000-0000-0035.
170530010410   ¦
170540010410   ¦       IF ACBV       IS GREATER THAN  WS-CC-LST
170550020731   ¦          GO TO LS2-0000-0000-0000-0020
170560010410   ¦       END-IF.
170570020731   ¦
170580020731   v       SET ACBV                 UP BY  1.
170590061003R18194     GO TO LS2-0000-0000-0000-0000-0030.
170600061003
170610020731       LS2-0000-0000-0000-0020.
170620161107
170630020731      *------------------------------------------------*
170640020731      *  SUBSECTION TOTAL - ACCOUNT                    *
170650020731      *------------------------------------------------*
170660140925               MOVE "TOTAL"            TO  AD-INVESTMENT-NAME.
170670140925               MOVE 0                  TO  AD-NO-OF-UNITS.
170680140925               MOVE SPACES             TO  AD-CURRENCY.
170690200609               MOVE "TOTAL"            TO  AD-CURRENCY-DESCRIPTION.
170700200609RF8359         MOVE ZEROS              TO  AD-BOOK-VALUE.
170710200622      * RFS185916 - Begins
170720200609               MOVE SPACES             TO  AD-PROD-TYPE-CODE.
170730970423      * RFS185916 - Ends
170740010410
170750011203RF7776         MOVE WS-BOOK-TOTAL-ACCT TO  AD-BOOK-VALUE-BASE.
170760970423R13637     IF       WS-BOOK-TOTAL-ACCT     IS LESS THAN 0
170770970530  ¦             MOVE "-" TO AD-BOOK-VALUE-SIGN
170780970526R35540     ELSE
170790981201R35540          MOVE " " TO AD-BOOK-VALUE-SIGN
170800971122R13637     END-IF.
170810971224164313     PERFORM DISTRIBUTION-ACCTOT-TOT-LEVEL THRU DATL-EXIT.
170820971224
170830010105           MOVE WS-ACC-VALUE           TO  AD-MARKET-VALUE.
170840060621           MOVE WS-ACC-VALUE           TO  AD-MARKET-VALUE-BASE.
170850040511      * RFS 139952 - begin RM
170860020731           MOVE Ws-Ad-Accr-Int         TO  Ad-Accrued-Interest.
170870150817      * RFS 139952 - end   RM
170880020731           MOVE 0                      TO  AD-ACB-UNIT-PRICE.
170890020731           MOVE ZEROES                 TO  AD-ACB-UNIT-PRICE-BASE.
170900061003RF9925     MOVE ZEROES                 TO  AD-LAST-UNIT-PRICE-BASE.
170910061003R10919     MOVE ZEROES                 TO  AD-LAST-UNIT-PRICE.
170920020731           SET CC                      TO  WS-CC-BSE.
170930010105           MOVE WS-CC-RTECLS (CC)      TO  AD-EXCHANGE-RATE.
170940971224           MOVE 100.00                 TO  AD-ACCOUNT-PERC.
170950971223           MOVE 100.00                 TO  AD-BOOK-PERC.
170960971223           MOVE SPACES                 TO  AD-FUND-NO.
170970061003           ADD WS-ACC-CDN-CPG
170980061003               WS-ACC-USD-CPG      GIVING  AD-CPG-FIXED.
170990030826
171000030826R18194     MOVE WS-INV-ACC-MVP-TOT-CUR
171010040512R18194                             TO      AD-MARKET-VALUE-PRIOR
171020980604                                           AD-MARKET-VALUE-PRIOR-EX.
171030980604150035     ADD  ln_S20RetrnInterest1 TO  AD-MARKET-VALUE-PRIOR.
171040980604R13637     IF  AD-MARKET-VALUE-PRIOR-EX IS LESS THAN 0
171050980627  ¦             MOVE "-" TO AD-MARKET-VALUE-PRIOR-SIGN
171060980627R35540     ELSE
171070980627R35540          MOVE " " TO AD-MARKET-VALUE-PRIOR-SIGN
171080980627R13637     END-IF.
171090990127
171100990127           IF  (WS-ACC-CDN-CPG          +  WS-ACC-USD-CPG)
171110130614                             IS LESS THAN  ZEROES
171120130614               MOVE "-"                TO  AD-CPG-FIXED-SIGN
171130130614R35540     ELSE
171140130614R35540         MOVE " "                TO  AD-CPG-FIXED-SIGN
171150130614           END-IF.
171160130614
171170130614R18194     IF  WS-INVAUCACC-SW         EQUAL TO  "Y"
171180130614               MOVE "Y"                TO  AD-INVALID-AVERAGE-COST
171190140603             ELSE
171200140507               MOVE "N"                TO  AD-INVALID-AVERAGE-COST.
171210140507           IF  WS-LDA-MGMT-COM-CDE
171220140603                              IS EQUAL TO  "GGF"
171230130614           AND WS-INVAUCACC-SW   EQUAL TO  "Y"
171240140613               MOVE "Y"                TO  AD-INVALID-AVERAGE-COST.
171250140613           MOVE 999999       TO AD-SECTION-SEQUENCE.
171260140613
171270130614117038*- Get Account Investment Group, Maturity Date, Effective Date
171280130614117038     Initialize ld_S22AccountEffectiveDate,
171290140613117038                ld_S22AccountMaturityDate,
171300140613117038                lc_S22AccountInvestmentGrp,
171310140613117038                lc_S22AccountInvestmentDesc.
171320130614117038     Move AD-ACCOUNT  To li_S22AcctNo.
171330130614
171340130614117038     Exec SQL
171350130614      * RFS134626 - START
171360130614117038*      Select EFFECTIVE_DATE,
171370130614             Select EFFECTIV_DATE,
171380130614      * RFS134626 - END
171390130614117038              ACCOUNT_MATURITY_DATE,
171400130614124070*             ACCOUNT_INVESTMENT_GROUP
171410130614124070              ACCOUNT_INVESTMENT_GROUP,
171420130614124070              FINAL_TOPUP_DATE
171430130614117038         into :ld_S22AccountEffectiveDate,
171440130614117038              :ld_S22AccountMaturityDate,
171450130614124070*             :lc_S22AccountInvestmentGrp
171460990528124070              :lc_S22AccountInvestmentGrp,
171470990528124070              :ld_S22FinalToupdate
171480000818117038         from MFAACMDP
171490000818117038        where Account_no = :li_S22AcctNo
171500000818117038     End-Exec.
171510000818
171520000818117038     If lc_S22AccountInvestmentGrp Not = " "
171530081120117038       Exec SQL
171540081120117038         Select DESCRIPTION
171550081120117038           into :lc_S22AccountInvestmentDesc
171560150216117038           from MFAISTRP
171570000817117038          where INVESTMENT_STRUCTURE_CODE =
171580021004117038                :lc_S22AccountInvestmentGrp
171590021004117038       End-Exec
171600021004117038     End-If.
171610061003
171620061003           MOVE SPACES                 TO  AD-INVESTMENT-GRP-CATEGORY.
171630021004           MOVE SPACES                 TO  AD-INVESTMENT-GRP-CAT-DESC.
171640021004
171650021004RF7503     MOVE WS-ACC-CDN-MVB-Q1  TO  AD-MARKET-VALUE-PRIOR-Q1.
171660021004           MOVE WS-ACC-CDN-MVB-Q2  TO  AD-MARKET-VALUE-PRIOR-Q2.
171670021004           MOVE WS-ACC-CDN-MVB-Q3  TO  AD-MARKET-VALUE-PRIOR-Q3.
171680061003           MOVE WS-ACC-CDN-MVB-Q4  TO  AD-MARKET-VALUE-PRIOR-Q4.
171690061003      *RFS 50492 - Begin
171700021004           MOVE SPACES             TO  AD-DORMANT-FUND.
171710021004      *RFS 50492 - End
171720021004143392     MOVE SPACES             TO  AD-DSC.
171730021004
171740021004           MOVE WS-ACC-BAJ-CUR     TO AD-BAJ-CUR.
171750061003R14858     IF   WS-ACC-BAJ-CUR       IS LESS THAN ZEROES
171760061003  ¦           MOVE "-"  TO  AD-BAJ-CUR-SIGN
171770021004R35540     ELSE
171780021004R35540        MOVE " "  TO  AD-BAJ-CUR-SIGN
171790021004R14858     END-IF.
171800021004
171810021004           MOVE WS-ACC-BAJ-YTD     TO AD-BAJ-YTD.
171820061003R14858     IF   WS-ACC-BAJ-YTD       IS LESS THAN ZEROES
171830061003  ¦           MOVE "-"  TO  AD-BAJ-YTD-SIGN
171840021004R35540     ELSE
171850021004R35540        MOVE " "  TO  AD-BAJ-YTD-SIGN
171860021004R14858     END-IF.
171870021004
171880021004           MOVE WS-ACC-BAJ-INCEPT  TO AD-BAJ-INCEPT.
171890061003R14858     IF   WS-ACC-BAJ-INCEPT    IS LESS THAN ZEROES
171900061003  ¦           MOVE "-"  TO  AD-BAJ-INCEPT-SIGN
171910021004R35540     ELSE
171920021004R35540        MOVE " "  TO  AD-BAJ-INCEPT-SIGN
171930021004R14858     END-IF.
171940021004
171950021004           MOVE WS-ACC-BFW-CUR     TO AD-BFW-CUR.
171960061003R14858     IF   WS-ACC-BFW-CUR       IS LESS THAN ZEROES
171970061003  ¦           MOVE "-"  TO  AD-BFW-CUR-SIGN
171980021004R35540     ELSE
171990021004R35540        MOVE " "  TO  AD-BFW-CUR-SIGN
172000040414R14858     END-IF.
172010040414
172020040414           MOVE WS-ACC-BFW-YTD     TO AD-BFW-YTD.
172030061003R14858     IF   WS-ACC-BFW-YTD       IS LESS THAN ZEROES
172040061003  ¦           MOVE "-"  TO  AD-BFW-YTD-SIGN
172050040414R35540     ELSE
172060040414R35540        MOVE " "  TO  AD-BFW-YTD-SIGN
172070040414R14858     END-IF.
172080040414
172090040414           MOVE WS-ACC-BFW-INCEPT  TO AD-BFW-INCEPT.
172100061003R14858     IF   WS-ACC-BFW-INCEPT    IS LESS THAN ZEROES
172110061003  ¦           MOVE "-"  TO  AD-BFW-INCEPT-SIGN
172120040414R35540     ELSE
172130040414R35540        MOVE " "  TO  AD-BFW-INCEPT-SIGN
172140040414R14858     END-IF.
172150040414
172160040414R20758     MOVE WS-ACC-ROC-YTD     TO AD-ROC-YTD.
172170061003  ¦        IF   WS-ACC-ROC-YTD       IS LESS THAN ZEROES
172180061003  ¦           MOVE "-"  TO  AD-ROC-YTD-SIGN
172190040414R35540     ELSE
172200050914R35540        MOVE " "  TO  AD-ROC-YTD-SIGN
172210061103R20758     END-IF.
172220050921
172230050914R20758     MOVE WS-ACC-ROC-CUR     TO AD-ROC-CUR.
172240050914  ¦        IF   WS-ACC-ROC-CUR       IS LESS THAN ZEROES
172250061003  ¦           MOVE "-"  TO  AD-ROC-CUR-SIGN
172260061003R35540     ELSE
172270050914R35540        MOVE " "  TO  AD-ROC-CUR-SIGN
172280050914R20758     END-IF.
172290050914
172300050914R20758     MOVE WS-ACC-ROC-INCEPT  TO AD-ROC-INCEPT.
172310050914  ¦        IF   WS-ACC-ROC-INCEPT    IS LESS THAN ZEROES
172320061003  ¦           MOVE "-"  TO  AD-ROC-INCEPT-SIGN
172330061003R35540     ELSE
172340050914R35540        MOVE " "  TO  AD-ROC-INCEPT-SIGN
172350050914R20758     END-IF.
172360050914
172370050914R36342     IF lb-LdaAccountAdditionalInfoYes
172380050914  ¦        MOVE WS-ACC-PURCH-LAST-12-MONTHS TO AAI-PURCH-LAST-12-MONTHS
172390061003  ¦        IF   WS-ACC-PURCH-LAST-12-MONTHS   IS LESS THAN ZEROES
172400061003  ¦         MOVE "-"  TO  AAI-PURCH-LAST-12-MONTHS-SIGN
172410050914R35540     ELSE
172420050914R35540      MOVE " "  TO  AAI-PURCH-LAST-12-MONTHS-SIGN
172430050914  ¦        END-IF
172440050914  ¦
172450050914  ¦        MOVE WS-ACC-REDEM-LAST-12-MONTHS TO AAI-REDEM-LAST-12-MONTHS
172460061003  ¦        IF   WS-ACC-REDEM-LAST-12-MONTHS   IS LESS THAN ZEROES
172470061003  ¦         MOVE "-"  TO  AAI-REDEM-LAST-12-MONTHS-SIGN
172480050921R35540     ELSE
172490061024R35540      MOVE " "  TO  AAI-REDEM-LAST-12-MONTHS-SIGN
172500061024  ¦        END-IF
172510061024  ¦
172520061024  ¦        MOVE WS-ACC-TRI-LAST-12-MONTHS TO AAI-TRI-LAST-12-MONTHS
172530061024  ¦        IF   WS-ACC-TRI-LAST-12-MONTHS   IS LESS THAN ZEROES
172540061024  ¦         MOVE "-"  TO  AAI-TRI-LAST-12-MONTHS-SIGN
172550061024R35540     ELSE
172560061024R35540      MOVE " "  TO  AAI-TRI-LAST-12-MONTHS-SIGN
172570061024  ¦        END-IF
172580061024  ¦
172590061024  ¦        MOVE WS-ACC-TRO-LAST-12-MONTHS TO AAI-TRO-LAST-12-MONTHS
172600061024  ¦        IF   WS-ACC-TRO-LAST-12-MONTHS   IS LESS THAN ZEROES
172610061024  ¦         MOVE "-"  TO  AAI-TRO-LAST-12-MONTHS-SIGN
172620061024R35540     ELSE
172630061024R35540      MOVE " "  TO  AAI-TRO-LAST-12-MONTHS-SIGN
172640061024  ¦        END-IF
172650061024
172660061024      *RFS36342 - Starts
172670061024           MOVE ln_AccCurrDispProceedsBase
172680061024             TO AAI-CURR-DISP-PROCEEDS-BASE
172690061024           IF ln_AccCurrDispProceedsBase  <  0
172700061024              MOVE "-"  TO AAI-CURR-DISP-PROCEEDS-BASE-S
172710061024           ELSE
172720061024              MOVE " "  TO AAI-CURR-DISP-PROCEEDS-BASE-S
172730061024           END-IF
172740061024
172750061101           MOVE ln_AccCurrDispBookValueBase
172760061101             TO AAI-CURR-DISP-BOOK-VAL-BASE
172770061101           IF ln_AccCurrDispBookValueBase  <  0
172780061101              MOVE "-"  TO AAI-CURR-DISP-BOOK-VAL-BASE-S
172790061024           ELSE
172800061101              MOVE " "  TO AAI-CURR-DISP-BOOK-VAL-BASE-S
172810061024           END-IF
172820061024
172830061101           MOVE ln_AccCurrDispGainLossBase
172840061101             TO AAI-CURR-DISP-GAIN-LOSS-BASE
172850061101           IF ln_AccCurrDispGainLossBase  <  0
172860061101              MOVE "-"  TO AAI-CURR-DISP-GAIN-LOSS-BASE-S
172870061024           ELSE
172880061101              MOVE " "  TO AAI-CURR-DISP-GAIN-LOSS-BASE-S
172890061024           END-IF
172900061024
172910061031           MOVE ln_AccGrossSoldYtdBase
172920061024             TO AAI-GROSS-SOLD-YTD-BASE
172930061031           IF ln_AccGrossSoldYtdBase  <  0
172940061024              MOVE "-"  TO AAI-GROSS-SOLD-YTD-BASE-SIGN
172950061024           ELSE
172960061024              MOVE " "  TO AAI-GROSS-SOLD-YTD-BASE-SIGN
172970061024           END-IF
172980061024
172990061031           MOVE ln_AccGrossSoldCurrBase
173000061024             TO AAI-GROSS-SOLD-CURR-BASE
173010061031           IF ln_AccGrossSoldCurrBase  <  0
173020061024              MOVE "-"  TO AAI-GROSS-SOLD-CURR-BASE-SIGN
173030061024           ELSE
173040061024              MOVE " "  TO AAI-GROSS-SOLD-CURR-BASE-SIGN
173050061024           END-IF
173060061024
173070050921           MOVE ln_AccDeductionsCdscYtdBase
173080040414             TO AAI-DEDUCTIONS-DSC-YTD-BASE
173090070423           IF ln_AccDeductionsCdscYtdBase  <  0
173100070417              MOVE "-"  TO AAI-DEDUCTIONS-DSC-YTD-BASE-S
173110070417           ELSE
173120070417              MOVE " "  TO AAI-DEDUCTIONS-DSC-YTD-BASE-S
173130070417           END-IF
173140020730
173150061003           MOVE ln_AccDeductionsCdscCurrBase
173160061003             TO AAI-DEDUCTIONS-DSC-CURR-BASE
173170020731           IF ln_AccDeductionsCdscCurrBase  <  0
173180020730              MOVE "-"  TO AAI-DEDUCTIONS-DSC-CURR-BASE-S
173190080317           ELSE
173200080317              MOVE " "  TO AAI-DEDUCTIONS-DSC-CURR-BASE-S
173210080317           END-IF
173220080317      *RFS36342 - Ends
173230020730R28931     END-IF
173240061003
173250061003R38791* Begin - Include 38791 changes.
173260020731R38791* R10902     MOVE WS-IVR-PUR-INCEPT-EX    TO  AD-PUR-INCEPT.
173270020730R38791* R13637     IF   WS-IVR-PUR-INCEPT-EX     IS LESS THAN ZEROES
173280070503R38791     MOVE WS-ACC-PUR-INCEPT-EX    TO  AD-PUR-INCEPT.
173290070503R38791     IF   WS-ACC-PUR-INCEPT-EX     IS LESS THAN ZEROES
173300070503  ¦           MOVE "-"  TO  AD-PI-SIGN
173310061003R35540     ELSE
173320061003R35540        MOVE " "  TO  AD-PI-SIGN
173330020731R13637     END-IF.
173340020730
173350070514R49490*    MOVE WS-IVR-PUR-CURRENT-EX   TO  AD-PUR-CURRENT.
173360070514R49490*    IF   WS-IVR-PUR-CURRENT-EX   IS LESS THAN ZEROES
173370070514R49490     MOVE WS-ACC-PUR-CURRENT-EX   TO  AD-PUR-CURRENT.
173380061003R49490     IF   WS-ACC-PUR-CURRENT-EX   IS LESS THAN ZEROES
173390061003  ¦           MOVE "-"  TO  AD-PC-SIGN
173400020731R35540     ELSE
173410020730R35540        MOVE " "  TO  AD-PC-SIGN
173420070503R13637     END-IF.
173430070503
173440070503R41355     MOVE WS-ACC-RED-INCEPT-EX  TO  AD-RED-INCEPT.
173450061003R41355     IF   WS-ACC-RED-INCEPT-EX  IS LESS THAN ZEROES
173460061003R13637        MOVE "-"  TO  AD-RI-SIGN
173470020730R35540     ELSE
173480020730R35540        MOVE " "  TO  AD-RI-SIGN
173490010604R13637     END-IF
173500020806
173510020730R41355     MOVE WS-ACC-RED-CURRENT-EX  TO  AD-RED-CURRENT.
173520061003R41355     IF   WS-ACC-RED-CURRENT-EX  IS LESS THAN ZEROES
173530061003R13637        MOVE "-"  TO  AD-RC-SIGN
173540020731R35540     ELSE
173550020730R35540        MOVE " "  TO  AD-RC-SIGN
173560070514R13637     END-IF.
173570070514
173580070514R41355     MOVE WS-ACC-TRI-INCEPT-EX  TO  AD-TRI-INCEPT.
173590061003R41355     IF   WS-ACC-TRI-INCEPT-EX  IS LESS THAN ZEROES
173600061003R13637        MOVE "-"  TO  AD-TI-SIGN
173610020731R35540     ELSE
173620031114R35540        MOVE " "  TO  AD-TI-SIGN
173630031114R13637     END-IF.
173640031114
173650031114R10533     MOVE WS-ACC-TRO-CURRENT-EX TO  AD-TRO-CURRENT.
173660031216R13637     IF   WS-ACC-TRO-CURRENT-EX     IS LESS THAN ZEROES
173670031216  ¦           MOVE "-"  TO  AD-OC-SIGN
173680031216R35540     ELSE
173690061003R35540        MOVE " "  TO  AD-OC-SIGN
173700061003R13637     END-IF.
173710061003
173720061003R41355     MOVE WS-ACC-TRI-CURRENT-EX  TO  AD-TRI-CURRENT.
173730031114R41355     IF   WS-ACC-TRI-CURRENT-EX  IS LESS THAN ZEROES
173740031114R13637        MOVE "-"  TO  AD-TC-SIGN
173750031114R35540     ELSE
173760031114R35540        MOVE " "  TO  AD-TC-SIGN
173770031216R13637     END-IF.
173780031216
173790031216R18312     ADD  WS-ACC-BUY-CURRENT
173800061003  ¦             WS-ACC-TRI-CURRENT
173810061003  ¦             WS-ACC-SWI-CURRENT
173820061003  ¦               GIVING   AD-DEPOSIT
173830061003  ¦                        WS-DEPOSIT-TOT.
173840031114  ¦        IF   WS-DEPOSIT-TOT   IS LESS THAN  ZEROES
173850031125R18312          MOVE  "-"    TO   AD-DEPOSIT-SIGN
173860031125R35540     ELSE
173870031114R35540          MOVE  " "    TO   AD-DEPOSIT-SIGN
173880031114R35540     END-IF.
173890051111
173900051111R18312     ADD  WS-ACC-SEL-CURRENT
173910031114  ¦             WS-ACC-TRO-CURRENT
173920031114  ¦             WS-ACC-SWO-CURRENT
173930031114  ¦               GIVING   AD-WITHDRAWALS
173940031114  ¦                        WS-WITHD-TOT.
173950031114  ¦        IF   WS-WITHD-TOT   IS LESS THAN  ZEROES
173960031114R18312          MOVE  "-"    TO   AD-WITHDRAWALS-SIGN
173970031114R35540     ELSE
173980031114R35540          MOVE  " "    TO   AD-WITHDRAWALS-SIGN
173990031114R35540     END-IF.
174000031114
174010061027R18312     COMPUTE WS-FGN-CONT-PCT ROUNDED =
174020061003  ¦                                   (WS-BOOK-FGN-ACCT * 100)
174030061027  ¦                                    / WS-BOOK-TOTAL-ACCT.
174040031114  ¦
174050020730R30514     COMPUTE WS-AVAIL-FGN-CONT-PCT  = WS-FOREIGN-CONTENT-LIMIT
174060010604R30514                                    - WS-FGN-CONT-PCT.
174070020730
174080020730R18312     IF  WS-AVAIL-FGN-CONT-PCT IS LESS THAN 0
174090061003  ¦            MOVE ZEROES TO WS-AVAIL-FGN-CONTENT
174100061003  ¦        ELSE
174110030826  ¦        COMPUTE  WS-AVAIL-FGN-CONTENT = (WS-BOOK-TOTAL-ACCT *
174120020730  ¦                               WS-AVAIL-FGN-CONT-PCT) / 100
174130030826R18312     END-IF
174140020923
174150020923R18312     MOVE WS-AVAIL-FGN-CONTENT TO AD-AVAIL-FGN-CONTENT
174160061003  ¦        IF   WS-AVAIL-FGN-CONTENT IS LESS THAN ZEROES
174170061003  ¦             MOVE "-" TO  AD-AVAIL-FGN-CONTENT-SIGN
174180020923R35540     ELSE
174190020923R35540          MOVE " " TO  AD-AVAIL-FGN-CONTENT-SIGN
174200030826R18312     END-IF.
174210020923
174220020923R10533     MOVE WS-ACC-TRO-INCEPT-EX  TO  AD-TRO-INCEPT.
174230061003R13637     IF   WS-ACC-TRO-INCEPT-EX   IS LESS THAN ZEROES
174240061003  ¦           MOVE "-"  TO  AD-OI-SIGN
174250020923R35540     ELSE
174260021202R35540        MOVE " "  TO  AD-OI-SIGN
174270030317R13637     END-IF.
174280030317
174290030317R14556     MOVE WS-ACC-TRI-INCEPT-COST-EX  TO AD-TRI-INCEPT-COST.
174300061003           IF WS-ACC-TRI-INCEPT-COST-EX    IS LESS THAN ZEROES
174310061003              MOVE "-"                     TO AD-TRI-INCEPT-COST-SIGN
174320030317R35540     ELSE
174330030317R35540        MOVE " "                     TO AD-TRI-INCEPT-COST-SIGN
174340030317           END-IF.
174350030317
174360030317           MOVE WS-ACC-TRO-INCEPT-COST-EX  TO AD-TRO-INCEPT-COST.
174370061003           IF WS-ACC-TRO-INCEPT-COST-EX    IS LESS THAN ZEROES
174380061003              MOVE "-"                     TO AD-TRO-INCEPT-COST-SIGN
174390030317R35540     ELSE
174400030317R35540        MOVE " "                     TO AD-TRO-INCEPT-COST-SIGN
174410030624R14556     END-IF.
174420030624
174430030624R16256     MOVE WS-ACC-TRI-INCEPT-MKT-EX   TO AD-TRI-INCEPT-MKT.
174440061003   ¦       IF WS-ACC-TRI-INCEPT-MKT-EX     IS LESS THAN ZEROES
174450061003   ¦          MOVE "-"                     TO AD-TRI-INCEPT-MKT-SIGN
174460030624R35540     ELSE
174470030624R35540        MOVE " "                     TO AD-TRI-INCEPT-MKT-SIGN
174480030624   ¦       END-IF.
174490030624   ¦
174500030624   ¦       MOVE WS-ACC-TRO-INCEPT-MKT-EX   TO AD-TRO-INCEPT-MKT.
174510061003   ¦       IF WS-ACC-TRO-INCEPT-MKT-EX     IS LESS THAN ZEROES
174520061003   ¦          MOVE "-"                     TO AD-TRO-INCEPT-MKT-SIGN
174530030624R35540     ELSE
174540030624R35540        MOVE " "                     TO AD-TRO-INCEPT-MKT-SIGN
174550030624R16256     END-IF.
174560030624
174570030624R16881     MOVE WS-ACC-TRI-INCEPT-PH-EX  TO AD-TRI-INCEPT-PHANTOM.
174580061003   ¦       IF WS-ACC-TRI-INCEPT-PH-EX    IS LESS THAN ZEROES
174590061003   ¦          MOVE "-"                   TO AD-TRI-INCEPT-PHANTOM-SIGN
174600030624R35540     ELSE
174610030624R35540        MOVE " "                   TO AD-TRI-INCEPT-PHANTOM-SIGN
174620030624   ¦       END-IF.
174630030624   ¦
174640030624   ¦       MOVE WS-ACC-TRI-YTD-PH-EX     TO AD-TRI-YTD-PHANTOM
174650061003   ¦       IF WS-ACC-TRI-YTD-PH-EX       IS LESS THAN ZEROES
174660061003   ¦          MOVE "-"                   TO AD-TRI-YTD-PHANTOM-SIGN
174670030624R35540     ELSE
174680030624R35540        MOVE " "                   TO AD-TRI-YTD-PHANTOM-SIGN
174690030624   ¦       END-IF.
174700030624   ¦
174710030624   ¦       MOVE WS-ACC-TRI-CUR-PH-EX     TO AD-TRI-CUR-PHANTOM.
174720061003   ¦       IF WS-ACC-TRI-CUR-PH-EX       IS LESS THAN ZEROES
174730061003   ¦          MOVE "-"                   TO AD-TRI-CUR-PHANTOM-SIGN
174740030624R35540     ELSE
174750030624R35540        MOVE " "                   TO AD-TRI-CUR-PHANTOM-SIGN
174760030624   ¦       END-IF.
174770030624   ¦
174780030624   ¦       MOVE WS-ACC-TRO-INCEPT-PH-EX  TO AD-TRO-INCEPT-PHANTOM.
174790061003   ¦       IF WS-ACC-TRO-INCEPT-PH-EX    IS LESS THAN ZEROES
174800061003   ¦          MOVE "-"                   TO AD-TRO-INCEPT-PHANTOM-SIGN
174810030624R35540     ELSE
174820030624R35540        MOVE " "                   TO AD-TRO-INCEPT-PHANTOM-SIGN
174830021202   ¦       END-IF.
174840030826   ¦
174850021202   ¦       MOVE WS-ACC-TRO-YTD-PH-EX     TO AD-TRO-YTD-PHANTOM
174860021202   ¦       IF WS-ACC-TRO-YTD-PH-EX       IS LESS THAN ZEROES
174870061003   ¦          MOVE "-"                   TO AD-TRO-YTD-PHANTOM-SIGN
174880061003R35540     ELSE
174890021202R35540        MOVE " "                   TO AD-TRO-YTD-PHANTOM-SIGN
174900021202   ¦       END-IF.
174910021202   ¦
174920030826   ¦       MOVE WS-ACC-TRO-CUR-PH-EX     TO AD-TRO-CUR-PHANTOM.
174930021202   ¦       IF WS-ACC-TRO-CUR-PH-EX       IS LESS THAN ZEROES
174940021202   v          MOVE "-"                   TO AD-TRO-CUR-PHANTOM-SIGN
174950061003R35540     ELSE
174960061003R35540        MOVE " "                   TO AD-TRO-CUR-PHANTOM-SIGN
174970021202R16881     END-IF.
174980021202
174990021202R15022     MOVE WS-ACC-DISP-GAIN-LOSS-CUR-EX
175000030826             TO AD-DISP-GAIN-LOSS-CUR,
175010021202           IF WS-ACC-DISP-GAIN-LOSS-CUR-EX IS LESS THAN ZEROES
175020021202              MOVE "-"             TO AD-DISP-GAIN-LOSS-CUR-SIGN
175030061003R35540     ELSE
175040061003R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-CUR-SIGN
175050021202R15022     END-IF.
175060020923
175070070503R15022     MOVE WS-ACC-DISP-GAIN-LOSS-YTD-EX
175080070503             TO AD-DISP-GAIN-LOSS-YTD.
175090020403           IF WS-ACC-DISP-GAIN-LOSS-YTD-EX IS LESS THAN ZEROES
175100020403              MOVE "-"             TO AD-DISP-GAIN-LOSS-YTD-SIGN
175110020403R35540     ELSE
175120061003R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-YTD-SIGN
175130061003R15022     END-IF.
175140020403
175150020403R15022     MOVE WS-ACC-DISP-GAIN-LOSS-INC-EX
175160020403             TO AD-DISP-GAIN-LOSS-INCEPT.
175170020403           IF WS-ACC-DISP-GAIN-LOSS-INC-EX IS LESS THAN ZEROES
175180061003              MOVE "-"             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
175190061003R35540     ELSE
175200020403R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
175210001228R15022     END-IF.
175220031003
175230031003R41355     MOVE WS-ACC-SWI-INCEPT-EX  TO  AD-SWI-INCEPT.
175240031003R41355     MOVE WS-ACC-SWO-INCEPT-EX  TO  AD-SWO-INCEPT.
175250050830
175260050830R13122     IF WS-ACC-RED-INCEPT   IS LESS THAN ZEROES
175270031003  ¦           MOVE "-"  TO  AD-RI-SIGN
175280060621R35540     ELSE
175290030825R35540        MOVE " "  TO  AD-RI-SIGN
175300050830R13122     END-IF.
175310061103
175320050914R13122     IF WS-ACC-RED-CURRENT  IS LESS THAN ZEROES
175330160613  ¦           MOVE "-"  TO  AD-RC-SIGN
175340160613R35540     ELSE
175350160613R35540        MOVE " "  TO  AD-RC-SIGN
175360160613R13122     END-IF.
175370050914
175380050914R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
175390050914   ¦          MOVE WS-IPS-GROUP-ID     TO AD-IPS-GROUP-ID
175400050914R17527     END-IF.
175410050914
175420050914
175430050914
175440050914R18147     MOVE ACCOUNT-DETAILS-SECTION TO STATEMENT-REC(ISR).
175450050914R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
175460050914
175470050914R36342     IF lb-LdaAccountAdditionalInfoYes
175480050914  ¦        MOVE AD-INVESTOR-NO       TO AAI-INVESTOR-NO
175490050914156335*    MOVE WS-EXT-LOAD-TYP      TO AAI-INVESTMENT-EXT-LOAD-TYPE
175500081031156335*    MOVE WS-EXT-LOAD-DESC     TO AAI-INVESTMENT-EXT-LOAD-DESC
175510081027156335*    MOVE WS-ASSET-CLASS-CD    TO AAI-ASSET-CLASS-CODE
175520081027156335*    MOVE WS-ASSET-CLASS-DESC  TO AAI-ASSET-CLASS-DESCRIPTION
175530081027  ¦        MOVE AD-ACCOUNT           TO AAI-ACCOUNT
175540081027  ¦        MOVE 21                   TO AAI-SECTION-NO
175550081027  ¦        MOVE AD-SECTION-SEQUENCE  TO AAI-SECTION-SEQUENCE
175560081031  ¦        MOVE AD-LANGUAGE          TO AAI-LANGUAGE
175570081027  ¦        MOVE AD-DEALER            TO AAI-DEALER
175580081027  ¦        MOVE AD-SALESREP          TO AAI-SALESREP
175590081027  ¦        MOVE AD-ACCOUNT-TYPE-SHORT TO AAI-ACCOUNT-TYPE-SHORT
175600081027  ¦        MOVE AD-ACCOUNT-TYPE       TO AAI-ACCOUNT-TYPE
175610081027  ¦        MOVE AD-INVESTMENT-NAME    TO AAI-INVESTMENT-NAME
175620081031  ¦        MOVE AD-START-DATE         TO AAI-START-DATE
175630081027  ¦        MOVE AD-END-DATE           TO AAI-END-DATE
175640081027  ¦        MOVE AD-EOR-INDICATOR      TO AAI-EOR-INDICATOR
175650081027  ¦        MOVE AD-SECTION-SEQUENCE-2 TO AAI-SECTION-SEQUENCE-2
175660081027R59263     IF  AD-SECTION-SEQUENCE  = 199999
175670081027R59263         MOVE WS-ACC-GMA-VALUE      TO AAI-GMA-VALUE
175680081027R59263         IF WS-ACC-GMA-VALUE     IS  LESS THAN ZEROS
175690160927R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
175700160927R59263         END-IF
175710160927R59263     END-IF
175720160927R59263     IF  AD-SECTION-SEQUENCE  = 299999
175730160927R59263         MOVE WS-ACC-GMA-VALUE-US   TO AAI-GMA-VALUE
175740160927R59263         IF WS-ACC-GMA-VALUE-US  IS  LESS THAN ZEROS
175750160927R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
175760160927R59263         END-IF
175770160927R59263     END-IF
175780160927R59263     IF  AD-SECTION-SEQUENCE  = 999999
175790081027R59263         ADD  WS-ACC-GMA-VALUE      TO WS-ACC-GMA-VALUE-EX
175800080925R59263         MOVE WS-ACC-GMA-VALUE-EX   TO AAI-GMA-VALUE
175810080925R59263         IF WS-ACC-GMA-VALUE-EX  IS  LESS THAN ZEROS
175820151205R59263           MOVE "-"                TO AAI-GMA-VALUE-SIGN
175830120316R59263         END-IF
175840120316R59263     END-IF
175850120316162904     IF  AD-SECTION-SEQUENCE  = 999999 OR
175860120316162904         AD-SECTION-SEQUENCE  = 299999
175870120316162904         MOVE ln_Inv-TRL-AMT TO AAI-YTD-TRAILER
175880120316162904         MOVE ZEROES TO ln_Inv-TRL-AMT
175890120316162904         IF AAI-YTD-TRAILER  IS  LESS THAN ZEROS
175900120316162904            MOVE "-"     TO AAI-YTD-TRAILER-SIGN
175910120316162904         END-IF
175920120316162904     END-IF
175930120316
175940120316
175950120316R50823
175960160301  |        MOVE 0                     TO AAI-GMP-CLOSING-DATE
175970050914R50823     MOVE 0                     TO AAI-GMP-PRICE
175980050830151145     MOVE lc_CrossRefNumber     TO AAI-CROSS-REF-NUMBER
175990050830102716     MOVE WS-ACC-CPG-YTD-EX     TO AAI-CPG-YTD
176000080925  |        IF WS-ACC-CPG-YTD-EX IS LESS THAN ZERO
176010050830  |           MOVE "-"                TO AAI-CPG-YTD-SIGN
176020130614  |        END-IF
176030130614  |
176040130614  |        MOVE WS-ACC-INC-YTD-EX     TO AAI-INC-YTD
176050130614  |        IF WS-ACC-INC-YTD-EX IS LESS THAN ZERO
176060970526  |           MOVE "-"                TO AAI-INC-YTD-SIGN
176070970526  |        END-IF
176080970526  |        MOVE WS-ACC-INT-YTD-EX     TO AAI-INT-YTD
176090970526  |        IF WS-ACC-INT-YTD-EX IS LESS THAN ZERO
176100970526  V           MOVE "-"                TO AAI-INT-YTD-SIGN
176110970526102716     END-IF
176120970526148326       PERFORM RETRIEVE-AAI-ORIG-COST THRU RAOC-EXIT
176130970526  ¦
176140970526  ¦          MOVE ACCOUNT-ADDITIONAL-INFO  TO STATEMENT-REC(ISR)
176150980624  ¦          PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
176160980624R50823       INITIALIZE ACCOUNT-ADDITIONAL-INFO
176170980624R28931     END-IF.
176180970526117038     If lncc-Section22Yes
176190970526117038        and lc_Section80 = "Y"
176200970526117038        Perform Section-22-Creation
176210970526117038     End-If.
176220970526      *****    All investment Account Detail Section records have been
176230970526      *****    saved in order to update them with the percentages.
176240980624      *****    Initially calculate and update the records with the
176250980624      *****    account percentage.  If the total percentage is not 100,
176260980624      *****    the investment with the highest value will be adjusted.
176270980627      *****    After the account percentages have been calculated, write
176280980627      *****    the records to the extract file.
176290001006           MOVE ACCOUNT-DETAILS-SECTION
176300980627                                       TO  MFASTMTFP-SECTION.
176310981201           IF  WS-LDA-MGMT-COM-CDE
176320981201                          IS NOT EQUAL TO  "GGF"
176330001006           AND WS-TOTAL-VALUE IS EQUAL TO  ZEROES
176340980624               GO TO LS2-0000-0000-0030.
176350980624           MOVE ZEROES                 TO  WS-ACCPCT-HGH.
176360001006           MOVE ZEROES                 TO  WS-ACCPCT-TOT.
176370001006           SET AD                      TO  1.
176380980624       LS2-0000-0000-0010.
176390981201           MOVE WS-AD-RECD (AD)        TO  ACCOUNT-DETAILS-SECTION.
176400980624           IF  WS-LDA-MGMT-COM-CDE
176410970526                          IS NOT EQUAL TO  "GGF"
176420970526               GO TO LS2-0000-0000-0010-0010.
176430970526           IF  WS-INVAUCACC-SW   EQUAL TO  "Y"
176440970526               MOVE "Y"                TO  AD-INVALID-AVERAGE-COST.
176450990819RF7776     IF  AD-BOOK-VALUE-BASE  IS EQUAL TO  ZEROES
176460980817           OR  WS-ACCBVTOT    IS EQUAL TO  ZEROES
176470970526               MOVE ZEROES TO WS-ACCPCT
176480970526               GO TO LS2-0000-0000-0010-0025.
176490970526RF7776     COMPUTE WS-ACCPCT ROUNDED    =  (AD-BOOK-VALUE-BASE
176500980817                                        *   100)
176510980817                                        /  WS-ACCBVTOT.
176520980817RF7776     IF  AD-BOOK-VALUE-BASE  GREATER THAN  WS-ACCPCT-HGH
176530980824RF7776         MOVE AD-BOOK-VALUE-BASE TO  WS-ACCPCT-HGH
176540980817               SET ADR                 TO  AD.
176550980817           GO TO LS2-0000-0000-0010-0025.
176560980824       LS2-0000-0000-0010-0010.
176570980818           IF  AD-MARKET-VALUE-BASE
176580980817                              IS EQUAL TO  ZEROES
176590980624               GO TO LS2-0000-0000-0020.
176600980818
176610980818           IF WS-LDA-PERC-DECIMAL IS EQUAL TO "S"
176620980818              GO TO LS2-0000-0000-0010-0015.
176630980818           COMPUTE WS-ACCPCT ROUNDED    =  (AD-MARKET-VALUE-BASE
176640980818                                        *   100)
176650980818                                        /  WS-TOTAL-VALUE.
176660980818           GO TO LS2-0000-0000-0010-0020.
176670981201
176680981201       LS2-0000-0000-0010-0015.
176690980818           MOVE ZEROES TO WS-ACCPCT-PHN.
176700981201           COMPUTE WS-ACCPCT-PHN ROUNDED = (AD-MARKET-VALUE-BASE
176710970526                                        *   100)
176720970526                                        /  WS-TOTAL-VALUE.
176730970526           MOVE WS-ACCPCT-PHN           TO  WS-ACCPCT.
176740970526
176750970526       LS2-0000-0000-0010-0020.
176760970526
176770970526           IF  AD-MARKET-VALUE-BASE
176780980627                          IS GREATER THAN  WS-ACCPCT-HGH
176790980627               MOVE AD-MARKET-VALUE-BASE
176800980627                                       TO  WS-ACCPCT-HGH
176810980627               SET ADR                 TO  AD.
176820980627
176830980817       LS2-0000-0000-0010-0025.
176840970526           ADD WS-ACCPCT               TO  WS-ACCPCT-TOT.
176850970526           MOVE WS-ACCPCT              TO  AD-ACCOUNT-PERC.
176860970526           MOVE WS-ACCPCT              TO AD-BOOK-PERC.
176870970526           MOVE ACCOUNT-DETAILS-SECTION
176880970526                                       TO  WS-AD-RECD (AD).
176890970526
176900970526       LS2-0000-0000-0020.
176910970526           IF  AD            IS LESS THAN  WS-AD-LST
176920970526               SET AD               UP BY  1
176930970526               GO TO LS2-0000-0000-0010.
176940970526
176950010620           IF  WS-LDA-MGMT-COM-CDE
176960010620                              IS EQUAL TO  "GGF"
176970010620           AND WS-ACCBVTOT    IS EQUAL TO  ZEROES
176980010620               GO TO LS2-0000-0000-0030.
176990030702
177000030702           IF  WS-ACCPCT-TOT NOT EQUAL TO  ZEROES
177010031007           AND WS-ACCPCT-TOT NOT EQUAL TO  100.00
177020031007               MOVE WS-AD-RECD (ADR)   TO  ACCOUNT-DETAILS-SECTION
177030031007               COMPUTE AD-ACCOUNT-PERC  =  AD-ACCOUNT-PERC
177040031007                                        +  (100.00
177050031007                                        -   WS-ACCPCT-TOT)
177060031007               MOVE ACCOUNT-DETAILS-SECTION
177070030702                                       TO  WS-AD-RECD (ADR).
177080031007       LS2-0000-0000-0030.
177090031007           SET AD                      TO  1.
177100031007       LS2-0000-0000-0040.
177110031007RF9850***** Populate IS-INVESTMENT-STRUCTURE for the Account.
177120031007
177130031007           MOVE WS-AD-RECD (AD)        TO  ACCOUNT-DETAILS-SECTION.
177140031007
177150031007   ¦       INITIALIZE WS-AD-FUND-CODE.
177160031007   ¦       MOVE AD-FUND-NO             TO  WS-AD-FUND-CODE.
177170031007   ¦  ***  MOVE WS-AD-INDUSTRY-CODE    TO  INDUSTRY-FUND-CODE
177180031007   ¦  ***                                  OF INVESTMENT-B-REC.
177190030702   ¦  ***  READ INVESTMENT-B
177200031007   ¦  ***     INVALID KEY
177210031007   ¦  ***        MOVE SPACES  TO INVESTMENT-CODE OF INVESTMENT-B-REC
177220031007   ¦  ***  END-READ.
177230031007   ¦
177240031007   ¦  ***  MOVE INVESTMENT-CODE OF INVESTMENT-B-REC
177250031007   ¦  ***                      TO WS-AD-INVESTMENT-CODE.
177260031007           SET ICS TO 1.
177270031007           SEARCH WS-INVCDE-ENT VARYING ICS
177280031007               AT END
177290031007                  MOVE SPACES TO WS-AD-INVESTMENT-CODE
177300031007               WHEN WS-IC-FUND(ICS) = WS-AD-INDUSTRY-CODE
177310031007                    MOVE WS-IC-CODE(ICS)
177320010621                                       TO  WS-AD-INVESTMENT-CODE
177330010621                    GO TO LS2-0000-0000-0040-0001
177340010621           END-SEARCH.
177350160811   ¦
177360160811       LS2-0000-0000-0040-0001.
177370160811
177380160811           SET ISC TO 1.
177390160811           SEARCH WS-INVSTR-ENT  VARYING ISC
177400031007               AT END
177410031007                  MOVE SPACES  TO WS-INV-STRCODE
177420030702               WHEN WS-ISC-INVCODE (ISC) IS EQUAL TO
177430030702                                         WS-AD-INVESTMENT-CODE
177440030702                  MOVE WS-ISC-STRCODE(ISC) TO WS-INV-STRCODE
177450030702                  GO TO LS2-0000-0000-0040-0005
177460030825           END-SEARCH.
177470030825
177480030702
177490030702RF9850 LS2-0000-0000-0040-0005.
177500030702
177510030702      * RFS 158651 - Starts
177520030702R17848*    IF  AD-NO-OF-UNITS  IS NOT EQUAL TO ZEROS
177530030702   ¦  *    AND WS-INVESTMENT-STRUCTURE-CODE     IS EQUAL TO SPACES
177540030702           IF  WS-INVESTMENT-STRUCTURE-CODE     IS EQUAL TO SPACES
177550030702      * RFS 158651 - Ends
177560030702R18485        MOVE WS-INV-STRCODE TO WS-INVESTMENT-STRUCTURE-CODE
177570030702   ¦
177580030702   ¦       END-IF.
177590030702   ¦
177600030702   ¦       CALL "FXINRSTRF" USING WS-AD-INVESTMENT-CODE
177610030702   ¦                              WS-MLTFAMFND-FUNC-CODE
177620030702   ¦                              WS-FXINR-INV-STRUCTURE-CODE
177630030702R18147                            WS-DECLARE-INRSTRF.
177640030702   ¦
177650030702   ¦       IF WS-FXINR-INV-STRUCTURE-CODE NOT = SPACES
177660030702   ¦          IF AD-NO-OF-UNITS   IS NOT EQUAL TO ZEROS
177670030702   ¦             MOVE WS-FXINR-INV-STRUCTURE-CODE TO
177680030702   ¦                INVESTMENT-STRUCTURE-CODE OF PROGRAM-THRESHOLDS-REC
177690030204   ¦             MOVE "ANNSTMTJ"                  TO
177700010620   ¦                             PROGRAM-CODE OF PROGRAM-THRESHOLDS-REC
177710010620   ¦             READ PROGRAM-THRESHOLDS
177720030204   ¦                INVALID KEY
177730030204   ¦                  GO TO LS2-0000-0000-0040-0006
177740060621   ¦             END-READ
177750030825   ¦
177760970526   ¦             IF INTERNAL-AMT OF PROGRAM-THRESHOLDS-REC >
177770970526   ¦                               WS-INTERNAL-AMT-PREV
177780970526   ¦                MOVE INTERNAL-AMT OF PROGRAM-THRESHOLDS-REC
177790970526   ¦                               TO WS-INTERNAL-AMT-PREV
177800970526   ¦                MOVE WS-FXINR-INV-STRUCTURE-CODE
177810970526   ¦                               TO WS-INVESTMENT-STRUCTURE-CODE
177820991123   ¦             END-IF
177830991125   v          END-IF
177840991125R17848     END-IF.
177850991126
177860991126RF9850***** End of RF8506
177870991126
177880991123R15880 LS2-0000-0000-0040-0006.
177890991125
177900991125R18147     MOVE WS-AD-RECD (AD) TO STATEMENT-REC(ISR).
177910991125R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
177920031216
177930031216           IF  AD            IS LESS THAN  WS-AD-LST
177940031216               SET AD               UP BY  1
177950031216               GO TO LS2-0000-0000-0040.
177960031216
177970040329           MOVE MFASTMTFP-SECTION      TO  ACCOUNT-DETAILS-SECTION.
177980040329
177990040329RF5148 LS2-0000-0000-0040-0010.
178000031216
178010040329      ***
178020040329      ***  Generate Account-Performance records if required.
178030040329      ***
178040031216
178050031216           IF WS-LDA-ACCOUNT-ROR       IS NOT EQUAL TO  "Y"
178060031216              GO TO LS2-0000-0000-0040-0020
178070031216           END-IF
178080031216
178090031216R18814     IF WS-LDA-REQUEST-SCOPE  = "B" AND
178100031216   ¦          WS-LDA-STMT-CNFM-FLAG = "S" AND
178110031216              WS-LDA-STATEMENT-TYPE = "A" AND
178120040329              AD-ACCOUNT NOT = ACCOUNT-NO OF STMT-PRINT-REQ-REC
178130040329      * RFS21596 Start
178140040329              MOVE PREV-END-DATE TO WS-TMP-ENDDTE
178150031216      * RFS21596 End
178160031216           ELSE
178170031216      * RFS21596 Start
178180031216              MOVE WS-LDA-ENDDTE TO WS-TMP-ENDDTE
178190031216      * RFS21596 End
178200031216           END-IF.
178210031216
178220031216           MOVE "30"                     TO WS-SECTION-NO-ROR
178230031216           MOVE SPACES                 TO  WS-IPS-GROUP-ID-ACC
178240031216           MOVE SPACES                 TO  PREV-INVESTMENT
178250031216           CALL "STMTROR" USING
178260031230                          WS-IPS-GROUP-ID-ACC
178270170217                          AD-ACCOUNT
178280170217      * RFS21596 Start
178290170217                          WS-TMP-ENDDTE
178300170217      * RFS21596 End
178310170217                          PREV-INVESTMENT
178320000000                          AD-INVESTOR-NO
178330031008                          WS-SECTION-NO-ROR
178340031008                          AD-LANGUAGE
178350031008                          AD-DEALER
178360031008                          AD-SALESREP
178370031015                          AD-FUND-NO
178380031008                          AD-INVESTMENT-NAME
178390031008                          WS-QRTEND-TBL
178400031008                          AD-START-DATE
178410031008                          AD-END-DATE
178420031216  ¦                       WS-QRT-LST
178430031216      * RFS164528 - Start
178440031216R18814*                   WS-PROGRAM-NAME.
178450031216                          WS-PROGRAM-NAME
178460031216                          LC-LDASECTION31.
178470031216      * RFS164528 - End
178480031216
178490040329      ***  Generate Account-ROR-FRQ-Section(33). if required.
178500040329
178510040329R17626     IF WS-LDA-ACCOUNT-ROR-FRQ            IS NOT EQUAL TO  "Y"
178520031216   ¦          GO TO LS2-0000-0000-0040-0020
178530031216   v       END-IF.
178540031216
178550031216           IF  WS-QRT-LST IS = ZEROES
178560031216                 GO TO LS2-0000-0000-0040-0020
178570031216           END-IF.
178580031216
178590031216R18814     MOVE  "33"                    TO WS-SECTION-NO-ROR
178600031216           MOVE SPACES                 TO  WS-IPS-GROUP-ID-ACC
178610031216           MOVE SPACES                 TO  PREV-INVESTMENT
178620031216           CALL "STMTROR" USING
178630031230                          WS-IPS-GROUP-ID-ACC
178640170217                          AD-ACCOUNT
178650170217      * RFS21596 Start
178660170217                          WS-TMP-ENDDTE
178670170217      * RFS21596 End
178680170217                          PREV-INVESTMENT
178690031009                          AD-INVESTOR-NO
178700001016                          WS-SECTION-NO-ROR
178710001016                          AD-LANGUAGE
178720001019                          AD-DEALER
178730001019                          AD-SALESREP
178740001016                          AD-FUND-NO
178750001027                          AD-INVESTMENT-NAME
178760001027                          WS-QRTEND-TBL
178770001027                          AD-START-DATE
178780001027                          AD-END-DATE
178790001027  ¦                       WS-QRT-LST
178800001027      * RFS164528 - Start
178810001020R18814*                   WS-PROGRAM-NAME.
178820001016                          WS-PROGRAM-NAME
178830970710                          LC-LDASECTION31.
178840970710      * RFS164528 - End
178850970710
178860970710RF4638 LS2-0000-0000-0040-0020.
178870980417      ***
178880980417      ***  Generate SEG-Fun-Contract-Details(Section 40) and/or
178890970710      ***  SEG-Fun-Contract-Investment-details(Section 43) if required.
178900970710      ***
178901211019      *RFS186592 Starts*
178902210917           IF WS-LDA-SEG-90            IS EQUAL TO  "Y"
178903210924           AND lb_AccountGuaranteesYes
178904210917              PERFORM GET-RESET-LEVEL-P
178905210917           END-IF.
178906210917      *RFS186592 Ends*
178910970424           IF WS-LDA-SEG-40            IS EQUAL TO  "Y"
178920980624           OR WS-LDA-SEG-43            IS EQUAL TO  "Y"
178930980624           OR WS-LDA-SEG-45            IS EQUAL TO  "Y"
178940980624           OR WS-LDA-SEG-90            IS EQUAL TO  "Y"
178950971101              PERFORM POPULATE-SEG-FUND-INV-ROUTINE  THRU PSFIR-EXIT
178960010704           END-IF.
178970040109
178980010704RF5148 LS2-0000-0000-0040-0030.
178990991105      *****
179000991105      *****    Generate the Rollover records, if required.
179010991105      *****
179020991105
179030970424980417     IF  WS-LDA-ROLLOVER-FLAG
179040970424980417                    IS NOT EQUAL TO  "N"
179050970424               PERFORM GENERATE-ROLLOVER-RECORDS
179060980624                                      THRU GRR-EXIT.
179070980624
179080991105      *****    Format and create the RRIF/LIF Detail records if
179090991105      *****    required.
179100980624           MOVE 1                      TO  WS-AW-SECTION-SEQUENCE.
179110980624
179120980624           IF  (WS-LDA-RRIF-FLAG   IS NOT EQUAL TO  "Y"
179130980624R20352     AND WS-LDA-RRIF-FLAG   IS NOT EQUAL TO  "G"
179140980624R10207     AND WS-LDA-RRIF-FLAG   IS NOT EQUAL TO  "A")
179150980624           OR  WS-AT-RULE (AT1)   IS NOT EQUAL TO  "3"
179160980624               GO TO LS2-0000-0000-0050
179170980624           END-IF
179180980624
179190001220           INITIALIZE MFAACRIFP.
179200980624           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
179210980624                                           OF ACCOUNT-RRIF-REC.
179220980624980514     READ ACCOUNT-RRIF
179230980624980514         INVALID KEY
179240980624                   GO TO LS2-0000-0030
179250980624           END-READ
179260980624           GO TO LS2-0000-0000-0060.
179270980624
179280970424       LS2-0000-0000-0050.
179290970424      *****    Read in Account Lif File
179300970424
179310970424           IF  WS-LDA-ACCOUNT-LIF
179320970424                          IS NOT EQUAL TO  "Y"
179330970424           OR  WS-AT-RULE (AT1)
179340970424                          IS NOT EQUAL TO  "5"
179350970424              GO TO LS2-0000-0030.
179360970424
179370041202980514     INITIALIZE MFAACLIFP.
179380041202           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
179390041202980514                                     OF ACCOUNT-LIF-REC.
179400041202980514     READ ACCOUNT-LIF
179410041202980514         INVALID KEY
179420041202                   GO TO LS2-0000-0030.
179430041202       LS2-0000-0000-0060.
179440980624      *****    Retrieve the corresponding Account AWD.  If it is not
179450970424      *****    found or it not active on the requested statement range
179460980624      *****    end date, bypass the RRIF.
179470970424           INITIALIZE MFAACCAWP.
179480970424           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
179490970424                                           OF ACCOUNT-AWD-REC.
179500041202           START ACCOUNT-AWD
179510041202               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
179520041202               INVALID KEY
179530041202R24403          IF WS-LDA-RRIF-FLAG   IS     EQUAL TO  "G"
179540041202  ¦                INITIALIZE MFAACCAWP OF ACCOUNT-AWD-REC
179550041202  ¦                GO TO LS2-0000-0000-0090
179560041202  ¦             ELSE
179570040109  ¦                GO TO LS2-0000-0030
179580040109  v             END-IF
179590040109R24403     END-START.
179600010704       LS2-0000-0000-0070.
179610010704           READ ACCOUNT-AWD NEXT       AT  END
179620010704               GO TO LS2-0000-0030.
179630161005           IF  ACCOUNT-NO
179640161005               OF ACCOUNT-AWD-REC
179650161005                          IS NOT EQUAL TO  PREV-ACCOUNT
179660160614R24403          IF WS-LDA-RRIF-FLAG   IS     EQUAL TO  "G"
179670160930  ¦                INITIALIZE MFAACCAWP OF ACCOUNT-AWD-REC
179680160930  ¦                GO TO LS2-0000-0000-0090
179690160930  ¦             ELSE
179700160930  ¦                GO TO LS2-0000-0030
179710160614  v             END-IF
179720161005R24403     END-IF.
179730161005R20352     IF  WS-LDA-RRIF-FLAG   IS     EQUAL TO  "G"
179740970424               GO TO LS2-0000-0000-0090
179750970424R20352     END-IF
179760971024R10207     IF  WS-LDA-RRIF-FLAG   IS     EQUAL TO  "A"
179770980624               GO TO LS2-0000-0000-0003
179780010704R10207     END-IF
179790970425      *RFS163790 START
179800970425      *RFS162048 START
179810970425      *    PERFORM DECLARE-SECTION60-CURSOR.
179820970425      *RFS155774 START
179830970425           IF  START-DATE
179840971024               OF ACCOUNT-AWD-REC
179850980624                         IS EQUAL TO  WS-LDA-ENDDTE
179860980624               GO TO LS2-0000-0000-0003.
179870980624      *RFS155774 END
179880980624      *RFS162048 END
179890980624      *RFS163790 END
179900980624           IF  START-DATE
179910970424               OF ACCOUNT-AWD-REC
179920991223                         IS NOT LESS THAN  WS-LDA-ENDDTE
179930991222               GO TO LS2-0000-0000-0080.
179940991222R10207 LS2-0000-0000-0003.
179950991222           IF  STOP-DATE
179960991222               OF ACCOUNT-AWD-REC
179970991222                          IS GREATER THAN  ZEROES
179980991222           AND STOP-DATE
179990991222               OF ACCOUNT-AWD-REC
180000991222                             IS LESS THAN  WS-LDA-ENDDTE
180010991222               GO TO LS2-0000-0000-0080.
180020991222           GO TO LS2-0000-0000-0090.
180030991222
180040991222       LS2-0000-0000-0080.
180050991222           GO TO LS2-0000-0000-0070.
180060991222       LS2-0000-0000-0090.
180070991222      *****    Determine the age.
180080991222RF5962     IF WS-AT-RULE (AT1)  EQUAL TO  "3"
180090971024              IF CALC-DATE-OF-BIRTH OF ACCOUNT-RRIF-REC
180100970424                                    IS NOT EQUAL TO ZEROS
180110970424                 MOVE CALC-DATE-OF-BIRTH OF ACCOUNT-RRIF-REC
180120971024                                    TO  WS-CALC-DOB
180130970424              ELSE
180140970424                 MOVE WS-INVESTOR-DOB  TO WS-CALC-DOB
180150970424              END-IF
180160970424           ELSE
180170970424              IF CALC-DATE-OF-BIRTH OF ACCOUNT-LIF-REC
180180970424                                    IS NOT EQUAL TO ZEROS
180190970424                 MOVE CALC-DATE-OF-BIRTH OF ACCOUNT-LIF-REC
180200970424                                    TO  WS-CALC-DOB
180210970424              ELSE
180220970424                 MOVE WS-INVESTOR-DOB  TO WS-CALC-DOB
180230970424              END-IF
180240970424           END-IF
180250980624           SUBTRACT WS-CALC-DOB-CCYY FROM  WS-LDA-ENDDTE-CCYY
180260980624                                   GIVING  WS-AGE.
180270980624           IF  WS-CALC-DOB-MMDD
180280980624                          IS GREATER THAN  WS-LDA-ENDDTE-MMDD
180290001220               SUBTRACT 1            FROM  WS-AGE.
180300001220      *****
180310140707      *****    Format and create a RRIF Detail.
180320140707      *****
180330140707           INITIALIZE RRIF-DETAIL-SECTION.
180340140707           MOVE PREV-INVESTOR          TO  AW-INVESTOR-NO.
180350980624           MOVE PREV-ACCOUNT           TO  AW-ACCOUNT.
180360980624           MOVE 60                     TO  AW-SECTION-NO.
180370001220           MOVE WS-AW-SECTION-SEQUENCE TO  AW-SECTION-SEQUENCE.
180380001220           MOVE AD-LANGUAGE            TO  AW-LANGUAGE.
180390001220           MOVE AD-DEALER              TO  AW-DEALER.
180400140707           MOVE AD-SALESREP            TO  AW-SALESREP.
180410140707           IF  WS-AT-RULE (AT1)  EQUAL TO  "3"
180420140707               MOVE MIN-WITHDRAWAL-AMT
180430140707                    OF ACCOUNT-RRIF-REC
180440001220                                       TO  AW-MINIMUM-ANNUAL-PAYMENT
180450001220RF8551         MOVE PAYMENT-TYPE-CODE
180460120301                OF ACCOUNT-RRIF-REC    TO  AW-PAYMENT-OPTION
180470120301132121         MOVE GROSS-YTD-TOTAL-PAID
180480120301132121          OF ACCOUNT-RRIF-REC    TO  AW60-GROSS-YTD-TOTAL-PAID
180490120301132121         MOVE GROSS-YTD-MINIMUM-PAID
180500120301132121          OF ACCOUNT-RRIF-REC    TO  AW60-GROSS-YTD-MINIMUM-PAID
180510120301             ELSE
180520120301               MOVE MIN-WITHDRAWAL-AMT
180530120301                    OF ACCOUNT-LIF-REC TO  AW-MINIMUM-ANNUAL-PAYMENT
180540120301RF8551         MOVE PAYMENT-TYPE-CODE
180550120301                OF ACCOUNT-LIF-REC     TO  AW-PAYMENT-OPTION
180560120301132121         MOVE GROSS-YTD-TOTAL-PAID
180570120301132121          OF ACCOUNT-LIF-REC    TO   AW60-GROSS-YTD-TOTAL-PAID
180580120301132121         MOVE GROSS-YTD-MINIMUM-PAID
180590120301132121          OF ACCOUNT-LIF-REC     TO  AW60-GROSS-YTD-MINIMUM-PAID
180600120301           END-IF.
180610120301
180620120301105408     IF  AW-PAYMENT-OPTION EQUAL TO  "M"
180630120301  |        AND Lc_PayOption      EQUAL TO  "Y"
180640120301  |        AND Lc_SegGLWBYes
180650970424  |            EXEC SQL
180660970424  |              SELECT a.AWD_OPTION
180670970424  |              INTO  :lc_AWD_Option
180680010704  |              FROM mfaacconp a
180690010704  |              Inner Join  MFASERRLP b on
180700010704  |                 A.INVESTMENT_SERIES = B.INVESTMENT_SERIES
180710980624  |              where  A.account_no = :PREV-ACCOUNT and
180720980624  |                    A.CONTRACT_STATUS <> "C"     and
180730980624  |                    A.AWD_OPTION = "G"           and
180740980624  |                    SUBSTR(b.Series_Rules, 70, 4) = "GLWB"
180750980624  |            END-EXEC
180760980624  |
180770980624  |            IF SQLCODE = 0
180780970424  |              MOVE "G" TO AW-PAYMENT-OPTION
180790970424  V            END-IF
180800980521105408     END-IF.
180810980521           MOVE WS-AGE                 TO  AW-AGE.
180820980624           MOVE FREQUENCY-CODE
180830980624                OF ACCOUNT-AWD-REC     TO  AW-PAYMENT-FREQUENCY.
180840980624
180850980613R10362     PERFORM GEN-PAY-FREQ-AND-OPTION-DESCR  THRU GPFOD-EXIT.
180860980613
180870980613           IF  WS-AT-RULE (AT1)  EQUAL TO  "3"
180880980613               MOVE REQUESTED-ANNUAL-PAYMENT
180890980613                    OF ACCOUNT-RRIF-REC
180900980613                                       TO  AW-ANNUAL-PAYMENT
180910980613             ELSE
180920980613               MOVE REQUESTED-ANNUAL-PAYMENT
180930980613                    OF ACCOUNT-LIF-REC TO  AW-ANNUAL-PAYMENT.
180940980613           MOVE START-DATE
180950980613                OF ACCOUNT-AWD-REC     TO  AW-PAYMENT-START-DATE.
180960980613980514     MOVE WS-ACC-TINCOME-PRV     TO  AW-PREVIOUS-TAXABLE-INCOME.
180970980613980514     MOVE WS-ACC-WHTAX-PRV       TO  AW-PREVIOUS-TAX-WITHHELD.
180980980613           IF  WS-AT-RULE (AT1)  EQUAL TO  "5"
180990980613980514         MOVE MAX-WITHDRAWAL-AMT
181000980613980514              OF ACCOUNT-LIF-REC TO  AW-MAXIMUM-ANNUAL-PAYMENT.
181010980613
181020980613           INITIALIZE MFAACCAIP.
181030980613           MOVE ACCOUNT-NO
181040980613                OF ACCOUNT-AWD-REC     TO  ACCOUNT-NO
181050980613                                           OF ACCOUNT-AWD-INVEST-REC.
181060980613           MOVE AWD-SEQ-NO
181070980613                OF ACCOUNT-AWD-REC     TO  AWD-SEQ-NO
181080980613                                           OF ACCOUNT-AWD-INVEST-REC.
181090980613           START ACCOUNT-AWD-INVESTMENT
181100980613               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
181110980613               INVALID KEY
181120980613                   GO TO LS2-0000-0015-0050.
181130980613
181140980613       LS2-0000-0015-0010.
181150980613           READ ACCOUNT-AWD-INVESTMENT NEXT
181160980613                                       AT  END
181170980613               GO TO LS2-0000-0015-0050.
181180980613
181190980613           IF  AWD-SEQ-NO
181200980613               OF ACCOUNT-AWD-INVEST-REC
181210980613                          IS NOT EQUAL TO  AWD-SEQ-NO
181220980613                                           OF ACCOUNT-AWD-REC
181230980613           OR  ACCOUNT-NO
181240980613               OF ACCOUNT-AWD-INVEST-REC
181250980613                          IS NOT EQUAL TO  ACCOUNT-NO
181260980613                                           OF ACCOUNT-AWD-REC
181270980613               GO TO LS2-0000-0015-0050.
181280980613      *****
181290980613      *****    Only dollar ($) option AWDs are to be processed.
181300980613      *****
181310980613           IF  SPLIT-OPTION-CODE
181320980613               OF ACCOUNT-AWD-INVEST-REC
181330980613                          IS NOT EQUAL TO  "$"
181340980613               GO TO LS2-0000-0015-0010.
181350980613
181360980613           GO TO LS2-0000-0015-0030.
181370980613
181380980613       LS2-0000-0015-0020.
181390980613           READ ACCOUNT-AWD-INVESTMENT NEXT
181400980613                                       AT  END
181410980613               GO TO LS2-0000-0015-0050.
181420980613
181430980613           IF  AWD-SEQ-NO
181440980613               OF ACCOUNT-AWD-INVEST-REC
181450980613                          IS NOT EQUAL TO  AWD-SEQ-NO
181460980613                                           OF ACCOUNT-AWD-REC
181470980613           OR  ACCOUNT-NO
181480980613               OF ACCOUNT-AWD-INVEST-REC
181490980613                          IS NOT EQUAL TO  ACCOUNT-NO
181500980613                                           OF ACCOUNT-AWD-REC
181510980613               GO TO LS2-0000-0015-0050.
181520980613      *****
181530020321      *****    Only dollar ($) option AWDs are to be processed.
181540980129      *****
181550981207           IF  SPLIT-OPTION-CODE
181560991108               OF ACCOUNT-AWD-INVEST-REC
181570991108                          IS NOT EQUAL TO  "$"
181580991108               GO TO LS2-0000-0015-0040.
181590001031
181600001031       LS2-0000-0015-0030.
181610991108           ADD AWD-AMOUNT
181620991108               OF ACCOUNT-AWD-INVEST-REC
181630991108                                       TO  AW-SCHEDULED-PAYMENT.
181640991108
181650001031       LS2-0000-0015-0040.
181660991108           GO TO LS2-0000-0015-0020.
181670001031
181680001031       LS2-0000-0015-0050.
181690991108           MOVE WS-PREV-START-DATE        TO  AW-START-DATE.
181700001031           MOVE PREV-END-DATE          TO  AW-END-DATE.
181710991108
181720991108991108********** READ ACCOUNT-LIF-ADD-DETAILS TO GET
181730981207991108********** REFERENCE-TEMP-INCOME
181740981207
181750981207001031     INITIALIZE  ACCOUNT-LIF-ADD-DETAILS-REC.
181760991108
181770991108           MOVE PREV-ACCOUNT      TO  ACCOUNT-NO
181780991202                                  OF  ACCOUNT-LIF-ADD-DETAILS-REC.
181790991203           READ ACCOUNT-LIF-ADD-DETAILS
181800991202              INVALID KEY
181810991202               INITIALIZE ACCOUNT-LIF-ADD-DETAILS-REC
181820140707               MOVE ZEROES        TO REFERENCE-TEMP-INCOME
181830141118                                  OF ACCOUNT-LIF-ADD-DETAILS-REC
181840141118991108     END-READ.
181850141118
181860141118           MOVE REFERENCE-TEMP-INCOME OF ACCOUNT-LIF-ADD-DETAILS-REC
181870141118                              TO AW-REFERENCE-TEMP-INCOME.
181880141118
181890141118           IF WS-AT-RULE(AT1) IS EQUAL TO  "3"
181900141118              MOVE "R"        TO  AW-RIF-LIF-INDICATOR
181910141118           ELSE
181920141118              MOVE "L"        TO  AW-RIF-LIF-INDICATOR
181930141118           END-IF
181940141118
181950141118RF5962     IF WS-AT-RULE (AT1)        IS  EQUAL TO  "5"
181960060621              PERFORM POPULATE-MAX-PENSION          THRU  PMP-EXIT
181970030825           END-IF
181980970424132121     PERFORM POPULATE-RRIF-LIF-PAID.
181990970424
182000970424      * RFS 138310 - Start
182010970424           IF WS-AT-RULE (AT1) IS EQUAL TO "3" OR "5"
182020981214              PERFORM Get-Income-Payment
182030981214
182040981214              INITIALIZE li-WH-TAX-TRNCHP-Cnt
182050981214              PERFORM Check-Account-With-WH-TAX
182060981214
182070981214              IF li-WH-TAX-TRNCHP-Cnt > 0
182080981214                 PERFORM Get-WH-TAX-AMT
182090981215              END-IF
182100981216           END-IF.
182110981214      * RFS 138310 - End
182120981214R18147     MOVE RRIF-DETAIL-SECTION TO STATEMENT-REC(ISR).
182130981214R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
182140981214
182150981215           ADD 1                       TO  WS-AW-SECTION-SEQUENCE.
182160981215
182170981215       LS2-0000-0030.
182180981215
182190981215      ****
182200981215      ****  If not GGF, Skip RESP Section
182210981215      ****
182220981215
182230981215           IF  WS-LDA-RESP IS NOT EQUAL TO "Y"
182240981216           OR  WS-AT-RULE (AT1) IS NOT EQUAL TO  "4"
182250981215               GO TO LS2-0000-0030-0000.
182260981215
182270991015      *****
182280981214      *****    Format and Write RESP DETAILS SECTION
182290010306      *****
182300020321
182310981216           MOVE 1                       TO  WS-RE-SECTION-SEQUENCE.
182320981216           INITIALIZE RESP-DETAIL-SECTION.
182330060621           MOVE PREV-INVESTOR           TO  RE-INVESTOR-NO.
182340030825           MOVE PREV-ACCOUNT            TO  RE-ACCOUNT.
182350981214           MOVE 62                      TO  RE-SECTION-NO.
182360981214           MOVE WS-RE-SECTION-SEQUENCE  TO  RE-SECTION-SEQUENCE.
182370981214           MOVE AD-LANGUAGE             TO  RE-LANGUAGE.
182380981214           MOVE AD-DEALER               TO  RE-DEALER.
182390981214           MOVE AD-SALESREP             TO  RE-SALESREP.
182400100118           MOVE WS-RE-PREV-YEAR-CONTRIB TO  RE-PREV-YEARS-CONTRIBUTION.
182410100118           MOVE WS-RE-CURR-YEAR-CONTRIB TO  RE-CURR-YEAR-CONTRIBUTION.
182420100118           MOVE WS-RE-CES-GRANT-AMOUNT  TO  RE-CES-GRANT-AMOUNT.
182430100118991006     MOVE "N"                     TO  WS-RESP-84.
182440100118           PERFORM GENERATE-BENEFICIARY-REC THRU GBR-EXIT.
182450100118RF9331     PERFORM GENERATE-RESP-TYPE-REC   THRU GRTR-EXIT.
182460100118           MOVE WS-PREV-START-DATE         TO  RE-START-DATE.
182470100118           MOVE PREV-END-DATE           TO  RE-END-DATE.
182480100118
182490980520R18147     MOVE RESP-DETAIL-SECTION TO STATEMENT-REC(ISR).
182500990621R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
182510980520
182520980520           ADD 1                       TO  WS-RE-SECTION-SEQUENCE.
182530990113
182540980521       LS2-0000-0030-0000.
182550980521
182560990113      *RFS69515 Begin
182570980520      *For extraction only - WS-LDA-STMT-VERSION = "E"
182580980520           IF lncc-Section63Yes              AND
182590980520              WS-LDA-STMT-VERSION = "E"      AND
182600980520              WS-LDA-STMT-CNFM-FLAG = lnc_S  AND
182610980520              WS-AT-RULE (AT1) = '0'
182620020820              PERFORM GENERATE-RDSP-63 THRU GD63-EXIT
182630980521           END-IF
182640020820      *RFS69515 End
182650020820      ****
182660020820      ****  Group Information Section
182670020820      ****
182680980521
182690980521           IF  WS-LDA-GROUP  NOT EQUAL TO  "Y"
182700990113           OR  PREV-GROUP-CONTROL
182710990113                          IS NOT EQUAL TO  "Y"
182720990113              GO TO LS2-0000-0030-0020.
182730020820
182740990113      *****
182750020820      *****    Format and Write Group Information Section
182760020820      *****
182770020820
182780980520           MOVE 1                 TO WS-GR-SECTION-SEQUENCE.
182790020820
182800020820R13955     MOVE  SPACES           TO WS-GROUP-NAME
182810020820  ¦        MOVE  SPACES           TO WS-EMPLOYEE-NO
182820020820R13955     MOVE  SPACES           TO WS-GROUP-PLAN-DESC
182830020820
182840020820           INITIALIZE MFAACCGPP.
182850020820           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO
182860020820                                           OF ACCOUNT-GROUP-REC.
182870020820           READ ACCOUNT-GROUP
182880020820               INVALID KEY
182890020820                   MOVE ALL "*"        TO  WS-GROUP-NAME
182900020820                   GO TO LS2-0000-0030-0010.
182910990113
182920980521R13955       MOVE EMPLOYEE-NO  OF  ACCOUNT-GROUP-REC
182930990113                                      TO WS-EMPLOYEE-NO.
182940990113
182950990113           INITIALIZE MFAGRPNDP.
182960990113R13955        MOVE GROUP-PLAN-CODE OF ACCOUNT-GROUP-REC
182970020820  ¦                            TO GROUP-PLAN-CODE OF GROUP-PLAN-DESC.
182980990113  ¦           MOVE AD-LANGUAGE
182990980520  ¦                            TO LANGUAGE-CODE OF GROUP-PLAN-DESC.
183000020820  ¦         READ GROUP-PLAN-DESC
183010020820  ¦           INVALID KEY
183020020820  ¦                MOVE SPACES      TO  WS-GROUP-PLAN-DESC
183030020820  ¦           NOT INVALID KEY
183040020820  ¦             MOVE GROUP-PLAN-DESCR OF GROUP-PLAN-DESC
183050020820R13955                                   TO WS-GROUP-PLAN-DESC.
183060020820
183070020820           INITIALIZE MFAGRPP.
183080980521           MOVE GROUP-CODE
183090980521                OF ACCOUNT-GROUP-REC   TO  GROUP-CODE
183100990113                                           OF GROUP-REC.
183110990113           READ GROUP-FILE
183120990113                INVALID KEY
183130990113                   MOVE ALL "*"        TO  WS-GROUP-NAME
183140990113                   GO TO LS2-0000-0030-0010.
183150990113
183160990113R13955     IF  AD-LANGUAGE IS  = "E"
183170990113   ¦           MOVE GROUP-NAME OF GROUP-REC TO WS-GROUP-NAME
183180990113   ¦       END-IF.
183190020820   ¦
183200020820   ¦       IF  AD-LANGUAGE IS = "F"
183210020820   ¦           MOVE GROUP-NAME-FRENCH OF GROUP-REC TO WS-GROUP-NAME
183220990615R13955     END-IF.
183230990615
183240990616       LS2-0000-0030-0010.
183250990615           INITIALIZE GROUP-INFORMATION.
183260990615           MOVE PREV-INVESTOR          TO  GR-INVESTOR-NO.
183270990615           MOVE PREV-ACCOUNT           TO  GR-ACCOUNT.
183280030324           MOVE 65                     TO  GR-SECTION-NO.
183290990615           MOVE WS-GR-SECTION-SEQUENCE TO  GR-SECTION-SEQUENCE.
183300990615           MOVE AD-LANGUAGE            TO  GR-LANGUAGE.
183310990615           MOVE AD-DEALER              TO  GR-DEALER.
183320030324           MOVE AD-SALESREP            TO  GR-SALESREP.
183330990615           MOVE GROUP-CODE
183340990615                OF GROUP-REC           TO  GR-GROUP-ACCOUNT-NO.
183350990615R13955     MOVE WS-GROUP-NAME          TO  GR-EMPLOYER-NAME.
183360990615R13955     MOVE WS-EMPLOYEE-NO         TO  GR-GROUP-EMPLOYEE-NO.
183370990615R13955     MOVE WS-GROUP-PLAN-DESC     TO  GR-GROUP-PLAN-CODE-DESC.
183380030324
183390990616           IF  WS-ACACTYP IS EQUAL TO "RRSP"
183400990616           AND WS-EEC-TOTAL IS EQUAL TO ZERO
183410990616             ADD WS-EEC-REMAINDER
183420990616                 WS-EEC-1ST60
183430990616             GIVING  GR-TOTAL-EMPLOYEE-CONTRIB-YTD
183440990616R16633               WS-EEC-TOTAL
183450030324             ADD WS-ERC-REMAINDER
183460030324                 WS-ERC-1ST60
183470990616             GIVING  GR-TOTAL-EMPLOYER-CONTRIB-YTD
183480990616R16633               WS-ERC-TOTAL
183490030324             ADD WS-EEC-REMAINDER
183500030324                 WS-EEC-1ST60
183510030324                 WS-ERC-REMAINDER
183520061003                 WS-ERC-1ST60
183530061003             GIVING  GR-TOTAL-CONTRIB-YTD
183540030324R16633               WS-EEC-ERC-TOTAL
183550030324             GO TO LS2-0000-0030-0015.
183560030324
183570061003           MOVE WS-EEC-TOTAL     TO GR-TOTAL-EMPLOYEE-CONTRIB-YTD.
183580061003           MOVE WS-ERC-TOTAL     TO GR-TOTAL-EMPLOYER-CONTRIB-YTD.
183590030324           ADD  WS-EEC-TOTAL
183600030324                WS-ERC-TOTAL
183610030324R16633          GIVING  GR-TOTAL-CONTRIB-YTD
183620061003R16633                  WS-EEC-ERC-TOTAL.
183630061003
183640030324       LS2-0000-0030-0015.
183650030324
183660030324R16633     IF   WS-EEC-TOTAL        IS  LESS THAN ZEROS
183670030324   ¦            MOVE "-"            TO  GR-TOT-EMPLOYEE-CONTRIYTD-SIGN
183680030324R35540     ELSE
183690061003R35540          MOVE " "            TO  GR-TOT-EMPLOYEE-CONTRIYTD-SIGN
183700061003   ¦       END-IF.
183710030324   ¦       IF   WS-ERC-TOTAL        IS  LESS THAN ZEROS
183720030324   ¦            MOVE "-"            TO  GR-TOT-EMPLOYER-CONTRIYTD-SIGN
183730030324R35540     ELSE
183740030324R35540          MOVE " "            TO  GR-TOT-EMPLOYER-CONTRIYTD-SIGN
183750030324   ¦       END-IF.
183760061003   ¦       IF   WS-EEC-ERC-TOTAL    IS  LESS THAN ZEROS
183770061003   ¦            MOVE "-"            TO  GR-TOT-CONTRIB-YTD-SIGN
183780030324R35540     ELSE
183790030324R35540          MOVE " "            TO  GR-TOT-CONTRIB-YTD-SIGN
183800030324   ¦       END-IF.
183810030324   ¦
183820030324   ¦       MOVE WS-EEC-1ST60        TO  GR-EMPLOYEE-CONTRIB-FIRST60.
183830061003   ¦       IF   WS-EEC-1ST60        IS  LESS THAN ZEROS
183840061003   ¦            MOVE "-"            TO  GR-EMPLOYEE-CONTRIFIRST60-SIGN
183850030324R35540     ELSE
183860030324R35540          MOVE " "            TO  GR-EMPLOYEE-CONTRIFIRST60-SIGN
183870030324   ¦       END-IF.
183880030324   ¦
183890030324   ¦       MOVE WS-EEC-REMAINDER    TO  GR-EMPLOYEE-CONTRIB-REMAIN.
183900061003   ¦       IF   WS-EEC-REMAINDER    IS  LESS THAN ZEROS
183910061003   ¦            MOVE "-"            TO  GR-EMPLOYEE-CONTRI-REMAIN-SIGN
183920030324R35540     ELSE
183930030324R35540          MOVE " "            TO  GR-EMPLOYEE-CONTRI-REMAIN-SIGN
183940020321   ¦       END-IF.
183950990113   ¦
183960980520   ¦       MOVE WS-ERC-1ST60        TO  GR-EMPLOYER-CONTRIB-FIRST60.
183970060621   ¦       IF   WS-ERC-1ST60        IS  LESS THAN ZEROS
183980030825   ¦            MOVE "-"            TO  GR-EMPLOYER-CONTRIFIRST60-SIGN
183990980520R35540     ELSE
184000990113R35540          MOVE " "            TO  GR-EMPLOYER-CONTRIFIRST60-SIGN
184010980520   ¦       END-IF.
184020980521   ¦
184030980520   ¦       MOVE WS-ERC-REMAINDER    TO  GR-EMPLOYER-CONTRIB-REMAIN.
184040000417   ¦       IF   WS-ERC-REMAINDER    IS  LESS THAN ZEROS
184050000417   ¦            MOVE "-"            TO  GR-EMPLOYER-CONTRIBREMAIN-SIGN
184060000420R35540     ELSE
184070000417R35540          MOVE " "            TO  GR-EMPLOYER-CONTRIBREMAIN-SIGN
184080000420R16633     END-IF.
184090000417
184100100118           MOVE WS-PREV-START-DATE        TO  GR-START-DATE.
184110971009           MOVE PREV-END-DATE          TO  GR-END-DATE.
184120971009
184130971009R18147     MOVE GROUP-INFORMATION TO STATEMENT-REC(ISR).
184140000417R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
184150031215
184160971009           ADD 1                       TO  WS-GR-SECTION-SEQUENCE.
184170971009
184180971023       LS2-0000-0030-0020.
184190971009
184200031215      ***** If Beneficiary-67 was set to "Y", create Section 67
184210971009
184220971009RF6063     IF WS-LDA-BENEFICIARY     IS EQUAL TO    "Y"
184230971009              PERFORM GENERATE-BENEFICIARY-67    THRU GB67-EXIT
184240971009           END-IF
184250971009
184260971009
184270971009      *****    Determine if PAC/AWD processing is required.
184280971009      *****
184290031215
184300031215
184310031215      ***** Section-70
184320031215           IF  WS-LDA-PACAWD-FLAG
184330031215                              IS EQUAL TO  "N"
184340031215               GO TO LS2-0000-0280.
184350031215
184360031215      ***** Section-70-PAC
184370031215      *****
184380031215      *****    Process the Systematic Plan Info PAC data using the
184390031215      *****    Investor PAC and Investor PAC Purchase files.  Initially,
184400031215      *****    build the table.
184410031215      *****
184420031215
184430031215           MOVE SPACES                 TO  WS-SYSPLN-TBL.
184440031215           MOVE ZEROES                 TO  WS-SP-LST.
184450031215
184460031215R19502**** Start
184470031215           MOVE PREV-ACCOUNT TO WS-ACCOUNT-NO.
184480031215           MOVE PREV-INVESTOR TO WS-INVESTOR-NO.
184490031215
184500031215       LS2-OPEN-IVRPACC1.
184510031215           MOVE "OPEN IVRPACC1  " TO WS-SQLERR-STATEMENT.
184520031215           EXEC SQL
184530031215             OPEN IVRPACC1
184540031215           END-EXEC.
184550031215
184560031215       LS2-GET-PAC-INFO.
184570031215           MOVE "FETCH IVRPACC1  " TO WS-SQLERR-STATEMENT.
184580031215           EXEC SQL
184590031215            FETCH NEXT FROM IVRPACC1
184600031215            FOR :IVRPACMAX ROWS
184610031215            INTO :PAC-IVRPACC1-FIELDS
184620031215           END-EXEC.
184630031215
184640031215           IF SQLCODE > 0
184650031215            GO TO LS2-CLOSE-IVRPACC1
184660031215           END-IF.
184670031215
184680031215           COMPUTE WS-SQL-INDEX = 0.
184690031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3).
184700031215
184710031215       LS2-INCREMENT-WS-SQL-INDEX-PAC.
184720031215           ADD 1 TO WS-SQL-INDEX.
184730031215
184740031215           SET SP TO 1.
184750031215
184760031215       LS2-0000-0050.
184770031215           IF  SP IS GREATER THAN  WS-SP-LST
184780031215               GO TO LS2-0000-0060.
184790031215
184800031215           IF  PAC-PAC-SEQ-NO(WS-SQL-INDEX)
184810031215                          IS NOT EQUAL TO WS-SP-SEQ (SP)
184820031215               SET SP UP BY  1
184830031215               GO TO LS2-0000-0050.
184840031215
184850031215           GO TO LS2-0000-0080.
184860031215
184870031215       LS2-0000-0060.
184880031215           IF  WS-SP-LST IS NOT LESS THAN  WS-SP-MAX
184890031215               DISPLAY "PACS FOR ACCOUNT "
184900031215                       PREV-ACCOUNT
184910031215                       " EXCEED PROGRAM MAXIMUM"
184920031215               GO TO LS2-CLOSE-IVRPACC1
184930031215            END-IF.
184940031215
184950031215       LS2-0000-0070.
184960031215           MOVE ZEROES TO WS-SP-CAMT(SP).
184970031215           MOVE PAC-CURRENCY(WS-SQL-INDEX) TO WS-SP-CURR(SP).
184980031215           MOVE ZEROES TO WS-SP-FLST(SP).
184990031215           MOVE PAC-FREQUENCY-CODE(WS-SQL-INDEX) TO WS-SP-FREQ(SP)
185000031215
185010031215           IF AD-LANGUAGE IS EQUAL TO  "F"
185020031215              MOVE PAC-BANK-NAME-FRENCH(WS-SQL-INDEX) TO WS-SP-INST(SP)
185030031215           ELSE
185040031215              MOVE PAC-BANK-NAME(WS-SQL-INDEX) TO WS-SP-INST(SP)
185050031215           END-IF.
185060031215
185070031215           MOVE PAC-PAC-AMT(WS-SQL-INDEX) TO WS-SP-PAMT(SP).
185080031215           MOVE "PAC" TO WS-SP-PLAN(SP).
185090031215           MOVE SPACES TO WS-SP-PTYP(SP).
185100031215           MOVE PAC-HOLD-UNTIL-DATE(WS-SQL-INDEX) TO WS-SP-REST(SP)
185110031215           MOVE PAC-PAC-SEQ-NO(WS-SQL-INDEX) TO WS-SP-SEQ(SP).
185120031215           MOVE PAC-SPLIT-OPTION-CODE(WS-SQL-INDEX) TO WS-SP-SOPT(SP).
185130031215           MOVE PAC-PAC-STATUS(WS-SQL-INDEX) TO WS-SP-STAT(SP).
185140031215           MOVE PAC-STOP-DATE(WS-SQL-INDEX) TO WS-SP-STOP(SP).
185150031215           MOVE PAC-START-DATE(WS-SQL-INDEX) TO WS-SP-STRT(SP).
185160031215           MOVE ZEROES TO WS-SP-TAMT (SP).
185170031215           ADD 1 TO WS-SP-LST.
185180031215
185190031215       LS2-0000-0080.
185200031215           IF  WS-SP-FLST(SP) IS NOT LESS THAN  WS-SPF-MAX
185210031215               DISPLAY "PAC INVESTMENTS FOR ACCOUNT / PAC ("
185220031215                       PREV-ACCOUNT
185230031215                       " / "
185240031215                       WS-SP-SEQ (SP)
185250031215                       ") EXCEED PROGRAM MAXIMUM"
185260031215               GO TO LS2-0000-0090.
185270031215
185280031215           SET SPF TO WS-SP-FLST (SP).
185290031215           SET SPF UP BY  1.
185300031215
185310031215           IF  PAC-SPLIT-OPTION-RULE(WS-SQL-INDEX) EQUAL TO  "%"
185320031215               COMPUTE WS-SPF-AMT(SP, SPF) ROUNDED
185330031215                       =  (WS-SP-PAMT(SP)
185340041224                           * PAC-DEPOSIT-AMT(WS-SQL-INDEX)
185350031215                           /  100)
185360031215            ELSE
185370041224               MOVE PAC-DEPOSIT-AMT(WS-SQL-INDEX)
185380041224                                 TO WS-SPF-AMT(SP, SPF)
185390041224           END-IF.
185400041224
185410041224           COMPUTE WS-SPF-COM(SP, SPF) ROUNDED
185420031215                   =  (WS-SPF-AMT(SP, SPF)
185430031215R18368                 * PAC-NEGOTIATED-COMM(WS-SQL-INDEX)
185440031215                       /  100).
185450031215
185460031215R18485     SET ICS TO 1.
185470031215           SEARCH WS-INVCDE-ENT VARYING ICS
185480031215               AT END
185490031215                  MOVE SPACES TO WS-SPF-FND (SP, SPF)
185500031215R24514            MOVE SPACES TO WS-SPF-FND-NAME(SP, SPF)
185510031215               WHEN WS-IC-CODE(ICS) = PAC-INVESTMENT-CODE(WS-SQL-INDEX)
185520031215                    MOVE WS-IC-FUND(ICS) TO WS-SPF-FND (SP, SPF)
185530031215R24514              IF WS-IC-NAME-FLAG = "F"
185540031215   ¦                 MOVE WS-IC-NAME-F(ICS) TO WS-SPF-FND-NAME(SP, SPF)
185550031215   ¦                ELSE
185560031215   v                 MOVE WS-IC-NAME-E(ICS) TO WS-SPF-FND-NAME(SP, SPF)
185570031215R24514              END-IF
185580031215                    GO TO LS2-0000-0080-0001
185590031215           END-SEARCH.
185600031215
185610031215       LS2-0000-0080-0001.
185620031215R17095     MOVE PAC-SPLIT-OPTION-CODE(WS-SQL-INDEX)
185630031215R17095                                 TO WS-SPF-TYP (SP, SPF).
185640031215
185650031215           MOVE SPACES                 TO  WS-SPF-GNP (SP, SPF).
185660031215           ADD WS-SPF-COM (SP, SPF)    TO  WS-SP-CAMT (SP).
185670031215           ADD 1                       TO  WS-SP-FLST (SP).
185680031215           ADD WS-SPF-AMT (SP, SPF)    TO  WS-SP-TAMT (SP).
185690031215
185700031215       LS2-0000-0090.
185710031215           IF WS-SQL-INDEX < WS-SQL-ACTUAL
185720031215              GO TO LS2-INCREMENT-WS-SQL-INDEX-PAC
185730971009           END-IF.
185740971009
185750971009           IF WS-SQL-ACTUAL = IVRPACMAX
185760971009              GO TO LS2-GET-PAC-INFO
185770971009           END-IF.
185780971009
185790971009       LS2-CLOSE-IVRPACC1.
185800971009           MOVE "CLOSE IVRPACC1  " TO WS-SQLERR-STATEMENT.
185810971009           EXEC SQL
185820971009             CLOSE IVRPACC1
185830971009           END-EXEC.
185840971009
185850971009R19502**** End
185860971009
185870971009       LS2-0000-0100.
185880971010
185890971009      *****
185900971009      *****    Using the table, format and generate the Systematic Plan
185910971009      *****    Info records for the PAC data, in PAC sequence.
185920971009      ****
185930971009
185940971009           SET SP                      TO  1.
185950971009           MOVE ZEROES                 TO  WS-SEQ.
185960971009           MOVE ZEROES                 TO  WS-SEQ-LST.
185970971009           MOVE 1                      TO  WS-SP-SECTION-SEQUENCE.
185980971009
185990971009       LS2-0000-0110.
186000971009           IF  SP         IS GREATER THAN  WS-SP-LST
186010971009               GO TO LS2-0000-0130.
186020971010
186030971026           IF  WS-SP-SEQ (SP)
186040971026                      IS NOT GREATER THAN  WS-SEQ-LST
186050971101               GO TO LS2-0000-0120.
186060971101
186070971101           IF  WS-SEQ         IS EQUAL TO  ZEROES
186080971101           OR  WS-SP-SEQ (SP)   LESS THAN  WS-SEQ
186090971101               SET SP2                 TO  SP
186100971101               MOVE WS-SP-SEQ (SP)     TO  WS-SEQ.
186110971101
186120971101       LS2-0000-0120.
186130971101           SET SP                   UP BY  1.
186140971101           GO TO LS2-0000-0110.
186150971101
186160971101       LS2-0000-0130.
186170971009           IF  WS-SEQ IS NOT GREATER THAN  ZEROES
186180971009               GO TO LS2-0000-0160.
186190971009
186200971009           SET SP                      TO  SP2.
186210971009
186220971009      *****
186230971009      *****    If the PAC has not yet started, is not active or has a
186240971009      *****    zero amount, bypass it.
186250971010      *****
186260971009
186270971009           IF  WS-SP-STRT (SP)
186280971009                          IS GREATER THAN  WS-LDA-ENDDTE
186290971009           OR  WS-SP-STAT (SP)
186300971009                          IS NOT EQUAL TO  "AC"
186310971010           OR  WS-SP-TAMT (SP)   EQUAL TO  ZEROES
186320971010               GO TO LS2-0000-0150-0010.
186330971010
186340971010      *****
186350971010      *****    Determine if the PAC data is to be reported at the detail
186360971010      *****    level or only at the summary level.
186370971009      *****
186380991108
186390971009           IF  WS-LDA-PACAWD-FLAG
186400971009                          IS NOT EQUAL TO  "Y"
186410971009               GO TO LS2-0000-0150.
186420971009
186430971009           SET SPF                     TO  1.
186440971009
186450971009       LS2-0000-0140.
186460971009           IF  SPF        IS GREATER THAN  WS-SP-FLST (SP)
186470971010               GO TO LS2-0000-0150.
186480980128
186490980128      *****
186500971010      *****    Format and create the Systematic Plan Info Section record
186510971010      *****    for the PAC detail.
186520971010      *****
186530971010
186540971010991108     INITIALIZE          SYSTEMATIC-PLAN-INFO-SECTION.
186550971010           MOVE PREV-INVESTOR          TO  SP-INVESTOR-NO.
186560971010           MOVE PREV-ACCOUNT           TO  SP-ACCOUNT.
186570971010           MOVE 70                     TO  SP-SECTION-NO.
186580971024           MOVE WS-SP-SECTION-SEQUENCE TO  SP-SECTION-SEQUENCE.
186590971010           MOVE AD-LANGUAGE            TO  SP-LANGUAGE.
186600971010           MOVE AD-DEALER              TO  SP-DEALER.
186610971010           MOVE AD-SALESREP            TO  SP-SALESREP.
186620971010           MOVE WS-SP-PLAN (SP)        TO  SP-PLAN-TYPE.
186630041224           MOVE WS-SP-FREQ (SP)        TO  SP-PLAN-FREQUENCY.
186640120126           MOVE WS-SP-STRT (SP)        TO  SP-START-DATE-D.
186650120126           MOVE WS-SP-STOP (SP)        TO  SP-STOP-DATE.
186660120126           MOVE WS-SP-REST (SP)        TO  SP-RESTART-DATE.
186670120202           MOVE WS-SP-STAT (SP)        TO  SP-PLAN-STATUS.
186680120210           MOVE WS-SP-CURR (SP)        TO  SP-CURRENCY.
186690120314           MOVE WS-SP-PTYP (SP)        TO  SP-PAYMENT-TYPE.
186700120126           MOVE WS-SPF-TYP (SP, SPF)   TO  SP-AMOUNT-TYPE.
186710120126           MOVE WS-SPF-GNP (SP, SPF)   TO  SP-GROSS-NET-PROCEEDS.
186720971010           MOVE WS-SP-TAMT (SP)        TO  SP-PLAN-TOTAL-AMOUNT.
186730971010           MOVE WS-SP-INST (SP)        TO  SP-PLAN-INSTITUTION-NAME.
186740020321           STRING WS-LDA-MGMT-COM-CDE
186750980129                             DELIMITED BY  SIZE
186760120925                  WS-SPF-FND (SP, SPF)
186770120918                             DELIMITED BY  " "
186780120918                                     INTO  SP-FUNDNO.
186790060621R24514     MOVE WS-SPF-FND-NAME(SP, SPF)   TO  SP-INVESTMENT-NAME.
186800030825
186810971010      *RFS93662 Start
186820971010           IF lb_OMSEXTYes
186830971010              MOVE WS-LDA-MGMT-COM-CDE     TO SP-OMS-CMPCDE
186840971010              MOVE WS-SPF-FND  (SP, SPF)
186850971010                                           TO SP-OMS-FUND-NO
186860971010           END-IF.
186870971010      *RFS93662 End
186880971010           MOVE WS-SPF-AMT (SP, SPF)   TO  SP-FUND-AMOUNT.
186890971010           MOVE WS-SPF-COM (SP, SPF)   TO  SP-COMMISSION.
186900971010           MOVE WS-PREV-START-DATE        TO  SP-START-DATE.
186910971010           MOVE PREV-END-DATE          TO  SP-END-DATE.
186920030910      * RFS112003 - Strats
186930030910           PERFORM GET-DESC THRU GTD-EXIT.
186940971010      * RFS112003 - Ends
186950991108R18147     MOVE SYSTEMATIC-PLAN-INFO-SECTION TO STATEMENT-REC(ISR).
186960971010R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
186970971010
186980971010           ADD 1                       TO  WS-SP-SECTION-SEQUENCE.
186990971010           SET SPF                  UP BY  1.
187000971010           GO TO LS2-0000-0140.
187010971010
187020971010       LS2-0000-0150.
187030971010
187040971010      *****
187050980128      *****    Format and create the Systematic Plan Info Section record
187060971010      *****    for the PAC summary.
187070971010      *****
187080971010
187090971010R17095     SET SPF                     TO  1.
187100971010
187110030910991108     INITIALIZE          SYSTEMATIC-PLAN-INFO-SECTION.
187120971010           MOVE PREV-INVESTOR          TO  SP-INVESTOR-NO.
187130971010           MOVE PREV-ACCOUNT           TO  SP-ACCOUNT.
187140971010           MOVE 70                     TO  SP-SECTION-NO.
187150971010           MOVE WS-SP-SECTION-SEQUENCE TO  SP-SECTION-SEQUENCE.
187160041224           MOVE AD-LANGUAGE            TO  SP-LANGUAGE.
187170971010           MOVE AD-DEALER              TO  SP-DEALER.
187180971010           MOVE AD-SALESREP            TO  SP-SALESREP.
187190020321           MOVE WS-SP-PLAN (SP)        TO  SP-PLAN-TYPE.
187200980129           MOVE WS-SP-FREQ (SP)        TO  SP-PLAN-FREQUENCY.
187210120925           MOVE WS-SP-STRT (SP)        TO  SP-START-DATE-D.
187220120918           MOVE WS-SP-STOP (SP)        TO  SP-STOP-DATE.
187230120918           MOVE WS-SP-REST (SP)        TO  SP-RESTART-DATE.
187240060621           MOVE WS-SP-STAT (SP)        TO  SP-PLAN-STATUS.
187250030825           MOVE WS-SP-CURR (SP)        TO  SP-CURRENCY.
187260971010           MOVE WS-SP-PTYP (SP)        TO  SP-PAYMENT-TYPE.
187270971010R17095     MOVE WS-SPF-TYP (SP, SPF)   TO  SP-AMOUNT-TYPE.
187280971101           MOVE SPACES                 TO  SP-GROSS-NET-PROCEEDS.
187290971101           MOVE WS-SP-TAMT (SP)        TO  SP-PLAN-TOTAL-AMOUNT.
187300971010           MOVE WS-SP-INST (SP)        TO  SP-PLAN-INSTITUTION-NAME.
187310980613           MOVE "TOTAL   "             TO  SP-FUNDNO.
187320971010R24514     MOVE SPACES                 TO  SP-INVESTMENT-NAME.
187330971010           MOVE WS-SP-TAMT (SP)        TO  SP-FUND-AMOUNT.
187340971010           MOVE WS-SP-CAMT (SP)        TO  SP-COMMISSION.
187350971010           MOVE WS-PREV-START-DATE        TO  SP-START-DATE.
187360031215           MOVE PREV-END-DATE          TO  SP-END-DATE.
187370031215      * RFS112003 - Strats
187380031215           PERFORM GET-DESC THRU GTD-EXIT.
187390031215      * RFS112003 - Ends
187400031215R18147     MOVE SYSTEMATIC-PLAN-INFO-SECTION TO STATEMENT-REC(ISR).
187410031215R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
187420031215
187430031215           ADD 1                       TO  WS-SP-SECTION-SEQUENCE.
187440031215
187450031215       LS2-0000-0150-0010.
187460031215           SET SP                      TO  1.
187470031215           MOVE WS-SEQ                 TO  WS-SEQ-LST.
187480031215           MOVE ZEROES                 TO  WS-SEQ.
187490031215           GO TO LS2-0000-0110.
187500031215
187510031215       LS2-0000-0160.
187520031215      ***** Section-70-AWD.
187530031215      *****
187540031215      *****    Process the Systematic Plan Info AWD data using the
187550031215      *****    Account AWD and Account AWD Investment files.  Initially,
187560031215      *****    build the table.
187570031215      *****
187580031215
187590031215           MOVE SPACES                 TO  WS-SYSPLN-TBL.
187600031215           MOVE ZEROES                 TO  WS-SP-LST.
187610031215
187620031215R19502*** Start
187630031215           MOVE PREV-ACCOUNT TO WS-ACCOUNT-NO.
187640031215
187650031215       LS2-OPEN-ACCAWDC1.
187660031215           MOVE "OPEN ACCAWDC1" TO WS-SQLERR-STATEMENT.
187670031215           EXEC SQL
187680031215              OPEN ACCAWDC1
187690031215           END-EXEC.
187700031215
187710031215       LS2-GET-AWD-INFO.
187720031215           MOVE "FETCH ACCAWDC1" TO WS-SQLERR-STATEMENT.
187730031215           EXEC SQL
187740031215             FETCH NEXT FROM ACCAWDC1
187750031215             FOR :ACCAWDMAX ROWS
187760031215             INTO :AWD-ACCAWDC1-FIELDS
187770031215           END-EXEC.
187780031215
187790031215           IF SQLCODE > 0
187800031215             GO TO LS2-CLOSE-ACCAWDC1
187810031215           END-IF.
187820031215
187830031215           COMPUTE WS-SQL-INDEX = 0.
187840031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3).
187850031215
187860031215       LS2-INCREMENT-WS-SQL-INDEX-AWD.
187870031215           ADD 1 TO WS-SQL-INDEX.
187880031215
187890031215           SET SP TO 1.
187900031215
187910031215       LS2-0000-0170.
187920031215           IF  SP IS GREATER THAN  WS-SP-LST
187930031215               GO TO LS2-0000-0180
187940031215           END-IF.
187950031215
187960031215           IF  AWD-AWD-SEQ-NO(WS-SQL-INDEX)
187970031215                          IS NOT EQUAL TO WS-SP-SEQ (SP)
187980031215               SET SP UP BY  1
187990031215               GO TO LS2-0000-0170
188000031215           END-IF.
188010031215
188020031215           GO TO LS2-0000-0200.
188030031215
188040031215       LS2-0000-0180.
188050031215           IF  WS-SP-LST IS NOT LESS THAN  WS-SP-MAX
188060031215               DISPLAY "AWDS FOR ACCOUNT "
188070031215                       PREV-ACCOUNT
188080031215                       " EXCEED PROGRAM MAXIMUM"
188090031215               GO TO LS2-0000-0230
188100031215           END-IF.
188110031215
188120031215           MOVE ZEROES TO WS-SP-CAMT(SP).
188130031215           MOVE AWD-CURRENCY(WS-SQL-INDEX) TO WS-SP-CURR(SP).
188140031215           MOVE ZEROES TO WS-SP-FLST(SP).
188150031215           MOVE AWD-FREQUENCY-CODE(WS-SQL-INDEX) TO WS-SP-FREQ(SP).
188160031215           MOVE SPACES TO WS-SP-INST(SP).
188170031215           MOVE ZEROES TO WS-SP-PAMT(SP).
188180031215           MOVE "AWD" TO WS-SP-PLAN(SP).
188190031215           MOVE AWD-AWD-PAYMENT-TYPE(WS-SQL-INDEX) TO WS-SP-PTYP(SP).
188200031215           MOVE AWD-HOLD-UNTIL-DATE(WS-SQL-INDEX) TO WS-SP-REST(SP).
188210031215           MOVE AWD-AWD-SEQ-NO(WS-SQL-INDEX) TO WS-SP-SEQ(SP).
188220031215           MOVE SPACES TO WS-SP-SOPT(SP).
188230031215           MOVE AWD-AWD-STATUS(WS-SQL-INDEX) TO WS-SP-STAT(SP).
188240031215           MOVE AWD-STOP-DATE(WS-SQL-INDEX) TO WS-SP-STOP(SP).
188250200831           MOVE AWD-START-DATE(WS-SQL-INDEX) TO WS-SP-STRT(SP).
188260031215186053     MOVE AWD-USE-WITHD-HIER(WS-SQL-INDEX) TO WS-SP-USE-WDH(SP).
188270031215           MOVE ZEROES TO WS-SP-TAMT(SP).
188280031215           ADD 1 TO WS-SP-LST.
188290031215
188300031215       LS2-0000-0200.
188310031215           IF  WS-SP-FLST (SP) IS NOT LESS THAN  WS-SPF-MAX
188320031215               DISPLAY "AWD INVESTMENTS FOR ACCOUNT / AWD ("
188330031215                       PREV-ACCOUNT
188340031215                       " / "
188350031215                       WS-SP-SEQ (SP)
188360031215                       ") EXCEED PROGRAM MAXIMUM"
188370031215               GO TO LS2-0000-0220.
188380031215
188390031215           SET SPF TO WS-SP-FLST (SP).
188400031215           SET SPF UP BY 1.
188410031215
188420031215R17095     IF AWD-SPLIT-OPTION-RULE(WS-SQL-INDEX) = "$"
188430031215              MOVE AWD-AWD-AMOUNT(WS-SQL-INDEX) TO WS-SPF-AMT(SP, SPF)
188440041224R17095     END-IF.
188450031215
188460031215R17095     IF AWD-SPLIT-OPTION-RULE(WS-SQL-INDEX) = "%"
188470041224  ¦           MOVE AWD-AWD-PERCENT(WS-SQL-INDEX) TO WS-SPF-AMT(SP, SPF)
188480041224R17095     END-IF.
188490041224
188500041224R17095     IF AWD-SPLIT-OPTION-RULE(WS-SQL-INDEX) = "U"
188510041224              MOVE AWD-AWD-UNITS(WS-SQL-INDEX) TO WS-SPF-AMT(SP, SPF)
188520031215R17095     END-IF.
188530031215
188540031215           MOVE ZEROES TO WS-SPF-COM (SP, SPF).
188550031215
188560031215R18485     SET ICS TO 1.
188570031215           SEARCH WS-INVCDE-ENT VARYING ICS
188580031215               AT END
188590031215                  MOVE SPACES TO WS-SPF-FND(SP, SPF)
188600031215R24514            MOVE SPACES TO WS-SPF-FND-NAME(SP, SPF)
188610031215               WHEN WS-IC-CODE(ICS) = AWD-INVESTMENT-CODE(WS-SQL-INDEX)
188620031215                  MOVE WS-IC-FUND(ICS) TO WS-SPF-FND(SP, SPF)
188630031215R24514            IF WS-IC-NAME-FLAG = "F"
188640031215   ¦                 MOVE WS-IC-NAME-F(ICS) TO WS-SPF-FND-NAME(SP, SPF)
188650031215   ¦              ELSE
188660031215   v                 MOVE WS-IC-NAME-E(ICS) TO WS-SPF-FND-NAME(SP, SPF)
188670031215R24514            END-IF
188680031215           END-SEARCH.
188690031215
188700031215           MOVE AWD-GROSS-OR-NET(WS-SQL-INDEX) TO WS-SPF-GNP(SP, SPF).
188710031215           MOVE AWD-SPLIT-OPTION-CODE(WS-SQL-INDEX)
188720031215                                       TO  WS-SPF-TYP(SP, SPF).
188730031215
188740031215           ADD WS-SPF-COM (SP, SPF)    TO  WS-SP-CAMT (SP).
188750031215           ADD 1                       TO  WS-SP-FLST (SP).
188760031215           ADD WS-SPF-AMT (SP, SPF)    TO  WS-SP-TAMT (SP).
188770031215
188780031215       LS2-0000-0220.
188790031215           IF WS-SQL-INDEX < WS-SQL-ACTUAL
188800031215              GO TO LS2-INCREMENT-WS-SQL-INDEX-AWD
188810971010           END-IF.
188820971010
188830971010           IF WS-SQL-ACTUAL = ACCAWDMAX
188840971023              GO TO LS2-GET-AWD-INFO
188850971023           END-IF.
188860971010
188870971010       LS2-CLOSE-ACCAWDC1.
188880971023           MOVE "CLOSE ACCAWDC1" TO WS-SQLERR-STATEMENT.
188890971010           EXEC SQL
188900971023              CLOSE ACCAWDC1
188910971010           END-EXEC.
188920971023
188930971101R19502*** End
188940971101
188950971101       LS2-0000-0230.
188960971101
188970971101
188980971101      *****
188990971101      *****    Using the table, format and generate the Systematic Plan
189000971101      *****    Info records for the AWD data, in AWD sequence.
189010971101      *****
189020971101
189030971101           SET SP                      TO  1.
189040971101           MOVE 100001                 TO  WS-SP-SECTION-SEQUENCE.
189050971010
189060971010       LS2-0000-0240.
189070971023           IF  SP         IS GREATER THAN  WS-SP-LST
189080971010               GO TO LS2-0000-0280.
189090971010
189100971010      *****
189110971010      *****    If the AWD has not yet started, is not active or has a
189120971010      *****    zero amount, bypass it.
189130971023      *****
189140971010
189150971010           IF  WS-SP-STRT (SP)
189160971010                          IS GREATER THAN  WS-LDA-ENDDTE
189170971023           OR  WS-SP-STAT (SP)
189180971010                          IS NOT EQUAL TO  "AC"
189190971023           OR  WS-SP-TAMT (SP)   EQUAL TO  ZEROES
189200971010               GO TO LS2-0000-0270.
189210971010
189220971010      *****
189230971023      *****    Determine if the AWD data is to be reported at the detail
189240971010      *****    level or only at the summary level.
189250971010      *****
189260991108
189270971010           IF  WS-LDA-PACAWD-FLAG
189280971010                          IS NOT EQUAL TO  "Y"
189290971010               GO TO LS2-0000-0260.
189300971010
189310971010           SET SPF                     TO  1.
189320971010
189330971010       LS2-0000-0250.
189340971010           IF  SPF        IS GREATER THAN  WS-SP-FLST (SP)
189350971010               GO TO LS2-0000-0260.
189360980128
189370971010      *****
189380971010      *****    Format and create the Systematic Plan Info Section record
189390971010      *****    for the AWD detail.
189400971010      *****
189410971010
189420971024991108     INITIALIZE          SYSTEMATIC-PLAN-INFO-SECTION.
189430971024           MOVE PREV-INVESTOR          TO  SP-INVESTOR-NO.
189440971010           MOVE PREV-ACCOUNT           TO  SP-ACCOUNT.
189450971010           MOVE 70                     TO  SP-SECTION-NO.
189460971024           MOVE WS-SP-SECTION-SEQUENCE TO  SP-SECTION-SEQUENCE.
189470971010           MOVE AD-LANGUAGE            TO  SP-LANGUAGE.
189480971010           MOVE AD-DEALER              TO  SP-DEALER.
189490971010           MOVE AD-SALESREP            TO  SP-SALESREP.
189500971010           MOVE WS-SP-PLAN (SP)        TO  SP-PLAN-TYPE.
189510041224           MOVE WS-SP-FREQ (SP)        TO  SP-PLAN-FREQUENCY.
189520120126           MOVE WS-SP-STRT (SP)        TO  SP-START-DATE-D.
189530120126           MOVE WS-SP-STOP (SP)        TO  SP-STOP-DATE.
189540120126           MOVE WS-SP-REST (SP)        TO  SP-RESTART-DATE.
189550120213           MOVE WS-SP-STAT (SP)        TO  SP-PLAN-STATUS.
189560120210           MOVE WS-SP-CURR (SP)        TO  SP-CURRENCY.
189570120314           MOVE WS-SP-PTYP (SP)        TO  SP-PAYMENT-TYPE.
189580120126           MOVE WS-SPF-TYP (SP, SPF)   TO  SP-AMOUNT-TYPE.
189590120126           MOVE WS-SPF-GNP (SP, SPF)   TO  SP-GROSS-NET-PROCEEDS.
189600120126           MOVE WS-SP-TAMT (SP)        TO  SP-PLAN-TOTAL-AMOUNT.
189610200831           MOVE WS-SP-INST (SP)        TO  SP-PLAN-INSTITUTION-NAME.
189620971010186053     MOVE WS-SP-USE-WDH (SP)     TO  SP-USE-WITHD-HIER.
189630971010           STRING WS-LDA-MGMT-COM-CDE
189640020321                             DELIMITED BY  SIZE
189650980129                  WS-SPF-FND (SP, SPF)
189660120925                             DELIMITED BY  " "
189670120918                                     INTO  SP-FUNDNO.
189680120918R24514     MOVE WS-SPF-FND-NAME(SP, SPF)   TO  SP-INVESTMENT-NAME.
189690060621
189700030825      *RFS93662 Start
189710971010           IF lb_OMSEXTYes
189720971010              MOVE WS-LDA-MGMT-COM-CDE     TO SP-OMS-CMPCDE
189730971010              MOVE WS-SPF-FND  (SP, SPF)
189740971023                                           TO SP-OMS-FUND-NO
189750971010           END-IF.
189760971023      *RFS93662 End
189770971010
189780971010           MOVE WS-SPF-AMT (SP, SPF)   TO  SP-FUND-AMOUNT.
189790971010           MOVE WS-SPF-COM (SP, SPF)   TO  SP-COMMISSION.
189800971023           MOVE WS-PREV-START-DATE        TO  SP-START-DATE.
189810971010           MOVE PREV-END-DATE          TO  SP-END-DATE.
189820971010      * RFS112003 - Strats
189830971023           PERFORM GET-DESC THRU GTD-EXIT.
189840971023      * RFS112003 - Ends
189850971023R18147     MOVE SYSTEMATIC-PLAN-INFO-SECTION TO STATEMENT-REC(ISR).
189860971023R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
189870991108
189880971010           ADD 1                       TO  WS-SP-SECTION-SEQUENCE.
189890971010           SET SPF                  UP BY  1.
189900971010           GO TO LS2-0000-0250.
189910971010
189920971010       LS2-0000-0260.
189930971010
189940971010      *****
189950971010      *****    Format and create the Systematic Plan Info Section record
189960971010      *****    for the AWD summary, if at least one detail was reported.
189970980128      *****
189980971010
189990971010           IF  WS-SP-FLST (SP)
190000971010                      IS NOT GREATER THAN  ZEROES
190010971010               GO TO LS2-0000-0270.
190020971010
190030971024991108     INITIALIZE          SYSTEMATIC-PLAN-INFO-SECTION.
190040971024           MOVE PREV-INVESTOR          TO  SP-INVESTOR-NO.
190050971010           MOVE PREV-ACCOUNT           TO  SP-ACCOUNT.
190060971010           MOVE 70                     TO  SP-SECTION-NO.
190070971010           MOVE WS-SP-SECTION-SEQUENCE TO  SP-SECTION-SEQUENCE.
190080041224           MOVE AD-LANGUAGE            TO  SP-LANGUAGE.
190090971010           MOVE AD-DEALER              TO  SP-DEALER.
190100971010           MOVE AD-SALESREP            TO  SP-SALESREP.
190110020321           MOVE WS-SP-PLAN (SP)        TO  SP-PLAN-TYPE.
190120980129           MOVE WS-SP-FREQ (SP)        TO  SP-PLAN-FREQUENCY.
190130120925           MOVE WS-SP-STRT (SP)        TO  SP-START-DATE-D.
190140120918           MOVE WS-SP-STOP (SP)        TO  SP-STOP-DATE.
190150120918           MOVE WS-SP-REST (SP)        TO  SP-RESTART-DATE.
190160060621           MOVE WS-SP-STAT (SP)        TO  SP-PLAN-STATUS.
190170030825           MOVE WS-SP-CURR (SP)        TO  SP-CURRENCY.
190180971010           MOVE WS-SP-PTYP (SP)        TO  SP-PAYMENT-TYPE.
190190971010           MOVE WS-SPF-TYP (SP, 1)     TO  SP-AMOUNT-TYPE.
190200971023           MOVE WS-SPF-GNP (SP, 1)     TO  SP-GROSS-NET-PROCEEDS.
190210971023           MOVE WS-SP-TAMT (SP)        TO  SP-PLAN-TOTAL-AMOUNT.
190220971026           MOVE WS-SP-INST (SP)        TO  SP-PLAN-INSTITUTION-NAME.
190230971023           MOVE "TOTAL   "             TO  SP-FUNDNO.
190240971010R24514     MOVE SPACES                 TO  SP-INVESTMENT-NAME.
190250971023           MOVE WS-SP-TAMT (SP)        TO  SP-FUND-AMOUNT.
190260200831           MOVE WS-SP-CAMT (SP)        TO  SP-COMMISSION.
190270981119186053     MOVE WS-SP-USE-WDH (SP)     TO  SP-USE-WITHD-HIER.
190280981119           MOVE WS-PREV-START-DATE        TO  SP-START-DATE.
190290990803           MOVE PREV-END-DATE          TO  SP-END-DATE.
190300990803      * RFS112003 - Strats
190310981119           PERFORM GET-DESC THRU GTD-EXIT.
190320981119      * RFS112003 - Ends
190330981119R18147     MOVE SYSTEMATIC-PLAN-INFO-SECTION TO STATEMENT-REC(ISR).
190340981116R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
190350981116
190360020627           ADD 1                       TO  WS-SP-SECTION-SEQUENCE.
190370981116
190380981116       LS2-0000-0270.
190390981116           SET SP                   UP BY  1.
190400981116           GO TO LS2-0000-0240.
190410981116
190420981116       LS2-0000-0280.
190430981116
190440981116      *****
190450981116      *****  If the FCR flag is "Y" write the SYSTEMATIC PLAN INFO
190460981116      *****  record to reflect FOREIGN CONTENT REBALANCING FUND
190470020627      *****  information.
190480020628      *****
190490020628
190500020628           IF WS-LDA-FCR-FUND-FLAG IS NOT EQUAL TO "Y"
190510020627              GO TO LS2-0000-0290.
190520020627
190530020627           INITIALIZE MFAACFROP.
190540020627           MOVE PREV-ACCOUNT TO ACCOUNT-NO OF
190550020627                                ACC-FCR-OPT-REC.
190560020627           READ ACCOUNT-FGN-CONTENT-REBAL-OPT
190570020627                INVALID KEY
190580020627                GO TO LS2-0000-0290.
190590020627
190600020627           IF FC-REBAL-PENALTY-OPTION OF ACC-FCR-OPT-REC
190610020627              IS NOT EQUAL TO "R"
190620020627              GO TO LS2-0000-0290.
190630020627
19064002062714178      MOVE 200001 TO WS-SP-SECTION-SEQUENCE.
190650020627  ¦
190660020627  ¦        INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-FCR.
190670020627  |        MOVE PREV-ACCOUNT TO ACCOUNT-NO OF ACCOUNT-INVESTMENT-FCR.
190680031007  |
190690031007  |        START ACCOUNT-INVESTMENT-FCR
190700031007  |              KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
190710031007  |              INVALID KEY
190720031007  |                GO TO LS2-0000-0290.
190730031007  |
190740031007  |    LS2-0000-0285.
190750031007  |        READ ACCOUNT-INVESTMENT-FCR NEXT RECORD
190760031007  |             AT END
190770981116  |              GO TO LS2-0000-0290.
190780031007  |
190790020627  |        IF ACCOUNT-NO OF ACCOUNT-INVESTMENT-FCR IS NOT EQUAL TO
190800020627  |           PREV-ACCOUNT
190810020626  |              GO TO LS2-0000-0290.
190820981116  |
190830981116
190840981116           SET ICS TO 1.
190850020626           SEARCH WS-INVCDE-ENT VARYING ICS
190860981116               AT END
190870981116                  GO TO LS2-0000-0285
190880020627               WHEN (WS-IC-CODE(ICS) = INVESTMENT-CODE
190890981116                                     OF ACCOUNT-INVESTMENT-FCR)
190900020626                    AND (WS-IC-FRGN(ICS) = "Y")
190910981116                    GO TO LS2-0000-0285-0001
190920020627           END-SEARCH.
190930981116
190940020627R18485 LS2-0000-0285-0001.
190950020627R14178     INITIALIZE MFAFCRESP OF FGN-CONTENT-REB-SCHED-REC.
190960020627 |         MOVE INVESTMENT-CODE  OF ACCOUNT-INVESTMENT-FCR
190970020627R14178     TO INVESTMENT-CODE OF FGN-CONTENT-REB-SCHED-REC.
190980020627           MOVE FC-REBAL-SCHEDULE-CODE OF ACC-FCR-OPT-REC
190990020627           TO FC-REBAL-SCHEDULE-CODE OF FGN-CONTENT-REB-SCHED-REC.
191000020627
191010020627           START FGN-CONTENT-REBAL-SCHED-LA
191020020627                 KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
191030020627                 INVALID KEY
191040981116                   GO TO LS2-0000-0285.
191050981116
191060981116           READ FGN-CONTENT-REBAL-SCHED-LA NEXT RECORD
191070981116                AT END
191080020627                 GO TO LS2-0000-0285.
191090981116
19110098111614178      IF INVESTMENT-CODE OF ACCOUNT-INVESTMENT-FCR
191110981116  |         IS NOT EQUAL TO
191120981116  |         INVESTMENT-CODE OF FGN-CONTENT-REB-SCHED-REC
19113098111614178        GO TO LS2-0000-0285.
191140981119
19115003100714178      IF   FC-REBAL-SCHEDULE-CODE OF ACC-FCR-OPT-REC
191160031007  |         IS NOT EQUAL TO
191170031007  |           FC-REBAL-SCHEDULE-CODE OF FGN-CONTENT-REB-SCHED-REC
19118003100714178        GO TO LS2-0000-0285.
191190031007
191200031007           INITIALIZE                      SYSTEMATIC-PLAN-INFO-SECTION.
191210031007           MOVE PREV-INVESTOR          TO  SP-INVESTOR-NO.
191220031007           MOVE PREV-ACCOUNT           TO  SP-ACCOUNT.
191230031007           MOVE 70                     TO  SP-SECTION-NO.
191240031007R14178     MOVE WS-SP-SECTION-SEQUENCE TO  SP-SECTION-SEQUENCE.
191250020321           MOVE AD-LANGUAGE            TO  SP-LANGUAGE.
191260981116           MOVE AD-DEALER              TO  SP-DEALER.
191270120925           MOVE AD-SALESREP            TO  SP-SALESREP.
191280120918           MOVE "FCR"                  TO  SP-PLAN-TYPE.
191290120918           MOVE "AC"                   TO  SP-PLAN-STATUS.
191300060621
191310030825           SET ICS TO 1.
191320020627           SEARCH WS-INVCDE-ENT VARYING ICS
191330020627               AT END
191340020627                  GO TO LS2-0000-0285
191350020628               WHEN WS-IC-CODE(ICS) = INVESTMENT-CODE2
191360981116                                       OF FGN-CONTENT-REB-SCHED-REC
191370981116                    STRING WS-LDA-MGMT-COM-CDE DELIMITED BY  SIZE
191380020724                           WS-IC-FUND(ICS) DELIMITED BY  " "
191390020725                                              INTO  SP-FUNDNO
191400020724R18485     END-SEARCH.
191410020725           MOVE WS-PREV-START-DATE        TO  SP-START-DATE.
191420061003           MOVE PREV-END-DATE          TO  SP-END-DATE.
191430061003      * RFS112003 - Strats
191440020724           PERFORM GET-DESC THRU GTD-EXIT.
191450020724      * RFS112003 - Ends
191460020725R18147     MOVE SYSTEMATIC-PLAN-INFO-SECTION TO STATEMENT-REC(ISR).
191470020724R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
191480020724
191490061003R14178     ADD 1                       TO  WS-SP-SECTION-SEQUENCE.
191500061003
191510020724R14178     GO TO LS2-0000-0285.
191520020724
191530020725       LS2-0000-0290.
191540020724
191550020724           MOVE WS-1ST-60-EX         TO IS-FIRST60.
191560061003R13637     IF   WS-1ST-60-EX IS LESS THAN 0
191570061003  ¦             MOVE "-" TO IS-FIRST60-SIGN
191580020724R35540     ELSE
191590020724R35540          MOVE " " TO IS-FIRST60-SIGN
191600020725R13637     END-IF.
191610020724
191620020724           MOVE WS-REMAINDER-EX      TO IS-REMAINDER.
191630061003R13637     IF   WS-REMAINDER-EX LESS THAN 0
191640061003  ¦             MOVE "-" TO IS-REMAINDER-SIGN
191650020724R35540     ELSE
191660020724R35540          MOVE " " TO IS-REMAINDER-SIGN
191670020725R13637     END-IF.
191680020724
191690020724           MOVE WS-WITHDRAWALS       TO IS-WITHDRAWALS.
191700061003R13637     IF   WS-WITHDRAWALS LESS THAN 0
191710061003  ¦             MOVE "-" TO IS-WITHDRAWALS-SIGN
191720020724R35540     ELSE
191730990619R35540          MOVE " " TO IS-WITHDRAWALS-SIGN
191740020725R13637     END-IF.
191750140519
191760020725           MOVE WS-WITHDRAWALS-YTD   TO IS-WITHDRAWALS-YTD.
191770020725R13637     IF   WS-WITHDRAWALS-YTD IS LESS THAN 0
191780061003  ¦             MOVE "-" TO IS-WITHDRAWALS-YTD-SIGN
191790061003R35540     ELSE
191800020725R35540          MOVE " " TO IS-WITHDRAWALS-YTD-SIGN
191810020725R13637     END-IF.
191820990619
191830020725           MOVE WS-TOTAL-VALUE       TO IS-VALUE.
191840020725R13637     IF   WS-TOTAL-VALUE IS LESS THAN 0
191850061003  ¦             MOVE "-" TO IS-VALUE-SIGN
191860061003R35540     ELSE
191870020725R35540          MOVE " " TO IS-VALUE-SIGN
191880020725R13637     END-IF.
191890990619
191900020725           MOVE WS-ACC-RED-INCEPT-EX TO IS-RED-INCEPT.
191910020725130239     MOVE WS-ACC-RED-INCEPT-EX TO li_RedIncep.
191920061003R12726     IF   WS-ACC-RED-INCEPT-EX     IS LESS THAN ZEROES
191930061003  ¦           MOVE "-"  TO  IS-RI-SIGN
191940020725R35540     ELSE
191950020725R35540        MOVE " "  TO  IS-RI-SIGN
191960020725R12726     END-IF.
191970140519
191980020725           MOVE WS-ACC-CPG-INCEPT-EX TO IS-CPG-INCEPT.
191990020725R12726     IF   WS-ACC-CPG-INCEPT-EX     IS LESS THAN ZEROES
192000061003  ¦           MOVE "-"  TO  IS-CI-SIGN
192010061003R35540     ELSE
192020020725R35540        MOVE " "  TO  IS-CI-SIGN
192030020725R12726     END-IF.
192040990619
192050020725           MOVE WS-ACC-INC-INCEPT-EX TO IS-INC-INCEPT.
192060020725R12726     IF   WS-ACC-INC-INCEPT-EX     IS LESS THAN ZEROES
192070061003  ¦           MOVE "-"  TO  IS-II-SIGN
192080061003R35540     ELSE
192090020725R35540        MOVE " "  TO  IS-II-SIGN
192100020725R12726     END-IF.
192110990619
192120140519           MOVE WS-ACC-PUR-INCEPT-EX TO IS-PUR-INCEPT.
192130020403130239     MOVE WS-ACC-PUR-INCEPT-EX TO li_PurIncep.
192140020403R11628     IF   WS-ACC-PUR-INCEPT-EX   IS  LESS THAN  ZEROES
192150061003              MOVE "-"    TO  IS-PI-SIGN
192160061003R35540     ELSE
192170020403R35540        MOVE " "    TO  IS-PI-SIGN
192180020111R11628     END-IF.
192190001006
192200020403           MOVE WS-ACC-INT-INCEPT-EX TO IS-INT-INCEPT.
192210020403R12726     IF   WS-ACC-INT-INCEPT-EX     IS LESS THAN ZEROES
192220061003  ¦           MOVE "-"  TO  IS-NI-SIGN
192230061003R35540     ELSE
192240020403R35540        MOVE " "  TO  IS-NI-SIGN
192250020403R12726     END-IF.
192260990619
192270140519           MOVE WS-ACC-TRO-INCEPT-EX TO IS-TRO-INCEPT.
192280020403130239     MOVE WS-ACC-TRO-INCEPT-EX TO li_TroIncep.
192290020403R12173     IF   WS-ACC-TRO-INCEPT-EX     IS LESS THAN ZEROES
192300061003  ¦           MOVE "-"  TO  IS-TRO-INCEPT-SIGN
192310061003R35540     ELSE
192320020403R35540        MOVE " "  TO  IS-TRO-INCEPT-SIGN
192330020111R12173     END-IF.
192340030826
192350020923RF7777     MOVE WS-ACC-SWO-INCEPT-EX TO IS-SWO-INCEPT.
192360020923R12173     IF   WS-ACC-SWO-INCEPT-EX     IS LESS THAN ZEROES
192370061003  ¦           MOVE "-"  TO  IS-SWO-INCEPT-SIGN
192380061003R35540     ELSE
192390020923R35540        MOVE " "  TO  IS-SWO-INCEPT-SIGN
192400020923R12173     END-IF.
192410030826
192420020923           MOVE WS-ACC-TRI-INCEPT-EX TO IS-TRI-INCEPT.
192430020923130239     MOVE WS-ACC-TRI-INCEPT-EX TO li_TriIncep.
192440061003R12173     IF   WS-ACC-TRI-INCEPT-EX     IS LESS THAN ZEROES
192450061003  ¦           MOVE "-"  TO  IS-TRI-INCEPT-SIGN
192460020923R35540     ELSE
192470021202R35540        MOVE " "  TO  IS-TRI-INCEPT-SIGN
192480030317R12173     END-IF.
192490030317
192500030317R14556     MOVE WS-ACC-TRI-INCEPT-COST-EX  TO IS-TRI-INCEPT-COST.
192510061003           IF WS-ACC-TRI-INCEPT-COST-EX    IS LESS THAN ZEROES
192520061003              MOVE "-"                     TO IS-TRI-INCEPT-COST-SIGN
192530030317R35540     ELSE
192540030317R35540        MOVE " "                     TO IS-TRI-INCEPT-COST-SIGN
192550030317           END-IF.
192560030317
192570030317           MOVE WS-ACC-TRO-INCEPT-COST-EX  TO IS-TRO-INCEPT-COST.
192580061003           IF WS-ACC-TRO-INCEPT-COST-EX    IS LESS THAN ZEROES
192590061003              MOVE "-"                     TO IS-TRO-INCEPT-COST-SIGN
192600030317R35540     ELSE
192610030317R35540        MOVE " "                     TO IS-TRO-INCEPT-COST-SIGN
192620030624R14556     END-IF.
192630030624
192640030624R16256     MOVE WS-ACC-TRI-INCEPT-MKT-EX   TO IS-TRI-INCEPT-MKT.
192650061003           IF WS-ACC-TRI-INCEPT-MKT-EX     IS LESS THAN ZEROES
192660061003              MOVE "-"                     TO IS-TRI-INCEPT-MKT-SIGN
192670030624R35540     ELSE
192680030624R35540        MOVE " "                     TO IS-TRI-INCEPT-MKT-SIGN
192690030826           END-IF.
192700030624
192710030624           MOVE WS-ACC-TRO-INCEPT-MKT-EX   TO IS-TRO-INCEPT-MKT.
192720061003           IF WS-ACC-TRO-INCEPT-MKT-EX     IS LESS THAN ZEROES
192730061003              MOVE "-"                     TO IS-TRO-INCEPT-MKT-SIGN
192740030624R35540     ELSE
192750030624R35540        MOVE " "                     TO IS-TRO-INCEPT-MKT-SIGN
192760030624R16256     END-IF.
192770030624
192780030624R16881     MOVE WS-ACC-TRI-INCEPT-PH-EX  TO IS-TRI-INCEPT-PHANTOM.
192790061003   ¦       IF WS-ACC-TRI-INCEPT-PH-EX    IS LESS THAN ZEROES
192800061003   ¦          MOVE "-"                   TO IS-TRI-INCEPT-PHANTOM-SIGN
192810030624R35540     ELSE
192820030624R35540        MOVE " "                   TO IS-TRI-INCEPT-PHANTOM-SIGN
192830030624   ¦       END-IF.
192840030624   ¦
192850030624   ¦       MOVE WS-ACC-TRI-YTD-PH-EX     TO IS-TRI-YTD-PHANTOM.
192860061003   ¦       IF WS-ACC-TRI-YTD-PH-EX       IS LESS THAN ZEROES
192870061003   ¦          MOVE "-"                   TO IS-TRI-YTD-PHANTOM-SIGN
192880030624R35540     ELSE
192890030624R35540        MOVE " "                   TO IS-TRI-YTD-PHANTOM-SIGN
192900030826   ¦       END-IF.
192910030624   ¦
192920030624   ¦       MOVE WS-ACC-TRI-CUR-PH-EX     TO IS-TRI-CUR-PHANTOM.
192930061003   ¦       IF WS-ACC-TRI-CUR-PH-EX       IS LESS THAN ZEROES
192940061003   ¦          MOVE "-"                   TO IS-TRI-CUR-PHANTOM-SIGN
192950030624R35540     ELSE
192960030624R35540        MOVE " "                   TO IS-TRI-CUR-PHANTOM-SIGN
192970030624   ¦       END-IF.
192980030624   ¦
192990030624   ¦       MOVE WS-ACC-TRO-INCEPT-PH-EX  TO IS-TRO-INCEPT-PHANTOM.
193000061003   ¦       IF WS-ACC-TRO-INCEPT-PH-EX    IS LESS THAN ZEROES
193010061003   ¦          MOVE "-"                   TO AD-TRO-INCEPT-PHANTOM-SIGN
193020030624R35540     ELSE
193030030624R35540        MOVE " "                   TO AD-TRO-INCEPT-PHANTOM-SIGN
193040021202   ¦       END-IF.
193050030826   ¦
193060021202   ¦       MOVE WS-ACC-TRO-YTD-PH-EX     TO IS-TRO-YTD-PHANTOM.
193070021202   ¦       IF WS-ACC-TRO-YTD-PH-EX       IS LESS THAN ZEROES
193080061003   ¦          MOVE "-"                   TO IS-TRO-YTD-PHANTOM-SIGN
193090061003R35540     ELSE
193100021202R35540        MOVE " "                   TO IS-TRO-YTD-PHANTOM-SIGN
193110021202   ¦       END-IF.
193120021202   ¦
193130030826   ¦       MOVE WS-ACC-TRO-CUR-PH-EX     TO IS-TRO-CUR-PHANTOM.
193140021202   ¦       IF WS-ACC-TRO-CUR-PH-EX       IS LESS THAN ZEROES
193150021202   v          MOVE "-"                   TO IS-TRO-CUR-PHANTOM-SIGN
193160061003R35540     ELSE
193170061003R35540        MOVE " "                   TO IS-TRO-CUR-PHANTOM-SIGN
193180021202R16881     END-IF.
193190021202
193200021202R15022     MOVE WS-ACC-DISP-GAIN-LOSS-CUR-EX
193210030826             TO IS-DISP-GAIN-LOSS-CUR.
193220021202           IF WS-ACC-DISP-GAIN-LOSS-CUR-EX IS LESS THAN ZEROES
193230021202              MOVE "-"             TO IS-DISP-GAIN-LOSS-CUR-SIGN
193240061003R35540     ELSE
193250061003R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-CUR-SIGN
193260021202R15022     END-IF.
193270020923
193280001006R15022     MOVE WS-ACC-DISP-GAIN-LOSS-YTD-EX
193290020403             TO IS-DISP-GAIN-LOSS-YTD.
193300020403           IF WS-ACC-DISP-GAIN-LOSS-YTD-EX IS LESS THAN ZEROES
193310061003              MOVE "-"             TO IS-DISP-GAIN-LOSS-YTD-SIGN
193320061003R35540     ELSE
193330020403R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-YTD-SIGN
193340020111R15022     END-IF.
193350010309
193360020730R15022     MOVE WS-ACC-DISP-GAIN-LOSS-INC-EX
193370020730             TO IS-DISP-GAIN-LOSS-INCEPT.
193380061003           IF WS-ACC-DISP-GAIN-LOSS-INC-EX IS LESS THAN ZEROES
193390061003              MOVE "-"             TO IS-DISP-GAIN-LOSS-INCEPT-SIGN
193400020730R35540     ELSE
193410020730R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-INCEPT-SIGN
193420010309R15022     END-IF.
193430020730
193440020730RF7777     MOVE WS-ACC-SWI-INCEPT-EX TO IS-SWI-INCEPT.
193450061003R12173     IF   WS-ACC-SWI-INCEPT-EX     IS LESS THAN ZEROES
193460061003  ¦           MOVE "-"  TO  IS-SWI-INCEPT-SIGN
193470020730R35540     ELSE
193480020730R35540        MOVE " "  TO  IS-SWI-INCEPT-SIGN
193490010309R12173     END-IF.
193500020730
193510020730RF8633     MOVE WS-ACC-TRI-YTD-EX    TO IS-TRI-YTD.
193520061003R13637     IF   WS-ACC-TRI-YTD-EX        IS LESS THAN ZEROES
193530061003  ¦           MOVE "-"  TO  IS-TRI-YTD-SIGN
193540020730R35540     ELSE
193550020730R35540        MOVE " "  TO  IS-TRI-YTD-SIGN
193560010309R13637     END-IF.
193570020730
193580020730RF8633     MOVE WS-ACC-SWI-YTD-EX    TO IS-SWI-YTD.
193590061003R13637     IF   WS-ACC-SWI-YTD-EX        IS LESS THAN ZEROES
193600061003  ¦           MOVE "-"  TO  IS-SWI-YTD-SIGN
193610020730R35540     ELSE
193620020730R35540        MOVE " "  TO  IS-SWI-YTD-SIGN
193630010309R13637     END-IF.
193640010309
193650140519RF8633     MOVE WS-ACC-TRO-YTD-EX    TO IS-TRO-YTD.
193660020730R13637     IF   WS-ACC-TRO-YTD-EX        IS LESS THAN ZEROES
193670020730  ¦           MOVE "-"  TO  IS-TRO-YTD-SIGN
193680061003R35540     ELSE
193690061003R35540        MOVE " "  TO  IS-TRO-YTD-SIGN
193700020730R13637     END-IF.
193710020730
193720020731RF8633     MOVE WS-ACC-SWO-YTD-EX    TO IS-SWO-YTD.
193730020801R13637     IF   WS-ACC-SWO-YTD-EX        IS LESS THAN ZEROES
193740020801  ¦           MOVE "-"  TO  IS-SWO-YTD-SIGN
193750061003R35540     ELSE
193760061003R35540        MOVE " "  TO  IS-SWO-YTD-SIGN
193770020801R13637     END-IF.
193780020730
193790020731RF8633     MOVE WS-PROFESSIONAL-FEE-INCEPT
193800031016                                    TO IS-PROFESSIONAL-FEE-INCEPT.
193810020801130239     MOVE WS-PROFESSIONAL-FEE-INCEPT TO li_FeeIncep.
193820020801R13637     IF   WS-PROFESSIONAL-FEE-INCEPT IS LESS THAN ZEROES
193830031016  ¦           MOVE "-"  TO  IS-PROFESSIONAL-FEE-INCEPT-S
193840061003R35540     ELSE
193850061003R35540        MOVE " "  TO  IS-PROFESSIONAL-FEE-INCEPT-S
193860061003R13637     END-IF.
193870020801
193880010309R13637     MOVE WS-PROFESSIONAL-FEE-YTD TO IS-PROFESSIONAL-FEE-YTD.
193890020730  ¦        IF  WS-PROFESSIONAL-FEE-YTD IS LESS THAN 0
193900020801  ¦            MOVE "-"       TO  IS-PROFESSIONAL-FEE-YTD-SIGN
193910020801R35540     ELSE
193920061003R35540         MOVE " "       TO  IS-PROFESSIONAL-FEE-YTD-SIGN
193930061003R13637     END-IF.
193940020801
193950990619R13637     MOVE WS-PROFESSIONAL-FEE-CUR TO IS-PROFESSIONAL-FEE-CUR.
193960011015R18682     MOVE WS-PROFESSIONAL-FEE-CUR TO IS-FEES.
193970020725  ¦        IF  WS-PROFESSIONAL-FEE-CUR IS LESS THAN 0
193980020725  ¦            MOVE "-"       TO  IS-PROFESSIONAL-FEE-CUR-SIGN
193990020725R18682         MOVE "-"       TO  IS-FEES-SIGN
194000061003R35540     ELSE
194010061003R35540         MOVE " "       TO  IS-PROFESSIONAL-FEE-CUR-SIGN
194020020725R35540         MOVE " "       TO  IS-FEES-SIGN
194030020725R13637     END-IF.
194040990619
194050020725R13637     MOVE WS-ACC-REG-CTB-INCPT-EX   TO  IS-REG-CTB-INCPT.
194060020725  ¦        IF  WS-ACC-REG-CTB-INCPT-EX IS LESS THAN 0
194070061003  ¦            MOVE "-"                TO  IS-REG-CTB-INCPT-SIGN
194080061003R35540     ELSE
194090020725R35540         MOVE " "                TO  IS-REG-CTB-INCPT-SIGN
194100020725R13637     END-IF.
194110990619
194120020725
194130020725           MOVE WS-ACC-PUR-CURRENT-EX TO IS-PUR-CURRENT.
194140061003R13637     IF   WS-ACC-PUR-CURRENT-EX  IS LESS THAN ZEROES
194150061003  ¦           MOVE "-"  TO  IS-PC-SIGN
194160020725R35540     ELSE
194170020725R35540        MOVE " "  TO  IS-PC-SIGN
194180020806R13637     END-IF.
194190020725
194200020725           MOVE WS-ACC-RED-CURRENT-EX TO IS-RED-CURRENT.
194210061003R12726     IF   WS-ACC-RED-CURRENT-EX IS LESS THAN ZEROES
194220061003  ¦             MOVE "-" TO IS-RC-SIGN
194230020725R35540     ELSE
194240020725R35540          MOVE " " TO IS-RC-SIGN
194250990619R12726     END-IF.
194260020725
194270020725           MOVE WS-ACC-CPG-CURRENT-EX TO IS-CPG-CURRENT.
194280061003R13637     IF   WS-ACC-CPG-CURRENT-EX IS LESS THAN ZEROES
194290061003  ¦             MOVE "-" TO IS-CC-SIGN
194300020725R35540     ELSE
194310020725R35540          MOVE " " TO IS-CC-SIGN
194320990619R13637     END-IF.
194330020725
194340020725           MOVE WS-ACC-INC-CURRENT-EX TO IS-INC-CURRENT.
194350061003R13637     IF   WS-ACC-INC-CURRENT-EX IS LESS THAN ZEROES
194360061003  ¦             MOVE "-" TO IS-IC-SIGN
194370020725R35540     ELSE
194380020403R35540          MOVE " " TO IS-IC-SIGN
194390020725R13637     END-IF.
194400020403
194410020403           MOVE WS-ACC-INT-CURRENT-EX TO IS-INT-CURRENT.
194420061003R13637     IF   WS-ACC-INT-CURRENT-EX IS LESS THAN ZEROES
194430061003  ¦             MOVE "-" TO IS-NC-SIGN
194440020403R35540     ELSE
194450020111R35540          MOVE " " TO IS-NC-SIGN
194460001228R13637     END-IF.
194470020403
194480020403           MOVE WS-ACC-REG-CTB-CUR-EX TO  IS-REG-CTB-CUR.
194490061003           IF  WS-ACC-REG-CTB-CUR-EX  IS LESS THAN 0
194500061003               MOVE "-"                TO  IS-REG-CTB-CUR-SIGN
194510020403R35540     ELSE
194520020111R35540         MOVE " "                TO  IS-REG-CTB-CUR-SIGN
194530001228           END-IF.
194540020403
194550020403RF8673     MOVE WS-ACC-TRI-CURRENT-EX TO IS-TRI-CURRENT.
194560061003R12173     IF   WS-ACC-TRI-CURRENT-EX IS LESS THAN ZEROES
194570061003  ¦             MOVE "-" TO IS-TRI-CURRENT-SIGN
194580020403R35540     ELSE
194590020111R35540          MOVE " " TO IS-TRI-CURRENT-SIGN
194600001228R12173     END-IF.
194610020403
194620020403           MOVE WS-ACC-TRO-CURRENT-EX TO IS-TRO-CURRENT.
194630061003R12173     IF   WS-ACC-TRO-CURRENT-EX IS LESS THAN ZEROES
194640061003  ¦             MOVE "-" TO IS-TRO-CURRENT-SIGN
194650020403R35540     ELSE
194660020111R35540          MOVE " " TO IS-TRO-CURRENT-SIGN
194670990619R12173     END-IF.
194680011017
194690011017           MOVE WS-ACC-SWI-CURRENT-EX TO IS-SWI-CURRENT.
194700061003R12173     IF   WS-ACC-SWI-CURRENT-EX IS LESS THAN ZEROS
194710061003  ¦             MOVE "-" TO IS-SWI-CURRENT-SIGN
194720011017R35540     ELSE
194730011015R35540          MOVE " " TO IS-SWI-CURRENT-SIGN
194740990619R12173     END-IF.
194750020725
194760020725           MOVE WS-ACC-SWO-CURRENT-EX TO IS-SWO-CURRENT.
194770061003R12173     IF   WS-ACC-SWO-CURRENT-EX IS LESS THAN ZEROS
194780061003  ¦             MOVE "-" TO IS-SWO-CURRENT-SIGN
194790020725R35540     ELSE
194800020725R35540          MOVE " " TO IS-SWO-CURRENT-SIGN
194810990619R12173     END-IF.
194820020725
194830020801
194840061003R11628     IF WS-ACC-PUR-CURRENT-EX    IS  LESS THAN  ZEROES
194850061003              MOVE "-"                 TO  IS-PC-SIGN
194860020725R35540     ELSE
194870020725R35540        MOVE " "                 TO  IS-PC-SIGN
194880990619R11628     END-IF.
194890020725
194900020801           MOVE WS-ACC-PUR-YTD-EX         TO  IS-PUR-YTD.
194910061003R11628     IF   WS-ACC-PUR-YTD-EX   IS  LESS THAN  ZEROES
194920061003              MOVE "-"                 TO  IS-PUR-YTD-SIGN
194930020725R35540     ELSE
194940020725R35540        MOVE " "                 TO  IS-PUR-YTD-SIGN
194950990619R11628     END-IF.
194960020725
194970020801           MOVE WS-ACC-RED-YTD-EX         TO  IS-RED-YTD.
194980061003R13637     IF   WS-ACC-RED-YTD-EX   IS  LESS THAN  ZEROES
194990061003  ¦           MOVE "-"                 TO  IS-RED-YTD-SIGN
195000020725R35540     ELSE
195010020725R35540        MOVE " "                 TO  IS-RED-YTD-SIGN
195020990619R13637     END-IF.
195030020725
195040020801           MOVE WS-ACC-CPG-YTD-EX         TO  IS-CPG-YTD.
195050061003R13637     IF   WS-ACC-CPG-YTD-EX   IS  LESS THAN  ZEROES
195060061003  ¦           MOVE "-"                 TO  IS-CPG-YTD-SIGN
195070020725R35540     ELSE
195080011015R35540        MOVE " "                 TO  IS-CPG-YTD-SIGN
195090030422R13637     END-IF.
195100030422
195110030422           MOVE WS-ACC-INC-YTD-EX         TO  IS-INC-YTD.
195120030422R13637     IF   WS-ACC-INC-YTD-EX   IS  LESS THAN  ZEROES
195130030422  ¦           MOVE "-"                 TO  IS-INC-YTD-SIGN
195140061003R35540     ELSE
195150061003R35540        MOVE " "                 TO  IS-INC-YTD-SIGN
195160030422R13637     END-IF.
195170030422
195180030422           MOVE WS-ACC-INT-YTD-EX         TO  IS-INT-YTD.
195190030422R13637     IF   WS-ACC-INT-YTD-EX   IS  LESS THAN  ZEROES
195200040115  ¦           MOVE "-"                 TO  IS-INT-YTD-SIGN
195210040115R35540     ELSE
195220030422R35540        MOVE " "                 TO  IS-INT-YTD-SIGN
195230030422R13637     END-IF.
195240030422
195250030422R16990     ADD  WS-ACC-PUR-CURRENT-EX
195260061003  ¦             WS-ACC-TRI-CURRENT-EX  TO WS-ACC-NET-ADD-CURRENT.
195270061003  ¦        MOVE WS-ACC-NET-ADD-CURRENT TO IS-NET-ADD-CURRENT.
195280030422  ¦        IF WS-ACC-NET-ADD-CURRENT   IS LESS THAN ZEROES
195290030422  ¦           MOVE "-"                 TO IS-NET-ADD-CURRENT-SIGN
195300030422R35540     ELSE
195310030422R35540        MOVE " "                 TO IS-NET-ADD-CURRENT-SIGN
195320030422  ¦        END-IF.
195330030422  ¦
195340030422  ¦        ADD  WS-ACC-RED-CURRENT-EX
195350030422  ¦             WS-ACC-TRO-CURRENT-EX  TO WS-ACC-NET-WITHDRAW-CURRENT.
195360030422R20324     COMPUTE WS-ACC-NET-WITHDRAW-CURRENT =
195370061003R20324             WS-ACC-NET-WITHDRAW-CURRENT - IS-FEES.
195380061003  ¦        MOVE WS-ACC-NET-WITHDRAW-CURRENT
195390030422  ¦                                    TO IS-NET-WITHDRAW-CURRENT.
195400030422  ¦        IF WS-ACC-NET-WITHDRAW-CURRENT IS LESS THAN ZEROES
195410030422  ¦           MOVE "-"                 TO IS-NET-WITHDRAW-CURRENT-SIGN
195420030422R35540     ELSE
195430030422R35540        MOVE " "                 TO IS-NET-WITHDRAW-CURRENT-SIGN
195440030422  ¦        END-IF.
195450030422  ¦
195460030422  ¦        ADD  WS-ACC-CPG-CURRENT-EX
195470030422  ¦             WS-ACC-INC-CURRENT-EX
195480030422  ¦             WS-ACC-INT-CURRENT-EX  TO WS-ACC-DISTRIBUTION-CURRENT.
195490030422  ¦        MOVE WS-ACC-DISTRIBUTION-CURRENT
195500061003  ¦                                    TO IS-DISTRIBUTION-CURRENT.
195510061003  ¦        IF WS-ACC-DISTRIBUTION-CURRENT IS LESS THAN ZEROES
195520030422  ¦           MOVE "-"                 TO IS-DISTRIBUTION-CURRENT-SIGN
195530030422R35540     ELSE
195540140609R35540        MOVE " "                 TO IS-DISTRIBUTION-CURRENT-SIGN
195550140609  ¦        END-IF.
195560140609  ¦
195570140609  ¦        COMPUTE WS-ACC-UNREAL-GAIN-LOSS-CURR  = WS-TOTAL-VALUE
195580140609  ¦                    - WS-ACC-NET-ADD-CURRENT
195590140609  ¦                    + WS-ACC-NET-WITHDRAW-CURRENT
195600140609  ¦                    - WS-ACC-DISTRIBUTION-CURRENT
195610140609  ¦                    - WS-ACC-OPNMKTVAL.
195620140609  ¦        MOVE WS-ACC-UNREAL-GAIN-LOSS-CURR
195630140609  ¦                               TO IS-UNREAL-GAIN-LOSS-CURR.
195640140609  ¦        IF WS-ACC-UNREAL-GAIN-LOSS-CURR IS LESS THAN ZEROES
195650030422  ¦           MOVE "-"            TO IS-UNREAL-GAIN-LOSS-CURR-SIGN
195660030422R35540     ELSE
195670030422R35540        MOVE " "            TO IS-UNREAL-GAIN-LOSS-CURR-SIGN
195680030422  ¦        END-IF.
195690061003  ¦
195700061003      *RFS137559 Starts
195710030422  ¦   *    COMPUTE WS-ACC-NET-INV-CAPTAL-INCEPT = WS-ACC-PUR-INCEPT-EX
195720030422  ¦   *                + WS-ACC-TRI-INCEPT-EX
195730030422R20688*                - WS-ACC-RED-INCEPT-EX
195740030422  v   *                - WS-ACC-TRO-INCEPT-EX
195750030422R20324*                + WS-PROFESSIONAL-FEE-INCEPT.
195760030422           COMPUTE WS-ACC-NET-INV-CAPTAL-INCEPT = (WS-ACC-PUR-INCEPT-EX
195770030422                       + WS-ACC-TRI-INCEPT-EX)
195780031015                       - (WS-ACC-RED-INCEPT-EX
195790031016                       + WS-ACC-TRO-INCEPT-EX).
195800031016      *RFS137559 Ends
195810031016  ¦        MOVE WS-ACC-NET-INV-CAPTAL-INCEPT
195820031016  ¦                               TO IS-NET-INV-CAPTAL-INCEPT.
195830061003  ¦        IF WS-ACC-NET-INV-CAPTAL-INCEPT IS LESS THAN ZEROES
195840061003  ¦           MOVE "-"            TO IS-NET-INV-CAPTAL-INCEPT-SIGN
195850031016R35540     ELSE
195860031016R35540        MOVE " "            TO IS-NET-INV-CAPTAL-INCEPT-SIGN
195870031016  ¦        END-IF.
195880040115  ¦
195890040115  ¦        ADD WS-ACC-UNREAL-GAIN-LOSS-CURR
195900040115  ¦                               TO  WS-IVR-UNREAL-GAIN-LOSS-CURR.
195910040115  v        ADD WS-ACC-NET-INV-CAPTAL-INCEPT
195920040115R16990                            TO  WS-IVR-NET-INV-CAPTAL-INCEPT.
195930040115
195940040115R18682***** Move the IPS required fields to Section 10
195950031016  ¦        IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
195960031016  ¦           MOVE WS-ACC-REALIZED-GAIN   TO IS-REALIZED-GAIN-LOSS
195970031016  ¦           IF WS-ACC-REALIZED-GAIN     IS LESS THAN ZEROES
195980031016  ¦              MOVE "-"                 TO IS-REALIZED-GAIN-LOSS-SIGN
195990061003R35540        ELSE
196000061003R35540           MOVE " "                 TO IS-REALIZED-GAIN-LOSS-SIGN
196010031016  ¦           END-IF
196020031016  ¦
196030031016  ¦           COMPUTE WS-ACC-UNREALIZED-GAIN
196040031016R20324                    = WS-TOTAL-VALUE
196050031016  ¦                       - (WS-ACC-OPNMKTVAL
196060061003  ¦                       + WS-ACC-NET-ADD-CURRENT
196070061003  ¦                       - WS-ACC-NET-WITHDRAW-CURRENT
196080031016  ¦                       - IS-FEES
196090031016  v                       + WS-ACC-ACCRUED-INC
196100970710R20324                    + WS-ACC-REALIZED-GAIN)
196110990818  ¦
196120970710  ¦           MOVE WS-ACC-UNREALIZED-GAIN  TO IS-UNREALIZED-GAIN-LOSS
196130970710  ¦           IF WS-ACC-UNREALIZED-GAIN    IS LESS THAN ZEROES
196140970710  ¦              MOVE "-"             TO IS-UNREALIZED-GAIN-LOSS-SIGN
196150970710R35540        ELSE
196160970710R35540           MOVE " "             TO IS-UNREALIZED-GAIN-LOSS-SIGN
196170970710  ¦           END-IF
196180970710  ¦
196190970710  ¦           MOVE WS-ACC-ACCRUED-INC     TO IS-ACCRUED-INCOME
196200970710  ¦           IF WS-ACC-ACCRUED-INC       IS LESS THAN ZEROES
196210970710  ¦              MOVE "-"                 TO IS-ACCRUED-INCOME-SIGN
196220980813R35540        ELSE
196230980813R35540           MOVE " "                 TO IS-ACCRUED-INCOME-SIGN
196240980813  v           END-IF
196250980813R18682     END-IF.
196260990818           IF  IS-VALUE   IS NOT EQUAL TO  ZEROES
196270980813           AND WS-LDA-PERC-DECIMAL IS NOT EQUAL TO "S"
196280980813               SUBTRACT WS-BOOK-FGN-ACCT
196290980813                                     FROM  WS-BOOK-TOTAL-ACCT
196300980813                                   GIVING  IS-BOOK-VALUE-CDN
196310980824               MOVE WS-BOOK-FGN-ACCT   TO  IS-BOOK-VALUE-FGN
196320980813               COMPUTE IS-FOREIGN-CONTENT ROUNDED
196330980813                                        =  (WS-BOOK-FGN-ACCT
196340980813                                        *   100)
196350980813                                        /  WS-BOOK-TOTAL-ACCT
196360980813               SUBTRACT IS-FOREIGN-CONTENT
196370980813                                     FROM  100
196380980813                                   GIVING  IS-CDN-CONTENT
196390980813               MOVE 100.00            TO IS-INVESTOR-PERC.
196400980813
196410980813           IF  IS-VALUE   IS NOT EQUAL TO  ZEROES
196420000000           AND WS-LDA-PERC-DECIMAL IS EQUAL TO "S"
196430000000               SUBTRACT WS-BOOK-FGN-ACCT
196440000000                                     FROM  WS-BOOK-TOTAL-ACCT
196450000000                                   GIVING  IS-BOOK-VALUE-CDN
196460010330               MOVE WS-BOOK-FGN-ACCT   TO  IS-BOOK-VALUE-FGN
196470010330               MOVE ZEROES TO WS-IS-FOREIGN-CONTENT
196480000000               COMPUTE WS-IS-FOREIGN-CONTENT ROUNDED
196490000000                                        =  (WS-BOOK-FGN-ACCT
196500000000                                        *   100)
196510000000                                        /  WS-BOOK-TOTAL-ACCT
196520061003               MOVE WS-IS-FOREIGN-CONTENT TO IS-FOREIGN-CONTENT
196530000000               SUBTRACT IS-FOREIGN-CONTENT
196540000000                                     FROM  100
196550000000                                   GIVING  IS-CDN-CONTENT
196560000000               MOVE 100.00            TO IS-INVESTOR-PERC.
196570000000
196580140925           COMPUTE WS-MKT-CHANGE-CURRENT ROUNDED =
196590200717              WS-TOTAL-VALUE - WS-ACCT-MARKET-START -
196600200717      *RFS1100943 Starts
196610200717      *       WS-ACC-PUR-CURRENT + WS-ACC-RED-CURRENT.
196620200717              WS-ACC-PUR-CURRENT-EX + WS-ACC-RED-CURRENT-EX.
196630000000      *RFS1100943 Ends
196640000000           IF WS-MKT-CHANGE-CURRENT IS LESS THAN 0
196650000000RF9729         MULTIPLY WS-MKT-CHANGE-CURRENT BY -1 GIVING
196660000000                    IS-MKT-VALUE-CHG-CUR
196670000000               MOVE "-" TO IS-MKT-VALUE-CHG-CUR-SIGN
196680000000           ELSE
196690000000               MULTIPLY WS-MKT-CHANGE-CURRENT BY 1 GIVING
196700000000                    IS-MKT-VALUE-CHG-CUR
196710061003R35540         MOVE " " TO IS-MKT-VALUE-CHG-CUR-SIGN
196720000000           END-IF.
196730000000
196740200717           COMPUTE WS-MKT-CHANGE-INCEPT ROUNDED =
196750200717              WS-TOTAL-VALUE -
196760200717      *RFS1100943 Starts
196770200717      *       WS-ACC-PUR-INCEPT + WS-ACC-RED-INCEPT.
196780200717              WS-ACC-PUR-INCEPT-EX + WS-ACC-RED-INCEPT-EX.
196790970423      *RFS1100943 Ends
196800971024
196810971024139185     MOVE WS-TOTAL-VALUE TO li_TotValue.
196820970423
196830970423           IF WS-MKT-CHANGE-INCEPT IS LESS THAN 0
196840031027               MULTIPLY WS-MKT-CHANGE-INCEPT BY -1 GIVING
196850031027                    IS-MKT-VALUE-CHG-INC
196860031027               MOVE "-" TO IS-MKT-VALUE-CHG-INC-SIGN
196870031027           ELSE
196880031027               MULTIPLY WS-MKT-CHANGE-INCEPT BY 1 GIVING
196890031027                    IS-MKT-VALUE-CHG-INC
196900031027R35540         MOVE " " TO IS-MKT-VALUE-CHG-INC-SIGN
196910031216           END-IF.
196920031027
196930031027      *****
196940031027      *****    Retrieve the 12 month rate of return, if requested.
196950031027      *****
196960031027           IF  WS-LDA-ROR-FLAG
196970061003                          IS NOT EQUAL TO  "Y"
196980061003               GO TO LS2-0010.
196990031027
197000031027R17948     INITIALIZE                  CPWRORCALC-LINKAGE.
197010980602   ¦       MOVE IS-ACCOUNT2            TO  RR-ACCOUNT-NO.
197020980602   ¦       MOVE ZEROS                  TO  RR-INITIAL-DATE.
197030980602   ¦       MOVE ZEROS                  TO  RR-CALCULATE-DATE.
197040980602   ¦       MOVE WS-LDA-ENDDTE          TO  RR-LAST-MONTH-END.
197050980402   ¦       MOVE SPACES                 TO  RR-INVESTMENT-CODE.
197060020627   ¦       MOVE "1Y"                   TO  RR-PERIOD-CODE-1.
197070980529R18936     MOVE SPACES                 TO  RR-CONS-ACCT-ID.
197080980526   ¦
197090980529   ¦       PERFORM CALL-ROR-ACCOUNT-FUND-ROUTINE   THRU CRAFR-EXIT.
197100980526   ¦       MOVE RR-PERIOD-ROR-1        TO  IS-12MO-ROR.
197110980420   ¦       IF RR-PERIOD-ROR-1          IS  LESS THAN  ZEROS
197120980526   v          MOVE "-"                 TO  IS-12MO-ROR-SIGN
197130980526R35540     ELSE
197140980526R35540        MOVE " "                 TO  IS-12MO-ROR-SIGN
197150980526R17948     END-IF.
197160980526
197170980402           MOVE ACCOUNT-NO OF ACCOUNT-INVESTMENT-REC
197180970423                                       TO WS-PRV-ACCOUNT.
197190970423           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT-REC
197200020730                                       TO WS-PRV-INVESTMENT.
197210020730
197220061003R14178     INITIALIZE MFAACCIVP OF ACCOUNT-INVESTMENT-REC.
197230061003           MOVE WS-PRV-ACCOUNT         TO  ACCOUNT-NO
197240020730                                           OF ACCOUNT-INVESTMENT-REC.
197250020730           MOVE WS-PRV-INVESTMENT      TO  INVESTMENT-CODE
197260970423                                           OF ACCOUNT-INVESTMENT-REC.
197270020730980402     READ ACCOUNT-INVESTMENT
197280020730980402         INVALID KEY
197290061003980402             DISPLAY "ROR RESET ERROR: ACCT/INV: "
197300061003                           PREV-ACCOUNT
197310020730                           "/"
197320020730                           PREV-INVESTMENT.
197330970423
197340020730       LS2-0010.
197350020730           MOVE WS-ACC-WHTAX-YTD       TO  IS-WHTAX-YTD.
197360061003R13637     IF   WS-ACC-WHTAX-YTD       IS LESS THAN 0
197370061003  ¦             MOVE "-" TO IS-WHTAX-YTD-SIGN
197380020730R35540     ELSE
197390020730R35540          MOVE " " TO IS-WHTAX-YTD-SIGN
197400970423R13637     END-IF.
197410020730
197420020730           MOVE WS-ACC-WHTAX-CUR       TO  IS-WHTAX-CURRENT.
197430061003R13637     IF   WS-ACC-WHTAX-CUR       IS LESS THAN 0
197440061003  ¦             MOVE "-" TO IS-WHTAX-CURRENT-SIGN
197450020730R35540     ELSE
197460020730R35540          MOVE " " TO IS-WHTAX-CURRENT-SIGN
197470970423R13637     END-IF.
197480020730
197490020730           MOVE WS-ACC-NRTAX-YTD       TO  IS-NRTAX-YTD.
197500061003R13637     IF   WS-ACC-NRTAX-YTD       IS LESS THAN 0
197510061003  ¦             MOVE "-" TO IS-NRTAX-YTD-SIGN
197520020730R35540     ELSE
197530160613R35540          MOVE " " TO IS-NRTAX-YTD-SIGN
197540160613R13637     END-IF.
197550160613
197560160929           MOVE WS-ACC-NRTAX-CUR       TO  IS-NRTAX-CUR.
197570160929R13637     IF   WS-ACC-NRTAX-CUR       IS LESS THAN 0
197580160929  ¦             MOVE "-" TO IS-NRTAX-CUR-SIGN
197590160613R35540     ELSE
197600160613R35540          MOVE " " TO IS-NRTAX-CUR-SIGN
197610160613R13637     END-IF.
197620160613
197630160613           MOVE WS-ACC-NRTAX-INC       TO  IS-NRTAX-INCPT.
197640160615R13637     IF   WS-ACC-NRTAX-INC       IS LESS THAN 0
197650160929  ¦             MOVE "-" TO IS-NRTAX-INCPT-SIGN
197660160929R35540     ELSE
197670160929R35540          MOVE " " TO IS-NRTAX-INCPT-SIGN
197680160929R13637     END-IF.
197690160929      * RFS 156872 START
197700160929           INITIALIZE WS_COUNT,
197710160929                      WS_ACC_NO.
197720160929163727     INITIALIZE WS_COUNT_TRN.
197730160613163727     MOVE WS-LDA-STRDTE TO LN_LDA_STRDTE
197740160613163727     MOVE WS-LDA-ENDDTE TO LN_LDA_ENDDTE
197750160929           MOVE ACCOUNT-NO OF ACCOUNT-T-REC TO WS_ACC_NO
197760160929           EXEC SQL
197770160929           SELECT COUNT(*)
197780160929           INTO :WS_COUNT
197790160929           FROM MFATRNP
197800160929           WHERE ACCOUNT_NO = :WS_ACC_NO AND
197810160929      * RFS 163183 START
197820160929      *    TRANS_TYPE_CODE NOT IN("BUY","SWI","TRI","BAJ")
197830160929           TRANS_TYPE_CODE IN("BUY","SWI","TRI","BAJ","CPG",
197840160929           "INC","INT","BFW") AND
197850160929163727     TRANS_STATUS_CODE IN ("HST","HSC")
197860160929163727     AND PROCESS_DATE < :LN_LDA_STRDTE
197870160929163727     AND REVERSE <> "Y"
197880971024      * RFS 163183 ENDS
197890160929           END-EXEC.
197900160929      * RFS 156872 ENDS
197910160929      * RFS163727 START
197920160929           EXEC SQL
197930160929           SELECT COUNT(*)
197940160929           INTO   :WS_COUNT_TRN
197950160929           FROM   MFATRNP
197960160929           WHERE ACCOUNT_NO = :WS_ACC_NO AND
197970160929           PROCESS_DATE BETWEEN
197980160929           :ln_LDA_STRDTE AND :LN_LDA_ENDDTE AND
197990971215           TRANS_TYPE_CODE IN("BUY","SWI","TRI","BAJ",
198000971215           "BFW","INC","CPG","INT") AND
198010971215           TRANS_STATUS_CODE IN ("HST","HSC") AND
198020980627           REVERSE <> "Y"
198030980627           END-EXEC.
198040980627           MOVE WS-ACC-OPNMKTVAL       TO  IS-OPENING-MARKET-VALUE.
198050980627      *    IF  WS-ACC-OPNMKTVAL  EQUAL TO  ZEROES
198060980627      *    AND (WS-ACC-PUR-CURRENT
198070980521      *                   IS GREATER THAN  ZEROES
198080980521RF8711*    OR   WS-ACC-TRI-CURRENT
198090990331      *                   IS GREATER THAN  ZEROES )
198100990525156872*    AND WS_COUNT = 0
198110990512           IF WS_COUNT = 0 AND WS_COUNT_TRN >= 1
198120990525      * RFS163727 END
198130990512
198140990512
198150990512               MOVE "Y"                TO  IS-NEW-ACCOUNT-INDICATOR
198160990512             ELSE
198170990512               MOVE "N"                TO  IS-NEW-ACCOUNT-INDICATOR.
198180990525           IF  WS-ORIGIN-COST-A
198190990512                          IS GREATER THAN  ZEROES
198200990512980514         MOVE WS-ORIGIN-COST-A   TO  IS-ORIGINAL-COST
198210990518             ELSE
198220990518               MOVE ZEROES             TO  IS-ORIGINAL-COST.
198230990517           ADD IS-FIRST60
198240990517               IS-REMAINDER        GIVING  IS-TOTAL-CONTRIBUTIONS-YTD.
198250990517
198260061003           INITIALIZE MFAACTSRVP OF ACCOUNT-SERVICE-LEVEL-REC.
198270061003           MOVE PREV-ACCOUNT           TO  ACCOUNT-NO OF
198280061003                                       ACCOUNT-SERVICE-LEVEL-REC.
198290061003           READ ACCOUNT-SERVICE-LEVEL
198300990517                INVALID KEY
198310020321                   MOVE SPACES TO IS-LEVEL-OF-SERVICE
198320980213                   GO TO LS2-0020.
198330971024
198340001027           MOVE SERVICE-LEVEL-CODE OF ACCOUNT-SERVICE-LEVEL-REC
198350001027                                      TO  IS-LEVEL-OF-SERVICE.
198360001027
198370001027       LS2-0020.
198380001027
198390001027           MOVE WS-ACC-MKT-VALUE-LAST-YE
198400001027                                 TO IS-MARKET-VALUE-LAST-YE.
198410001027           IF WS-ACC-MKT-VALUE-LAST-YE IS < 0
198420001031              MOVE "-" TO IS-MARKET-VALUE-LAST-YE-SIGN
198430001027R35540     ELSE
198440001027R35540        MOVE " " TO IS-MARKET-VALUE-LAST-YE-SIGN
198450001027R35540     END-IF.
198460001027
198470001027           MOVE WS-PREV-START-DATE        TO  IS-START-DATE.
198480001027           MOVE PREV-END-DATE          TO  IS-END-DATE.
198490001027
198500001027RF4638***** Added two new fields: IS-DISCRETIONARY-FEE-FUND
198510001027      *****                       IS-DISCRETIONARY-FEE-RATE
198520001027
198530001027001027     INITIALIZE MFAACCFP.
198540001027           MOVE PREV-ACCOUNT         TO  ACCOUNT-NO
198550001027                                           OF ACCOUNT-FEE-REC.
198560001027           READ ACCOUNT-FEE
198570001027               INVALID KEY
198580001027                   INITIALIZE ACCOUNT-FEE-REC
198590001027           END-READ.
198600001027
198610001027           INITIALIZE MFADCRSCP.
198620001027           MOVE DISCR-FEE-SCHED-CODE OF ACCOUNT-FEE-REC
198630001027                                     TO DISCR-FEE-SCHED-CODE
198640001027                                     OF DISCRETIONARY-FEE-SCHED-REC.
198650001027
198660001027           START DISCRETIONARY-FEE-SCHED
198670001027               KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
198680001027                 INVALID KEY
198690001027                   MOVE ZEROS  TO DISCR-RATE OF
198700010309                               DISCRETIONARY-FEE-SCHED-REC
198710001027                   GO TO LS2-0020-0010
198720001229           END-START.
198730030704
198740031125           READ DISCRETIONARY-FEE-SCHED  NEXT RECORD
198750051024                 AT END
198760030704                   MOVE ZEROS  TO DISCR-RATE OF
198770010621                               DISCRETIONARY-FEE-SCHED-REC
198780010621           END-READ.
198790010621
198800010621       LS2-0020-0010.
198810010621
198820010621           MOVE INVESTMENT-CODE OF ACCOUNT-FEE-REC
198830010621                                TO     IS-DISCRETIONARY-FEE-FUND.
198840060707           MOVE DISCR-RATE      OF DISCRETIONARY-FEE-SCHED-REC
198850031003                                TO     IS-DISCRETIONARY-FEE-RATE.
198860031003
198870031003      ************************************************************
198880060707
198890060707R17783     MOVE PREV-USER-ID   TO IS-USERID.
198900060707
198910060707R30514     MOVE WS-FIRST-TRADE-TRANSACTION  TO IS-FIRST-TRADE-DATE.
198920060707
198930060707RF9850     IF WS-INVESTMENT-STRUCTURE-CODE IS NOT EQUAL TO SPACES
198940060707              MOVE WS-INVESTMENT-STRUCTURE-CODE
198950060707                                TO IS-INVESTMENT-STRUCTURE-CODE
198960060707           ELSE
198970060707              MOVE WS-INVESTMENT-STRUCTURE-CODE-F
198980060707                                TO IS-INVESTMENT-STRUCTURE-CODE
198990060707           END-IF.
199000060707
199010060707R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
199020060707   ¦          MOVE WS-IPS-GROUP-ID     TO IS-IPS-GROUP-ID
199030061003R17527     END-IF.
199040061003
199050060707R33331*    RFS 33331 Start
199060060707      *    Calculate IS-GAIN-LOSS-PD-OUT based on existing
199070060707      *    accumulted fields
199080060707           COMPUTE ln_AccGainLossPdOut  =
199090080806                  (Ws-Total-Value -
199100080806                   Ws-Acc-OpnMktVaL -
199110080806                   Ws-Acc-Net-Add-Current +
199120080806                   Ws-Acc-Net-Withdraw-Current +
199130080806                   Ws-Is2-Inc-Current-Cash +
199140080806                   Ws-Is2-Cpg-Current-Cash)
199150080806
199160080806           MOVE ln_AccGainLossPdOut TO IS-GAIN-LOSS-PD-OUT.
199170080806           IF   ln_AccGainLossPdOut IS LESS THAN ZEROES
199180080806                MOVE lc_Negative TO IS-GAIN-LOSS-PD-OUT-SIGN
199190080806R35540     ELSE
199200080806R35540          MOVE " "         TO IS-GAIN-LOSS-PD-OUT-SIGN
199210080806           END-IF.
199220080806
199230080806R33331*    RFS 33331 Ends
199240080806
199250080806      *RFS50993 - Start
199260080806           INITIALIZE IS-MULTIPLE-CONTRACT-FLAG
199270080811                      IS-JOINT-LIFE-FLAG.
199280080811           EXEC SQL
199290080811             SELECT COALESCE(MAX(Investment_Series), " ")
199300080811             INTO :lc_ContInvSeries
199310080806             FROM MFAACCONP
199320080806             WHERE Investment_Series <> " "  AND
199330080806                   Account_No =:WS-ACCOUNT-NO
199340080806           END-EXEC.
199350080806
199360080806           IF lc_ContInvSeries NOT = " "
199370080806              EXEC SQL
199380080806                SELECT COUNT(*)
199390080806                INTO :li_MConFlgCount
199400080806                FROM MFAACCONP acconp
199410080806                LEFT OUTER JOIN MFASERRLP serrlp ON
199420080806                    acconp.Investment_Series = serrlp.Investment_Series
199430080806      *RFS50993.1 - Start
199440080806      *         WHERE acconp.Contract_Status = "O"          AND
199450080806                WHERE
199460080806      *RFS50993.1 - End
199470080806                      SUBSTR(serrlp.Series_Rules,1,1) = "Y" AND
199480080806                      acconp.Account_No =:WS-ACCOUNT-NO
199490080806              END-EXEC
199500080806
199510080806              IF li_MConFlgCount > 0
199520080806                   MOVE lncc_Yes TO IS-MULTIPLE-CONTRACT-FLAG
199530080806              ELSE MOVE lncc_No  TO IS-MULTIPLE-CONTRACT-FLAG
199540090501              END-IF
199550090501
199560090501              EXEC SQL
199570090501                SELECT COUNT(*)
199580090501                INTO :li_DfltFlgCount
199590090501                FROM MFAACCNNP accnnp
199600090501                WHERE accnnp.Default_Flag = "J" AND
199610090501                      accnnp.Account_No =:WS-ACCOUNT-NO
199620090501              END-EXEC
199630090501
199640090501              IF li_DfltFlgCount > 0
199650090501                   MOVE lncc_Yes TO IS-JOINT-LIFE-FLAG
199660090501              ELSE MOVE lncc_No  TO IS-JOINT-LIFE-FLAG
199670090501              END-IF
199680090501           END-IF.
199690090501      *RFS50993 - End
199700090501R61356***** Populate YTD and LTD for TFSA contribution and withdrawal
199710090501  |   ***** amounts
199720090501  |
199730090501  |        IF WS-AT-RULE (AT1)      IS EQUAL TO  "9"
199740090501  |           MOVE WS-ACC-LTD-CONTRIBUTION  TO IS-LTD-CONTRIBUTION
199750090501  |           IF WS-ACC-LTD-CONTRIBUTION  IS LESS THAN ZEROS
199760090501  |              MOVE "-"                TO IS-LTD-CONTRIBUTION-SIGN
199770090501  |           END-IF
199780090501  |
199790090501  |           MOVE WS-ACC-YTD-CONTRIBUTION  TO IS-YTD-CONTRIBUTION
199800090501  |           IF WS-ACC-YTD-CONTRIBUTION  IS LESS THAN ZEROS
199810090501  |              MOVE "-"                TO IS-YTD-CONTRIBUTION-SIGN
199820090501  |           END-IF
199830090501  |
199840090501  |           Add WS-ACC-LTD-WITHDRAWALS
199850090501  |               WS-IS2-INC-INCEPT-CASH
199860090501  |               WS-IS2-CPG-INCEPT-CASH
199870170516  |               WS-IS2-INT-INCEPT-CASH  TO WS-ACC-LTD-WITHDRAWALS-TOT
199880031003  |
199890170817  |           MOVE WS-ACC-LTD-WITHDRAWALS-TOT TO IS-LTD-WITHDRAWAL
199900170817  |           IF WS-ACC-LTD-WITHDRAWALS-TOT   IS LESS THAN ZEROS
199910170817  |              MOVE "-"                     TO IS-LTD-WITHDRAWAL-SIGN
199920170817  |           END-IF
199930170817  |
199940170512  |           Add WS-ACC-YTD-WITHDRAWALS
199950170817  |               WS-IS2-INC-YTD-CASH
199960170817  |               WS-IS2-CPG-YTD-CASH
199970170817  |               WS-IS2-INT-YTD-CASH  TO WS-ACC-YTD-WITHDRAWALS-TOT
199980170817  |
199990170817  |           MOVE WS-ACC-YTD-WITHDRAWALS-TOT TO IS-YTD-WITHDRAWAL
200000170817  |           IF WS-ACC-YTD-WITHDRAWALS-TOT   IS LESS THAN ZEROS
200010170817  |              MOVE "-"                     TO IS-YTD-WITHDRAWAL-SIGN
200020170817  v           END-IF
200030170817R61356     END-IF.
200040170817
200050170817      *RFS145044 - Starts
200060060621           INITIALIZE lc_DeliveryOption,
200070030825                      li_AccNo.
200080030825           MOVE IS-ACCOUNT2 OF INVESTOR-SUMMARY-SECTION
200090000000                TO li_AccNo.
200100970430
200110010308           EXEC SQL
200120010308           SELECT ACDOCP.EDOC_DELIVERY_OPTION
200130010308           INTO   :lc_DeliveryOption
200140010308           FROM   MFAACDOCP ACDOCP
200150010308           WHERE  ACDOCP.ACCOUNT_NO = :li_AccNo
200160190110           END-EXEC.
200170190110
200180190110      *RFS 180850 START
200190190110           IF lc_DeliveryOption = " "
200200190126              IF WS-LDA-STMT-CNFM-FLAG = "C"
200210190110                MOVE "CONFMCLT" TO Lc_TypeMatch
200220190110              ELSE
200230190110              IF WS-LDA-STMT-CNFM-FLAG = "S"
200240190110              MOVE "CLTSTCLT" TO Lc_TypeMatch
200250190110              END-IF
200260190110              END-IF
200270190110
200280190110           COMPUTE Li_InvestorNo = IS-INVESTOR-NO
200290190110
200300190110           EXEC SQL
200310190110           SELECT EDOC_DELIVERY_OPTION
200320190110           INTO   :lc_DeliveryOption
200330190110           FROM   MFAIVRDOP
200340190110           WHERE  Investor_no = :Li_InvestorNo
200350190110           AND    Form_code = :Lc_typeMatch
200360190126           AND    EDOC_DELIVERY_OPTION = :Lncc_E
200370190126           END-EXEC
200380190110           END-IF.
200390190110      * RFS 180850 END
200400010308
200410190111           MOVE lc_DeliveryOption TO IS-DELIVERY-OPTION
200420010308                 OF INVESTOR-SUMMARY-SECTION.
200430020730      *RFS145044 - Ends
200440020730
200450061003R18147     MOVE INVESTOR-SUMMARY-SECTION TO STATEMENT-REC(ISR).
200460061003R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
200470020730
200480020730           MOVE "Y"          TO WS-WRITE-INVESTOR-LEVEL.
200490010308
200500020730RF8633*****
200510020730      *****    Write Investor Summary-2( Section12).
200520061003      *****
200530061003
200540020730       LS2-0020-0020.
200550020730
200560010308           IF WS-LDA-INVESTOR-12        IS EQUAL TO  "Y"
200570020730
200580020730              MOVE WS-IS2-INT-INCEPT-CASH   TO  IS2-INT-INCEPT-CASH
200590061003R13637     IF   WS-IS2-INT-INCEPT-CASH   IS LESS THAN 0
200600061003  ¦             MOVE "-" TO IS2-INT-INCEPT-CASH-SIGN
200610020730R35540     ELSE
200620020730R35540          MOVE " " TO IS2-INT-INCEPT-CASH-SIGN
200630010308R13637     END-IF
200640020730
200650020730              MOVE WS-IS2-INT-YTD-CASH      TO  IS2-INT-YTD-CASH
200660061003R13637     IF   WS-IS2-INT-YTD-CASH   IS LESS THAN 0
200670061003  ¦             MOVE "-" TO IS2-INT-YTD-CASH-SIGN
200680020730R35540     ELSE
200690020730R35540          MOVE " " TO IS2-INT-YTD-CASH-SIGN
200700010308R13637     END-IF
200710020730
200720020730              MOVE WS-IS2-INT-CURRENT-CASH  TO  IS2-INT-CURRENT-CASH
200730061003R13637     IF      WS-IS2-INT-CURRENT-CASH IS LESS THAN 0
200740061003  ¦             MOVE "-" TO IS2-INT-CURRENT-CASH-SIGN
200750020730R35540     ELSE
200760020730R35540          MOVE " " TO IS2-INT-CURRENT-CASH-SIGN
200770010308R13637     END-IF
200780020730
200790020730              MOVE WS-IS2-INT-INCEPT-REINV  TO  IS2-INT-INCEPT-REINV
200800061003R13637     IF      WS-IS2-INT-INCEPT-REINV IS LESS THAN 0
200810061003  ¦             MOVE "-" TO IS2-INT-INCEPT-REINV-SIGN
200820020730R35540     ELSE
200830020730R35540          MOVE " " TO IS2-INT-INCEPT-REINV-SIGN
200840010308R13637     END-IF
200850020730
200860020730              MOVE WS-IS2-INT-YTD-REINV     TO  IS2-INT-YTD-REINV
200870061003R13637     IF      WS-IS2-INT-YTD-REINV IS LESS THAN 0
200880061003  ¦             MOVE "-" TO IS2-INT-YTD-REINV-SIGN
200890020730R35540     ELSE
200900020730R35540          MOVE " " TO IS2-INT-YTD-REINV-SIGN
200910010308R13637     END-IF
200920020730
200930020730              MOVE WS-IS2-INT-CURRENT-REINV TO  IS2-INT-CURRENT-REINV
200940061003R13637     IF      WS-IS2-INT-CURRENT-REINV IS LESS THAN 0
200950061003  ¦             MOVE "-" TO IS2-INT-CURRENT-REINV-SIGN
200960020730R35540     ELSE
200970020730R35540          MOVE " " TO IS2-INT-CURRENT-REINV-SIGN
200980010308R13637     END-IF
200990020730
201000020730              MOVE WS-IS2-INC-INCEPT-CASH   TO  IS2-INC-INCEPT-CASH
201010061003R13637     IF      WS-IS2-INC-INCEPT-CASH   IS LESS THAN 0
201020061003  ¦             MOVE "-" TO IS2-INC-INCEPT-CASH-SIGN
201030020730R35540     ELSE
201040020730R35540          MOVE " " TO IS2-INC-INCEPT-CASH-SIGN
201050010308R13637     END-IF
201060020730
201070020730              MOVE WS-IS2-INC-YTD-CASH      TO  IS2-INC-YTD-CASH
201080061003R13637     IF      WS-IS2-INC-YTD-CASH      IS LESS THAN 0
201090061003  ¦             MOVE "-" TO IS2-INC-YTD-CASH-SIGN
201100020730R35540     ELSE
201110020730R35540          MOVE " " TO IS2-INC-YTD-CASH-SIGN
201120010308R13637     END-IF
201130020730
201140020730              MOVE WS-IS2-INC-CURRENT-CASH  TO  IS2-INC-CURRENT-CASH
201150061003R13637     IF      WS-IS2-INC-CURRENT-CASH      IS LESS THAN 0
201160061003  ¦             MOVE "-" TO IS2-INC-CURRENT-CASH-SIGN
201170020730R35540     ELSE
201180020730R35540          MOVE " " TO IS2-INC-CURRENT-CASH-SIGN
201190010308R13637     END-IF
201200020730
201210020730              MOVE WS-IS2-INC-INCEPT-REINV  TO  IS2-INC-INCEPT-REINV
201220061003R13637     IF      WS-IS2-INC-INCEPT-REINV     IS LESS THAN 0
201230061003  ¦             MOVE "-" TO IS2-INC-INCEPT-REINV-SIGN
201240020730R35540     ELSE
201250020730R35540          MOVE " " TO IS2-INC-INCEPT-REINV-SIGN
201260010308R13637     END-IF
201270020730
201280020730              MOVE WS-IS2-INC-YTD-REINV     TO  IS2-INC-YTD-REINV
201290061003R13637     IF      WS-IS2-INC-YTD-REINV     IS LESS THAN 0
201300061003  ¦             MOVE "-" TO IS2-INC-YTD-REINV-SIGN
201310020730R35540     ELSE
201320020730R35540          MOVE " " TO IS2-INC-YTD-REINV-SIGN
201330010308R13637     END-IF
201340020730
201350020730              MOVE WS-IS2-INC-CURRENT-REINV TO  IS2-INC-CURRENT-REINV
201360061003R13637     IF      WS-IS2-INC-CURRENT-REINV     IS LESS THAN 0
201370061003  ¦             MOVE "-" TO IS2-INC-CURRENT-REINV-SIGN
201380020730R35540     ELSE
201390020730R35540          MOVE " " TO IS2-INC-CURRENT-REINV-SIGN
201400010308R13637     END-IF
201410020730
201420020730              MOVE WS-IS2-CPG-INCEPT-CASH   TO  IS2-CPG-INCEPT-CASH
201430061003R13637     IF      WS-IS2-CPG-INCEPT-CASH  IS LESS THAN 0
201440061003  ¦             MOVE "-" TO IS2-CPG-INCEPT-CASH-SIGN
201450020730R35540     ELSE
201460020730R35540          MOVE " " TO IS2-CPG-INCEPT-CASH-SIGN
201470010308R13637     END-IF
201480020730
201490020730              MOVE WS-IS2-CPG-YTD-CASH      TO  IS2-CPG-YTD-CASH
201500061003R13637     IF      WS-IS2-CPG-YTD-CASH  IS LESS THAN 0
201510061003  ¦             MOVE "-" TO IS2-CPG-YTD-CASH-SIGN
201520020730R35540     ELSE
201530020730R35540          MOVE " " TO IS2-CPG-YTD-CASH-SIGN
201540010308R13637     END-IF
201550020730
201560020730              MOVE WS-IS2-CPG-CURRENT-CASH  TO  IS2-CPG-CURRENT-CASH
201570061003R13637     IF      WS-IS2-CPG-CURRENT-CASH  IS LESS THAN 0
201580061003  ¦             MOVE "-" TO IS2-CPG-CURRENT-CASH-SIGN
201590020730R35540     ELSE
201600020730R35540          MOVE " " TO IS2-CPG-CURRENT-CASH-SIGN
201610010308R13637     END-IF
201620020730
201630020730              MOVE WS-IS2-CPG-INCEPT-REINV  TO  IS2-CPG-INCEPT-REINV
201640061003R13637     IF      WS-IS2-CPG-INCEPT-REINV  IS LESS THAN 0
201650061003  ¦             MOVE "-" TO IS2-CPG-INCEPT-REINV-SIGN
201660020730R35540     ELSE
201670020821R35540          MOVE " " TO IS2-CPG-INCEPT-REINV-SIGN
201680020821R13637     END-IF
201690020822
201700020821              MOVE WS-IS2-CPG-YTD-REINV     TO  IS2-CPG-YTD-REINV
201710061003R13637     IF      WS-IS2-CPG-YTD-REINV  IS LESS THAN 0
201720061003  ¦             MOVE "-" TO IS2-CPG-YTD-REINV-SIGN
201730020821R35540     ELSE
201740020821R35540          MOVE " " TO IS2-CPG-YTD-REINV-SIGN
201750020821R13637     END-IF
201760020822
201770020821              MOVE WS-IS2-CPG-CURRENT-REINV TO  IS2-CPG-CURRENT-REINV
201780061003R13637     IF      WS-IS2-CPG-CURRENT-REINV  IS LESS THAN 0
201790061003  ¦             MOVE "-" TO IS2-CPG-CURRENT-REINV-SIGN
201800020821R35540     ELSE
201810020821R35540          MOVE " " TO IS2-CPG-CURRENT-REINV-SIGN
201820020821R13637     END-IF
201830020821
201840020821R14136        MOVE WS-IS2-MFR-CUR  TO  IS2-MFR-CUR
201850061003  ¦        IF      WS-IS2-MFR-CUR  IS LESS THAN 0
201860061003  ¦             MOVE "-" TO IS2-MFR-CUR-SIGN
201870020821R35540     ELSE
201880020821R35540          MOVE " " TO IS2-MFR-CUR-SIGN
201890020821R14136     END-IF
201900020821
201910020821R14136        MOVE WS-IS2-MFR-YTD  TO  IS2-MFR-YTD
201920061003  ¦        IF      WS-IS2-MFR-YTD  IS LESS THAN 0
201930061003  ¦             MOVE "-" TO IS2-MFR-YTD-SIGN
201940020821R35540     ELSE
201950020821R35540          MOVE " " TO IS2-MFR-YTD-SIGN
201960020821R14136     END-IF
201970020821
201980020821R14136        MOVE WS-IS2-MFR-INCEPT  TO  IS2-MFR-INCEPT
201990061003  ¦        IF      WS-IS2-MFR-INCEPT  IS LESS THAN 0
202000061003  ¦             MOVE "-" TO IS2-MFR-INCEPT-SIGN
202010020821R35540     ELSE
202020020821R35540          MOVE " " TO IS2-MFR-INCEPT-SIGN
202030020821R14136     END-IF
202040020821
202050020821R14136        MOVE WS-IS2-FED-WHTAX-CUR  TO  IS2-FED-WHTAX-CUR
202060061003  ¦        IF      WS-IS2-FED-WHTAX-CUR  IS LESS THAN 0
202070061003  ¦             MOVE "-" TO IS2-FED-WHTAX-CUR-SIGN
202080020821R35540     ELSE
202090020821R35540          MOVE " " TO IS2-FED-WHTAX-CUR-SIGN
202100020821R14136     END-IF
202110020821
202120020821R14136        MOVE WS-IS2-FED-WHTAX-YTD  TO  IS2-FED-WHTAX-YTD
202130061003  ¦        IF      WS-IS2-FED-WHTAX-YTD  IS LESS THAN 0
202140061003  ¦             MOVE "-" TO IS2-FED-WHTAX-YTD-SIGN
202150020821R35540     ELSE
202160010308R35540          MOVE " " TO IS2-FED-WHTAX-YTD-SIGN
202170021004R14136     END-IF
202180021004
202190021004R14136        MOVE WS-IS2-PROV-WHTAX-CUR  TO  IS2-PROV-WHTAX-CUR
202200061003  ¦        IF      WS-IS2-PROV-WHTAX-CUR  IS LESS THAN 0
202210061003  ¦             MOVE "-" TO IS2-PROV-WHTAX-CUR-SIGN
202220021004R35540     ELSE
202230021004R35540          MOVE " " TO IS2-PROV-WHTAX-CUR-SIGN
202240021004R14136     END-IF
202250021004
202260021004R14136        MOVE WS-IS2-PROV-WHTAX-YTD  TO  IS2-PROV-WHTAX-YTD
202270061003  ¦        IF      WS-IS2-PROV-WHTAX-YTD  IS LESS THAN 0
202280061003  ¦             MOVE "-" TO IS2-PROV-WHTAX-YTD-SIGN
202290021004R35540     ELSE
202300021004R35540          MOVE " " TO IS2-PROV-WHTAX-YTD-SIGN
202310021004R14136     END-IF
202320021004
202330021004R14858        MOVE WS-IS2-BAJ-CUR  TO  IS2-BAJ-CUR
202340061003  ¦        IF      WS-IS2-BAJ-CUR       IS LESS THAN 0
202350061003  ¦             MOVE "-" TO IS2-BAJ-CUR-SIGN
202360021004R35540     ELSE
202370021004R35540          MOVE " " TO IS2-BAJ-CUR-SIGN
202380021004R14858     END-IF
202390021004
202400021004R14858        MOVE WS-IS2-BAJ-YTD  TO  IS2-BAJ-YTD
202410061003  ¦        IF      WS-IS2-BAJ-YTD       IS LESS THAN 0
202420061003  ¦             MOVE "-" TO IS2-BAJ-YTD-SIGN
202430021004R35540     ELSE
202440021004R35540          MOVE " " TO IS2-BAJ-YTD-SIGN
202450021004R14858     END-IF
202460021004
202470021004R14858        MOVE WS-IS2-BAJ-INCEPT  TO  IS2-BAJ-INCEPT
202480061003  ¦        IF      WS-IS2-BAJ-INCEPT    IS LESS THAN 0
202490061003  ¦             MOVE "-" TO IS2-BAJ-INCEPT-SIGN
202500021004R35540     ELSE
202510021004R35540          MOVE " " TO IS2-BAJ-INCEPT-SIGN
202520021004R14858     END-IF
202530021004
202540021004R14858        MOVE WS-IS2-BFW-CUR  TO  IS2-BFW-CUR
202550061003  ¦        IF      WS-IS2-BFW-CUR       IS LESS THAN 0
202560061003  ¦             MOVE "-" TO IS2-BFW-CUR-SIGN
202570021004R35540     ELSE
202580040414R35540          MOVE " " TO IS2-BFW-CUR-SIGN
202590040414R14858     END-IF
202600040414
202610040414R14858        MOVE WS-IS2-BFW-YTD  TO  IS2-BFW-YTD
202620061003  ¦        IF      WS-IS2-BFW-YTD       IS LESS THAN 0
202630061003  ¦             MOVE "-" TO IS2-BFW-YTD-SIGN
202640040414R35540     ELSE
202650040414R35540          MOVE " " TO IS2-BFW-YTD-SIGN
202660040414R14858     END-IF
202670040414
202680040414R14858        MOVE WS-IS2-BFW-INCEPT  TO  IS2-BFW-INCEPT
202690061003  ¦        IF      WS-IS2-BFW-INCEPT    IS LESS THAN 0
202700061003  ¦             MOVE "-" TO IS2-BFW-INCEPT-SIGN
202710040414R35540     ELSE
202720040414R35540          MOVE " " TO IS2-BFW-INCEPT-SIGN
202730040414R14858     END-IF
202740040414
202750040414R20758     MOVE WS-IS2-ROC-CUR     TO  IS2-ROC-CUR
202760061003  ¦        IF      WS-IS2-ROC-CUR       IS LESS THAN 0
202770061003  ¦             MOVE "-" TO IS2-ROC-CUR-SIGN
202780040414R35540     ELSE
202790160212R35540          MOVE " " TO IS2-ROC-CUR-SIGN
202800160526R20758     END-IF
202810160526
202820160526R20758     MOVE WS-IS2-ROC-YTD     TO  IS2-ROC-YTD
202830160526  ¦        IF      WS-IS2-ROC-YTD       IS LESS THAN 0
202840040414  ¦             MOVE "-" TO IS2-ROC-YTD-SIGN
202850021004R35540     ELSE
202860020321R35540          MOVE " " TO IS2-ROC-YTD-SIGN
202870010308R20758     END-IF
202880010308
202890060621R20758     MOVE WS-IS2-ROC-INCEPT  TO  IS2-ROC-INCEPT
202900030825  ¦        IF      WS-IS2-ROC-INCEPT    IS LESS THAN 0
202910010308  ¦             MOVE "-" TO IS2-ROC-INCEPT-SIGN
202920010308R35540     ELSE
202930030910R35540          MOVE " " TO IS2-ROC-INCEPT-SIGN
202940030910R20758     END-IF
202950030910148326     PERFORM RETRIEVE-KYC-DESCR THRU RKD-EXIT
202960030910      *RFS159149 Starts
202970030910130239*    PERFORM PREPARE-SECTION12-NEW-FIELD
202980030910           PERFORM PREPARE-SECTION12-NEW-FIELD THRU PS12N-EXIT
202990030910      *RFS159149 ends
202991211003      *RFS186592 Starts*
202992210917           PERFORM GET-RESET-OPTION-CODE
202993210917      *RFS186592 Ends*
203000030910
203010030910
203020030910              MOVE WS-PREV-START-DATE          TO  IS2-START-DATE
203030030910              MOVE PREV-END-DATE            TO  IS2-END-DATE
203040970430
203050970430R18147        MOVE INVESTOR-SUMMARY-SECTION-2 TO STATEMENT-REC(ISR)
203060970430R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
203070970430           END-IF.
203080970430
203081210914      * RFS186199 - Begin
203082210914      *****  Write Account Guarantee Details (Section14) ******
203083210914           IF lb_AccountGuaranteesYes
203084210914                INITIALIZE INVESTOR-SUMMARY-SECTION-3
203085210914                PERFORM PREPARE-SECTION14-ACC-GUAR THRU PS14AG-EXIT
203086210914                MOVE WS-PREV-START-DATE TO  IS3-START-DATE
203087210914                MOVE PREV-END-DATE            TO  IS3-END-DATE
203088210914                MOVE INVESTOR-SUMMARY-SECTION-3 TO STATEMENT-REC(ISR)
203089210914                PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
203090210914           END-IF
203091210914      * RFS186199 - End
203092970430R16511*****
203100970430  ¦   *****    Write Account IPS Details (Section17).
203110970430  ¦   *****
203120970430  ¦
203130970702  ¦        IF WS-LDA-SECTION-17         IS EQUAL TO  "Y"
203140970702  ¦           PERFORM ACCOUNT-IPS-DETAILS-SECTION   THRU AIDS-EXIT
203150970702  ¦           IF WS-IPS-RETURN-CODE  = "00"
203160980417  ¦              MOVE ACCOUNT-IPS-DETAILS      TO STATEMENT-REC(ISR)
203170980417  ¦              PERFORM INSERT-STATEMENT-REC  THRU ISR-EXIT
203180980417  v           END-IF
203190970430R16511     END-IF.
203200970430      *****
203210970430      *****    Format and create the Account Asset Class Summary records
203220970430      *****    using the values accumulated in the investment summary
203230970430      *****    routine (LEVEL-SUMMARY-1).  The asset class table will be
203240970430      *****    processed twice.  The first pass is to calculate and
203250970430      *****    balance the percentages.  The second pass is to format
203260970430      *****    and create the records.
203270970430      *****
203280970430
203290970430           IF  WS-AC-LST NOT GREATER THAN  ZEROES
203300970430               GO TO LS2-0130.
203310970430
203320970430980417     IF  WS-ACC-VALUE   IS EQUAL TO  ZEROES
203330970430980417     AND WS-LDA-ASSET-CLASS
203340990818                          IS NOT EQUAL TO  "Y"
203350980818               GO TO LS2-0130.
203360970430
203370970430      *****
203380980818      *****    First pass: Calculate and balance the percentages.
203390980817      *****
203400990818
203410980818           MOVE ZEROES                 TO  WS-AC-PCTTOT.
203420980818           MOVE ZEROES                 TO  WS-IGC-VALHGH.
203430980818
203440980818           SET AC                      TO  1.
203450980818
203460980818       LS2-0050.
203470980818           IF  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
203480980818               GO TO LS2-0080.
203490980818
203500980818           IF WS-LDA-PERC-DECIMAL NOT EQUAL TO "S"
203510980817              COMPUTE WS-AC-PCT (AC) ROUNDED
203520160613                                        =  (WS-AC-VAL (AC)
203530970430                                        *   100)
203540970430                                        /  WS-ACC-VALUE.
203550970430
203560970430           IF WS-LDA-PERC-DECIMAL EQUAL TO "S"
203570970430              MOVE ZEROES TO WS-AC-PCT-PHN
203580970430              COMPUTE WS-AC-PCT-PHN ROUNDED
203590970430                                      =  (WS-AC-VAL (AC)
203600970430                                      *   100)
203610970430                                      /  WS-ACC-VALUE
203620970430              MOVE WS-AC-PCT-PHN       TO  WS-AC-PCT (AC).
203630970430
203640970430           ADD WS-AC-PCT (AC)       TO  WS-AC-PCTTOT.
203650970430
203660970430           MOVE ZEROES                 TO  WS-AC-ACSR (AC).
203670970430
203680040107           IF  WS-AC-VAL (AC)
203690970430                          IS GREATER THAN  WS-IGC-VALHGH
203700970430               MOVE WS-AC-VAL (AC)     TO  WS-IGC-VALHGH
203710970702               SET ACR                 TO  AC.
203720980417
203730980417           IF  WS-AC-SLST (AC)
203740970702                      IS NOT GREATER THAN  ZEROES
203750970702           OR  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
203760990818               GO TO LS2-0080.
203770040107
203780040107           MOVE ZEROES                 TO  WS-ACS-PCTTOT.
203790970702           MOVE ZEROES                 TO  WS-IGCS-VALHGH.
203800980817
203810980817           SET ACS                     TO  1.
203820970702
203830990818       LS2-0060.
203840980818R20205     IF  WS-ACS-VAL (AC, ACS)
203850980818                              IS EQUAL TO  ZEROES
203860040107               GO TO LS2-0070.
203870980818
203880980818980417     IF  WS-LDA-ASSET-CLASS-PERCENT
203890040107980417                    IS NOT EQUAL TO  "Y"
203900980817               GO TO LS2-0060-0010.
203910980817
203920970702           IF WS-LDA-PERC-DECIMAL NOT EQUAL TO "S"
203930990818R20205         COMPUTE WS-ACS-PCT (AC, ACS) ROUNDED
203940040107R20205                                  =  (WS-ACS-VAL (AC, ACS)
203950040107                                        *   100)
203960970430                                        /  WS-ACC-VALUE
203970970430               GO TO LS2-0060-0020.
203980980817
203990990818           IF WS-LDA-PERC-DECIMAL EQUAL TO "S"
204000980818               MOVE ZEROES TO WS-ACS-PCT-PHN
204010980818               COMPUTE WS-ACS-PCT-PHN ROUNDED
204020040107R20205                               =  (WS-ACS-VAL (AC, ACS)
204030980817                                     *   100)
204040980818                                     /  WS-ACC-VALUE
204050040107R20205         MOVE WS-ACS-PCT-PHN      TO WS-ACS-PCT (AC, ACS)
204060980818               GO TO LS2-0060-0020.
204070970702
204080040107       LS2-0060-0010.
204090040107           IF WS-LDA-PERC-DECIMAL NOT EQUAL TO "S"
204100970430R20205        COMPUTE WS-ACS-PCT (AC, ACS) ROUNDED
204110040107R20205                                  =  (WS-ACS-VAL (AC, ACS)
204120970430                                        *   100)
204130970430                                        /  WS-AC-VAL (AC).
204140970430
204150970430           IF WS-LDA-PERC-DECIMAL EQUAL TO "S"
204160040107              MOVE ZEROES TO WS-ACS-PCT-PHN
204170970430              COMPUTE WS-ACS-PCT-PHN ROUNDED
204180970430R20205                                 =  (WS-ACS-VAL (AC, ACS)
204190970703                                       *   100)
204200970703                                       /  WS-AC-VAL (AC)
204210970702R20205        MOVE WS-ACS-PCT-PHN         TO WS-ACS-PCT (AC, ACS).
204220980417
204230980417       LS2-0060-0020.
204240970702R20205     ADD WS-ACS-PCT (AC, ACS)    TO  WS-ACS-PCTTOT.
204250970702R20205     IF  WS-ACS-VAL (AC, ACS)
204260970702                          IS GREATER THAN  WS-IGCS-VALHGH
204270040107R20205         MOVE WS-ACS-VAL (AC, ACS)
204280040107                                       TO  WS-IGCS-VALHGH
204290970702               SET ACSR                TO  ACS.
204300970702
204310970702       LS2-0070.
204320970430R20205     IF  ACS           IS LESS THAN  WS-AC-SLST (AC)
204330970702               SET ACS              UP BY  1
204340970430               GO TO LS2-0060.
204350040107
204360040107           SET WS-AC-ACSR (AC)         TO  ACSR.
204370970430
204380970430980417     IF  WS-LDA-ASSET-CLASS-PERCENT
204390970430980417                    IS NOT EQUAL TO  "Y"
204400970430               GO TO LS2-0070-0010.
204410970430
204420970430           IF  WS-ACS-PCTTOT NOT EQUAL TO  WS-AC-PCT (AC)
204430970430R20205         COMPUTE WS-ACS-PCT (AC, ACSR)
204440970430R20205                                  =  WS-ACS-PCT (AC, ACSR)
204450970702                                        +  (WS-AC-PCT (AC)
204460970702                                        -   WS-ACS-PCTTOT).
204470980817           GO TO LS2-0080.
204480970702
204490970430       LS2-0070-0010.
204500970430           IF  WS-ACS-PCTTOT NOT EQUAL TO  100.0000
204510980817R20205         COMPUTE WS-ACS-PCT (AC, ACSR)
204520980417R20205                                  =  WS-ACS-PCT (AC, ACSR)
204530980417                                        +  (100.0000
204540970702                                        -   WS-ACS-PCTTOT).
204550970702
204560970703       LS2-0080.
204570970703           IF  AC            IS LESS THAN  WS-AC-LST
204580970703               SET AC               UP BY  1
204590040107               GO TO LS2-0050.
204600040107
204610970702           IF  WS-AC-PCTTOT   IS EQUAL TO  100.0000
204620970702               GO TO LS2-0080-0010.
204630970702
204640970430           COMPUTE WS-AC-PCT (ACR)      =  WS-AC-PCT (ACR)
204650970430                                        +  (100.0000
204660970430                                        -   WS-AC-PCTTOT).
204670970430
204680970430980417     IF  WS-LDA-ASSET-CLASS-PERCENT
204690970430980417                    IS NOT EQUAL TO  "Y"
204700990823               GO TO LS2-0080-0010.
204710970430
204720970430           IF  WS-AC-ACSR (ACR)
204730970430                          IS NOT EQUAL TO  ZEROES
204740970430               SET ACSR                TO  WS-AC-ACSR (ACR)
204750970430R20205         COMPUTE WS-ACS-PCT (ACR, ACSR)
204760970430R20205                                  =  WS-ACS-PCT (ACR, ACSR)
204770990823                                        +  (100.0000
204780970430                                        -   WS-AC-PCTTOT).
204790970430       LS2-0080-0010.
204800160212
204810160212      *****
204820160212      *****    Second pass: Format and create the records.
204830970702      *****
204840160212
204850160212           SET AC                      TO  1.
204860970430
204870970430           IF  AD-LANGUAGE    IS EQUAL TO  "F"
204880160613               SET ACL                 TO  2
204890970430               SET ACSL                TO  2
204900970430             ELSE
204910970430               SET ACL                 TO  1
204920970430               SET ACSL                TO  1.
204930970430
204940970430           MOVE 1                      TO  WS-AC-SECTION-SEQUENCE.
204950970430
204960970430148326*    IF  WS-LDA-MGMT-COM-CDE
204970970430148326*                   IS NOT EQUAL TO  "PHN"
204980970430148326*        GO TO LS2-0090.
204990970430
205000970430148326*    PERFORM FORMAT-ASSET-CLASS-RTN THRU FACR-EXIT.
205010970430148326*    GO TO LS2-0120-0010.
205020160613       LS2-0090.
205030020321           IF  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
205040980129156335     AND WS-AC-BOK-VAL (AC) IS EQUAL TO  ZEROES
205050980129               GO TO LS2-0120.
205060030910           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
205070040107           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
205080040107           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
205090040107           MOVE 15                     TO  AC-SECTION-NO.
205100030910           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
205110040120           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
205120030910           MOVE AD-DEALER              TO  AC-DEALER.
205130030910           MOVE AD-SALESREP            TO  AC-SALESREP.
205140031003           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
205150031003           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
205160031003           MOVE WS-AC-VAL (AC)         TO  AC-MARKET-VALUE.
205170031003           MOVE WS-AC-PCT (AC)         TO  AC-PERCENTAGE.
205180060621156335     MOVE WS-AC-BOK-VAL (AC)     TO  AC-BOOK-VALUE.
205190030825           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
205200970430           MOVE PREV-END-DATE          TO  AC-END-DATE.
205210970430
205220970430R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
205230970430R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
205240160613R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
205250160613R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
205260160613  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
205270970430R20561        PERFORM GET-TARGET-MIX-PERCENTAGE-AC   THRU GTMPA-EXIT
205280970430R16511     END-IF.
205290970430
205300040107R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
205310970430   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
205320160613R17527     END-IF.
205330970430
205340970430R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
205350970430R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
205360970430           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
205370970430
205380970430           IF  WS-AC-SLST (AC)
205390970430                      IS NOT GREATER THAN  ZEROES
205400970430156335*    OR  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
205410970430156335     OR  (WS-AC-VAL (AC) IS EQUAL TO  ZEROES
205420970430156335     AND WS-AC-BOK-VAL (AC) IS EQUAL TO  ZEROES)
205430970430               GO TO LS2-0120.
205440040107           SET ACS                     TO  1.
205450040107       LS2-0100.
205460970430R20205     IF  WS-ACS-VAL (AC, ACS)
205470970430                              IS EQUAL TO  ZEROES
205480040107156335     AND WS-ACS-BOK-VAL (AC, ACS) IS EQUAL TO  ZEROES
205490040107               GO TO LS2-0110.
205500160613           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
205510020321           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
205520980129           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
205530030910           MOVE 15                     TO  AC-SECTION-NO.
205540040107           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
205550040107           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
205560040107           MOVE AD-DEALER              TO  AC-DEALER.
205570030910           MOVE AD-SALESREP            TO  AC-SALESREP.
205580030910           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
205590030910           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
205600030910R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  AC-ASSET-SUBCLASS-CODE.
205610031003R20205     MOVE WS-ACS-DESC (AC, ACS, ACSL)
205620031003                                       TO
205630031003                                       AC-ASSET-SUBCLASS-DESCRIPTION.
205640031003R20205     MOVE WS-ACS-VAL (AC, ACS)   TO  AC-MARKET-VALUE.
205650060621R20205     MOVE WS-ACS-PCT (AC, ACS)   TO  AC-PERCENTAGE.
205660030825156335     MOVE WS-ACS-BOK-VAL (AC, ACS) TO  AC-BOOK-VALUE.
205670970430           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
205680970430           MOVE PREV-END-DATE          TO  AC-END-DATE.
205690970430R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
205700040107R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
205710970430R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
205720970430R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
205730970430  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
205740970430  v           PERFORM GET-TARGET-MIX-PERCENTAGE       THRU GTMP-EXIT
205750970430R16511     END-IF.
205760970430
205770970430R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
205780970512   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
205790970702R17527     END-IF.
205800970702
205810970512R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
205820970512R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
205830970512           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
205840970512
205850970512       LS2-0110.
205860970512R20205     IF  ACS           IS LESS THAN  WS-AC-SLST (AC)
205870970512               SET ACS              UP BY  1
205880970512               GO TO LS2-0100.
205890970512
205900970512       LS2-0120.
205910970512           IF  AC            IS LESS THAN  WS-AC-LST
205920970512               SET AC               UP BY  1
205930970512               GO TO LS2-0090.
205940970512
205950160614       LS2-0120-0010.
205960970512
205970040120      *****
205980020321      *****    Format and create the Account Asset Class total record.
205990980129      *****
206000980129
206010031003           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
206020031003           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
206030031003           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
206040060621           MOVE 15                     TO  AC-SECTION-NO.
206050030825           MOVE 999999                 TO  AC-SECTION-SEQUENCE.
206060970512           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
206070970430           MOVE AD-DEALER              TO  AC-DEALER.
206080020708           MOVE AD-SALESREP            TO  AC-SALESREP.
206090020708           MOVE "TOTAL"                TO  AC-ASSET-CLASS-DESCRIPTION.
206100020708           MOVE WS-ACC-VALUE           TO  AC-MARKET-VALUE.
206110020708156335     MOVE WS-BOOK-TOTAL-ACCT     TO  AC-BOOK-VALUE.
206120020708           MOVE 100.0000               TO  AC-PERCENTAGE.
206130020708R20561     MOVE 100.0000               TO  AC-TARGET-MIX-PERC.
206140970430           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
206150971024           MOVE PREV-END-DATE          TO  AC-END-DATE.
206160971024
206170971024R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
206180971024   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
206190971024R17527     END-IF.
206200971024R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
206210971024R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
206220971024           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
206230971024
206240971024R14142     IF  WS-LDA-REQUEST-SCOPE  IS EQUAL TO  "B"
206250971024           AND WS-LDA-STMT-CNFM-FLAG = "S"
206260990726               PERFORM ADHOC-IN-BATCH-ASSET-CLASS    THRU AIBAC-EXIT
206270971024               ADD 1                TO  WS-ADHOC-B-FLAG
206280971024               CLOSE                INVESTMENT-GROUP
206290970422R14142     END-IF.
206300970422       LS2-0130.
206310970422
206320970422      *****
206330971024      *****    If a Dealer record is to be created for each account,
206340970422      *****    format and create it now.
206350990620      *****
206360990620
206370990620           IF  WS-LDA-DEALER-FLAG
206380970422                              IS EQUAL TO  "A"
206390970422               MOVE PREV-ACCOUNT       TO  WS-FDR-ACCOUNT
206400001103               MOVE "DLR"              TO  WS-FDR-ADVTYPCDE
206410001103               MOVE AD-DEALER          TO  WS-FDR-DLRCDE
206420010330               MOVE WS-AD-SALESREP     TO  WS-FDR-DLRREPCDE
206430010330               PERFORM FORMAT-DEALER-RECORD
206440010330                                      THRU FDR-EXIT.
206450010330
206460010330      *****
206470010330      *****    Accumulate totals to the next level.
206480010330      *****
206490010330           ADD WS-ACC-OPNMKTVAL        TO  WS-IVR-OPNMKTVAL.
206500010330           ADD WS-REMAINDER            TO  WS-IVR-REMAINDER.
206510010330           ADD WS-1ST-60               TO  WS-IVR-1ST-60.
206520010330           ADD WS-REMAINDER-EX         TO  WS-IVR-REMAINDER-EX.
206530010330           ADD WS-1ST-60-EX            TO  WS-IVR-1ST-60-EX.
206540010330           ADD WS-TOTAL-VALUE          TO  WS-IVR-TOTAL-VALUE.
206550010330           ADD WS-WITHDRAWALS          TO  WS-IVR-WITHDRAWALS.
206560010330RF8276     ADD IS-BOOK-VALUE-CDN       TO  WS-IVR-BKVAL-CDN-TOT.
206570980921           ADD IS-BOOK-VALUE-FGN       TO  WS-IVR-BKVAL-FGN-TOT.
206580980914
206590001229rf9729     IF IS-MKT-VALUE-CHG-INC-SIGN    IS EQUAL TO "-"
206600060621              SUBTRACT IS-MKT-VALUE-CHG-INC
206610030825                                    FROM WS-IVR-MKTVAL-CHGINC-TOT
206620010102           ELSE
206630971010              ADD IS-MKT-VALUE-CHG-INC TO  WS-IVR-MKTVAL-CHGINC-TOT
206640000000           END-IF.
206650991201
206660040511rf9729     IF IS-MKT-VALUE-CHG-CUR-SIGN    IS EQUAL TO "-"
206670040511              SUBTRACT IS-MKT-VALUE-CHG-CUR
206680040511                                    FROM WS-IVR-MKTVAL-CHGCUR-TOT
206690040511           ELSE
206700040511              ADD IS-MKT-VALUE-CHG-CUR TO  WS-IVR-MKTVAL-CHGCUR-TOT
206710040511           END-IF.
206720040511
206730040511           IF  WS-LDA-INV-ACC-FLAG   IS NOT EQUAL TO "Y"
206740040511               GO TO LS2-EXIT.
206750040511
206760040511R18147     MOVE WS-II-SECTION-ACC TO STATEMENT-REC(ISR).
206770040511R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
206780040511
206790040511       LS2-EXIT.
206800081120           EXIT.
206810081120
206820081120R18194*****
206830161107   ¦  *****   Create Section 20 record based on the Currency.
206840150216   ¦  *****   Each Currency will create a record under the Account.
206850040511   ¦  *****
206860040511   ¦
206870040511   ¦   POPULATE-SECTION20-TOTAL.
206880040511   ¦
206890061003   ¦       SET CS20T TO CC.
206900061003   ¦       MOVE WS-CS20T-TOT-TOT(CS20T) TO  AD-SECTION-SEQUENCE.
206910040511   ¦       MOVE "TOTAL"                TO  AD-INVESTMENT-NAME.
206920040511   ¦       MOVE WS-INV-CUR-CODE (ACBV) TO  AD-CURRENCY.
206930040511   ¦       MOVE WS-INV-CUR-DESCR(ACBV) TO  AD-CURRENCY-DESCRIPTION.
206940040511   ¦       MOVE ZEROES                 TO  AD-NO-OF-UNITS.
206950140925   ¦       MOVE WS-ACC-CUR-BVF (ACBV)   TO  AD-BOOK-VALUE.
206960140925      *RFS 50492 - Begin
206970140925           MOVE SPACES                  TO  AD-DORMANT-FUND.
206980200609      *RFS 50492 - End
206990200622      * RFS185916 - Begins
207000200609               MOVE SPACES             TO  AD-PROD-TYPE-CODE.
207010040511      * RFS185916 - Ends
207020040511164313     PERFORM DISTRIBUTION-ACCTOT-CCY-LEVEL THRU DACL-EXIT.
207030040511143392     MOVE SPACES                  TO  AD-DSC.
207040040511   ¦
207050040511   ¦       MOVE WS-ACC-CUR-BVB (ACBV)   TO  AD-BOOK-VALUE-BASE.
207060050330   ¦       IF   WS-ACC-CUR-BVB (ACBV)       IS LESS THAN 0
207070050330   ¦            MOVE "-" TO AD-BOOK-VALUE-SIGN
207080050330R35540     ELSE
207090050330R35540          MOVE " " TO AD-BOOK-VALUE-SIGN
207100050330   ¦       END-IF
207110050330   ¦
207120050330   ¦       MOVE WS-ACC-CUR-VALUE (ACBV) TO  AD-MARKET-VALUE.
207130050330   ¦       MOVE WS-ACC-CUR-MVB (ACBV)  TO  AD-MARKET-VALUE-BASE.
207140050330      * RFS 139952 -begin RM
207150050330           MOVE Ws-Inv-Accr-Int-TOT (ACBV) TO AD-Accrued-Interest.
207160050330      * RFS 139952 -end   RM
207170050330   ¦       MOVE ZEROES                 TO  AD-ACB-UNIT-PRICE.
207180040723   ¦       MOVE ZEROES                 TO  AD-ACB-UNIT-PRICE-BASE.
207190040723   ¦       MOVE ZEROES                 TO  AD-LAST-UNIT-PRICE-BASE.
207200040723   ¦       MOVE ZEROES                 TO  AD-LAST-UNIT-PRICE.
207210040723   ¦       SET ACPS                    TO  CC.
207220040723      * RFS26213 Start
207230040723           MOVE ZEROES                 TO AD-UNIT-BALANCE-PRIOR-Q1.
207240040723           MOVE ZEROES                 TO AD-UNIT-BALANCE-PRIOR-Q2.
207250040723           MOVE ZEROES                 TO AD-UNIT-BALANCE-PRIOR-Q3.
207260040723           MOVE ZEROES                 TO AD-UNIT-BALANCE-PRIOR-Q4.
207270040723           MOVE ZEROES                 TO AD-UNIT-BALANCE-PRIOR-YE.
207280040723           MOVE ZEROES                 TO AD-UNIT-PRICE-PRIOR-Q1.
207290040511           MOVE ZEROES                 TO AD-UNIT-PRICE-PRIOR-Q2.
207300040511           MOVE ZEROES                 TO AD-UNIT-PRICE-PRIOR-Q3.
207310040511           MOVE ZEROES                 TO AD-UNIT-PRICE-PRIOR-Q4.
207320150817           MOVE ZEROES                 TO AD-UNIT-PRICE-PRIOR-YE.
207330040511      * RFS26213 End
207340040511R21815     IF WS-CC-CODE (CC)       = WS-CURRENCY-USD           AND
207350061003   ¦          WS-LDA-REQUEST-SCOPE  =  "B"                      AND
207360061003   ¦          WS-LDA-STMT-CNFM-FLAG = "S"                       AND
207370040511   ¦          ACCOUNT-NO OF STMT-PRINT-REQ-REC NOT = AD-ACCOUNT AND
207380040511   ¦          CURR-CONTROLS     NOT = HIGH-VALUES
207390040511   ¦          MOVE WS-PRV-USD-RTECLS TO AD-EXCHANGE-RATE
207400040511   ¦       ELSE
207410040511   V          MOVE WS-CC-RTECLS (CC)      TO  AD-EXCHANGE-RATE
207420040511R21815     END-IF.
207430040511
207440040511R18194     MOVE WS-ACCPCT-CUR (ACPS)   TO  AD-ACCOUNT-PERC.
207450040511   ¦       MOVE SPACES                 TO  AD-FUND-NO.
207460040511   ¦
207470040511   ¦       MOVE WS-ACC-CUR-MVP (ACBV)  TO  AD-MARKET-VALUE-PRIOR.
207480061003150035     ADD  ln_S20RetrnInterest1   TO  AD-MARKET-VALUE-PRIOR.
207490061003   ¦       IF   WS-ACC-CUR-MVP (ACBV)  IS LESS THAN 0
207500040511   ¦            MOVE "-" TO AD-MARKET-VALUE-PRIOR-SIGN
207510040511R35540     ELSE
207520040511R35540          MOVE " " TO AD-MARKET-VALUE-PRIOR-SIGN
207530040511   ¦       END-IF.
207540040511   ¦
207550061003   ¦       MOVE WS-ACC-CUR-CPG (ACBV)  TO  AD-CPG-FIXED.
207560061003   ¦       MOVE WS-ACC-CUR-MVBQ1(ACBV) TO  AD-MARKET-VALUE-PRIOR-Q1.
207570040511   ¦       MOVE WS-ACC-CUR-MVBQ2(ACBV) TO  AD-MARKET-VALUE-PRIOR-Q2.
207580040511   ¦       MOVE WS-ACC-CUR-MVBQ3(ACBV) TO  AD-MARKET-VALUE-PRIOR-Q3.
207590040511   ¦       MOVE WS-ACC-CUR-MVBQ4(ACBV) TO  AD-MARKET-VALUE-PRIOR-Q4.
207600040511   ¦
207610040511   ¦       MOVE WS-INV-BAJ-CUR-TOT-CUR(ACBV)  TO AD-BAJ-CUR.
207620061003   ¦       IF   WS-INV-BAJ-CUR-TOT-CUR(ACBV)  IS LESS THAN ZEROES
207630061003   ¦          MOVE "-"  TO  AD-BAJ-CUR-SIGN
207640040511R35540     ELSE
207650040511R35540        MOVE " "  TO  AD-BAJ-CUR-SIGN
207660040511   ¦       END-IF.
207670040511   ¦
207680040511   ¦       MOVE WS-INV-BAJ-YTD-TOT-CUR(ACBV)  TO AD-BAJ-YTD.
207690061003   ¦       IF   WS-INV-BAJ-YTD-TOT-CUR(ACBV)  IS LESS THAN ZEROES
207700061003   ¦          MOVE "-"  TO  AD-BAJ-YTD-SIGN
207710040511R35540     ELSE
207720040511R35540        MOVE " "  TO  AD-BAJ-YTD-SIGN
207730040511   ¦       END-IF.
207740040511   ¦
207750040511   ¦       MOVE WS-INV-BAJ-INCEPT-TOT-CUR(ACBV)  TO AD-BAJ-INCEPT.
207760061003   ¦       IF   WS-INV-BAJ-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
207770061003   ¦          MOVE "-"  TO  AD-BAJ-INCEPT-SIGN
207780040511R35540     ELSE
207790040511R35540        MOVE " "  TO  AD-BAJ-INCEPT-SIGN
207800040511   ¦       END-IF.
207810040511   ¦
207820040511   ¦       MOVE WS-INV-BFW-CUR-TOT-CUR(ACBV)     TO AD-BFW-CUR.
207830061003   ¦       IF   WS-INV-BFW-CUR-TOT-CUR(ACBV)     IS LESS THAN ZEROES
207840061003   ¦          MOVE "-"  TO  AD-BFW-CUR-SIGN
207850040511R35540     ELSE
207860040511R35540        MOVE " "  TO  AD-BFW-CUR-SIGN
207870040511   ¦       END-IF.
207880040511   ¦
207890040511   ¦       MOVE WS-INV-BFW-YTD-TOT-CUR(ACBV)     TO AD-BFW-YTD.
207900061003   ¦       IF   WS-INV-BFW-YTD-TOT-CUR(ACBV)     IS LESS THAN ZEROES
207910061003   ¦          MOVE "-"  TO  AD-BFW-YTD-SIGN
207920040511R35540     ELSE
207930040511R35540        MOVE " "  TO  AD-BFW-YTD-SIGN
207940040511   ¦       END-IF.
207950040511   ¦
207960040511   ¦       MOVE WS-INV-BFW-INCEPT-TOT-CUR(ACBV)  TO AD-BFW-INCEPT.
207970061003   ¦       IF   WS-INV-BFW-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
207980061003   ¦          MOVE "-"  TO  AD-BFW-INCEPT-SIGN
207990040511R35540     ELSE
208000040511R35540        MOVE " "  TO  AD-BFW-INCEPT-SIGN
208010040511   ¦       END-IF.
208020040511   ¦
208030040511   ¦       MOVE WS-INV-PUR-INCEPT-TOT-CUR(ACBV)  TO AD-PUR-INCEPT.
208040061003   ¦       IF   WS-INV-PUR-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
208050061003   ¦          MOVE "-"  TO  AD-PI-SIGN
208060040511R35540     ELSE
208070040511R35540        MOVE " "  TO  AD-PI-SIGN
208080040511   ¦       END-IF.
208090040511   ¦
208100040511   ¦       MOVE WS-INV-RED-INCEPT-TOT-CUR(ACBV)  TO AD-RED-INCEPT.
208110061003   ¦       IF   WS-INV-RED-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
208120061003   ¦          MOVE "-"  TO  AD-RI-SIGN
208130040511R35540     ELSE
208140040511R35540        MOVE " "  TO  AD-RI-SIGN
208150040511   ¦       END-IF.
208160040511   ¦
208170040511   ¦       MOVE WS-INV-TRI-INCEPT-TOT-CUR(ACBV)  TO AD-TRI-INCEPT.
208180040511   ¦       IF   WS-INV-TRI-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
208190040511   ¦          MOVE "-"  TO  AD-TI-SIGN
208200040511R35540     ELSE
208210061003R35540        MOVE " "  TO  AD-TI-SIGN
208220061003   ¦       END-IF.
208230040511   ¦
208240040511   ¦       MOVE WS-INV-TRO-INCEPT-TOT-CUR(ACBV)  TO AD-TRO-INCEPT.
208250040511   ¦       IF   WS-INV-TRO-INCEPT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
208260040511   ¦          MOVE "-"  TO  AD-OI-SIGN
208270040511R35540     ELSE
208280061003R35540        MOVE " "  TO  AD-OI-SIGN
208290061003   ¦       END-IF.
208300040511   ¦
208310040511   ¦       MOVE WS-INV-SWI-INCEPT-TOT-CUR(ACBV)  TO AD-SWI-INCEPT.
208320040511   ¦       MOVE WS-INV-SWO-INCEPT-TOT-CUR(ACBV)  TO AD-SWO-INCEPT.
208330040511   ¦
208340040511   ¦       MOVE WS-INV-TRI-INCEPT-COST-CUR(ACBV) TO AD-TRI-INCEPT-COST.
208350061003   ¦       IF WS-INV-TRI-INCEPT-COST-CUR(ACBV)   IS LESS THAN ZEROES
208360061003   ¦          MOVE "-"                      TO AD-TRI-INCEPT-COST-SIGN
208370040511R35540     ELSE
208380040511R35540        MOVE " "                      TO AD-TRI-INCEPT-COST-SIGN
208390040511   ¦       END-IF.
208400040511   ¦
208410040511   ¦       MOVE WS-INV-TRO-INCEPT-COST-CUR(ACBV) TO AD-TRO-INCEPT-COST.
208420061003   ¦       IF WS-INV-TRO-INCEPT-COST-CUR(ACBV)   IS LESS THAN ZEROES
208430061003   ¦          MOVE "-"                      TO AD-TRO-INCEPT-COST-SIGN
208440040511R35540     ELSE
208450040511R35540        MOVE " "                      TO AD-TRO-INCEPT-COST-SIGN
208460040511   ¦       END-IF.
208470040511   ¦
208480040511   ¦       MOVE WS-INV-TRI-INCEPT-MKT-CUR(ACBV)  TO AD-TRI-INCEPT-MKT.
208490040511   ¦       IF WS-INV-TRI-INCEPT-MKT-CUR(ACBV)    IS LESS THAN ZEROES
208500061003   ¦          MOVE "-"                      TO AD-TRI-INCEPT-MKT-SIGN
208510061003R35540     ELSE
208520040511R35540        MOVE " "                      TO AD-TRI-INCEPT-MKT-SIGN
208530040511   ¦       END-IF.
208540040511   ¦
208550040511   ¦       MOVE WS-INV-TRO-INCEPT-MKT-CUR(ACBV)  TO AD-TRO-INCEPT-MKT.
208560040511   ¦       IF WS-INV-TRO-INCEPT-MKT-CUR(ACBV)    IS LESS THAN ZEROES
208570061003   ¦          MOVE "-"                      TO AD-TRO-INCEPT-MKT-SIGN
208580061003R35540     ELSE
208590040511R35540        MOVE " "                      TO AD-TRO-INCEPT-MKT-SIGN
208600040511   ¦       END-IF.
208610040511   ¦
208620040511   ¦       MOVE WS-INV-TRI-INCEPT-PH-TOT-CUR(ACBV)
208630040511   ¦                                         TO AD-TRI-INCEPT-PHANTOM.
208640061003   ¦       IF WS-INV-TRI-INCEPT-PH-TOT-CUR(ACBV) IS LESS THAN ZEROES
208650061003   ¦          MOVE "-"                    TO AD-TRI-INCEPT-PHANTOM-SIGN
208660040511R35540     ELSE
208670040511R35540        MOVE " "                    TO AD-TRI-INCEPT-PHANTOM-SIGN
208680040511   ¦       END-IF.
208690040511   ¦
208700040511   ¦       MOVE WS-INV-TRI-YTD-PH-TOT-CUR(ACBV) TO AD-TRI-YTD-PHANTOM.
208710040511   ¦       IF WS-INV-TRI-YTD-PH-TOT-CUR(ACBV)   IS LESS THAN ZEROES
208720061003   ¦          MOVE "-"                       TO AD-TRI-YTD-PHANTOM-SIGN
208730061003R35540     ELSE
208740040511R35540        MOVE " "                       TO AD-TRI-YTD-PHANTOM-SIGN
208750040511   ¦       END-IF.
208760040511   ¦
208770040511   ¦       MOVE WS-INV-TRI-CUR-PH-TOT-CUR(ACBV) TO AD-TRI-CUR-PHANTOM.
208780040511   ¦       IF WS-INV-TRI-CUR-PH-TOT-CUR(ACBV)   IS LESS THAN ZEROES
208790061003   ¦          MOVE "-"                       TO AD-TRI-CUR-PHANTOM-SIGN
208800061003R35540     ELSE
208810040511R35540        MOVE " "                       TO AD-TRI-CUR-PHANTOM-SIGN
208820040511   ¦       END-IF.
208830040511   ¦
208840040511   ¦       MOVE WS-INV-TRO-INCEPT-PH-TOT-CUR(ACBV)
208850040511   ¦                                         TO AD-TRO-INCEPT-PHANTOM.
208860061003   ¦       IF WS-INV-TRO-INCEPT-PH-TOT-CUR(ACBV) IS LESS THAN ZEROES
208870061003   ¦          MOVE "-"                    TO AD-TRO-INCEPT-PHANTOM-SIGN
208880040511R35540     ELSE
208890040511R35540        MOVE " "                    TO AD-TRO-INCEPT-PHANTOM-SIGN
208900040511   ¦       END-IF.
208910040511   ¦
208920040511   ¦       MOVE WS-INV-TRO-YTD-PH-TOT-CUR(ACBV) TO AD-TRO-YTD-PHANTOM.
208930040511   ¦       IF WS-INV-TRO-YTD-PH-TOT-CUR(ACBV)   IS LESS THAN ZEROES
208940040511   ¦          MOVE "-"                       TO AD-TRO-YTD-PHANTOM-SIGN
208950061003R35540     ELSE
208960061003R35540        MOVE " "                       TO AD-TRO-YTD-PHANTOM-SIGN
208970040511   ¦       END-IF.
208980040511   ¦
208990040511   ¦       MOVE WS-INV-TRO-CUR-PH-TOT-CUR(ACBV) TO AD-TRO-CUR-PHANTOM.
209000040511   ¦       IF WS-INV-TRO-CUR-PH-TOT-CUR(ACBV)   IS LESS THAN ZEROES
209010040511   ¦          MOVE "-"                       TO AD-TRO-CUR-PHANTOM-SIGN
209020040511R35540     ELSE
209030040511R35540        MOVE " "                       TO AD-TRO-CUR-PHANTOM-SIGN
209040061003   ¦       END-IF.
209050061003   ¦
209060040511   ¦       MOVE WS-INV-DISP-GAIN-LOSS-CUR-CUR(ACBV)
209070040511   ¦                                       TO AD-DISP-GAIN-LOSS-CUR.
209080040511   ¦       IF WS-INV-DISP-GAIN-LOSS-CUR-CUR(ACBV)
209090040511   ¦                                        IS LESS THAN ZEROES
209100040511   ¦          MOVE "-"             TO AD-DISP-GAIN-LOSS-CUR-SIGN
209110040511R35540     ELSE
209120040511R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-CUR-SIGN
209130061003   ¦       END-IF.
209140061003   ¦
209150040511   ¦       MOVE WS-INV-DISP-GAIN-LOSS-YTD-CUR(ACBV)
209160040511   ¦                                       TO AD-DISP-GAIN-LOSS-YTD.
209170040511   ¦       IF WS-INV-DISP-GAIN-LOSS-YTD-CUR(ACBV)
209180040511   ¦                                        IS LESS THAN ZEROES
209190040511   ¦          MOVE "-"             TO AD-DISP-GAIN-LOSS-YTD-SIGN
209200061003R35540     ELSE
209210061003R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-YTD-SIGN
209220040511   ¦       END-IF.
209230040511   ¦
209240040511   ¦       MOVE WS-INV-DISP-GAIN-LOSS-INC-CUR(ACBV)
209250040511   ¦                                    TO AD-DISP-GAIN-LOSS-INCEPT.
209260040511   ¦       IF WS-INV-DISP-GAIN-LOSS-INC-CUR(ACBV)
209270061003   ¦                                        IS LESS THAN ZEROES
209280061003   ¦          MOVE "-"             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
209290040511R35540     ELSE
209300040511R35540        MOVE " "             TO AD-DISP-GAIN-LOSS-INCEPT-SIGN
209310040511   ¦       END-IF.
209320040511   ¦
209330040511   ¦       MOVE WS-INV-PUR-CURRENT-TOT-CUR(ACBV)  TO AD-PUR-CURRENT.
209340061003   ¦       IF   WS-INV-PUR-CURRENT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209350061003   ¦          MOVE "-"  TO  AD-PC-SIGN
209360040511R35540     ELSE
209370040511R35540        MOVE " "  TO  AD-PC-SIGN
209380040511   ¦       END-IF.
209390040511   ¦
209400040511   ¦       MOVE WS-INV-RED-CURRENT-TOT-CUR(ACBV)  TO AD-RED-CURRENT.
209410061003   ¦       IF   WS-INV-RED-CURRENT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209420061003   ¦          MOVE "-"  TO  AD-RC-SIGN
209430040511R35540     ELSE
209440040511R35540        MOVE " "  TO  AD-RC-SIGN
209450040813   ¦       END-IF.
209460040813   ¦
209470040813   ¦       MOVE WS-INV-TRI-CURRENT-TOT-CUR(ACBV)  TO AD-TRI-CURRENT.
209480061003   ¦       IF   WS-INV-TRI-CURRENT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209490061003   ¦          MOVE "-"  TO  AD-TC-SIGN
209500040813R35540     ELSE
209510040813R35540        MOVE " "  TO  AD-TC-SIGN
209520040813   ¦       END-IF.
209530040813   ¦
209540040813   ¦       MOVE WS-INV-TRO-CURRENT-TOT-CUR(ACBV)  TO AD-TRO-CURRENT.
209550061003   ¦       IF   WS-INV-TRO-CURRENT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209560061003   ¦          MOVE "-"  TO  AD-OC-SIGN
209570040813R35540     ELSE
209580040813R35540        MOVE " "  TO  AD-OC-SIGN
209590040813   ¦       END-IF.
209600040813   ¦
209610040813   ¦       MOVE WS-INV-ROC-CUR-TOT-CUR(ACBV)      TO AD-ROC-CUR.
209620061003   ¦       IF WS-INV-ROC-CUR-TOT-CUR(ACBV)      IS LESS THAN ZEROES
209630061003   ¦          MOVE "-"  TO  AD-ROC-CUR-SIGN
209640040813R35540     ELSE
209650050830R35540        MOVE " "  TO  AD-ROC-CUR-SIGN
209660040511   ¦       END-IF.
209670040511   ¦
209680040511   ¦       MOVE WS-INV-ROC-YTD-TOT-CUR(ACBV)      TO AD-ROC-YTD.
209690040511   ¦       IF WS-INV-ROC-YTD-TOT-CUR(ACBV)      IS LESS THAN ZEROES
209700040511   ¦          MOVE "-"  TO  AD-ROC-YTD-SIGN
209710040511R35540     ELSE
209720061003R35540        MOVE " "  TO  AD-ROC-YTD-SIGN
209730061003   ¦       END-IF.
209740061003   ¦
209750061003   ¦       MOVE WS-INV-ROC-INCEPT-TOT-CUR(ACBV)   TO AD-ROC-INCEPT.
209760040511   ¦       IF WS-INV-ROC-INCEPT-TOT-CUR(ACBV)   IS LESS THAN ZEROES
209770040511   ¦          MOVE "-"  TO  AD-ROC-INCEPT-SIGN
209780040511R35540     ELSE
209790040511R35540        MOVE " "  TO  AD-ROC-INCEPT-SIGN
209800040511   ¦       END-IF.
209810040511   ¦
209820040511   ¦       ADD    WS-INV-BUY-CURRENT-TOT-CUR(ACBV)
209830061003   ¦              WS-INV-TRI-CURRENT-TOT-CUR(ACBV)
209840061003   ¦              WS-INV-SWI-CURRENT-TOT-CUR(ACBV)
209850061003   ¦                  GIVING    AD-DEPOSIT
209860061003   ¦                            WS-DEPOSIT-TOT-CUR(ACBV).
209870040511   ¦       IF     WS-DEPOSIT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209880040511   ¦              MOVE  "-"   TO  AD-DEPOSIT-SIGN
209890040511R35540     ELSE
209900040511R35540            MOVE  " "   TO  AD-DEPOSIT-SIGN
209910040511R35540     END-IF.
209920040511   ¦
209930040511   ¦       ADD    WS-INV-SEL-CURRENT-TOT-CUR(ACBV)
209940040511   ¦              WS-INV-TRO-CURRENT-TOT-CUR(ACBV)
209950040511   ¦              WS-INV-SWO-CURRENT-TOT-CUR(ACBV)
209960040511   ¦                  GIVING    AD-WITHDRAWALS
209970061003   ¦                            WS-WITHD-TOT-CUR(ACBV).
209980061003   ¦       IF     WS-WITHD-TOT-CUR(ACBV)  IS LESS THAN ZEROES
209990040511   ¦              MOVE  "-"   TO  AD-WITHDRAWALS-SIGN
210000040511R35540     ELSE
210010040511R35540            MOVE  " "   TO  AD-WITHDRAWALS-SIGN
210020040511R35540     END-IF.
210030061003   ¦
210040061003   ¦       MOVE ZEROES              TO  AD-YTD-DISP-PROCEEDS-BASE.
210050040511   ¦       MOVE ZEROES              TO  AD-YTD-DISP-BOOK-VALUE-BASE.
210060040511   ¦       MOVE ZEROES              TO  AD-YTD-DISP-GAIN-LOSS-BASE.
210070040511   ¦       MOVE SPACES              TO  AD-YTD-DISP-PROCEEDS-BASE-S.
210080040511   ¦       MOVE SPACES              TO  AD-YTD-DISP-BOOK-VALUE-BASE-S.
210090061003   ¦       MOVE SPACES              TO  AD-YTD-DISP-GAIN-LOSS-BASE-S.
210100061003   ¦
210110040511   ¦       IF WS-INV-RED-INCEPT-TOT-CUR(ACBV)   IS LESS THAN ZEROES
210120040511   ¦          MOVE "-"  TO  AD-RI-SIGN
210130040512R35540     ELSE
210140040511R35540        MOVE " "  TO  AD-RI-SIGN
210150040511   ¦       END-IF.
210160040511   ¦
210170040511   ¦       IF WS-INV-RED-CURRENT-TOT-CUR(ACBV)  IS LESS THAN ZEROES
210180040511   ¦          MOVE "-"  TO  AD-RC-SIGN
210190040511R35540     ELSE
210200040511R35540        MOVE " "  TO  AD-RC-SIGN
210210040511   ¦       END-IF.
210220040511   ¦
210230040511   ¦       IF  WS-ACC-CUR-CPG (ACBV)   LESS THAN  ZEROES
210240040511   ¦           MOVE "-"                TO  AD-CPG-FIXED-SIGN
210250040713R35540     ELSE
210260040511R35540         MOVE " "                TO  AD-CPG-FIXED-SIGN
210270040511   ¦       END-IF.
210280050830   ¦
210290080925   ¦       MOVE WS-INVAUCCUR-SW (ACBV) TO  AD-INVALID-AVERAGE-COST.
210300080925   ¦       IF  WS-LDA-MGMT-COM-CDE = "GGF" AND
210310160614   ¦           WS-INVAUCACC-SW = "Y"
210320160614   ¦           MOVE "Y"                TO  AD-INVALID-AVERAGE-COST
210330160614   ¦       END-IF.
210340160614   ¦
210350080925   ¦       MOVE SPACES             TO  AD-INVESTMENT-GRP-CATEGORY.
210360080925   ¦       MOVE SPACES             TO  AD-INVESTMENT-GRP-CAT-DESC.
210370080925   ¦
210380080925   ¦       IF WS-LDA-IPS-STMT         IS EQUAL TO "Y"
210390080925   ¦         MOVE WS-IPS-GROUP-ID     TO AD-IPS-GROUP-ID
210400080925   ¦       END-IF.
210410080925   ¦
210420080925   ¦       MOVE ACCOUNT-DETAILS-SECTION TO STATEMENT-REC(ISR).
210430080925   ¦       PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
210440080925   ¦
210450080925R50823     IF lb-LdaAccountAdditionalInfoYes
210460080925  ¦           MOVE AD-INVESTOR-NO       TO AAI-INVESTOR-NO
210470080925156335*       MOVE WS-EXT-LOAD-TYP   TO AAI-INVESTMENT-EXT-LOAD-TYPE
210480080925156335*       MOVE WS-EXT-LOAD-DESC  TO AAI-INVESTMENT-EXT-LOAD-DESC
210490080930156335*       MOVE WS-ASSET-CLASS-CD   TO AAI-ASSET-CLASS-CODE
210500080930156335*       MOVE WS-ASSET-CLASS-DESC TO AAI-ASSET-CLASS-DESCRIPTION
210510080930  ¦           MOVE AD-ACCOUNT           TO AAI-ACCOUNT
210520080925  ¦           MOVE 21                   TO AAI-SECTION-NO
210530080925  ¦           MOVE AD-SECTION-SEQUENCE  TO AAI-SECTION-SEQUENCE
210540160927  ¦           MOVE AD-LANGUAGE          TO AAI-LANGUAGE
210550160927  ¦           MOVE AD-DEALER            TO AAI-DEALER
210560160927  ¦           MOVE AD-SALESREP          TO AAI-SALESREP
210570160927  ¦           MOVE AD-ACCOUNT-TYPE-SHORT TO AAI-ACCOUNT-TYPE-SHORT
210580120316  ¦           MOVE AD-ACCOUNT-TYPE       TO AAI-ACCOUNT-TYPE
210590120316  ¦           MOVE AD-INVESTMENT-NAME    TO AAI-INVESTMENT-NAME
210600120316  ¦           MOVE AD-START-DATE         TO AAI-START-DATE
210610120316  ¦           MOVE AD-END-DATE           TO AAI-END-DATE
210620120316  ¦           MOVE AD-EOR-INDICATOR      TO AAI-EOR-INDICATOR
210630120316  ¦           MOVE AD-SECTION-SEQUENCE-2 TO AAI-SECTION-SEQUENCE-2
210640120316  |           MOVE WS-GMA-VALUE-TOT-CUR(ACBV)  TO AAI-GMA-VALUE
210650120316  |           IF WS-GMA-VALUE-TOT-CUR(ACBV)  IS  LESS THAN ZEROS
210660120316  |              MOVE "-"                TO AAI-GMA-VALUE-SIGN
210670120316  |           END-IF
210680120316  |           MOVE 0                     TO AAI-GMP-CLOSING-DATE
210690120316  |           MOVE 0                     TO AAI-GMP-PRICE
210700120316162904        MOVE ln_ACC-CPG-YTF-TOT (ACBV)  TO AAI-YTD-TRAILER
210710151205162904        IF ln_ACC-CPG-YTF-TOT (ACBV)    IS LESS THAN ZERO
210720160301162904           MOVE "-"                TO AAI-YTD-TRAILER-SIGN
210730080925162904        END-IF
210740080925102716        MOVE WS-INV-CPG-YTD-TOT(ACBV)  TO AAI-CPG-YTD
210750080925  |           IF WS-INV-CPG-YTD-TOT(ACBV)    IS LESS THAN ZERO
210760080925  |              MOVE "-"                TO AAI-CPG-YTD-SIGN
210770080925  |           END-IF
210780040511  |
210790130614  |           MOVE WS-INV-INC-YTD-TOT(ACBV)  TO AAI-INC-YTD
210800130614  |           IF WS-INV-INC-YTD-TOT(ACBV)    IS LESS THAN ZERO
210810130614  |              MOVE "-"                TO AAI-INC-YTD-SIGN
210820130614  |           END-IF
210830040511  |           MOVE WS-INV-INT-YTD-TOT(ACBV)  TO AAI-INT-YTD
210840040511  |           IF WS-INV-INT-YTD-TOT(ACBV)    IS LESS THAN ZERO
210850040511  V              MOVE "-"                TO AAI-INT-YTD-SIGN
210860040511102716        END-IF
210870040511151145        MOVE lc_CrossRefNumber     TO AAI-CROSS-REF-NUMBER
210880040723148326        PERFORM RETRIEVE-AAI-ORIG-COST-TOT THRU RAOCT-EXIT
210890030910  ¦
210900030910  ¦           MOVE ACCOUNT-ADDITIONAL-INFO  TO STATEMENT-REC(ISR)
210910030910  |           PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
210920030910  V           INITIALIZE ACCOUNT-ADDITIONAL-INFO
210930030910R50823     END-IF.
210940030910   ¦
210950030910117038     If lncc-Section22Yes
210960030910117038        and lc_Section80 = "Y"
210970030910117038        Perform Section-22-Creation
210980030910117038     End-If.
210990030910   ¦  **********
211000030910   ¦
211010030910   ¦   PS20T-EXIT.
211020030910   ¦         EXIT.
211030030910   V
211040030910R18194**********
211050030910R16511 GET-TARGET-MIX-PERCENTAGE.
211060030910  ¦
211070030910  ¦        MOVE "TARGET-MIX-PERCENTAGE " TO WS-SQLERR-STATEMENT.
211080030910  ¦        EXEC SQL
211090030910  ¦             OPEN ASMXPC1
211100030910  ¦        END-EXEC.
211110030910  ¦
211120030910  ¦        EXEC SQL
211130030910  ¦             FETCH NEXT FROM ASMXPC1
211140030910  ¦             INTO :WS-TARGET-MIX-PERCENTAGE
211150040120  ¦        END-EXEC.
211160040120  ¦
211170040120  ¦        IF SQLCODE = 0
211180040120  ¦          MOVE WS-TARGET-MIX-PERCENTAGE   TO AC-TARGET-MIX-PERC
211190040120  ¦        ELSE
211200040120  ¦          MOVE ZEROS                      TO AC-TARGET-MIX-PERC
211210040120  ¦        END-IF.
211220040120  ¦
211230040120  ¦        EXEC SQL
211240040120  ¦             CLOSE ASMXPC1
211250040120  ¦        END-EXEC.
211260040120  ¦
211270040120  ¦    GTMP-EXIT.
211280040120  ¦         EXIT.
211290040120  v
211300040120R16511**********
211310040120R20561*****
211320040120  ¦   *****   Get the Total of TARGET-MIX-PERCENTAGE for Asset Class.
211330040120  ¦   *****
211340040120  ¦    GET-TARGET-MIX-PERCENTAGE-AC.
211350040120  ¦
211360040120  ¦        MOVE "Select Class total Percnt" TO WS-SQLERR-STATEMENT.
211370991201  ¦        EXEC SQL
211380991201  ¦          SELECT SUM(CONSTPC.ASSET_CLASS_PERCENTAGE)
211390991201  ¦                 INTO :WS-TARGET-MIX-PERCENTAGE-AC:IND1
211400991201  ¦          FROM MFACONSTP CONSTPC
211410991201  ¦          WHERE
211420991201  ¦            CONSTPC.CONS_ACCT_ID     = :WS-CONS-ACCT-ID         AND
211430991203  ¦            CONSTPC.ASSET_CLASS_CODE = :WS-ASSET-CLASS-CODE     AND
211440991201  ¦            CONSTPC.EFFECTIV_DATE    = :WS-EFFECTIVE-DATE
211450991203  ¦        END-EXEC.
211460991201  ¦
211470991201  ¦        MOVE WS-TARGET-MIX-PERCENTAGE-AC TO AC-TARGET-MIX-PERC.
211480991201  ¦
211490991201  ¦    GTMPA-EXIT.
211500991201  ¦          EXIT.
211510991203  v
211520991201R20561**********
211530991201      *****
211540991201      *****   Populate MAXIMUM-PENSIONABLE-EARNINGS field in Section 60
211550991201      *****
211560991201      /
211570991201RF5962 POPULATE-MAX-PENSION.
211580991201           INITIALIZE MAX-PENSION-EARNINGS-REC.
211590991201           MOVE WS-COUNTRY-OF-AGREEMENT  TO COUNTRY-CODE
211600991201                                         OF MAX-PENSION-EARNINGS-REC.
211610991201           MOVE WS-PROVINCE-OF-AGREEMENT TO PROVINCE-CODE
211620991201                                         OF MAX-PENSION-EARNINGS-REC.
211630021204           MOVE WS-LDA-ENDDTE-CCYY    TO TAX-YEAR
211640140707                                         OF MAX-PENSION-EARNINGS-REC.
211650140707           READ MAX-PENSION-EARNINGS
211660140707                INVALID KEY
211670000417                  INITIALIZE MAX-PENSION-EARNINGS-REC
211680000417           END-READ
211690000417           IF WS-AGE  <= INVESTOR-MAX-AGE OF MAX-PENSION-EARNINGS-REC
211700000417           AND WS-AGE >= INVESTOR-MIN-AGE OF MAX-PENSION-EARNINGS-REC
211710000417              MOVE MPE-AMOUNT OF MAX-PENSION-EARNINGS-REC
211720000505                                     TO AW-MAX-PENSIONABLE-EARNINGS
211730031215           ELSE
211740031215              MOVE ZEROS             TO AW-MAX-PENSIONABLE-EARNINGS
211750031215           END-IF.
211760031215      **********
211770031215       PMP-EXIT.
211780031215           EXIT.
211790031215      **********
211800031215132121     EXEC SQL
211810031215132121       INCLUDE  CPYASTM60
211820031215132121     END-EXEC.
211830031215RF6063*****
211840031215      *****   Generate Section-67 Beneficiary-information
211850031215      *****
211860031215       GENERATE-BENEFICIARY-67.
211870031215
211880031215           INITIALIZE WS-BENEFICIARY67-CNT.
211890031215
211900031215R19502*** Start
211910031215           MOVE PREV-ACCOUNT TO WS-ACCOUNT-NO.
211920031215       GB67-OPEN-ACCBENC1.
211930031215           MOVE "OPEN ACCBENC1 GB67" TO WS-SQLERR-STATEMENT.
211940031215           EXEC SQL
211950031215             OPEN ACCBENC1
211960031215           END-EXEC.
211970031215       GB67-GET-ACCOUNT-BENEFICIARY.
211980031215           MOVE "FETCH ACCBENC1 GB67" TO WS-SQLERR-STATEMENT.
211990061027           EXEC SQL
212000061027            FETCH NEXT FROM ACCBENC1
212010031215            FOR :ACCBENMAX ROWS
212020031215            INTO :ABN-ACCBENC1-FIELDS
212030031215           END-EXEC
212040031215
212050031215           IF SQLCODE > 0
212060031215              GO TO GB67-CLOSE-ACCBENC1
212070031215           END-IF.
212080031215
212090031215           COMPUTE WS-SQL-INDEX = 0.
212100031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3).
212110031215
212120031215       GB67-INCREMENT-WS-SQL-INDEX.
212130031215           ADD 1 TO WS-SQL-INDEX.
212140031215
212150031215           IF ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "A" AND
212160031215              ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "I"
212170031215              GO TO GB67-WS-SQL-INDEX-CHK
212180031215           END-IF.
212190031215
212200031215RF4638*** Populate BE-PRIMARY-CONTINGENT from Account-beneficiary
212210031215      *** -split logical file -- mfaacbplb.
212220031215           INITIALIZE ACCOUNT-BENEFICIARY-SPLLB-REC.
212230031215
212240031215           MOVE WS-ACCOUNT-NO
212250031215                TO ACCOUNT-NO OF ACCOUNT-BENEFICIARY-SPLLB-REC.
212260031215           MOVE ABN-BENEFICIARY-SEQ-NO(WS-SQL-INDEX)
212270031215                TO BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-SPLLB-REC.
212280031215           MOVE SPACES  TO  BENEFICIARY-SPLIT-CODE OF
212290031215                            ACCOUNT-BENEFICIARY-SPLLB-REC.
212300031215
212310031215           START ACCOUNT-BENEFICIARY-SPLITLB
212320031215              KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
212330031215                  INVALID KEY
212340031215                   INITIALIZE ACCOUNT-BENEFICIARY-SPLLB-REC
212350031215                   MOVE SPACES TO BENEFICIARY-TYPE-CODE
212360031215                               OF ACCOUNT-BENEFICIARY-SPLLB-REC
212370031215                   GO TO GB67-BENEFICIARY-FINANCIALS
212380031215           END-START
212390031215
212400031215           READ ACCOUNT-BENEFICIARY-SPLITLB NEXT
212410031215                AT END
212420031215                   INITIALIZE ACCOUNT-BENEFICIARY-SPLLB-REC
212430031215           END-READ.
212440031215
212450031215           IF ACCOUNT-NO OF ACCOUNT-BENEFICIARY-SPLLB-REC IS NOT
212460031215                   EQUAL TO  WS-ACCOUNT-NO
212470031215           OR BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-SPLLB-REC
212480031215                   IS NOT EQUAL TO ABN-BENEFICIARY-SEQ-NO(WS-SQL-INDEX)
212490031215                 MOVE SPACES TO BENEFICIARY-TYPE-CODE
212500031215                                   OF ACCOUNT-BENEFICIARY-SPLLB-REC
212510031215                   GO TO GB67-BENEFICIARY-FINANCIALS
212520031215           END-IF.
212530031215
212540031215      *** READ ACCOUNT-BENEFICIARY-FINANCIALS FILE.
212550031215
212560031215       GB67-BENEFICIARY-FINANCIALS.
212570031215
212580031215           INITIALIZE ACCOUNT-BENEFICIARY-FINAN-REC.
212590031215           INITIALIZE WS-BE-BENEFICIARY.
212600031215
212610031215           MOVE WS-ACCOUNT-NO
212620031215                 TO ACCOUNT-NO OF ACCOUNT-BENEFICIARY-FINAN-REC.
212630031215           MOVE ABN-BENEFICIARY-SEQ-NO(WS-SQL-INDEX) TO
212640031215                BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-FINAN-REC.
212650031215           MOVE LOW-VALUES         TO CONTR-REDEM-CODE-RULE
212660031215                                   OF ACCOUNT-BENEFICIARY-FINAN-REC.
212670031215           MOVE LOW-VALUES         TO CONTR-OR-REDEMEMPTION
212680031215                                   OF ACCOUNT-BENEFICIARY-FINAN-REC.
212690031215           MOVE LOW-VALUES         TO GRANDFATHERED
212700031215                                   OF ACCOUNT-BENEFICIARY-FINAN-REC.
212710031215
212720031215           START ACCOUNT-BENEFICIARY-FINANCIALS
212730031215               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
212740031215               INVALID KEY
212750031215               GO TO BENEFICIARY-INFO-WRITE
212760031215           END-START.
212770031215
212780031215       GB67-READBF-NEXT.
212790031215
212800031215           READ ACCOUNT-BENEFICIARY-FINANCIALS NEXT
212810031215                                       AT  END
212820031215               GO TO BENEFICIARY-INFO-WRITE
212830031215           END-READ
212840031215
212850031215           IF ACCOUNT-NO OF ACCOUNT-BENEFICIARY-FINAN-REC
212860031215                IS NOT EQUAL TO WS-ACCOUNT-NO
212870031215               GO TO BENEFICIARY-INFO-WRITE
212880031215           END-IF.
212890031215
212900031215           IF BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-FINAN-REC NOT
212910031215              EQUAL TO ABN-BENEFICIARY-SEQ-NO(WS-SQL-INDEX)
212920031215              GO TO BENEFICIARY-INFO-WRITE
212930031215           END-IF.
212940031215
212950031215RF7778     IF CONTR-OR-REDEMEMPTION OF ACCOUNT-BENEFICIARY-FINAN-REC
212960031215                                    IS EQUAL TO "C"
212970031215              IF CONTR-REDEM-CODE-RULE OF
212980031215                     ACCOUNT-BENEFICIARY-FINAN-REC IS EQUAL TO  2
212990031215                 ADD YTD-CONTR-DEDUCT-AMT OF
213000031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213010031215                                    TO WS-BEYTD-CAP-TRANSFERIN
213020031215                 ADD LTD-CONTR-DEDUCT-AMT OF
213030031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213040031215                                    TO WS-BELTD-CAP-TRANSFERIN
213050031215              ELSE
213060031215              IF CONTR-REDEM-CODE-RULE OF
213070031215                     ACCOUNT-BENEFICIARY-FINAN-REC IS EQUAL TO  9
213080031215                 ADD YTD-CONTR-DEDUCT-AMT OF
213090031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213100031215                                    TO WS-BEYTD-CESG-TRANSFERIN
213110031215                 ADD LTD-CONTR-DEDUCT-AMT OF
213120031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213130031215                                    TO WS-BELTD-CESG-TRANSFERIN
213140031215              ELSE
213150031215              IF CONTR-REDEM-CODE-RULE OF
213160031215                     ACCOUNT-BENEFICIARY-FINAN-REC IS EQUAL TO  10
213170031215                 ADD YTD-CONTR-DEDUCT-AMT OF
213180031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213190031215                                    TO WS-BEYTD-INC-TRANSFERIN
213200031215                 ADD LTD-CONTR-DEDUCT-AMT OF
213210031215                     ACCOUNT-BENEFICIARY-FINAN-REC
213220031215                                    TO WS-BELTD-INC-TRANSFERIN
213230031215              END-IF
213240031215           END-IF.
213250031215
213260031215      *********************************************************
213270031215      **** Search the Array to retrieve the Beneficiary amounts
213280101104      *********************************************************
213290101104R12784     SET BEN TO 1
213300101104  ¦          SEARCH WS-BENEF-ENT VARYING BEN
213310101104  ¦        WHEN BENEFICIARY-SEQ-NO OF ACCOUNT-BENEFICIARY-FINAN-REC
213320101104  ¦                    IS EQUAL TO WS-BEN-SEQ-NO (BEN)
213330101104  ¦
213340101104  ¦        IF CONTR-OR-REDEMEMPTION OF ACCOUNT-BENEFICIARY-FINAN-REC
213350031215  ¦                          IS EQUAL TO "C"
213360031215  ¦         AND CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213370031215  ¦                           IS EQUAL TO  1
213380031215  ¦               MOVE WS-BEN-AMT-TOT-YTD-CONTR (BEN) TO
213390031215  ¦                                 WS-BEYTD-CONTRIBUTIONS
213400031215  ¦               MOVE WS-BEN-AMT-TOT-LTD-CONTR (BEN) TO
213410031215  ¦                                 WS-BELTD-CONTRIBUTIONS
213420140806  ¦        END-IF
213430140806  ¦
213440150908R83788*    IF CONTR-OR-REDEMEMPTION OF ACCOUNT-BENEFICIARY-FINAN-REC
213450140806  ¦   *                      IS EQUAL TO "C"
213460140806  ¦   *     AND CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213470140806  ¦   *                       IS EQUAL TO  5
213480140806R17199*           MOVE WS-BEN-AMT-TOT-YTD-CESG (BEN) TO WS-BEYTD-CESG
213490140806  V   *           MOVE WS-BEN-AMT-TOT-LTD-CESG (BEN) TO WS-BELTD-CESG
213500140806R83788*    END-IF
213510140806  ¦
213520140806  ¦        IF CONTR-OR-REDEMEMPTION OF ACCOUNT-BENEFICIARY-FINAN-REC
213530160201  ¦                          IS EQUAL TO "R"
213540160201  ¦             MOVE WS-BEN-AMT-TOT-YTD-WITHD (BEN) TO
213550160202  ¦                                   WS-BEYTD-WITHDRAWLS
213560160201  ¦             MOVE WS-BEN-AMT-TOT-LTD-WITHD (BEN) TO
213570031215  ¦                                   WS-BELTD-WITHDRAWLS
213580101104133489        IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213590101104  |              IS EQUAL TO  6 OR 7 OR 17 OR 18 OR 28 OR 30
213600101104146193                          OR 33 OR 38
213610101104  |              MOVE WS-BEN-AMT-TOT-YTD-EAP (BEN) TO WS-BEYTD-EAP
213620101104  |              MOVE WS-BEN-AMT-TOT-LTD-EAP (BEN) TO WS-BELTD-EAP
213630101104  |           END-IF
213640101104  |           IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213650101104  |              IS EQUAL TO 12
213660101104  |              MOVE WS-BEN-AMT-TOT-YTD-PSE (BEN) TO WS-BEYTD-PSE
213670101104  V              MOVE WS-BEN-AMT-TOT-LTD-PSE (BEN) TO WS-BELTD-PSE
213680101104133489        END-IF
213690101104148326        IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213700101104148326           IS EQUAL TO  6
213710101104148326           MOVE WS-BEN-AMT-TOT-LTD-CEAP (BEN) TO WS-BELTD-CEAP
213720150908148326        END-IF
213730150908  ¦        END-IF
213740150908R83788     IF CONTR-OR-REDEMEMPTION OF ACCOUNT-BENEFICIARY-FINAN-REC
213750150908  ¦                          IS EQUAL TO "C"
213760101104  ¦           IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213770101104  ¦                           IS EQUAL TO  5
213780101104  |               MOVE WS-BEN-AMT-TOT-YTD-CESG (BEN) TO WS-BEYTD-CESG
213790101104  |               MOVE WS-BEN-AMT-TOT-LTD-CESG (BEN) TO WS-BELTD-CESG
213800101104  |           END-IF
213810101104  ¦           IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213820101104  ¦                           IS EQUAL TO  15
213830101104  |             MOVE WS-BEN-AMT-TOT-LTD-CLB (BEN) TO WS-BE-TOT-LTD-CLB
213840101104  |             MOVE WS-BEN-AMT-TOT-YTD-CLB (BEN) TO WS-BE-TOT-YTD-CLB
213850101104  |           END-IF
213860101104  |           IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213870101104  |                           IS EQUAL TO  16
213880101104146193        OR CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213890101104146193                        IS EQUAL TO  32
213900031215146193        OR CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213910031215146193                        IS EQUAL TO  37
213920031215  |               MOVE WS-BEN-AMT-TOT-LTD-PGRANT (BEN)
213930031215  |                                     TO WS-BE-TOT-LTD-PGRANT
213940031215  |               MOVE WS-BEN-AMT-TOT-YTD-PGRANT (BEN)
213950031215  |                                     TO WS-BE-TOT-YTD-PGRANT
213960031215  |           END-IF
213970031215  |           IF CONTR-REDEM-CODE-RULE OF ACCOUNT-BENEFICIARY-FINAN-REC
213980031215  |                           IS EQUAL TO  25 OR 26
213990031215  |               MOVE WS-BEN-AMT-TOT-LTD-IQEE (BEN)
214000031215  |                                     TO WS-BE-TOT-LTD-IQEE
214010031215  |               MOVE WS-BEN-AMT-TOT-YTD-IQEE (BEN)
214020031215  |                                     TO WS-BE-TOT-YTD-IQEE
214030031215  |           END-IF
214040031215  V
214050031215R83788     END-IF
214060031215R12784     END-SEARCH
214070031215      *** More than one record was found in account-beneficiary
214080031215      *** -financials file, therefore, go back to get next record.
214090130614           GO TO GB67-READBF-NEXT.
214100130614       BENEFICIARY-INFO-WRITE.
214110130614
214120130614           ADD 1 TO WS-BENEFICIARY67-CNT.
214130031215           INITIALIZE BENEFICIARY-INFORMATION.
214140031215
214150090505           MOVE PREV-INVESTOR          TO  BE-INVESTOR-NO.
214160090505           MOVE PREV-ACCOUNT           TO  BE-ACCOUNT.
214170090505           MOVE 67                     TO  BE-SECTION-NO.
214180090505           MOVE WS-BENEFICIARY67-CNT   TO  BE-SECTION-SEQUENCE.
214190090505           MOVE AD-LANGUAGE            TO  BE-LANGUAGE.
214200090505           MOVE AD-DEALER              TO  BE-DEALER.
214210090505           MOVE AD-SALESREP            TO  BE-SALESREP.
214220090505RF4638     MOVE BENEFICIARY-TYPE-CODE OF ACCOUNT-BENEFICIARY-SPLLB-REC
214230090505                                      TO BE-PRIMARY-CONTINGENT.
214240090505RF7523*** Put First name and Initial into BE-FIRST-NAME field.
214250031215117038     Move ABN-FIRST-NAME(WS-SQL-INDEX)  to BE-First-Name-Only.
214260031215117038     Move ABN-INITIALS(WS-SQL-INDEX)    to BE-Middle-Name-Only.
214270031215117038     Move ABN-LAST-NAME(WS-SQL-INDEX)   to BE-Last-Name-Only.
214280031215
214290031215           MOVE SPACES                 TO  WS-ADRTMP.
214300031215
21431003121566105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
21432003121566105      Set pb-adrName to True.
21433003121566105      Move ABN-FIRST-NAME(WS-SQL-INDEX)       to pc-InFirstName.
21434003121566105      Move ABN-INITIALS(WS-SQL-INDEX)         to pc-InInitial.
214350031215
21436003121566105      Call "FXSTRTADR" using pt-StreetAddressAction,
21437003121566105                             pt-StreetAddressIn,
21438003121566105                             pt-StreetAddressOut.
21439014070766105
21440014070766105      Move pc-OutName To WS-ADRTMP.
214410031215           MOVE WS-ADRTMP TO BE-FIRST-NAME.
214420031215           MOVE ABN-CONTRACT-DATE(WS-SQL-INDEX) TO BE-CONTRACT-DATE.
214430031215           MOVE ABN-SALUTATION-CODE(WS-SQL-INDEX)
214440031215                                                TO BE-SALUTATION-CODE.
214450031215           MOVE ABN-BENEFICIARY-TYPE(WS-SQL-INDEX) TO BE-BENE-TYPE.
214460031215           MOVE ABN-LAST-NAME(WS-SQL-INDEX) TO BE-LAST-NAME.
214470031215           MOVE ABN-REVOCABLE(WS-SQL-INDEX) TO BE-REVOCABLE.
214480150416           MOVE ABN-DATE-OF-BIRTH(WS-SQL-INDEX) TO BE-BIRTH-DATE.
214490031215           MOVE ABN-BENEFICIARY-TYPE-DESC(WS-SQL-INDEX)
214500080822                                      TO BE-BENE-TYPE-DESC.
214510080822           MOVE ABN-SOCIAL-INSURANCE-NO(WS-SQL-INDEX)
214520080822                                      TO BE-SOCIAL-INSURANCE-NO.
214530080822           MOVE ABN-BEN-RELATION-TYPE-DESCR(WS-SQL-INDEX)
214540080822                                      TO BE-BENE-RELATIONSHIP.
214550080822132121     MOVE ABN-BEN-PERCENT(WS-SQL-INDEX)
214560031215132121                                TO BE67-NON-RESP-ALLOC-PERCENT.
214570010919           MOVE ABN-SEX(WS-SQL-INDEX) TO BE-GENDER.
214580030324           MOVE ABN-CUSTODIAL-PARENT-NAME(WS-SQL-INDEX)
214590030324                                      TO BE-CUST-PARENT.
214600061003           MOVE ABN-LANGUAGE-CODE(WS-SQL-INDEX)
214610061003                                      TO BE-BENE-LANGUAGE.
214620030324           MOVE WS-PREV-START-DATE TO BE-START-DATE.
214630030324           MOVE PREV-END-DATE TO BE-END-DATE.
214640000419144030     PERFORM  PREPARE-SECTION67-NEW-FIELD.
214650030324R19502*** End
214660030324      **RFS46797 - Begin
214670061003           MOVE Abn-Beneficiary-Status(Ws-Sql-Index) TO Be-Status.
214680061003           MOVE "00"             TO Be-Acct-Type-Rule.
214690030324           MOVE Ws-At-Rule (AT1) TO lc-AccTypeRule2.
214700030324           MOVE li-AccTypeRule   TO Be-Acct-Type-Rule.
214710000419      **RFS46797 - End
214720030324
214730030324RF9318     MOVE WS-BEYTD-CONTRIBUTIONS TO  BE-YTD-CONTRIBUTIONS.
214740061003R16633     IF   WS-BEYTD-CONTRIBUTIONS IS  LESS THAN ZEROS
214750061003              MOVE "-"                 TO  BE-YTD-CONTRIBUTIONS-SIGN
214760030324R35540     ELSE
214770030324R35540        MOVE " "                 TO  BE-YTD-CONTRIBUTIONS-SIGN
214780000419R16633     END-IF.
214790030324
214800030324           MOVE WS-BELTD-CONTRIBUTIONS TO  BE-LTD-CONTRIBUTIONS.
214810061003R16633     IF   WS-BELTD-CONTRIBUTIONS IS  LESS THAN ZEROS
214820061003              MOVE "-"                 TO  BE-LTD-CONTRIBUTIONS-SIGN
214830030324R35540     ELSE
214840030324R35540        MOVE " "                 TO  BE-LTD-CONTRIBUTIONS-SIGN
214850000419R16633     END-IF.
214860030324
214870030324           MOVE WS-BEYTD-WITHDRAWLS    TO  BE-YTD-WITHDRAWLS.
214880061003R16633     IF   WS-BEYTD-WITHDRAWLS    IS  LESS THAN ZEROS
214890061003              MOVE "-"                 TO  BE-YTD-WITHDRAWLS-SIGN
214900030324R35540     ELSE
214910030324R35540        MOVE " "                 TO  BE-YTD-WITHDRAWLS-SIGN
214920000419R16633     END-IF.
214930030324
214940030324           MOVE WS-BELTD-WITHDRAWLS    TO  BE-LTD-WITHDRAWLS.
214950061003R16633     IF   WS-BELTD-WITHDRAWLS    IS  LESS THAN ZEROS
214960061003              MOVE "-"                 TO  BE-LTD-WITHDRAWLS-SIGN
214970030324R35540     ELSE
214980030324R35540        MOVE " "                 TO  BE-LTD-WITHDRAWLS-SIGN
214990001009R16633     END-IF.
215000030324
215010030324           MOVE WS-BEYTD-CESG          TO  BE-YTD-CESG.
215020061003R16633     IF   WS-BEYTD-CESG          IS  LESS THAN ZEROS
215030061003              MOVE "-"                 TO  BE-YTD-CESG-SIGN
215040030324R35540     ELSE
215050030324R35540        MOVE " "                 TO  BE-YTD-CESG-SIGN
215060001009R16633     END-IF.
215070030324
215080030324           MOVE WS-BELTD-CESG          TO  BE-LTD-CESG.
215090061003R16633     IF   WS-BELTD-CESG          IS  LESS THAN ZEROS
215100061003              MOVE "-"                 TO  BE-LTD-CESG-SIGN
215110030324R35540     ELSE
215120001009R35540        MOVE " "                 TO  BE-LTD-CESG-SIGN
215130030324R16633     END-IF.
215140030324
215150061003RF7778     MOVE WS-BEYTD-CAP-TRANSFERIN  TO  BE-YTD-CAP-TRANSFERS-IN.
215160061003R16633     IF WS-BEYTD-CAP-TRANSFERIN  IS  LESS THAN ZEROS
215170030324              MOVE "-"                 TO  BE-YTD-CAP-TRANSFERS-IN-SIGN
215180001009R35540     ELSE
215190030324R35540        MOVE " "                 TO  BE-YTD-CAP-TRANSFERS-IN-SIGN
215200030324R16633     END-IF.
215210061003
215220061003           MOVE WS-BELTD-CAP-TRANSFERIN  TO  BE-LTD-CAP-TRANSFERS-IN.
215230030324R16633     IF WS-BELTD-CAP-TRANSFERIN  IS  LESS THAN ZEROS
215240001009              MOVE "-"                 TO  BE-LTD-CAP-TRANSFERS-IN-SIGN
215250030324R35540     ELSE
215260030324R35540        MOVE " "                 TO  BE-LTD-CAP-TRANSFERS-IN-SIGN
215270061003R16633     END-IF.
215280061003           MOVE WS-BEYTD-INC-TRANSFERIN  TO  BE-YTD-INC-TRANSFERS-IN.
215290030324R16633     IF WS-BEYTD-INC-TRANSFERIN  IS  LESS THAN ZEROS
215300001009              MOVE "-"                 TO  BE-YTD-INC-TRANSFERS-IN-SIGN
215310030324R35540     ELSE
215320030324R35540        MOVE " "                 TO  BE-YTD-INC-TRANSFERS-IN-SIGN
215330061003R16633     END-IF.
215340061003           MOVE WS-BELTD-INC-TRANSFERIN  TO  BE-LTD-INC-TRANSFERS-IN.
215350030324R16633     IF WS-BELTD-INC-TRANSFERIN  IS  LESS THAN ZEROS
215360101104              MOVE "-"                 TO  BE-LTD-INC-TRANSFERS-IN-SIGN
215370101104R35540     ELSE
215380101104R35540        MOVE " "                 TO  BE-LTD-INC-TRANSFERS-IN-SIGN
215390101104R16633     END-IF.
215400101104           MOVE WS-BEYTD-CESG-TRANSFERIN TO  BE-YTD-CESG-TRANSFERS-IN.
215410101104R16633     IF WS-BEYTD-CESG-TRANSFERIN IS  LESS THAN ZEROS
215420101104              MOVE "-"                TO  BE-YTD-CESG-TRANSFERS-IN-SIGN
215430101104R35540     ELSE
215440101104R35540        MOVE " "                TO  BE-YTD-CESG-TRANSFERS-IN-SIGN
215450101104R16633     END-IF.
215460101104           MOVE WS-BELTD-CESG-TRANSFERIN TO  BE-LTD-CESG-TRANSFERS-IN.
215470101104R16633     IF WS-BELTD-CESG-TRANSFERIN IS  LESS THAN ZEROS
215480101104              MOVE "-"                TO  BE-LTD-CESG-TRANSFERS-IN-SIGN
215490101104R35540     ELSE
215500101104R35540        MOVE " "                TO  BE-LTD-CESG-TRANSFERS-IN-SIGN
215510101104R16633     END-IF.
215520101104R83788     MOVE WS-BE-TOT-LTD-CLB      TO  BE-LTD-CLB.
215530101104  |        IF   WS-BE-TOT-LTD-CLB      IS  LESS THAN ZEROS
215540101104  |           MOVE "-"                 TO  BE-LTD-CLB-SIGN
215550101104  |        END-IF.
215560101104  |        MOVE WS-BE-TOT-YTD-CLB      TO  BE-YTD-CLB.
215570101104  |        IF   WS-BE-TOT-YTD-CLB      IS  LESS THAN ZEROS
215580101104  |           MOVE "-"                 TO  BE-YTD-CLB-SIGN
215590101104  |        END-IF.
215600101104  |        MOVE WS-BE-TOT-LTD-PGRANT   TO  BE-LTD-PGRANT.
215610101104  |        IF   WS-BE-TOT-LTD-PGRANT   IS  LESS THAN ZEROS
215620101104  |           MOVE "-"                 TO  BE-LTD-PGRANT-SIGN
215630101104  |        END-IF.
215640101104  |        MOVE WS-BE-TOT-YTD-PGRANT   TO  BE-YTD-PGRANT.
215650101104  |        IF   WS-BE-TOT-YTD-PGRANT   IS  LESS THAN ZEROS
215660101104  |           MOVE "-"                 TO  BE-YTD-PGRANT-SIGN
215670101104  |        END-IF.
215680101104  |        MOVE WS-BE-TOT-LTD-IQEE     TO  BE-LTD-IQEE.
215690101104  |        IF   WS-BE-TOT-LTD-IQEE     IS  LESS THAN ZEROS
215700101104  |           MOVE "-"                 TO  BE-LTD-IQEE-SIGN
215710101104  |        END-IF.
215720101104  |        MOVE WS-BE-TOT-YTD-IQEE     TO  BE-YTD-IQEE.
215730101104  |        IF   WS-BE-TOT-YTD-IQEE     IS  LESS THAN ZEROS
215740101104  |           MOVE "-"                 TO  BE-YTD-IQEE-SIGN
215750101104  |        END-IF.
215760140806  |        COMPUTE WS-BE-TOT-LTD-MONEY = WS-BELTD-CESG
215770140806  |                                    + WS-BE-TOT-LTD-CLB
215780140806  |                                    + WS-BE-TOT-LTD-PGRANT
215790140806  |                                    + WS-BE-TOT-LTD-IQEE.
215800140806  |        COMPUTE WS-BE-TOT-YTD-MONEY = WS-BEYTD-CESG
215810140806  |                                    + WS-BE-TOT-YTD-CLB
215820140806  |                                    + WS-BE-TOT-YTD-PGRANT
215830140806  |                                    + WS-BE-TOT-YTD-IQEE.
215840140806  |        MOVE WS-BE-TOT-LTD-MONEY    TO  BE-LTD-TOTAL-GRANT-MONEY.
215850140806  |        IF   WS-BE-TOT-LTD-MONEY    IS  LESS THAN ZEROS
215860140806  |           MOVE "-"                 TO  BE-LTD-TOTAL-GRANT-MONEY-SIGN
215870140806  |        END-IF.
215880140806  |        MOVE WS-BE-TOT-YTD-MONEY    TO  BE-YTD-TOTAL-GRANT-MONEY.
215890140806  |        IF   WS-BE-TOT-YTD-MONEY    IS  LESS THAN ZEROS
215900140806  V           MOVE "-"                 TO  BE-YTD-TOTAL-GRANT-MONEY-SIGN
215910140806R83788     END-IF.
215920160201133489     MOVE WS-BEYTD-EAP           TO  BE-YTD-EAP.
215930160201  |        IF   WS-BEYTD-EAP           IS  LESS THAN ZEROS
215940160201  |           MOVE "-"                 TO  BE-YTD-EAP-SIGN
215950020321  |        END-IF.
215960000417  |        MOVE WS-BELTD-EAP           TO  BE-LTD-EAP.
215970000417  |        IF   WS-BELTD-EAP           IS  LESS THAN ZEROS
215980060621  |           MOVE "-"                 TO  BE-LTD-EAP-SIGN
215990030825  |        END-IF.
216000000417  |        MOVE WS-BEYTD-PSE           TO  BE-YTD-PSE.
216010031215  |        IF   WS-BEYTD-PSE           IS  LESS THAN ZEROS
216020031215  |           MOVE "-"                 TO  BE-YTD-PSE-SIGN
216030031215  |        END-IF.
216040031215  |        MOVE WS-BELTD-PSE           TO  BE-LTD-PSE.
216050031215  |        IF   WS-BELTD-PSE           IS  LESS THAN ZEROS
216060031215  V           MOVE "-"                 TO  BE-LTD-PSE-SIGN
216070031215133489     END-IF.
216080031215148326     MOVE WS-BELTD-CEAP          TO  BE-LTD-CESG-EAP.
216090031215  |        IF   WS-BELTD-CEAP          IS  LESS THAN ZEROS
216100031215148326        MOVE "-"                 TO  BE-LTD-CESG-EAP-SIGN.
216110031215           MOVE WS-PREV-START-DATE        TO  BE-START-DATE.
216120031215           MOVE PREV-END-DATE          TO  BE-END-DATE.
216130031215
216140031215R18147     MOVE BENEFICIARY-INFORMATION TO STATEMENT-REC(ISR).
216150031215R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
216160031215
216170031215R19502*** Start
216180000417       GB67-WS-SQL-INDEX-CHK.
216190150731           IF WS-SQL-INDEX < WS-SQL-ACTUAL
216200000417              GO TO GB67-INCREMENT-WS-SQL-INDEX
216210000417           END-IF.
216220000417
216230031006           IF WS-SQL-ACTUAL = ACCBENMAX
216240001019              GO TO GB67-GET-ACCOUNT-BENEFICIARY
216250001016           END-IF.
216260001016
216270001016       GB67-CLOSE-ACCBENC1.
216280001019           MOVE "CLOSE ACCBENC1 GB67" TO WS-SQLERR-STATEMENT.
216290001016           EXEC SQL
216300001016             CLOSE ACCBENC1
216310001017           END-EXEC.
216320001017
216330001017R19502*** End
216340001025       GB67-EXIT.
216350001025149292      PERFORM NEW-CURSOR-ACCBENC2 THRU NB67-EXIT.
216360070517            EXIT.
216370070517
216380130203      **********
216381211003      *RFS186592 Starts*
216382211003       GET-RESET-LEVEL-P.
216383211003
216384211003            MOVE "GET RESET LEVEL P GDV" TO  WS-SQLERR-STATEMENT.
216385211003            INITIALIZE lc_GuarResetLevelGDV
216386211003                       lc_GuarResetLevelGBV.
216387211003            MOVE WS-LDA-STRDTE TO ln-Lda-Strdte-S90.
216388211003            MOVE WS-LDA-ENDDTE TO ln-Lda-Enddte-S90.
216389211003
216390211003            EXEC SQL
216391211003              SELECT GDTHCSP.RESET_LEVEL
216392211003              INTO :lc_GuarResetLevelGDV
216393211003              FROM MFAACCCRP ACCCRP
216394211003              INNER JOIN MFAACCCIRP ACCCIRP ON
216395211003                  ACCCRP.ACCOUNT_NO = ACCCIRP.ACCOUNT_NO
216396211003              AND ACCCRP.CONTRACT_NO = ACCCIRP.CONTRACT_NO
216397211003              AND ACCCRP.RESET_NUMBER = ACCCIRP.RESET_NUMBER
216398211003              INNER JOIN MFAINVSGP INVSGP ON
216399211003                  INVSGP.INVESTMENT_CODE = ACCCIRP.INVESTMENT_CODE
216400211003              INNER JOIN MFAGDTHCSP GDTHCSP ON
216401211003                  GDTHCSP.GDV_SCHED_CODE = INVSGP.GDV_SCHED_CODE
216402211003              WHERE ACCCRP.ACCOUNT_NO = :WS-ACCOUNT-NO
216403211003                    AND ACCCRP.EFFECT_DATE >= :ln-Lda-Strdte-S90
216404211003                    AND ACCCRP.EFFECT_DATE <= :ln-Lda-Enddte-S90
216405211003                    AND ACCCRP.REVERSED    <> "Y"
216406211003                    AND ACCCRP.RESET_TYPE = "GDV"
216407211003                    AND GDTHCSP.RESET_LEVEL = "P"
216408211003              FETCH FIRST ROW ONLY
216409211003            END-EXEC.
216410211003
216411211003            MOVE "GET RESET LEVEL P GBV" TO  WS-SQLERR-STATEMENT.
216412211003            EXEC SQL
216413211003              SELECT GDTHCSP.RESET_LEVEL
216414211003              INTO :lc_GuarResetLevelGBV
216415211003              FROM MFAACCCRP ACCCRP
216416211003              INNER JOIN MFAACCCIRP ACCCIRP ON
216417211003                  ACCCRP.ACCOUNT_NO = ACCCIRP.ACCOUNT_NO
216418211003              AND ACCCRP.CONTRACT_NO = ACCCIRP.CONTRACT_NO
216419211003              AND ACCCRP.RESET_NUMBER = ACCCIRP.RESET_NUMBER
216420211003              INNER JOIN MFAINVSGP INVSGP ON
216421211003                  INVSGP.INVESTMENT_CODE = ACCCIRP.INVESTMENT_CODE
216422211003              INNER JOIN MFAGDTHCSP GDTHCSP ON
216423211003                  GDTHCSP.GDV_SCHED_CODE = INVSGP.GDV_SCHED_CODE
216424211003              WHERE ACCCRP.ACCOUNT_NO = :WS-ACCOUNT-NO
216425211003                    AND ACCCRP.EFFECT_DATE >= :ln-Lda-Strdte-S90
216426211003                    AND ACCCRP.EFFECT_DATE <= :ln-Lda-Enddte-S90
216427211003                    AND ACCCRP.REVERSED    <> "Y"
216428211003                    AND ACCCRP.RESET_TYPE = "GBV"
216429211003                    AND GDTHCSP.RESET_LEVEL = "P"
216430211003              FETCH FIRST ROW ONLY
216431211003            END-EXEC.
216432211003
216433211003      *RFS186592 Ends*
216463070517
216464001016RF4638***** POPULATE SEG-FUND-INVESTMENT-DETAILS(SECTION 43).
216465001018      ***** First get data from ACCOUNT-CONTRACT(MFAACCONP), then
216466151202      ***** get data from ACCOUNT-CONTRACT-INVESTMENT(MFAACCCIP).
216467001018
216468130614       POPULATE-SEG-FUND-INV-ROUTINE.
216469130614
216470130614           INITIALIZE  MFAACCONP
216471130614                       MFAACCCIP
216480130614                       MFAINVSGP
216490130614                       MFAGMATVP
216500130614                       MFAGDTHVP
216510001020                       MFAALWRSTP.
216520031015
216530001016      * RFS 38639 - begins.
216540001016118007***  INITIALIZE  li_Seq_No_Cnt.
216550001016      * RFS 38639 - ends.
216560001016
216570001019           INITIALIZE WS-SEG-FUND-SECTIONS.
216580001016151412     INITIALIZE li_PrevContract.
216581211011      *RFS186592 STarts*
216582210917           INITIALIZE ln_AccResetLvlCnt
216583210917                      ln_SectionSeqNoAR
216584210917                      ln_GDV-EffectiveDate
216585211011                      ln_GBV-EffectiveDate
216586211011                      WS-ACCRESET-ARRAY.
216597211011      *RFS186592 Ends*
216598001016
216600001019117038* QC32062 - Start (Create section 45 only once - Account level)
216610001016117038     IF Ws-LDA-Seg-45  = "Y" AND
216620001016117038        Ws-LDA-Pos-509 = "Y"
216630001016117038        PERFORM Populate-Acct-Ann-routine
216640001019117038     END-IF.
216650001016117038* QC32062 - End
216660001016
216670001016           MOVE PREV-ACCOUNT TO ACCOUNT-NO OF ACCOUNT-CONTRACT-REC.
216680001020R17860     MOVE ZEROS TO DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT-REC.
216690001019
216700001016           START ACCOUNT-CONTRACT
216710151202               KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
216720151202               INVALID KEY
216730151202                  GO TO PSFIR-EXIT
216740151202           END-START.
216750151202
216760151202       PSFIR-READ-CONTRACT-NEXT.
216770001016
216780041005           READ ACCOUNT-CONTRACT NEXT RECORD
216790041007               AT END
216791210917      *RFS186592 STarts*
216792210917                  IF ln_AccResetLvlCnt > 0
216793210917                     PERFORM PROCESS-ACCOUNT-RESET-LEVEL
216794210917                  END-IF
216795210917      *RFS186592 Ends*
216800041007                  GO TO PSFIR-EXIT
216810041007           END-READ.
216820151202
216830141219           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
216840141219                         IS NOT EQUAL TO  PREV-ACCOUNT
216841210917      *RFS186592 STarts*
216842210917                  IF ln_AccResetLvlCnt > 0
216843210917                     PERFORM PROCESS-ACCOUNT-RESET-LEVEL
216844210917                  END-IF
216845210917      *RFS186592 Ends*
216850141219                  GO TO PSFIR-EXIT
216860141219           END-IF.
216870141219      *RFS151412 -START
216880141219           IF CONTRACT-NO OF ACCOUNT-CONTRACT-REC
216890141219                         IS NOT EQUAL TO  li_PrevContract
216900141219              SET lb_NewLWAContractYes TO TRUE
216910141219           END-IF.
216920141219      *RFS151412 -END
216930141219
216940141219R22856     MOVE GUARANTEE-DTH-PERCENT OF ACCOUNT-CONTRACT-REC
216950141219   ¦                                  TO WS-GUARANTEE-DTH-PERCENT.
216960141219R22856     MOVE CONTRACT-NO           OF ACCOUNT-CONTRACT-REC
216970141219                                      TO WS-CONTRACT-NO.
216980141219151412     MOVE WS-CONTRACT-NO TO li_PrevContract.
216990141219      *RFS138172 - Starts
217000141219           INITIALIZE lc_GuarMatSchedCode
217010141219                      lc_MaturityRule
217020141219                      li_StartDate
217030190919                      lc_AcctTypeCode.
217040200109183449*    MOVE AD-ACCOUNT-TYPE-SHORT TO lc_AcctTypeCode.
217050200109      *RFS1021216-Starts
217060200109183449*    MOVE ACACTYP               TO lc_AcctTypeCode.
217070200109           MOVE PREV-ACCOUNT-TYPE     TO lc_AcctTypeCode.
217080141219      *RFS1021216-Ends
217090141219           MOVE START-DATE OF ACCOUNT-CONTRACT-REC
217100141219                        TO  li_StartDate.
217110141219           EXEC SQL
217120141219             SELECT COALESCE(Invsgp.Guar_Mat_Sched_Code, :lncc_Spaces)
217130141219               INTO :lc_GuarMatSchedCode
217140141219               FROM Mfaacccip Acccip
217150141219               INNER JOIN Mfainvsgp Invsgp
217160141219               ON   Invsgp.Investment_Code = Acccip.Investment_Code
217170141219              WHERE Acccip.Account_No = :WS-ACCOUNT-NO              AND
217180141219                    Acccip.Contract_No = :WS-CONTRACT-NO
217190141219              FETCH FIRST ROW ONLY
217200141219           END-EXEC.
217210141219           MOVE SQLSTATE   TO lc_sqlStates
217220141219           IF lncc_sqlSuccessful OR lncc_sqlEnd
217230141219                CONTINUE
217240141219           ELSE
217250141219           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
217260141219                GO TO SQLLOG
217270141219           END-IF.
217280141219
217290141219           EXEC SQL
217300141219             SELECT MATURITY_RULE
217310141219              INTO :lc_MaturityRule
217320141219              FROM MFAGMATVP
217330141219             WHERE Guar_Mat_Sched_Code = :lc_GuarMatSchedCode      AND
217340141219                   Start_Date <= :li_StartDate                     AND
217350141219                   End_Date >= :li_StartDate                       AND
217360141219138172*            Account_Type_Code = :lc-AccountTypeCode         AND
217370141219                   Account_Type_Code = :lc_AcctTypeCode            AND
217380120627                   (Years_To_Maturity <> 0                         OR
217390120627                    Years_To_Maturity = 0 )                        AND
217400141219                   ((MATURITY_RULE = "CMD")                        OR
217410141219                    (MATURITY_RULE = "DMD"))
217420141219              ORDER BY Age_Threshold
217430141219              FETCH FIRST ROW ONLY
217440141219           END-EXEC.
217450141219
217460141219           MOVE SQLSTATE   TO lc_sqlStates
217470141219           IF lncc_sqlSuccessful OR lncc_sqlEnd
217480141219                CONTINUE
217490141219           ELSE
217500141219           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
217510141219                GO TO SQLLOG
217520141219           END-IF.
217530141219      *RFS138172 - Ends
217540141219109016           MOVE START-DATE OF ACCOUNT-CONTRACT-REC
217550141219  |                           TO  ld_ContractStartDate.
217560141219      *RFS138172 - Begins
217570050201      * change this line to allow specific clients
217580050201      * which does not use the Original CMD.
217590100308           IF lc_MaturityRule = "CMD" AND
217600050201                   ORIGINAL-CMD OF ACCOUNT-CONTRACT-REC > 0
217610050201                 MOVE ORIGINAL-CMD OF ACCOUNT-CONTRACT-REC
217620050201                              TO  ld_ContractMaturityDate
217630050201            ELSE IF lc_MaturityRule = "DMD"
217640050201                 MOVE DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT-REC
217650050201                              TO  ld_ContractMaturityDate
217660050201           ELSE
217670050201  |   *          MOVE MATURITY-DATE OF ACCOUNT-CONTRACT-REC
217680050201109016*                       TO  ld_ContractMaturityDate.
217690050201                 MOVE MATURITY-DATE OF ACCOUNT-CONTRACT-REC
217700050201                              TO  ld_ContractMaturityDate
217710050201           END-IF.
217720050201      *RFS138172 - Ends
217730050201R24679 PSFIR-ANNUITANT-DOB-START.
217740050201   ¦       INITIALIZE  MFAACCANP
217750050201   ¦                   MFAACCNNP.
217760050201   ¦       MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-REC  TO ACCOUNT-NO
217770050201   ¦                        OF ACCOUNT-CONTRACT-ANN-REC.
217780050201   ¦       MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC  TO CONTRACT-NO
217790050201   ¦                        OF ACCOUNT-CONTRACT-ANN-REC.
217800050201   ¦       MOVE ZEROS       TO ANNUITANT-SEQ-NO
217810050201   ¦                        OF ACCOUNT-CONTRACT-ANN-REC.
217820050201   ¦       START ACCOUNT-CONTRACT-ANNUITANT
217830050201   ¦           KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
217840050201   ¦           INVALID KEY
217850050201   ¦           INITIALIZE  MFAACCANP
217860050201   ¦              GO TO PSFIR-ANNUITANT-DOB-PROCESS
217870050201   ¦       END-START.
217880050201   ¦   PSFIR-READ-ACC-CON-ANN-NEXT.
217890050201   ¦       READ ACCOUNT-CONTRACT-ANNUITANT NEXT
217900050201   ¦           AT END
217910050201   ¦              INITIALIZE  MFAACCANP
217920050201   ¦              GO TO PSFIR-ANNUITANT-DOB-PROCESS
217930050201   ¦       END-READ.
217940050201   ¦       IF ACCOUNT-NO OF ACCOUNT-CONTRACT-ANN-REC IS NOT EQUAL TO
217950050201   ¦                           ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
217960050201   ¦       OR CONTRACT-NO OF ACCOUNT-CONTRACT-ANN-REC IS NOT EQUAL TO
217970050201   ¦                          CONTRACT-NO OF ACCOUNT-CONTRACT-REC
217980050201   ¦          GO TO PSFIR-ANNUITANT-DOB-PROCESS
217990050201   ¦       END-IF.
218000050201   ¦       IF ANNUITANT-TYPE-CODE OF ACCOUNT-CONTRACT-ANN-REC
218010050201   ¦                                        IS NOT EQUAL TO "P"
218020050201   ¦          GO TO PSFIR-READ-ACC-CON-ANN-NEXT
218030050201   ¦       END-IF.
218040080721   ¦  ***** Get data from ACCOUNT-ANUUITANT(MFAACCNNP) file.
218050080721   ¦  ***** The same Contract-number from ACCOUNT-CONTRACT-ANNUITANT
218060080721   ¦  ***** (MFAACCANP) may have multiple records.   .
218070080721   ¦
218080080721   ¦       INITIALIZE MFAACCNNP.
218090080721   ¦       MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-ANN-REC
218100050201   ¦                        TO ACCOUNT-NO OF ACCOUNT-ANNUITANT-REC.
218110050201   ¦       MOVE ANNUITANT-SEQ-NO OF ACCOUNT-CONTRACT-ANN-REC
218120050201   ¦                   TO ANNUITANT-SEQ-NO OF ACCOUNT-ANNUITANT-REC.
218130050201   ¦   PSFIR-READ-ACC-ANN-NEXT.
218140050201   ¦       READ ACCOUNT-ANNUITANT
218150020408   ¦           INVALID KEY
218160020408   ¦              INITIALIZE MFAACCNNP
218170020408   ¦              GO TO PSFIR-READ-ACC-CON-ANN-NEXT
218180020408   ¦       END-READ.
218190020426   ¦   PSFIR-ANNUITANT-DOB-PROCESS.
21820007072452779      PERFORM GetYoungerAnnuitantDOB.
218210091027  |        IF pb_RetriveYes
218220091027  |           COMPUTE Ws-Calc-DOB = pi_DateOfBirth
218230091027  |        ELSE
218240091027  |           COMPUTE Ws-Calc-DOB = 0
21825009102752779      END-IF.
218260091027   ¦       SUBTRACT WS-CALC-DOB-CCYY  FROM    WS-LDA-ENDDTE-CCYY
218270091027   ¦                                  GIVING  WS-SEG-AGE.
218280091027   ¦       IF WS-CALC-DOB-MMDD IS GREATER THAN WS-LDA-ENDDTE-MMDD
218290091027   v          SUBTRACT 1              FROM WS-SEG-AGE
218300091027R24679     END-IF
218310091027R12734* For every contract in the account, this flag needs to be set
218320091027R12734* to 'Y' to trigger the calling NEW TRCODCALC that will recalculate
218330091027R12734* the GBV of the contract at end date.
218340091027R12734     MOVE "Y" TO WS-FIRST-PASS-FLAG.
218350091027R13184     MOVE "Y" TO WS-FIRST-PASSO-FLAG.
218360091027R37906     MOVE "Y" TO WS-FIRST-PASSG-FLAG.
218370091027R74979*********** The following lines were repalced by SQL in rfs74979
218380091027  ]   ***** Read ALLOWABLE-RESET-SCHED (MFAALWRSTP) using
218390091027  ]   ***** AD-ACCOUNT-TYPE-SHORT as the key to get NO-OF-RESETS
218400091027  ]   ***** value.
218410091027  ]
218420091027  ]   *     MOVE AD-ACCOUNT-TYPE-SHORT   TO ACCOUNT-TYPE-CODE
218430091027  ]   *                               OF ALLOWABLE-RESET-SCHED-REC.
218440091027  ]   *     MOVE ZEROS  TO START-DATE OF ALLOWABLE-RESET-SCHED-REC.
218450091027  ]   *     MOVE ZEROS  TO END-DATE   OF ALLOWABLE-RESET-SCHED-REC.
218460091027  ]   *
218470091027  ]   *     START ALLOWABLE-RESET-SCHED
218480091027  ]   *        KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
218490091027  ]   *           INVALID KEY
218500091027  ]   *             INITIALIZE ALLOWABLE-RESET-SCHED-REC
218510091027  ]   *             MOVE ZEROS TO
218520010323  ]   *                  NO-OF-RESETS OF ALLOWABLE-RESET-SCHED-REC
218530001016  ]   *             GO TO PSFIR-START-ACC-CONTRACT-INV
218540001016  ]   *     END-START.
218550001016  ]   *
218560001016  ]   *PSFIR-READ-ALLOWABLE-RESET.
218570001016  ]   *
218580001016  ]   *     READ ALLOWABLE-RESET-SCHED NEXT RECORD
218590001016  ]   *          AT END
218600001016  ]   *          INITIALIZE ALLOWABLE-RESET-SCHED-REC
218610110601  ]   *     END-READ
218620001016  ]   *
218630001016  ]   *     IF ACCOUNT-TYPE-CODE OF ALLOWABLE-RESET-SCHED-REC
218640001016  ]   *                  IS NOT EQUAL TO  AD-ACCOUNT-TYPE-SHORT
218650001020  ]   *        MOVE ZEROS  TO NO-OF-RESETS OF ALLOWABLE-RESET-SCHED-REC
218660001016  V   *     END-IF.
218670001019R74979************* The above lines were repalced by SQL in rfs74979
218680001016       PSFIR-START-ACC-CONTRACT-INV.
218690001016      ***** Get data from ACCOUNT-CONTRACT-INVESTMENT(MFAACCCIP) file.
218700070430      ***** The same Contract-number from ACCOUNT-CONTRACT(MFAACCONP)
218710070430      ***** may have multiple Investments.
218720110601           MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-REC
218730070430                            TO ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC.
218740070501           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
218750070430                            TO CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC.
218760070430           MOVE SPACES  TO INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC.
218770011024R63488     PERFORM Check-Inv-GLWB Thru CIGLWB-EXIT.
218780001016           START ACCOUNT-CONTRACT-INVESTMENT
218790001016               KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
218800001016               INVALID KEY
218810001016                  GO TO PSFIR-READ-CONTRACT-NEXT
218820001016           END-START.
218830070430       PSFIR-READ-CONTRACT-INV-NEXT.
218840070430           READ ACCOUNT-CONTRACT-INVESTMENT NEXT RECORD
218850110601               AT END
218860070430      * RFS 38639 - begins.
218870070501                  IF Edit-GbvRst
218880070430R63488            OR GLWB-Yes
218890070430                     PERFORM Process_Tmp_Stm_Extract
218900001024                     PERFORM Clear_Tmp_Stm_Extract
218910001016                  END-IF
218920050104      * RFS 38639 - ends.
218930050104R11889        GO TO PSFIR-WRITE-SECTION-40
218940050104           END-READ.
218950050104           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC IS NOT EQUAL TO
218960040420                         ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
218970040420           OR CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC IS NOT EQUAL TO
218980040420                         CONTRACT-NO OF ACCOUNT-CONTRACT-REC
218990040420      * RFS 38639 - begins.
219000040420              IF Edit-GbvRst
219010040420R63488        OR GLWB-Yes
219020040420                 PERFORM Process_Tmp_Stm_Extract
219030040420                 PERFORM Clear_Tmp_Stm_Extract
219040040420              END-IF
219050040420      * RFS 38639 - ends.
219060040420001024        GO TO PSFIR-WRITE-SECTION-40
219070040420           END-IF.
219080040420R24782     IF CREATION-DATE OF ACCOUNT-CONTRACT-INV-REC
219090040420   ¦                     IS GREATER THAN WS-LDA-ENDDTE
219100040420   v          GO TO PSFIR-READ-CONTRACT-INV-NEXT
219110040420R24782     END-IF.
219120040420R21337     IF WS-LDA-INVESTMENT-STRUCTURE  IS NOT EQUAL TO  SPACES
219130040420   ¦          SET ISC TO 1
219140091030   ¦          SEARCH WS-INVSTR-ENT    VARYING ISC
219150091030   ¦              AT END
219160091030   ¦                 GO TO PSFIR-READ-CONTRACT-NEXT
219170091030   ¦              WHEN INVESTMENT-CODE  OF ACCOUNT-CONTRACT-INV-REC
219180091030   ¦                            IS EQUAL TO  WS-ISC-INVCODE (ISC)
219190091030   ¦              IF CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC
219200091030   ¦                      IS NOT EQUAL TO
219210091030   ¦                        CONTRACT-NO OF ACCOUNT-CONTRACT-REC
219220091030   ¦                 GO TO PSFIR-READ-CONTRACT-NEXT
219230091030   ¦              ELSE
219240091030   ¦                 GO TO PSFIR-READ-CONTRACT-INV-CON
219250091030   ¦              END-IF
219260091030   ¦          END-SEARCH
219270091030   ¦       END-IF.
219280091030   v
219290091030R21337 PSFIR-READ-CONTRACT-INV-CON.
219300091030R74979****** Please note: rfs74979 Start *****************************
219310091030R74979****** The processes of INVESTMENT-SEG,
219320091030      *****      GUARANTEED-MATURITY-VALUE-SCHED and
219330091030      *****      GUARANTEED-DEATH-VALUE-SCHED files.
219340091030      *****  were moved UP before Section 90 was created.
219350091030      *****  Before rfs74979, this part was executed after the
219360091030      *****  PERFORM GET-SEGFUND-UNIT-PRICE  THRU GSFUP-EXIT.
219370091030      ***** Read INVESTMENT-SEG(MFAINVSGP) to get GUAR-MAT-SCHED-CODE
219380091030      ***** and GUAR-DEATH-SCHED-CODE.
219390091030       PSFIR-GET-INVESTMENT-SEG.
219400190919R64262     Initialize Ld-AutoResetSchDates.
219410190919      *RFS183449 - Begin
219420200303R64262*    MOVE AD-ACCOUNT-TYPE-SHORT      TO Lc-AccountTypeCode.
219430200303      *RFS 1027770 - Begin
219440200303      *    MOVE ACACTYP                    TO Lc-AccountTypeCode.
219450200303           MOVE PREV-ACCOUNT-TYPE          TO Lc-AccountTypeCode.
219460190919      *RFS 1027770 - End
219470091030      *RFS183449 - End
219480091030           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
219490091030                            TO INVESTMENT-CODE OF INVESTMENT-SEG-REC.
219500091030           READ INVESTMENT-SEG
219510091030                INVALID KEY
219520091030R74979            Initialize INVESTMENT-SEG-REC
219530091030                  MOVE SPACES    TO INVESTMENT-CODE
219540091030R21337                           OF INVESTMENT-SEG-REC
219550091030           END-READ.
219560091030      *RFS47406 Start
219570121207           IF INVESTMENT-CODE OF INVESTMENT-SEG-REC NOT = SPACE
219580121207              MOVE INVESTMENT-SERIES OF INVESTMENT-SEG-REC
219590091030                TO lc_InvestmentSeries
219600121206           ELSE
219610121206              MOVE SPACE TO lc_InvestmentSeries.
219620091030      *RFS47406 End
219630091030R64262     MOVE GDV-SCHED-CODE OF INVESTMENT-SEG-REC
219640091030                            TO Lc-AutoResetSchCode.
219650091030R74979     MOVE RESET-SCHEDULE-CODE OF INVESTMENT-SEG-REC
219660091030  ]                                    TO Lc-ResetSchCode.
219670091030  ]
219680091030  ]        MOVE AD-START-DATE          TO Ld_StartDateRst.
219690091030  ]        MOVE AD-END-DATE            TO Ld_EndDateRst.
219700091030  ]
219710121130  ]        EXEC SQL
219720121130  ]             SELECT COALESCE(NO_OF_RESETS, 0)
219730121130117144                ,COALESCE(Multi_Type_Rule, " ")
219740121130117144                ,COALESCE(Reset_Type, " ")
219750121130  ]             INTO  :Ld_NoOfResets
219760121130117144               ,:lc_MultiTypeRule
219770121130117144               ,:lc_ResetType
219780001020  ]             FROM MFAALWRSTP
219790001016  ]             WHERE ACCOUNT_TYPE_CODE   = :Lc-AccountTypeCode
219800001019  ]               AND START_DATE         <= :Ld_StartDateRst
219810001019  ]               AND END_DATE           >= :Ld_EndDateRst
219820200728  V               AND RESET_SCHEDULE_CODE = :Lc-ResetSchCode
219830201127      *RFS1105599-Start.
219840201127185176*            AND RESET_TYPE          = :lncc_GBV
219850201127                   AND RESET_TYPE         <> :lncc_COG
219860201127      *RFS1105599-End.
219870001019R74979     END-EXEC.
219880001019
219890001019      ***** Read GUARANTEED-MATURITY-VALUE-SCHED and
219900001019      *****      GUARANTEED-DEATH-VALUE-SCHED files.
219910001019      * RFS 116957 Starts
219920001019      * Below lines to claculate GMV , GDV are moved to copybook.
219930001019           EXEC SQL
219940001016             INCLUDE CPYSTMTGMV
219950001016           END-EXEC.
219960001019      * RFS 116957 Ends
219970001019
219980001019       PSFIR-WRITE-SECTION-43.
219990001019
220000001019           ADD 1                       TO  WS-ACC-SEG43-COUNT.
220010001019           INITIALIZE SEG-FUND-CONTRACT-INVESTMENT.
220020001019
220030001019           MOVE AD-INVESTOR-NO         TO CI-INVESTOR-NO.
220040001019           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC  TO CI-ACCOUNT.
220050001019           MOVE "43"                   TO CI-SECTION-NO.
220060001016           MOVE WS-ACC-SEG43-COUNT     TO CI-SECTION-SEQUENCE.
220070001019           MOVE AD-LANGUAGE            TO CI-LANGUAGE.
220080001016           MOVE AD-DEALER              TO CI-DEALER.
220090001019           MOVE AD-SALESREP            TO CI-SALESREP.
220100001018
220110001019           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
220120001016                                       TO CI-CONTRACT-NO.
220130001019
220140091027           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
220150091027                                       TO CI-INVESTMENT-CODE.
220160001016           IF CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
220170001019                                       IS NOT EQUAL TO SPACES
220180091029              MOVE CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
220190091029                                       TO CI-CONTRACT-XREF
220200001025           END-IF
220210001019
220220001019           MOVE START-DATE    OF ACCOUNT-CONTRACT-REC
220230001019                                       TO CI-START-DATE1.
220240001019           MOVE MATURITY-DATE OF ACCOUNT-CONTRACT-REC
220250001024                                       TO CI-MATURITY-DATE.
220260001019           MOVE DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT-REC
220270001019                                       TO CI-DEPOSIT-MATURITY-DATE.
220280001019           MOVE DEPOSIT-RENEWAL-DATE OF ACCOUNT-CONTRACT-REC
220290001019                                       TO CI-DEPOSIT-RENEWAL-DATE.
220300020417R74979*    MOVE NO-OF-RESETS           OF ALLOWABLE-RESET-SCHED-REC
220310020417R74979     MOVE Ld_NoOfResets          TO CI-RESETS-ALLOWED.
220320120301           MOVE NO-OF-RESETS-REMAINING OF ACCOUNT-CONTRACT-REC
220330120301                                       TO CI-RESETS-REMAINING.
220340120301R74979*    COMPUTE CD-RESETS-EXCERCISED  = CI-RESETS-ALLOWED
220350120301R74979     COMPUTE CI-RESETS-EXCERCISED  = CI-RESETS-ALLOWED
220360120301                                         - CI-RESETS-REMAINING.
220370120301           MOVE WS-GUAR-BASE-VALUE     TO CI-GUARANTEED-BASE-VALUE.
220380120301           MOVE WS-GUAR-MATURITY-VAL   TO CI-GUARANTEED-MATURITY-VALUE.
220390120301           MOVE WS-GUAR-DEATH-VAL      TO CI-GUARANTEED-DEATH-VALUE.
220400120301           MOVE WS-NET-DEPOSIT-VALUE   TO CI-NET-DEPOSIT-VALUE.
220410120301           MOVE WS-CI-UNITS-TEMP       TO CI-UNITS.
220420120301           COMPUTE CI-MARKET-VALUE ROUNDED  = CI-UNITS
220430110907                                            * UNIT-PRICE OF
220440120301                                              INVESTMENT-PRICE-REC.
220450110907
220460110907R13184     ADD  CI-MARKET-VALUE        TO WS-CONTRACT-MARKET-VALUE.
220470110907
220480110907      * rfs103804 starts
220490110907              move CI-INVESTMENT-CODE       to lc_InvestmentCode.
220500110907              MOVE SPACE                    TO lc_InvSeries
220510110907              EXEC SQL
220520120301                SELECT INVESTMENT_SERIES
220530120301                  INTO :lc_InvSeries
220540120301                  FROM MFAINVSGP
220550140619                 WHERE INVESTMENT_CODE = :lc_InvestmentCode
220560140619              END-EXEC
220570120301      * rfs103804 ends
220580140619
220590140619      * rfs96081 starts
220600140619103804     move spaces TO lc_EWAFlag.
220610140619           EXEC SQL
220620140619              Select Coalesce(SUBSTR(Series_Rules, 81, 1), " ")
220630140619              INTO :lc_EWAFlag
220640140619              FROM MFASERRLP
220650140619              WHERE INVESTMENT_SERIES  = :lc_InvSeries
220660140619           END-EXEC.
220670140619
220680120301      * RFS104483 starts
220690120301           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC TO lc_Account-No
220700120301           MOVE SPACES                 TO lc_Account-Attr
220710120301133282     MOVE ZEROS                  TO ld_ExpiryDate
220720120301133282     MOVE ZEROS                  TO ld_EffectivDate
220730120301           EXEC SQL
220740120301      *RFS133282- Begin
220750120301      *       Select Coalesce(ACCOUNT_ATTRIBUTE_CODE, " ")
220760140619      *       INTO :lc_Account-Attr
220770140619              Select Coalesce(ACCOUNT_ATTRIBUTE_CODE, " "),
220780140619                     COALESCE (EXPIRY_DATE, 0),
220790140619                     COALESCE (EFFECTIV_DATE, 0)
220800140619              INTO :lc_Account-Attr ,
220810140619                   :ld_ExpiryDate   ,
220820140619                   :ld_EffectivDate
220830140619      *RFS133282- End
220840140619              FROM MFAACCATP
220850140619              WHERE ACCOUNT_NO             = :lc_Account-No
220860140619              AND   ACCOUNT_ATTRIBUTE_CODE = "EWACD"
220870140619           END-EXEC.
220880140619           IF  lc_Account-Attr    = SPACES
220890140619           AND lc_EWAFlag         = "Y"
220900140619               MOVE "N"             TO lc_EWAFlag
220910120301           END-IF.
220920120301      *RFS133282-BEGIN
220930120301           IF lc_Account-Attr NOT = SPACES
220940120301           AND lc_EWAFlag         = "Y"
220950110907               IF (ld_ExpiryDate = 0 AND
220960110907                   ld_EffectivDate <= WS-LDA-ENDDTE)
220970110908                   MOVE "Y"             TO lc_EWAFlag
220980110907               ELSE IF ((ld_ExpiryDate <= WS-LDA-ENDDTE) OR
220990110907                       (ld_EffectivDate > WS-LDA-ENDDTE))
221000110908                        MOVE "N"             TO lc_EWAFlag
221010110912                    ELSE
221020110907                        MOVE "Y"             TO lc_EWAFlag
221030110908                    END-IF
221040110907               END-IF
221050110907           END-IF.
221060110907      *RFS133282-END
221070001019      * RFS104483 ends
221080001019103804     MOVE CI-LANGUAGE            to lc_lang_code.
221090001016103804*    MOVE II-LANGUAGE-CODE       to lc_lang_code.
221100030825103804     move spaces TO lc_EW_alert.
221110001026           EXEC SQL
221120001026              Select Coalesce(ALLOW_VALUE_DESC, " ")
221130060621              INTO :lc_EW_alert
221140030825              FROM MFAALWVLP
221150001026              WHERE ALLOW_VALUE_TYPE   = "SEG_EXC_WTH"
221160011130              AND   LANGUAGE_CODE      = :lc_lang_code
221170140619              AND   ALLOW_VALUE        = :lc_EWAFlag
221180011130           END-EXEC.
221190001019           MOVE lc_EW_alert            to CI-EW-ALERT.
221200001020
221210001019      * rfs96081 ends
221220001019
221230001019           MOVE AT-START-DATE          TO CI-START-DATE.
221240001016           MOVE AT-END-DATE            TO CI-END-DATE.
221250001020
221260130524R18147*    MOVE SEG-FUND-CONTRACT-INVESTMENT TO STATEMENT-EXTRACT-REC.
221270130524
221280130614001026     IF WS-LDA-SEG-43                 IS EQUAL TO "Y"
221290130614R18147        MOVE SEG-FUND-CONTRACT-INVESTMENT TO STATEMENT-REC(ISR)
221300130614R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
221310130614           END-IF.
221320130614           ADD WS-GUAR-BASE-VALUE
221330180619                                    TO  WS-GUAR-BASE-VALUE-TOT.
221340130614177152     ADD WS-GUAR-DTH-VALUE    TO  WS-GUAR-DTH-VALUE-TOT.
221350130614R12035     ADD WS-NET-DEPOSIT-VALUE TO  WS-NET-DEPOSIT-VALUE-TOT.
221360130524           ADD WS-GUAR-DEATH-VAL    TO  WS-GUAR-DEATH-VAL-TOT.
221370130524           ADD WS-GUAR-MATURITY-VAL TO  WS-GUAR-MATURITY-VAL-TOT.
221380040420
221390040420           INITIALIZE  SEG-FUND-CONTRACT-INVESTMENT.
221400130524           GO TO PSFIR-READ-CONTRACT-INV-NEXT.
221410130524
221420130524       PSFIR-WRITE-SECTION-40.
221430130524      * RFS115161 - Start
221440130524           IF Ws-LDA-Seg-45  = "Y" AND
221450040420117038        Ws-LDA-Pos-509 = "Y"
221460001020117038***     Ws-LDA-Pos-509 = "Y" AND
221470001020117038***     Ws-LDA-Stmt-Cnfm-Flag = "C"
221480001020117038***     PERFORM Populate-Acct-Ann-routine UNTIL
221490001020117038***                                 lb_InvaliddataTrue
221500001020117038***QC32062     PERFORM Populate-Acct-Ann-routine
221510001020117038        CONTINUE
221520090630           ELSE
221530001020      * RFS115161 - End
221540090630R21337     IF WS-LDA-SEG-45           IS EQUAL TO "Y"
221550090630              PERFORM POPULATE-ANN-SEG45-ROUTINE THRU PANS45R-EXIT
221560001020      * RFS115161 - Start
221570001020R21337*    END-IF.
221580001020R21337     END-IF
221590001020           END-IF.
221600001020      * RFS115161 - End
221610001020
221620090630           IF WS-LDA-SEG-40           IS NOT EQUAL TO "Y"
221630090630              GO TO PSFIR-READ-CONTRACT-NEXT
221640100304           END-IF.
221650100304
221660130719           ADD 1                       TO  WS-ACC-SEG40-COUNT.
221670130719           INITIALIZE SEG-FUND-CONTRACT-DETAILS.
221680130719R64262     INITIALIZE LC-RESET-DATE-TYPE.
221690130814           MOVE AD-INVESTOR-NO         TO CD-INVESTOR-NO.
221700130814R64262     MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC  TO CD-ACCOUNT
221710130814R64262                                                 Ln-AccountNo.
221720130719           MOVE "40"                   TO CD-SECTION-NO.
221730001020           MOVE WS-ACC-SEG40-COUNT     TO CD-SECTION-SEQUENCE.
221740001020           MOVE AD-LANGUAGE            TO CD-LANGUAGE.
221750001020           MOVE AD-DEALER              TO CD-DEALER.
221760001020           MOVE AD-SALESREP            TO CD-SALESREP.
221770001020           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
221780001020R64262                                 TO CD-CONTRACT-NO
221790001020R64262                                    Ln-ResetContractNo.
22180001060474626      MOVE CONTRACT-STATUS OF ACCOUNT-CONTRACT-REC TO
22181001060474626           CD-CONTRACT-STATUS.
221820010604      * RFS110904 - Start
221830010604           MOVE GUAR-BENEFIT-ELIGIBLE OF ACCOUNT-CONTRACT-REC TO
221840010604                          CD-GUARANTEE-BENEFIT.
221850010604           IF GUAR-BENEFIT-ELIGIBLE = lnc_N
221860001020              MOVE lnc_Spaces    TO CD-GUARANTEE-BENEFIT
221870001020           END-IF.
221880001020      * RFS110904 - End
221890001020           IF CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
221900001020                                       IS NOT EQUAL TO SPACES
221910001020              MOVE CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
221920091027                                       TO CD-CONTRACT-XREF
221930091027           END-IF
221940001020           MOVE START-DATE    OF ACCOUNT-CONTRACT-REC
221950001025                                         TO CD-START-DATE1.
221960001025R10243     IF WS-FIRST-TRADE-DATE      IS EQUAL TO 99999999
221970001025R10243        MOVE CD-START-DATE1      TO CD-FIRST-TRADE-DATE
221980001020           ELSE
221990001020R10243        MOVE WS-FIRST-TRADE-DATE TO CD-FIRST-TRADE-DATE
222000001020           END-IF.
222010001020
222020101126           MOVE MATURITY-DATE OF ACCOUNT-CONTRACT-REC
222030110214                                         TO CD-MATURITY-DATE.
222040110214           MOVE DEPOSIT-MATURITY-DATE OF ACCOUNT-CONTRACT-REC
222050110214                                         TO CD-DEPOSIT-MATURITY-DATE.
222060101126           MOVE DEPOSIT-RENEWAL-DATE OF ACCOUNT-CONTRACT-REC
222070001020                                         TO CD-DEPOSIT-RENEWAL-DATE.
222080020417R74979*    MOVE NO-OF-RESETS           OF ALLOWABLE-RESET-SCHED-REC
222090020417R74979     MOVE Ld_NoOfResets            TO CD-RESETS-ALLOWED.
222100020417           MOVE NO-OF-RESETS-REMAINING OF ACCOUNT-CONTRACT-REC
222110020417                                         TO CD-RESETS-REMAINING.
222120020417           COMPUTE CD-RESETS-EXCERCISED  = CD-RESETS-ALLOWED
222130020417                                         - CD-RESETS-REMAINING.
222140060417           MOVE WS-GUAR-BASE-VALUE-TOT   TO CD-GUARANTEED-BASE-VALUE.
222150060417           MOVE WS-GUAR-MATURITY-VAL-TOT
222160060417                                       TO CD-GUARANTEED-MATURITY-VALUE.
222170060417           MOVE WS-GUAR-DEATH-VAL-TOT    TO CD-GUARANTEED-DEATH-VALUE.
22218009102883774      IF CD-CONTRACT-STATUS = "C" AND
222190091028R91675        CONTRACT-CLOSED-DATE  OF ACCOUNT-CONTRACT-REC
222200090727R91675                               <= WS-LDA-ENDDTE
222210091028R91675*       CD-CONTRACT-CLOSE-DATE <= WS-LDA-ENDDTE
22222009102883774         MOVE 0 TO CD-GUARANTEED-DEATH-VALUE.
222230091028           MOVE WS-NET-DEPOSIT-VALUE-TOT TO CD-NET-DEPOSIT-VALUE.
222240091028
222250091028R13184     MOVE WS-CONTRACT-MARKET-VALUE TO CD-CONTRACT-MARKET-VALUE.
222260091028R13184     MOVE LAST-RESET-DATE       OF ACCOUNT-CONTRACT-REC
222270091028R13184                                   TO CD-LAST-RESET-DATE.
222280091028R13184     MOVE CONTRACT-CLOSED-DATE  OF ACCOUNT-CONTRACT-REC
222290091102R13184                                   TO CD-CONTRACT-CLOSE-DATE.
222300091028      * -- RFS31514 Begins
222310091028           MOVE AWD-CARRIED-OVER      OF ACCOUNT-CONTRACT-REC
222320091028                                         TO ld-AwdCarOvr.
222330091028      * -- RFS31514 Ends
222340091028R74979***** Start of rfs74976: The changes in rfs64262 were modified:
222350091028  ]   ***** Get the previous, noreversed reset for the effect_date
222360091028R64262***** Get the latest record with Reset Type of GBV and GDV
222370091028  ]        EXEC SQL
222380091028  ]          SELECT COALESCE(acccrp1.effect_date, 0)
222390091028  ]          INTO :Ld-LastRestDateGBV
222400091028  ]          FROM
222410091028  ]            Mfaacccrp acccrp1
222420091028  ]          WHERE
222430091028  ]            acccrp1.Account_No   = :Ln-AccountNo       AND
222440091028  ]            acccrp1.Contract_No  = :Ln-ResetContractNo AND
222450091028  ]            acccrp1.Reset_Number =
222460091028  ]            (SELECT COALESCE(Max(acccrp2.RESET_NUMBER), 0)
222470091028  ]             FROM
222480091028  ]               Mfaacccrp acccrp2
222490091028  ]             WHERE
222500091028  ]               acccrp2.Account_No  = :Ln-AccountNo   AND
222510091028  ]               acccrp2.Contract_No = :Ln-ResetContractNo AND
222520091028  ]               acccrp2.RESET_REQ_DATE <= :Ld_EndDateRst AND
222530091102  ]               acccrp2.Reset_type  = :LC-GBV)       AND
222540091028  ]            acccrp1.Reset_type  = :LC-GBV           AND
222550091028  ]            acccrp1.REVERSED    <> "Y"
222560091028  ]        END-EXEC.
222570091028  ]
222580091028  ]        IF SQLCODE = 100
222590091028  ]           MOVE 0   TO Ld-LastRestDateGBV
222600091028  ]        END-IF.
222610091028  ]        EXEC SQL
222620091028  ]          SELECT COALESCE(acccrp1.effect_date, 0)
222630091028  ]          INTO :Ld-LastRestDateGDV
222640091028  ]          FROM
222650091028  ]            Mfaacccrp acccrp1
222660091028  ]          WHERE
222670091028  ]            acccrp1.Account_No   = :Ln-AccountNo       AND
222680091028  ]            acccrp1.Contract_No  = :Ln-ResetContractNo AND
222690091028  ]            acccrp1.Reset_Number =
222700091028  ]            (SELECT COALESCE(Max(acccrp2.RESET_NUMBER), 0)
222710091028  ]             FROM
222720091028  ]               Mfaacccrp acccrp2
222730090819  ]             WHERE
222740090819  ]               acccrp2.Account_No  = :Ln-AccountNo   AND
222750090819  ]               acccrp2.Contract_No = :Ln-ResetContractNo AND
222760090819  ]               acccrp2.RESET_REQ_DATE <= :Ld_EndDateRst AND
222770090819  ]               acccrp2.Reset_type  = :LC-GDV)       AND
222780090819  ]            acccrp1.Reset_type  = :LC-GDV           AND
222790090819  ]            acccrp1.REVERSED    <> "Y"
222800090819  ]        END-EXEC.
222810090819  ]
222820090911  ]        IF SQLCODE = 100
222830090911  ]           MOVE 0   TO Ld-LastRestDateGDV
222840090728  ]        END-IF.
222850090728  ]
222860090728  ]        MOVE Ld-LastRestDateGBV   TO CD-LAST-GBV-RESET-DATE
222870090728  V        MOVE Ld-LastRestDateGDV   TO CD-LAST-GDV-RESET-DATE
222880090728R74979***** End of rfs74979
222890090728  |        MOVE ZEROES     TO Ld-RestFreqGBV Ld-RestFreqGDV.
222900090818  |
222910090924  |        IF Ld-GDVStartDate NOT NUMERIC
222920090924  |           MOVE ZEROES     TO Ld-GDVStartDate
222930090728  |        END-IF.
222940090728  |        IF LD-GDVEndDate   NOT NUMERIC
222950090911  |           MOVE ZEROES     TO Ld-GDVEndDate
222960090728  |        END-IF.
222970090911  |
222980090911  ]   ***** Get the Reset-Freq for reset Type of GBV and GDV.
222990090911  ]   * First try getting record with Account Type code for GDV.
223000090911  |        EXEC SQL
223010090911  |          SELECT COALESCE(RESET_FREQ, 0)
223020090911  |          INTO :Ld-RestFreqGDV
223030090911  |          FROM
223040090911  |            MFAGDTHCSP
223050090911  |          WHERE
223060090924  |            GDV_SCHED_CODE        = :Lc-AutoResetSchCode   AND
223070090924  |            START_DATE           <= :Ld-GDVStartDate       AND
223080090911  |            END_DATE             >= :Ld-GDVEndDate         AND
223090090911  |            ACCOUNT_TYPE_CODE     = :Lc-AccountTypeCode    AND
223100090911  |            RESET_TYPE            = :LC-GDV
223110090911  |          FETCH FIRST ROW ONLY
223120090911  |        END-EXEC.
223130090911  |   * If not found, try getting record with blank Account Type code
223140090911  |        IF SQLCODE = 100
223150090911  |           EXEC SQL
223160090819  |             SELECT COALESCE(RESET_FREQ, 0)
223170090819  |             INTO :Ld-RestFreqGDV
223180090819  |           FROM
223190090819  |             MFAGDTHCSP
223200090819  |           WHERE
223210090819  |             GDV_SCHED_CODE        = :Lc-AutoResetSchCode   AND
223220090819  |             START_DATE           <= :Ld-GDVStartDate       AND
223230090819  |             END_DATE             >= :Ld-GDVEndDate         AND
223240090911  |             ACCOUNT_TYPE_CODE     = :Lncc_blank            AND
223250090728  |             RESET_TYPE            = :LC-GDV
223260090728  |            FETCH FIRST ROW ONLY
223270090728  |           END-EXEC
223280090728  ]
223290090728  |           IF SQLCODE = 100
223300090728  |              MOVE 0   TO Ld-RestFreqGDV
223310090818  |           END-IF
223320090924  |        END-IF.
223330090924  |
223340090728  |        IF Ld-GBVStartDate NOT NUMERIC
223350090728  |           MOVE ZEROES     TO Ld-GBVStartDate
223360090911  |        END-IF.
223370090728  |        IF Ld-GBVEndDate   NOT NUMERIC
223380090911  |           MOVE ZEROES     TO Ld-GBVEndDate
223390090911  |        END-IF.
223400090911  ]   * First try getting record with Account Type code for GBV.
223410090911  |        EXEC SQL
223420090911  |          SELECT COALESCE(RESET_FREQ, 0)
223430090911  |          INTO :Ld-RestFreqGBV
223440090911  |          FROM
223450090911  |            MFAGDTHCSP
223460090924  |          WHERE
223470090924  |            GDV_SCHED_CODE        = :Lc-AutoResetSchCode   AND
223480090911  |            START_DATE           <= :Ld-GBVStartDate       AND
223490090911  |            END_DATE             >= :Ld-GBVEndDate         AND
223500090911  |            ACCOUNT_TYPE_CODE     = :Lc-AccountTypeCode    AND
223510090911  |            RESET_TYPE            = :LC-GBV
223520090911  |          FETCH FIRST ROW ONLY
223530090911  |        END-EXEC.
223540090911  |   * If not found, try getting record with blank Account Type code
223550090911  |        IF SQLCODE = 100
223560090819  |           EXEC SQL
223570090728  |             SELECT COALESCE(RESET_FREQ, 0)
223580090728  |                    INTO :Ld-RestFreqGBV
223590090728  |             FROM MFAGDTHCSP
223600090728  |             WHERE
223610081121  |               GDV_SCHED_CODE        = :Lc-AutoResetSchCode   AND
223620081121  |               START_DATE           <= :Ld-GBVStartDate       AND
223630081121  |               END_DATE             >= :Ld-GBVEndDate         AND
223640081121  |               ACCOUNT_TYPE_CODE     = :Lncc_blank            AND
223650081121  |               RESET_TYPE            = :LC-GBV
223660081121  |             FETCH FIRST ROW ONLY
223670081121  |           END-EXEC
223680081121  |
223690081121  |           IF SQLCODE = 100
223700081121  |              MOVE 0   TO Ld-RestFreqGBV
223710081121  |           END-IF
223720020417  |        END-IF.
223730020516  |
223740020417  V        MOVE Ld-RestFreqGBV       TO CD-AUTO-GBV-RESET-FREQ.
223750020516R64262     MOVE Ld-RestFreqGDV       TO CD-AUTO-GDV-RESET-FREQ.
223760020516
223770020516R52815     IF WS-AT-RULE (AT1) = lnc_Rule3 OR
223780020516  |           WS-NA-TYPE (NA)  = lnc_Rrif
223790020516  |           MOVE ORIGINAL-GWA  OF ACCOUNT-CONTRACT-REC
223800020516  |                                 TO CD-Original-GLWA
223810020516  |        END-IF.
223820020516  |        MOVE GWA-RIF-MINIMUM  OF ACCOUNT-CONTRACT-REC
223830020516  |                                 TO CD-GLWA-RIF-Min.
223840020516  |        MOVE QUALIFYING-FLAG  OF ACCOUNT-CONTRACT-REC
223850020516  |                                 TO CD-Qualify-Nominee-RRIF.
223860061003  |        MOVE SPOUSAL-DOB-FLAG OF ACCOUNT-CONTRACT-REC
223870061003R52815                              TO CD-Qualify-DOB-Nominee-RRIF.
223880020516           MOVE ZEROS               TO CD-GUARANTEED-BASE-VALUE-OPEN.
223890020516           MOVE ZEROS               TO CD-GUARANTEED-BASE-VALUE-CHG.
223900041007
223910041007R13184     IF WS-LDA-SEG-CONTRACT-OPENING      IS EQUAL TO "Y"
223920041229              MOVE WS-GUAR-BASEO-VALUE-TOT
223930041007                                     TO CD-GUARANTEED-BASE-VALUE-OPEN
223940110304              COMPUTE WS-GUAR-BASE-VALUE-CHG
223950110304                                    = CD-GUARANTEED-BASE-VALUE
223960041007                                    - CD-GUARANTEED-BASE-VALUE-OPEN
223970110519              MOVE WS-GUAR-BASE-VALUE-CHG
223980110519                                    TO CD-GUARANTEED-BASE-VALUE-CHG
223990110519
224000110519              IF WS-GUAR-BASE-VALUE-CHG        IS LESS THAN ZEROS
224010110519                 MOVE "-"              TO CD-G-B-V-C-SIGN
224020110519R35540        ELSE
224030110519R35540           MOVE " "              TO CD-G-B-V-C-SIGN
224040110519              END-IF
224050110519R13184     END-IF.
224060110519
224070110519R22856***** Get the Contract AWD
224080110519R25469     PERFORM GET-CONTRACT-AWD-ROUTINE       THRU GCAWDR-EXIT.
224090110519   ¦
224100110519R80605*    MOVE WS-AWD-AMT     TO  WS-AWD-AMT-TOTAL.
224110060417R80605     MOVE Ln_Gbv_AwdSum  TO  WS-AWD-AMT-TOTAL.
224120041005   ¦
224130101126      * -- RFS31514 Begins
224140101126R80605     IF Lc_Gdv_Independ = "Y"
224150041007   ¦       COMPUTE WS-GUAR-DEATH-BENEFIT = WS-GUAR-DEATH-VAL-TOT
224160041005R80605        - Ln_Gdv_AwdSum
224170041005   |          - GDV-AWD-CARRIED-OVER OF ACCOUNT-CONTRACT-REC
224180041005   V  *       - WS-AWD-AMT-TOTAL
224190041005R80605*       - AWD-CARRIED-OVER OF ACCOUNT-CONTRACT-REC.
224200060417           ELSE
224210060417   ¦       COMPUTE WS-GUAR-DEATH-BENEFIT = WS-GUAR-DEATH-VAL-TOT
224220060417   V          - WS-AWD-AMT-TOTAL
224230060417R80605        - AWD-CARRIED-OVER OF ACCOUNT-CONTRACT-REC
224240060417R80605     END-IF.
224250041005
224260041007      * -- RFS31514 Ends
224270041005
224280041005   ¦       IF WS-GUAR-DEATH-BENEFIT  IS LESS THAN ZEROS
22429004100583774         OR (CD-CONTRACT-STATUS = "C" AND
22430004100583774             CD-CONTRACT-CLOSE-DATE <= WS-LDA-ENDDTE)
224310041005   ¦          MOVE ZEROS                 TO CD-GUAR-DTH-BENEFIT-VALUE
224320041005   ¦       ELSE
224330041005   ¦          MOVE WS-GUAR-DEATH-BENEFIT TO CD-GUAR-DTH-BENEFIT-VALUE
224340041005   ¦       END-IF.
224350041005   ¦
224360041005      * -- RFS31514 Begins
224370110304   ¦       COMPUTE WS-GUAR-MAT-BENEFIT   = WS-GUAR-MATURITY-VAL-TOT
224380110304   ¦          - WS-AWD-AMT-TOTAL
224390110304              - AWD-CARRIED-OVER OF ACCOUNT-CONTRACT-REC.
224400110307      * -- RFS31514 Ends
224410110307   ¦       IF WS-GUAR-MAT-BENEFIT    IS LESS THAN ZEROS
224420110307   ¦          MOVE ZEROS                 TO CD-GUAR-MAT-BENEFIT-VALUE
224430110307   ¦       ELSE
224440110307   ¦          MOVE WS-GUAR-MAT-BENEFIT   TO CD-GUAR-MAT-BENEFIT-VALUE
224450110307   ¦       END-IF.
224460110307   ¦
224470110307   ¦       IF WS-AWD-AMT-TOTAL        IS LESS THAN ZEROS
224480110307   ¦          MOVE ZEROS                 TO CD-SUM-ALL-AWD
224490110307   ¦       ELSE
224500110307   v          MOVE WS-AWD-AMT-TOTAL      TO CD-SUM-ALL-AWD
224510110307R22856     END-IF.
224520110307
224530070321R80605     IF Ln_Gdv_AwdSum           IS LESS THAN ZEROS
224540070321   |          MOVE ZEROS           TO CD-GDV-SUM-ALL-AWD
224550070321   |       ELSE
224560070321   |          IF Lc_Gdv_Independ = "Y"
224570051024   |             MOVE Ln_Gdv_AwdSum   TO CD-GDV-SUM-ALL-AWD
224580051024   |          ELSE
224590070301   |             MOVE ZEROS           TO CD-GDV-SUM-ALL-AWD
224600070302   |          END-IF
224610070302   |       END-IF.
224620070301   |       IF Lc_Gdv_Independ = "Y"
224630070301   |          MOVE GDV-AWD-CARRIED-OVER  OF
224640070301   |               ACCOUNT-CONTRACT-REC
224650070301   |                              TO CD-GDV-AWD-CARRIED-OVER
224660070302   |       ELSE
224670070301   V          MOVE 0              TO CD-GDV-AWD-CARRIED-OVER
224680070301R80605     END-IF.
224690070301           MOVE AD-START-DATE          TO CD-START-DATE
224700070301R37754                                    ln_StartDate.
224710070301           MOVE AD-END-DATE            TO CD-END-DATE
224720070301R37754                                    ln_EndDate.
22473007030128107******
224740070301   ¦          MOVE ZEROES TO WS-EFFECT-DATE
224750051024      * RFS 38037 Start
224760051024           MOVE ZEROES TO li_OvrGbvEffectDate.
224770061027           IF lncc_OvrGbvSetUp
224780051024              PERFORM UpdateGBVIndDate
224790051024           END-IF.
224800051024      * RFS 38037 End
224810051024
224820051024R38037     IF li_OvrGbvEffectDate = 0
22483005102428107         EXEC SQL
224840051024   ¦          SELECT EFFECT_DATE
224850051024   ¦          INTO  :WS-EFFECT-DATE
224860051024   ¦          FROM MFAACCCAP
224870051024   ¦          WHERE MFAACCCAP.ACCOUNT_NO = :WS-ACCOUNT-NO
224880051024   ¦          AND   MFAACCCAP.CONTRACT_NO = :WS-CONTRACT-NO
224890061027   ¦          AND   MFAACCCAP.CONTRACT_ATTRIBUTE_CODE = "VLGBV"
224900051024   ¦          END-EXEC
224910070301   ¦
224920070227              IF SQLCODE NOT EQUAL TO 100
224930051024   ¦                MOVE "Y" TO CD-GBV-INDICATOR
224940051024              ELSE
224950051024   ¦             EXEC SQL
224960070321   ¦                SELECT EFFECT_DATE
224970070321   ¦                INTO  :WS-EFFECT-DATE
224980070321   ¦                FROM MFAACCCAP
224990070620   ¦                WHERE MFAACCCAP.ACCOUNT_NO = :WS-ACCOUNT-NO
225000070620   ¦                AND   MFAACCCAP.CONTRACT_NO = :WS-CONTRACT-NO
225010070620   ¦                AND   MFAACCCAP.CONTRACT_ATTRIBUTE_CODE = "IVGBV"
225020070620   ¦              END-EXEC
225030070720   ¦
225040070720   ¦              IF  SQLCODE NOT EQUAL TO 100
225050070720   ¦                     MOVE "N" TO CD-GBV-INDICATOR
225060070720   ¦              END-IF
22507007072028107          END-IF
225080070620R38037     END-IF.
225090070321   ¦           MOVE WS-EFFECT-DATE TO CD-VALIDATION-DATE.
225100070321   V
22511007032128107*
225120070321      **RFS37754 - Begins
225130070321           EXEC SQL
225140070321             SELECT
225150070321      *-- RFS 42623 Begins
225160070321      *        COALESCE(SUM(acccrp.TopUp_Notional_Amount), 0) INTO
225170070321      *        :ln_TopUpAmt
225180070321              COALESCE(SUM(acccrp.TopUp_Notional_Amount), 0),
225190070322              COALESCE(MAX(acccrp.Reset_Number), 0),
225200070321      *** RFS43223 - Start
225210001020              COALESCE(MAX(acccrp.Reset_Req_Date), 0)
225220070619              INTO :ln_TopUpAmt, :ln_ResetNumber,:li_ResetReqDate
225230090729      *** RFS43223 - End
225240090729      *-- RFS 42623 Ends
225250090729             FROM
225260090729               Mfaacccrp acccrp
225270070620             WHERE
225280070620               acccrp.Account_No = :Ws-Account-No AND
225290070619               acccrp.Contract_No = :Ws-Contract-No AND
225300150416               acccrp.Reset_Category = :lncc_M AND
225310070619               acccrp.Reversed <> :lncc_Yes AND
225320080425               acccrp.Reset_Processed_Date >= :ln_StartDate AND
225330080425               acccrp.Reset_Processed_Date <= :ln_EndDate
225340080425           END-EXEC.
225350080425           MOVE ln_TopUpAmt TO Cd-TopUpNotionalAmt.
225360080425      **RFS37754 - Ends
225370080425
225380080806      *-- RFS 42623 Begins
225390080806R64262***** The following If statement was changed to include Statement
225400080806  |   ***** run. For Statement, the run time will be increased.
225410080806  V   *    IF CONFIRMATION-RUN AND not lncc_ZeroResetNumber
225420080806R64262     IF not lncc_ZeroResetNumber
225430080806              PERFORM CalculateGmvCmv
225440080806           END-IF.
225450080806      *-- RFS 42623 Ends
225460180709142884     PERFORM PREPARE-SECTION40-NEW-FIELD.
225470180709      *RFS177152 START-Moved % value before investment series condition
225480180709           MOVE ld_GuaranteePercent  TO CD-Maturity-Benefit-Percentage.
225490180709           IF GUARANTEE-DTH-PERCENT OF ACCOUNT-CONTRACT > 0
225500180709             MOVE GUARANTEE-DTH-PERCENT OF ACCOUNT-CONTRACT
225510180709               TO CD-Death-Benefit-Percentage
225520180709           ELSE
225530180709             MOVE ld_GuaranteeDthPercent TO CD-Death-Benefit-Percentage
225540180717           END-IF.
225550180717           INITIALIZE CD-GUAR-DEATH-VALUE-OPEN
225560180709                      CD-GUAR-MAT-VALUE-OPEN.
225570180709           MOVE WS-GUAR-DEATHO-VALUE-TOT TO CD-GUAR-DEATH-VALUE-OPEN.
225580180709           IF WS-LDA-SEG-CONTRACT-OPENING      IS EQUAL TO "Y"
225590180709              COMPUTE CD-GUAR-MAT-VALUE-OPEN ROUNDED
225600180709                      = (CD-GUARANTEED-BASE-VALUE-OPEN
225610180709                         * CD-MATURITY-BENEFIT-PERCENTAGE) / 100
225620180709           END-IF.
225630080806      *RFS177152 END
225640080806
225650080806      *RFS 47406 Start
225660080806           IF lc_InvestmentSeries NOT = SPACE  AND
225670080806              lc_SegGLWBYes
225680080806              PERFORM SetGLWBDetail
225690080806           END-IF.
225700081027      *RFS 47406 End
225710081027      *RFS50993 - Start
225720080806           INITIALIZE CD-DOB-FOR-CALC
225730080806                      CD-NEW-DEPOSIT
225740080806                      CD-SERIES-DESCRIPTION
225750080806                      CD-SERIES-DESCRIPTION-FRENCH.
225760080806           EXEC SQL
225770080806             SELECT COALESCE(Investment_Series, " ")
225780080806             INTO :lc_ContInvSeries
225790080806             FROM MFAACCONP
225800080806             WHERE Account_No =:WS-ACCOUNT-NO AND
225810080806                   Contract_No =:WS-CONTRACT-NO
225820090505           END-EXEC.
225830090505
225840090505           IF lc_ContInvSeries NOT = " "
225850090505              MOVE 0               TO pi_DateOfBirth
225860080806R57399*       SET pb_DefaultAnnuit TO TRUE
225870080806R57399        SET pb_YoungerAnnuit TO TRUE
225880080806              MOVE WS-ACCOUNT-NO   TO pi_AnnuitAccountNo
225890080806              MOVE WS-CONTRACT-NO  TO pi_AnnuitContractNo
225900080806              CALL "FXACCANUIT" USING pc_AnnuitFlag,
225910080806                                      pi_AnnuitAccountNo,
225920080806                                      pi_AnnuitContractNo,
225930080806                                      pi_AnnSequenceNo,
225940080806                                      pc_AnnuitantStatus,
225950080806                                      pi_DateOfBirth,
225960101111                                      pc_FirstName,
225970101111                                      pc_LastName,
225980101111      * RFS55414 - Begin: added new returned parameters
225990101111                                      pi_socialInsuranceNo,
226000101111                                      pc_sex,
226010101111      * RFS55414 - End
226020101111                                      pc_AnnuitReturnCode
226030101111              IF pb_RetriveYes
226040101111                 MOVE  pi_DateOfBirth TO  CD-DOB-FOR-CALC
226050180731              END-IF
226060180731      *RFS177152 Start
226070180731           IF lc_InvestmentSeries NOT = SPACE  AND
226080180731              lc_SegGLWBYes
226090180731              PERFORM SetLWAProjection THRU SLP-EXIT
226100180731           END-IF
226110101111      *RFS177152 End
226120101111
226130101111              MOVE 0 TO ld_FstDepDate
226140101111
226150101111              EXEC SQL
226160101111                SELECT COALESCE(MIN(trnp.Process_Date), 0)
226170080806                  INTO :ld_FstDepDate
226180080806      * RFS84988 Begins
226190080806      *         FROM  MFATRCODP trcodp, MFATRNP trnp
226200080806      *         WHERE trnp.Account_No = :WS-ACCOUNT-NO AND
226210080806      *               trcodp.Contract_No = :WS-CONTRACT-NO AND
226220080806      *               trcodp.Placement_Date = trnp.Placement_Date AND
226230080806      *               trcodp.Trans_No = trnp.Trans_No AND
226240080806      *               trnp.Trans_Status_Code IN ("HST", "HSC")
226250080806                FROM  MFATRCODP trcodp
226260080806                INNER JOIN MFATRNP trnp ON
226270080806                trcodp.Placement_Date = trnp.Placement_Date AND
226280080806                trcodp.Trans_No = trnp.Trans_No
226290080806                WHERE trnp.Account_No = :WS-ACCOUNT-NO AND
226300080806                      trcodp.Contract_No = :WS-CONTRACT-NO AND
226310080806                      trnp.Trans_Status_Code IN ("HST", "HSC")
226320080806      * RFS84988 Ends
226330080806              END-EXEC
226340080806
226350080806              IF CD-START-DATE <= ld_FstDepDate AND
226360080806                 ld_FstDepDate <= CD-END-DATE
226370080806                   MOVE lncc_Yes TO CD-NEW-DEPOSIT
226380081121              ELSE MOVE lncc_No  TO CD-NEW-DEPOSIT
226390081121              END-IF
226400081121
226410081121              MOVE "Get Inv. Series Desc's" TO WS-SQLERR-STATEMENT
226420081121              EXEC SQL
226430081121               SELECT COALESCE(Series_Description, " "),
226440081121                      COALESCE(SUBSTR(Series_Rules,100,45), " ")
226450081121               INTO :lc_SeriesDescEnglish, :lc_SeriesDescFrench
226460081121               FROM  MFASERRLP
226470081121               WHERE Investment_Series = :lc_ContInvSeries
226480081121              END-EXEC
226490081121
226500081121              MOVE lc_SeriesDescEnglish TO CD-SERIES-DESCRIPTION
226510081121              MOVE lc_SeriesDescFrench  TO CD-SERIES-DESCRIPTION-FRENCH
226520081121           END-IF.
226530081121      *RFS50993 - End
226540081121
226550081121      * R52815 - Start
226560081121           INITIALIZE CD-Bonus-Eligibility
226570081121                      CD-Bonus-Added-To-GWBASE
226580081121                      lc_MfaAccFbpVars.
226590081121           SET lb_FIEBonusNotFound TO TRUE.
226600081121           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
226610081121                              TO li_AccountNo.
226620081121           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
226630081121                              TO li_ContractNo.
226640081121           MOVE WS-LDA-ENDDTE TO ld_LdaEndDate.
226650081121
226660081121           MOVE "Fetch Next From MfaAccFbp1" TO WS-SQLERR-STATEMENT.
226670081121           EXEC SQL
226680081121                OPEN MfaAccFbp1
226690081121           END-EXEC.
226700081121
226710081121           EXEC SQL
226720081121                FETCH NEXT FROM MfaAccFbp1
226730081121                INTO :ld_FieBonusDate
226740081121                    ,:lc_FieBonusFlag
226750081121                    ,:ln_FieBonusAmount
226760081121           END-EXEC.
226770081121
226780081121           IF SQLCODE = 0
226790081121             SET lb_FIEBonusFound TO TRUE
226800081121           ELSE
226810081121             SET lb_FIEBonusNotFound TO TRUE
226820081121           END-IF.
226830081121
226840081121           EXEC SQL
226850081121                CLOSE MfaAccFbp1
226860080806           END-EXEC.
226870001026
226880060621      * FIE Bonus applies when found for the current or
226890030825      * previous calendar year. At Year-End FIE Bonus applies
226900001026      * if found for the current year only.
226910001020           IF lb_FIEBonusFound
226920001020              IF (Ws-Lda-EndDte-MMDD = lnc_YearEndMMDD     AND
226930001020                  ld_FIEBonusCCYY = WS-Lda-EndDte-CCYY)    OR
226940001020                 (Ws-Lda-EndDte-MMDD NOT = lnc_YearEndMMDD AND
226950001019                 (ld_FIEBonusCCYY = WS-Lda-EndDte-CCYY     OR
226960001019                  ld_FIEBonusCCYY = (WS-Lda-EndDte-CCYY - 1)))
226970110531                 MOVE lc_FieBonusFlag TO CD-Bonus-Eligibility
226980110531                 MOVE ln_FieBonusAmount TO CD-Bonus-Added-To-GWBASE
226990110531              END-IF
227000110609           END-IF.
227010110601      * R52815 - End
227011210914      * RFS186199 - Begin
227012210914           IF lb_AccountGuaranteesYes
227013210914              PERFORM PREPARE-CONTRACT-MDBA-VALUES
227014210914           END-IF.
227015210914      * RFS186199 - End
227020110531
227030110531           IF WS-LDA-SEG-40           IS EQUAL TO "Y"
227040110531R18147        MOVE SEG-FUND-CONTRACT-DETAILS TO STATEMENT-REC(ISR)
227050110601R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
227060110601           END-IF.
227070110601
227080110601           INITIALIZE  SEG-FUND-CONTRACT-DETAILS.
227090110531           INITIALIZE  WS-SEG-FUND-SECTIONS.
227100110531           GO TO PSFIR-READ-CONTRACT-NEXT.
227110110531       PSFIR-EXIT.
227120180627             EXIT.
227130180627
227140180627      *RFS177152 START
227150180627       SetLWAProjection.
227160180627           Move zeroes to CD-ATTAINED-AGE-1, CD-LWA-PROJECTION-1,
227170180627                          CD-ATTAINED-AGE-2, CD-LWA-PROJECTION-2,
227180180627                          CD-ATTAINED-AGE-3, CD-LWA-PROJECTION-3,
227190180731                          CD-ATTAINED-AGE-4, CD-LWA-PROJECTION-4.
227200180731      *pi_DateOfBirth is younger annuitant DOB
227210180731           Move pi_DateOfBirth TO li_AnnDOBTemp.
227220180731           Compute WS-GLWA-Ann-Calendar-Age
227230180725                           = ld_AsAtDateCCYY - li_AnnDOBYYYYTemp.
227240180725           IF CD-FIE-Base-Value-Sign = "-"
227250180725              Move 0 to WS-GBB-Calc
227260180725           ELSE
227270180725              Move CD-FIE-BASE-VALUE to WS-GBB-Calc
227280180627           END-IF.
227290180627           Move CD-GW-BASE-VALUE to WS-GWB-Calc.
227300180717           SET WS-GGWBIDX TO 1.
227310180629           SET WS-LWADIDX TO 1.
227320180725           INITIALIZE WS-GWA-PERCENT-GGWB.
227330180629           INITIALIZE WS-BONUS-AGE-THRESHOLD.
227340180627           Move 0 to WS-LWA-ROW-CNT.
227350180627           SEARCH WS-SGGWBR-Details-DEF VARYING WS-GGWBIDX
227360180702             AT END
227370180627                    GO TO SLP-0010
227380180629             WHEN WS-PARM-INVESTMENT-SERIES(WS-GGWBIDX) =
227390180725                  lc_InvestmentSeries AND
227400180702                  WS-PARM-AGE-THRESHOLD(WS-GGWBIDX) >
227410180627                  WS-GLWA-Ann-Calendar-Age
227420180629                    CONTINUE
227430180702             WHEN WS-PARM-INVESTMENT-SERIES(WS-GGWBIDX) = " "
227440180627                    GO TO SLP-0010
227450180627           END-SEARCH.
227460180702
227470180702           MOVE WS-PARM-BONUS-PERCENT(WS-GGWBIDX)
227480180725                TO WS-GWA-PERCENT-GGWB.
227490180725           MOVE WS-PARM-AGE-THRESHOLD(WS-GGWBIDX)
227500180629                TO WS-BONUS-AGE-THRESHOLD.
227510180629           IF WS-PARM-SKIP-SELL-TAKEN(WS-GGWBIDX) = "Y"
227520180629              INITIALIZE li_RecordCount
227530180629              MOVE WS-LDA-STRDTE TO WS-TEMP-STRDTE
227540180629              MOVE WS-LDA-ENDDTE TO WS-TEMP-ENDDTE
227550180629              EXEC SQL
227560180629                SELECT COUNT(1) into :li_RecordCount
227570180629                FROM MFATRNP TRN
227580180627                  JOIN MFATRCODP TRCOD
227590180627                  ON TRCOD.Placement_Date = TRN.Placement_Date AND
227600180629                     TRCOD.Trans_No = TRN.Trans_No
227610180627                WHERE
227620180627                  TRN.Account_No = :WS-ACCOUNT-NO              AND
227630180627                  TRN.Process_Date >= :WS-TEMP-STRDTE          AND
227640180627                  TRN.Process_Date <= :WS-TEMP-ENDDTE          AND
227650180627                  TRN.Trans_Type_Code IN ("SEL", "TRO", "SWO") AND
227660180627                  TRN.Reverse IN (" ", "N")                    AND
227670180627                  TRCOD.Contract_No = :WS-CONTRACT-NO          AND
227680180627                  (TRCOD.Guar_Withdrawal_Amount > 0            OR
227690180629                   TRCOD.Guar_Withdrawal_Excess > 0)
227700180723              END-EXEC
227710180629              IF li_RecordCount > 0
227720180629                 GO TO SLP-EXIT
227730180702              ELSE
227740180629                 GO TO SLP-0010
227750180629              END-IF
227760180702           ELSE
227770180629              GO TO SLP-0010
227780180627           END-IF.
227790180627
227800180627
227810180627       SLP-0010.
227820180627           SEARCH WS-LWA-Details-DEF VARYING WS-LWADIDX
227830180627             AT END
227840180627                    GO TO SLP-EXIT
227850180627             WHEN WS-PARM-ARRAY-INVESTM-SERIES(WS-LWADIDX) =
227860180723                  lc_InvestmentSeries AND
227870180703                  WS-PARM-ARRAY-AGE-UPPER-LIMIT(WS-LWADIDX) >=
227880180627                  WS-GLWA-Ann-Calendar-Age
227890180627                    MOVE WS-PARM-ARRAY-INVESTM-SERIES(WS-LWADIDX)
227900180627                       TO WS-INVEST-SERIES-LWA
227910180627                    MOVE WS-PARM-ARRAY-AGE-UPPER-LIMIT(WS-LWADIDX)
227920180730                       TO WS-AGE-UPPER-LIMIT-LWA
227930180730                    IF lc_jointFoundFlag = "Y" AND
227940180730                       WS-PARM-ARRAY-ALT-GWA-PERCENT(WS-LWADIDX)> 0
227950180730                       MOVE WS-PARM-ARRAY-ALT-GWA-PERCENT(WS-LWADIDX)
227960180730                            TO WS-GWA-PERCENT-LWA
227970180730                    ELSE
227980180730                       MOVE WS-PARM-ARRAY-GWA-PERCENT(WS-LWADIDX)
227990180730                            TO WS-GWA-PERCENT-LWA
228000180627                    END-IF
228010180627                    MOVE WS-PARM-ARRAY-LWA-Projection(WS-LWADIDX)
228020180627                       TO WS-LWA-PROJECTION-SET
228030180627                    GO TO SLP-0015
228040180627             WHEN WS-PARM-ARRAY-INVESTM-SERIES(WS-LWADIDX) = " "
228050180627                    GO TO SLP-EXIT
228060180627           END-SEARCH.
228070180627
228080180627
228090180925       SLP-0015.
228100180925      *RFS1005820 START
228110180925      *    IF WS-AGE-UPPER-LIMIT-LWA > WS-BONUS-AGE-THRESHOLD
228120180925      *       MOVE 0 TO WS-GWA-PERCENT-GGWB
228130180925      *    END-IF.
228140180925           Compute WS-GBBBonusAmount ROUNDED = (WS-GBB-Calc *
228150180725                                            WS-GWA-PERCENT-GGWB) / 100.
228160180925           IF WS-AGE-UPPER-LIMIT-LWA > WS-BONUS-AGE-THRESHOLD
228170180925           Compute WS-GBBBonusAmount ROUNDED = WS-GBBBonusAmount *
228180180925               (WS-BONUS-AGE-THRESHOLD - WS-GLWA-Ann-Calendar-Age + 1)
228190180925           ELSE
228200180925           Compute WS-GBBBonusAmount ROUNDED = WS-GBBBonusAmount *
228210180725               (WS-AGE-UPPER-LIMIT-LWA - WS-GLWA-Ann-Calendar-Age + 1)
228220180925           END-IF.
228230180719      *RFS1005820 END
228240180703           Compute WS-GWBProjectionAmount ROUNDED= WS-GBBBonusAmount +
228250180904                                            WS-GWB-Calc.
228260180703      *    Move WS-GWBProjectionAmount to WS-GBB-Calc.     RFS1005462
228270180627           Move WS-GWBProjectionAmount to WS-GWB-Calc.
228280180627
228290180627
228300180703       SLP-0020.
228310180702           Compute WS-LWA-Project ROUNDED = (WS-GWBProjectionAmount *
228320180627                                  WS-GWA-PERCENT-LWA) / 100.
228330180627           IF WS-LWA-PROJECTION-SET = "Y"
228340180627              Add 1 to WS-LWA-ROW-CNT
228350180629              IF WS-LWA-ROW-CNT = 1
228360180629                 MOVE WS-AGE-UPPER-LIMIT-LWA TO CD-ATTAINED-AGE-1
228370180627                 MOVE WS-LWA-Project         TO CD-LWA-PROJECTION-1
228380180629                 Move "N" to WS-LWA-PROJECTION-SET
228390180629              ELSE IF WS-LWA-ROW-CNT = 2
228400180629                 MOVE WS-AGE-UPPER-LIMIT-LWA TO CD-ATTAINED-AGE-2
228410180627                 MOVE WS-LWA-Project         TO CD-LWA-PROJECTION-2
228420180629                 Move "N" to WS-LWA-PROJECTION-SET
228430180629              ELSE IF WS-LWA-ROW-CNT = 3
228440180629                 MOVE WS-AGE-UPPER-LIMIT-LWA TO CD-ATTAINED-AGE-3
228450180627                 MOVE WS-LWA-Project         TO CD-LWA-PROJECTION-3
228460180629                 Move "N" to WS-LWA-PROJECTION-SET
228470180629              ELSE IF WS-LWA-ROW-CNT = 4
228480180629                 MOVE WS-AGE-UPPER-LIMIT-LWA TO CD-ATTAINED-AGE-4
228490180627                 MOVE WS-LWA-Project         TO CD-LWA-PROJECTION-4
228500180629                 Move "N" to WS-LWA-PROJECTION-SET
228510180629              ELSE
228520180627                 GO TO SLP-EXIT
228530180627              END-IF
228540180627           END-IF.
228550180627
228560180627
228570180629       SLP-0025.
228580180627           Move WS-AGE-UPPER-LIMIT-LWA to WS-AGE-UPPER-LIMIT-LWA-PRE.
228590180627           SET WS-LWADIDX UP BY 1.
228600180627           If WS-PARM-ARRAY-INVESTM-SERIES(WS-LWADIDX) =
228610180627              WS-INVEST-SERIES-LWA
228620180627              MOVE WS-PARM-ARRAY-INVESTM-SERIES(WS-LWADIDX)
228630180627                   TO WS-INVEST-SERIES-LWA
228640180627              MOVE WS-PARM-ARRAY-AGE-UPPER-LIMIT(WS-LWADIDX)
228650180730                   TO WS-AGE-UPPER-LIMIT-LWA
228660180730              IF lc_jointFoundFlag = "Y" AND
228670180730                 WS-PARM-ARRAY-ALT-GWA-PERCENT(WS-LWADIDX)> 0
228680180730                 MOVE WS-PARM-ARRAY-ALT-GWA-PERCENT(WS-LWADIDX)
228690180730                      TO WS-GWA-PERCENT-LWA
228700180730              ELSE
228710180730                 MOVE WS-PARM-ARRAY-GWA-PERCENT(WS-LWADIDX)
228720180730                      TO WS-GWA-PERCENT-LWA
228730180627              END-IF
228740180627              Move WS-PARM-ARRAY-LWA-Projection(WS-LWADIDX)
228750180702                   TO WS-LWA-PROJECTION-SET
228760180629              Perform Until WS-AGE-UPPER-LIMIT-LWA =
228770180925                      WS-AGE-UPPER-LIMIT-LWA-PRE
228780180725100582          Add 1 to WS-AGE-UPPER-LIMIT-LWA-PRE
228790180725                IF WS-AGE-UPPER-LIMIT-LWA-PRE > WS-BONUS-AGE-THRESHOLD
228800180725                   MOVE 0 TO WS-GWA-PERCENT-GGWB
228810180719                END-IF
228820180703                Compute WS-GBBBonusAmount ROUNDED = (WS-GBB-Calc *
228830180719                                            WS-GWA-PERCENT-GGWB) / 100
228840180719                Compute WS-GWBProjectionAmount ROUNDED =
228850180904                        WS-GBBBonusAmount + WS-GWB-Calc
228860180703      *         Move WS-GWBProjectionAmount to WS-GBB-Calc RFS1005462
228870180925                Move WS-GWBProjectionAmount to WS-GWB-Calc
228880180627      *         Add 1 to WS-AGE-UPPER-LIMIT-LWA-PRE        RFS1005820
228890180701                END-PERFORM
228900180627                GO TO SLP-0020
228910180627           END-IF.
228920180627
228930180627
228940180628       SLP-EXIT.
228950180627           EXIT.
228960180627      *RFS177152 END
228970110601
228980110531      * RFS63488 Begin
228990110531       Check-Inv-GLWB.
229000110531
229010110531           Initialize Lc-Series.
229020110531           MOVE INVESTMENT-SERIES OF ACCOUNT-CONTRACT-REC TO Lc-Inv.
229030110531
229040110531           EXEC SQL
229050070619              SELECT
229060070619                 COALESCE(SUBSTR(SERIES_RULES,70,4), " ")
229070070619              INTO  :LC-SERIES
229080070619              FROM  MFASERRLP
229090070620              WHERE INVESTMENT_SERIES = :LC-INV
229100070620           END-EXEC.
229110080123
229120080123           IF Lc-series = 'GLWB'
229130080123              SET GLWB-Yes TO TRUE
229140080121           ELSE
229150080121              SET GLWB-No  TO TRUE
229160080121           END-IF.
229170080121
229180080121       CIGLWB-EXIT.
229190080121           EXIT.
229200080121      * RFS63488 End
229210121012      *-------------------
229220121011      *-- RFS 42623 Begins
229230121011      *-------------------
229240121011       CalculateGmvCmv.
229250201211      *RFS186198 START
229260201211           IF lb_AccountGuaranteesYes
229270201211              PERFORM GetACINVGInvStruc
229280201211           END-IF.
229290201211      *RFS186198 END
229300121011           MOVE ZEROES TO ld_GuaranteedMaturityVal.
229310121011           MOVE ZEROES TO ld_ContractMarketVal.
229320121011      * RFS46336 - Begin
229330121012           INITIALIZE ld_GuaranteedDthVal
229340080121
229350080121           INITIALIZE ln_tmpDepositMaturityDate
229360080121           SET lncc_resetReqNotFound  TO TRUE
229370080121           IF ln_TopUpAmt = 0
229380080121            EXEC SQL
229390080121             SELECT DEPOSIT_MATURITY_DATE
229400080121                      INTO :ln_tmpDepositMaturityDate
229410080121             FROM   MFAACCCRP
229420080121      * Defect Fix - 29529 Begins
229430080121      *      WHERE  ACCOUNT_NO = :Ws-Reset-Account-No  AND
229440080121      *        CONTRACT_NO     = :Ws-Reset-Contract-No AND
229450080121      *        RESET_NUMBER    = :Ws-Reset-Reset-No
229460080121             WHERE  ACCOUNT_NO = :Ws-Account-No        AND
229470080124               CONTRACT_NO     = :Ws-Contract-No       AND
229480080124               RESET_NUMBER    = :ln_ResetNumber
229490080121      * Defect Fix - 29529 Ends
229500080124            END-EXEC
229510080124      * Check, if it is business date
229520080124            IF ln_tmpDepositMaturityDate  NOT = 0
229530080124              MOVE ln_tmpDepositMaturityDate  TO
229540080121                   BUSINESS-DAY OF BUSINESS-DAY-REC
229550080121              READ BUSINESS-DAY-FILE
229560080121               INVALID KEY
229570080121                CONTINUE
229580080121               NOT INVALID KEY
229590080121                SET lncc_resetReqFound          TO TRUE
229600080121                MOVE ln_tmpDepositMaturityDate  TO li_ResetReqDate
229610090602              END-READ
229620090602      * If reset request date was not found then continue to search it
229630080121              IF lncc_resetReqNotFound
229640080121               IF ln_tmpDepositMaturityDate =
229650080121                     MATURITY-DATE OF ACCOUNT-CONTRACT-REC
229660080121                 MOVE lncc_matTypeCMT TO lc_currMatType
229670080121               ELSE
229680080121                 MOVE lncc_matTypeDMT TO lc_currMatType
229690080121               END-IF
229700080121               INITIALIZE lc_weekendCalc
229710080121               EXEC SQL
229720080121                SELECT WEEKEND_CALC
229730080121                  INTO :lc_weekendCalc
229740080121                FROM   MFASEGIRLP
229750080125                WHERE
229760210127      *RFS186198 START
229770210127      *           INVESTMENT_STRUCTURE_CODE = :lc-ContractXref AND
229780210127                  ((INVESTMENT_STRUCTURE_CODE = :lc-ContractXref
229790210127                    AND :lc_AccountGuarantees = :lncc_No) OR
229800210127                   (Investment_Structure_Code = :lc_ACINVGInvStruc
229810210127                    AND :lc_AccountGuarantees = :lncc_Yes)) AND
229820210127      *RFS186198 END
22983008012170023             MATURITY_TYPE             = :lc_currMatType  AND
22984008012170023             MAT_RULE                  = " "
229850080121               END-EXEC
229860080121      * Set parameters to get Next/Previous business date
229870080121               IF lc_weekendCalc = lncc_A  OR
229880080121                  lc_weekendCalc = lncc_B
229890080121                 MOVE ln_tmpDepositMaturityDate TO
229900080121                         BUSINESS-DAY OF BUSINESS-DAY-REC
229910080125                 START BUSINESS-DAY-FILE
229920080125                     KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
229930080121                 INVALID KEY
229940080121                  CONTINUE
229950080121                 NOT INVALID KEY
229960080121                   IF lc_weekendCalc = lncc_A
229970080121      * Get Next business day: the logical has descending keys
229980080121                     READ BUSINESS-DAY-FILE PRIOR RECORD
229990080121                     AT END
230000080121                       CONTINUE
230010080121                     NOT AT END
230020080121                       MOVE BUSINESS-DAY OF BUSINESS-DAY-REC TO
230030080121                                            li_ResetReqDate
230040080121                     END-READ
230050070720                   END-IF
230060070720                   IF lc_weekendCalc = lncc_B
230070070720      * Get Previous business day: the logical has desc keys
230080070720                     READ BUSINESS-DAY-FILE NEXT RECORD
230090070720                     AT END
230100070720                       CONTINUE
230110070720                     NOT AT END
230120070720                       MOVE BUSINESS-DAY OF BUSINESS-DAY-REC TO
230130070720                                            li_ResetReqDate
230140070720                     END-READ
230150070720                   END-IF
230160070720                 END-START
230170070720              END-IF
230180070720            END-IF
230190070720           END-IF
230200070720      * RFS46336 - End
230210070720      *** RFS43223 - Start
230220070723           IF ln_TopUpAmt IS EQUAL ZEROS
230230070720           EXEC SQL
230240070720             SELECT
230250070720                DECIMAL(SUM((CASE
230260070720                  WHEN InvuppY.Unit_Price > 0
230270070720                  THEN DECIMAL (ROUND( Acccirp.Curr_Unit_Bal *
230280070720                               InvuppY.Unit_Price/
230290070720                                  COALESCE(Exrhmp.Exchange_Rate,1)
230300070720                                  ,2),13,2)
230310070720                  WHEN InvuppS.Unit_Price > 0
230320070720                  THEN DECIMAL (ROUND( Acccirp.Curr_Unit_Bal *
230330070720                               InvuppS.Unit_Price/
230340070720                                  COALESCE(Exrhmp.Exchange_Rate,1)
230350070720                                  ,2),13,2)
230360070720                        END)),13,2)
230370070720                        As AccMVTot
230380070720               INTO :ld_CalculatedMaturityVal :IND7
230390070720             FROM Mfaacccirp acccirp
230400070720                   LEFT OUTER JOIN Mfainvp Invp
230410070720                     ON Invp.Investment_Code = acccirp.Investment_Code
230420070720                   LEFT OUTER JOIN Mfainvupp InvuppY
230430070720                     ON InvuppY.Trade_Date = :li_ResetReqDate AND
230440070720                        InvuppY.Investment_Code =
230450070723                        Acccirp.Investment_Code AND
230460070720                        InvuppY.Distribution_Flag = :lncc_Yes
230470070723                   LEFT OUTER JOIN Mfainvupp InvuppS
230480070723                     ON InvuppS.Trade_Date = :li_ResetReqDate AND
230490070723                        InvuppS.Investment_Code =
230500070723                        Acccirp.Investment_Code AND
230510070723                        InvuppS.Distribution_Flag = :lncc_Space
230520070723                   LEFT OUTER JOIN Mfaexrhmp Exrhmp
230530070720                     ON Exrhmp.Currency = Invp.Currency AND
230540070621                        Exrhmp.Trade_Date = :li_ResetReqDate AND
230550070621                        Exrhmp.Exchange_Rate_Type = :lc_ExchangeRateType
230560070621             WHERE
230570070621               acccirp.Account_No = :Ws-Account-No AND
230580070621               acccirp.Contract_No = :Ws-Contract-No AND
230590070621               acccirp.reset_number = :ln_ResetNumber
230600070621           END-EXEC
230610070621           MOVE SQLSTATE   TO lc_sqlStates
230620070621
230630070720             IF lncc_sqlSuccessful
230640070621                CONTINUE
230650070619             ELSE
230660070619                MOVE ZEROS TO ld_CalculatedMaturityVal
230670070621             END-IF
230680070621           END-IF.
230690070621      *** RFS43223 - End
230700070621           EXEC SQL
230710070621             SELECT
230720080123               COALESCE(SUM(acccirp.old_guar_base_value), 0)
230730080124               INTO :ld_OldGuarBaseVal
230740080131             FROM Mfaacccirp acccirp
230750080131             WHERE
230760080131               acccirp.Account_No = :Ws-Account-No AND
230770080131               acccirp.Contract_No = :Ws-Contract-No AND
230780080131               acccirp.reset_number = :ln_ResetNumber
230790080131           END-EXEC
230800080131           MOVE SQLSTATE   TO lc_sqlStates.
230810080131
230820080131           IF lncc_sqlSuccessful
230830080131      *--
230840080124      *-- Guaranteed Maturity Value
230850080124      *--
230860080131              COMPUTE ld_GuaranteedMaturityVal ROUNDED =
230870080124              (ld_OldGuarBaseVal * ld_GuaranteePercent / lncc_100)
230880080123      * RFS46336 - Begin: use old guaranteed death value
230890070621              IF lncc_resetAutoGDVYes
230900070621               EXEC SQL
230910070621                SELECT
230920070720                 COALESCE(SUM(acccip.old_guar_death_value), 0)
230930070720                 INTO :ld_OldGuarDthVal
230940070720                FROM Mfaacccip acccip
230950070720                WHERE
230960070720                 acccip.Account_No  = :Ws-Account-No AND
230970070720                 acccip.Contract_No = :Ws-Contract-No
230980070621               END-EXEC
230990070621               COMPUTE ld_GuaranteedDthVal ROUNDED = ld_OldGuarDthVal
231000070720              ELSE
231010070720               COMPUTE ld_GuaranteedDthVal ROUNDED =
231020070720                ld_OldGuarBaseVal *  ld_GuaranteeDthPercent / lncc_100
231030070621              END-IF
231040070619      * RFS46336 - End
231050090730      *--
231060090730      *-- Contract Market Value
231070090730      *--
231080090730      *** RFS43223 - Start
231090140604            IF ln_TopUpAmt IS EQUAL ZEROS
231100140604              COMPUTE ld_ContractMarketVal ROUNDED =
231110140604               ld_CalculatedMaturityVal
231120140604            ELSE
231130101126      *** RFS43223 - End
231140080123              COMPUTE ld_ContractMarketVal ROUNDED =
231150080811              (ld_GuaranteedMaturityVal - ln_TopUpAmt)
231160080123      *** RFS43223 - Start
231170070619            END-IF
231180070619      *** RFS43223 - End
231190070619
231200080721           END-IF.
231210080721R64262     IF CONFIRMATION-RUN
231220080721  |        MOVE ld_GuaranteedMaturityVal TO CD-GUARANTEED-MATURITY-VALUE
231230080721  V        MOVE ld_ContractMarketVal TO CD-CONTRACT-MARKET-VALUE
231240080721R64262     END-IF.
231250080721      * RFS132848 - BEGIN
23126008072183774 *    IF CD-CONTRACT-STATUS Not = "C"
231270080721           IF (CD-CONTRACT-STATUS Not = "C" AND lc_SegSysMat NOT = 'Y')
231280080721      * RFS132848 - END
23129008072183774         OR CD-CONTRACT-CLOSE-DATE > WS-LDA-ENDDTE
231300080721      * RFS46336 - Begin: use old guaranteed death value
231310080721           MOVE ld_GuaranteedDthVal TO CD-GUARANTEED-DEATH-VALUE.
231320080721      * RFS46336 - End
231330080721      *-------------------
231340080721      *-- RFS 42623 Ends
231350080721      *-------------------
231360080721      * RFS52779 Starts : Getting the younger Annuitant's DOB to       *
231370080721      *                   be used as Ws-Date-Of-Birth-N                *
231380080721      *-------------------------
231390080721       GetYoungerAnnuitantDOB.
231400080721      *-------------------------
231410090505           INITIALIZE pc_AnnuitFlag,       pi_AnnuitAccountNo,
231420090505                      pi_AnnuitContractNo, pi_AnnSequenceNo,
231430090505                      pc_AnnuitantStatus,  pi_DateOfBirth,
231440090505                      pc_FirstName,        pc_LastName,
231450080721                      pc_AnnuitReturnCode.
231460080721
231470080425           SET pb_YoungerAnnuit TO TRUE.
231480080425           COMPUTE pi_AnnuitAccountNo  = WS-ACCOUNT-NO.
231490080429           CALL "FXACCANUIT" USING pc_AnnuitFlag,
231500080429                                   pi_AnnuitAccountNo,
231510080429                                   pi_AnnuitContractNo,
231520080429                                   pi_AnnSequenceNo,
231530080429                                   pc_AnnuitantStatus,
231540080430                                   pi_DateOfBirth,
231550080429                                   pc_FirstName,
231560080429                                   pc_LastName,
231570080430      * RFS55414 - Begin: added new returned parameters
231580080430                                   pi_socialInsuranceNo,
231590080430                                   pc_sex,
231600080429      * RFS55414 - End
231610080505                                   pc_AnnuitReturnCode.
231620080502      * RFS52779 Ends                                                  *
231630080505      *RFS47406 Start
231640080505       SetGLWBDetail.
231650080502
231660080505           MOVE lc_InvestmentSeries  TO CD-Series-ID.
231670080502           MOVE SPACE                TO CD-Series-Description.
231680080429           MOVE ZERO                 TO CD-Contract-Year.
231690080502           IF  START-DATE OF ACCOUNT-CONTRACT-REC > 0
231700080502               MOVE START-DATE OF ACCOUNT-CONTRACT-REC TO ld_StartDate
231710080502               COMPUTE CD-Contract-Year =
231720080502                               ld_AsAtDateCCYY - ld_StartDateCCYY + 1
231730080502               IF CD-Contract-Year < 0
231740080502                  MOVE ZERO    TO CD-Contract-Year
231750080502               END-IF
231760180709           END-IF.
231770180709      *RFS177152 START -Moved above so its populated for every contract
231780180709      *    MOVE ld_GuaranteePercent  TO CD-Maturity-Benefit-Percentage.
231790180709      *    IF GUARANTEE-DTH-PERCENT OF ACCOUNT-CONTRACT > 0
231800180709      *      MOVE GUARANTEE-DTH-PERCENT OF ACCOUNT-CONTRACT
231810180709      *        TO CD-Death-Benefit-Percentage
231820180709      *    ELSE
231830180709      *      MOVE ld_GuaranteeDthPercent TO CD-Death-Benefit-Percentage
231840180709      *    END-IF.
231850100305      *RFS177152 END
231860100302           MOVE ZERO                 TO CD-GW-Base-Value.
231870100302           EXEC SQL
231880100302             SELECT
231890100302                   COALESCE(SUM(Acccip.Guar_Withdrawal_Base_Value), 0)
231900100302             INTO      :ln_TotGuarWthdrlBaseVal
231910080502             FROM
231920080502               Mfaacccip acccip
231930080502             WHERE
231940080502               acccip.Account_No  = :Ws-Account-No AND
231950080502               acccip.Contract_No = :Ws-Contract-No
231960080502           END-EXEC.
231970080502      *RFS78161 Begin
231980080502      *    MOVE ln_TotGuarWthdrlBaseVal TO CD-GW-Base-Value.
231990080502           IF ln_TotGuarWthdrlBaseVal >= 0
232000080502              MOVE ln_TotGuarWthdrlBaseVal TO CD-GW-Base-Value
232010080502              MOVE ' '                     TO CD-GW-Base-Value-Sign
232020100304           ELSE
232030100304              COMPUTE CD-GW-Base-Value = -1 * ln_TotGuarWthdrlBaseVal
232040100304              MOVE '-'                     TO CD-GW-Base-Value-Sign
232050100304           END-IF
232060100305      *RFS78161 End
232070100304           MOVE ZERO                    TO CD-FIE-Base-Value.
232080100304           EXEC SQL
232090100304             SELECT
232100100304                   COALESCE(SUM(Acccip.Guar_Withdrawal_Balance), 0)
232110100304             INTO      :ln_TotGuarWthdrlBal
232120080502             FROM
232130080502               Mfaacccip acccip
232140100304             WHERE
232150100304               acccip.Account_No  = :Ws-Account-No AND
232160100304               acccip.Contract_No = :Ws-Contract-No
232170100305           END-EXEC.
232180100304      *RFS78161 Begin
232190080502      *    MOVE ln_TotGuarWthdrlBal      TO CD-FIE-Base-Value.
232200080502           IF ln_TotGuarWthdrlBal     >= 0
232210080502              MOVE ln_TotGuarWthdrlBal     TO CD-FIE-Base-Value
232220100304              MOVE ' '                     TO CD-FIE-Base-Value-Sign
232230100304           ELSE
232240100304              COMPUTE CD-FIE-Base-Value = -1 * ln_TotGuarWthdrlBal
232250100304              MOVE '-'                     TO CD-FIE-Base-Value-Sign
232260100305           END-IF
232270100304      *RFS78161 End
232280100304           MOVE ZERO                     TO CD-GLWA-Rate.
232290100304           IF  GUAR-WITHDRAWAL-PERCENT OF ACCOUNT-CONTRACT-REC > 0
232300100304               MOVE GUAR-WITHDRAWAL-PERCENT OF ACCOUNT-CONTRACT-REC
232310100304                                TO CD-GLWA-Rate
232320080502      *RFS78161 Begin
232330080502               MOVE ' '                     TO CD-GLWA-Rate-Sign
232340100304      *RFS78161 End
232350100304               MOVE lncc_Yes    TO CD-GLWA-Rate-Locked-In
232360100304           ELSE
232370100304               PERFORM Get-GWA-Percent
232380100304      *RFS78161 Begin
232390100304      *        MOVE pn_GLWBVldGWAPercent TO CD-GLWA-Rate
232400100304               IF pn_GLWBVldGWAPercent >= 0
232410100305                  MOVE pn_GLWBVldGWAPercent TO CD-GLWA-Rate
232420100304                  MOVE ' '                  TO CD-GLWA-Rate-Sign
232430100304               ELSE
232440100304                  COMPUTE CD-GLWA-Rate = -1 * pn_GLWBVldGWAPercent
232450100304                  MOVE '-'                  TO CD-GLWA-Rate-Sign
232460100304               END-IF
232470100304      *RFS78161 End
232480100304               MOVE lncc_No              TO CD-GLWA-Rate-Locked-In
232490100304           END-IF.
232500100304      *RFS78161 Begin
232510100304      *    MOVE PREV-GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC
232520100304      *                              TO CD-GLWA-Previous-YR-Value.
232530100304           IF PREV-GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC >= 0
232540100305              MOVE PREV-GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC
232550100304                                     TO CD-GLWA-Previous-YR-Value
232560100304              MOVE SPACE             TO CD-GLWA-Previous-YR-Value-Sign
232570100304              MOVE ' '               TO CD-GLWA-Previous-YR-Value-Sign
232580100304           ELSE
232590100304              COMPUTE CD-GLWA-Previous-YR-Value  = -1 *
232600100304                 PREV-GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC
232610080430              MOVE '-'               TO CD-GLWA-Previous-YR-Value-Sign
232620080430           END-IF
232630080430      *RFS78161 End
232640100304      *RFS78161 Begin
232650100304      *    MOVE GUAR-WITHDRAWAL-AMOUNT      OF ACCOUNT-CONTRACT-REC
232660100305      *                              TO CD-GLWA-Current-YR-Value.
232670100304           IF GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC >= 0
232680100304              MOVE GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC
232690100304                                     TO CD-GLWA-Current-YR-Value
232700100304              MOVE ' '               TO CD-GLWA-Current-YR-Value-Sign
232710100304           ELSE
232720100304              COMPUTE CD-GLWA-Current-YR-Value  = -1 *
232730080430                 GUAR-WITHDRAWAL-AMOUNT OF ACCOUNT-CONTRACT-REC
232740080430              MOVE '-'               TO CD-GLWA-Current-YR-Value-Sign
232750100304           END-IF
232760100304      *RFS78161 End
232770100305           COMPUTE CD-GLWA-Remaining-YTD-Value =
232780100304                GUAR-WITHDRAWAL-AMOUNT      OF ACCOUNT-CONTRACT-REC -
232790100304                YTD-GUAR-WITHDRAWAL-AMOUNT  OF ACCOUNT-CONTRACT-REC.
232800100304      *RFS78161 Begin
232810100304           IF CD-GLWA-Remaining-YTD-Value >= 0
232820100304              MOVE ' '       TO CD-GLWA-Remaining-YTD-Value-Sg
232830100304           ELSE
232840080430              COMPUTE CD-GLWA-Remaining-YTD-Value =  -1 *
232850080430                      CD-GLWA-Remaining-YTD-Value
232860100304              MOVE '-'       TO CD-GLWA-Remaining-YTD-Value-Sg
232870100304           END-IF
232880100305      *RFS78161 End
232890100304           MOVE YTD-GUAR-WITHDRAWAL-AMOUNT  OF ACCOUNT-CONTRACT-REC
232900100304                                    TO CD-GLWA-Withdrawn-YTD-Value.
232910100304      *RFS78161 Begin
232920100304           IF CD-GLWA-Withdrawn-YTD-Value >= 0
232930100304              MOVE ' '       TO CD-GLWA-Withdrawn-YTD-Value-Sg
232940100304           ELSE
232950080508              COMPUTE CD-GLWA-Withdrawn-YTD-Value =  -1 *
232960080508                      CD-GLWA-Withdrawn-YTD-Value
232970080508              MOVE '-'       TO CD-GLWA-Withdrawn-YTD-Value-Sg
232980080508           END-IF
232990080508      *RFS78161 End
233000080508           MOVE YTD-EXCESS-WITHDRAWAL       OF ACCOUNT-CONTRACT-REC
233010120307                                    TO CD-Excess-GLWA-Withdrawn-YTD.
233020120307      *RFS78161 Begin
233030120307           IF CD-Excess-GLWA-Withdrawn-YTD >= 0
233040120307              MOVE ' '       TO CD-Excess-GLWA-Withdrawn-YTD-S
233050120307           ELSE
233060120307              COMPUTE CD-Excess-GLWA-Withdrawn-YTD =  -1 *
233070120307                      CD-Excess-GLWA-Withdrawn-YTD
233080120307              MOVE '-'       TO CD-Excess-GLWA-Withdrawn-YTD-S
233090080508           END-IF
233100080501      *RFS78161 End
233110080501           IF AWD-OPTION OF ACCOUNT-CONTRACT-REC = lnc_F
233120080501              MOVE lnc_FIXED     TO CD-GLWA-AWD-Withdrawal-Option
233130080501           ELSE
233140080430             IF AWD-OPTION OF ACCOUNT-CONTRACT-REC = lnc_G
233150100304                MOVE lnc_GLWA    TO CD-GLWA-AWD-Withdrawal-Option
233160100304             ELSE
233170100305106701*--- Beg        -----------------------------------------------*
233180100304             IF AWD-OPTION OF ACCOUNT-CONTRACT-REC = lnc_O
233190100304                MOVE lnc_ORIG    TO CD-GLWA-AWD-Withdrawal-Option
233200100304             ELSE
233210100304             IF AWD-OPTION OF ACCOUNT-CONTRACT-REC = lnc_C
233220100304                MOVE lnc_CMIN    TO CD-GLWA-AWD-Withdrawal-Option
233230100304             ELSE
233240080430106701*--- Beg End    -----------------------------------------------*
233250080430                MOVE SPACE       TO CD-GLWA-AWD-Withdrawal-Option.
233260080611           IF AWD-OPTION OF ACCOUNT-CONTRACT-REC = lnc_F
233270080611              THEN  MOVE AWD-AMOUNT       OF ACCOUNT-CONTRACT-REC
233280080611                                    TO CD-GLWA-AWD-Withdrawal-Amount
233290080611              ELSE  MOVE ZERO       TO CD-GLWA-AWD-Withdrawal-Amount
233300080611           END-IF.
233310080818      *RFS78161 Begin
233320080819           IF CD-GLWA-AWD-Withdrawal-Amount >= 0
233330080819              MOVE ' '       TO CD-GLWA-AWD-Withdrawal-Amt-Sg
233340080611           ELSE
233350080818              COMPUTE CD-GLWA-AWD-Withdrawal-Amount  =  -1 *
233360080818                      CD-GLWA-AWD-Withdrawal-Amount
233370080818              MOVE '-'       TO CD-GLWA-AWD-Withdrawal-Amt-Sg
233380080818           END-IF
233390080818      *RFS78161 End
233400080818           MOVE AWD-SPLIT-OPTION          OF ACCOUNT-CONTRACT-REC
233410080818                                    TO CD-GLWA-AWD-Split-Option.
233420080818
23343008081847406 * Fix defect 7 - If Initial Day 0, then use MFASGGWRLP
233440080818
233450080818           If INITIAL-DEPOSIT-DAYS  OF ACCOUNT-CONTRACT-REC = 0
233460080818
233470080819      *RFS50993.2 - Start
233480080818              MOVE ZERO           TO li_InitDepDays
233490080818              MOVE " "            TO lc_InitDepDays
233500080818              EXEC SQL
233510080611      *        SELECT COALESCE(INITIAL_DEPOSIT_DAYS, 0)
233520080611      *          INTO :li_InitDepDays
233530080611      *          FROM MFASGGWRLP
233540080611               SELECT COALESCE(SUBSTR(Series_Rules,21,3)," ")
233550080430                 INTO :lc_InitDepDays
233560080430                 FROM MFASERRLP
233570080429                WHERE INVESTMENT_SERIES = :lc_InvestmentSeries
233580080505              END-EXEC
233590080505
233600080506              IF lc_InitDepDays = " "
233610080506                 MOVE ZERO           TO li_InitDepDays
233620080505              ELSE
233630080505                 INSPECT lc_InitDepDays REPLACING ALL " " BY "0"
233640080505                 MOVE lc_InitDepDays TO li_InitDepDays
233650080429              END-IF
233660080506      *RFS50993.2 - End
233670110404              MOVE li_InitDepDays TO
233680110404                   INITIAL-DEPOSIT-DAYS      OF ACCOUNT-CONTRACT-REC
233690110404           End-If.
23370011040447406 * Fix defect 7 - End
233710080806           MOVE INITIAL-DEPOSIT-DAYS      OF ACCOUNT-CONTRACT-REC
233720080806                                    TO CD-GLWA-Init-Deposit-Days.
233730080806           MOVE ZERO                TO CD-GLWA-Init-Deposit-End-Dte.
233740080806           IF START-DATE OF ACCOUNT-CONTRACT-REC > 0
233750080806               MOVE START-DATE OF ACCOUNT-CONTRACT-REC
233760080806                 TO ld_CCYYMMDD
233770080806               MOVE FUNCTION ADD-DURATION (ld_CCYYMMDD DAYS
233780080806                    INITIAL-DEPOSIT-DAYS OF ACCOUNT-CONTRACT-REC)
233790080806                 TO CD-GLWA-Init-Deposit-End-Dte
233800080806           END-IF.
233810080806           MOVE ZERO                TO CD-GLWA-Annuitant-Calendar-Age.
233820080806           MOVE ZERO                TO ld_GLWADateOfBirth.
233830120612      * RFS93830 - Begin
233840080806R50993*    MOVE "Get Prim. Annuitant's Age" TO WS-SQLERR-STATEMENT.
233850080806           MOVE "Check Joint Annuitant" TO WS-SQLERR-STATEMENT.
233860080806      * RFS93830 - End
233870080806           EXEC SQL
233880080806      *RFS50993 - Start
233890080806           SELECT COALESCE(accnnp.Date_Of_Birth, 0)
233900080806             INTO :ld_GLWADateOfBirth
233910080806             FROM MFAACCNNP accnnp
233920080806             LEFT OUTER JOIN MFAACCANP accanp ON
233930080806                  accnnp.ACCOUNT_NO = accanp.ACCOUNT_NO AND
233940080501                  accnnp.ANNUITANT_SEQ_NO = accanp.ANNUITANT_SEQ_NO
233950080506            WHERE accnnp.ACCOUNT_NO = :WS-ACCOUNT-NO    AND
233960080501                  accanp.CONTRACT_NO = :WS-CONTRACT-NO  AND
233970080506                  accnnp.ANNUITANT_STATUS = "A"         AND
233980081104                  accanp.ANNUITANT_TYPE_CODE = :lnc_P
233990081104105910       FETCH FIRST ROW ONLY
234000081104      *    SELECT COALESCE(Date_Of_Birth, 0)
234010081104      *      INTO :ld_GLWADateOfBirth
234020081104      *      FROM MFAACCNNP
234030081104      *      WHERE ACCOUNT_NO  = :WS-ACCOUNT-NO AND
234040081104      *            ANNUITANT_SEQ_NO =
234050081104      *             (SELECT ANNUITANT_SEQ_NO        FROM MFAACCANP
234060080430      *               WHERE ACCOUNT_NO   = :WS-ACCOUNT-NO     AND
234070080430      *                     CONTRACT_NO  = :WS-CONTRACT-NO    AND
234080100818      *                     ANNUITANT_TYPE_CODE  = :lnc_P )
234090100818      *RFS50993 - End
234100100818           END-EXEC.
234110100818           IF  ld_GLWADateOfBirth  > ZERO
234120100818               Compute CD-GLWA-Annuitant-Calendar-Age
234130100818                            =  ld_AsAtDateCCYY - ld_GLWADOB_CCYY
234140100818      *RFS58251 - Start
234150100818               MOVE ELIGIBLE-DATE       TO CD-GLWA-Eligible-Date
234160100818           ELSE
234170100819               MOVE 0                   TO CD-GLWA-Eligible-Date
234180100819      *    END-IF.
234190100818      *    MOVE ELIGIBLE-DATE       TO CD-GLWA-Eligible-Date.
234200100823           END-IF.
234210100818      *RFS58251 - End
234220100819           MOVE FORCE-DATE          TO CD-GLWA-GLWA-Force-Start-Date.
234230100824           MOVE GWA-START-DATE      TO CD-GWA-Start-Date.
234240100818      * RFS80555  Begins
234250100819           Move lc_InvestmentCode   to pc-InvestmentCode
234260200413           Move lc_InvestmentSeries to pc-InvestmentSeriesCode
234270200413185170*    Call "FXGLWBRULE" using  pc-InvestmentCode
234280200413  |        Call "FXGLWBRULE" using  WS-ACCOUNT-NO
234290100818185170                              pc-InvestmentCode
234300100823                                    pc-InvestmentSeriesCode
234310100824                                    pc-InvestmentSeriesFlag
234320100824                                    pc-RFGWRULErules
234330100824                                    pc-RejectionCode
234340100818
234350100818           If pc-InvestmentSeriesFlag = "Y"
234360100818             Move GPP-Indicator of Account-Contract-Rec
234370100819               TO CD-GPP-Flag
234380100819
234390100819             If WS-AT-RULE (AT1) = 3 OR WS-AT-RULE (AT1) = 5
234400100818               Move Original-GWA of Account-Contract-Rec
234410100826                 TO li_CurrYrGLWA
234420100826             Else
234430100826               Move Guar-Withdrawal-Amount of Account-Contract-Rec
234440100826                 TO li_CurrYrGLWA
234450100826             End-If
234460100826
234470100819             MOVE li_CurrYrGLWA    TO CD-Orig-Curr-YR-GLWA
234480100819
234490100824             If li_CurrYrGLWA < 0
234500100819               Move '-' TO CD-Orig-Curr-YR-GLWA-Sign
234510100819             End-If
234520100819
234530180731             IF Guar-Withdrawal-Percent of Account-Contract-Rec > 0
234540180731      *RFS177152 START
234550180731      * check if contract has joint annuitant.
234560180731               SET lncc_jointFoundNo TO TRUE
234570180731               EXEC SQL
234580180731                SELECT :lncc_Yes
234590180731                 INTO :lc_jointFoundFlag
234600180731                FROM mfaaccanp accanp INNER JOIN mfaaccnnp accnnp ON
234610180731                 accanp.account_no       = accnnp.account_no    AND
234620180731                 accanp.annuitant_seq_no = accnnp.annuitant_seq_no
234630180731                WHERE
234640180731                 accanp.account_no   = :Ws-Account-No           AND
234650180731                 accanp.contract_no  = :Ws-Contract-No           AND
234660180731                 accnnp.default_flag = :lncc_J
234670180731                FETCH FIRST ROW ONLY
234680180731               END-EXEC
234690100819      *RFS177152 END
234700100826               Move Guar-Withdrawal-Percent of Account-Contract-Rec
234710100824                 TO CD-GLWA-YE-Percentage
234720100824             ELSE
234730100824               Perform Calculate-GWA-At-Lid
234740100825             End-If
234750100820           End-If.
234760100825
234770100818       Calculate-GWA-At-Lid.
234780100818
234790100818               MOVE Eligible-Date of Account-Contract-Rec
234800100818                TO li_EligibleDate
234810100818               COMPUTE li_EligibleDateYYYY = li_EligibleDateYYYY - 1
234820100818
234830100823      * Determine the new GWA age. pi_DateofBirth returned from the
234840100818      * function FXACCANUIT is the DOB of the youngest annuitant
234850100818
234860100818               MOVE PI_DateofBirth to li_AnnDOB
234870100818
234880100819               COMPUTE li_AnnuitantAge = li_EligibleDateYYYY
234890100819                     - li_AnnDOBYYYY
234900100819
234910100818               INITIALIZE ln_SaveGWAPercent
234920100818                          ln_AlternateGwaPercent
234930100818               EXEC SQL
234940100818               SELECT COALESCE(GWA_Percent, 0),
234950100818                      Alternate_gwa_percent
234960100818                 INTO :ln_SaveGWAPercent,
234970100818                      :ln_AlternateGwaPercent
234980100818                 FROM MFASGGWRTP
234990100819                WHERE Investment_Series = :lc_InvestmentSeries
235000100819                  AND Age_Upper_Limit >= :li_AnnuitantAge
235010100818                ORDER BY Investment_Series, Age_Upper_Limit
235020110404                FETCH FIRST ROW ONLY
235030110404              END-EXEC
235040110404
235050100818      * check if contract has joint annuitant.
235060100819
235070100825              SET lncc_jointFoundNo TO TRUE
235080100819              EXEC SQL
235090100818               SELECT :lncc_Yes
235100100825                 INTO :lc_jointFoundFlag
235110100826               FROM mfaaccanp accanp INNER JOIN mfaaccnnp accnnp ON
235120100818                 accanp.account_no       = accnnp.account_no    AND
235130100818                 accanp.annuitant_seq_no = accnnp.annuitant_seq_no
235140100818               WHERE
235150080502                 accanp.account_no   = :Ws-Account-No           AND
235160080502                 accanp.contract_no  = :Ws-Contract-No           AND
235170080502                 accnnp.default_flag = :lncc_J
235180080502      *RFS93830 - Begin
235190080502               FETCH FIRST ROW ONLY
235200080502      *RFS93830 - End
235210080502              END-EXEC
235220080807
235230080807              IF lncc_jointFoundYes
235240080807                MOVE ln_AlternateGwaPercent TO CD-GLWA-YE-Percentage
235250080807              ELSE
235260080807                MOVE ln_SaveGWAPercent TO CD-GLWA-YE-Percentage
235270080502              END-IF.
235280080502
235290080502      * RFS80555  Ends
235300080502
235310080502       Get-GWA-Percent.
235320080502           INITIALIZE  pi_GLWBVldPlacementDate
235330080502                       pi_GLWBVldTransNo
235340080502                       pc_GLWBVldContMatchFlag
235350080502                       pi_GLWBVldAccountNo
235360080502                       pi_GLWBVldContractNo
235370080502                       pc_GLWBVldYearEndFlag
235380080502 50474                 pc_GLWBVldInvestCode
235390080502   ¦                   pi_GLWBVldTradeDate
235400080502   ¦                   pc_GLWBVldReversalCode
235410080502 50474                 pc_GLWBVldSameAcctSwitchFlag
235420080807                       pi_GLWBVldEligDate
235430080807                       pi_GLWBVldForceDate
235440080807                       pn_GLWBVldGWAPercent
235450080807                       pi_GLWBVldAnnuitantAge
235460080502                       pc_GLWBVldInitPurchaseFlag
235470080502                       pc_GLWBVldRejectionCode.
235480080502      * Calling Function to get GWA Percentage
235490080502           MOVE WS-Account-No   TO pi_GLWBVldAccountNo.
235500080502           MOVE WS-Contract-No  TO pi_GLWBVldContractNo.
235510080502
235520080425           CALL "FXGLWBVLD" USING pi_GLWBVldPlacementDate,
235530001020                                  pi_GLWBVldTransNo,
235540001020                                  pc_GLWBVldContMatchFlag,
235550001020                                  pi_GLWBVldAccountNo,
235560001020                                  pi_GLWBVldContractNo,
235570001020                                  pc_GLWBVldYearEndFlag,
23558000102050474                             pc_GLWBVldInvestCode,
235590001020  ¦                               pi_GLWBVldTradeDate,
235600001020  ¦                               pc_GLWBVldReversalCode,
23561000102050474                             pc_GLWBVldSameAcctSwitchFlag,
235620001020                                  pi_GLWBVldEligDate,
235630001020                                  pi_GLWBVldForceDate,
235640001020                                  pn_GLWBVldGWAPercent,
235650001020                                  pi_GLWBVldAnnuitantAge,
235660001020                                  pc_GLWBVldInitPurchaseFlag,
235670001020                                  pc_GLWBVldRejectionCode.
235680001020      *RFS47406 End
235690001020
235700001020RF4638***** POPULATE SEG-FUND-ANNUITANT-DETAILS(SECTION 45).
235710001020      ***** First get data from ACCOUNT-CONTRACT-ANNUITANT(MFAACCANP),
235720001020      ***** then read ACCOUNT-ANNUITANT(MFAACCNNP).
235730001020
235740001020001020 POPULATE-ANN-SEG45-ROUTINE.
235750001020
235760001020           INITIALIZE  MFAACCANP
235770001020                       MFAACCNNP.
235780001020
235790001020           MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-REC  TO ACCOUNT-NO
235800001020                            OF ACCOUNT-CONTRACT-ANN-REC.
235810001020           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC  TO CONTRACT-NO
235820001020                            OF ACCOUNT-CONTRACT-ANN-REC.
235830001020           MOVE ZEROS       TO ANNUITANT-SEQ-NO
235840001020                            OF ACCOUNT-CONTRACT-ANN-REC.
235850001020
235860001020           START ACCOUNT-CONTRACT-ANNUITANT
235870001020               KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
235880001020               INVALID KEY
235890001020                  GO TO PANS45R-EXIT
235900001020           END-START.
235910001020
235920001020       PANS45R-READ-ACC-CON-ANN-NEXT.
235930001020
235940011025           READ ACCOUNT-CONTRACT-ANNUITANT NEXT
235950001020               AT END
235960001020                  GO TO PANS45R-EXIT
235970001020           END-READ.
235980001020
235990001020           IF ACCOUNT-NO OF ACCOUNT-CONTRACT-ANN-REC IS NOT EQUAL TO
236000001020                               ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
236010001020           OR CONTRACT-NO OF ACCOUNT-CONTRACT-ANN-REC IS NOT EQUAL TO
236020001020                              CONTRACT-NO OF ACCOUNT-CONTRACT-REC
236030001020              GO TO PANS45R-EXIT
236040011025           END-IF.
236050011025
236060011025      ***** Get data from ACCOUNT-ANUUITANT(MFAACCNNP) file.
236070001020      ***** The same Contract-number from ACCOUNT-CONTRACT-ANNUITANT
236080080806      ***** (MFAACCANP) may have multiple records.   .
236090080806
236100080806R11889     INITIALIZE MFAACCNNP.
236110090116           MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-ANN-REC
236120090116                            TO ACCOUNT-NO OF ACCOUNT-ANNUITANT-REC.
236130080806           MOVE ANNUITANT-SEQ-NO OF ACCOUNT-CONTRACT-ANN-REC
236140050201                       TO ANNUITANT-SEQ-NO OF ACCOUNT-ANNUITANT-REC.
236150001108
236160001108       PANS45R-READ-ACC-ANN-NEXT.
236170001108
236180001108           READ ACCOUNT-ANNUITANT
236190001108               INVALID KEY
236200001108R11889            INITIALIZE MFAACCNNP
236210001020r11889*           INITIALIZE ACCOUNT-ANNUITANT-REC
236220001020r11889            GO TO PANS45R-READ-ACC-CON-ANN-NEXT
236230001020           END-READ.
236240001020
236250001020R50993     IF ANNUITANT-TYPE-CODE OF ACCOUNT-CONTRACT-ANN-REC = "J"
236260001020  ¦           AND ANNUITANT-STATUS OF ACCOUNT-ANNUITANT-REC NOT = "A"
236270001020R59543*       GO TO PANS45R-EXIT
236280001020R59543        GO TO PANS45R-READ-ACC-CON-ANN-NEXT
236290001020R50993     END-IF.
236300001020
236310001020001108     IF WS-LDA-SEG-45           IS EQUAL TO "Y"
236320001020              PERFORM FORMAT-SEG45-ADDRESS-ROUTINE THRU FSA-EXIT
236330001020              GO TO PANS45R-WRITE-SECTION-45
236340001020           ELSE
236350001020              GO TO PANS45R-READ-ACC-CON-ANN-NEXT
236360001020           END-IF.
236370001020
236380001020       PANS45R-WRITE-SECTION-45.
236390001020
236400001020           ADD 1                       TO  WS-ACC-SEG45-COUNT.
236410001020           INITIALIZE ANNUITANT-DETAILS.
236420001020
236430020108           MOVE AD-INVESTOR-NO         TO AN-INVESTOR-NO.
236440020108           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC  TO AN-ACCOUNT.
236450020108           MOVE "45"                   TO AN-SECTION-NO.
236460001020           MOVE WS-ACC-SEG45-COUNT     TO AN-SECTION-SEQUENCE.
236470001020           MOVE AD-LANGUAGE            TO AN-LANGUAGE.
236480001020           MOVE AD-DEALER              TO AN-DEALER.
236490001020           MOVE AD-SALESREP            TO AN-SALESREP.
236500001020
236510001020           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
236520001020                                       TO AN-CONTRACT-NO.
236530001020           IF CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
236540001020                                       IS NOT EQUAL TO SPACES
236550001020              MOVE CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
236560001020                                       TO AN-CONTRACT-XREF
236570001020           END-IF
236580001020
23659000102012062      MOVE ANNUITANT-TYPE-CODE   OF ACCOUNT-CONTRACT-ANN-REC
236600001020                                      TO AN-SUCCESSOR-ANNUITANT.
236610001020
236620001020           MOVE ANNUITANT-STATUS    OF ACCOUNT-ANNUITANT-REC
236630001020                                       TO AN-ANNUITANT-STATUS.
236640001020           MOVE LAST-NAME           OF ACCOUNT-ANNUITANT-REC
236650001020                                       TO AN-LAST-NAME.
236660001020           MOVE INITIALS            OF ACCOUNT-ANNUITANT-REC
236670001020                                       TO AN-INITIALS.
236680001020           MOVE FIRST-NAME          OF ACCOUNT-ANNUITANT-REC
236690001020                                       TO AN-FIRST-NAME.
236700001020           MOVE SALUTATION-CODE     OF ACCOUNT-ANNUITANT-REC
236710001020                                       TO AN-SALUTATION-CODE.
236720011018           MOVE SOCIAL-INSURANCE-NO OF ACCOUNT-ANNUITANT-REC
236730011018                                       TO AN-SOCIAL-INSURANCE-NO.
236740011018           MOVE DATE-OF-BIRTH       OF ACCOUNT-ANNUITANT-REC
236750011018                                       TO AN-DATE-OF-BIRTH.
236760011018           MOVE SEX                 OF ACCOUNT-ANNUITANT-REC
236770001020                                       TO AN-SEX.
236780001020           MOVE SALUTATION-CODE     OF ACCOUNT-ANNUITANT-REC
236790001020                                       TO AN-SALUTATION-CODE.
236800001020           MOVE LANGUAGE-CODE       OF ACCOUNT-ANNUITANT-REC
236810001020                                       TO AN-LANGUAGE-CODE.
236820001020           MOVE DEATH-PROCESS-DATE  OF ACCOUNT-ANNUITANT-REC
236830001020                                       TO AN-DEATH-PROCESS-DATE.
236840001020           MOVE ANNUITANT-DEATH     OF ACCOUNT-ANNUITANT-REC
236850060621                                       TO AN-ANNUITANT-DEATH.
236860030825
236870001020
236880001020R11770     MOVE WS-AN-ADDRESS1         TO AN-ADDRESS1.
236890001020           MOVE WS-AN-ADDRESS2         TO AN-ADDRESS2.
236900001020           MOVE WS-AN-ADDRESS3         TO AN-ADDRESS3.
236910001020           MOVE WS-AN-ADDRESS4         TO AN-ADDRESS4.
236920001020R11770     MOVE WS-AN-ADDRESS5         TO AN-ADDRESS5.
236930001020           MOVE POSTAL-CODE         OF ADDRESS-RECD
236940001020                                       TO AN-POSTAL-CODE.
236950001020           MOVE HOLD-MAIL           OF ADDRESS-RECD
236960001020                                       TO AN-HOLD-MAIL.
236970001020
236980001020           MOVE AD-START-DATE          TO AN-START-DATE.
236990001020           MOVE AD-END-DATE            TO AN-END-DATE.
237000001020
237010001020R18147     MOVE ANNUITANT-DETAILS TO STATEMENT-REC(ISR).
237020001020R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
237030001020
237040001020           INITIALIZE  ANNUITANT-DETAILS.
237050001020           GO TO PANS45R-READ-ACC-CON-ANN-NEXT.
237060001020
237070001020      **********
237080001020
237090001020       PANS45R-EXIT.
237100001020               EXIT.
237110001020
237120011018      **********
237130011018
237140011018
237150011018RF4638***** FORMAT SEG-FUND-ANNUITANT-DETAILS(SECTION 45) Address
237160011018
237170001020001020 FORMAT-SEG45-ADDRESS-ROUTINE.
237180001020
237190001020           INITIALIZE MFAADDP.
237200001020           MOVE ADDR-NO OF ACCOUNT-ANNUITANT-REC
237210001020                        TO ADDR-NO OF ADDRESS-RECD.
237220001020
237230001020           READ ADDRESS-FILE
237240001020               INVALID KEY
237250001020                  INITIALIZE ADDRESS-RECD
237260011018           END-READ.
237270001020
237280001020R11770     MOVE SPACES                 TO  WS-AN-ADDRESS1.
237290001020           MOVE SPACES                 TO  WS-AN-ADDRESS2.
237300001020           MOVE SPACES                 TO  WS-AN-ADDRESS3.
237310001020           MOVE SPACES                 TO  WS-AN-ADDRESS4.
237320001020R11770     MOVE SPACES                 TO  WS-AN-ADDRESS5.
237330001020
237340001020       FSA-0010.
237350090309
237360090506      *****
237370090506      *****    Format the address line 1 with the Care of
237380090309      *****    Attention name.
237390090309      *****
237400090309
237410090309           MOVE CO-OR-ATTENTION
237420090506                OF ADDRESS-RECD        TO  WS-AN-ADDRESS1.
237430090309
237440090506      *****
237450090506      *****    Format the address line 2 with the street
237460090506      *****    number, street name, street type and street direction.
237470090506      *****    Each fields will be handled separately in case one or
237480090305      *****    more of the fields contain spaces.
237490090309      *****
237500090309
23751009030966105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
23752009030966105      Set pb-adrStreet            to True.
23753000102066105      Set pb-AdrProvinceSection45 to True.
23754000102066105      Move STREET-NO        OF ADDRESS-RECD to pc-InStreetNo.
23755000102066105      Move STREET-NAME      OF ADDRESS-RECD to pc-InStreetName.
23756000102066105      Move STREET-TYPE-CODE OF ADDRESS-RECD to pc-InStreetTypeCode.
23757000102066105      Move PROVINCE-CODE    OF ADDRESS-RECD to pc-InProvinceCode.
23758000102066105      Move CITY             OF ADDRESS-RECD to pc-InCity.
23759001101866105      Move STREET-DIRCT-CODE OF ADDRESS-RECD to pc-InDirectionCode.
23760000102066105      Move COUNTRY-CODE OF ADDRESS-RECD to pc-InCountry.
23761000102066105      If   COUNTRY-CODE OF ADDRESS-RECD = " "
23762000102066105           Move "CAN" to pc-InCountry
23763000102066105      End-If.
237640001020
23765000102066105      Call "FXSTRTADR" using pt-StreetAddressAction,
23766000102066105                             pt-StreetAddressIn,
23767001101866105                             pt-StreetAddressOut.
23768000102066105      Move pc-OutStreet To WS-AN-ADDRESS2.
237690001020      *****
237700001020      *****    Format the address line 3 with the miscellaneou         s
237710001020      *****    first address.
237720001020      *****
237730001020
237740001020           MOVE MISC-FIRST-ADDR-LINE
237750001020                OF ADDRESS-RECD        TO  WS-AN-ADDRESS3.
237760001020
237770001020      *****
237780001020      *****    Format the address line 4 with the miscellaneou         s
237790090506      *****    second address.
237800090506      *****
237810090506
237820090506           MOVE MISC-SECOND-ADDR-LINE
237830090506                OF ADDRESS-RECD        TO  WS-AN-ADDRESS4.
237840090506
237850090506      *****
237860090506      *****    Format address line 5 using the City, Province and Postal
237870090506      *****    Code.  Each field will be handled separately in case one
237880090506      *****    or more of the fields contain spaces.
237890090506      *****
237900001020
237910001020           MOVE SPACES                 TO  WS-ADRTMP.
237920001020
237930001020       FSA-0040.
237940001020
23795000102066105      IF  COUNTRY-CODE OF ADDRESS-RECD   EQUAL TO  "CAN" OR
23796000102066105          COUNTRY-CODE OF ADDRESS-RECD   EQUAL TO  "USA"
23797000102066105          Move Spaces           to lc-Line80
23798009030666105          String function trim(pc-OutProvince) " "
23799000102066105              COUNTRY-CODE OF ADDRESS-RECD
23800009030666105              Delimited by Size
23801009030666105          Into lc-Line80
23802009030666105          Move lc-Line80 (1:40) to WS-AN-ADDRESS5
23803000102066105         Else
23804000102066105          Move pc-OutProvince   to WS-AN-ADDRESS5
23805001101866105      END-IF.
238060001020
238070011018      *****
238080001020      *****    If processing a dealer rep address which is not Canadian,
238090011018      *****    the country code or name is to be printed on a separate
238100001020      *****    line.  If blank lines do not exist, the country code will
238110011018      *****    be formatted on address line 5.
238120001020      *****
238130011018
238140001020           MOVE SPACES                 TO  WS-DL-BRANCH-ADDR6.
238150001020
238160001020           IF  COUNTRY-CODE
238170001020               OF ADDRESS-RECD   EQUAL TO  "CAN"
238180001020               GO TO FSA-0070.
238190001020
238200001020           MOVE ZEROES                 TO  WS-BLKADR-CNT.
238210001020           IF  WS-AN-ADDRESS1    EQUAL TO  SPACES
238220001020               ADD 1                   TO  WS-BLKADR-CNT.
238230001020           IF  WS-AN-ADDRESS2    EQUAL TO  SPACES
238240090309               ADD 1                   TO  WS-BLKADR-CNT.
238250090506           IF  WS-AN-ADDRESS3    EQUAL TO  SPACES
238260090506               ADD 1                   TO  WS-BLKADR-CNT.
238270090506           IF  WS-AN-ADDRESS4    EQUAL TO  SPACES
238280090309               ADD 1                   TO  WS-BLKADR-CNT.
238290090309           IF  WS-AN-ADDRESS5    EQUAL TO  SPACES
238300090309               ADD 1                   TO  WS-BLKADR-CNT.
238310001020
238320001020           IF  WS-BLKADR-CNT GREATER THAN  1
238330001020               GO TO FSA-0060.
238340001020
238350001020      *****
238360001020      *****    Blank lines do not exist, therefore the country code will
238370001020      *****    be formatted on address line 5.
238380001020      *****
238390001020
23840000102066105      Move Spaces           to lc-Line80.
23841000102066105      String function trim(WS-AN-ADDRESS5) "   "
23842009030966105             COUNTRY-CODE OF ADDRESS-RECD
23843009030666105             DELIMITED BY  SIZE
23844000102066105        Into lc-Line80.
23845000102066105      Move lc-Line80 (1:40) to WS-AN-ADDRESS5.
23846000102066105
238470001020           GO TO FSA-0070.
238480001020
238490001020       FSA-0060.
238500011018
238510001020      *****
238520001020      *****    Blank address lines exist, therefore format the country
238530001020      *****    on a separate line.  If American, use the country code.
238540011018      *****    Otherwise, read the Country record and use the full
238550001020      *****    country name.
238560011018      *****
238570011018
23858000102066105      Move pc-OutCountry          TO  WS-DL-BRANCH-ADDR6.
238590001020
238600011018       FSA-0070.
238610001020
238620011018      *****
238630011018      *****    Compress the investor address lines.
238640001020      *****
238650001020
238660011018           IF  WS-AN-ADDRESS1
238670001020                          IS NOT EQUAL TO  SPACES
238680011018               GO TO FSA-0080.
238690011018
238700001020           IF  WS-AN-ADDRESS2
238710001020                          IS NOT EQUAL TO  SPACES
238720011018               MOVE WS-AN-ADDRESS2    TO  WS-AN-ADDRESS1
238730001020               MOVE SPACES            TO  WS-AN-ADDRESS2
238740011018               GO TO FSA-0080.
238750011018
238760010406           IF  WS-AN-ADDRESS3
238770001020                          IS NOT EQUAL TO  SPACES
238780001020               MOVE WS-AN-ADDRESS3    TO  WS-AN-ADDRESS1
238790001020               MOVE SPACES            TO  WS-AN-ADDRESS3
238800011018               GO TO FSA-0080.
238810001020
238820001020           IF  WS-AN-ADDRESS4
238830001020                          IS NOT EQUAL TO  SPACES
238840001020               MOVE WS-AN-ADDRESS4    TO  WS-AN-ADDRESS1
238850001020               MOVE SPACES            TO  WS-AN-ADDRESS4
238860011018               GO TO FSA-0080.
238870001020
238880001020           IF  WS-AN-ADDRESS5
238890001020                          IS NOT EQUAL TO  SPACES
238900011018               MOVE WS-AN-ADDRESS5     TO  WS-AN-ADDRESS1
238910001020               MOVE SPACES             TO  WS-AN-ADDRESS5
238920011018               GO TO FSA-0080.
238930011018
238940001020           IF  WS-DL-BRANCH-ADDR6
238950001020                          IS NOT EQUAL TO  SPACES
238960011018               MOVE WS-DL-BRANCH-ADDR6 TO  WS-AN-ADDRESS1
238970001020               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
238980011018
238990011018           GO TO FSA-EXIT.
239000001020
239010001020       FSA-0080.
239020011018           IF  WS-AN-ADDRESS2
239030001020                          IS NOT EQUAL TO  SPACES
239040011018               GO TO FSA-0090.
239050011018
239060010406           IF  WS-AN-ADDRESS3
239070001020                          IS NOT EQUAL TO  SPACES
239080001020               MOVE WS-AN-ADDRESS3    TO  WS-AN-ADDRESS2
239090001020               MOVE SPACES            TO  WS-AN-ADDRESS3
239100011018               GO TO FSA-0090.
239110001020
239120001020           IF  WS-AN-ADDRESS4
239130001020                          IS NOT EQUAL TO  SPACES
239140001020               MOVE WS-AN-ADDRESS4    TO  WS-AN-ADDRESS2
239150001020               MOVE SPACES            TO  WS-AN-ADDRESS4
239160011018               GO TO FSA-0090.
239170001020
239180001020           IF  WS-AN-ADDRESS5
239190001020                          IS NOT EQUAL TO  SPACES
239200011018               MOVE WS-AN-ADDRESS5     TO  WS-AN-ADDRESS2
239210001020               MOVE SPACES             TO  WS-AN-ADDRESS5
239220011018               GO TO FSA-0090.
239230011018
239240001020           IF  WS-DL-BRANCH-ADDR6
239250001020                          IS NOT EQUAL TO  SPACES
239260011018               MOVE WS-DL-BRANCH-ADDR6 TO  WS-AN-ADDRESS2
239270001020               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
239280011018
239290011018           GO TO FSA-EXIT.
239300010406
239310001020       FSA-0090.
239320001020           IF  WS-AN-ADDRESS3
239330001020                          IS NOT EQUAL TO  SPACES
239340011018               GO TO FSA-0100.
239350001020
239360001020           IF  WS-AN-ADDRESS4
239370001020                          IS NOT EQUAL TO  SPACES
239380001020               MOVE WS-AN-ADDRESS4    TO  WS-AN-ADDRESS3
239390001020               MOVE SPACES            TO  WS-AN-ADDRESS4
239400010406               GO TO FSA-0100.
239410011018
239420001020           IF  WS-AN-ADDRESS5
239430010406                          IS NOT EQUAL TO  SPACES
239440010406               MOVE WS-AN-ADDRESS5     TO  WS-AN-ADDRESS3
239450011018               MOVE SPACES             TO  WS-AN-ADDRESS5
239460001020               GO TO FSA-0100.
239470011018
239480011018           IF  WS-DL-BRANCH-ADDR6
239490010406                          IS NOT EQUAL TO  SPACES
239500001020               MOVE WS-DL-BRANCH-ADDR6 TO  WS-AN-ADDRESS3
239510001020               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
239520001020
239530011018           GO TO FSA-EXIT.
239540001020
239550001020       FSA-0100.
239560001020
239570001020           IF  WS-AN-ADDRESS4
239580001020                          IS NOT EQUAL TO  SPACES
239590001020               GO TO FSA-EXIT.
239600001020
239610001020           IF  WS-AN-ADDRESS5
239620001020                          IS NOT EQUAL TO  SPACES
239630001020               MOVE WS-AN-ADDRESS5     TO  WS-AN-ADDRESS4
239640001020               MOVE SPACES             TO  WS-AN-ADDRESS5
239650001020               GO TO FSA-EXIT.
239660001020
239670001024           IF  WS-DL-BRANCH-ADDR6
239680001020                          IS NOT EQUAL TO  SPACES
239690001023               MOVE WS-DL-BRANCH-ADDR6 TO  WS-AN-ADDRESS4
239700041229               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
239710151202
239720151202      **********
239730001020
239740001020       FSA-EXIT.
239750060608           EXIT.
239760001020
239770060608      **********
239780001021
239790060608RF4638***** POPULATE RESET-CONTRACT-DETAILS(SECTION 90). First get data
239800001023      ***** in ACCOUNT-CONTRACT(MFAACCONP), ACCOUNT-CONTRACT-INVESTMENT
239810001020      ***** (MFAACCCIP), then read ACCOUNT-CONTRACT-INVESTMENT-RESET.
239820001020
239830001020001024 POPULATE-REST-SEG90-ROUTINE.
239840001020
239850001030           INITIALIZE  ACCOUNT-CON-INV-SET-REC.
239860001030R25469     INITIALIZE  WS-RESET-CATEGORY.
239870001020151412     SET lb_LWAProcessNo TO TRUE.
239880001020151412     SET lb_LWAExistNo TO TRUE.
239890001020
239900001020           MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-INV-REC  TO ACCOUNT-NO
239910001020                            OF ACCOUNT-CON-INV-SET-REC.
239920001020           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC  TO CONTRACT-NO
239930001020                            OF ACCOUNT-CON-INV-SET-REC.
239940151202           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
239950151202                        TO INVESTMENT-CODE OF ACCOUNT-CON-INV-SET-REC.
239960151202           MOVE ZEROS   TO RESET-NUMBER OF ACCOUNT-CON-INV-SET-REC.
239970151202
239980001030           START ACCOUNT-CONTRACT-INV-RESET
239990001030               KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
240000001020               INVALID KEY
240010151202                  MOVE ZEROS  TO  RESET-REQ-DATE
240020001020                              OF ACCOUNT-CON-INV-SET-REC
240030060608                  GO TO PRSS90R-EXIT
240040001021           END-START.
240050001020
240060001021       PRSS90R-READ-ACC-CON-ISET-NEXT.
240070001020
240080001021           READ ACCOUNT-CONTRACT-INV-RESET NEXT
240090001022               AT END
240100151202151412           IF  lb_NewLWAContractYes AND
240110151202  |                  lb_LWAExistYes AND lb_LWAProcessNo
240120151202  |                  PERFORM GetLWAAdjReset
240130151202151412            ELSE
240140001030                  MOVE ZEROS  TO  RESET-REQ-DATE
240150001030                              OF ACCOUNT-CON-INV-SET-REC
240160001020                  GO TO PRSS90R-EXIT
240170151202151412           END-IF
240180001020           END-READ.
240190151202
240200151202           IF ACCOUNT-NO OF ACCOUNT-CON-INV-SET-REC    IS NOT EQUAL TO
240210151202                   ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
240220151202           OR CONTRACT-NO OF ACCOUNT-CON-INV-SET-REC   IS NOT EQUAL TO
240230001024                   CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC
240240060608           OR INVESTMENT-CODE OF ACCOUNT-CON-INV-SET-REC NOT EQUAL TO
240250060724                       INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
240260070430151412        IF lb_NewLWAContractYes AND
240270070430  |              lb_LWAExistYes AND lb_LWAProcessNo
240280111014  |              PERFORM GetLWAAdjReset
240290060724151412        ELSE
240300060608              MOVE ZEROS  TO  RESET-REQ-DATE
240310060608                          OF ACCOUNT-CON-INV-SET-REC
240320060724              GO TO PRSS90R-EXIT
240330060724151412        END-IF
240340060724           END-IF.
240350070430151412     IF lb_NewLWAContractYes AND
240360070430151412        lb_LWAExistYes AND lb_LWAProcessNo
240370111014  |           PERFORM GetLWAAdjReset
240380070315151412     END-IF.
240390060724
240400060724      * Date range check was modified to accomadate mass statement run
240410060724R35775* Not to be used for confirms
240420060724R35775      IF WS-LDA-STMT-CNFM-FLAG NOT = "C" and
240430060724R38639         not Edit-GbvRst
240440060724R99853         and not GLWB-YES
240450070315R33447       IF RESET-REQ-DATE  OF ACCOUNT-CON-INV-SET-REC
240460070501  ¦                IS GREATER THAN AD-END-DATE
240470151202  ¦            GO TO PRSS90R-READ-ACC-CON-ISET-NEXT
240480070430R33447       END-IF
240490111014R35775      END-IF.
240500070430
240510070430R35775      IF WS-LDA-STMT-CNFM-FLAG = "C" and
240520070430R38639         not Edit-GbvRst
240530070430R99853         and not GLWB-YES
240540070430R35775       IF RESET-REQ-DATE  OF ACCOUNT-CON-INV-SET-REC
240550070430   ¦                    IS LESS THAN    AD-START-DATE
240560070430   ¦           OR RESET-REQ-DATE  OF ACCOUNT-CON-INV-SET-REC
240570070430   ¦                    IS GREATER THAN AD-END-DATE
240580070430   ¦           GO TO PRSS90R-READ-ACC-CON-ISET-NEXT
240590070430   ¦         END-IF
240600070502R35775      END-IF.
240610070502
240620070502      *  RFS 38639  - begins.
240630070502151412     IF lb_LWAProcessNo
240640070430            IF Edit-GbvRst
240650070430R99853         or GLWB-YES
240660070430              Initialize         Ws-Contract-Resets
240670070430              Move Account-no    of Account-Con-Inv-Set-Rec
240680070430                                 to Ws-Reset-Account-No
240690070430              Move Contract-no   of Account-Con-Inv-Set-Rec
240700070502                                 to Ws-Reset-Contract-No
240710070502              Move Reset-Number  of Account-Con-Inv-Set-Rec
240720070502                                 to Ws-Reset-Reset-No
240730070502              EXEC SQL
240740070502                SELECT RESET_PROCESSED_DATE
240750070502                       INTO :lni-Reset-Process-Date
240760151202                FROM   MFAACCCRP
240770070430                WHERE  ACCOUNT_NO     = :Ws-Reset-Account-No
240780070501                AND    CONTRACT_NO    = :Ws-Reset-Contract-No
240790070430                AND    RESET_NUMBER   = :Ws-Reset-Reset-No
240800130203              END-EXEC
240810060724
240820040928              If SQLCODE = 100
240830070321                 Move zero            to lni-Reset-Process-Date
240840070321              End-If
240850070321
240860151202             IF lni-Reset-Process-Date
240870060724                        IS LESS THAN    AD-START-DATE
240880070321               OR lni-Reset-Process-Date
240890060724                        IS GREATER THAN AD-END-DATE
240900060724               GO TO PRSS90R-READ-ACC-CON-ISET-NEXT
240910060724             END-IF
240920060724151412       END-IF
240930060724            END-IF.
240940060724      *  RFS 38639 - ends.
240950060724
240960060724118007***  ADD 1                       TO  WS-ACC-SEG90-COUNT.
240970090625           INITIALIZE RESET-CONTRACT-DETAILS.
240980090819
240990151202      *RFS37754 - Begins - Reuse existing code 4 both modules
241000090819      *RFS37754 - Added OR lc_SegSysMat and closed IF
241010090819
241020151202151412    IF lb_LWAProcessNo
241030090819R18924     IF WS-MODULE-AUTH         = "Y"
241040090819R37754     OR lc_SegSysMat = lncc_Yes
241050090819   ¦          INITIALIZE     WS-CONTRACT-RESETS
241060090819   ¦          MOVE ACCOUNT-NO    OF ACCOUNT-CON-INV-SET-REC
241070060724   ¦                             TO WS-RESET-ACCOUNT-NO
241080060724   ¦          MOVE CONTRACT-NO   OF ACCOUNT-CON-INV-SET-REC
241090060724   ¦                             TO WS-RESET-CONTRACT-NO
241100060724   ¦          MOVE RESET-NUMBER  OF ACCOUNT-CON-INV-SET-REC
241110090729   ¦                             TO WS-RESET-RESET-NO
241120060724   ¦          EXEC SQL
24113015120257388 *         SELECT RESET_CATEGORY INTO :WS-RESET-CATEGORY:IND3
24114007032164262           SELECT RESET_CATEGORY, RESET_TYPE
241150151202151412          ,MULTI_TYPE_RULE
241160151202   |            INTO   :WS-RESET-CATEGORY:IND3,
241170151202   |                   :WS-RESET-TYPE:IND5
241180151202151412                ,:WS-MULTI-TYPE:IND11
241190060724   |            FROM MFAACCCRP
241200070321   |            WHERE ACCOUNT_NO     = :WS-RESET-ACCOUNT-NO   AND
241210151202   V                  CONTRACT_NO    = :WS-RESET-CONTRACT-NO  AND
24122009061564262                 RESET_NUMBER   = :WS-RESET-RESET-NO
241230120803   ¦          END-EXEC
241240120803   ¦
241250120803   ¦          IF SQLCODE = 100
241260130321   ¦             MOVE SPACES          TO WS-RESET-CATEGORY
241270130321R64262           MOVE SPACES          TO WS-RESET-TYPE
241280120803   ¦          END-IF
241290110506151412        END-IF
241300090819R37754     END-IF.
241310110506151412     IF WS-RESET-TYPE = lncc_GWB
241320130321151412        AND WS-MULTI-TYPE = "4"
241330110506151412        SET lb_LWAExistYes TO TRUE
241340060724151412     END-IF.
241350060724   ¦
241360060724R37754     IF WS-MODULE-AUTH         = "Y"
241370060724151412        OR lb_LWAProcessNo
241380060724R57388*       IF WS-RESET-CATEGORY   = "A"
241390060724      *RFS106211- Start
241400060724R64262*       IF WS-RESET-CATEGORY EQUAL "A" OR "J" AND
241410060724              IF WS-RESET-CATEGORY EQUAL "A" OR "T" OR
241420060724120809                                   "J" OR "P" OR "R" AND
241430060724120809*                                  "J" OR "P" AND
241440060724      *RFS106211- End
241450060724R63488        (
241460060724R64262           WS-RESET-TYPE = lncc_GDV
241470090729R63488           OR WS-RESET-TYPE = lncc_GWB
241480090729120809           OR WS-RESET-TYPE = lncc_GBV
241490090729R63488           OR WS-RESET-TYPE = lncc_GBB )
241500090729   ¦             EXEC SQL
241510090729   ¦               SELECT GDVRST_CONF_SUPPR
241520110506   ¦                      INTO :WS-GDVRST-CONF-SUPPR:IND4
241530130124   ¦               FROM MFAACCGRP
241540130124   ¦               WHERE ACCOUNT_NO     = :WS-RESET-ACCOUNT-NO   AND
241550130128   ¦                     CONTRACT_NO    = :WS-RESET-CONTRACT-NO  AND
241560130124   ¦                     RESET_NUMBER   = :WS-RESET-RESET-NO
241570130124   ¦             END-EXEC
241580130124   ¦
241590130124   ¦             IF SQLCODE = 100
241600130128   ¦                MOVE SPACES         TO WS-GDVRST-CONF-SUPPR
241610110506   ¦             END-IF
241620110506   ¦
241630110506R64262*          IF WS-GDVRST-CONF-SUPPR  = "N"
241640151016   |  *             MOVE "M"           TO RC-RESET-CATEGORY
241650151016   ¦  *          ELSE
241660151016   V  *             MOVE "A"           TO RC-RESET-CATEGORY
241670151016R64262*          END-IF
241680151016      **RFS63488 - Begins
241690151016116317*          IF WS-GDVRST-CONF-SUPPR  = "Y"
241700151016116317** Suppress accounts with An.Resets in section 90 from Confirms
241710151016116317** if editcode BYPRST is "Y", but do not suppress from statements
241720151016116317           IF (WS-GDVRST-CONF-SUPPR  = lncc_Yes   AND
241730151016116317               lb_BYPRST_EditNo)                  OR
241740151016116317              (WS-GDVRST-CONF-SUPPR  = lncc_Yes   AND
241750151016116317               lb_BYPRST_EditYes                  AND
241760151016116317               WS-LDA-STMT-CNFM-FLAG = lncc_C)
241770151016                    GO TO Prss90r-Exit
241780151016                 END-IF
241790151016      **RFS63488 - Ends
241800151016      **RFS152131- Pull out 144231 Start
241810151016R80605*144231    IF  WS-RESET-TYPE IS NOT EQUAL TO Lc_GWB
241820151016R80605*144231    AND WS-RESET-TYPE IS NOT EQUAL TO Lc_GBB
241830110324144231*       IF WS-RESET-TYPE IS EQUAL TO Lc_GDV
241840060724   |  *          MOVE OLD-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
241850060724   |  *                              TO RC-OLD-GUARANTEE-DEATH
241860070321   |  *       MOVE OLD-GUAR-DEATH-VALUE OF ACCOUNT-CONTRACT-INVESTMENT
241870070321   |  *                            TO RC-OLD-GUARANTEE-DEATH
241880070321   |  *          MOVE NEW-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
241890070321   |  *                              TO RC-NEW-GUARANTEE-DEATH
241900070321   |  *       MOVE GUAR-DEATH-VALUE OF ACCOUNT-CONTRACT-INVESTMENT
241910070321144231*                              TO RC-NEW-GUARANTEE-DEATH
241920070321R80605           IF  WS-RESET-TYPE IS NOT EQUAL TO Lc_GWB
241930060724R80605           AND WS-RESET-TYPE IS NOT EQUAL TO Lc_GBB
241940060724                 MOVE OLD-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
241950060724                                     TO RC-OLD-GUARANTEE-DEATH
241960060724                 MOVE NEW-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
241970060724                                     TO RC-NEW-GUARANTEE-DEATH
241980060724      **RFS152131- Pull out 144231 End
241990060608R80605           END-IF
242000001021   v          END-IF
242010001021R18924      END-IF.
242020001021      **RFS37754 - Begins - Exclude Resets with M in section 90
242030130203           IF lc_SegSysMat = lncc_Yes AND
242040001021              Ws-Reset-Category = lncc_M
242050001021              GO TO Prss90r-Exit
242060001021           END-IF.
242070001020      **RFS37754 - Ends
242080001021
242090001020R35775*start
242100001020R33447*    MOVE OLD-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
242110001020  ¦   *                              TO RC-OLD-GUARANTEE-DEATH.
242120001021  ¦   *    MOVE NEW-GUAR-BASE-VALUE OF ACCOUNT-CON-INV-SET-REC
242130001020R33447*                              TO RC-NEW-GUARANTEE-DEATH.
242140151202R35775*end
242150151202
242160151202           MOVE AD-INVESTOR-NO         TO RC-INVESTOR-NO.
242170151202           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC  TO RC-ACCOUNT.
242180151202           MOVE "90"                   TO RC-SECTION-NO.
242190151202118007***  MOVE WS-ACC-SEG90-COUNT     TO RC-SECTION-SEQUENCE.
242200151202           MOVE AD-LANGUAGE            TO RC-LANGUAGE.
242210070316           MOVE AD-DEALER              TO RC-DEALER.
242220070316           MOVE AD-SALESREP            TO RC-SALESREP.
242230070316           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
242240001020                                       TO RC-CONTRACT-NO.
242250001026           IF CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
242260070430                                       IS NOT EQUAL TO SPACES
242270070430              MOVE CONTRACT-XREF OF ACCOUNT-CONTRACT-REC
242280110531                                       TO RC-CONTRACT-XREF
242290130203           END-IF
242300130203151412*Moved the Population of sec 90 to PopulateSection90ResetValue
242310070430151412     IF lb_LWAProcessYes
242320070430151412        PERFORM PopulateLWAValuesSeg90
242330070430151412        SET lb_NewLWAContractNo  TO TRUE
242340130203151412     ELSE
242341211003      *RFS186592 Starts*
242342211003151412*       PERFORM PopulateSection90ResetValue
242343211003           IF ((WS-RESET-TYPE = lncc_GDV
242344211003               AND lc_GuarResetLevelGDV = "P") OR
242345211003                 (WS-RESET-TYPE = lncc_GBV
242346211003               AND lc_GuarResetLevelGBV = "P"))
242347211003               AND lb_AccountGuaranteesYes
242348211003                PERFORM ACCOUNT-RESET-LEVEL
242349211003           ELSE
242350211003                PERFORM PopulateSection90ResetValue
242351211003           END-IF
242352211003      *RFS186592 Ends*
242362070430151412     END-IF.
242370070430           MOVE AD-START-DATE          TO RC-START-DATE
242380070430           MOVE AD-END-DATE            TO RC-END-DATE
242390070430           MOVE 999999                 TO RC-SECTION-SEQUENCE-2
242400001026
242410070316           IF WS-LDA-SEG-90                 IS EQUAL TO "Y"
242411211003      *RFS186592 Starts*
242412211003              IF ((WS-RESET-TYPE = lncc_GDV
242413211003                   AND lc_GuarResetLevelGDV = "P") OR
242414211003                   (WS-RESET-TYPE = lncc_GBV
242415211003                   AND lc_GuarResetLevelGBV = "P"))
242416211003                   AND lb_AccountGuaranteesYes
242417211003                        GO TO PRSS90R-READ-ACC-CON-ISET-NEXT
242418211003                END-IF
242419211003      *RFS186592 Ends*
242420001020      * RFS 38639 - begins.
242430001020              IF Edit-GbvRst
242440001020R63488        OR GLWB-Yes
242450070423118007           ADD 1                       TO li_Seq_No_Cnt
242460070423118007           MOVE li_Seq_No_Cnt          TO RC-SECTION-SEQUENCE
242461211003      *RFS186592 Starts*
242462211003                                                ln_SectionSeqNoAR
242463211003      *RFS186592 Ends*
242470070423                 MOVE RESET-CONTRACT-DETAILS TO TMP-STATEMENT-REC
242480070423                 PERFORM Insert_Tmp_Stm_Extract
242490070423              ELSE
242500070423118007           ADD 1                       TO WS-ACC-SEG90-COUNT
242510001020118007           MOVE WS-ACC-SEG90-COUNT     TO RC-SECTION-SEQUENCE
242511211003      *RFS186592 Starts*
242512211003                                                ln_SectionSeqNoAR
242513211003      *RFS186592 Ends*
242520001020      * RFS 38639 - ends.
242530001020R18147           MOVE RESET-CONTRACT-DETAILS TO STATEMENT-REC(ISR)
242540001020R18147           PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
242550001024              END-IF
242560001024           END-IF.
242570001024
242580001024
242590001024      **********
242600031117
242610031117R40761* Start-Logic of GOTO statements is already existing within this
242620031117R40761*  procedure. I have added this GOTO statement to go look for
242630031117R40761*  all the resets info on the account contract investment.
242640031117R40761     GO TO PRSS90R-READ-ACC-CON-ISET-NEXT.
242650031117R40761* End
242660001024
242670001024       PRSS90R-EXIT.
242680001024               EXIT.
242690001024
242700001024      **********
242710001024
242720001024001024***** Get the unit price using Statement end date.
242730001024
242740001024       GET-SEGFUND-UNIT-PRICE.
242750001024
242760001024R18643     MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
242770001024   ¦                            TO WS-PRICE-INVESTMENT-CODE.
242780001024   ¦       MOVE WS-LDA-ENDDTE   TO WS-PRICE-TRADE-DATE.
242790001024   v       PERFORM GET-INVESTMENT-UNIT-PRICE-RTE THRU GIUPR-EXIT.
242800001024R18643     GO TO GSFUP-EXIT.
242810001024
242820001024           INITIALIZE INVESTMENT-PRICE-REC.
242830001024
242840001024           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
242850001024                    TO INVESTMENT-CODE OF INVESTMENT-PRICE-REC.
242860001024           MOVE WS-LDA-ENDDTE
242870001024                    TO TRADE-DATE OF INVESTMENT-PRICE-REC.
242880001024
242890001024       GSFUP-START.
242900001024
242910001024           START INVESTMENT-UNIT-PRICE
242920001024               KEY  IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
242930001024                 INVALID KEY
242940001024                   GO TO GSFUP-0020
242950001024           END-START
242960001024
242970001024           GO TO GSFUP-PRICE-PRIOR.
242980001024
242990001024       GSFUP-0020.
243000001024
243010001024           READ INVESTMENT-UNIT-PRICE LAST
243020001024              AT  END
243030001024                 MOVE ZEROES          TO  UNIT-PRICE
243040001024                                          OF INVESTMENT-PRICE-REC
243050001024              GO TO GSFUP-EXIT
243060001024           END-READ
243070001024
243080001024           GO TO GSFUP-0030.
243090001024
243100001024       GSFUP-PRICE-PRIOR.
243110001024
243120001024           READ INVESTMENT-UNIT-PRICE PRIOR RECORD
243130001024               AT  END
243140001024                   MOVE WS-LDA-ENDDTE   TO  TRADE-DATE
243150001024                                            OF INVESTMENT-PRICE-REC
243160001024                   MOVE ZEROES          TO  UNIT-PRICE
243170080219                                            OF INVESTMENT-PRICE-REC
243180001024                   GO TO GSFUP-EXIT
243190001024           END-READ.
243200001024
243210001024       GSFUP-0030.
243220001024
243230001024           IF INVESTMENT-CODE OF INVESTMENT-PRICE-REC
243240001024              IS NOT EQUAL TO  INVESTMENT-CODE
243250001024                            OF ACCOUNT-CONTRACT-INV-REC
243260001024              MOVE ZEROES             TO  UNIT-PRICE
243270001025                                      OF INVESTMENT-PRICE-REC
243280001025              GO TO GSFUP-EXIT
243290001025           END-IF
243300001025
243310001025           IF TRADE-DATE OF INVESTMENT-PRICE-REC
243320001025                         IS GREATER  THAN  WS-LDA-ENDDTE
24333000102542749          OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
243340001030               GO TO GSFUP-PRICE-PRIOR
243350001025           END-IF.
243360001030
243370001025      **********
243380001025
243390001025       GSFUP-EXIT.
243400001025             EXIT.
243410001025
243420001025      **********
243430001025
243440001025001025***** Get the units, trans-number, placement-date for read
243450001025      ***** TRANS-CONTRACT-DETAILS file.
243460001025
243470001025       GET-TRANS-DATA-ROUTINE.
243480001025
243490001025           INITIALIZE MFATRNP OF TRANS-REC.
243500001025           MOVE ACCOUNT-NO      OF ACCOUNT-CONTRACT-INV-REC
243510001025                           TO ACCOUNT-NO       OF TRANS-REC.
243520001025           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
243530001025                           TO INVESTMENT-CODE  OF TRANS-REC.
243540001025           MOVE WS-LDA-ENDDTE  TO PROCESS-DATE OF TRANS-REC.
243550001025
243560001030           START TRANS
243570001025                 KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
243580001030                 INVALID KEY
243590001025                   GO TO GTDR-INCEPT-TOT-N-0001
243600001025           END-START
243610001025
243620001025           GO TO GTDR-INCEPT-TOT-N-0002.
243630001025
243640001025       GTDR-INCEPT-TOT-N-0001.
243650001025
243660001025           READ TRANS LAST RECORD
243670001025                AT END
243680001025                   GO TO GTDR-EXIT
243690001025           END-READ
243700001025
243710001025           IF ACCOUNT-NO OF TRANS-REC        IS NOT EQUAL TO
243720001030                        ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
243730001025           OR INVESTMENT-CODE OF TRANS-REC   IS NOT EQUAL TO
243740001030               INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
243750001025               GO TO GTDR-EXIT
243760001025           END-IF.
243770001025
243780001025           GO TO GTDR-BAL-NEXT-0001.
243790001025
243800001025       GTDR-INCEPT-TOT-N-0002.
243810001025
243820001025           READ TRANS PRIOR RECORD
243830001030                  AT END
243840001025                     GO TO GTDR-INCEPT-TOT-N-0003
243850001030           END-READ.
243860001025
243870001025           IF ACCOUNT-NO OF TRANS-REC        IS NOT EQUAL TO
243880001025                        ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
243890001025           OR INVESTMENT-CODE OF TRANS-REC   IS NOT EQUAL TO
243900001025               INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
243910001025               GO TO GTDR-INCEPT-TOT-N-0003
243920001025           END-IF.
243930001025
243940001025           GO TO GTDR-BAL-NEXT-0001.
243950001025
243960001025       GTDR-INCEPT-TOT-N-0003.
243970001025
243980001025           INITIALIZE MFATRNP OF TRANS-REC.
243990001025           MOVE ACCOUNT-NO      OF ACCOUNT-CONTRACT-INV-REC
244000001025                           TO ACCOUNT-NO       OF TRANS-REC.
244010001025           MOVE INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
244020001025                           TO INVESTMENT-CODE  OF TRANS-REC.
244030001025           MOVE WS-LDA-ENDDTE  TO PROCESS-DATE OF TRANS-REC.
244040001025
244050001030           START TRANS
244060001025              KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
244070001030                INVALID KEY
244080001025                GO TO GTDR-EXIT
244090001025           END-START.
244100001025
244110001025       GTDR-BAL-NEXT.
244120001025
244130001025           READ TRANS NEXT RECORD
244140001025                 AT END
244150001025                 GO TO GTDR-EXIT
244160001025           END-READ.
244170001025
244180001025       GTDR-BAL-NEXT-0001.
244190001025
244200001025           IF (ACCOUNT-NO OF TRANS IS NOT EQUAL
244210001025                ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC) OR
244220080623           (INVESTMENT-CODE OF TRANS IS NOT EQUAL INVESTMENT-CODE
244230001025                           OF ACCOUNT-CONTRACT-INV-REC)
244240001025             GO TO GTDR-EXIT
244250001025           END-IF.
244260001025
244270001025      *****
244280001025      *****    Bypass the transaction if it does not posses a valid
244290001025      *****    status.
244300001025      *****
244310001025
244320001025           MOVE CONTR-REDEM-CODE
244330001025                OF TRANS-REC           TO  WS-CONTR-REDEM.
244340001025           MOVE TRANS-STATUS-CODE
244350001025                OF TRANS-REC           TO  WS-TRANS-STATUS.
244360001025           MOVE TRANS-TYPE-CODE
244370001025                OF TRANS-REC           TO  WS-TRANS-TYPE.
244380001025R48660     MOVE TRANS-ORIGIN-CODE  OF TRANS-REC      TO  lc-OriginCode.
244390001025
244400001025           IF  NOT VALID-STATUS
244410001025               GO TO GTDR-BAL-NEXT.
244420001025
244430001025           IF  NOT ORIGINAL-COST-OUT
244440001025               GO TO GTDR-0000-0050
244450001025           END-IF
244460001025
244470001025           IF  CONTR-REDEM-CODE OF TRANS = "IFPAY"
244480001025               GO TO GTDR-0000-0050
244490001025           END-IF
244500001025
244510001025           IF  REVERSE OF TRANS = "Y"
244520001025               GO TO GTDR-0000-0050
244530001025           END-IF.
244540001025
244550001025       GTDR-0000-0050.
244560001025
244570001025      *****
244580001025      *****    If the process date of the transaction is equal to or
244590001025      *****    greater than the statement start date, determine if it
244600001025      *****    is within the date range.  Then, continue processing
244610001025      *****    the investment.
244620001025      *****
244630001025
244640001025           IF PROCESS-DATE OF TRANS-REC IS GREATER THAN WS-LDA-ENDDTE
244650001025              GO TO GTDR-EXIT
244660001025           END-IF.
244670001025
244680001025           MOVE CLOSING-UNIT-BAL OF TRANS-REC  TO WS-CI-UNITS-TEMP.
244690011122
244700060621      **********
244710011122
244720020408       GTDR-EXIT.
244730020408            EXIT.
244740020408
244750020408      **********
244760020408
244770020408
244780020408001025***** Get the data from TRANS-CONTRACT-DETAILS file using
244790020408      ***** trans-number, placement-date from Trans and contract-no
244800020408      ***** from ACCOUNT-CONTRACT-INVESTMENT file.
244810081027
244820081027       GET-TRANS-CONTRACT-ROUTINE.
244830020408
244840020408           INITIALIZE WS-NET-DEPOSIT-VALUE
244850080331                      WS-GUAR-BASE-VALUE
244860081027R13923                WS-CI-UNITS-TEMP
244870081027
244880081027R12734*    ***** BEGIN *****
244890081027           IF NOT FIRST-PASS
244900081027              GO TO GTCR-0003
244910081027           END-IF.
244920081027
244930081027           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
244940081027             TO WS-PARM-ACCOUNT-NO.
244950081027           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC
244960080331             TO WS-PARM-CONTRACT-NO.
24497002040857553**    MOVE WS-LDA-ENDDTE TO WS-PARM-END-DATE.
24498002040857553      MOVE WS-LDA-ENDDTE-SV TO WS-PARM-END-DATE.
244981211007111744        INITIALIZE ln_InvArraySize
244982211007111744        MOVE ln_InvArrayInitialSize TO ln_InvArraySize
244990020408           INITIALIZE WS-PARM-ACC-CON-INV-ARRAY-DEF.
244991211007111744     PERFORM VARYING IVS-CNT1 FROM 1 BY 1
244992211007111744             UNTIL IVS-CNT1 > ln_InvArraySize
244993211007111744     INITIALIZE WS-PARM-ARRAY-ACCOUNT-NO(IVS-CNT1)
244994211007111744                WS-PARM-ARRAY-CONTRACT-NO(IVS-CNT1)
244995211007111744                WS-PARM-ARRAY-INVESTMENT-CODE(IVS-CNT1)
244996211007111744                WS-PARM-ARRAY-NET-DEP-VALUE(IVS-CNT1)
244997211007111744                WS-PARM-ARRAY-GUAR-BASE-VALUE(IVS-CNT1)
244998211007111744                WS-PARM-ARRAY-CURR-UNIT-BAL(IVS-CNT1)
244999211007111744                WS-PARM-ARRAY-GUAR-DTH-VALUE(IVS-CNT1)
245000211007111744     END-PERFORM
245001211007
245002210914
245010020408      * RFS45413 Begin
24502002040857553**    MOVE 0                  TO ln-parm-end-date.
245030020408  ¦  **    MOVE WS-PARM-ACCOUNT-NO TO ln-parm-account-no.
245040020408  ¦  **    EXEC SQL
245050020408  ¦  **       SELECT END_DATE INTO :ln-parm-end-date
245060020408  ¦  **       FROM MFASTMPRP
245070020408  ¦  **       WHERE ACCOUNT_NO   = :ln-parm-account-no
245080020408  ¦  **    END-EXEC.
245090020408 \¦/ **    IF  ln-parm-end-date NOT EQUAL 0
24510002040857553**        MOVE ln-parm-end-date TO WS-PARM-END-DATE.
245110020408      * RFS45413 End
245120020408
245130020408           CALL "TRCODCALC"  USING WS-PARM-ACCOUNT-NO
245140020408                                   WS-PARM-CONTRACT-NO
245150180627                                   WS-PARM-END-DATE
245160020408177152                             WS-PARM-GUAR-DTH-RULE
245170020408                                   WS-PARM-ACC-CON-INV-ARRAY-DEF.
245180020408
245190020408           MOVE "N" TO WS-FIRST-PASS-FLAG.
245200020408
245210020408       GTCR-0003.
245220020408           SET WS-ACIIDX TO 1.
245230020408           SEARCH WS-PARM-ACC-CON-INV-ARRAY VARYING WS-ACIIDX
245240020408             WHEN WS-PARM-ARRAY-ACCOUNT-NO(WS-ACIIDX) =
245250020408                  ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC AND
245260020627                  WS-PARM-ARRAY-CONTRACT-NO(WS-ACIIDX) =
245270020627                  CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC AND
245280020408                  WS-PARM-ARRAY-INVESTMENT-CODE(WS-ACIIDX) =
245290001025                  INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
245300001025                  GO TO GTCR-0005
245310001025             WHEN WS-PARM-ARRAY-ACCOUNT-NO(WS-ACIIDX) = 0 OR
245320001025                  WS-PARM-ARRAY-CONTRACT-NO(WS-ACIIDX) = 0 OR
245330001025                  WS-PARM-ARRAY-INVESTMENT-CODE(WS-ACIIDX) = " "
245340020417                  GO TO GTCR-EXIT
245350020417           END-SEARCH.
245360020417
245370020417       GTCR-0005.
245380020426           MOVE WS-PARM-ARRAY-NET-DEP-VALUE(WS-ACIIDX)
245390020426             TO WS-NET-DEPOSIT-VALUE.
245400020426           MOVE WS-PARM-ARRAY-GUAR-BASE-VALUE(WS-ACIIDX)
245410020426             TO WS-GUAR-BASE-VALUE.
245420020426R13923     MOVE WS-PARM-ARRAY-CURR-UNIT-BAL(WS-ACIIDX)
245430180706R13923       TO WS-CI-UNITS-TEMP.
245440180619177152     MOVE WS-PARM-ARRAY-GUAR-DTH-VALUE(WS-ACIIDX)
245450020426177152       TO WS-GUAR-DTH-VALUE.
245460020426
245470020426       GTCR-EXIT.
245480020426            EXIT.
245490020426
245500020426      **********
245510020426
245520020426R13184***** Populate CD-GUARANTEED-BASE-VALUE-OPEN and CD-GUARANTEED-
245530020426      ***** BASE-VALUE-CHG by passing in the trade date prior the
245540020426      ***** Statement start date to TRCODCALC program.
245550020426
245560020426       GET-CONTRACT-OPENING-GBV.
245570020426
245580020426           INITIALIZE MFABUSDAP OF BUSINESS-DAY-REC.
245590020426           MOVE WS-LDA-STRDTE          TO  BUSINESS-DAY
245600020426                                           OF BUSINESS-DAY-REC.
245610020426           START BUSINESS-DAY-FILE
245620020426               KEY IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
245630020426               INVALID KEY
245640020426                   INITIALIZE BUSINESS-DAY-REC
245650020426                   MOVE ZEROS    TO  BUSINESS-DAY OF BUSINESS-DAY-REC
245660020426                   GO TO GCPG-0020
245670020426           END-START.
245680020426
245690020426       GCPG-0010.
245700020426
245710020426           READ BUSINESS-DAY-FILE NEXT AT  END
245720020426               GO TO GCPG-EXIT
245730020426           END-READ.
245740020426
245750020426           IF ALLOW-TRADING OF BUSINESS-DAY-REC  IS NOT EQUAL TO  "Y"
245760020426              GO TO GCPG-0010
245770020426           END-IF.
245780020426
245790020426       GCPG-0020.
245800020426
245810020426      ********** BEGIN *****
245820020426
245830020426           IF NOT FIRST-PASSO
245840020426              GO TO GCPG-0030
245850020426           END-IF.
245860020426
245870020426           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
245880020426             TO WS-PARMO-ACCOUNT-NO.
245890020426           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC
245900020426             TO WS-PARMO-CONTRACT-NO.
245910020426           MOVE BUSINESS-DAY OF BUSINESS-DAY-REC
245920020426                              TO WS-PARMO-END-DATE.
245930020426
245931211007111744        INITIALIZE ln_InvArraySize
245932211007111744        MOVE ln_InvArrayInitialSize TO ln_InvArraySize
245940020426           INITIALIZE WS-PARMO-ACC-CON-INV-ARRAY-DEF.
245941211007111744     PERFORM VARYING IVS-CNT1 FROM 1 BY 1
245942211007111744             UNTIL IVS-CNT1 > ln_InvArraySize
245943211012111744*     INITIALIZE WS-PARM-ARRAY-ACCOUNT-NO(IVS-CNT1)
245944211012111744*                WS-PARM-ARRAY-CONTRACT-NO(IVS-CNT1)
245945211012111744*                WS-PARM-ARRAY-INVESTMENT-CODE(IVS-CNT1)
245946211012111744*                WS-PARM-ARRAY-NET-DEP-VALUE(IVS-CNT1)
245947211012111744*                WS-PARM-ARRAY-GUAR-BASE-VALUE(IVS-CNT1)
245948211012111744*                WS-PARM-ARRAY-CURR-UNIT-BAL(IVS-CNT1)
245949211012111744*                WS-PARM-ARRAY-GUAR-DTH-VALUE(IVS-CNT1)
245950211012112133     INITIALIZE WS-PARMO-ARRAY-ACCOUNT-NO(IVS-CNT1)
245951211012112133                WS-PARMO-ARRAY-CONTRACT-NO(IVS-CNT1)
245952211012112133                WS-PARMO-ARRAY-INVESTMENT-CODE(IVS-CNT1)
245953211012112133                WS-PARMO-ARRAY-NET-DEP-VALUE(IVS-CNT1)
245954211012112133                WS-PARMO-ARRAY-GUAR-BASE-VALUE(IVS-CNT1)
245955211012112133                WS-PARMO-ARRAY-CURR-UNIT-BAL(IVS-CNT1)
245956211012112133                WS-PARMO-ARRAY-GUAR-DTH-VALUE(IVS-CNT1)
245957211007111744     END-PERFORM
245958020426
245960020426           CALL "TRCODCALC"  USING WS-PARMO-ACCOUNT-NO
245970020426                                   WS-PARMO-CONTRACT-NO
245980180627                                   WS-PARMO-END-DATE
245990020426177152                             WS-PARMO-GUAR-DTH-RULE
246000020426                                   WS-PARMO-ACC-CON-INV-ARRAY-DEF.
246010020426           MOVE "N" TO WS-FIRST-PASSO-FLAG.
246020020426
246030020426       GCPG-0030.
246040020426
246050020426           SET WS-ACIIDXO TO 1.
246060020426           SEARCH WS-PARMO-ACC-CON-INV-ARRAY VARYING WS-ACIIDXO
246070020426             WHEN WS-PARMO-ARRAY-ACCOUNT-NO(WS-ACIIDXO) =
246080020426                  ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC AND
246090020426                  WS-PARMO-ARRAY-CONTRACT-NO(WS-ACIIDXO) =
246100020426                  CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC AND
246110020426                  WS-PARMO-ARRAY-INVESTMENT-CODE(WS-ACIIDXO) =
246120020426                  INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
246130020417                  GO TO GCPG-0040
246140020417             WHEN WS-PARMO-ARRAY-ACCOUNT-NO(WS-ACIIDXO) = 0 OR
246150020417                  WS-PARMO-ARRAY-CONTRACT-NO(WS-ACIIDXO) = 0 OR
246160020417                  WS-PARMO-ARRAY-INVESTMENT-CODE(WS-ACIIDXO) = " "
246170020417                  GO TO GCPG-EXIT
246180020417           END-SEARCH.
246190020417
246200041229       GCPG-0040.
246210041229
246220041229           MOVE WS-PARMO-ARRAY-NET-DEP-VALUE(WS-ACIIDXO)
246230041229             TO WS-NET-DEPOSITO-VALUE.
246240041229           MOVE WS-PARMO-ARRAY-GUAR-BASE-VALUE(WS-ACIIDXO)
246250180619             TO WS-GUAR-BASEO-VALUE.
246260180619177152     MOVE WS-PARMO-ARRAY-GUAR-DTH-VALUE(WS-ACIIDXO)
246270041229177152       TO WS-GUAR-DEATHO-VALUE.
246280041229
246290041229           ADD WS-GUAR-BASEO-VALUE  TO WS-GUAR-BASEO-VALUE-TOT.
246300041229
246310041229      **********
246320110304
246330110304       GCPG-EXIT.
246340110304            EXIT.
246350110304
246360110304R13184**********
246370110307
246380110304R25469*****
246390110304   ¦  ***** Get the Contract AWD totals from Trans file:
246400110304   ¦  ***** 1. Read TRANS-CONTRACT-DETAILS file using the Contract-no.
246410110304   ¦  ***** 2. Read the Trans file using the Placement-Date and
246420110304   ¦  *****    Trans-No from TRANS-CONTRACT-DETAILS file.
246430110307   ¦  ***** 3. Accumulate the AWD from Trans file.
246440110307   ¦  *****
246450110304   ¦
246460110304   ¦   GET-CONTRACT-AWD-ROUTINE.
246470110304   ¦
246480110304R80605* --------------------------------------------
246490110304  |   *  Get-GBV-AWD-Sums.
246500131001  |   *  FXSUMAWDT : Obtain
246510110304  |   *             - sum of all AWDs for GBV
246520110304  |   * --------------------------------------------
246530110304  |        INITIALIZE    Lc_Gdv_Independ.
246540110304  |        INITIALIZE    pi_SegSAwdAccountNo,
246550110304  |                      pi_SegSAwdContractNo,
246560110307  |                      pc_SegSAwdResetType,
246570110307  |                      pc_SegSAwdDate,
246580110304  |                      pn_SegSAwdAmount,
246590110304  |                      Ln_GbvGdv_AwdSum,
246600110307  |                      pc-IndependentGDV.
246610110304  |
246620110304  |        MOVE Ln-AccountNo    TO  pi_SegSAwdAccountNo.
246630110304  |        MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
246640110304  |                             TO  pi_SegSAwdContractNo.
246650110304  |        MOVE Lc_GBV          TO  pc_SegSAwdResetType.
246660110304  |        MOVE WS-LDA-ENDDTE   TO  pc_SegSAwdDate.
246670110304  |
246680110304  |        CALL "FXSUMAWDT" USING pi_SegSAwdAccountNo,
246690110304  |                               pi_SegSAwdContractNo,
246700110304  |                               pc_SegSAwdResetType,
246710110304  |                               pc_SegSAwdDate,
246720110307  |                               pn_SegSAwdAmount,
246730110304  |                               pc-IndependentGDV.
246740110304  |
246750110304  |        COMPUTE Ln_Gbv_AwdSum = pn_SegSAwdAmount.
246760110304  |        MOVE pc-IndependentGDV TO Lc_Gdv_Independ.
246770110307  |   *    IF pb_SegSAwdReturnOK
246780110307  |   *       COMPUTE ln_SEGSAWDGuarValAwdSum = pn_SegSAwdAmount
246790110304  |   *    ELSE
246800110304  |   *       COMPUTE ln_SEGSAWDGuarValAwdSum = ZERO
246810110304  |   *    END-IF.
246820110304  |
246830110304  |   * --------------------------------------------
246840131001  |   *  Get-GDV-AWD-Sums.
246850110304  |   *  FXSUMAWDT : Obtain
246860110304  |   *             - sum of all AWDs for GDV
246870110304  |   * --------------------------------------------
246880110304  |        INITIALIZE    Lc_Gdv_Independ.
246890110304  |        INITIALIZE    pi_SegSAwdAccountNo,
246900110307  |                      pi_SegSAwdContractNo,
246910110307  |                      pc_SegSAwdResetType,
246920110307  |                      pc_SegSAwdDate,
246930110307  |                      pn_SegSAwdAmount,
246940110304  |                      pc-IndependentGDV.
246950130719  |
246960130719  |        MOVE Ln-AccountNo    TO  pi_SegSAwdAccountNo.
246970130719  |        MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
246980130719  |                             TO  pi_SegSAwdContractNo.
246990130719  |        MOVE Lc_GDV          TO  pc_SegSAwdResetType.
247000130719  |        MOVE WS-LDA-ENDDTE   TO  pc_SegSAwdDate.
247010130906  |
247020130719  |        CALL "FXSUMAWDT" USING pi_SegSAwdAccountNo,
247030130719  |                               pi_SegSAwdContractNo,
247040130719  |                               pc_SegSAwdResetType,
247050130719  |                               pc_SegSAwdDate,
247060130719  |                               pn_SegSAwdAmount,
247070131212  |                               pc-IndependentGDV.
247080131212  |
247090131212  V        MOVE pc-IndependentGDV TO Lc_Gdv_Independ.
247100131212R80605     COMPUTE Ln_Gdv_AwdSum = pn_SegSAwdAmount.
247110130719      * RFS120931 - Start
247120130719           INITIALIZE    pi_SegSAwdAccountNo,
247130130719                         pi_SegSAwdContractNo,
247140130719                         pc_SegSAwdResetType,
247150130719                         pc_SegSAwdDate,
247160130719                         pn_SegSAwdAmount,
247170130719127401****               Ln_GbvGdv_AwdSum,
247180130719                         pc-IndependentGDV.
247190130719           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-REC
247200130719                           TO pi_SegSAwdAccountNo.
247210131001           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
247220130719                           TO pi_SegSAwdContractNo.
247230131212      * RFS130402 - Starts
247240131212      *    MOVE Lc_YTD          TO  pc_SegSAwdResetType.
247250131212           MOVE lc_STM          TO  pc_SegSAwdResetType.
247260131212      * RFS130402 - Ends
247270131001           EXEC SQL
247280130719             SELECT GUAR_BENEFIT_ELIGIBLE,
247290130719                    MAX_WITHDRAWAL_AMT
247300130719              INTO :lc_GuaranBenifit,
247310130719                   :ln_MaximumWithAmt
247320130719             FROM MFAACCONP
247330131001             WHERE
247340140610             ACCOUNT_NO = :pi_SegSAwdAccountNo AND
247350130920             CONTRACT_NO = :pi_SegSAwdContractNo
247360140610           END-EXEC.
247370140610
247380140610           IF  lc_GuaranBenifit = lnc_Y
247390140610      * RFS130402 - Starts
247400140610128315*      MOVE WS-LDA-STRDTE   TO  pc_SegSAwdDate
247410140610             MOVE WS-LDA-ENDDTE   TO  pc_SegSAwdDate
247420140610      * RFS130402 - Ends
247430140610             CALL "FXSUMAWDT" USING pi_SegSAwdAccountNo,
247440140610                                  pi_SegSAwdContractNo,
247450130920                                  pc_SegSAwdResetType,
247460140610                                  pc_SegSAwdDate,
247470131001                                  pn_SegSAwdAmount,
247480130719                                  pc-IndependentGDV
247490130719             MOVE pn_SegSAwdAmount  TO CD-YTD-WITHDRAWN-AMOUNT
247500110304      * RFS132043 - Begin
247510110304      *RFS128315 - Start
247520110304      *      MOVE WS-LDA-ENDDTE-CCYY TO lc_ldaEnddateCCYY
247530110304      *      EXEC SQL
247540110304      *        SELECT MAX_WITHDRAWAL_AMT
247550110304      *        INTO   :ln_MaximumWithAmt
247560110304      *        FROM   WRKMAXAMT
247570110304      *        WHERE  ACCOUNT_NO     = :pi_SegSAwdAccountNo  AND
247580110304      *              CONTRACT_NO    = :pi_SegSAwdContractNo AND
247590110304      *              PROCESS_YEAR   = :lc_ldaEnddateCCYY
247600110304      *      END-EXEC
247610110304      *RFS128315 - End
247620110304      * RFS132043 - End
247630110304             MOVE ln_MaximumWithAmt TO CD-MAX-WITHDRAWAL-AMOUNT
247640110304           END-IF.
247650110304      * RFS120931 - End
247660110304R80605*    INITIALIZE TRANS-CONTRACT-DETAILS-REC.
247670110304   ¦  *    MOVE ZEROS         TO  WS-AWD-AMT.
247680110304   ¦  *
247690110304   ¦  *    MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-REC
247700110304   ¦  *                TO CONTRACT-NO OF TRANS-CONTRACT-DETAILS-REC.
247710110304   ¦  *
247720110304   ¦  *    START TRANS-CONTRACT-DETAILS
247730110304   ¦  *       KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
247740110304   ¦  *        INVALID KEY
247750110304   ¦  *        GO TO GCAWDR-EXIT
247760110304   ¦  *    END-START.
247770110304   ¦  *
247780110304   ¦  *GCAWDR-0010.
247790110304   ¦  *
247800110304   ¦  *    READ TRANS-CONTRACT-DETAILS NEXT RECORD
247810110304   ¦  *       AT END
247820110304   ¦  *       GO TO GCAWDR-EXIT
247830110304   ¦  *    END-READ.
247840110304   ¦  *
247850110304   ¦  *    IF CONTRACT-NO OF TRANS-CONTRACT-DETAILS-REC
247860110304   ¦  *          IS NOT EQUAL TO  CONTRACT-NO OF ACCOUNT-CONTRACT-REC
247870110304   ¦  *        GO TO GCAWDR-EXIT
247880110304   ¦  *    END-IF.
247890110304   ¦  *
247900110304   ¦  *GCAWDR-0020.
247910110304   ¦  *
247920110304   ¦  *    INITIALIZE TRANS-C-REC.
247930110304   ¦  *
247940110304   ¦  *    MOVE PLACEMENT-DATE OF TRANS-CONTRACT-DETAILS-REC
247950110304   ¦  *                TO PLACEMENT-DATE OF TRANS-C-REC.
247960110304   ¦  *    MOVE TRANS-NO OF TRANS-CONTRACT-DETAILS-REC
247970110304   ¦  *                TO TRANS-NO OF TRANS-C-REC.
247980110304   ¦  *
247990110304   ¦  *    READ TRANS-C
248000110304   ¦  *       INVALID KEY
248010110304   ¦  *         initialize MFATRNP OF TRANS-C-REC
248020110304   ¦  *          GO TO GCAWDR-0010
248030041229   ¦  *    END-READ.
248040041229   ¦  *
248050041229   ¦  *    IF PROCESS-DATE OF TRANS-C-REC
248060041229   ¦  *                  IS NOT GREATER THAN WS-LDA-ENDDTE
248070041229   ¦  *    AND ((TRANS-ORIGIN-CODE OF TRANS-C-REC = "AWD" OR
248080030910   ¦  *          TRANS-ORIGIN-CODE OF TRANS-C-REC = "AWC" OR
248090030910   ¦  *          TRANS-ORIGIN-CODE OF TRANS-C-REC = "AWE") AND
248100030910   ¦  *         (REVERSAL-CODE     OF TRANS-C-REC = " "    AND
248110030910   ¦  *          REVERSE OF TRANS-C-REC IS NOT EQUAL TO "Y")  OR
248120030910   ¦  *         (REVERSAL-CODE     OF TRANS-C-REC = "AWDA" AND
248130030910   ¦  *          REVERSE OF TRANS-C-REC IS NOT EQUAL TO "Y"))
248140030910   ¦  *       ADD GROSS-AMT OF TRANS-C-REC  TO  WS-AWD-AMT
248150030910   ¦  *    END-IF.
248160030910   ¦  *
248170030910   V  *    GO TO GCAWDR-0010.
248180030910R80605**********
248190030910   ¦
248200030910   ¦   GCAWDR-EXIT.
248210030910   ¦          EXIT.
248220030910   v
248230030910R25469**********
248240030910R16511*****
248250030910  ¦   ***** Calling Statement/Confirm Section17 Module (STMTSECT17)
248260030910  ¦   ***** to retrieve the IPS info for Account IPS Details.
248270030910  ¦   *****
248280030910  ¦
248290030910  ¦    ACCOUNT-IPS-DETAILS-SECTION.
248300030910  ¦
248310030910  ¦        INITIALIZE WS-PASS-PARM-S17.
248320030910  ¦        MOVE PREV-INVESTOR            TO WS-IPS-INVESTOR-NO.
248330030910  ¦        MOVE PREV-ACCOUNT             TO WS-IPS-ACCOUNT-NO.
248340030910  ¦        IF WS-LDA-REQUEST-SCOPE = "A"
248350030910  ¦           MOVE PREV-END-DATE         TO WS-IPS-STMT-END-DATE
248360030910  ¦        ELSE
248370030910  ¦           MOVE ZEROS                 TO WS-IPS-STMT-END-DATE
248380030910  ¦        END-IF.
248390030910  ¦
248400030910  ¦        CALL "STMTSECT17" USING  WS-IPS-INVESTOR-NO
248410030910  ¦                                 WS-IPS-ACCOUNT-NO
248420030910  ¦                                 WS-IPS-ACCOUNT-COUNT
248430030910  ¦                                 WS-IPS-DECLARE-CURSOR
248440031020  ¦                                 WS-IPS-REQUEST-SCOPE
248450031020  ¦                                 WS-IPS-STMT-END-DATE
248460031020  ¦                                 WS-IPS-CONS-ACCT-ID
248470031020  ¦                                 WS-IPS-EFFECTIVE-DATE
248480031020  ¦                                 WS-IPS-CONS-ACCT-NAME
248490040224  ¦                                 WS-IPS-DEALER-NAME
248500040224  ¦                                 WS-IPS-REP-FIRST-NAME
248510040224  ¦                                 WS-IPS-REP-LAST-NAME
248520040224  ¦                                 WS-IPS-REP-ADDR1
248530040224  ¦                                 WS-IPS-REP-ADDR2
248540040224  ¦                                 WS-IPS-REP-ADDR3
248550040224  ¦                                 WS-IPS-REP-ADDR4
248560040224  ¦                                 WS-IPS-REP-ADDR5
248570030910  ¦                                 WS-IPS-REP-POSTAL-CODE
248580030910  ¦                                 WS-IPS-REP-COUNTRY-CODE
248590030910  ¦                                 WS-MAILING-ACCOUNT-NO
248600030910R18667                              WS-REP-PHONE-AREA-CODE
248610030910  ¦                                 WS-REP-PHONE-NUMBER
248620030910  ¦                                 WS-REP-PHONE-EXT
248630030910  v                                 WS-REP-FAX-AREA-CODE
248640030910R18667                              WS-REP-FAX-NUMBER
248650030910R19444                              WS-IPS-ADDRESS-1
248660030910  ¦                                 WS-IPS-ADDRESS-2
248670030910  ¦                                 WS-IPS-ADDRESS-3
248680030910  ¦                                 WS-IPS-ADDRESS-4
248690030910  ¦                                 WS-IPS-ADDRESS-5
248700030910  ¦                                 WS-IPS-POSTAL
248710030910  ¦                                 WS-IPS-COUNTRY
248720030910R19444                              WS-IPS-PROVINCE
248730030910  ¦                                 WS-IPS-RETURN-CODE.
248740030910  ¦        IF WS-IPS-RETURN-CODE  IS NOT EQUAL TO  "00"
248750030910  ¦           GO TO AIDS-EXIT
248760030910  ¦        END-IF.
248770030910  ¦        MOVE WS-IPS-INVESTOR-NO         TO IPS-INVESTOR-NO.
248780031020  ¦        MOVE WS-IPS-ACCOUNT-NO          TO IPS-ACCOUNT.
248790031020  ¦        MOVE  17                        TO IPS-SECTION-NO.
248800031020  ¦        MOVE WS-IPS-CONS-ACCT-ID        TO IPS-GROUP-ID.
248810031020  ¦        MOVE WS-IPS-EFFECTIVE-DATE      TO IPS-EFFECTIVE-DATE.
248820031020  ¦        MOVE WS-IPS-CONS-ACCT-NAME      TO IPS-GROUP-NAME.
248830040224  ¦        MOVE WS-IPS-DEALER-NAME         TO IPS-DEALER-NAME.
248840040224  ¦        MOVE WS-IPS-REP-FIRST-NAME      TO IPS-REP-FIRST-NAME.
248850040224  ¦        MOVE WS-IPS-REP-LAST-NAME       TO IPS-REP-LAST-NAME.
248860040224  ¦        MOVE WS-IPS-REP-POSTAL-CODE     TO IPS-REP-POSTAL-CODE.
248870040224  ¦        MOVE WS-IPS-REP-COUNTRY-CODE    TO IPS-REP-COUNTRY-CODE.
248880040227  ¦        MOVE WS-IPS-REP-ADDR1           TO IPS-REP-ADDR1.
248890040224  ¦        MOVE WS-IPS-REP-ADDR2           TO IPS-REP-ADDR2.
248900040224  ¦        MOVE WS-IPS-REP-ADDR3           TO IPS-REP-ADDR3.
248910030910  ¦        MOVE WS-IPS-REP-ADDR4           TO IPS-REP-ADDR4.
248920030910  ¦        MOVE WS-IPS-REP-ADDR5           TO IPS-REP-ADDR5.
248930030910  ¦        MOVE WS-MAILING-ACCOUNT-NO      TO IPS-MAILING-ACCOUNT-NO.
248940030910R18667     MOVE WS-REP-PHONE-AREA-CODE     TO IPS-REP-PHONE-AREA-CODE.
248950030910  ¦        MOVE WS-REP-PHONE-NUMBER        TO IPS-REP-PHONE-NUMBER.
248960030910  ¦        MOVE WS-REP-PHONE-EXT           TO IPS-REP-PHONE-EXT.
248970030910  v        MOVE WS-REP-FAX-AREA-CODE       TO IPS-REP-FAX-AREA-CODE.
248980030910R18667     MOVE WS-REP-FAX-NUMBER          TO IPS-REP-FAX-NUMBER.
248990030910R19444     MOVE WS-IPS-ADDRESS-1           TO IPS-ADDRESS-1.
249000001020  ¦        MOVE WS-IPS-ADDRESS-2           TO IPS-ADDRESS-2.
249010000000  ¦        MOVE WS-IPS-ADDRESS-3           TO IPS-ADDRESS-3.
249020970108  ¦        MOVE WS-IPS-ADDRESS-4           TO IPS-ADDRESS-4.
249030970108  ¦        MOVE WS-IPS-ADDRESS-5           TO IPS-ADDRESS-5.
249040970108  ¦        MOVE WS-IPS-POSTAL              TO IPS-POSTAL.
249050970108  ¦        MOVE WS-IPS-COUNTRY             TO IPS-COUNTRY.
249060970108R19444     MOVE WS-IPS-PROVINCE            TO IPS-PROVINCE.
249070970108  ¦        MOVE WS-PREV-START-DATE         TO IPS-START-DATE.
249080970108  ¦        MOVE PREV-END-DATE              TO IPS-END-DATE.
249090970108  ¦
249100970108  ¦   **********
249110970108  ¦
249120970108  ¦    AIDS-EXIT.
249130970108  ¦         EXIT.
249140970108  v
249150970108R16511**********
249160970108      /
249170980717       LEVEL-SUMMARY-3.
249180000000
249190000000      ******************************************************************
249200000000      *                                                                *
249210000000      *    L E V E L   S U M M A R I Z A T I O N   3   R O U T I N E   *
249220000000      *                                                                *
249230000000      *        ACIVRNO:    Investor Number                             *
249240030704      *                                                                *
249250000000      ******************************************************************
249260990619
249270990619      *****
249280001229      *****    If the investor being processed is to be bypassed, exit.
249290990619      *****
249300010308
249310010308           IF  WS-LR3BYP-SW   IS EQUAL TO  "Y"
249320010308               GO TO LS3-EXIT.
249330010308
249340010308           IF WS-WRITE-INVESTOR-LEVEL IS EQUAL TO "N"
249350010308             GO TO LS3-EXIT
249360010308           END-IF.
249370000000      *------------------------------------------------*
249380990619      *  UPDATE                                        *
249390990619      *------------------------------------------------*
249400990619R17783     MOVE PREV-USER-ID   TO IS-USERID.
249410990619           MOVE II-INVESTOR-NO TO IS-INVESTOR-NO.
249420990619           MOVE II-ACCOUNT     TO IS-ACCOUNT.
249430030521           MOVE 10             TO IS-SECTION-NO.
249440010327RF8284     MOVE 99999          TO IS-SECTION-SEQUENCE.
249450010327
249460010327RF8633     IF WS-LDA-INVESTOR-12     IS EQUAL TO   "Y"
249470020723              MOVE II-INVESTOR-NO      TO IS2-INVESTOR-NO
249480020725              MOVE II-ACCOUNT          TO IS2-ACCOUNT
249490020723              MOVE 12                  TO IS2-SECTION-NO
249500020723              MOVE 99999               TO IS2-SECTION-SEQUENCE
249510061003           END-IF.
249520061003
249530020723           INITIALIZE IS-ACCOUNT2.
249540020723           INITIALIZE IS-CURRENCY.
249550020725           INITIALIZE IS-VALUE-SIGN.
249560020723           INITIALIZE IS-FIRST60-SIGN.
249570020723           INITIALIZE IS-REMAINDER-SIGN.
249580061003           MOVE "TOTAL" TO IS-ACCOUNT-TYPE IS-ACCOUNT-TYPE-SHORT.
249590061003
249600020723RF8633     IF WS-LDA-INVESTOR-12     IS EQUAL TO   "Y"
249610020723              INITIALIZE IS2-ACCOUNT2
249620020725           END-IF.
249630020723
249640020723           MOVE WS-IVR-TOTAL-VALUE   TO IS-VALUE.
249650061003R13637     IF   WS-IVR-TOTAL-VALUE IS LESS THAN 0
249660061003  ¦             MOVE "-" TO IS-VALUE-SIGN
249670020723R35540     ELSE
249680990619R35540          MOVE " " TO IS-VALUE-SIGN
249690001103R13637     END-IF.
249700001103
249710010330           MOVE WS-IVR-1ST-60-EX     TO IS-FIRST60.
249720001103R13637     IF   WS-IVR-1ST-60-EX  IS LESS THAN 0
249730010330  ¦             MOVE "-" TO IS-FIRST60-SIGN
249740010330R35540     ELSE
249750061003R35540          MOVE " " TO IS-FIRST60-SIGN
249760061003R13637     END-IF.
249770010330
249780010330           MOVE WS-IVR-REMAINDER-EX  TO IS-REMAINDER.
249790001103R13637     IF   WS-IVR-REMAINDER-EX LESS THAN 0
249800010330  ¦             MOVE "-" TO IS-REMAINDER-SIGN
249810010330R35540     ELSE
249820061003R35540          MOVE " " TO IS-REMAINDER-SIGN
249830061003R13637     END-IF.
249840010330
249850001103RF8276     MOVE WS-IVR-BKVAL-CDN-TOT      TO IS-BOOK-VALUE-CDN.
249860020725           MOVE WS-IVR-BKVAL-FGN-TOT      TO IS-BOOK-VALUE-FGN.
249870140519
249880020725           MOVE WS-IVR-MKTVAL-CHGINC-TOT  TO IS-MKT-VALUE-CHG-INC.
249890020725RF9729     IF   WS-IVR-MKTVAL-CHGINC-TOT  IS LESS THAN 0
249900061003               MOVE "-" TO IS-MKT-VALUE-CHG-INC-SIGN
249910061003R35540     ELSE
249920020725R35540         MOVE " " TO IS-MKT-VALUE-CHG-INC-SIGN
249930020725           END-IF
249940990619
249950140519           MOVE WS-IVR-MKTVAL-CHGCUR-TOT  TO IS-MKT-VALUE-CHG-CUR.
249960020725           IF   WS-IVR-MKTVAL-CHGCUR-TOT  IS LESS THAN 0
249970020725               MOVE "-" TO IS-MKT-VALUE-CHG-CUR-SIGN
249980061003R35540     ELSE
249990061003R35540         MOVE " " TO IS-MKT-VALUE-CHG-CUR-SIGN
250000020725RF9729     END-IF
250010020725
250020990619           MOVE WS-IVR-PUR-INCEPT-EX TO  IS-PUR-INCEPT.
250030020725130239     MOVE WS-IVR-PUR-INCEPT-EX TO li_PurIncepTot.
250040020725R13637     IF   WS-IVR-PUR-INCEPT-EX  IS LESS THAN 0
250050061003  ¦             MOVE "-" TO IS-PI-SIGN
250060061003R35540     ELSE
250070020725R35540          MOVE " " TO IS-PI-SIGN
250080020725R13637     END-IF.
250090990619
250100020725           MOVE WS-IVR-RED-INCEPT-EX TO  IS-RED-INCEPT.
250110020725130239     MOVE WS-IVR-RED-INCEPT-EX TO li_RedIncepTot.
250120061003R12726     IF   WS-IVR-RED-INCEPT-EX     IS LESS THAN ZEROES
250130061003  ¦           MOVE "-"     TO  IS-RI-SIGN
250140020725R35540     ELSE
250150020725R35540        MOVE " "     TO  IS-RI-SIGN
250160990619R12726     END-IF.
250170020725
250180020725           MOVE WS-IVR-CPG-INCEPT-EX TO  IS-CPG-INCEPT.
250190061003R12726     IF   WS-IVR-CPG-INCEPT-EX     IS LESS THAN ZEROES
250200061003  ¦           MOVE "-"  TO  IS-CI-SIGN
250210020725R35540     ELSE
250220020725R35540        MOVE " "  TO  IS-CI-SIGN
250230990619R12726     END-IF.
250240140519
250250020403           MOVE WS-IVR-INC-INCEPT-EX TO  IS-INC-INCEPT.
250260020403R12726     IF   WS-IVR-INC-INCEPT-EX     IS LESS THAN ZEROES
250270061003  ¦           MOVE "-"  TO  IS-II-SIGN
250280061003R35540     ELSE
250290020403R35540        MOVE " "  TO  IS-II-SIGN
250300020111R12726     END-IF.
250310001006
250320020403           MOVE WS-IVR-INT-INCEPT-EX TO  IS-INT-INCEPT.
250330020403R12726     IF   WS-IVR-INT-INCEPT-EX     IS LESS THAN ZEROES
250340061003  ¦           MOVE "-"  TO  IS-NI-SIGN
250350061003R35540     ELSE
250360020403R35540        MOVE " "  TO  IS-NI-SIGN
250370020403R12726     END-IF.
250380990619
250390140519           MOVE WS-IVR-TRI-INCEPT-EX TO  IS-TRI-INCEPT.
250400020403130239     MOVE WS-IVR-TRI-INCEPT-EX TO li_TriIncepTot.
250410020403R12173     IF   WS-IVR-TRI-INCEPT-EX     IS LESS THAN ZEROES
250420061003  ¦           MOVE "-"  TO  IS-TRI-INCEPT-SIGN
250430061003R35540     ELSE
250440020403R35540        MOVE " "  TO  IS-TRI-INCEPT-SIGN
250450020111R12173     END-IF.
250460001006
250470020403RF7777     MOVE WS-IVR-SWI-INCEPT-EX TO  IS-SWI-INCEPT.
250480020403R12173     IF   WS-IVR-SWI-INCEPT-EX     IS LESS THAN ZEROES
250490061003  ¦           MOVE "-"  TO  IS-SWI-INCEPT-SIGN
250500061003R35540     ELSE
250510020403R35540        MOVE " "  TO  IS-SWI-INCEPT-SIGN
250520020403R12173     END-IF.
250530020923
250540020923           MOVE WS-IVR-TRO-INCEPT-EX TO  IS-TRO-INCEPT.
250550020923130239     MOVE WS-IVR-TRO-INCEPT-EX TO li_TroIncepTot.
250560061003R12173     IF   WS-IVR-TRO-INCEPT-EX     IS LESS THAN ZEROES
250570061003  ¦           MOVE "-"  TO  IS-TRO-INCEPT-SIGN
250580020923R35540     ELSE
250590020923R35540        MOVE " "  TO  IS-TRO-INCEPT-SIGN
250600020923R12173     END-IF.
250610020923
250620020923RF7777     MOVE WS-IVR-SWO-INCEPT-EX TO  IS-SWO-INCEPT.
250630061003R12173     IF   WS-IVR-SWO-INCEPT-EX     IS LESS THAN ZEROES
250640061003  ¦           MOVE "-"  TO  IS-SWO-INCEPT-SIGN
250650020923R35540     ELSE
250660021202R35540        MOVE " "  TO  IS-SWO-INCEPT-SIGN
250670030317R12173     END-IF.
250680030317
250690030317R14556     MOVE WS-IVR-TRI-INCEPT-COST-EX  TO IS-TRI-INCEPT-COST
250700061003           IF WS-IVR-TRI-INCEPT-COST-EX    IS LESS THAN ZEROES
250710061003              MOVE "-"                     TO IS-TRI-INCEPT-COST-SIGN
250720030317R35540     ELSE
250730030317R35540        MOVE " "                     TO IS-TRI-INCEPT-COST-SIGN
250740030317           END-IF.
250750030317
250760030317           MOVE WS-IVR-TRO-INCEPT-COST-EX  TO IS-TRO-INCEPT-COST
250770061003           IF WS-IVR-TRO-INCEPT-COST-EX    IS LESS THAN ZEROES
250780061003              MOVE "-"                     TO IS-TRO-INCEPT-COST-SIGN
250790030317R35540     ELSE
250800030317R35540        MOVE " "                     TO IS-TRO-INCEPT-COST-SIGN
250810030624R14556     END-IF.
250820030624
250830030624R16256     MOVE WS-IVR-TRI-INCEPT-MKT-EX   TO IS-TRI-INCEPT-MKT.
250840061003   ¦       IF WS-IVR-TRI-INCEPT-MKT-EX     IS LESS THAN ZEROES
250850061003   ¦          MOVE "-"                     TO IS-TRI-INCEPT-MKT-SIGN
250860030624R35540     ELSE
250870030624R35540        MOVE " "                     TO IS-TRI-INCEPT-MKT-SIGN
250880030624   ¦       END-IF.
250890030624   ¦
250900030624   ¦       MOVE WS-IVR-TRO-INCEPT-MKT-EX   TO IS-TRO-INCEPT-MKT.
250910061003   ¦       IF WS-IVR-TRO-INCEPT-MKT-EX     IS LESS THAN ZEROES
250920061003   ¦          MOVE "-"                     TO IS-TRO-INCEPT-MKT-SIGN
250930030624R35540     ELSE
250940030624R35540        MOVE " "                     TO IS-TRO-INCEPT-MKT-SIGN
250950030624R16256     END-IF.
250960030624
250970030624R16881     MOVE WS-IVR-TRI-INCEPT-PH-EX  TO IS-TRI-INCEPT-PHANTOM.
250980061003   ¦       IF WS-IVR-TRI-INCEPT-PH-EX    IS LESS THAN ZEROES
250990061003   ¦          MOVE "-"                   TO IS-TRI-INCEPT-PHANTOM-SIGN
251000030624R35540     ELSE
251010030624R35540        MOVE " "                   TO IS-TRI-INCEPT-PHANTOM-SIGN
251020030624   ¦       END-IF.
251030030624   ¦
251040030624   ¦       MOVE WS-IVR-TRI-YTD-PH-EX     TO IS-TRI-YTD-PHANTOM
251050061003   ¦       IF WS-IVR-TRI-YTD-PH-EX       IS LESS THAN ZEROES
251060061003   ¦          MOVE "-"                   TO IS-TRI-YTD-PHANTOM-SIGN
251070030624R35540     ELSE
251080030624R35540        MOVE " "                   TO IS-TRI-YTD-PHANTOM-SIGN
251090030624   ¦       END-IF.
251100030624   ¦
251110030624   ¦       MOVE WS-IVR-TRI-CUR-PH-EX     TO IS-TRI-CUR-PHANTOM.
251120061003   ¦       IF WS-IVR-TRI-CUR-PH-EX       IS LESS THAN ZEROES
251130061003   ¦          MOVE "-"                   TO IS-TRI-CUR-PHANTOM-SIGN
251140030624R35540     ELSE
251150030624R35540        MOVE " "                   TO IS-TRI-CUR-PHANTOM-SIGN
251160030624   ¦       END-IF.
251170030624   ¦
251180030624   ¦       MOVE WS-IVR-TRO-INCEPT-PH-EX  TO IS-TRO-INCEPT-PHANTOM.
251190061003   ¦       IF WS-IVR-TRO-INCEPT-PH-EX    IS LESS THAN ZEROES
251200061003   ¦          MOVE "-"                   TO AD-TRO-INCEPT-PHANTOM-SIGN
251210030624R35540     ELSE
251220030624R35540        MOVE " "                   TO AD-TRO-INCEPT-PHANTOM-SIGN
251230021202   ¦       END-IF.
251240021202   ¦
251250021202   ¦       MOVE WS-IVR-TRO-YTD-PH-EX     TO IS-TRO-YTD-PHANTOM
251260021202   ¦       IF WS-IVR-TRO-YTD-PH-EX       IS LESS THAN ZEROES
251270061003   ¦          MOVE "-"                   TO IS-TRO-YTD-PHANTOM-SIGN
251280061003R35540     ELSE
251290021202R35540        MOVE " "                   TO IS-TRO-YTD-PHANTOM-SIGN
251300021202   ¦       END-IF.
251310021202   ¦
251320021202   ¦       MOVE WS-IVR-TRO-CUR-PH-EX     TO IS-TRO-CUR-PHANTOM.
251330021202   ¦       IF WS-IVR-TRO-CUR-PH-EX       IS LESS THAN ZEROES
251340021202   v          MOVE "-"                   TO IS-TRO-CUR-PHANTOM-SIGN
251350061003R35540     ELSE
251360061003R35540        MOVE " "                   TO IS-TRO-CUR-PHANTOM-SIGN
251370021202R16881     END-IF.
251380021202
251390021202R15022     MOVE WS-IVR-DISP-GAIN-LOSS-CUR-EX
251400021202                      TO IS-DISP-GAIN-LOSS-CUR
251410021202           IF WS-IVR-DISP-GAIN-LOSS-CUR-EX IS LESS THAN ZEROES
251420021202              MOVE "-"             TO IS-DISP-GAIN-LOSS-CUR-SIGN
251430061003R35540     ELSE
251440061003R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-CUR-SIGN
251450021202R15022     END-IF.
251460020923
251470010309R15022     MOVE WS-IVR-DISP-GAIN-LOSS-YTD-EX
251480020730                      TO IS-DISP-GAIN-LOSS-YTD
251490020730           IF WS-IVR-DISP-GAIN-LOSS-YTD-EX IS LESS THAN ZEROES
251500061003              MOVE "-"             TO IS-DISP-GAIN-LOSS-YTD-SIGN
251510061003R35540     ELSE
251520020730R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-YTD-SIGN
251530020730R15022     END-IF.
251540010309
251550020730R15022     MOVE WS-IVR-DISP-GAIN-LOSS-INC-EX
251560020730                      TO IS-DISP-GAIN-LOSS-INCEPT
251570061003           IF WS-IVR-DISP-GAIN-LOSS-INC-EX IS LESS THAN ZEROES
251580061003              MOVE "-"             TO IS-DISP-GAIN-LOSS-INCEPT-SIGN
251590020730R35540     ELSE
251600020730R35540        MOVE " "             TO IS-DISP-GAIN-LOSS-INCEPT-SIGN
251610010309R15022     END-IF.
251620020730
251630020730RF8633     MOVE WS-IVR-TRI-YTD-EX    TO  IS-TRI-YTD.
251640061003R13637     IF   WS-IVR-TRI-YTD-EX        IS LESS THAN ZEROES
251650061003  ¦           MOVE "-"  TO  IS-TRI-YTD-SIGN
251660020730R35540     ELSE
251670020730R35540        MOVE " "  TO  IS-TRI-YTD-SIGN
251680010309R13637     END-IF.
251690020730
251700020730RF8633     MOVE WS-IVR-SWI-YTD-EX    TO  IS-SWI-YTD.
251710061003R13637     IF   WS-IVR-SWI-YTD-EX        IS LESS THAN ZEROES
251720061003  ¦           MOVE "-"  TO  IS-SWI-YTD-SIGN
251730020730R35540     ELSE
251740020730R35540        MOVE " "  TO  IS-SWI-YTD-SIGN
251750010309R13637     END-IF.
251760010309
251770140519RF8633     MOVE WS-IVR-TRO-YTD-EX    TO  IS-TRO-YTD.
251780020730R13637     IF   WS-IVR-TRO-YTD-EX        IS LESS THAN ZEROES
251790020730  ¦           MOVE "-"  TO  IS-TRO-YTD-SIGN
251800061003R35540     ELSE
251810061003R35540        MOVE " "  TO  IS-TRO-YTD-SIGN
251820020730R13637     END-IF.
251830020730
251840020801RF8633     MOVE WS-IVR-SWO-YTD-EX    TO  IS-SWO-YTD.
251850020801R13637     IF   WS-IVR-SWO-YTD-EX        IS LESS THAN ZEROES
251860020801  ¦           MOVE "-"  TO  IS-SWO-YTD-SIGN
251870061003R35540     ELSE
251880061003R35540        MOVE " "  TO  IS-SWO-YTD-SIGN
251890020801R13637     END-IF.
251900020730
251910020801RF8633     MOVE WS-PROFESSIONAL-FEE-INCEPT-TOT
251920020801                                         TO IS-PROFESSIONAL-FEE-INCEPT.
251930020801130239     MOVE WS-PROFESSIONAL-FEE-INCEPT-TOT TO li_FeeIncepTot.
251940061003R13637     IF   WS-PROFESSIONAL-FEE-INCEPT-TOT IS LESS THAN ZEROES
251950061003  ¦           MOVE "-"  TO  IS-PROFESSIONAL-FEE-INCEPT-S
251960020801R35540     ELSE
251970010309R35540        MOVE " "  TO  IS-PROFESSIONAL-FEE-INCEPT-S
251980020801R13637     END-IF.
251990020801
252000020801           MOVE WS-PROFESSIONAL-FEE-YTD-TOT TO IS-PROFESSIONAL-FEE-YTD.
252010061003R13637     IF  WS-PROFESSIONAL-FEE-YTD-TOT IS LESS THAN 0
252020061003  ¦            MOVE "-"       TO  IS-PROFESSIONAL-FEE-YTD-SIGN
252030020801R35540     ELSE
252040990619R35540         MOVE " "       TO  IS-PROFESSIONAL-FEE-YTD-SIGN
252050020725R13637     END-IF.
252060020725
252070020801           MOVE WS-PROFESSIONAL-FEE-CUR-TOT TO IS-PROFESSIONAL-FEE-CUR.
252080061003R13637     IF  WS-PROFESSIONAL-FEE-CUR-TOT IS LESS THAN 0
252090061003  ¦            MOVE "-"       TO  IS-PROFESSIONAL-FEE-CUR-SIGN
252100020725R35540     ELSE
252110020725R35540         MOVE " "       TO  IS-PROFESSIONAL-FEE-CUR-SIGN
252120990619R13637     END-IF.
252130020725
252140020801           MOVE WS-IVR-REG-CTB-INCPT-EX   TO  IS-REG-CTB-INCPT.
252150061003R13637     IF  WS-IVR-REG-CTB-INCPT-EX IS LESS THAN 0
252160061003  ¦            MOVE "-"                TO  IS-REG-CTB-INCPT-SIGN
252170020725R35540     ELSE
252180020725R35540         MOVE " "                TO  IS-REG-CTB-INCPT-SIGN
252190990619R13637     END-IF.
252200020725
252210020801           MOVE WS-IVR-PUR-YTD-EX    TO  IS-PUR-YTD.
252220061003R13637     IF   WS-IVR-PUR-YTD-EX   IS  LESS THAN  0
252230061003  ¦           MOVE "-"  TO  IS-PUR-YTD-SIGN
252240020725R35540     ELSE
252250020725R35540        MOVE " "  TO  IS-PUR-YTD-SIGN
252260990619R13637     END-IF.
252270020725
252280020801           MOVE WS-IVR-RED-YTD-EX    TO  IS-RED-YTD.
252290061003R11628     IF   WS-IVR-RED-YTD-EX   IS  LESS THAN  ZEROES
252300061003  ¦           MOVE "-"                 TO  IS-RED-YTD-SIGN
252310020725R35540     ELSE
252320020725R35540        MOVE " "                 TO  IS-RED-YTD-SIGN
252330990619R11628     END-IF.
252340020725
252350020801           MOVE WS-IVR-CPG-YTD-EX    TO  IS-CPG-YTD.
252360061003R13637     IF   WS-IVR-CPG-YTD-EX   IS  LESS THAN  ZEROES
252370061003  ¦           MOVE "-"                 TO  IS-CPG-YTD-SIGN
252380020725R35540     ELSE
252390990619R35540        MOVE " "                 TO  IS-CPG-YTD-SIGN
252400990620R13637     END-IF.
252410020730
252420020730           MOVE WS-IVR-INC-YTD-EX    TO  IS-INC-YTD.
252430061003R13637     IF   WS-IVR-INC-YTD-EX   IS  LESS THAN  ZEROES
252440061003  ¦           MOVE "-"                 TO  IS-INC-YTD-SIGN
252450020730R35540     ELSE
252460020730R35540        MOVE " "                 TO  IS-INC-YTD-SIGN
252470990620R13637     END-IF.
252480020730
252490020730           MOVE WS-IVR-INT-YTD-EX    TO  IS-INT-YTD.
252500061003R13637     IF   WS-IVR-INT-YTD-EX   IS  LESS THAN  ZEROES
252510061003  ¦           MOVE "-"                 TO  IS-INT-YTD-SIGN
252520020730R35540     ELSE
252530020725R35540        MOVE " "                 TO  IS-INT-YTD-SIGN
252540020725R13637     END-IF.
252550020725
252560020725           MOVE WS-IVR-NRTAX-YTD     TO  IS-NRTAX-YTD.
252570061003R13637     IF   WS-IVR-NRTAX-YTD       IS LESS THAN 0
252580061003  ¦             MOVE "-" TO IS-NRTAX-YTD-SIGN
252590020725R35540     ELSE
252600020725R35540          MOVE " " TO IS-NRTAX-YTD-SIGN
252610020725R13637     END-IF.
252620020725
252630020725           MOVE WS-IVR-WHTAX-YTD     TO  IS-WHTAX-YTD.
252640061003R13637     IF   WS-IVR-WHTAX-YTD       IS LESS THAN 0
252650061003  ¦             MOVE "-" TO IS-WHTAX-YTD-SIGN
252660020725R35540     ELSE
252670990619R35540          MOVE " " TO IS-WHTAX-YTD-SIGN
252680020725R13637     END-IF.
252690020725
252700020725           MOVE WS-IVR-WITHDRAWALS     TO  IS-WITHDRAWALS.
252710061003R13637     IF   WS-IVR-WITHDRAWALS IS LESS THAN 0
252720061003  ¦             MOVE "-" TO IS-WITHDRAWALS-SIGN
252730020725R35540     ELSE
252740020725R35540          MOVE " " TO IS-WITHDRAWALS-SIGN
252750990619R13637     END-IF.
252760020725
252770020725           MOVE WS-IVR-WITHDRAWALS-YTD TO  IS-WITHDRAWALS-YTD.
252780061003R13637     IF   WS-IVR-WITHDRAWALS-YTD IS LESS THAN 0
252790061003  ¦             MOVE "-" TO IS-WITHDRAWALS-YTD-SIGN
252800020725R35540     ELSE
252810020725R35540          MOVE " " TO IS-WITHDRAWALS-YTD-SIGN
252820990619R13637     END-IF.
252830020725
252840020725           MOVE WS-IVR-PUR-CURRENT-EX TO IS-PUR-CURRENT.
252850061003R13637     IF   WS-IVR-PUR-CURRENT-EX  IS LESS THAN ZEROES
252860061003  ¦           MOVE "-"  TO  IS-PC-SIGN
252870020725R35540     ELSE
252880020725R35540        MOVE " "  TO  IS-PC-SIGN
252890990619R13637     END-IF.
252900020725
252910020725           MOVE WS-IVR-RED-CURRENT-EX TO IS-RED-CURRENT.
252920061003R12726     IF   WS-IVR-RED-CURRENT-EX    IS LESS THAN ZEROES
252930061003  ¦           MOVE "-"  TO  IS-RC-SIGN
252940020725R35540     ELSE
252950020725R35540        MOVE " "  TO  IS-RC-SIGN
252960990619R12726     END-IF.
252970020725
252980020725           MOVE WS-IVR-CPG-CURRENT-EX TO IS-CPG-CURRENT.
252990061003R13637     IF   WS-IVR-CPG-CURRENT-EX IS LESS THAN ZEROES
253000061003  ¦             MOVE "-" TO IS-CC-SIGN
253010020725R35540     ELSE
253020020725R35540          MOVE " " TO IS-CC-SIGN
253030990619R13637     END-IF.
253040020725
253050020725           MOVE WS-IVR-INC-CURRENT-EX TO IS-INC-CURRENT.
253060061003R13637     IF   WS-IVR-INC-CURRENT-EX IS LESS THAN ZEROES
253070061003  ¦             MOVE "-" TO IS-IC-SIGN
253080020725R35540     ELSE
253090010614R35540          MOVE " " TO IS-IC-SIGN
253100010614R13637     END-IF.
253110020403
253120020403           MOVE WS-IVR-INT-CURRENT-EX TO IS-INT-CURRENT.
253130061003R13637     IF   WS-IVR-INT-CURRENT-EX IS LESS THAN ZEROES
253140061003  ¦             MOVE "-" TO IS-NC-SIGN
253150020403R35540     ELSE
253160020403R35540          MOVE " " TO IS-NC-SIGN
253170010614R13637     END-IF.
253180020403
253190020403           MOVE WS-IVR-REG-CTB-CUR-EX TO  IS-REG-CTB-CUR.
253200061003           IF   WS-IVR-REG-CTB-CUR-EX IS LESS THAN 0
253210061003               MOVE "-"               TO  IS-REG-CTB-CUR-SIGN
253220020403R35540     ELSE
253230020111R35540         MOVE " "               TO  IS-REG-CTB-CUR-SIGN
253240010614           END-IF.
253250020403
253260020403R10491     MOVE WS-IVR-TRI-CURRENT-EX TO IS-TRI-CURRENT.
253270061003R12173     IF   WS-IVR-TRI-CURRENT-EX    IS LESS THAN ZEROES
253280061003  ¦           MOVE "-"  TO  IS-TRI-CURRENT-SIGN
253290020403R35540     ELSE
253300020403R35540        MOVE " "  TO  IS-TRI-CURRENT-SIGN
253310010614R12173     END-IF.
253320020403
253330020403           MOVE WS-IVR-TRO-CURRENT-EX TO IS-TRO-CURRENT.
253340061003R12173     IF   WS-IVR-TRO-CURRENT-EX    IS LESS THAN ZEROES
253350061003  ¦           MOVE "-"  TO  IS-TRO-CURRENT-SIGN
253360020403R35540     ELSE
253370010614R35540        MOVE " "  TO  IS-TRO-CURRENT-SIGN
253380030422R12173     END-IF.
253390030422
253400030422           MOVE WS-IVR-SWI-CURRENT-EX TO IS-SWI-CURRENT.
253410061003R12173     IF   WS-IVR-SWI-CURRENT-EX    IS LESS THAN ZEROES
253420061003  ¦           MOVE "-"  TO  IS-SWI-CURRENT-SIGN
253430030422R35540     ELSE
253440030422R35540        MOVE " "  TO  IS-SWI-CURRENT-SIGN
253450030422R12173     END-IF.
253460030422
253470030422           MOVE WS-IVR-SWO-CURRENT-EX TO IS-SWO-CURRENT.
253480030422R12173     IF   WS-IVR-SWO-CURRENT-EX    IS LESS THAN ZEROES
253490061003  ¦           MOVE "-"  TO  IS-SWO-CURRENT-SIGN
253500061003R35540     ELSE
253510030422R35540        MOVE " "  TO  IS-SWO-CURRENT-SIGN
253520030422R12173     END-IF.
253530030422
253540030422R16990     MOVE WS-IVR-NET-ADD-CURRENT TO IS-NET-ADD-CURRENT.
253550030422  ¦        IF WS-IVR-NET-ADD-CURRENT   IS LESS THAN ZEROES
253560030422  ¦           MOVE "-"                 TO IS-NET-ADD-CURRENT-SIGN
253570061003R35540     ELSE
253580061003R35540        MOVE " "                 TO IS-NET-ADD-CURRENT-SIGN
253590030422  ¦        END-IF.
253600030422  ¦
253610030422  ¦        MOVE WS-IVR-NET-WITHDRAW-CURRENT
253620030422  ¦                                    TO IS-NET-WITHDRAW-CURRENT.
253630030422  ¦        IF WS-IVR-NET-WITHDRAW-CURRENT IS LESS THAN ZEROES
253640030422  ¦           MOVE "-"                 TO IS-NET-WITHDRAW-CURRENT-SIGN
253650061003R35540     ELSE
253660061003R35540        MOVE " "                 TO IS-NET-WITHDRAW-CURRENT-SIGN
253670030422  ¦        END-IF.
253680030422  ¦
253690030422  ¦        MOVE WS-IVR-DISTRIBUTION-CURRENT
253700030422  ¦                                    TO IS-DISTRIBUTION-CURRENT.
253710030422  ¦        IF WS-IVR-DISTRIBUTION-CURRENT IS LESS THAN ZEROES
253720030422  ¦           MOVE "-"                 TO IS-DISTRIBUTION-CURRENT-SIGN
253730061003R35540     ELSE
253740061003R35540        MOVE " "                 TO IS-DISTRIBUTION-CURRENT-SIGN
253750030422  ¦        END-IF.
253760030422  ¦
253770990620  ¦        MOVE WS-IVR-UNREAL-GAIN-LOSS-CURR
253780990620  ¦                               TO IS-UNREAL-GAIN-LOSS-CURR.
253790990620  ¦        IF WS-IVR-UNREAL-GAIN-LOSS-CURR IS LESS THAN ZEROES
253800990620  ¦           MOVE "-"            TO IS-UNREAL-GAIN-LOSS-CURR-SIGN
253810990620R35540     ELSE
253820990620R35540        MOVE " "            TO IS-UNREAL-GAIN-LOSS-CURR-SIGN
253830980627  ¦        END-IF.
253840980627  ¦
253850981222  ¦        MOVE WS-IVR-NET-INV-CAPTAL-INCEPT
253860980627  ¦                               TO IS-NET-INV-CAPTAL-INCEPT.
253870981222  ¦        IF WS-IVR-NET-INV-CAPTAL-INCEPT IS LESS THAN ZEROES
253880980521  ¦           MOVE "-"            TO IS-NET-INV-CAPTAL-INCEPT-SIGN
253890980521R35540     ELSE
253900990512R35540        MOVE " "            TO IS-NET-INV-CAPTAL-INCEPT-SIGN
253910990512R16990     END-IF.
253920990517
253930990517           MOVE ZEROES                TO  IS-FOREIGN-CONTENT.
253940980129           MOVE ZEROES                TO  IS-CDN-CONTENT.
253950980129           MOVE ZEROES                TO  IS-INVESTOR-PERC.
253960971024           MOVE WS-IVR-OPNMKTVAL      TO  IS-OPENING-MARKET-VALUE.
253970031003           MOVE ZEROES                TO  IS-CREATION-DATE.
253980031003           MOVE "N"                   TO  IS-NEW-ACCOUNT-INDICATOR.
253990031003           IF  WS-ORIGIN-COST-I
254000060621                          IS GREATER THAN  ZEROES
254010060621               MOVE WS-ORIGIN-COST-I   TO  IS-ORIGINAL-COST
254020060621             ELSE
254030060621               MOVE ZEROES             TO  IS-ORIGINAL-COST.
254040060623           ADD IS-FIRST60
254050060623               IS-REMAINDER        GIVING  IS-TOTAL-CONTRIBUTIONS-YTD.
254060060623
254070060623           INITIALIZE                  IS-LEVEL-OF-SERVICE.
254080060623           INITIALIZE                  IS-MARKET-VALUE-LAST-YE.
254090060623           INITIALIZE                  IS-MARKET-VALUE-LAST-YE-SIGN.
254100060621           MOVE II-START-DATE          TO  IS-START-DATE.
254110060626           MOVE II-END-DATE            TO  IS-END-DATE.
254120060621
254130060626R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
254140061003   ¦          MOVE WS-IPS-GROUP-ID     TO IS-IPS-GROUP-ID
254150061003R17527     END-IF.
254160060621R33331*    RFS 33331 Start
254170060621      *    Calculate IS-GAIN-LOSS-PD-OUT based on existing
254180060621      *    accumulted fields
254190080806           COMPUTE ln_IvrGainLossPdOut  =
254200080806                  (Ws-Ivr-Total-Value -
254210080806                   Ws-Ivr-Opnmktval -
254220170817                   Ws-Ivr-Net-Add-Current +
254230170817                   Ws-Ivr-Net-Withdraw-Current +
254240170817                   Ws-Is2-Inc-Current-Cash-Tot +
254250170817                   Ws-Is2-Cpg-Current-Cash-Tot)
254260170512
254270060621           MOVE ln_IvrGainLossPdOut TO IS-GAIN-LOSS-PD-OUT.
254280030825           IF   ln_IvrGainLossPdOut IS LESS THAN ZEROES
254290980609                MOVE lc_Negative TO IS-GAIN-LOSS-PD-OUT-SIGN
254300010308R35540     ELSE
254310010308R35540          MOVE " "         TO IS-GAIN-LOSS-PD-OUT-SIGN
254320010308           END-IF.
254330010308
254340010308R33331*    RFS 33331 Ends
254350010308R50993     MOVE " " TO IS-MULTIPLE-CONTRACT-FLAG,
254360020730R50993                 IS-JOINT-LIFE-FLAG.
254370010308
254380020730      *RFS145044 - Starts
254390020730           MOVE SPACES TO IS-DELIVERY-OPTION
254400061003                 OF INVESTOR-SUMMARY-SECTION.
254410061003      *RFS145044 - Ends
254420020730
254430020730R18147     MOVE INVESTOR-SUMMARY-SECTION TO STATEMENT-REC(ISR).
254440010308R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
254450020730
254460020730
254470061003RF8633*****
254480061003      *****    Write Investor Summary-2(Section12 Total Record).
254490020730      *****
254500020730
254510010308           IF WS-LDA-INVESTOR-12        IS EQUAL TO  "Y"
254520020730
254530020730              MOVE WS-IS2-INT-INCEPT-CASH-TOT  TO IS2-INT-INCEPT-CASH
254540061003R13637     IF   WS-IS2-INT-INCEPT-CASH-TOT  IS LESS THAN 0
254550061003  ¦             MOVE "-" TO IS2-INT-INCEPT-CASH-SIGN
254560020730R35540     ELSE
254570020730R35540          MOVE " " TO IS2-INT-INCEPT-CASH-SIGN
254580010308R13637     END-IF
254590020730
254600020730              MOVE WS-IS2-INT-YTD-CASH-TOT     TO IS2-INT-YTD-CASH
254610061003R13637     IF   WS-IS2-INT-YTD-CASH-TOT   IS LESS THAN 0
254620061003  ¦             MOVE "-" TO IS2-INT-YTD-CASH-SIGN
254630020730R35540     ELSE
254640020730R35540          MOVE " " TO IS2-INT-YTD-CASH-SIGN
254650010308R13637     END-IF
254660020730
254670020730              MOVE WS-IS2-INT-CURRENT-CASH-TOT TO IS2-INT-CURRENT-CASH
254680061003R13637     IF      WS-IS2-INT-CURRENT-CASH-TOT IS LESS THAN 0
254690061003  ¦             MOVE "-" TO IS2-INT-CURRENT-CASH-SIGN
254700020730R35540     ELSE
254710020730R35540          MOVE " " TO IS2-INT-CURRENT-CASH-SIGN
254720010308R13637     END-IF
254730010308
254740020730              MOVE WS-IS2-INT-INCEPT-REINV-TOT TO IS2-INT-INCEPT-REINV
254750020730R13637     IF      WS-IS2-INT-INCEPT-REINV-TOT IS LESS THAN 0
254760061003  ¦             MOVE "-" TO IS2-INT-INCEPT-REINV-SIGN
254770061003R35540     ELSE
254780020730R35540          MOVE " " TO IS2-INT-INCEPT-REINV-SIGN
254790020730R13637     END-IF
254800010308
254810020730              MOVE WS-IS2-INT-YTD-REINV-TOT    TO IS2-INT-YTD-REINV
254820020730R13637     IF      WS-IS2-INT-YTD-REINV-TOT  IS LESS THAN 0
254830061003  ¦             MOVE "-" TO IS2-INT-YTD-REINV-SIGN
254840061003R35540     ELSE
254850020730R35540          MOVE " " TO IS2-INT-YTD-REINV-SIGN
254860020730R13637     END-IF
254870010308
254880020730              MOVE WS-IS2-INT-CURRENT-REINV-TOT
254890020730                                               TO IS2-INT-CURRENT-REINV
254900061003R13637     IF      WS-IS2-INT-CURRENT-REINV-TOT  IS LESS THAN 0
254910061003  ¦             MOVE "-" TO IS2-INT-CURRENT-REINV-SIGN
254920020730R35540     ELSE
254930020730R35540          MOVE " " TO IS2-INT-CURRENT-REINV-SIGN
254940010308R13637     END-IF
254950020730
254960020730              MOVE WS-IS2-INC-INCEPT-CASH-TOT  TO IS2-INC-INCEPT-CASH
254970061003R13637     IF      WS-IS2-INC-INCEPT-CASH-TOT   IS LESS THAN 0
254980061003  ¦             MOVE "-" TO IS2-INC-INCEPT-CASH-SIGN
254990020730R35540     ELSE
255000020730R35540          MOVE " " TO IS2-INC-INCEPT-CASH-SIGN
255010010308R13637     END-IF
255020020730
255030020730              MOVE WS-IS2-INC-YTD-CASH-TOT     TO IS2-INC-YTD-CASH
255040061003R13637     IF      WS-IS2-INC-YTD-CASH-TOT   IS LESS THAN 0
255050061003  ¦             MOVE "-" TO IS2-INC-YTD-CASH-SIGN
255060020730R35540     ELSE
255070020730R35540          MOVE " " TO IS2-INC-YTD-CASH-SIGN
255080010308R13637     END-IF
255090020730
255100020730              MOVE WS-IS2-INC-CURRENT-CASH-TOT TO IS2-INC-CURRENT-CASH
255110061003R13637     IF      WS-IS2-INC-CURRENT-CASH-TOT    IS LESS THAN 0
255120061003  ¦             MOVE "-" TO IS2-INC-CURRENT-CASH-SIGN
255130020730R35540     ELSE
255140020730R35540          MOVE " " TO IS2-INC-CURRENT-CASH-SIGN
255150010308R13637     END-IF
255160010308
255170020730              MOVE WS-IS2-INC-INCEPT-REINV-TOT TO IS2-INC-INCEPT-REINV
255180020730R13637     IF      WS-IS2-INC-INCEPT-REINV-TOT     IS LESS THAN 0
255190061003  ¦             MOVE "-" TO IS2-INC-INCEPT-REINV-SIGN
255200061003R35540     ELSE
255210020730R35540          MOVE " " TO IS2-INC-INCEPT-REINV-SIGN
255220020730R13637     END-IF
255230010308
255240020730              MOVE WS-IS2-INC-YTD-REINV-TOT    TO IS2-INC-YTD-REINV
255250020730R13637     IF      WS-IS2-INC-YTD-REINV-TOT    IS LESS THAN 0
255260061003  ¦             MOVE "-" TO IS2-INC-YTD-REINV-SIGN
255270061003R35540     ELSE
255280020730R35540          MOVE " " TO IS2-INC-YTD-REINV-SIGN
255290020730R13637     END-IF
255300010308
255310020730              MOVE WS-IS2-INC-CURRENT-REINV-TOT
255320020730                                               TO IS2-INC-CURRENT-REINV
255330061003R13637     IF      WS-IS2-INC-CURRENT-REINV-TOT    IS LESS THAN 0
255340061003  ¦             MOVE "-" TO IS2-INC-CURRENT-REINV-SIGN
255350020730R35540     ELSE
255360020730R35540          MOVE " " TO IS2-INC-CURRENT-REINV-SIGN
255370010308R13637     END-IF
255380020730
255390020730              MOVE WS-IS2-CPG-INCEPT-CASH-TOT  TO IS2-CPG-INCEPT-CASH
255400061003R13637     IF      WS-IS2-CPG-INCEPT-CASH-TOT  IS LESS THAN 0
255410061003  ¦             MOVE "-" TO IS2-CPG-INCEPT-CASH-SIGN
255420020730R35540     ELSE
255430020730R35540          MOVE " " TO IS2-CPG-INCEPT-CASH-SIGN
255440010308R13637     END-IF
255450020730
255460020730              MOVE WS-IS2-CPG-YTD-CASH-TOT     TO IS2-CPG-YTD-CASH
255470061003R13637     IF      WS-IS2-CPG-YTD-CASH-TOT  IS LESS THAN 0
255480061003  ¦             MOVE "-" TO IS2-CPG-YTD-CASH-SIGN
255490020730R35540     ELSE
255500020730R35540          MOVE " " TO IS2-CPG-YTD-CASH-SIGN
255510010308R13637     END-IF
255520020730
255530020730              MOVE WS-IS2-CPG-CURRENT-CASH-TOT TO IS2-CPG-CURRENT-CASH
255540061003R13637     IF      WS-IS2-CPG-CURRENT-CASH-TOT  IS LESS THAN 0
255550061003  ¦             MOVE "-" TO IS2-CPG-CURRENT-CASH-SIGN
255560020730R35540     ELSE
255570020730R35540          MOVE " " TO IS2-CPG-CURRENT-CASH-SIGN
255580010308R13637     END-IF
255590010308
255600020730              MOVE WS-IS2-CPG-INCEPT-REINV-TOT TO IS2-CPG-INCEPT-REINV
255610020730R13637     IF      WS-IS2-CPG-INCEPT-REINV-TOT  IS LESS THAN 0
255620061003  ¦             MOVE "-" TO IS2-CPG-INCEPT-REINV-SIGN
255630061003R35540     ELSE
255640020730R35540          MOVE " " TO IS2-CPG-INCEPT-REINV-SIGN
255650020821R13637     END-IF
255660020821
255670020821              MOVE WS-IS2-CPG-YTD-REINV-TOT    TO IS2-CPG-YTD-REINV
255680020821R13637     IF      WS-IS2-CPG-YTD-REINV-TOT  IS LESS THAN 0
255690061003  ¦             MOVE "-" TO IS2-CPG-YTD-REINV-SIGN
255700061003R35540     ELSE
255710020821R35540          MOVE " " TO IS2-CPG-YTD-REINV-SIGN
255720020821R13637     END-IF
255730020821
255740020821              MOVE WS-IS2-CPG-CURRENT-REINV-TOT
255750020821                                               TO IS2-CPG-CURRENT-REINV
255760061003R13637     IF      WS-IS2-CPG-CURRENT-REINV-TOT  IS LESS THAN 0
255770061003  ¦             MOVE "-" TO IS2-CPG-CURRENT-REINV-SIGN
255780020821R35540     ELSE
255790020821R35540          MOVE " " TO IS2-CPG-CURRENT-REINV-SIGN
255800020821R13637     END-IF
255810020821
255820020821R14136        MOVE WS-IS2-MFR-CUR-TOT  TO  IS2-MFR-CUR
255830061003  ¦        IF      WS-IS2-MFR-CUR-TOT   IS LESS THAN 0
255840061003  ¦             MOVE "-" TO IS2-MFR-CUR-SIGN
255850020821R35540     ELSE
255860020821R35540          MOVE " " TO IS2-MFR-CUR-SIGN
255870020821R14136     END-IF
255880020821
255890020821R14136        MOVE WS-IS2-MFR-YTD-TOT  TO  IS2-MFR-YTD
255900061003  ¦        IF      WS-IS2-MFR-YTD-TOT   IS LESS THAN 0
255910061003  ¦             MOVE "-" TO IS2-MFR-YTD-SIGN
255920020821R35540     ELSE
255930020821R35540          MOVE " " TO IS2-MFR-YTD-SIGN
255940020821R14136     END-IF
255950020821
255960020821R14136        MOVE WS-IS2-MFR-INCEPT-TOT  TO  IS2-MFR-INCEPT
255970061003  ¦        IF      WS-IS2-MFR-INCEPT-TOT  IS LESS THAN 0
255980061003  ¦             MOVE "-" TO IS2-MFR-INCEPT-SIGN
255990020821R35540     ELSE
256000020821R35540          MOVE " " TO IS2-MFR-INCEPT-SIGN
256010020821R14136     END-IF
256020020821
256030020821R14136        MOVE WS-IS2-FED-WHTAX-CUR-TOT  TO  IS2-FED-WHTAX-CUR
256040061003  ¦        IF      WS-IS2-FED-WHTAX-CUR-TOT  IS LESS THAN 0
256050061003  ¦             MOVE "-" TO IS2-FED-WHTAX-CUR-SIGN
256060020821R35540     ELSE
256070020821R35540          MOVE " " TO IS2-FED-WHTAX-CUR-SIGN
256080020821R14136     END-IF
256090020821
256100020821R14136        MOVE WS-IS2-FED-WHTAX-YTD-TOT  TO  IS2-FED-WHTAX-YTD
256110061003  ¦        IF      WS-IS2-FED-WHTAX-YTD-TOT  IS LESS THAN 0
256120061003  ¦             MOVE "-" TO IS2-FED-WHTAX-YTD-SIGN
256130020821R35540     ELSE
256140010308R35540          MOVE " " TO IS2-FED-WHTAX-YTD-SIGN
256150021004R14136     END-IF
256160021004
256170021004R14136        MOVE WS-IS2-PROV-WHTAX-CUR-TOT  TO  IS2-PROV-WHTAX-CUR
256180061003  ¦        IF      WS-IS2-PROV-WHTAX-CUR-TOT  IS LESS THAN 0
256190061003  ¦             MOVE "-" TO IS2-PROV-WHTAX-CUR-SIGN
256200021004R35540     ELSE
256210021004R35540          MOVE " " TO IS2-PROV-WHTAX-CUR-SIGN
256220021004R14136     END-IF
256230021004
256240021004R14136        MOVE WS-IS2-PROV-WHTAX-YTD-TOT  TO  IS2-PROV-WHTAX-YTD
256250061003  ¦        IF      WS-IS2-PROV-WHTAX-YTD-TOT  IS LESS THAN 0
256260061003  ¦             MOVE "-" TO IS2-PROV-WHTAX-YTD-SIGN
256270021004R35540     ELSE
256280021004R35540          MOVE " " TO IS2-PROV-WHTAX-YTD-SIGN
256290021004R14136     END-IF
256300021004
256310021004R14858        MOVE WS-IS2-BAJ-CUR-TOT  TO  IS2-BAJ-CUR
256320061003  ¦        IF      WS-IS2-BAJ-CUR-TOT     IS LESS THAN 0
256330061003  ¦             MOVE "-" TO IS2-BAJ-CUR-SIGN
256340021004R35540     ELSE
256350021004R35540          MOVE " " TO IS2-BAJ-CUR-SIGN
256360021004R14858     END-IF
256370021004
256380021004R14858        MOVE WS-IS2-BAJ-YTD-TOT  TO  IS2-BAJ-YTD
256390061003  ¦        IF      WS-IS2-BAJ-YTD-TOT       IS LESS THAN 0
256400061003  ¦             MOVE "-" TO IS2-BAJ-YTD-SIGN
256410021004R35540     ELSE
256420021004R35540          MOVE " " TO IS2-BAJ-YTD-SIGN
256430021004R14858     END-IF
256440021004
256450021004R14858        MOVE WS-IS2-BAJ-INCEPT-TOT TO  IS2-BAJ-INCEPT
256460061003  ¦        IF      WS-IS2-BAJ-INCEPT-TOT    IS LESS THAN 0
256470061003  ¦             MOVE "-" TO IS2-BAJ-INCEPT-SIGN
256480021004R35540     ELSE
256490021004R35540          MOVE " " TO IS2-BAJ-INCEPT-SIGN
256500021004R14858     END-IF
256510021004
256520021004R14858        MOVE WS-IS2-BFW-CUR-TOT  TO  IS2-BFW-CUR
256530061003  ¦        IF      WS-IS2-BFW-CUR-TOT       IS LESS THAN 0
256540061003  ¦             MOVE "-" TO IS2-BFW-CUR-SIGN
256550021004R35540     ELSE
256560021004R35540          MOVE " " TO IS2-BFW-CUR-SIGN
256570040414R14858     END-IF
256580040414
256590040414R14858        MOVE WS-IS2-BFW-YTD-TOT  TO  IS2-BFW-YTD
256600061003  ¦        IF      WS-IS2-BFW-YTD-TOT       IS LESS THAN 0
256610061003  ¦             MOVE "-" TO IS2-BFW-YTD-SIGN
256620040414R35540     ELSE
256630040414R35540          MOVE " " TO IS2-BFW-YTD-SIGN
256640040414R14858     END-IF
256650040414
256660040414R14858        MOVE WS-IS2-BFW-INCEPT-TOT  TO  IS2-BFW-INCEPT
256670061003  ¦        IF      WS-IS2-BFW-INCEPT-TOT    IS LESS THAN 0
256680061003  ¦             MOVE "-" TO IS2-BFW-INCEPT-SIGN
256690040414R35540     ELSE
256700040414R35540          MOVE " " TO IS2-BFW-INCEPT-SIGN
256710040414R14858     END-IF
256720040414
256730040414R20758     MOVE WS-IS2-ROC-CUR-TOT        TO  IS2-ROC-CUR
256740061003  ¦        IF      WS-IS2-ROC-CUR-TOT   IS LESS THAN 0
256750061003  ¦             MOVE "-" TO IS2-ROC-CUR-SIGN
256760040414R35540     ELSE
256770140519R35540          MOVE " " TO IS2-ROC-CUR-SIGN
256780040414R20758     END-IF
256790010308
256800010308R20758     MOVE WS-IS2-ROC-YTD-TOT        TO  IS2-ROC-YTD
256810010308  ¦        IF      WS-IS2-ROC-YTD-TOT   IS LESS THAN 0
256820060621  ¦             MOVE "-" TO IS2-ROC-YTD-SIGN
256830030825R35540     ELSE
256840010308R35540          MOVE " " TO IS2-ROC-YTD-SIGN
256850010308R20758     END-IF
256860980609
256870980609R20758     MOVE WS-IS2-ROC-INCEPT-TOT  TO  IS2-ROC-INCEPT
256880980609  ¦        IF      WS-IS2-ROC-INCEPT-TOT    IS LESS THAN 0
256890980609  ¦             MOVE "-" TO IS2-ROC-INCEPT-SIGN
256900980609R35540     ELSE
256910980609R35540          MOVE " " TO IS2-ROC-INCEPT-SIGN
256920980609R20758     END-IF
256930980609130239     PERFORM PREPARE-SECTION12-NEW-FIELD-T
256940980609
256950970530              MOVE II-START-DATE            TO  IS2-START-DATE
256960060621              MOVE II-END-DATE              TO  IS2-END-DATE
256970030826
256980000000R18147        MOVE INVESTOR-SUMMARY-SECTION-2 TO STATEMENT-REC(ISR)
256990000000R18147        PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
257000000000           END-IF.
257010970108
257020970108      *****
257030970108      *****    If a Dealer record is not to be created for each account,
257040970108      *****    format and create them here.
257050970108      *****
257060970108
257070970108           IF  WS-LDA-DEALER-FLAG
257080970108                          IS NOT EQUAL TO  "A"
257090970108               PERFORM FORMAT-DEALER-RECORD
257100970108                                      THRU FDR-EXIT.
257110970108
257120970108R18147     MOVE INVESTOR-INFO-SECTION TO STATEMENT-REC(ISR).
257130970108R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
257140970108
257150970108       LS3-EXIT.
257160970108           EXIT.
257170970108      /
257180970108       LEVEL-SUMMARY-4.
257190970108
257200970108      ******************************************************************
257210970108      *                                                                *
257220970108      *    L E V E L   S U M M A R I Z A T I O N   4   R O U T I N E   *
257230970108      *                                                                *
257240970108      *        ACDEALREP:  Dealer Representative                       *
257250970108      *                                                                *
257260970108      ******************************************************************
257270970108
257280970108      *****
257290970108      *****    Remember, this level is only to be used for INVESTOR type
257300970108      *****    statements, indicated by position 610 of the LDA contains
257310970108      *****    a value of 'D' (Dealer) or 'R' (Dealer Representative).
257320970108      *****
257330970108      *****    If the dealer representative being processed is to be
257340970108      *****    bypassed, exit.
257350970108      *****
257360970108
257370970108           IF  WS-LR4BYP-SW   IS EQUAL TO  "Y"
257380970108               GO TO LS4-EXIT.
257390970108
257400970108           CONTINUE.
257410970108
257420970108       LS4-EXIT.
257430970108           EXIT.
257440970108      /
257450970108       LEVEL-SUMMARY-5.
257460970108
257470970108      ******************************************************************
257480970108      *                                                                *
257490970108      *    L E V E L   S U M M A R I Z A T I O N   5   R O U T I N E   *
257500970108      *                                                                *
257510970108      *        ACDEALER:   Dealer                                      *
257520970108      *                                                                *
257530970108      ******************************************************************
257540970103
257550000000      *****
257560970103      *****    Remember, this level is only to be used for INVESTOR type
257570970103      *****    statements, indicated by position 610 of the LDA contains
257580970103      *****    a value of 'D' (Dealer) or 'R' (Dealer Representative).
257590970103      *****
257600970103      *****    If the dealer being processed is to be bypassed, exit.
257610970103      *****
257620971024
257630971024           IF  WS-LR5BYP-SW   IS EQUAL TO  "Y"
257640971024               GO TO LS5-EXIT.
257650971024
257660971024           CONTINUE.
257670971024
257680971024       LS5-EXIT.
257690971024           EXIT.
257700971024      /
257710971024       FORMAT-DEALER-RECORD.
257720971024
257730971024      ******************************************************************
257740971024      *                                                                *
257750971024      *    F O R M A T   D E A L E R   R E C O R D   R O U T I N E     *
257760971024      *                                                                *
257770971024      ******************************************************************
257780970103
257790970422      *****
257800970422      *****    This routine formats and creates the Dealer record(s).
257810970422      *****    If multiple dealer/representatives are not to be
257820970422      *****    processed, flag it now.
257830970422      *****
257840970422
257850981128           MOVE "N"                    TO  WS-IDRSTR-SW.
257860970422
257870970422           IF  WS-LDA-DEALER-FLAG
257880970422                              IS EQUAL TO  "A"
257890970422               GO TO FDR-0000-0020.
257900971024
257910971024           IF  WS-LDA-DEALER-FLAG
257920971024                          IS NOT EQUAL TO  "M"
257930971024               GO TO FDR-0000-0010.
257940971024
257950970422      *****
257960970422      *****    Start the Investor Dealer Representative.  This file will
257970970422      *****    be processed after a Dealer record has been created.
257980970422      *****
257990970422
258000970422           INITIALIZE MFAIVRDRP.
258010971024           MOVE PREV-INVESTOR          TO  INVESTOR-NO
258020970427                                           OF INVESTOR-DEALER-REP-REC.
258030970429           START INVESTOR-DEALER-REP
258040990726               KEY       IS NOT LESS THAN  EXTERNALLY-DESCRIBED-KEY
258050971024               INVALID KEY
258060971024                   GO TO FDR-0000-0010.
258070970422
258080000000           MOVE "Y"                    TO  WS-IDRSTR-SW.
258090000000
258100000000       FDR-0000-0010.
258110000000
258120000000      *****
258130970425      *****    Format the required Investor Dealer Representative for
258140970429      *****    the primary sales representative.
258150970425      *****
258160970425
258170970425           MOVE SPACES                 TO  WS-FDR-ACCOUNT.
258180970425           MOVE "DLR"                  TO  WS-FDR-ADVTYPCDE.
258190970425           MOVE II-DEALER              TO  WS-FDR-DLRCDE.
258200970425           MOVE WS-II-SALESREP         TO  WS-FDR-DLRREPCDE.
258210000000
258220970422       FDR-0000-0020.
258230970103
258240970425      *-------------------------------------------------
258250000000      * SET UP DEALER RECORD
258260000000      * GET DEALER FILE FOR NAME,ADDRESS, ETC
258270000000      * AS THIS IS NOT CONTAINED IN INVESTOR-JOIN
258280970425      *-------------------------------------------------
258290970429
258300970427           MOVE WS-FDR-DLRCDE          TO  DEALER-CODE
258310070925                                           OF DEALER-REC.
258320070925           READ DEALER
258330070925               INVALID KEY
258340070925                   MOVE "DEALER NAME NOT ON FILE"
258350070925                                       TO  DEALER-NAME
258360070925                                           OF DEALER-REC.
258370070925
258380070925       FDR-0010.
258390070925           INITIALIZE DEALER-SECTION.
258400070925           MOVE PREV-INVESTOR          TO  DL-INVESTOR.
258410070925            MOVE ZEROES                TO DL-ACCOUNT.
258420070925            MOVE 05                    TO DL-SECTION.
258430070925            MOVE WS-INVESTOR-COUNT     TO DL-SECTION-SEQ.
258440070925           MOVE II-LANGUAGE-CODE       TO  DL-LANGUAGE.
258450070925           MOVE WS-FDR-DLRCDE          TO  DL-DEALER.
258460070925           MOVE WS-FDR-DLRREPCDE       TO  DL-SALESREP.
258470070925
258480070925      ** RFS43691 - Start
258490070925      *  In the event that the professional designation field
258500070925      *  in the Dealer-Rep-MISC-Detail MFADLRMSCP is blank,
258510010320      *  it just passes the blanks for both the statement
258520010320      *  and confirmation extract files.
258530010320
258540010320           INITIALIZE MFADLRMSCP OF DEALER-REP-MISC-DETAILS-REC.
258550010320           MOVE DL-DEALER   TO DEALER-CODE
258560010320                               OF DEALER-REP-MISC-DETAILS-REC.
258570010320           MOVE DL-SALESREP TO DEALER-REP-CODE
258580010320                               OF DEALER-REP-MISC-DETAILS-REC.
258590000000           READ DEALER-REP-MISC-DETAILS
258600000000             INVALID KEY
258610191111               MOVE SPACES        TO DL-PROF-DES
258620191206      *RFS184366 Starts
258630200103                                     DL-PRIMARY-NAME
258640200103      *RFS185440 Starts
258650200103      *                              DL-INCORP-REP-IND
258660200103               MOVE "N"          TO  DL-INCORP-REP-IND
258670191111      *RFS185440 Ends
258680000000      *RFS184366 Ends
258690000000             NOT INVALID KEY
258700970103               MOVE PROF-DESIGNATION OF DEALER-REP-MISC-DETAILS-REC
258710191111                                  TO DL-PROF-DES
258720191111      *RFS184366 Starts
258730191111               MOVE INCORP-REP-IND   OF DEALER-REP-MISC-DETAILS-REC
258740191111                                  TO DL-INCORP-REP-IND
258750191111               MOVE PRIMARY-NAME     OF DEALER-REP-MISC-DETAILS-REC
258760191111                                  TO DL-PRIMARY-NAME
258770971215      *RFS184366 Ends
258780971215           END-READ.
258790031006      ** RFS43691 - End
258800970429
258810970425RF9764     IF DL-LANGUAGE              IS NOT EQUAL TO "F"
258820970427              MOVE DEALER-NAME
258830970422                OF DEALER-REC          TO  DL-DEALER-NAME
258840000000           ELSE
258850031006              MOVE DEALER-NAME-FRENCH
258860031006                OF DEALER-REC          TO  DL-DEALER-NAME
258870011001           END-IF.
258880011001
258890970425      *------------------------------------------------*
258900971215      *  GET AND FORMAT REP NAME                       *
258910990315      *------------------------------------------------*
258920990315
258930990315           MOVE SPACES                 TO  WS-REP-NAME.
258940990315
258950990315R18368     INITIALIZE MFADEAREP OF DEALER-REP-REC.
258960990315           MOVE WS-FDR-DLRCDE          TO  DEALER-CODE
258970990315                                           OF DEALER-REP-REC.
258980990727           MOVE WS-FDR-DLRREPCDE       TO  DEALER-REP-CODE
258990990727                                           OF DEALER-REP-REC.
259000990315            READ DEALER-REP
259010990317              INVALID KEY
259020990317R18368             INITIALIZE MFADEAREP OF DEALER-REP-REC
259030990317                   MOVE SPACES  TO MARKETTING-BRANCH-CODE
259040990317                                OF DEALER-REP-REC
259050990317                   GO TO FDR-0020.
259060990315
259070990727           INITIALIZE MFAINSBRP.
259080160302           MOVE INSTITUTION-CODE OF DEALER  TO INSTITUTION-CODE
259090160201                            OF INSTITUTION-BRANCH.
259100160202           MOVE BRANCH-CODE OF DEALER-REP TO BRANCH-CODE
259110160202                            OF INSTITUTION-BRANCH.
259120160201           READ INSTITUTION-BRANCH
259130130614               INVALID KEY
259140130614                   MOVE ZEROES TO DL-BRANCH-PHONE
259150130614                   GO TO FDR-0015.
259160130614
259170130614           MOVE AREA-CODE OF INSTITUTION-BRANCH
259180130614                             TO WS-BRANCH-AREA.
259190130614           MOVE PHONE-NO OF INSTITUTION-BRANCH
259200130614                    TO WS-BRANCH-PHONE.
259210130614           MOVE WS-INSTITUTION-BRANCH-NO TO DL-BRANCH-PHONE.
259220130614
259230130614       FDR-0015.
259240130614148326     INITIALIZE ln_DeaRepAsstPhoneNo.
259250130614148326     MOVE ASSISTANT-NAME OF DEALER-REP-REC TO  DL-REP-ASST-NAME.
259260130614148326     MOVE ASSISTANT-PHONE-AREA OF DEALER-REP-REC TO ln_DRAsAreaNo.
259270130614148326     MOVE ASSISTANT-PHONE-NO OF DEALER-REP-REC TO ln_DRAsPhonNo.
259280130614148326     MOVE ln_DeaRepAsstPhoneNo TO DL-REP-ASST-PHONE-NO.
259290130614117038     MOVE DEALER-REP-STATUS OF DEALER-REP-REC to DL-REP-STATUS.
259300090309117038     MOVE FIRST-NAME OF  DEALER-REP-REC  to DL-REP-FIRST-NAME.
259310090309117038     MOVE INITIALS   OF  DEALER-REP-REC  to DL-REP-MIDDLE-NAME.
259320090309117038     Move LAST-NAME  OF  DEALER-REP-REC  to DL-REP-LAST-NAME.
259330090309117038     Move Spaces                         to lc_S22ContactMethod.
259340090309117038     Exec SQL
259350090309117038         Select DRECMP.CONTACT
259360090305117038          Into :lc_S22ContactMethod
259370090309117038          From MFADRECMP DRECMP
259380090309117038         Where
259390090309117038         DRECMP.DEALER_CODE     = :WS-FDR-DLRCDE     AND
259400090305117038         DRECMP.DEALER_REP_CODE = :WS-FDR-DLRREPCDE  AND
259410090506117038         DRECMP.CONTACT_METHOD  = "EMAIL"
259420090305117038         Fetch first row only
259430971215117038     End-Exec.
259440001212117038     Move lc_S22ContactMethod  to DL-REP-EMAIL.
259450970425
25946097042566105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
25947097042566105      Set pb-adrName to True.
25948097042566105      Move SALUTATION-CODE OF DEALER-REP-REC  to pc-InSalutation.
25949097042566105      Move FIRST-NAME      OF DEALER-REP-REC  to pc-InFirstName.
25950097042566105      Move INITIALS        OF DEALER-REP-REC  to pc-InInitial.
25951097042566105      Move LAST-NAME       OF DEALER-REP-REC  to pc-InLastName.
259520970425
25953097042566105      Call "FXSTRTADR" using pt-StreetAddressAction,
25954097042566105                             pt-StreetAddressIn,
25955097042566105                             pt-StreetAddressOut.
25956097042566105
25957097042566105      Move pc-OutName(1:40) To WS-REP-NAME.
259580970425
259590970425           MOVE WS-REP-NAME            TO  DL-REP-NAME.
259600990512RF8664     MOVE BRANCH-CODE OF DEALER-REP-REC   TO  DL-BRANCH-CODE.
259610970425
259620970425       FDR-0020.
259630971024
259640971024      *****
259650971024      *****    Format and create the Delivery Info record, once only.
259660971024      *****
259670971024
259680980727           IF  DELIVERY-PRINTED
259690030617               GO TO FDR-0030.
259700030617
259710971024           INITIALIZE DELIVERY-INFO-SECTION.
259720971024            MOVE ZEROES                TO DI-INVESTOR-NO.
259730030617            MOVE ZEROES                TO DI-ACCOUNT.
259740030617            MOVE 00                    TO DI-SECTION-NO.
259750030617            MOVE ZEROES                TO DI-SECTION-SEQUENCE.
259760971024            MOVE DL-LANGUAGE           TO  DI-LANGUAGE-CODE.
259770971024            MOVE SPACES                TO  DI-DEALER.
259780030617            MOVE SPACES                TO  DI-DEALER-REP-CODE.
259790030617           MOVE WS-LDA-DELIVERY-METHOD TO  DI-DELIVERY-METHOD.
259800030617           IF  WS-LDA-DELIVERY-METHOD
259810971024                              IS EQUAL TO  "FAX"
259820971024               MOVE WS-LDA-FAX-NUMBER  TO  DI-FAX-NUMBER.
259830980723           MOVE WS-LDA-PRINTER-ID      TO  DI-PRINTER-ID.
259840030617
259850030617           IF  WS-LDA-REQUEST-SCOPE IS EQUAL TO  "D"
259860030617R17217         MOVE "D"                TO  DI-STMT-TYPE-IND
259870030617               MOVE DL-DEALER-NAME     TO  DI-RECIPIENT
259880030617               MOVE DL-DEALER-NAME     TO  DI-COMPANY.
259890030617
259900030617           IF  WS-LDA-REQUEST-SCOPE IS EQUAL TO  "R"
259910030617R17217         MOVE "R"                TO  DI-STMT-TYPE-IND
259920030617               MOVE DL-REP-NAME        TO  DI-RECIPIENT
259930030617               MOVE DL-DEALER-NAME     TO  DI-COMPANY.
259940030617
259950030617           IF  WS-LDA-REQUEST-SCOPE IS EQUAL TO  "I"
259960030617R17217         MOVE "I"                TO  DI-STMT-TYPE-IND
259970980723               MOVE II-INVESTOR-NAME   TO  DI-RECIPIENT
259980980723               MOVE SPACES             TO  DI-COMPANY.
259990980727
260000980727R17217     MOVE WS-LDA-MGMT-COM-CDE    TO DI-CLIENT-CODE.
260010980727  ¦
260020980727  ¦        IF  WS-LDA-REQUEST-SCOPE    IS EQUAL TO  "A" OR "R"
260030980727  ¦        AND WS-LDA-CPYSELECT        IS EQUAL TO  "A"
260040980727  ¦            IF WS-LDA-ALLTYP        IS EQUAL TO  "R"
260050980727  ¦               MOVE "R"             TO DI-STMT-TYPE-IND
260060980727  ¦            ELSE IF WS-LDA-ALLTYP   IS EQUAL TO  "D"
260070980727  ¦               MOVE "D"             TO DI-STMT-TYPE-IND
260080980727  ¦            ELSE
260090980727  ¦               MOVE "I"             TO DI-STMT-TYPE-IND
260100980727  v            END-IF
260110980723R17217     END-IF.
260120980723
260130980724           CALL "RTVUSERID"           USING WS-USERID.
260140990816           MOVE WS-USERID             TO DI-USERID.
260150980724
260160980724           IF DI-PRINTER-ID IS NOT EQUAL TO SPACES
260170980724              GO TO FDR-0020-0001.
260180051111
260190990512           INITIALIZE  MFAUSRP.
260200990512           MOVE WS-USERID             TO USER OF USER-FILE.
260210020321           READ USER-FILE
260220980129                INVALID KEY
260230980129                DISPLAY "INVALID USER FOR PRINTER".
260240060621           MOVE PRINTER OF USER-FILE  TO DI-PRINTER-ID.
260250030826
260260030826       FDR-0020-0001.
260270970425           MOVE WS-REQUEST-DATE       TO DI-REQUEST-DATE.
260280970425           MOVE WS-REQUEST-TIME-2     TO DI-REQUEST-TIME.
260290970425
260300970425           IF WS-LDA-DSP-REQUEST-FILE IS EQUAL TO "Y"
260310000000             CALL "RTVFILNAME"        USING WS-REQUEST-FILE
260320000000             MOVE WS-REQUEST-FILE     TO DI-REQUEST-FILE.
260330000000
260340000000R30514     MOVE WS-FOREIGN-CONTENT-LIMIT TO DI-FOREIGN-CONTENT-LIMIT.
260350970422
260360970422       FDR-0020-0002.
260370970422           MOVE WS-PREV-START-DATE       TO DI-START-DATE.
260380970422           MOVE PREV-END-DATE         TO DI-END-DATE.
260390970422
260400970422R18147     MOVE DELIVERY-INFO-SECTION TO STATEMENT-REC(ISR).
260410970422R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
260420970422
260430970422           MOVE "Y"                    TO  WS-DELIVERY-PRINTED.
260440000000
260450000000       FDR-0030.
260460000000
260470000000      *------------------------------------------------*
260480000000      *  FORMAT REP ADDRESS                            *
260490000000      *                                                *
260500000000      *------------------------------------------------*
260510000000
260520000000           IF  ADDR-NO
260530000000               OF DEALER-REP-REC EQUAL TO  ZEROES
260540000000               GO TO GET-BRANCH-ADDRESS.
260550000000
260560000000           INITIALIZE MFADRADRP.
260570000000           MOVE ADDR-NO
260580000000                OF DEALER-REP-REC      TO  ADDR-NO
260590000000                                           OF DEALER-REP-ADDR-REC.
260600000000            READ DEALER-REP-ADDRESS
260610000000                INVALID KEY
260620000000                    GO TO GET-BRANCH-ADDRESS.
260630000000            MOVE CORR MFADRADRP OF DEALER-REP-ADDRESS
260640000000                 TO MFAINADDP OF INSTITUTION-ADDRESS.
260650000000            GO TO FORMAT-ADDRESS.
260660000000
260670000000       GET-BRANCH-ADDRESS.
260680000000           MOVE INSTITUTION-CODE OF DEALER  TO INSTITUTION-CODE
260690000000                            OF INSTITUTION-BRANCH.
260700000000           MOVE BRANCH-CODE OF DEALER-REP TO BRANCH-CODE
260710000000                            OF INSTITUTION-BRANCH.
260720000000           READ INSTITUTION-BRANCH
260730000000               INVALID KEY
260740000000                   GO TO GET-DEALER-ADDRESS.
260750000000           MOVE ADDR-NO OF INSTITUTION-BRANCH
260760000000                             TO ADDR-NO
260770000000                             OF INSTITUTION-ADDRESS.
260780000000           READ INSTITUTION-ADDRESS
260790000000               INVALID KEY
260800000000                   GO TO GET-DEALER-ADDRESS.
260810000000           GO TO FORMAT-ADDRESS.
260820000000
260830000000       GET-DEALER-ADDRESS.
260840000000           MOVE INSTITUTION-CODE OF DEALER  TO INSTITUTION-CODE
260850000000                             OF INSTITUTION-BRANCH.
260860000000
260870000000           MOVE BRANCH-CODE OF DEALER  TO BRANCH-CODE
260880000000                             OF INSTITUTION-BRANCH.
260890021002
260900970103           READ INSTITUTION-BRANCH
260910021002               INVALID KEY
260920021002                   INITIALIZE INSTITUTION-ADDR-REC
260930020717                   GO TO FORMAT-ADDRESS.
260940021002
260950021002           MOVE ADDR-NO OF INSTITUTION-BRANCH
260960021002                             TO ADDR-NO
260970021002                             OF INSTITUTION-ADDRESS.
260980021002
260990970512           READ INSTITUTION-ADDRESS
261000970512               INVALID KEY
261010970512                   INITIALIZE INSTITUTION-ADDR-REC
261020970512                   GO TO FORMAT-ADDRESS.
261030030912
261040030912       FORMAT-ADDRESS.
261050970103R14787     IF II-LANGUAGE-CODE IS EQUAL TO "E"
261060970512           MOVE BRANCH-NAME
261070970103                OF INSTITUTION-BRANCH  TO  DL-BRANCH-NAME
261080970103R14787     END-IF
261090970103
261100970103R14787     IF II-LANGUAGE-CODE IS EQUAL TO "F"
261110970103  ¦         MOVE BRANCH-NAME-FRENCH
261120090309  ¦             OF INSTITUTION-BRANCH  TO  DL-BRANCH-NAME
261130090309R14787     END-IF
261140090309
261150090305      *****
261160090309      *****    Format address line 1 using the Care of / Attention to.
261170090305      *****
261180090309
261190090305R17380     MOVE CO-OR-ATTENTION OF INSTITUTION-ADDR-REC
261200090309  |          TO DL-BRANCH-CO-ATTN.
261210090306      *****
261220090309      *****    Format address line 2 using the Street Number, Street
261230090305      *****    Name, Street Type and Street Direction.  Each field will
261240090309      *****    be handled separately in case one or more of the fields
261250090306      *****    contain spaces.
261260090309      *****
261270090306
26128009030966105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
26129009030666105      Set pb-adrStreet to True.
26130009030566105      Set pb-adrProvince to True.
26131009030966105      Move STREET-NO         OF INSTITUTION-ADDRESS
26132009030966105                             to pc-InStreetNo.
26133009030966105      Move STREET-NAME       OF INSTITUTION-ADDRESS
26134009030566105                             to pc-InStreetName.
26135009030966105      Move STREET-TYPE-CODE  OF INSTITUTION-ADDRESS
26136097121266105                             to pc-InStreetTypeCode.
26137097051266105      Move PROVINCE-CODE     OF INSTITUTION-ADDRESS
26138097051266105                             to pc-InProvinceCode.
26139097051266105      Move STREET-DIRCT-CODE OF INSTITUTION-ADDRESS
26140097051266105                             to pc-InDirectionCode.
26141097010366105      Move CITY              OF INSTITUTION-ADDRESS
26142097051266105                             to pc-InCity.
26143097051266105      If COUNTRY-CODE OF INSTITUTION-ADDR-REC Not = "CAN"
26144097051266105         Move COUNTRY-CODE OF INSTITUTION-ADDR-REC to pc-InCountry
26145097051266105      End-If
261460970512
26147097051266105      Call "FXSTRTADR" using pt-StreetAddressAction,
26148097051266105                             pt-StreetAddressIn,
26149097051266105                             pt-StreetAddressOut.
26150097051266105
26151097051266105      Move pc-OutStreet To DL-BRANCH-ADDR2.
261520970512
261530970512      *****
261540970103      *****    Format address line 3 using the First Miscellaneous
261550970103      *****    Address.
261560970103      *****
261570970103
261580970103           MOVE MISC-FIRST-ADDR-LINE
261590970103                OF INSTITUTION-ADDR-REC
261600000000                                       TO  DL-BRANCH-ADDR3.
261610970103
261620970103      *****
261630020423      *****    Format address line 4 using the Second Miscellaneous
261640970512      *****    Address.
261650970512      *****
261660970512
261670970512           MOVE MISC-SECOND-ADDR-LINE
261680970120                OF INSTITUTION-ADDR-REC
261690970120                                       TO  DL-BRANCH-ADDR4.
261700970120
261710970103      *****
261720970120      *****    Format address line 5 using the City, Province and Postal
261730970120      *****    Code.  Each field will be handled separately in case one
261740970120      *****    or more of the fields contain spaces.
261750970120      *****
261760970120
261770970512           MOVE SPACES                 TO  WS-ADRTMP.
261780970512           MOVE SPACES                 TO  WS-BRANCH-ADDR5.
261790970512R13011     MOVE SPACES                 TO  WS-ADDR4-SEPARATE.
261800970512
261810970512      *****
261820970512      *****    Format the postal code, depending on the country code.
261830970512      *****
261840970512
261850970512           MOVE POSTAL-CODE
261860970512                OF INSTITUTION-ADDRESS TO  WS-POSTAL.
261870970512           MOVE SPACES                 TO  WS-POSTAL-OUT.
261880970512           IF  COUNTRY-CODE
261890970512               OF INSTITUTION-ADDRESS
261900970512                              IS EQUAL TO  "CAN"
261910970512               MOVE WS-POSTAL1         TO  WS-POSTAL-OUT1
261920141201               MOVE WS-POSTAL2         TO  WS-POSTAL-OUT2
261930141201               GO TO FDR-0030-0040.
261940970512
261950090306           IF  COUNTRY-CODE
261960090309               OF INSTITUTION-ADDR-REC
261970970103                          IS NOT EQUAL TO  "USA"
261980970103               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
261990090306               GO TO FDR-0030-0040.
262000090306
262010090306           IF  WS-POSTALU2    IS EQUAL TO  SPACES
262020090309           OR  WS-POSTALU3    IS EQUAL TO  "-"
262030090504               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
262040090309               GO TO FDR-0030-0040.
262050090309
262060090309           MOVE WS-POSTALU1            TO  WS-POSTAL-OUTU1.
262070970512           MOVE "-"                    TO  WS-POSTAL-OUTU2.
262080020423138436*    MOVE WS-POSTALU2            TO  WS-POSTAL-OUTU3.
262090020423138436     MOVE WS-POSTALU4            TO  WS-POSTAL-OUTU3.
262100020423       FDR-0030-0040.
262110020423
26212002042366105      Move pc-OutProvince to Ws-Branch-Addr5.
262130020423
262140020423       FDR-0040.
262150020423
26216097051266105      Move ws-postal-out to lc-PostalCode
262170970512
26218097051266105      Move Spaces           to lc-Line80.
26219097051266105      String function trim(WS-BRANCH-ADDR5) "  "
26220097051266105             lc-PostalCode  Delimited by Size
26221097051266105        Into lc-Line80.
26222097051266105      Move lc-Line80 (1:40) to WS-BRANCH-ADDR5.
262230970512
262240970512R13011     IF WS-LDA-SEG-DEALER-ADD = "Y"
262250970512              MOVE CITY          OF INSTITUTION-ADDR-REC
262260970512                                     TO WS-ADDR4-SEPARATE-CITY
262270970512              MOVE PROVINCE-CODE OF INSTITUTION-ADDR-REC
262280970512                                     TO WS-ADDR4-SEPARATE-PROV
262290970512              MOVE WS-POSTAL-OUT     TO WS-ADDR4-SEPARATE-POST
262300970512R13011     END-IF.
262310970512
262320970512      *****
262330970512      *****    If processing a dealer rep address which is not Canadian,
262340970512      *****    the country code or name is to be printed on a separate
262350970512      *****    line.  If blank lines do not exist, the country code will
262360970512      *****    be formatted on address line 5.
262370970512      *****
262380970512
262390970512           MOVE SPACES                 TO  WS-DL-BRANCH-ADDR6.
262400970512
262410970512           IF  COUNTRY-CODE
262420970512               OF ADDRESS-RECD   EQUAL TO  "CAN"
262430970512               GO TO FDR-0100.
262440970512
262450970512           MOVE ZEROES                 TO  WS-BLKADR-CNT.
262460970512           IF  DL-BRANCH-ADDR1   EQUAL TO  SPACES
262470970512               ADD 1                   TO  WS-BLKADR-CNT.
262480970512           IF  DL-BRANCH-ADDR2   EQUAL TO  SPACES
262490090309               ADD 1                   TO  WS-BLKADR-CNT.
262500090506           IF  DL-BRANCH-ADDR3   EQUAL TO  SPACES
262510090506               ADD 1                   TO  WS-BLKADR-CNT.
262520090506           IF  DL-BRANCH-ADDR4   EQUAL TO  SPACES
262530090309               ADD 1                   TO  WS-BLKADR-CNT.
262540090309           IF  WS-BRANCH-ADDR5   EQUAL TO  SPACES
262550090309               ADD 1                   TO  WS-BLKADR-CNT.
262560970512
262570970512           IF  WS-BLKADR-CNT GREATER THAN  1
262580970512               GO TO FDR-0090.
262590970512
262600970512      *****
262610970512      *****    Blank lines do not exist, therefore the country code will
262620970512      *****    be formatted on address line 5.
262630970512      *****
262640970512
26265097051266105      Move Spaces           to lc-Line80.
26266097051266105      String function trim(WS-BRANCH-ADDR5) "   "
26267009030966105             COUNTRY-CODE OF INSTITUTION-ADDR-REC
26268009030666105             DELIMITED BY  SIZE
26269097051266105        Into lc-Line80.
26270097051266105      Move lc-Line80 (1:40) to WS-BRANCH-ADDR5.
262710970512
262720970512           GO TO FDR-0100.
262730970512
262740970512       FDR-0090.
262750970512
262760970512      *****
262770970512      *****    Blank address lines exist, therefore format the country
262780970512      *****    on a separate line.  If American, use the country code.
262790970512      *****    Otherwise, read the Country record and use the full
262800970512      *****    country name.
262810970512      *****
262820970512
26283097051266105      Move pc-OutCountry to WS-DL-BRANCH-ADDR6.
262840970512
262850970512       FDR-0100.
262860970512
262870970512      *****
262880970512      *****    Compress the investor address lines.
262890970512      *****
262900970512
262910970512           IF  DL-BRANCH-ADDR1
262920970512                          IS NOT EQUAL TO  SPACES
262930970512               GO TO FDR-0110.
262940970512
262950970512           IF  DL-BRANCH-ADDR2
262960010406                          IS NOT EQUAL TO  SPACES
262970010406               MOVE DL-BRANCH-ADDR2    TO  DL-BRANCH-ADDR1
262980010406               MOVE SPACES             TO  DL-BRANCH-ADDR2
262990020516               GO TO FDR-0110.
263000010406
263010010406           IF  DL-BRANCH-ADDR3
263020010406                          IS NOT EQUAL TO  SPACES
263030970512               MOVE DL-BRANCH-ADDR3    TO  DL-BRANCH-ADDR1
263040970512               MOVE SPACES             TO  DL-BRANCH-ADDR3
263050010406               GO TO FDR-0110.
263060010406
263070010406           IF  DL-BRANCH-ADDR4
263080970512                          IS NOT EQUAL TO  SPACES
263090970512               MOVE DL-BRANCH-ADDR4    TO  DL-BRANCH-ADDR1
263100970512               MOVE SPACES             TO  DL-BRANCH-ADDR4
263110970512               GO TO FDR-0110.
263120970512
263130970512RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
263140970512           AND WS-LDA-SEG-DEALER-ADD = "Y"
263150970512R13011         MOVE WS-ADDR4-SEPARATE  TO  DL-BRANCH-ADDR4
263160970512               MOVE SPACES             TO  WS-BRANCH-ADDR5
263170970512RF9408         GO TO FDR-0140.
263180970512
263190970512           IF  WS-BRANCH-ADDR5
263200970512                          IS NOT EQUAL TO  SPACES
263210970512               MOVE WS-BRANCH-ADDR5    TO  DL-BRANCH-ADDR1
263220970512               MOVE SPACES             TO  WS-BRANCH-ADDR5
263230970512               GO TO FDR-0110.
263240970512
263250970512           IF  WS-DL-BRANCH-ADDR6
263260970512                          IS NOT EQUAL TO  SPACES
263270970512               MOVE WS-DL-BRANCH-ADDR6 TO  DL-BRANCH-ADDR1
263280970512               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
263290970512
263300970512           GO TO FDR-0140.
263310970512
263320970512       FDR-0110.
263330010406           IF  DL-BRANCH-ADDR2
263340010406                          IS NOT EQUAL TO  SPACES
263350020516               GO TO FDR-0120.
263360010406
263370010406           IF  DL-BRANCH-ADDR3
263380010406                          IS NOT EQUAL TO  SPACES
263390970512               MOVE DL-BRANCH-ADDR3    TO  DL-BRANCH-ADDR2
263400970512               MOVE SPACES             TO  DL-BRANCH-ADDR3
263410010406               GO TO FDR-0120.
263420010406
263430010406           IF  DL-BRANCH-ADDR4
263440970512                          IS NOT EQUAL TO  SPACES
263450970512               MOVE DL-BRANCH-ADDR4    TO  DL-BRANCH-ADDR2
263460970512               MOVE SPACES             TO  DL-BRANCH-ADDR4
263470970512               GO TO FDR-0120.
263480970512
263490970512RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
263500970512           AND WS-LDA-SEG-DEALER-ADD = "Y"
263510970512R13011         MOVE WS-ADDR4-SEPARATE  TO  DL-BRANCH-ADDR4
263520970512               MOVE SPACES             TO  WS-BRANCH-ADDR5
263530970512RF9408         GO TO FDR-0140.
263540970512
263550970512           IF  WS-BRANCH-ADDR5
263560970512                          IS NOT EQUAL TO  SPACES
263570970512               MOVE WS-BRANCH-ADDR5    TO  DL-BRANCH-ADDR2
263580970512               MOVE SPACES             TO  WS-BRANCH-ADDR5
263590970512               GO TO FDR-0120.
263600970512
263610970512           IF  WS-DL-BRANCH-ADDR6
263620970512                          IS NOT EQUAL TO  SPACES
263630010406               MOVE WS-DL-BRANCH-ADDR6 TO  DL-BRANCH-ADDR2
263640010406               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
263650020516
263660010406           GO TO FDR-0140.
263670010406
263680010406       FDR-0120.
263690970512           IF  DL-BRANCH-ADDR3
263700970512                          IS NOT EQUAL TO  SPACES
263710010406               GO TO FDR-0130.
263720010406
263730010406           IF  DL-BRANCH-ADDR4
263740970512                          IS NOT EQUAL TO  SPACES
263750970512               MOVE DL-BRANCH-ADDR4    TO  DL-BRANCH-ADDR3
263760970512               MOVE SPACES             TO  DL-BRANCH-ADDR4
263770970512               GO TO FDR-0130.
263780970512
263790970512RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
263800970512           AND WS-LDA-SEG-DEALER-ADD = "Y"
263810970512R13011         MOVE WS-ADDR4-SEPARATE  TO  DL-BRANCH-ADDR4
263820970512               MOVE SPACES             TO  WS-BRANCH-ADDR5
263830010406RF9408         GO TO FDR-0140.
263840010406
263850010406           IF  WS-BRANCH-ADDR5
263860010406                          IS NOT EQUAL TO  SPACES
263870020516               MOVE WS-BRANCH-ADDR5    TO  DL-BRANCH-ADDR3
263880010406               MOVE SPACES             TO  WS-BRANCH-ADDR5
263890010406               GO TO FDR-0130.
263900010406
263910970512           IF  WS-DL-BRANCH-ADDR6
263920970512                          IS NOT EQUAL TO  SPACES
263930010406               MOVE WS-DL-BRANCH-ADDR6 TO  DL-BRANCH-ADDR3
263940970512               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
263950010406
263960010406           GO TO FDR-0140.
263970020516
263980010406       FDR-0130.
263990010406
264000010406RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
264010970512           AND WS-LDA-SEG-DEALER-ADD = "Y"
264020970512               MOVE SPACES             TO  DL-BRANCH-ADDR4
264030010406R13011         MOVE WS-ADDR4-SEPARATE  TO  DL-BRANCH-ADDR4
264040010406               MOVE SPACES             TO  WS-BRANCH-ADDR5
264050010406RF9408         GO TO FDR-0140.
264060970512
264070970512           IF  DL-BRANCH-ADDR4
264080970512                          IS NOT EQUAL TO  SPACES
264090970512               GO TO FDR-0140.
264100970512
264110970512RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
264120970512           AND WS-LDA-SEG-DEALER-ADD = "Y"
264130010406R13011         MOVE WS-ADDR4-SEPARATE  TO  DL-BRANCH-ADDR4
264140970425               MOVE SPACES             TO  WS-BRANCH-ADDR5
264150970425RF9408         GO TO FDR-0140.
264160970425
264170970425           IF  WS-BRANCH-ADDR5
264180970425                          IS NOT EQUAL TO  SPACES
264190970425               MOVE WS-BRANCH-ADDR5    TO  DL-BRANCH-ADDR4
264200970425               MOVE SPACES             TO  WS-BRANCH-ADDR5
264210970425               GO TO FDR-0140.
264220970425
264230970425           IF  WS-DL-BRANCH-ADDR6
264240970425                          IS NOT EQUAL TO  SPACES
264250970422               MOVE WS-DL-BRANCH-ADDR6 TO  DL-BRANCH-ADDR4
264260970427               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
264270971027
264280990312       FDR-0140.
264290981128
264300990312           MOVE AREA-CODE
264310990312                OF DEALER-REP          TO  WS-DEALER-AREA.
264320981128           MOVE PHONE-NO
264330981129                OF DEALER-REP          TO  WS-DEALER-PHONE.
264340990312           MOVE WS-DEALER-PHONE-NO     TO  DL-PHONE.
264350990312
264360980626           MOVE FAX-AREA
264370980626                OF DEALER-REP          TO  WS-DEALER-FAX-AREA.
264380980626           MOVE FAX-PHONE
264390980626                OF DEALER-REP          TO  WS-DEALER-FAX-PHONE.
264400030912           MOVE WS-DEALER-FAX-NO       TO  DL-FAX.
264410020321
264420990720           MOVE WS-FDR-ADVTYPCDE       TO  DL-ADVISOR-TYPE.
264430970422           MOVE WS-FDR-ACCOUNT         TO  DL-ACCOUNT2.
264440000620
264450000620           IF WS-LDA-ALLTYP  IS EQUAL TO  "R"
264460000620               MOVE METHOD-OF-DELIVERY OF DEALER-REP-REC
264470000620                                          TO DL-DELIVERY-METHOD
264480030912           ELSE
264490010329               IF WS-LDA-ALLTYP  IS EQUAL TO  "D"
264500010329                   MOVE WS-DELIVERY-METHOD-DLR TO DL-DELIVERY-METHOD.
264510010329
264520010329           MOVE WS-DEALER-ADDR1        TO  DL-DEALER-ADDR1.
264530010329           MOVE WS-DEALER-ADDR2        TO  DL-DEALER-ADDR2.
264540010329           MOVE WS-DEALER-ADDR3        TO  DL-DEALER-ADDR3.
264550010329           MOVE WS-DEALER-ADDR4        TO  DL-DEALER-ADDR4.
264560010329R17380     MOVE WS-DEALER-CO-ATTN      TO  DL-DEALER-CO-ATTN.
264570010329           MOVE WS-PREV-START-DATE        TO  DL-START-DATE.
264580010329           MOVE PREV-END-DATE          TO  DL-END-DATE.
264590010329
264600010329RF6725     MOVE WS-NOMINEE-ADDR1       TO  DL-NOMINEE-ADDR1.
264610010329           MOVE WS-NOMINEE-ADDR2       TO  DL-NOMINEE-ADDR2.
264620010329           MOVE WS-NOMINEE-ADDR3       TO  DL-NOMINEE-ADDR3.
264630010329           MOVE WS-NOMINEE-ADDR4       TO  DL-NOMINEE-ADDR4.
264640010329R17380     MOVE WS-NOMINEE-CO-ATTN     TO  DL-NOMINEE-CO-ATTN.
264650010329
264660011001RF9415*** Start of RF9415 to populate DL-DEALER-CATEGORY-CODE.
264670011001
264680011001           INITIALIZE DEALER-MISC-DETAILS-REC.
264690011011           MOVE DL-DEALER  TO DEALER-CODE OF DEALER-MISC-DETAILS-REC.
264700011011
264710011011           READ DEALER-MISC-DETAILS
264720030825              INVALID KEY
264730030829                INITIALIZE DEALER-MISC-DETAILS-REC
264740030829                MOVE SPACES     TO DEALER-CATAGORY-CODE
264750030825                                OF DEALER-MISC-DETAILS-REC
264760030826           END-READ.
264770030826
264780030826           MOVE DEALER-CATAGORY-CODE OF DEALER-MISC-DETAILS-REC
264790030826                                     TO DL-DEALER-CATEGORY-CODE.
264800030826RF9415*** End of RF9415
264810030826
264820030826R11127     MOVE MARKETTING-BRANCH-CODE OF DEALER-REP-REC
264830030826                                     TO DL-REP-WHOLESALE-REGION.
264840030826
264850030826R10901*****
264860030826      *****  Populate Dealer Contact Mehtod fields.
264870030826      *****
264880030826R10901 FDR-0150.
264890030826R18147     INITIALIZE WS-CONTACT-METHODS-ARRAY.
264900030826   |       MOVE DL-DEALER TO WS-DEALER-CODE.
264910030826   |       MOVE DL-SALESREP TO WS-DEALER-REP-CODE.
264920030826   |
264930030826   |       MOVE "OPEN CONMTC1" TO WS-SQLERR-STATEMENT.
264940030826   |       EXEC SQL
264950030826   |         OPEN CONMTC1
264960030826   |       END-EXEC.
264970030826   |
264980030825   |
264990030825   |       EXEC SQL
265000030825   |         FETCH NEXT FROM CONMTC1
265010030825   |         FOR 3 ROWS
265020011011   |         INTO :WS-CONMTC1-FIELDS
265030011011   |       END-EXEC.
265040970422   |
265050970422   |       IF SQLCODE = 0
265060970422   |       MOVE WS-CONTACT-METHOD(1) TO DL-CONTACT-METHOD1
265070970422   |       MOVE WS-CONTACT(1) TO DL-CONTACT-METHOD-DESP1
265080060621   |       MOVE WS-CONTACT-METHOD(2) TO DL-CONTACT-METHOD2
265090030826   |       MOVE WS-CONTACT(2) TO DL-CONTACT-METHOD-DESP2
265100030826   |       MOVE WS-CONTACT-METHOD(3) TO DL-CONTACT-METHOD3
265110970422   |       MOVE WS-CONTACT(3) TO DL-CONTACT-METHOD-DESP3
265120970422   |       END-IF.
265130970422   |
265140970422   |       EXEC SQL
265150970422   V         CLOSE CONMTC1
265160970422R18147     END-EXEC.
265170970425
265180970425R10901 FDR-0160.
265190970425
265200970422      *****
265210970422      *****    Write the Dealer record.
265220970422      *****
265230970422
265240970422R18147     MOVE DEALER-SECTION TO STATEMENT-REC(ISR).
265250970429R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
265260970422
265270970425           ADD 1                       TO  WS-INVESTOR-COUNT.
265280970427
265290970427      *****
265300970427      *****    Read the next Investor Dealer Representative and return
265310970429      *****    to process it, if applicable.
265320970429      *****
265330970429
265340970427           IF  WS-IDRSTR-SW   IS EQUAL TO  "N"
265350970427               GO TO FDR-EXIT.
265360970427
265370970422           READ INVESTOR-DEALER-REP NEXT
265380000000                                       AT  END
265390000000               GO TO FDR-EXIT.
265400000000
265410000619           IF  INVESTOR-NO
265420000619               OF INVESTOR-DEALER-REP-REC
265430000619                              IS EQUAL TO  PREV-INVESTOR
265440000619               MOVE ADVISOR-TYPE-CODE
265450000619                    OF INVESTOR-DEALER-REP-REC
265460000619                                       TO  WS-FDR-ADVTYPCDE
265470000619               MOVE DEALER-CODE
265480000619                    OF INVESTOR-DEALER-REP-REC
265490000619                                       TO  WS-FDR-DLRCDE
265500000619               MOVE DEALER-REP-CODE
265510000619                    OF INVESTOR-DEALER-REP-REC
265520000619                                       TO  WS-FDR-DLRREPCDE
265530000621               GO TO FDR-0010.
265540020423
265550000621       FDR-EXIT.
265560000621           EXIT.
265570000621
265580040330      /
265590040330RF6725 FORMAT-NOMINEE-ADDRESS.
265600000621
265610000619      ******************************************************************
265620000619      *    F O R M A T   N O M I N E E   A D D R E S S                 *
265630000619      ******************************************************************
265640000619
265650000619      *****
265660000619      *****    This routine formats and creates the Nominee address
265670000619      *****    and put it in Dealer record section.
265680000619      *****
265690000619           INITIALIZE
265700000619R13011                      WS-ADDR4-SEPARATE
265710000619                            WS-NOMINEE-ADDR1
265720000619                            WS-NOMINEE-ADDR2
265730000619                            WS-NOMINEE-ADDR3
265740000619                            WS-NOMINEE-ADDR4
265750000619R21637                      WS-NOMINEE-CO-ATTN.
265760000619
265770000619           INITIALIZE INSTITUTION-BRANCH-REC.
265780000619           MOVE NOINSTIT OF INVESTOR-JOIN TO INSTITUTION-CODE
265790000619                                          OF INSTITUTION-BRANCH.
265800000619           MOVE NOBRANCH OF INVESTOR-JOIN TO BRANCH-CODE
265810000619                                          OF INSTITUTION-BRANCH.
265820000619           READ INSTITUTION-BRANCH
265830000619                INVALID KEY
265840000619                INITIALIZE MFAADDP
265850000621                INITIALIZE ADDRESS-RECD
265860000621                GO TO FNA-0010
265870000621           END-READ.
265880000619
265890000619           INITIALIZE INSTITUTION-ADDR-REC.
265900000619           MOVE ADDR-NO OF INSTITUTION-BRANCH TO ADDR-NO
265910000619                                   OF INSTITUTION-ADDRESS.
265920000619           READ INSTITUTION-ADDRESS
265930030912                INVALID KEY
265940030929                INITIALIZE MFAADDP
265950000619                INITIALIZE ADDRESS-RECD
265960000619                GO TO FNA-0010
265970000619           END-READ.
265980000619
265990000619           INITIALIZE         ADDRESS-RECD.
266000000619           MOVE INSTITUTION-ADDR-REC          TO ADDRESS-RECD.
266010000619
266020000619       FNA-0010.
266030090309
266040090309      *****
266050090309      *****    Format the Nominee address line 1 with the Care of
266060090309      *****    Attention name.
266070090309      *****
266080090309
266090090309R17380     MOVE CO-OR-ATTENTION OF ADDRESS-RECD
266100090309R17380       TO WS-NOMINEE-CO-ATTN.
266110090309
266120090306      *****
266130090309      *****    Format the Nominee address line 2 with the street
266140090306      *****    number, street name, street type and street direction.
266150090305      *****    Each fields will be handled separately in case one or
266160090309      *****    more of the fields contain spaces.
266170090309      *****
266180090309
26619009030566105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
26620009030966105      Set pb-adrStreet to True.
26621009030566105      Set pb-adrProvince to True.
26622000061966105      Move STREET-NO        OF ADDRESS-RECD to pc-InStreetNo.
26623000061966105      Move STREET-NAME      OF ADDRESS-RECD to pc-InStreetName.
26624000061966105      Move STREET-TYPE-CODE OF ADDRESS-RECD to pc-InStreetTypeCode.
26625000061966105      Move PROVINCE-CODE    OF ADDRESS-RECD to pc-InProvinceCode.
26626000061966105      Move CITY              OF ADDRESS-RECD to pc-InCity.
26627000061966105      Move STREET-DIRCT-CODE OF ADDRESS-RECD to pc-InDirectionCode.
26628000062066105      If COUNTRY-CODE OF ADDRESS-RECD Not = "CAN"
26629000061966105         Move COUNTRY-CODE OF ADDRESS-RECD to pc-InCountry
26630000061966105      End-If
266310000619
26632000061966105      Call "FXSTRTADR" using pt-StreetAddressAction,
26633000061966105                             pt-StreetAddressIn,
26634000061966105                             pt-StreetAddressOut.
26635000061966105
26636000062066105      Move pc-OutStreet To WS-NOMINEE-ADDR2.
266370000619
266380000620      *****
266390000620      *****    Format the Nominee  address line 3 with the miscellaneous
266400000620      *****    first address.
266410000620      *****
266420000620
266430000620           MOVE MISC-FIRST-ADDR-LINE
266440000620                OF ADDRESS-RECD        TO  WS-NOMINEE-ADDR3.
266450000620
266460000620      *****
266470000620      *****    Format the Nominee  address line 4 with the miscellaneous
266480000620      *****    second address.
266490000620      *****
266500000620
266510000620           MOVE MISC-SECOND-ADDR-LINE
266520000620                OF ADDRESS-RECD        TO  WS-NOMINEE-ADDR4.
266530000620
266540000620      *****
266550000620      *****    Format address line 5 using the City, Province and Postal
266560000620      *****    Code.  Each field will be handled separately in case one
266570000620      *****    or more of the fields contain spaces.
266580000620      *****
266590000620
266600000620           MOVE SPACES                 TO  WS-ADRTMP.
266610000620           MOVE SPACES                 TO  WS-BRANCH-ADDR5.
266620000620
266630000620      *****
266640000620      *****    Format the postal code, depending on the country code.
266650000620      *****
266660000620
266670000620           MOVE POSTAL-CODE
266680000620                OF ADDRESS-RECD        TO  WS-POSTAL.
266690000620           MOVE SPACES                 TO  WS-POSTAL-OUT.
266700000620           IF  COUNTRY-CODE
266710000620               OF ADDRESS-RECD
266720000620                              IS EQUAL TO  "CAN"
266730000620               MOVE WS-POSTAL1         TO  WS-POSTAL-OUT1
266740141201               MOVE WS-POSTAL2         TO  WS-POSTAL-OUT2
266750141201               GO TO FNA-0040.
266760000620
266770090309           IF  COUNTRY-CODE
266780000620               OF ADDRESS-RECD
266790000620                          IS NOT EQUAL TO  "USA"
266800090306               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
266810090306               GO TO FNA-0040.
266820090306
266830090309           IF  WS-POSTALU2    IS EQUAL TO  SPACES
266840090504           OR  WS-POSTALU3    IS EQUAL TO  "-"
266850090309               MOVE WS-POSTAL          TO  WS-POSTAL-OUT
266860090309               GO TO FNA-0040.
266870090309
266880000620           MOVE WS-POSTALU1            TO  WS-POSTAL-OUTU1.
266890020423           MOVE "-"                    TO  WS-POSTAL-OUTU2.
266900020423138436*    MOVE WS-POSTALU2            TO  WS-POSTAL-OUTU3.
266910020423138436     MOVE WS-POSTALU4            TO  WS-POSTAL-OUTU3.
266920020423       FNA-0040.
26693002042366105      Move pc-OutProvince         TO  WS-BRANCH-ADDR5.
266940030414
266950020423       FNA-0050.
266960020423
26697000062066105      Move ws-postal-out to lc-PostalCode.
266980000620
26699000062066105      Move Spaces           to lc-Line80.
26700000062066105      String function trim(WS-BRANCH-ADDR5) "  "
26701000062066105             lc-PostalCode  Delimited by Size
26702000062066105        Into lc-Line80.
26703000062066105      Move lc-Line80 (1:40) to WS-BRANCH-ADDR5.
267040000620
267050000620R13011     IF WS-LDA-SEG-DEALER-ADD = "Y"
267060000620              MOVE CITY          OF  ADDRESS-RECD
267070000620                                     TO WS-ADDR4-SEPARATE-CITY
267080000620              MOVE PROVINCE-CODE OF  ADDRESS-RECD
267090000620                                     TO WS-ADDR4-SEPARATE-PROV
267100000620R16839        MOVE WS-POSTAL-OUT     TO WS-ADDR4-SEPARATE-POST
267110000620R13011     END-IF.
267120000620
267130000620      *****
267140000620      *****    If processing a dealer rep address which is not Canadian,
267150000620      *****    the country code or name is to be printed on a separate
267160000620      *****    line.  If blank lines do not exist, the country code will
267170000620      *****    be formatted on address line 5.
267180000620      *****
267190000620
267200000620           MOVE SPACES                 TO  WS-DL-BRANCH-ADDR6.
267210000620
267220000620           IF  COUNTRY-CODE
267230000620               OF ADDRESS-RECD   EQUAL TO  "CAN"
267240000620               GO TO FNA-0070.
267250000620
267260000620           MOVE ZEROES                 TO  WS-BLKADR-CNT.
267270000620           IF  WS-NOMINEE-ADDR1   EQUAL TO  SPACES
267280000620               ADD 1                   TO  WS-BLKADR-CNT.
267290000620           IF  WS-NOMINEE-ADDR2   EQUAL TO  SPACES
267300090309               ADD 1                   TO  WS-BLKADR-CNT.
267310090506           IF  WS-NOMINEE-ADDR3  EQUAL TO  SPACES
267320090506               ADD 1                   TO  WS-BLKADR-CNT.
267330090506           IF  WS-NOMINEE-ADDR4  EQUAL TO  SPACES
267340090309               ADD 1                   TO  WS-BLKADR-CNT.
267350090309           IF  WS-BRANCH-ADDR5   EQUAL TO  SPACES
267360090309               ADD 1                   TO  WS-BLKADR-CNT.
267370000620
267380000620           IF  WS-BLKADR-CNT GREATER THAN  1
267390000620               GO TO FNA-0060.
267400000620
267410000620      *****
267420000620      *****    Blank lines do not exist, therefore the country code will
267430000620      *****    be formatted on address line 5.
267440000620      *****
267450000620
26746000062066105      Move Spaces           to lc-Line80.
26747000062066105      String function trim(WS-BRANCH-ADDR5) "   "
26748009030966105             COUNTRY-CODE OF ADDRESS-RECD
26749009030666105                        DELIMITED BY  SIZE
26750000062066105        Into lc-Line80.
26751000062066105      Move lc-Line80 (1:40) to WS-BRANCH-ADDR5.
267520000620
267530000620           GO TO FNA-0070.
267540000620
267550000620       FNA-0060.
267560000620
267570000620      *****
267580000620      *****    Blank address lines exist, therefore format the country
267590000620      *****    on a separate line.  If American, use the country code.
267600000620      *****    Otherwise, read the Country record and use the full
267610000620      *****    country name.
267620000620      *****
267630000620
26764000062066105      Move pc-OutCountry to WS-DL-BRANCH-ADDR6.
267650000620
267660000620       FNA-0070.
267670000620
267680000620      *****
267690000620      *****    Compress the investor address lines.
267700000620      *****
267710000620
267720000620           IF  WS-NOMINEE-ADDR1
267730000620                          IS NOT EQUAL TO  SPACES
267740000620               GO TO FNA-0080.
267750000620
267760000620           IF  WS-NOMINEE-ADDR2
267770010406                          IS NOT EQUAL TO  SPACES
267780010406               MOVE WS-NOMINEE-ADDR2   TO  WS-NOMINEE-ADDR1
267790010406               MOVE SPACES             TO  WS-NOMINEE-ADDR2
267800020516               GO TO FNA-0080.
267810010406
267820010406           IF  WS-NOMINEE-ADDR3
267830000620                          IS NOT EQUAL TO  SPACES
267840000620               MOVE WS-NOMINEE-ADDR3   TO  WS-NOMINEE-ADDR1
267850000620               MOVE SPACES             TO  WS-NOMINEE-ADDR3
267860010406               GO TO FNA-0080.
267870010406
267880010406           IF  WS-NOMINEE-ADDR4
267890000620                          IS NOT EQUAL TO  SPACES
267900000620               MOVE WS-NOMINEE-ADDR4   TO  WS-NOMINEE-ADDR1
267910000620               MOVE SPACES             TO  WS-NOMINEE-ADDR4
267920000620               GO TO FNA-0080.
267930000620
267940000620RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
267950000620           AND WS-LDA-SEG-DEALER-ADD = "Y"
267960000620R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-NOMINEE-ADDR4
267970000620                  MOVE SPACES             TO  WS-BRANCH-ADDR5
267980000620RF9408            GO TO FNA-EXIT.
267990000620
268000000620           IF  WS-BRANCH-ADDR5
268010000620                          IS NOT EQUAL TO  SPACES
268020000620               MOVE WS-BRANCH-ADDR5    TO  WS-NOMINEE-ADDR1
268030000620               MOVE SPACES             TO  WS-BRANCH-ADDR5
268040000620               GO TO FNA-0080.
268050000620
268060000620           IF  WS-DL-BRANCH-ADDR6
268070000620                          IS NOT EQUAL TO  SPACES
268080000620               MOVE WS-DL-BRANCH-ADDR6 TO  DL-BRANCH-ADDR1
268090000620               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
268100000620
268110000620           GO TO FNA-EXIT.
268120000620
268130000620       FNA-0080.
268140010406           IF  WS-NOMINEE-ADDR2
268150010406                          IS NOT EQUAL TO  SPACES
268160020516               GO TO FNA-0090.
268170010406
268180010406           IF  WS-NOMINEE-ADDR3
268190010406                          IS NOT EQUAL TO  SPACES
268200000620               MOVE WS-NOMINEE-ADDR3   TO  WS-NOMINEE-ADDR2
268210000620               MOVE SPACES             TO  WS-NOMINEE-ADDR3
268220010406               GO TO FNA-0090.
268230010406
268240010406           IF  WS-NOMINEE-ADDR4
268250000620                          IS NOT EQUAL TO  SPACES
268260000620               MOVE WS-NOMINEE-ADDR4   TO  WS-NOMINEE-ADDR2
268270000620               MOVE SPACES             TO  WS-NOMINEE-ADDR4
268280000620               GO TO FNA-0090.
268290000620
268300000620RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
268310000620           AND WS-LDA-SEG-DEALER-ADD = "Y"
268320000620R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-NOMINEE-ADDR4
268330000620                  MOVE SPACES             TO  WS-BRANCH-ADDR5
268340000620RF9408            GO TO FNA-EXIT.
268350000620
268360000620           IF  WS-BRANCH-ADDR5
268370000620                          IS NOT EQUAL TO  SPACES
268380000620               MOVE WS-BRANCH-ADDR5    TO  WS-NOMINEE-ADDR2
268390000620               MOVE SPACES             TO  WS-BRANCH-ADDR5
268400000620               GO TO FNA-0090.
268410000620
268420000620           IF  WS-DL-BRANCH-ADDR6
268430000620                          IS NOT EQUAL TO  SPACES
268440010406               MOVE WS-DL-BRANCH-ADDR6 TO  WS-NOMINEE-ADDR2
268450010406               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
268460020516
268470010406           GO TO FNA-EXIT.
268480010406
268490010406       FNA-0090.
268500000620           IF  WS-NOMINEE-ADDR3
268510000620                          IS NOT EQUAL TO  SPACES
268520010406               GO TO FNA-0100.
268530010406
268540010406           IF  WS-NOMINEE-ADDR4
268550000620                          IS NOT EQUAL TO  SPACES
268560000620               MOVE WS-NOMINEE-ADDR4   TO  WS-NOMINEE-ADDR3
268570000620               MOVE SPACES             TO  WS-NOMINEE-ADDR4
268580000620               GO TO FNA-0100.
268590000620
268600000620RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
268610000620           AND WS-LDA-SEG-DEALER-ADD = "Y"
268620000620R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-NOMINEE-ADDR4
268630000620                  MOVE SPACES             TO  WS-BRANCH-ADDR5
268640010406RF9408            GO TO FNA-EXIT.
268650010409
268660010406           IF  WS-BRANCH-ADDR5
268670010406                          IS NOT EQUAL TO  SPACES
268680020516               MOVE WS-BRANCH-ADDR5    TO  WS-NOMINEE-ADDR3
268690010406               MOVE SPACES             TO  WS-BRANCH-ADDR5
268700010406               GO TO FNA-0100.
268710010406
268720000620           IF  WS-DL-BRANCH-ADDR6
268730000620                          IS NOT EQUAL TO  SPACES
268740010406               MOVE WS-DL-BRANCH-ADDR6 TO  WS-NOMINEE-ADDR3
268750000620               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
268760010406
268770010406           GO TO FNA-EXIT.
268780020516
268790010406       FNA-0100.
268800010406
268810010406RF9408     IF  WS-NOMINEE-ADDR4 IS NOT EQUAL TO  SPACES
268820000620           AND WS-LDA-SEG-DEALER-ADD = "Y"
268830000620                  MOVE SPACES             TO  WS-NOMINEE-ADDR4
268840010406R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-NOMINEE-ADDR4
268850010406                  MOVE SPACES             TO  WS-BRANCH-ADDR5
268860010406RF9408            GO TO FNA-EXIT.
268870000620
268880000620           IF  WS-NOMINEE-ADDR4
268890000620                          IS NOT EQUAL TO  SPACES
268900000620               GO TO FNA-EXIT.
268910000620
268920000619RF9408     IF  WS-BRANCH-ADDR5 IS NOT EQUAL TO  SPACES
268930000620           AND WS-LDA-SEG-DEALER-ADD = "Y"
268940000620R13011            MOVE WS-ADDR4-SEPARATE  TO  WS-NOMINEE-ADDR4
268950000619                  MOVE SPACES             TO  WS-BRANCH-ADDR5
268960000619RF9408            GO TO FNA-EXIT.
268970000620
268980000620           IF  WS-BRANCH-ADDR5
268990000619                          IS NOT EQUAL TO  SPACES
269000000000               MOVE WS-BRANCH-ADDR5    TO  WS-NOMINEE-ADDR4
269010000000               MOVE SPACES             TO  WS-BRANCH-ADDR5
269020970425               GO TO FNA-EXIT.
269030970425
269040970425           IF  WS-DL-BRANCH-ADDR6
269050970425                          IS NOT EQUAL TO  SPACES
269060970425               MOVE WS-DL-BRANCH-ADDR6 TO  WS-NOMINEE-ADDR4
269070970425               MOVE SPACES             TO  WS-DL-BRANCH-ADDR6.
269080970425
269090000000      **********
269100000000
269110000000       FNA-EXIT.
269120000000           EXIT.
269130000000
269140000000      **********
269150000000
269160000000      /
269170000000       GENERATE-ROLLOVER-RECORDS.
269180000000
269190000000      ******************************************************************
269200000000      *                                                                *
269210000000      *    G E N E R A T E   R O L L O V E R   R E C O R D S   R T N . *
269220000000      *                                                                *
269230000000      ******************************************************************
269240000000
269250000000           MOVE AD-ACCOUNT TO ACCOUNT-NO OF ROLLOVER.
269260000000           MOVE "O"   TO ROLLOVER-STATUS OF ROLLOVER.
269270000000
269280000000           MOVE ZEROES TO WS-ROLLOVER-COUNT.
269290000000
269300000000           START ROLLOVER
269310000000           KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
269320000000           INVALID KEY
269330000000           GO TO GRR-EXIT.
269340000000
269350000000       GRR-READ-NEXT.
269360981119           READ ROLLOVER NEXT RECORD
269370981119           AT END GO TO GRR-EXIT.
269380981119
269390000000           IF ACCOUNT-NO OF ROLLOVER NOT = AD-ACCOUNT
269400000000               GO TO GRR-EXIT.
269410970425
269420000000           IF ROLLOVER-STATUS OF ROLLOVER NOT = "O"
269430000000               GO TO GRR-EXIT.
269440000000
269450000000           ADD 1 TO WS-ROLLOVER-COUNT.
269460000000
269470000000           INITIALIZE ROLLOVER-SECTION.
269480970425           MOVE AD-INVESTOR-NO TO AR-INVESTOR-NO.
269490970425           MOVE AD-ACCOUNT TO AR-ACCOUNT.
269500970425           MOVE "50" TO AR-SECTION-NO.
269510970425           MOVE WS-ROLLOVER-COUNT TO AR-SECTION-SEQUENCE.
269520970425           MOVE AD-LANGUAGE    TO AR-LANGUAGE.
269530970425           MOVE AD-DEALER      TO AR-DEALER.
269540970425           MOVE AD-SALESREP    TO AR-SALESREP.
269550970425           MOVE ROLLOVER-NO OF ROLLOVER TO AR-ROLLOVER-NO.
269560970425
269570000000           INITIALIZE MFAINSP.
269580000000           MOVE INSTITUTION-CODE OF ROLLOVER
269590000000               TO INSTITUTION-CODE OF INSTITUTION.
269600000000           READ INSTITUTION
269610000000               INVALID KEY
269620000000                 MOVE "UNKNOWN" TO INSTITUTION-NAME OF INSTITUTION.
269630000000
269640000000           IF  AD-LANGUAGE   NOT EQUAL TO  "F"
269650000000           OR  INSTITUTION-NAME-FRENCH
269660000000               OF INSTITUTION-REC
269670000000                              IS EQUAL TO  SPACES
269680000000               MOVE INSTITUTION-NAME
269690000000                    OF INSTITUTION-REC TO  AR-INSTITUTION
269700000000             ELSE
269710980129               MOVE INSTITUTION-NAME-FRENCH
269720980129                    OF INSTITUTION-REC TO  AR-INSTITUTION
269730060621
269740030826           MOVE PLAN-NUMBER OF ROLLOVER TO AR-INSTITUTION-PLAN-NO.
269750030826           MOVE CREATION-DATE OF ROLLOVER TO AR-CREATION-DATE.
269760000000           MOVE ROLLOVER-STATUS OF ROLLOVER TO AR-ROLLOVER-STATUS.
269770000000           IF AR-ROLLOVER-STATUS = "O"
269780000000                 AND LETTER-SENT OF ROLLOVER = "Y"
269790000000               MOVE "F" TO AR-ROLLOVER-STATUS.
269800991123
269810991123           IF AR-ROLLOVER-STATUS = "F"
269820991125               MOVE DATE-LETTER-SENT OF ROLLOVER TO AR-FOLLOWUP-DATE.
269830991123
269840991123           MOVE APPROX-VALUE OF ROLLOVER TO AR-APPROXIMATE-VALUE.
269850991125           MOVE ACTUAL-VALUE OF ROLLOVER TO AR-ACTUAL-VALUE.
269860991123           MOVE 1 TO AR-NO-OF-RECORDS.
269870060524           MOVE AD-START-DATE            TO AR-START-DATE.
269880060524           MOVE AD-END-DATE              TO AR-END-DATE.
269890060524R18147     MOVE ROLLOVER-SECTION TO STATEMENT-REC(ISR).
269900060524R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
269910060524
269920060707           GO TO GRR-READ-NEXT.
269930060524
269940060707       GRR-EXIT.
269950060524           EXIT.
269960060524
269970060707      /
269980060524RF5148 CALL-ROR-ACCOUNT-FUND-ROUTINE.
269990060707
270000090306      ******************************************************************
270010060707      *    C A L L   A C C O U N T / F U N D  R O R  R O U T I N E     *
270020090306      ******************************************************************
270030060707
270040060524      * RFS30797 - Begin
270050060707      * Parameter to drive level for ROR calculation:
270060060524
270070060524           IF RR-INVESTMENT-CODE  NOT = SPACES
270080060707             SET pncc-ClcACI     TO TRUE
270090060524           ELSE
270100060524             SET pncc-ClcACC     TO TRUE
270110060524           END-IF
270120060524
270130060524           SET pncc-ClcOnly      TO TRUE
270140060707
270150060707           MOVE RR-ACCOUNT-NO           TO pi-AccountNo
270160060707           MOVE RR-INVESTMENT-CODE      TO pc-InvestmentCode
270170060524           INITIALIZE pc-IpsGroupID
270180060524                      pc-InvestmentStructure
270190060524                      pn-MonthEndInitDate
270200060524
270210060707           MOVE RR-LAST-MONTH-END       TO pn-PerformanceAt
270220060526
270230060707      * Period code populated with 1Y ...
270240060707           MOVE RR-PERIOD-CODE-1        TO pc-PeriodCode (1)
270250060707      * -------------------------------
270260060707      * Call program to calculate and save ROR data
270270060707      * -------------------------------
270280060524           CALL "RORCLCSAV"
270290060707             USING
270300060707                   pc-RorclcsaParms
270310060707                   ptb-RorArray
270320060707                   pc-RorclcsaRetnParms.
270330060526
270340060707      * -------------------------------
270350060707      * Populate returned parameters .
270360060707      * -------------------------------
270370060707           MOVE pn-PerformanceAt    TO RR-LAST-MONTH-END
270380060524                                       RR-CALCULATE-DATE
270390060524           MOVE pn-MonthEndInitDate TO RR-INITIAL-DATE
270400060707           SET pi-IxPerRor       TO 1
270410060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-1
270420060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-1
270430060707           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-1
270440060524
270450060707           SET pi-IxPerRor       TO 2
270460060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-2
270470060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-2
270480060707           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-2
270490060524
270500060524           SET pi-IxPerRor       TO 3
270510060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-3
270520060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-3
270530060707           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-3
270540060707
270550060524
270560060707           SET pi-IxPerRor       TO 4
270570060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-4
270580060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-4
270590060707           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-4
270600060524
270610060707           SET pi-IxPerRor       TO 5
270620060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-5
270630060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-5
270640060707           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-5
270650060524
270660060707
270670060707           SET pi-IxPerRor       TO 6
270680060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-6
270690060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-6
270700060524           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-6
270710060707
270720060707           SET pi-IxPerRor       TO 7
270730060707           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-7
270740060707           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-7
270750061103           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-7
270760060524
270770991123           SET pi-IxPerRor       TO 8
270780991123           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-8
270790991125           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-8
270800991125           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-8
270810991123
270820991123           SET pi-IxPerRor       TO 9
270830991123           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-9
270840991123           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-9
270850991123           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-9
270860991123
270870991123           SET pi-IxPerRor       TO 10
270880991123           MOVE pc-PeriodCode   (pi-IxPerRor) TO RR-PERIOD-CODE-10
270890991123           MOVE pn-PeriodRor    (pi-IxPerRor) TO RR-PERIOD-ROR-10
270900991123           MOVE pc-PeriodRorSts (pi-IxPerRor) TO RR-PERIOD-ROR-STS-10
270910991123R36342     .
270920991124      * RFS30797 - End
270930991124      **********
270940000530
270950991123       CRAFR-EXIT.
270960991123             EXIT.
270970991123
270980991125      **********
270990991125
271000991125     /
271010991123       POPULATE-ROR-CODE-TBL.
271020000531
271030000531      *****
271040000530      *****    WS-ROR-CODE-TBL will be populated by the passed back
271050991123      *****    period-code and period-ror.
271060991123      *****
271070991123
271080991124           MOVE ZEROS                   TO  WS-ROCT-LST.
271090991124           INITIALIZE                   WS-ROR-CODE-TBL.
271100991124RF6645     MOVE SPACES  TO   WS-PERIOD-ROR-APPL-ARRAY.
271110061003
271120061003       PRCT-0010.
271130991124
271140991123           IF WS-ROCT-LST     IS NOT LESS THAN  WS-ROCT-MAX
271150991123              GO TO PRCT-EXIT
271160991123           END-IF
271170991123
271180991123RF6645     MOVE RR-PERIOD-ROR-APPL       TO
271190991124                                       WS-PERIOD-ROR-APPL-ARRAY.
271200991124
271210061003           ADD 1                       TO  WS-ROCT-LST.
271220061003           SET ROCT                    TO  WS-ROCT-LST.
271230991124           MOVE RR-PERIOD-CODE-1       TO  WS-PERIOD-CCODE (ROCT).
271240991123           MOVE RR-PERIOD-ROR-1        TO  WS-PERIOD-CROR (ROCT).
271250991123           IF RR-PERIOD-ROR-1          IS  LESS THAN  ZEROS
271260991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271270991123R35540     ELSE
271280991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271290991124           END-IF
271300991124
271310061003           ADD 1                       TO  WS-ROCT-LST.
271320061003           SET ROCT                    TO  WS-ROCT-LST.
271330991124           MOVE RR-PERIOD-CODE-2       TO  WS-PERIOD-CCODE (ROCT).
271340991123           MOVE RR-PERIOD-ROR-2        TO  WS-PERIOD-CROR (ROCT).
271350991123           IF RR-PERIOD-ROR-2          IS  LESS THAN  ZEROS
271360991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271370991123R35540     ELSE
271380991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271390991124           END-IF
271400991124
271410061003           ADD 1                       TO  WS-ROCT-LST.
271420061003           SET ROCT                    TO  WS-ROCT-LST.
271430991124           MOVE RR-PERIOD-CODE-3       TO  WS-PERIOD-CCODE (ROCT).
271440991123           MOVE RR-PERIOD-ROR-3        TO  WS-PERIOD-CROR (ROCT).
271450991123           IF RR-PERIOD-ROR-3          IS  LESS THAN  ZEROS
271460991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271470991123R35540     ELSE
271480991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271490991124           END-IF
271500991124
271510061003           ADD 1                       TO  WS-ROCT-LST.
271520061003           SET ROCT                    TO  WS-ROCT-LST.
271530991124           MOVE RR-PERIOD-CODE-4       TO  WS-PERIOD-CCODE (ROCT).
271540991123           MOVE RR-PERIOD-ROR-4        TO  WS-PERIOD-CROR (ROCT).
271550991123           IF RR-PERIOD-ROR-4          IS  LESS THAN  ZEROS
271560991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271570991123R35540     ELSE
271580991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271590991124           END-IF
271600991124
271610061003           ADD 1                       TO  WS-ROCT-LST.
271620061003           SET ROCT                    TO  WS-ROCT-LST.
271630991124           MOVE RR-PERIOD-CODE-5       TO  WS-PERIOD-CCODE (ROCT).
271640991123           MOVE RR-PERIOD-ROR-5        TO  WS-PERIOD-CROR (ROCT).
271650991123           IF RR-PERIOD-ROR-5          IS  LESS THAN  ZEROS
271660991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271670991123R35540     ELSE
271680991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271690991124           END-IF
271700991124
271710061003           ADD 1                       TO  WS-ROCT-LST.
271720061003           SET ROCT                    TO  WS-ROCT-LST.
271730991124           MOVE RR-PERIOD-CODE-6       TO  WS-PERIOD-CCODE (ROCT).
271740991123           MOVE RR-PERIOD-ROR-6        TO  WS-PERIOD-CROR (ROCT).
271750991123           IF RR-PERIOD-ROR-6          IS  LESS THAN  ZEROS
271760991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271770991123R35540     ELSE
271780991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271790991124           END-IF
271800991124
271810061003           ADD 1                       TO  WS-ROCT-LST.
271820061003           SET ROCT                    TO  WS-ROCT-LST.
271830991124           MOVE RR-PERIOD-CODE-7       TO  WS-PERIOD-CCODE (ROCT).
271840991123           MOVE RR-PERIOD-ROR-7        TO  WS-PERIOD-CROR (ROCT).
271850991123           IF RR-PERIOD-ROR-7          IS  LESS THAN  ZEROS
271860991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271870991123R35540     ELSE
271880991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271890991124           END-IF
271900991124
271910061003           ADD 1                       TO  WS-ROCT-LST.
271920061003           SET ROCT                    TO  WS-ROCT-LST.
271930991124           MOVE RR-PERIOD-CODE-8       TO  WS-PERIOD-CCODE (ROCT).
271940991123           MOVE RR-PERIOD-ROR-8        TO  WS-PERIOD-CROR (ROCT).
271950991123           IF RR-PERIOD-ROR-8          IS  LESS THAN  ZEROS
271960991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
271970991123R35540     ELSE
271980991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
271990991124           END-IF
272000991124
272010061003           ADD 1                       TO  WS-ROCT-LST.
272020061003           SET ROCT                    TO  WS-ROCT-LST.
272030991124           MOVE RR-PERIOD-CODE-9       TO  WS-PERIOD-CCODE (ROCT).
272040991123           MOVE RR-PERIOD-ROR-9        TO  WS-PERIOD-CROR (ROCT).
272050991123           IF RR-PERIOD-ROR-9          IS  LESS THAN  ZEROS
272060991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
272070991123R35540     ELSE
272080991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
272090991123           END-IF
272100991123
272110991123           ADD 1                       TO  WS-ROCT-LST.
272120991123           SET ROCT                    TO  WS-ROCT-LST.
272130991123           MOVE RR-PERIOD-CODE-10      TO  WS-PERIOD-CCODE (ROCT).
272140991123           MOVE RR-PERIOD-ROR-10       TO  WS-PERIOD-CROR (ROCT).
272150991123           IF RR-PERIOD-ROR-10         IS  LESS THAN  ZEROS
272160991123              MOVE "-"                 TO  WS-PERIOD-CSIGN(ROCT)
272170991123R35540     ELSE
272180991123R35540        MOVE " "                 TO  WS-PERIOD-CSIGN(ROCT)
272190991123           END-IF.
272200991125
272210991123      **********
272220991123
272230991123       PRCT-EXIT.
272240991123            EXIT.
272250991123
272260991123      **********
272270991123
272280991123      /
272290991123       GET-PERIOD-DESC-RECORDS.
272300991123
272310991123      *****
272320991123      *****    Format the period description depending on whether
272330991123      *****    English or Franch language was used.
272340991123      *****
272350991123
272360991123           MOVE 1                      TO WS-ROCT-LST.
272370991123           SET ROT                     TO  1.
272380991123           SET ROCT                    TO  1.
272390991123           IF WS-ROT-LST NOT GREATER THAN  ZEROES
272400991123               GO TO GPDR-0070
272410991123           END-IF.
272420991123
272430991123       GPDR-0010.
272440991123
272450991123           IF WS-ROCT-LST        IS NOT LESS THAN  WS-ROCT-MAX
272460991123               GO TO GPDR-EXIT
272470991123           END-IF
272480991123
272490991123           IF WS-PERIOD-CCODE(ROCT) IS EQUAL TO  WS-PERIOD-CODE (ROT)
272500991123           AND II-LANGUAGE-CODE  EQUAL TO  "F"
272510991123               SET ROTL                 TO  2
272520991123               GO TO GPDR-0030
272530991123           END-IF
272540991123
272550991123           IF WS-PERIOD-CCODE(ROCT)  IS EQUAL TO  WS-PERIOD-CODE (ROT)
272560991123               SET ROTL                TO  1
272570991123               GO TO GPDR-0030
272580991123           END-IF
272590991123
272600991123           SET ROT                  UP BY  1.
272610991123           IF ROT    IS NOT GREATER THAN  WS-ROT-LST
272620991123               GO TO GPDR-0010
272630991123           END-IF.
272640991123
272650991123       GPDR-0030.
272660991123
272670991123           IF ROT         IS GREATER THAN  WS-ROT-LST
272680991123               GO TO GPDR-0060
272690991123           END-IF
272700991123
272710991123           MOVE WS-PERIOD-DESC (ROT, ROTL)
272720991123                                 TO  WS-PERIOD-CDESC(ROCT).
272730991123           GO TO GPDR-0070.
272740991123
272750991123       GPDR-0060.
272760991124
272770991124           MOVE ALL "*"          TO  WS-PERIOD-CDESC(ROCT).
272780991126
272790991124       GPDR-0070.
272800991124
272810991126           SET ROT                     TO  1.
272820991124           ADD 1                       TO WS-ROCT-LST.
272830991124           SET ROCT                    TO WS-ROCT-LST.
272840991124           GO TO GPDR-0010.
272850991124
272860991124      **********
272870991124
272880000529       GPDR-EXIT.
272890000529            EXIT.
272900000529
272910000529      **********
272920000529
272930000529      /
272940991124       POPULATE-ACC-PERF-SECTION.
272950991124
272960991124      *****
272970991124      *****  Populate Section-30 fields with data from WS-ROR-CODE-TBL.
272980000529      *****
272990000529
273000000529           MOVE WS-PERIOD-CCODE (1)    TO  AP-PERIOD-CODE-1.
273010000529           MOVE WS-PERIOD-CDESC (1)    TO  AP-PERIOD-DESCRIPTION-1.
273020000529           MOVE WS-PERIOD-CROR  (1)    TO  AP-PERIOD-ROR-1.
273030000529           MOVE WS-PERIOD-CSIGN (1)    TO  AP-PERIOD-ROR-SIGN-1.
273040991124
273050991124RF6645     IF WS-PERIOD-ROR-APPLICABLE-1   IS NOT EQUAL TO SPACES
273060991124              MOVE WS-PERIOD-ROR-APPLICABLE-1
273070991124                                       TO  AP-PERIOD-ROR-APPLICABLE-1
273080000529           END-IF
273090000529
273100000529           MOVE WS-PERIOD-CCODE (2)    TO  AP-PERIOD-CODE-2.
273110000529           MOVE WS-PERIOD-CDESC (2)    TO  AP-PERIOD-DESCRIPTION-2.
273120000529           MOVE WS-PERIOD-CROR  (2)    TO  AP-PERIOD-ROR-2.
273130000529           MOVE WS-PERIOD-CSIGN (2)    TO  AP-PERIOD-ROR-SIGN-2.
273140991124
273150991124RF6645     IF WS-PERIOD-ROR-APPLICABLE-2   IS NOT EQUAL TO SPACES
273160991124              MOVE WS-PERIOD-ROR-APPLICABLE-2
273170991124                                       TO  AP-PERIOD-ROR-APPLICABLE-2
273180000529           END-IF
273190000529
273200000529           MOVE WS-PERIOD-CCODE (3)    TO  AP-PERIOD-CODE-3.
273210000529           MOVE WS-PERIOD-CDESC (3)    TO  AP-PERIOD-DESCRIPTION-3.
273220000529           MOVE WS-PERIOD-CROR  (3)    TO  AP-PERIOD-ROR-3.
273230000529           MOVE WS-PERIOD-CSIGN (3)    TO  AP-PERIOD-ROR-SIGN-3.
273240991124
273250991124RF6645     IF WS-PERIOD-ROR-APPLICABLE-3   IS NOT EQUAL TO SPACES
273260991124              MOVE WS-PERIOD-ROR-APPLICABLE-3
273270991124                                       TO  AP-PERIOD-ROR-APPLICABLE-3
273280000529           END-IF
273290000529
273300000529           MOVE WS-PERIOD-CCODE (4)    TO  AP-PERIOD-CODE-4.
273310000529           MOVE WS-PERIOD-CDESC (4)    TO  AP-PERIOD-DESCRIPTION-4.
273320991124           MOVE WS-PERIOD-CROR  (4)    TO  AP-PERIOD-ROR-4.
273330991124           MOVE WS-PERIOD-CSIGN (4)    TO  AP-PERIOD-ROR-SIGN-4.
273340991124
273350991124RF6645     IF WS-PERIOD-ROR-APPLICABLE-4   IS NOT EQUAL TO SPACES
273360000529              MOVE WS-PERIOD-ROR-APPLICABLE-4
273370000529                                       TO  AP-PERIOD-ROR-APPLICABLE-4
273380000529           END-IF
273390000529
273400991124           MOVE WS-PERIOD-CCODE (5)    TO  AP-PERIOD-CODE-5.
273410991124           MOVE WS-PERIOD-CDESC (5)    TO  AP-PERIOD-DESCRIPTION-5.
273420991124           MOVE WS-PERIOD-CROR  (5)    TO  AP-PERIOD-ROR-5.
273430991124           MOVE WS-PERIOD-CSIGN (5)    TO  AP-PERIOD-ROR-SIGN-5.
273440000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-5   IS NOT EQUAL TO SPACES
273450000529              MOVE WS-PERIOD-ROR-APPLICABLE-5
273460000529                                       TO  AP-PERIOD-ROR-APPLICABLE-5
273470000529           END-IF
273480991124           MOVE WS-PERIOD-CCODE (6)    TO  AP-PERIOD-CODE-6.
273490991124           MOVE WS-PERIOD-CDESC (6)    TO  AP-PERIOD-DESCRIPTION-6.
273500991124           MOVE WS-PERIOD-CROR  (6)    TO  AP-PERIOD-ROR-6.
273510991124           MOVE WS-PERIOD-CSIGN (6)    TO  AP-PERIOD-ROR-SIGN-6.
273520000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-6   IS NOT EQUAL TO SPACES
273530000529              MOVE WS-PERIOD-ROR-APPLICABLE-6
273540000529                                       TO  AP-PERIOD-ROR-APPLICABLE-6
273550000529           END-IF
273560991124           MOVE WS-PERIOD-CCODE (7)    TO  AP-PERIOD-CODE-7.
273570991124           MOVE WS-PERIOD-CDESC (7)    TO  AP-PERIOD-DESCRIPTION-7.
273580991124           MOVE WS-PERIOD-CROR  (7)    TO  AP-PERIOD-ROR-7.
273590991124           MOVE WS-PERIOD-CSIGN (7)    TO  AP-PERIOD-ROR-SIGN-7.
273600000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-7   IS NOT EQUAL TO SPACES
273610000529              MOVE WS-PERIOD-ROR-APPLICABLE-7
273620000529                                       TO  AP-PERIOD-ROR-APPLICABLE-7
273630000529           END-IF
273640991124           MOVE WS-PERIOD-CCODE (8)    TO  AP-PERIOD-CODE-8.
273650991124           MOVE WS-PERIOD-CDESC (8)    TO  AP-PERIOD-DESCRIPTION-8.
273660991124           MOVE WS-PERIOD-CROR  (8)    TO  AP-PERIOD-ROR-8.
273670991124           MOVE WS-PERIOD-CSIGN (8)    TO  AP-PERIOD-ROR-SIGN-8.
273680000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-8   IS NOT EQUAL TO SPACES
273690000529              MOVE WS-PERIOD-ROR-APPLICABLE-8
273700000529                                       TO  AP-PERIOD-ROR-APPLICABLE-8
273710000529           END-IF
273720991124           MOVE WS-PERIOD-CCODE (9)    TO  AP-PERIOD-CODE-9.
273730991124           MOVE WS-PERIOD-CDESC (9)    TO  AP-PERIOD-DESCRIPTION-9.
273740991124           MOVE WS-PERIOD-CROR  (9)    TO  AP-PERIOD-ROR-9.
273750991126           MOVE WS-PERIOD-CSIGN (9)    TO  AP-PERIOD-ROR-SIGN-9.
273760991126RF6645     IF WS-PERIOD-ROR-APPLICABLE-9   IS NOT EQUAL TO SPACES
273770991124              MOVE WS-PERIOD-ROR-APPLICABLE-9
273780991124                                       TO  AP-PERIOD-ROR-APPLICABLE-9
273790031008           END-IF
273800031008           MOVE WS-PERIOD-CCODE (10)   TO  AP-PERIOD-CODE-10.
273810031008           MOVE WS-PERIOD-CDESC (10)   TO  AP-PERIOD-DESCRIPTION-10.
273820031008           MOVE WS-PERIOD-CROR  (10)   TO  AP-PERIOD-ROR-10.
273830031008           MOVE WS-PERIOD-CSIGN (10)   TO  AP-PERIOD-ROR-SIGN-10.
273840031008RF6645     IF WS-PERIOD-ROR-APPLICABLE-10  IS NOT EQUAL TO SPACES
273850031008              MOVE WS-PERIOD-ROR-APPLICABLE-10
273860031008                                       TO  AP-PERIOD-ROR-APPLICABLE-10
273870031017           END-IF.
273880031017
273890031018      **********
273900031017
273910031017       PAPS-EXIT.
273920031018            EXIT.
273930031017
273940031017      **********
273950031018
273960031017      /
273970031017R17626 POPULATE-ACCOUNT-ROR-SECTION.
273980031018  ¦
273990031017  ¦   *****
274000031017      *****  Populate Section-33 from WS-ROR-CODE-TBL.
274010031018      *****
274020031017
274030031017           MOVE 1 TO ROR33.
274040031018
274050031017           IF WS-PERIOD-CCODE (1) = WS-QRT-FREQ-TEN(QRTT)
274060031017              MOVE 1 TO ROR33
274070031018           END-IF.
274080031017           IF WS-PERIOD-CCODE (2) = WS-QRT-FREQ-TEN(QRTT)
274090031017              MOVE 2 TO ROR33
274100031018           END-IF.
274110031017           IF WS-PERIOD-CCODE (3) = WS-QRT-FREQ-TEN(QRTT)
274120031017              MOVE 3 TO ROR33
274130031018           END-IF.
274140031017           IF WS-PERIOD-CCODE (4) = WS-QRT-FREQ-TEN(QRTT)
274150031017              MOVE 4 TO ROR33
274160031018           END-IF.
274170031017           IF WS-PERIOD-CCODE (5) = WS-QRT-FREQ-TEN(QRTT)
274180031017              MOVE 5 TO ROR33
274190031017           END-IF.
274200031010           IF WS-PERIOD-CCODE (6) = WS-QRT-FREQ-TEN(QRTT)
274210031018              MOVE 6 TO ROR33
274220031018           END-IF.
274230031018           IF WS-PERIOD-CCODE (7) = WS-QRT-FREQ-TEN(QRTT)
274240031018              MOVE 7 TO ROR33
274250031018           END-IF.
274260031017           IF WS-PERIOD-CCODE (8) = WS-QRT-FREQ-TEN(QRTT)
274270031017              MOVE 8 TO ROR33
274280031017           END-IF.
274290031017           IF WS-PERIOD-CCODE (9) = WS-QRT-FREQ-TEN(QRTT)
274300031008              MOVE 9 TO ROR33
274310031008           END-IF.
274320031010           IF WS-PERIOD-CCODE (10) = WS-QRT-FREQ-TEN(QRTT)
274330031018              MOVE 10 TO ROR33
274340031018           END-IF.
274350031018
274360031018           IF QRTT  IS  EQUAL  TO   1
274370031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-1
274380031008              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-1
274390031017              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-1
274400031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-1
274410031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-1
274420031017              IF WS-PERIOD-ROR-APPLICABLE-1   IS NOT EQUAL TO SPACES
274430031008                 MOVE WS-PERIOD-ROR-APPLICABLE-1
274440031008                   TO APF-PERIOD-ROR-APPLICABLE-1
274450031010              END-IF
274460031018           END-IF.
274470031018
274480031018           IF QRTT IS  EQUAL  TO   2
274490031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-2
274500031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-2
274510031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-2
274520031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-2
274530031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-2
274540031017
274550031017              IF WS-PERIOD-ROR-APPLICABLE-2   IS NOT EQUAL TO SPACES
274560031008                 MOVE WS-PERIOD-ROR-APPLICABLE-2
274570031008                   TO APF-PERIOD-ROR-APPLICABLE-2
274580031010              END-IF
274590031018           END-IF.
274600031018
274610031018           IF QRTT IS  EQUAL  TO   3
274620031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-3
274630031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-3
274640031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-3
274650031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-3
274660031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-3
274670031017
274680031017              IF WS-PERIOD-ROR-APPLICABLE-3   IS NOT EQUAL TO SPACES
274690031008                 MOVE WS-PERIOD-ROR-APPLICABLE-3
274700031008                   TO APF-PERIOD-ROR-APPLICABLE-3
274710031010              END-IF
274720031018           END-IF.
274730031018
274740031018           IF QRTT IS  EQUAL  TO   4
274750031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-4
274760031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-4
274770031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-4
274780031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-4
274790031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-4
274800031017
274810031017              IF WS-PERIOD-ROR-APPLICABLE-4   IS NOT EQUAL TO SPACES
274820031008                 MOVE WS-PERIOD-ROR-APPLICABLE-4
274830031008                   TO APF-PERIOD-ROR-APPLICABLE-4
274840031010              END-IF
274850031018           END-IF.
274860031018
274870031018           IF QRTT IS  EQUAL  TO   5
274880031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-5
274890031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-5
274900031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-5
274910031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-5
274920031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-5
274930031017
274940031017              IF WS-PERIOD-ROR-APPLICABLE-5   IS NOT EQUAL TO SPACES
274950031008                 MOVE WS-PERIOD-ROR-APPLICABLE-5
274960031008                   TO APF-PERIOD-ROR-APPLICABLE-5
274970031010              END-IF
274980031018           END-IF.
274990031018
275000031018           IF QRTT IS  EQUAL  TO   6
275010031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-6
275020031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-6
275030031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-6
275040031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-6
275050031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-6
275060031017
275070031017              IF WS-PERIOD-ROR-APPLICABLE-6   IS NOT EQUAL TO SPACES
275080031008                 MOVE WS-PERIOD-ROR-APPLICABLE-6
275090031008                   TO APF-PERIOD-ROR-APPLICABLE-6
275100031010              END-IF
275110031018           END-IF.
275120031018
275130031018           IF QRTT IS  EQUAL  TO   7
275140031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-7
275150031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-7
275160031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-7
275170031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-7
275180031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-7
275190031017
275200031017              IF WS-PERIOD-ROR-APPLICABLE-7   IS NOT EQUAL TO SPACES
275210031008                 MOVE WS-PERIOD-ROR-APPLICABLE-7
275220031008                   TO APF-PERIOD-ROR-APPLICABLE-7
275230031010              END-IF
275240031018           END-IF.
275250031018
275260031018           IF QRTT  IS  EQUAL  TO   8
275270031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-8
275280031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-8
275290031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-8
275300031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-8
275310031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-8
275320031017
275330031017              IF WS-PERIOD-ROR-APPLICABLE-8   IS NOT EQUAL TO SPACES
275340031008                 MOVE WS-PERIOD-ROR-APPLICABLE-8
275350031008                   TO APF-PERIOD-ROR-APPLICABLE-8
275360031010              END-IF
275370031018           END-IF.
275380031018
275390031018           IF QRTT IS  EQUAL  TO   9
275400031018              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-9
275410031018              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-9
275420031008              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-9
275430031017              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-9
275440031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-9
275450031017
275460031017              IF WS-PERIOD-ROR-APPLICABLE-9   IS NOT EQUAL TO SPACES
275470031008                 MOVE WS-PERIOD-ROR-APPLICABLE-9
275480031008                   TO APF-PERIOD-ROR-APPLICABLE-9
275490031008              END-IF
275500031008           END-IF.
275510031008
275520031008           IF QRTT IS  EQUAL  TO   10
275530031008              MOVE WS-PERIOD-CCODE(ROR33)   TO APF-PERIOD-CODE-10
275540031008              MOVE WS-PERIOD-CDESC(ROR33)   TO APF-PERIOD-DESCRIPTION-10
275550031009              MOVE WS-PERIOD-CROR (ROR33)   TO APF-PERIOD-ROR-10
275560031009              MOVE WS-PERIOD-CSIGN(ROR33)   TO APF-PERIOD-ROR-SIGN-10
275570031009              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO APF-PERIOD-DATE-10
275580031009
275590031009              IF WS-PERIOD-ROR-APPLICABLE-10  IS NOT EQUAL TO SPACES
275600031009                 MOVE WS-PERIOD-ROR-APPLICABLE-10
275610031009                   TO APF-PERIOD-ROR-APPLICABLE-10
275620031009              END-IF
275630031009           END-IF.
275640031009
275650031009      **********
275660031009
275670031009       AQRT-EXIT.
275680031009            EXIT.
275690031009
275700031009      **********
275710031009
275720031009      /
275730031017R17626 GET-NEXT-TEN-QRTEND-REC.
275740031017  ¦
275750031017  ¦   *****
275760031017      *****  Get the next ten records from the QRTEND table.
275770031009      *****
275780031009
275790031009             SET  QRTT  TO  1.
275800031009             INITIALIZE  WS-QRTEND-TBL-TEN.
275810031009
275820031009       LOAD-NEXT-TEN-REC.
275830031009
275840031009           MOVE  WS-QRT-ENDDATE (QRT)  TO  WS-QRT-ENDDATE-TEN (QRTT).
275850031009           MOVE  WS-QRT-FREQ    (QRT)  TO  WS-QRT-FREQ-TEN    (QRTT).
275860991124
275870991126           IF  QRTT  IS LESS THAN   WS-QRT-TEN
275880991126             SET  QRT   UP BY  1
275890991126             IF QRT <= WS-QRT-LST
275900991126                SET  QRTT  UP BY  1
275910991126                GO TO   LOAD-NEXT-TEN-REC
275920991126             END-IF
275930991126           END-IF.
275940991126
275950991126      **********
275960991126
275970991126       QTEN-EXIT.
275980000529            EXIT.
275990000529  ¦
276000000529  ¦   **********
276010000529R17626
276020991126
276030991126      /
276040991126       POPULATE-FUND-PERF-SECTION.
276050010419
276060991126      *****
276070000529      *****  Populate Section-35 fields with data from WS-ROR-CODE-TBL.
276080000529      *****
276090000529
276100000529           MOVE WS-PERIOD-CCODE (1)    TO  AFP-PERIOD-CODE-1.
276110991126           MOVE WS-PERIOD-CDESC (1)    TO  AFP-PERIOD-DESCRIPTION-1.
276120991126           MOVE WS-PERIOD-CROR  (1)    TO  AFP-PERIOD-ROR-1.
276130991126           MOVE WS-PERIOD-CSIGN (1)    TO  AFP-PERIOD-ROR-SIGN-1.
276140991126RF6645     IF WS-PERIOD-ROR-APPLICABLE-1   IS NOT EQUAL TO SPACES
276150000529              MOVE WS-PERIOD-ROR-APPLICABLE-1
276160000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-1
276170000529           END-IF
276180000529           MOVE WS-PERIOD-CCODE (2)    TO  AFP-PERIOD-CODE-2.
276190991126           MOVE WS-PERIOD-CDESC (2)    TO  AFP-PERIOD-DESCRIPTION-2.
276200991126           MOVE WS-PERIOD-CROR  (2)    TO  AFP-PERIOD-ROR-2.
276210991126
276220991126           MOVE WS-PERIOD-CSIGN (2)    TO  AFP-PERIOD-ROR-SIGN-2.
276230000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-2   IS NOT EQUAL TO SPACES
276240000529              MOVE WS-PERIOD-ROR-APPLICABLE-2
276250000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-2
276260000529           END-IF
276270991126           MOVE WS-PERIOD-CCODE (3)    TO  AFP-PERIOD-CODE-3.
276280991126           MOVE WS-PERIOD-CDESC (3)    TO  AFP-PERIOD-DESCRIPTION-3.
276290991126           MOVE WS-PERIOD-CROR  (3)    TO  AFP-PERIOD-ROR-3.
276300991126           MOVE WS-PERIOD-CSIGN (3)    TO  AFP-PERIOD-ROR-SIGN-3.
276310000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-3   IS NOT EQUAL TO SPACES
276320000529              MOVE WS-PERIOD-ROR-APPLICABLE-3
276330000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-3
276340000529           END-IF
276350991126           MOVE WS-PERIOD-CCODE (4)    TO  AFP-PERIOD-CODE-4.
276360991126           MOVE WS-PERIOD-CDESC (4)    TO  AFP-PERIOD-DESCRIPTION-4.
276370991126           MOVE WS-PERIOD-CROR  (4)    TO  AFP-PERIOD-ROR-4.
276380991126           MOVE WS-PERIOD-CSIGN (4)    TO  AFP-PERIOD-ROR-SIGN-4.
276390000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-4   IS NOT EQUAL TO SPACES
276400000529              MOVE WS-PERIOD-ROR-APPLICABLE-4
276410000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-4
276420000529           END-IF
276430991126           MOVE WS-PERIOD-CCODE (5)    TO  AFP-PERIOD-CODE-5.
276440991126           MOVE WS-PERIOD-CDESC (5)    TO  AFP-PERIOD-DESCRIPTION-5.
276450991126           MOVE WS-PERIOD-CROR  (5)    TO  AFP-PERIOD-ROR-5.
276460991126           MOVE WS-PERIOD-CSIGN (5)    TO  AFP-PERIOD-ROR-SIGN-5.
276470000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-5   IS NOT EQUAL TO SPACES
276480000529              MOVE WS-PERIOD-ROR-APPLICABLE-5
276490000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-5
276500000529           END-IF
276510991126           MOVE WS-PERIOD-CCODE (6)    TO  AFP-PERIOD-CODE-6.
276520991126           MOVE WS-PERIOD-CDESC (6)    TO  AFP-PERIOD-DESCRIPTION-6.
276530991126           MOVE WS-PERIOD-CROR  (6)    TO  AFP-PERIOD-ROR-6.
276540991126           MOVE WS-PERIOD-CSIGN (6)    TO  AFP-PERIOD-ROR-SIGN-6.
276550000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-6   IS NOT EQUAL TO SPACES
276560000529              MOVE WS-PERIOD-ROR-APPLICABLE-6
276570000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-6
276580000529           END-IF
276590991126           MOVE WS-PERIOD-CCODE (7)    TO  AFP-PERIOD-CODE-7.
276600991126           MOVE WS-PERIOD-CDESC (7)    TO  AFP-PERIOD-DESCRIPTION-7.
276610991126           MOVE WS-PERIOD-CROR  (7)    TO  AFP-PERIOD-ROR-7.
276620991126           MOVE WS-PERIOD-CSIGN (7)    TO  AFP-PERIOD-ROR-SIGN-7.
276630000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-7   IS NOT EQUAL TO SPACES
276640000529              MOVE WS-PERIOD-ROR-APPLICABLE-7
276650000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-7
276660000529           END-IF
276670991126           MOVE WS-PERIOD-CCODE (8)    TO  AFP-PERIOD-CODE-8.
276680991126           MOVE WS-PERIOD-CDESC (8)    TO  AFP-PERIOD-DESCRIPTION-8.
276690991126           MOVE WS-PERIOD-CROR  (8)    TO  AFP-PERIOD-ROR-8.
276700991126           MOVE WS-PERIOD-CSIGN (8)    TO  AFP-PERIOD-ROR-SIGN-8.
276710000529RF6645     IF WS-PERIOD-ROR-APPLICABLE-8   IS NOT EQUAL TO SPACES
276720000529              MOVE WS-PERIOD-ROR-APPLICABLE-8
276730000529                                       TO  AFP-PERIOD-ROR-APPLICABLE-8
276740000529           END-IF
276750991126           MOVE WS-PERIOD-CCODE (9)    TO  AFP-PERIOD-CODE-9.
276760991126           MOVE WS-PERIOD-CDESC (9)    TO  AFP-PERIOD-DESCRIPTION-9.
276770991126           MOVE WS-PERIOD-CROR  (9)    TO  AFP-PERIOD-ROR-9.
276780991126           MOVE WS-PERIOD-CSIGN (9)    TO  AFP-PERIOD-ROR-SIGN-9.
276790991126RF6645     IF WS-PERIOD-ROR-APPLICABLE-9   IS NOT EQUAL TO SPACES
276800991126              MOVE WS-PERIOD-ROR-APPLICABLE-9
276810991126                                       TO  AFP-PERIOD-ROR-APPLICABLE-9
276820031008           END-IF
276830031008           MOVE WS-PERIOD-CCODE (10)   TO  AFP-PERIOD-CODE-10.
276840031008           MOVE WS-PERIOD-CDESC (10)   TO  AFP-PERIOD-DESCRIPTION-10.
276850031008           MOVE WS-PERIOD-CROR  (10)   TO  AFP-PERIOD-ROR-10.
276860031008           MOVE WS-PERIOD-CSIGN (10)   TO  AFP-PERIOD-ROR-SIGN-10.
276870031008RF6645     IF WS-PERIOD-ROR-APPLICABLE-10  IS NOT EQUAL TO SPACES
276880031008              MOVE WS-PERIOD-ROR-APPLICABLE-10
276890031008                                       TO  AFP-PERIOD-ROR-APPLICABLE-10
276900031017           END-IF.
276910031017
276920031017      **********
276930031017
276940031017       PFPS-EXIT.
276950031018            EXIT.
276960031017
276970031017      **********
276980031018
276990031017      /
277000031017R17626 POPULATE-FUND-ROR-SECTION.
277010031018   ¦
277020031017   ¦  *****
277030031017      *****  Populate Section-38 fields with data from WS-ROR-CODE-TBL.
277040031018      *****
277050031017
277060031017           MOVE 1 TO ROR38.
277070031018
277080031017      ***** Find the Frequency from the returned ROR table that is
277090031017      ***** the same as the current quarter-end entry.
277100031018
277110031017           IF WS-PERIOD-CCODE (1) = WS-QRT-FREQ-TEN(QRTT)
277120031017              MOVE 1 TO ROR38
277130031018           END-IF.
277140031017           IF WS-PERIOD-CCODE (2) = WS-QRT-FREQ-TEN(QRTT)
277150031017              MOVE 2 TO ROR38
277160031018           END-IF.
277170031017           IF WS-PERIOD-CCODE (3) = WS-QRT-FREQ-TEN(QRTT)
277180031017              MOVE 3 TO ROR38
277190031018           END-IF.
277200031017           IF WS-PERIOD-CCODE (4) = WS-QRT-FREQ-TEN(QRTT)
277210031017              MOVE 4 TO ROR38
277220031018           END-IF.
277230031017           IF WS-PERIOD-CCODE (5) = WS-QRT-FREQ-TEN(QRTT)
277240031017              MOVE 5 TO ROR38
277250031017           END-IF.
277260031010           IF WS-PERIOD-CCODE (6) = WS-QRT-FREQ-TEN(QRTT)
277270031018              MOVE 6 TO ROR38
277280031018           END-IF.
277290031018           IF WS-PERIOD-CCODE (7) = WS-QRT-FREQ-TEN(QRTT)
277300031018              MOVE 7 TO ROR38
277310031018           END-IF.
277320031008           IF WS-PERIOD-CCODE (8) = WS-QRT-FREQ-TEN(QRTT)
277330031017              MOVE 8 TO ROR38
277340031017           END-IF.
277350031017           IF WS-PERIOD-CCODE (9) = WS-QRT-FREQ-TEN(QRTT)
277360031017              MOVE 9 TO ROR38
277370031008           END-IF.
277380031008           IF WS-PERIOD-CCODE (10) = WS-QRT-FREQ-TEN(QRTT)
277390031010              MOVE 10 TO ROR38
277400031018           END-IF.
277410031018
277420031018           IF QRTT  IS  EQUAL  TO   1
277430031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-1
277440031018              MOVE WS-PERIOD-CDESC(ROR38)  TO AFPF-PERIOD-DESCRIPTION-1
277450031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-1
277460031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-1
277470031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-1
277480031017
277490031017              IF WS-PERIOD-ROR-APPLICABLE-1   IS NOT EQUAL TO SPACES
277500031008                 MOVE WS-PERIOD-ROR-APPLICABLE-1
277510031008                   TO AFPF-PERIOD-ROR-APPLICABLE-1
277520031010              END-IF
277530031018           END-IF.
277540031018
277550031018           IF QRTT IS  EQUAL  TO   2
277560031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-2
277570031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-2
277580031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-2
277590031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-2
277600031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-2
277610031017
277620031017              IF WS-PERIOD-ROR-APPLICABLE-2   IS NOT EQUAL TO SPACES
277630031008                 MOVE WS-PERIOD-ROR-APPLICABLE-2
277640031008                   TO AFPF-PERIOD-ROR-APPLICABLE-2
277650031010              END-IF
277660031018           END-IF.
277670031018
277680031018           IF QRTT IS  EQUAL  TO   3
277690031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-3
277700031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-3
277710031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-3
277720031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-3
277730031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-3
277740031017
277750031017              IF WS-PERIOD-ROR-APPLICABLE-3   IS NOT EQUAL TO SPACES
277760031008                 MOVE WS-PERIOD-ROR-APPLICABLE-3
277770031008                   TO AFPF-PERIOD-ROR-APPLICABLE-3
277780031010              END-IF
277790031018           END-IF.
277800031018
277810031018           IF QRTT IS  EQUAL  TO   4
277820031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-4
277830031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-4
277840031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-4
277850031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-4
277860031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-4
277870031017
277880031017              IF WS-PERIOD-ROR-APPLICABLE-4   IS NOT EQUAL TO SPACES
277890031008                 MOVE WS-PERIOD-ROR-APPLICABLE-4
277900031008                   TO AFPF-PERIOD-ROR-APPLICABLE-4
277910031010              END-IF
277920031018           END-IF.
277930031018
277940031018           IF QRTT IS  EQUAL  TO   5
277950031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-5
277960031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-5
277970031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-5
277980031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-5
277990031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-5
278000031017
278010031017              IF WS-PERIOD-ROR-APPLICABLE-5   IS NOT EQUAL TO SPACES
278020031008                 MOVE WS-PERIOD-ROR-APPLICABLE-5
278030031008                   TO  AFPF-PERIOD-ROR-APPLICABLE-5
278040031010              END-IF
278050031018           END-IF.
278060031018
278070031018           IF QRTT IS  EQUAL  TO   6
278080031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-6
278090031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-6
278100031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-6
278110031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-6
278120031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-6
278130031017
278140031017              IF WS-PERIOD-ROR-APPLICABLE-6   IS NOT EQUAL TO SPACES
278150031008                 MOVE WS-PERIOD-ROR-APPLICABLE-6
278160031008                   TO AFPF-PERIOD-ROR-APPLICABLE-6
278170031010              END-IF
278180031018           END-IF.
278190031018
278200031018           IF QRTT  IS  EQUAL  TO   7
278210031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-7
278220031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-7
278230031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-7
278240031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-7
278250031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-7
278260031017
278270031017              IF WS-PERIOD-ROR-APPLICABLE-7   IS NOT EQUAL TO SPACES
278280031008                 MOVE WS-PERIOD-ROR-APPLICABLE-7
278290031008                   TO AFPF-PERIOD-ROR-APPLICABLE-7
278300031010              END-IF
278310031018           END-IF.
278320031018
278330031018           IF QRTT  IS  EQUAL  TO   8
278340031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-8
278350031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-8
278360031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-8
278370031017              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-8
278380031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-8
278390031017
278400031017              IF WS-PERIOD-ROR-APPLICABLE-8   IS NOT EQUAL TO SPACES
278410031008                 MOVE WS-PERIOD-ROR-APPLICABLE-8
278420031008                   TO AFPF-PERIOD-ROR-APPLICABLE-8
278430031010              END-IF
278440031018           END-IF.
278450031018
278460031018           IF QRTT  IS  EQUAL  TO   9
278470031018              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-9
278480031018              MOVE WS-PERIOD-CDESC(ROR38)   TO AFPF-PERIOD-DESCRIPTION-9
278490031018              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-9
278500031008              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-9
278510031017              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-9
278520031017
278530031017              IF WS-PERIOD-ROR-APPLICABLE-9   IS NOT EQUAL TO SPACES
278540031017                 MOVE WS-PERIOD-ROR-APPLICABLE-9
278550031008                   TO AFPF-PERIOD-ROR-APPLICABLE-9
278560031008              END-IF
278570031008           END-IF.
278580031008
278590031008           IF QRTT  IS  EQUAL  TO   10
278600031008              MOVE WS-PERIOD-CCODE(ROR38)   TO AFPF-PERIOD-CODE-10
278610031008              MOVE WS-PERIOD-CDESC(ROR38)
278620031008                TO AFPF-PERIOD-DESCRIPTION-10
278630031008              MOVE WS-PERIOD-CROR (ROR38)   TO AFPF-PERIOD-ROR-10
278640991126              MOVE WS-PERIOD-CSIGN(ROR38)   TO AFPF-PERIOD-ROR-SIGN-10
278650000113              MOVE WS-QRT-ENDDATE-TEN(QRTT) TO AFPF-PERIOD-DATE-10
278660000113
278670000113              IF WS-PERIOD-ROR-APPLICABLE-10  IS NOT EQUAL TO SPACES
278680000113                 MOVE WS-PERIOD-ROR-APPLICABLE-10
278690000113                   TO AFPF-PERIOD-ROR-APPLICABLE-10
278700000113              END-IF
278710000113           END-IF.
278720000113
278730000113      **********
278740000113
278750000113       FQRT-EXIT.
278760000121            EXIT.
278770000113
278780000113      **********
278790000113
278800000113
278810000113RF6234***
278820000113      *** Populate Investment Unit Price table for all investments
278830000113      *** if it is a MASS statement run.
278840000113      ***
278850000113
278860041027       POPULATE-INVESTMENT-PRICE-TBL.
278870041027
278880041027           MOVE "Y"                      TO   WS-LOOP-INDICATOR.
278890041027           MOVE ZEROS                    TO   WS-LOOP-DATE-NUM.
278900041027
278910041027       PIPT-0010.
278920041027
278930041027           EVALUATE WS-LOOP-DATE-NUM
278940041027              WHEN 0
278950041027                  MOVE WS-LDA-STRDTE      TO  WS-TRADE-DATE
278960041027              WHEN 1
278970041027                  MOVE WS-LDA-ENDDTE      TO  WS-TRADE-DATE
278980041027              WHEN 2
278990041027                  MOVE WS-PRV-Y-END-DATE  TO  WS-TRADE-DATE
279000041027           END-EVALUATE.
279010041027
279020041027R24691     IF WS-LOOP-DATE-NUM = 0
279030041027   ¦          GO TO PIPT-0010-0020
279040041027   ¦       END-IF.
279050041027   ¦
279060041027   ¦       INITIALIZE INVESTMENT-PRICE-REC.
279070041027   ¦       MOVE WS-IC-CODE (IC)     TO INVESTMENT-CODE
279080041027   ¦                                OF INVESTMENT-UNIT-PRICE.
279090041027   ¦       MOVE WS-TRADE-DATE        TO TRADE-DATE
279100041027   ¦                                 OF INVESTMENT-PRICE-REC.
279110041027   ¦       MOVE "Y" TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
279120041027   ¦
279130041027   ¦       READ INVESTMENT-UNIT-PRICE
279140041027   ¦          INVALID KEY
279150041027   ¦            GO TO PIPT-0010-0010
279160041027   ¦       END-READ.
279170041027   ¦
279180041027   ¦       GO TO PIPT-0040.
279190041027   ¦
279200041027   ¦   PIPT-0010-0010.
279210031117   ¦
279220000114   ¦       INITIALIZE INVESTMENT-PRICE-REC.
279230000114   ¦       MOVE WS-IC-CODE (IC)     TO INVESTMENT-CODE
279240000114   ¦                                OF INVESTMENT-UNIT-PRICE.
279250000113   ¦       MOVE WS-TRADE-DATE        TO TRADE-DATE
279260000113   ¦                                 OF INVESTMENT-PRICE-REC.
279270000117   ¦       MOVE " " TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
279280000117   ¦
279290000113   ¦       READ INVESTMENT-UNIT-PRICE
279300000120   ¦          INVALID KEY
279310000113   ¦            GO TO PIPT-0010-0020
279320000113   ¦       END-READ.
279330000113   ¦
279340000113   ¦       GO TO PIPT-0040.
279350000113   V
279360000113R24691 PIPT-0010-0020.
279370000113
279380000113           INITIALIZE INVESTMENT-PRICE-REC.
279390000113           MOVE WS-IC-CODE (IC)     TO INVESTMENT-CODE
279400000113                                    OF INVESTMENT-UNIT-PRICE.
279410000118           MOVE WS-TRADE-DATE        TO TRADE-DATE
279420000118                                     OF INVESTMENT-PRICE-REC.
279430000118       PIPT-START.
279440000118
279450000113           START INVESTMENT-UNIT-PRICE
279460000113               KEY  IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
279470000113                 INVALID KEY
279480000113                   GO TO PIPT-0020
279490000113           END-START
279500000113
279510000113           GO TO PIPT-PRICE-PRIOR.
279520000114
279530000113       PIPT-0020.
279540000118
279550000118           READ INVESTMENT-UNIT-PRICE LAST
279560000118              AT  END
279570000118                 MOVE WS-LDA-STRDTE   TO  TRADE-DATE
279580000120                                          OF INVESTMENT-PRICE-REC
279590000113                 MOVE ZEROES          TO  UNIT-PRICE
279600000113                                          OF INVESTMENT-PRICE-REC
279610000113              GO TO PIPT-0040
279620000113           END-READ
279630000113
279640000113           GO TO PIPT-0030.
279650000113
279660000113       PIPT-PRICE-PRIOR.
279670000113
279680000113           READ INVESTMENT-UNIT-PRICE PRIOR RECORD
279690000117               AT  END
279700000113                   MOVE WS-LDA-STRDTE   TO  TRADE-DATE
279710000113                                            OF INVESTMENT-PRICE-REC
279720000124                   MOVE ZEROES          TO  UNIT-PRICE
279730000124                                            OF INVESTMENT-PRICE-REC
279740000124                   GO TO PIPT-0040
279750000113           END-READ.
279760000124
279770000113       PIPT-0030.
279780000124
279790000124           IF INVESTMENT-CODE OF INVESTMENT-PRICE-REC
279800080219                              IS NOT EQUAL TO  WS-IC-CODE (IC)
279810000124              MOVE WS-TRADE-DATE      TO  TRADE-DATE
279820000124                                      OF INVESTMENT-PRICE-REC
279830000124              MOVE ZEROES             TO  UNIT-PRICE
279840000113                                      OF INVESTMENT-PRICE-REC
279850000113              GO TO PIPT-0040
279860000113           END-IF
279870000113
279880000118           IF WS-LOOP-DATE-NUM        IS EQUAL TO ZEROS
279890000118           AND TRADE-DATE OF INVESTMENT-PRICE-REC
279900000118                         IS NOT LESS THAN  WS-TRADE-DATE
279910000118               GO TO PIPT-PRICE-PRIOR
279920151124           END-IF
279930151124
279940151124           IF TRADE-DATE OF INVESTMENT-PRICE-REC
279950151124                         IS GREATER  THAN  WS-TRADE-DATE
27996015112442749          OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
279970151124               GO TO PIPT-PRICE-PRIOR
279980000113           END-IF.
279990151124
280000000113       PIPT-0040.
280010000113
280020000117           MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
280030000113                           TO WS-UNIT-PRICE-TEMP.
280040000113           IF WS-LOOP-DATE-NUM = 0
280050000113              MOVE TRADE-DATE OF INVESTMENT-PRICE-REC
280060000113                              TO WS-UNIT-PRICE-DATE
280070000118           END-IF
280080000113      *RFS152637-Start
280090000113      *    IF WS-IUP-LST IS NOT LESS THAN  WS-IUP-MAX
280100000113      *       DISPLAY "INVESTMENT PRICE(MFAINVUPP) EXCEED PROGRAM MAX"
280110000113      *       GO TO PIPT-EXIT
280120000113      *    END-IF
280130000113      *RFS152637-Ends
280140000113           IF WS-LOOP-INDICATOR           IS EQUAL TO "Y"
280150000113152637        COMPUTE ln_Array-size-iup = ln_Array-size-iup + 1
280160000113              ADD 1                       TO WS-IUP-LST
280170000113              SET IUP                     TO WS-IUP-LST
280180000113              MOVE WS-IC-CODE (IC) TO WS-IUP-CODE (IUP)
280190151126           END-IF
280200151126           EVALUATE WS-LOOP-DATE-NUM
280210151126              WHEN 0
280220000113                  MOVE WS-UNIT-PRICE-TEMP TO  WS-IUP-OPENING (IUP)
280230000113                  MOVE WS-UNIT-PRICE-DATE TO  WS-IUP-OPENING-DATE (IUP)
280240000113              WHEN 1
280250000113                  MOVE WS-UNIT-PRICE-TEMP TO  WS-IUP-CLOSING (IUP)
280260010622              WHEN 2
280270010622                  MOVE WS-UNIT-PRICE-TEMP TO  WS-IUP-LASTYEND (IUP)
280280010622           END-EVALUATE
280290010622
280300010622           MOVE "N"                      TO   WS-LOOP-INDICATOR.
280310010622           ADD 1                         TO   WS-LOOP-DATE-NUM.
280320010622           IF WS-LOOP-DATE-NUM  < 3
280330010622              GO TO  PIPT-0010
280340010622           END-IF.
280350010622152637     SET IUP  UP BY 1.
280360010622152637     INITIALIZE WS-INVUPE-ENT-ELE (IUP).
280370010622152637     SET IUP  DOWN BY 1.
280380010622      **********
280390010622       PIPT-EXIT.
280400010622            EXIT.
280410010622      **********
280420010622R10720***
280430010622      *** Get GIC end date if the Statement end date is the end
280440010622      *** date of the month.
280450010622      ***
280460010622
280470010622       GET-GIC-END-DATE.
280480010622           MOVE WS-LDA-ENDDTE          TO WS-GIC-END-DATE.
280490010622
280500010622           INITIALIZE MFABUSDAP.
280510010622           MOVE WS-LDA-ENDDTE          TO  BUSINESS-DAY
280520010622                                           OF BUSINESS-DAY-REC.
280530010622           START BUSINESS-DAY-FILE
280540010622               KEY IS GREATER THAN EXTERNALLY-DESCRIBED-KEY
280550010622               INVALID KEY
280560010622                   GO TO GGED-EXIT
280570010622           END-START.
280580010622
280590010622       GGED-0010.
280600010622
280610010622           READ BUSINESS-DAY-FILE NEXT AT  END
280620010622               GO TO GGED-EXIT
280630010622           END-READ.
280640010622
280650010622           IF ALLOW-TRADING OF BUSINESS-DAY-REC   IS NOT EQUAL TO  "Y"
280660010622               GO TO GGED-0010
280670010622           END-IF
280680010622           MOVE  BUSINESS-DAY OF BUSINESS-DAY-REC
280690010622                              TO WS-GIC-BUSINESS-DAY.
280700010622           IF WS-GIC-BUSINESS-DAY-MM  IS NOT EQUAL TO
280710010622                               WS-GIC-END-DATE-MM
280720010622              GO TO GGED-0050
280730010622           END-IF.
280740010622
280750010622           GO TO GGED-EXIT.
280760010622
280770010622       GGED-0050.
280780010622
280790010622           MOVE WS-LDA-ENDDTE          TO WS-GIC-END-DATE.
280800010622           INITIALIZE MFABUSDAP.
280810010622           MOVE WS-LDA-ENDDTE          TO  BUSINESS-DAY
280820010622                                           OF BUSINESS-DAY-REC.
280830010622           START BUSINESS-DAY-FILE
280840010622               KEY IS GREATER THAN EXTERNALLY-DESCRIBED-KEY
280850010622               INVALID KEY
280860010622                   GO TO GGED-EXIT
280870010622           END-START.
280880010622
280890000000       GGED-0100.
280900031015
280910031015           READ BUSINESS-DAY-FILE PRIOR RECORD
280920031015               AT END
280930031015               GO TO GGED-EXIT
280940031015           END-READ.
280950031015           IF ALLOW-TRADING OF BUSINESS-DAY-REC   IS NOT EQUAL TO  "Y"
280960031015               GO TO GGED-0010
280970031015           END-IF
280980031015           MOVE  BUSINESS-DAY OF BUSINESS-DAY-REC
280990031015                              TO WS-GIC-END-DATE.
281000031015
281010031015      **********
281020031015       GGED-EXIT.
281030031015            EXIT.
281040031015      **********
281050031015      /
281060031015R18682 GET-GAIN-LOSS-ACCRUED.
281070031015   ¦
281080031015   ¦  ******************************************************************
281090031015   ¦  *    CALL CALCULATE INCOME ALLOCATION AMOUNT PROGRAM (CALCALAI) **
281100031015   ¦  ******************************************************************
281110031015   ¦
281120031015   ¦       CALL "CALCALAI"  USING
281130031015   ¦                        ALOC-CALLED-BY
281140031015   ¦                        ALOC-START-DATE
281150031015   ¦                        ALOC-END-DATE
281160031015   ¦                        ALOC-DISTR-METHOD
281170031015   ¦                        ALOC-ACCOUNT-NO
281180031015   ¦                        ALOC-INVESTMENT
281190031015   ¦                        ALOC-NO-OF-UNITS
281200031015   ¦                        ALOC-CDN-DIVDND
281210031015   ¦                        ALOC-CDN-INTRST
281220031015   ¦                        ALOC-FGN-WTHLDNG
281230031015   ¦                        ALOC-FGN-DIVDND
281240031015   ¦                        ALOC-FGN-INTRST
281250031015   ¦                        ALOC-CPTL-GAIN
281260031015   ¦                        ALOC-ROC-AMOUNT
281270031015   ¦                        ALOC-ACCR-INCOME
281280031015   ¦                        ALOC-ACCR-CAPITAL
281290031015   ¦                        ALOC-RETURN-CODE.
281300000000   ¦
281310000000   ¦
281320000000   ¦       IF ALOC-RETURN-CODE    IS NOT EQUAL SPACES
281330000000   ¦         DISPLAY "ERROR IN CALLING CALCALAI..."
281340000000   ¦         DISPLAY "Account-NO:" AD-ACCOUNT
281350980205   ¦         DISPLAY "Investment-Code:" PREV-INVESTMENT
281360000000   ¦       END-IF.
281370140925   ¦
281380140925   ¦
281390140925   ¦  **********
281400140925   ¦
281410140925   ¦   GGLA-EXIT.
281420140925   ¦        EXIT.
281430140925   v
281440140925R18682**********
281450140925
281460140925       END-JOB.
281470051003
281480051003      ******************************************************************
281490051003      *                                                                *
281500051003      *    E N D   J O B   R O U T I N E                               *
281510051003      *                                                                *
281520051003      ******************************************************************
281530051003      *RFS140627-Start
281540051003      *Process/Insert the section 16 records for the last account.
281550051003           IF lc_ASSETALLOCYes                    AND
281560051003              ln_PrevAccCode NOT = ZEROES         AND
281570051003              ln_CurrAccCode NOT = ZEROES
281580051003              MOVE ln_CurrAccCode  TO ln_PrevAccCode
281590030825              MOVE lc_CurrInvestor TO lc_PrevInvestor
281600030825              PERFORM POPULATE-ASSETALLOC-DTL
281610030825           END-IF.
281620030825      *RFS140627-End
281630030825
281640030825R14153     CALL "GETDAT" USING WS-REQUEST-DATE.
281650980302  ¦        CANCEL "GETDAT".
281660980302  ¦
281670980205  ¦        ACCEPT WS-REQUEST-TIME-1 FROM TIME.
281680980212  ¦        MOVE WS-DI-REQUEST-H1    TO WS-DI-REQUEST-H2.
281690980212  ¦        MOVE WS-DI-REQUEST-M1    TO WS-DI-REQUEST-M2.
281700980212  ¦        MOVE WS-DI-REQUEST-S1    TO WS-DI-REQUEST-S2.
281710980205  ¦
281720980205  v        DISPLAY "ANNSTMTJSI ended on: "  WS-REQUEST-DATE.
281730980205R14153     DISPLAY "ANNSTMTJSI ended at: "  WS-REQUEST-TIME-1.
281740980212
281750980210R17495     IF ISR > 1
281760980211   |          COMPUTE ISR = ISR - 1
281770980205   |          COMPUTE ISRMAX = ISR
281780980205   V          PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
281790980205R17495     END-IF.
281800980205
281810980205           IF WS-LDA-STMT-CNFM-FLAG = "C"
281820980205              MOVE "Y" TO WS-CTLREP-W-FLAG.
281830980205
281840980205           IF WS-CTLREP-W-FLAG = "N"
281850980205              GO TO EOJ-0001.
281860980205
281870980211      *****
281880980205      *****    WRITE CONTROL REPORT
281890980205      *****
281900041101
281910041101           PERFORM HEADING-RTN      THRU HR-EXIT.
281920980212           MOVE WS-HOLDMAIL-CNT     TO DTL2-HOLDMAIL-CNT.
281930000000
281940980520           WRITE PRINT-REC FROM DETAIL-LINE2
281950000000                           AFTER ADVANCING 1.
281960980625
281970990518           ADD 2 TO WS-LINE-CNT.
281980980317
281990970424           IF WS-LINE-CNT IS GREATER THAN 60
282000970422              PERFORM HEADING-RTN THRU HR-EXIT
282010000417           END-IF
282020000417
282030000503           MOVE WS-SUPPRESS-CNT     TO DTL3-SUPPRESS-CNT.
282040991004           WRITE PRINT-REC FROM DETAIL-LINE3
282050001012                           AFTER ADVANCING 2.
282060970424
282070990512
282080980731       EOJ-0001.
282090970424      *****
282100010131      *****
282110970502      *****
282120970424           CLOSE           ACCOUNT-AWD-INVESTMENT
282130970530                           ACCOUNT
282140990512                           ACCOUNT-ATTRIBUTE
282150970430                           ACCOUNT-AWD
282160970430                           ACCOUNT-BENEFICIARY
282170970430RF6063                     ACCOUNT-BENEFICIARY-FINANCIALS
282180970422RF6063                     BENEFICIARY-TYPE-FILE
282190970530RF6063                     BENEFICIARY-RELATIONSHIP-TYPE
282200970530                           ACCOUNT-BENEFICIARY-SPLIT
282210030204RF4638                     ACCOUNT-BENEFICIARY-SPLITLB
282220970424                           ACCOUNT-INV-ACCRUALS
282230970530                           ACCOUNT-SERVICE-LEVEL
282240970424                           ACCOUNT-T
282250110519                           ACCOUNT-TYPE-BK
282260991202rf9326                     ACCOUNT-LIF-ADD-DETAILS
282270991201                           ASSET-CLASS-DESCRIPTION
282280970422                           BUSINESS-DAY-FILE
282290000000                           EXCHANGE-RATE-M
282300000000                           INVESTOR-MARKETING-INFO
282310981109                           INV-GROUP-WEIGHTING-DETAIL
282320000000                           INV-GROUP-WEIGHTING-HEADER
282330000000                           INV-GROUP-WEIGHTING-SUBCLS-DTL
282340000000                           INVESTOR-ATTRIBUTE
282350000000                           PROGRAM-EXCHANGE-RATE
282360000000                           PRODUCT-TYPE-CODES
282370990512R15880                     PROGRAM-THRESHOLDS
282380000000                           REVERSAL-REASON-BK
282390000000                           TRANS-EXCHANGE-RATE
282400000000                           TRANS-T
28241000090793759                      TRANS-M
282420000908RF5962                     TRANS-ROC-APPLIED
282430970523RF5962                     MAX-PENSION-EARNINGS
282440000000                           INVESTOR-JOIN
282450000000                           INVESTOR-SPOUSE
282460991004                           INVESTOR-TYPE
282470001013                           INVESTOR-TENANT
282480000000                           INSTITUTION
282490000000                           INSTITUTION-BRANCH
282500000000                           INSTITUTION-ADDRESS
282510000000                           DEALER-REP-ADDRESS
282520000000                           ACCOUNT-TYPE-LANG
282530000000                           MANAGEMENT-COMPANY-CODES
282540980727                           NOMINEE-ACCOUNT-TYPE-DESCR
282550001027                           ACCOUNT-INVESTMENT
282560001027                           ROLLOVER
282570010228RF6697                     INVESTMENT-DII-RATES
282580010704                           DII-RATE-SET
282590010704                           INV-CATEGORY
282600010328                           INVESTMENT-UNIT-PRICE
282610070925                           TRANS
282620070925                           TRANS-RESP-DETAILS
282630070925RF4638                     TRANS-CDSC-PURCHASE
282640010418                           TRANS-TYPE-REPORT-DESCR
282650020418                           DEALER
282660020709                           DEALER-REP
282670020820                           TAXABLE-EVENT
282680030306                           ADDRESS-FILE
282690030306                           INVESTOR-ADDRESS-FILE
282700020910                           COUNTRY-FILE
282710020910                           DISCRETIONARY-FEE-SCHED
282720160215                           ACCOUNT-FEE
282730980727RF9331                     ACCOUNT-RESP
282740980212R10362                     FREQUENCY-CODES-LANG
282750980212R10362                     PAYMENT-TYPE-LANG
282760980212RF9415                     DEALER-MISC-DETAILS
282770980212      ** RFS43691 - Start
282780980212                           DEALER-REP-MISC-DETAILS
282790980212      ** RFS43691 - End
282800981116RF9415                     NOMINEE-MISC-DETAILS
282810981116R13211                     ACCOUNT-XREFLA
282820981116R13756                     MASTER-ACCOUNT
282830981116R13955                     GROUP-PLAN-DESC
282840981116R16363                     TRANS-DISTR-DETAILS
282850020626R16363                     TRANS-INTEREST-DETAILS
282860020627R14418                     INVESTOR-ACCOUNT-ATTRIBUTES
282870020627R14418                     ACCOUNT-ATTRIBUTE-CODES
282880980706148326                     TransAdjustmentUnitCost
282890980706                           USER-FILE.
282900980706      *****
282910980706      *****   If it is confirmation, close print file
282920980706      *****
282930980520           IF WS-LDA-STMT-CNFM-FLAG = "C"
282940980706              CLOSE        PRINT-FILE.
282950980706
282960980706      *****
282970981116      *****    Close the Input files for AIC
282980980706      *****
282990980706           IF WS-LDA-FCR-FUND-FLAG = "Y"
283000980706              CLOSE            ACCOUNT-FGN-CONTENT-REBAL-OPT
283010970523R14178*                        FGN-CONTENT-REBAL-SCHED.
283020970523R14178                         FGN-CONTENT-REBAL-SCHED-LA
283030970523R14178                         ACCOUNT-INVESTMENT-FCR.
283040970523      *****
283050971024      *****    Close the Input files for GGF
283060970523      *****
283070970523           IF WS-LDA-ACCOUNT-LIF = "Y"
283080970108              CLOSE            ACCOUNT-LIF.
283090970108
283100970108           IF WS-LDA-GROUP = "Y"
283110970108              CLOSE            ACCOUNT-GROUP
283120970108                               GROUP-FILE.
283130970108
283140970108           IF WS-LDA-REQUEST-SCOPE IS EQUAL TO "C"
283150971024           OR WS-LDA-REQUEST-SCOPE IS EQUAL TO "E"
283160971024              CLOSE            DEALER-REP-EXTRACT.
283170971024      *****
283180980713      *****    If this is a Batch Request, close the Statement Print
283190971024      *****    Request file.
283200971024      *****
283210971024           IF  WS-LDA-REQUEST-SCOPE
283220971024                              IS EQUAL TO  "B"
283230971024               CLOSE           STATEMENT-PRINT-REQUEST.
283240971024
283250980625      *****
283260971024      *****    If this is an ALL RUN, indicated by position 610 of the
283270971024      *****    LDA containing a value of 'D' (Dealer), 'I' (Investor) or
283280971024      *****    'R' (Dealer Representative), close the Mailing
283290971024      *****    Instruction files.
283300971024      *****
283310971024           IF  WS-LDA-ALLTYP  IS EQUAL TO  "D"
283320971024           OR  WS-LDA-ALLTYP  IS EQUAL TO  "I"
283330971024           OR  WS-LDA-ALLTYP  IS EQUAL TO  "R"
283340971024           OR  WS-LDA-ALLTYP  IS EQUAL TO  " "
283350971024      *****
283360971101      *****    If PAC/AWD systematic data is to be processed, close the
283370971101      *****    required files.
283380971101      *****
283390971101           IF  WS-LDA-PACAWD-FLAG
283400971101                          IS NOT EQUAL TO  "N"
283410040109               CLOSE           BANK-ACCOUNT
283420010704                               BANK-FILE
283430010131                               INVESTOR-PAC
283440971203                               INVESTOR-PAC-PURCHASE.
283450971203      *****
283460971203      *****    If multiple dealer records are to be produced, close the
283470971203      *****    required files.
283480971203      *****
283490971203           IF  WS-LDA-DEALER-FLAG
283500971203                              IS EQUAL TO  "M"
283510980402               CLOSE           INVESTOR-DEALER-REP.
283520980402      *****
283530980402      *****    If RRIF detail records are to be produced, close the
283540161025      *****    required files.
283550161024      *****
283560161024           IF  WS-LDA-RRIF-FLAG  EQUAL TO  "Y"
283570161024R20352     OR  WS-LDA-RRIF-FLAG  EQUAL TO  "G"
283580161024R10207     OR  WS-LDA-RRIF-FLAG  EQUAL TO  "A"
283590980624               CLOSE           ACCOUNT-RRIF.
283600980624      *****
283610980624      *****    If Duplicate Mailing is applicable, close the required
283620980624      *****    files.
283630990628      *****
283640991123           IF  WS-LDA-DUP-MAIL   EQUAL TO  "Y"
283650991123               CLOSE           MAIL-LIST-DETAILS
283660991123                               MAIL-LIST-HEADER.
283670991123980402     IF  WS-LDA-ROR-FLAG = "Y"
283680991123980402         CLOSE           TRANS-Y
283690000830980402                         TRANS-Z.
283700000830156507     IF  LC-LDASECTION79  = "Y"
283710000830156507         CLOSE           TRANS-I
283720000830156507         IF WS-LDA-ROR-FLAG NOT = "Y"
283730000830156507            CLOSE        TRANS-Z
283740000830156507     END-IF.
283750000830      *****
283760001017      *****    If processing GGF, close the Transaction Currency Unit
283770001017      *****    Cost file.
283780001017      *****
283790001017           CLOSE           TRANS-CURRENCY-UNIT-COST.
283800001017      *****
283810001020      *****    If section 30 and 35 were opened close the files
283820001021      *****
283830001017RF5148     CLOSE           ROR-PERIOD-CODES
283840001017RF5148                     ROR-PERIOD-DESCRIPTION.
283850001021      *****
283860001017      *****    If ACCOUNT-GIC-DETAILS are to be produced, close the
283870001018      *****    required files.
283880090610      *****
283890001018RF6697     IF WS-LDA-GIC-25     EQUAL TO  "Y"
283900001020              CLOSE            GIC-CERTIFICATE-DETAILS
283910001020           END-IF.
283920001025      *****
283930041229      *****    Close the Input files for SEG
283940001025      *****
283950001020           IF WS-LDA-SEG-40         = "Y"
283960151205           OR WS-LDA-SEG-43         = "Y"
283970151205           OR WS-LDA-SEG-45         = "Y"
283980151205           OR WS-LDA-SEG-90         = "Y"
283990151205              CLOSE            ACCOUNT-CONTRACT
284000151205                               ACCOUNT-CONTRACT-INVESTMENT
284010001020                               ACCOUNT-CONTRACT-INV-RESET
284020020417                               INVESTMENT-SEG
284030020417                               GUAR-DEATH-SCHED
284040020417R57388                         GUAR-DEATH-CRITERIA-SCHED
284050020417                               GUAR-MATURITY-SCHED
284060020417                               ACCOUNT-CONTRACT-ANNUITANT
284070070508                               ACCOUNT-ANNUITANT
284080110531                               TRANS-CONTRACT-DETAILS
284090110531R25469                         TRANS-C
284100070508                               ALLOWABLE-RESET-SCHED
284110070508           END-IF.
284120070508      *RFS151145 Start
284130991123           IF lb-LdaAccountAdditionalInfoYes
284140000000              CLOSE                      ACCOUNT-XREF2
284150000000           END-IF.
284160991123      *RFS151145 End
284170000000
284180000000R13017     IF WS-ADHOC-B-FLAG          = 0
284190000000              CLOSE                      CURRENCY-CODE
284200000000                                         INVESTMENT-GROUP
284210000000R13017     END-IF.
284220000000
284230000000      * RFS 38639 - begins.
284240200710R63488*    IF WS-LDA-SEG-90 = "Y" AND Edit-GbvRst
284250200710      *RFS 1098681 Begin
284260200710R63488*    IF WS-LDA-SEG-90 = "Y"
284270200710           IF Edit-GbvRst OR lc_SegGLWBYes
284280980205      *RFS 1098681 End
284290980203              EXEC SQL  DROP TABLE QTEMP/TMPSTMEXP END-EXEC
284300980203           END-IF.
284310980203      * RFS 38639 - ends.
284320980203      **********
284330980203       EOJ-EXIT.
284340980203           EXIT.
284350980203      **********
284360980203      /
284370980205       DUMP-ROUTINE.
284380980211      ******************************************************************
284390030107      *                                                                *
284400980211      *    D U M P   R O U T I N E                                     *
284410980203      *                                                                *
284420980203      ******************************************************************
284430980203           CALL "QLREXHAN" USING DUMP-ARGUMENTS.
284440980209      /
284450980209       PRINT-RTN.
284460980209      *********************************************************
284470980209      *                                                       *
284480980209      *    P R I N T    R O U T I N E                         *
284490980209      *********************************************************
284500980209           IF WS-LINE-CNT IS GREATER THAN 60
284510980306              PERFORM HEADING-RTN THRU HR-EXIT
284520980209           END-IF
284530980209           WRITE PRINT-REC FROM DETAIL-LINE1
284540980209             AFTER ADVANCING WS-SKIP-LN.
284550980211           MOVE SPACES TO DETAIL-LINE1.
284560980211           ADD WS-SKIP-LN TO WS-LINE-CNT.
284570980211
284580980211       PR-EXIT.
284590031007           EXIT.
284600031007      /
284610031007       CONTROL-WRITE.
284620031007      ***********************************************************
284630031007      *                                                         *
284640980211      *    CONTROL  REPORT  WRITE  ROUTINE                      *
284650980211      ***********************************************************
284660980211      ****
284670980211      **** WRITE CONTROL REPORT FOR DAILY CONFIRM HOLD MAIL
284680980211      **** AS WELL AS SUPPRESS CONFIRMS FOR BOTH DAILY AND DUPLICATE
284690980211      ****
284700980211           MOVE SPACES                       TO DETAIL-LINE1.
284710980209           MOVE ACIVRNO OF INVESTOR-JOIN     TO DTL1-INVESTOR-NO-CTL.
284720030131           MOVE IVLEGALNM OF INVESTOR-JOIN   TO DTL1-LEGAL-NAME-CTL.
284730030131           MOVE ACACTNO OF INVESTOR-JOIN     TO DTL1-ACCOUNT-NO-CTL.
284740030203           MOVE WS-IC-CODE(IC)               TO DTL1-IC-CODE-CTL.
284750030107           IF WS-IC-NAME-FLAG = "F"
284760981127              MOVE WS-IC-NAME-F(IC)      TO DTL1-IC-NAME-CTL
284770981127           ELSE
284780981127              MOVE WS-IC-NAME-E(IC)      TO DTL1-IC-NAME-CTL
284790981127           END-IF.
284800981127           MOVE WS-IC-CURR(IC)               TO DTL1-IC-CURR-CTL.
284810981127           MOVE PLACEMENT-DATE OF TRANS-REC
284820980304                                         TO  DTL1-PLACEMENT-DATE-CTL.
284830981127           MOVE TRANS-NO OF TRANS-REC        TO DTL1-TRANS-NO-CTL.
284840981127           MOVE TRANS-TYPE-CODE OF TRANS-REC
284850981127                                         TO  DTL1-TRANS-TYPE-CODE-CTL.
284860981127           MOVE ENTERED-BY OF TRANS-REC      TO DTL1-ENTERED-BY-CTL.
284870980304
284880980304R14871     MOVE ACIVRNO OF INVESTOR-JOIN     TO WS-ACIVRNO-TEMP.
284890980210R14871     MOVE ACACTNO OF INVESTOR-JOIN     TO WS-ACACTNO-TEMP.
284900980209R14871     MOVE TRANS-NO OF TRANS-REC        TO WS-TRANSNO-TEMP.
284910980209
284920980209           IF HOLD-MAIL OF ADDRESS-RECD = "Y"
284930990823              AND WS-LDA-STMT-CNFM-FLAG = "C"
284940990823                AND WS-LDA-CNFM-DUP-FLAG = "N"
284950990823              ADD 1                TO WS-HOLDMAIL-CNT
284960990823              MOVE "HOLD MAIL "    TO DTL1-REASON-CTL
284970990823              GO TO CW-0001.
284980990823
284990990823           IF SUPPRESS-CONFIRMATION OF TRANS-REC = "Y"
285000990823              IF WS-LDA-STMT-CNFM-FLAG = "C"
285010990823              ADD 1                TO WS-SUPPRESS-CNT
285020990823              MOVE "SUPPRESSED"    TO DTL1-REASON-CTL.
285030990823
285040990823       CW-0001.
285050990823           PERFORM PRINT-RTN       THRU PR-EXIT.
285060990823
285070990823       CW-EXIT.
285080990823           EXIT.
285090990823      /
285100990823       FORMAT-ASSET-CLASS-RTN.
285110990823      *****
285120990823      *****    Format and create the records specifically for PHN.
285130990823      *****
285140990823       FACR-0020.
285150990823           IF  AC         IS GREATER THAN  WS-AC-LST
285160990823               GO TO FACR-0030.
285170990823
285180990823           IF  WS-AC-CODE (AC)
285190990823                          IS NOT EQUAL TO  "MMKT  "
285200990823               SET AC               UP BY  1
285210990823               GO TO FACR-0020.
285220020321
285230990823           IF  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
285240990823               GO TO FACR-0030.
285250031003
285260031003           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
285270031003           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
285280031003           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
285290060621           MOVE 15                     TO  AC-SECTION-NO.
285300030826           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
285310030826           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
285320990823           MOVE AD-DEALER              TO  AC-DEALER.
285330990823           MOVE AD-SALESREP            TO  AC-SALESREP.
285340990823           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
285350990823           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
285360990823           MOVE WS-AC-VAL (AC)         TO  AC-MARKET-VALUE.
285370990823           MOVE WS-AC-PCT (AC)         TO  AC-PERCENTAGE.
285380990823           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
285390990823           MOVE PREV-END-DATE          TO  AC-END-DATE.
285400990823
285410990823R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
285420990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
285430990823R17527     END-IF.
285440990823
285450990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
285460990823R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
285470990823
285480990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
285490990823       FACR-0030.
285500990823           SET AC                      TO  1.
285510990823       FACR-0040.
285520990823           IF  AC         IS GREATER THAN  WS-AC-LST
285530990823               GO TO FACR-0050.
285540990823
285550990823           IF  WS-AC-CODE (AC)
285560990823                          IS NOT EQUAL TO  "BOND  "
285570990823               SET AC               UP BY  1
285580990823               GO TO FACR-0040.
285590020321
285600990823           IF  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
285610990823               GO TO FACR-0050.
285620031003
285630031003           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
285640031003           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
285650031003           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
285660060621           MOVE 15                     TO  AC-SECTION-NO.
285670030826           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
285680030826           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
285690990823           MOVE AD-DEALER              TO  AC-DEALER.
285700990823           MOVE AD-SALESREP            TO  AC-SALESREP.
285710990823           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
285720990823           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
285730990823           MOVE WS-AC-VAL (AC)         TO  AC-MARKET-VALUE.
285740990823           MOVE WS-AC-PCT (AC)         TO  AC-PERCENTAGE.
285750990823           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
285760990823           MOVE PREV-END-DATE          TO  AC-END-DATE.
285770990823
285780990823R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
285790990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
285800990823R17527     END-IF.
285810990823
285820990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
285830990823R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
285840990823
285850990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
285860990823       FACR-0050.
285870990823           SET AC                      TO  1.
285880990823
285890990823       FACR-0060.
285900990823           IF  AC         IS GREATER THAN  WS-AC-LST
285910990823               GO TO FACR-EXIT.
285920990823
285930990823           IF  WS-AC-CODE (AC)
285940990823                          IS NOT EQUAL TO  "EQUITY"
285950990823               SET AC               UP BY  1
285960990823               GO TO FACR-0060.
285970020321
285980990823           IF  WS-AC-VAL (AC) IS EQUAL TO  ZEROES
285990990823               GO TO FACR-EXIT.
286000031003
286010031003           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
286020031003           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
286030031003           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
286040060621           MOVE 15                     TO  AC-SECTION-NO.
286050030826           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
286060030826           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
286070990823           MOVE AD-DEALER              TO  AC-DEALER.
286080990823           MOVE AD-SALESREP            TO  AC-SALESREP.
286090990823           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
286100990823           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
286110990823           MOVE WS-AC-VAL (AC)         TO  AC-MARKET-VALUE.
286120990823           MOVE WS-AC-PCT (AC)         TO  AC-PERCENTAGE.
286130990823           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
286140990823           MOVE PREV-END-DATE          TO  AC-END-DATE.
286150040107
286160990823R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
286170990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
286180990823R17527     END-IF.
286190990823
286200040107R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
286210990823R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
286220990823
286230990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
286240990823
286250990823           SET ACS                     TO  1.
286260990823
286270990823       FACR-0070.
286280990823           IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
286290990823               GO TO FACR-0080.
286300990823
286310990823R20205     IF  WS-ACS-CODE (AC, ACS)
286320990823                          IS NOT EQUAL TO  "CNEQ  "
286330990823               SET ACS              UP BY  1
286340040107               GO TO FACR-0070.
286350040107
286360990823R20205     IF  WS-ACS-VAL (AC, ACS)
286370990823                              IS EQUAL TO  ZEROES
286380040107               GO TO FACR-0080.
286390040107
286400020321           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
286410990823           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
286420990823           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
286430030910           MOVE 15                     TO  AC-SECTION-NO.
286440040107           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
286450040107           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
286460040107           MOVE AD-DEALER              TO  AC-DEALER.
286470030910           MOVE AD-SALESREP            TO  AC-SALESREP.
286480030910           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
286490030910           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
286500030910R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  AC-ASSET-SUBCLASS-CODE.
286510031003R20205     MOVE WS-ACS-DESC (AC, ACS, ACSL)
286520031003                                       TO
286530031003                                       AC-ASSET-SUBCLASS-DESCRIPTION.
286540031003R20205     MOVE WS-ACS-VAL (AC, ACS)   TO  AC-MARKET-VALUE.
286550060621R20205     MOVE WS-ACS-PCT (AC, ACS)   TO  AC-PERCENTAGE.
286560030826           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
286570030826           MOVE PREV-END-DATE          TO  AC-END-DATE.
286580990823
286590990823R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
286600990823R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
286610990823R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
286620990823R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
286630990823  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
286640990823  v           PERFORM GET-TARGET-MIX-PERCENTAGE       THRU GTMP-EXIT
286650990823R16511     END-IF.
286660990823
286670040107R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
286680990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
286690990823R17527     END-IF.
286700990823
286710990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
286720040107R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
286730990823
286740990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
286750990823
286760990823       FACR-0080.
286770990823           SET ACS                     TO  1.
286780990823
286790990823       FACR-0090.
286800990823           IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
286810990823               GO TO FACR-0100.
286820990823
286830990823R20205     IF  WS-ACS-CODE (AC, ACS)
286840990823                          IS NOT EQUAL TO  "USEQ  "
286850990823               SET ACS              UP BY  1
286860040107               GO TO FACR-0090.
286870040107
286880990823R20205     IF  WS-ACS-VAL (AC, ACS)
286890990823                              IS EQUAL TO  ZEROES
286900040107               GO TO FACR-0100.
286910040107
286920020321           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
286930990823           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
286940990823           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
286950030910           MOVE 15                     TO  AC-SECTION-NO.
286960040107           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
286970040107           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
286980040107           MOVE AD-DEALER              TO  AC-DEALER.
286990030910           MOVE AD-SALESREP            TO  AC-SALESREP.
287000030910           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
287010030910           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
287020030910R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  AC-ASSET-SUBCLASS-CODE.
287030031003R20205     MOVE WS-ACS-DESC (AC, ACS, ACSL)
287040031003                                       TO
287050031003                                       AC-ASSET-SUBCLASS-DESCRIPTION.
287060031003R20205     MOVE WS-ACS-VAL (AC, ACS)   TO  AC-MARKET-VALUE.
287070060621R20205     MOVE WS-ACS-PCT (AC, ACS)   TO  AC-PERCENTAGE.
287080030826           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
287090030826           MOVE PREV-END-DATE          TO  AC-END-DATE.
287100990823
287110990823R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
287120990823R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
287130990823R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
287140990823R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
287150990823  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
287160990823  v           PERFORM GET-TARGET-MIX-PERCENTAGE       THRU GTMP-EXIT
287170990823R16511     END-IF.
287180990823
287190040107R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
287200990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
287210990823R17527     END-IF.
287220990823
287230990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
287240040107R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
287250990823
287260990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
287270990823
287280990823       FACR-0100.
287290990823           SET ACS                     TO  1.
287300990823
287310990823       FACR-0100-0010.
287320990823           IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
287330990823               GO TO FACR-0100-0020.
287340990823
287350990823R20205     IF  WS-ACS-CODE (AC, ACS)
287360990823                          IS NOT EQUAL TO  "MXEQ  "
287370990823               SET ACS              UP BY  1
287380040107               GO TO FACR-0100-0010.
287390040107
287400990823R20205     IF  WS-ACS-VAL (AC, ACS)
287410990823                              IS EQUAL TO  ZEROES
287420040107               GO TO FACR-0100-0020.
287430040107
287440020321           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
287450990823           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
287460990823           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
287470030910           MOVE 15                     TO  AC-SECTION-NO.
287480040107           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
287490040107           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
287500040107           MOVE AD-DEALER              TO  AC-DEALER.
287510030910           MOVE AD-SALESREP            TO  AC-SALESREP.
287520030910           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
287530030910           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
287540030910R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  AC-ASSET-SUBCLASS-CODE.
287550031003R20205     MOVE WS-ACS-DESC (AC, ACS, ACSL)
287560031003                                       TO
287570031003                                       AC-ASSET-SUBCLASS-DESCRIPTION.
287580031003R20205     MOVE WS-ACS-VAL (AC, ACS)   TO  AC-MARKET-VALUE.
287590060621R20205     MOVE WS-ACS-PCT (AC, ACS)   TO  AC-PERCENTAGE.
287600030826           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
287610030826           MOVE PREV-END-DATE          TO  AC-END-DATE.
287620990823
287630990823R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
287640990823R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
287650990823R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
287660990823R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
287670990823  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
287680990823  v           PERFORM GET-TARGET-MIX-PERCENTAGE       THRU GTMP-EXIT
287690990823R16511     END-IF.
287700040107
287710990823R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
287720990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
287730990823R17527     END-IF.
287740040107
287750990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
287760990823R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
287770990823
287780990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
287790990823
287800990823       FACR-0100-0020.
287810990823           SET ACS                     TO  1.
287820990823
287830990823       FACR-0110.
287840990823           IF  ACS        IS GREATER THAN  WS-AC-SLST (AC)
287850990823               GO TO FACR-0120.
287860990823R20205     IF  WS-ACS-CODE (AC, ACS)
287870990823                          IS NOT EQUAL TO  "INEQ  "
287880040107               SET ACS              UP BY  1
287890040107               GO TO FACR-0110.
287900990823R20205     IF  WS-ACS-VAL (AC, ACS)
287910990823                              IS EQUAL TO  ZEROES
287920040107               GO TO FACR-0120.
287930040107
287940020321           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
287950990823           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
287960990823           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
287970030910           MOVE 15                     TO  AC-SECTION-NO.
287980040107           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
287990040107           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
288000040107           MOVE AD-DEALER              TO  AC-DEALER.
288010030910           MOVE AD-SALESREP            TO  AC-SALESREP.
288020030910           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
288030030910           MOVE WS-AC-DESC (AC, ACL)   TO  AC-ASSET-CLASS-DESCRIPTION.
288040030910R20205     MOVE WS-ACS-CODE (AC, ACS)  TO  AC-ASSET-SUBCLASS-CODE.
288050031003R20205     MOVE WS-ACS-DESC (AC, ACS, ACSL)
288060031003                                       TO
288070031003                                       AC-ASSET-SUBCLASS-DESCRIPTION.
288080031003R20205     MOVE WS-ACS-VAL (AC, ACS)   TO  AC-MARKET-VALUE.
288090060621R20205     MOVE WS-ACS-PCT (AC, ACS)   TO  AC-PERCENTAGE.
288100030826           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
288110030826           MOVE PREV-END-DATE          TO  AC-END-DATE.
288120990823
288130990823R16511     IF WS-LDA-SECTION-17           IS EQUAL TO  "Y"
288140990823R16511        MOVE WS-AC-CODE (AC)        TO WS-ASSET-CLASS-CODE
288150990823R20205        MOVE WS-ACS-CODE (AC, ACS)  TO WS-ASSET-SUB-CLASS-CODE
288160990823R16511        MOVE WS-IPS-CONS-ACCT-ID    TO WS-CONS-ACCT-ID
288170990823  ¦           MOVE WS-IPS-EFFECTIVE-DATE  TO WS-EFFECTIVE-DATE
288180990823  v           PERFORM GET-TARGET-MIX-PERCENTAGE       THRU GTMP-EXIT
288190990823R16511     END-IF.
288200990823
288210990823R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
288220990823   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
288230990823R17527     END-IF.
288240990823
288250990823R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
288260990823R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
288270990823
288280990823           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
288290990823
288300020321       FACR-0120.
288310990823           INITIALIZE ACCOUNT-ASSET-CLASS-SECTION.
288320990823           MOVE PREV-INVESTOR          TO  AC-INVESTOR-NO.
288330031003           MOVE PREV-ACCOUNT           TO  AC-ACCOUNT.
288340031003           MOVE 15                     TO  AC-SECTION-NO.
288350031003           MOVE WS-AC-SECTION-SEQUENCE TO  AC-SECTION-SEQUENCE.
288360031003           MOVE AD-LANGUAGE            TO  AC-LANGUAGE.
288370060621           MOVE AD-DEALER              TO  AC-DEALER.
288380030826           MOVE AD-SALESREP            TO  AC-SALESREP.
288390030826           MOVE WS-AC-CODE (AC)        TO  AC-ASSET-CLASS-CODE.
288400990823           STRING "TOTAL "   DELIMITED BY  SIZE
288410991004                  WS-AC-DESC (AC, ACL)
288420990823                             DELIMITED BY  SIZE
288430990823                                     INTO  AC-ASSET-CLASS-DESCRIPTION.
288440991004           MOVE WS-AC-VAL (AC)         TO  AC-MARKET-VALUE.
288450140714           MOVE WS-AC-PCT (AC)         TO  AC-PERCENTAGE.
288460140714           MOVE WS-PREV-START-DATE        TO  AC-START-DATE.
288470140715           MOVE PREV-END-DATE          TO  AC-END-DATE.
288480140715
288490140715R17527     IF WS-LDA-IPS-STMT          IS EQUAL TO "Y"
288500140715   ¦          MOVE WS-IPS-GROUP-ID     TO AC-IPS-GROUP-ID
288510140715R17527     END-IF.
288520140715
288530140715R18147     MOVE ACCOUNT-ASSET-CLASS-SECTION TO STATEMENT-REC(ISR).
288540140715R18147     PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT.
288550140715
288560140715           ADD 1                       TO  WS-AC-SECTION-SEQUENCE.
288570140715      **********
288580140715       FACR-EXIT.
288590140715           EXIT.
288600140715      **********
288610140715      * RFS132121 - Starts
288620140719       GET-MKT-VALUE.
288630140719           IF lc_ASSETALLOCYes
288640140715              IF ln_CurrAccCode NOT = ln_PrevAccCode AND
288650140715                 ln_PrevAccCode NOT = ZEROES
288660140715                 PERFORM POPULATE-ASSETALLOC-DTL
288670140715                 INITIALIZE lc_InvMktVariables
288680140715                 SET MKT TO 1
288690140714              END-IF
288700981214
288710981214              IF ln_CurrAccCode NOT = ln_PrevAccCode  AND
288720991004                 ln_PrevAccCode     = ZEROES
288730981214                 INITIALIZE lc_InvMktVariables
288740981214                 SET MKT TO 1
288750031215              END-IF
288760031215              IF lc_CurrMktRec  NOT = lc_PrevMktRec
288770031215                 MOVE lc_CurrMktRec   TO lc_PrevMktRec
288780031215                 MOVE lc_CurrInvestor TO lc_PrevInvestor
288790031215                 MOVE ln_CurrAccCode  TO li-Account-No (MKT)
288800031215                 MOVE lc_CurrInvCode  TO lc-Investment-Code (MKT)
288810031215                 MOVE ln_MktValueBase TO li-Mkt-Value(MKT)
288820031215                 SET MKT UP BY 1
288830031215              END-IF
288840031215           END-IF.
288850031215      * RFS132121 - Ends
288860031215      /
288870031215       GENERATE-BENEFICIARY-REC.
288880031215
288890031215           MOVE SPACES                 TO  WS-BENEFICIARIES.
288900031215           INITIALIZE WS-BENEFICIARY-CNT.
288910031215
288920031215R19502*** Start
288930031215           IF WS-RESP-84                IS EQUAL TO  "Y"
288940031215              MOVE CURR-ACCOUNT TO WS-ACCOUNT-NO
288950031215           ELSE
288960031215              MOVE PREV-ACCOUNT TO WS-ACCOUNT-NO
288970031215           END-IF.
288980031215
288990031215       GBR-OPEN-ACCBENC1.
289000031215           MOVE "OPEN ACCBENC1 GBR" TO WS-SQLERR-STATEMENT.
289010031215           EXEC SQL
289020031215             OPEN ACCBENC1
289030031215           END-EXEC.
289040031215
289050031215       GBR-GET-ACCOUNT-BENEFICIARY.
289060031215           MOVE "FETCH ACCBENC1 GBR" TO WS-SQLERR-STATEMENT.
289070031215           EXEC SQL
289080031215            FETCH NEXT FROM ACCBENC1
289090031215            FOR :ACCBENMAX ROWS
289100031215            INTO :ABN-ACCBENC1-FIELDS
289110061027           END-EXEC.
289120061027
289130031215           IF SQLCODE > 0
289140031215            GO TO GBR-CLOSE-ACCBENC1
289150031215           END-IF.
289160031215
289170031215           COMPUTE WS-SQL-INDEX = 0.
289180031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3).
289190031215
289200031215       GBR-INCREMENT-WS-SQL-INDEX.
289210031215           ADD 1 TO WS-SQL-INDEX.
289220031215
289230031215           IF WS-SQL-INDEX > WS-SQL-ACTUAL
289240031215              GO TO GBR-GET-ACCOUNT-BENEFICIARY
289250031215           END-IF.
289260031215
289270031215           IF ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "A" AND
289280031215              ABN-BENEFICIARY-STATUS(WS-SQL-INDEX) NOT = "I"
289290981214              GO TO GBR-INCREMENT-WS-SQL-INDEX
289300981214           END-IF.
289310981214
289320981214           IF ABN-FIRST-NAME(WS-SQL-INDEX) IS EQUAL TO SPACES AND
289330981214              ABN-INITIALS(WS-SQL-INDEX) IS EQUAL TO SPACES   AND
289340981214              ABN-LAST-NAME(WS-SQL-INDEX) IS EQUAL TO SPACES
289350981214               GO TO GBR-INCREMENT-WS-SQL-INDEX
289360981214           END-IF.
289370981214
289380981214           ADD 1 TO WS-BENEFICIARY-CNT.
289390981214           IF WS-BENEFICIARY-CNT > 6
289400981214               GO TO GBR-CLOSE-ACCBENC1
289410981214           END-IF.
289420981214
289430981214           PERFORM FORMAT-BENEFICIARY-NAME THRU FBN-EXIT.
289440031215
289450031215           EVALUATE WS-BENEFICIARY-CNT
289460031215               WHEN 1
289470031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY1
289480031215               WHEN 2
289490031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY2
289500031215               WHEN 3
289510031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY3
289520031215               WHEN 4
289530031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY4
289540031215               WHEN 5
289550031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY5
289560031215               WHEN 6
289570031215                   MOVE WS-ADRTMP              TO  WS-BENEFICIARY6
289580031215           END-EVALUATE.
289590031215
289600031215           GO TO GBR-INCREMENT-WS-SQL-INDEX.
289610031215
289620031215       GBR-CLOSE-ACCBENC1.
289630981214           MOVE "CLOSE ACCBENC1 GBR" TO WS-SQLERR-STATEMENT.
289640981214           EXEC SQL
289650981214             CLOSE ACCBENC1
289660991004           END-EXEC.
289670010306
289680010228       GBR-COMPLETE.
289690010228           IF WS-BENEFICIARY-CNT = 0
289700010228               GO TO GBR-EXIT.
289710010228
289720010228           MOVE WS-BENEFICIARY1 TO RE-ACCOUNT-BENEFICIARY1.
289730010228           MOVE WS-BENEFICIARY2 TO RE-ACCOUNT-BENEFICIARY2.
289740120301           MOVE WS-BENEFICIARY3 TO RE-ACCOUNT-BENEFICIARY3.
289750120301           MOVE WS-BENEFICIARY4 TO RE-ACCOUNT-BENEFICIARY4.
289760010228           MOVE WS-BENEFICIARY5 TO RE-ACCOUNT-BENEFICIARY5.
289770010228           MOVE WS-BENEFICIARY6 TO RE-ACCOUNT-BENEFICIARY6.
289780010530R19502*** End
289790010530
289800010228       GBR-EXIT.
289810010228           EXIT.
289820010306      **********
289830010523RF9331 GENERATE-RESP-TYPE-REC.
289840010523
289850100408           INITIALIZE ACCOUNT-RESP-REC.
289860100408           MOVE PREV-ACCOUNT TO ACCOUNT-NO
289870100408                                    OF ACCOUNT-RESP-REC.
289880100408           READ ACCOUNT-RESP
289890100408               INVALID KEY
289900100408105133*            INITIALIZE ACCOUNT-RESP-REC
289910100408105133             INITIALIZE MFAACCESP of ACCOUNT-RESP-REC
289920100408                   MOVE SPACE TO RESP-TYPE-CODE OF
289930100408                                     ACCOUNT-RESP-REC
289940100408RF9909             MOVE ZEROS TO PLAN-SETUP-DATE OF
289950100408                                     ACCOUNT-RESP-REC
289960100408           END-READ
289970100408
289980100408           MOVE RESP-TYPE-CODE OF ACCOUNT-RESP-REC TO RE-RESP-TYPE.
289990100408rf9909     MOVE PLAN-SETUP-DATE OF ACCOUNT-RESP-REC
290000100408                               TO RE-PLAN-SETUP-DATE.
290010100408      *RFS76998 Begin
290020100408           MOVE ASSISTED-CAPITAL OF ACCOUNT-RESP-REC TO Ld-amt.
290030100408           IF ld-amt >= 0
290040100408              MOVE Ld-amt TO RE-ASSISTED-CAPITAL
290050100408              MOVE ' '    TO RE-ASSISTED-CAPITAL-IND
290060100408           ELSE
290070100408              COMPUTE RE-ASSISTED-CAPITAL = LD-AMT * -1
290080100408              MOVE '-'    TO RE-ASSISTED-CAPITAL-IND
290090100408           END-IF.
290100100408
290110100408           MOVE UNASSISTED-CAPITAL OF ACCOUNT-RESP-REC TO Ld-amt.
290120100408           IF ld-amt >= 0
290130100408              MOVE Ld-amt TO RE-UNASSISTED-CAPITAL
290140100408              MOVE ' '    TO RE-UNASSISTED-CAPITAL-IND
290150100408           ELSE
290160100408              COMPUTE RE-UNASSISTED-CAPITAL = LD-AMT * -1
290170100408              MOVE '-'    TO RE-UNASSISTED-CAPITAL-IND
290180100408           END-IF.
290190100408
290200100408           MOVE TOTAL-CESG OF ACCOUNT-RESP-REC TO Ld-amt.
290210170508           IF ld-amt >= 0
290220170510              MOVE Ld-amt TO RE-NET-CESG
290230170508              MOVE ' '    TO RE-NET-CESG-IND
290240170508           ELSE
290250170508              COMPUTE RE-NET-CESG = LD-AMT * -1
290260170508              MOVE '-'    TO RE-NET-CESG-IND
290270170508           END-IF.
290280170508
290290170508           MOVE TOTAL-CLB OF ACCOUNT-RESP-REC TO Ld-amt.
290300170509           IF ld-amt >= 0
290310100408              MOVE Ld-amt TO RE-NET-CLB
290320170508              MOVE ' '    TO RE-NET-CLB-IND
290330170508           ELSE
290340170508              COMPUTE RE-NET-CLB = LD-AMT * -1
290350170508              MOVE '-'    TO RE-NET-CLB-IND
290360170508           END-IF.
290370170508
290380170508      *RFS163106 Begin
290390170508           MOVE TOTAL-SAGES OF ACCOUNT-RESP-REC TO Ld-amt.
290400170508           IF ld-amt >= 0
290410170508              MOVE Ld-amt TO RE-NET-SAGES
290420100408              MOVE ' '    TO RE-NET-SAGES-IND
290430170510           ELSE
290440100408              COMPUTE RE-NET-SAGES = LD-AMT * -1
290450100408              MOVE '-'    TO RE-NET-SAGES-IND
290460100408           END-IF.
290470100409
290480100409           MOVE TOTAL-BCTESG OF ACCOUNT-RESP-REC TO Ld-amt.
290490100408           IF ld-amt >= 0
290500100409              MOVE Ld-amt TO RE-NET-BCTESG
290510100409              MOVE ' '    TO RE-NET-BCTESG-IND
290520100409           ELSE
290530100409              COMPUTE RE-NET-BCTESG = LD-AMT * -1
290540100409              MOVE '-'    TO RE-NET-BCTESG-IND
290550100409           END-IF.
290560100409      *RFS163106 End
290570100409
290580100409           MOVE 0 TO Ld-amt.
290590100408           EXEC SQL
290600010228                 SELECT sum(ACBIRP.LTD_NET_IQEE_RECEIVED)
290610110207                 INTO :Ld-amt:IND9
290620110207                 FROM MFAACBIRP ACBIRP
290630150908                 WHERE  ACBIRP.ACCOUNT_NO = :PREV-ACCOUNT AND
290640150908                        ACBIRP.YEAR = :Ld-year
290650110207           END-EXEC
290660110207
290670110207           IF ld-amt >= 0
290680110207              MOVE Ld-amt TO RE-NET-IQEE
290690110207              MOVE ' '    TO RE-NET-IQEE-IND
290700110207           ELSE
290710110207              COMPUTE RE-NET-IQEE = LD-AMT * -1
290720160201              MOVE '-'    TO RE-NET-IQEE-IND
290730110207           END-IF.
290740010228
290750010306      *RFS76998 End
290760010228      **********
290770010228      *RFS 84980 starts
290780010228           MOVE Total-PGrant OF ACCOUNT-RESP-REC TO Ld-amt.
290790010704146193     ADD  TOTAL-SAGES OF ACCOUNT-RESP-REC TO Ld-amt.
290800010704146193     ADD  TOTAL-BCTESG OF ACCOUNT-RESP-REC TO Ld-amt.
290810010704           IF ld-amt >= 0
290820010704              MOVE Ld-amt TO RE-NET-PGRANT
290830010704              MOVE ' '    TO RE-NET-PGRANT-IND
290840010704           ELSE
290850010704              COMPUTE RE-NET-PGRANT = LD-AMT * -1
290860010704              MOVE '-'    TO RE-NET-PGRANT-IND
290870010704           END-IF.
290880010704148326     PERFORM RESP-TYPE-REC-DETAILS THRU RTRD-EXIT.
290890010704      *RFS 84980 starts
290900010704
290910010704       GRTR-EXIT.
290920010704            EXIT.
290930010704RF9331**********
290940010704
290950010716R10362 GEN-PAY-FREQ-AND-OPTION-DESCR.
290960010716
290970010716           INITIALIZE FREQUENCY-CODES-LANG-REC.
290980010704           MOVE AW-PAYMENT-FREQUENCY TO FREQUENCY-CODE
290990010704                                    OF FREQUENCY-CODES-LANG-REC.
291000010704           MOVE AW-LANGUAGE TO LANGUAGE-CODE
291010010704                                    OF FREQUENCY-CODES-LANG-REC.
291020010704           READ FREQUENCY-CODES-LANG
291030010704               INVALID KEY
291040010704                   INITIALIZE FREQUENCY-CODES-LANG-REC
291050010704           END-READ
291060010704
291070010704           MOVE FREQUENCY-DESCR OF FREQUENCY-CODES-LANG-REC
291080010704                                   TO AW-PAY-FREQ-DESCR.
291090010704
291100981214           INITIALIZE PAYMENT-TYPE-LANG-REC.
291110981214           MOVE AWD-PAYMENT-TYPE OF ACCOUNT-AWD-REC TO
291120031215                PAYMENT-TYPE-CODE OF PAYMENT-TYPE-LANG-REC.
291130031215           MOVE AW-LANGUAGE TO LANGUAGE-CODE
291140031215                                   OF PAYMENT-TYPE-LANG-REC.
291150031215           READ PAYMENT-TYPE-LANG
291160031215               INVALID KEY
291170090309                   INITIALIZE PAYMENT-TYPE-LANG-REC
291180090309           END-READ
291190090309
291200090309           MOVE PAYMENT-TYPE-CODE-DESCR OF PAYMENT-TYPE-LANG-REC
291210090309                                   TO AW-PAY-OPTION-DESCR.
291220090305      **********
291230090309       GPFOD-EXIT.
291240090309            EXIT.
291250090309R10362**********
291260090305      /
291270090506       FORMAT-BENEFICIARY-NAME.
291280160201
291290090305R19502*** Start
291300031215           MOVE SPACES TO WS-ADRTMP.
291310031215           MOVE SPACES TO WS-ACCOUNT-BENEFICIARY.
291320990517
29133001110166105      Initialize pt-StreetAddressAction, pt-StreetAddressIn.
29134001110166105      Set pb-adrName to True.
29135003111766105      Move ABN-FIRST-NAME(WS-SQL-INDEX)       to pc-InFirstName.
29136003111766105      Move ABN-INITIALS(WS-SQL-INDEX)         to pc-InInitial.
29137003111766105      Move ABN-LAST-NAME(WS-SQL-INDEX)        to pc-InLastName.
291380031117
29139003111766105      Call "FXSTRTADR" using pt-StreetAddressAction,
29140003111766105                             pt-StreetAddressIn,
29141003111766105                             pt-StreetAddressOut.
29142001110166105
29143001110166105      Move pc-OutName(1:45) To WS-ACCOUNT-BENEFICIARY.
29144001110169424      Move pc-OutName(1:50) To ws-adrtmp.
291450011101
291460011101       FBN-EXIT.
291470011101           EXIT.
291480011101      /
291490011101       FIND-MARKET-VALUE-LAST-YEND.
291500011101
291510011101R18643     MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
291520011101   ¦                                 TO WS-PRICE-INVESTMENT-CODE.
291530011101   ¦       MOVE WS-PRV-Y-END-DATE    TO WS-PRICE-TRADE-DATE.
291540011101   ¦       PERFORM GET-INVESTMENT-UNIT-PRICE-RTE THRU GIUPR-EXIT.
291550011101   ¦       MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
291560011101   v                                  TO WS-UNIT-PRICE-LAST-YEND.
291570011101R18643     GO TO FMVLY-EXIT.
291580011101           MOVE "N" TO WS-RE-READ-FLAG.
291590011101           INITIALIZE INVESTMENT-PRICE-REC.
291600011101           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
291610011101                TO INVESTMENT-CODE OF INVESTMENT-PRICE-REC.
291620011101           MOVE WS-PRV-Y-END-DATE
291630011101                TO TRADE-DATE OF INVESTMENT-PRICE-REC.
291640011101           MOVE "Y" TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
291650011101
291660011101           READ INVESTMENT-UNIT-PRICE
291670011101                 INVALID KEY
291680011101                   MOVE "Y" TO WS-RE-READ-FLAG.
291690011101
291700011101           IF WS-RE-READ-FLAG IS NOT EQUAL TO "Y"
291710011101              MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
291720011101                              TO WS-UNIT-PRICE-LAST-YEND
291730011101              GO TO FMVLY-EXIT.
291740011101
291750011101           INITIALIZE INVESTMENT-PRICE-REC.
291760011101           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
291770011101                    TO INVESTMENT-CODE OF INVESTMENT-PRICE-REC.
291780011101           MOVE WS-PRV-Y-END-DATE
291790011101                    TO TRADE-DATE OF INVESTMENT-PRICE-REC.
291800011101           MOVE " " TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
291810011101
291820011101           READ INVESTMENT-UNIT-PRICE
291830011101                 INVALID KEY
291840011101R11562             GO TO FMVLY-0010
291850011101           END-READ.
291860011101
291870011101           MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
291880011101                              TO WS-UNIT-PRICE-LAST-YEND.
291890011101           GO TO FMVLY-EXIT.
291900011101
291910011101R11562 FMVLY-0010.
291920011101
291930011101           INITIALIZE INVESTMENT-PRICE-REC.
291940011101           MOVE INVESTMENT-CODE OF ACCOUNT-INVESTMENT
291950011101                    TO INVESTMENT-CODE OF INVESTMENT-PRICE-REC.
291960011101           MOVE WS-PRV-Y-END-DATE
291970011101                    TO TRADE-DATE OF INVESTMENT-PRICE-REC.
291980011101
291990011101           START INVESTMENT-UNIT-PRICE
292000011101               KEY        IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
292010011101               INVALID KEY
292020011101                   MOVE ZEROES TO WS-UNIT-PRICE-LAST-YEND
292030011101                   GO TO FMVLY-EXIT
292040011101           END-START.
292050011101
292060011101           GO TO FMVLY-0020.
292070011101
292080011101       FMVLY-0020.
292090011101
292100011101           READ INVESTMENT-UNIT-PRICE PRIOR RECORD
292110080219                AT END
292120011101                  MOVE ZEROES TO UNIT-PRICE  OF INVESTMENT-UNIT-PRICE
292130011101                  MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
292140011101                                      TO WS-UNIT-PRICE-LAST-YEND
292150011101                  GO TO FMVLY-EXIT
292160011101           END-READ.
292170991004
292180990517       FMVLY-0030.
292190990517
292200991004           IF  INVESTMENT-CODE OF INVESTMENT-PRICE-REC IS NOT EQUAL TO
292210981215                    INVESTMENT-CODE OF ACCOUNT-INVESTMENT-REC
292220981215               MOVE ZEROES  TO  UNIT-PRICE OF INVESTMENT-PRICE-REC
292230991004           END-IF.
292240051004
292250051004           IF  TRADE-DATE  OF INVESTMENT-PRICE-REC
292260051004                          IS GREATER THAN  WS-PRV-Y-END-DATE
29227005100442749          OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
292280051004               GO TO FMVLY-0020
292290051004           END-IF.
292300051004
292310051004           MOVE UNIT-PRICE OF INVESTMENT-PRICE-REC
292320051004R11562                                TO WS-UNIT-PRICE-LAST-YEND.
292330051004      **********
292340051004       FMVLY-EXIT.
292350051004           EXIT.
292360051004      **********
292370051004      /
292380051004       GEN-CURR-YEAR-RESP.
292390051004
292400051004R14153     IF TRANS-TYPE-CODE OF TRANS-REC IS NOT EQUAL TO
292410051004  ¦           "TRI" AND "BUY" AND "SWI"
292420051004  ¦           GO TO GCYR-EXIT
292430051004  ¦        END-IF
292440051004  ¦
292450051004  ¦        IF CONTR-REDEM-CODE OF TRANS-REC IS NOT EQUAL TO "RESPCA"
292460051004  ¦           AND "RESPGC" AND "RESPGA"
292470051004  ¦           GO TO GCYR-EXIT
292480051004  ¦        END-IF
292490051004  ¦
292500991004  ¦        IF CONTR-REDEM-CODE OF TRANS-REC IS EQUAL TO "RESPGC"
292510981215  ¦        OR CONTR-REDEM-CODE OF TRANS-REC IS EQUAL TO "RESPGA"
292520981215  ¦           GO TO GCYR-RESPGC-AMT-CALC
292530991004  ¦        END-IF
292540981215  ¦
292550990329  ¦        IF TRADE-DATE OF TRANS-REC IS LESS THAN WS-YTDSTRDTE
292560991108  ¦           ADD GROSS-AMT OF TRANS-REC TO WS-RE-PREV-YEAR-CONTRIB
292570991108  ¦        ELSE
292580991108  ¦           ADD GROSS-AMT OF TRANS-REC TO WS-RE-CURR-YEAR-CONTRIB
292590000420  ¦        END-IF
292600000420  ¦
292610991108  ¦        GO TO GCYR-EXIT.
292620991108  ¦
292630991108  ¦    GCYR-RESPGC-AMT-CALC.
292640991108  v
292650991108R14153     ADD GROSS-AMT OF TRANS-REC TO WS-RE-CES-GRANT-AMOUNT.
292660991108      **********
292670991108       GCYR-EXIT.
292680991108           EXIT.
292690991108      **********
292700991108      /
292710991108       GET-USER-ENTERED.
292720991108      *****
292730991108      *****    Retrieve the User ID.
292740991108      *****
292750991108           IF TRANS-ORIGIN-CODE OF TRANS-REC = "DIR"
292760990329RF6370        OR "TRK"
292770990330              MOVE ENTERED-BY OF TRANS-REC TO WS-ENTERED-BY
292780990330           ELSE
292790990619              MOVE TRANS-ORIGIN-CODE OF TRANS-REC
292800170620                              TO WS-ENTERED-BY
292810170620           END-IF.
292820170621
292830170620           IF IS-ENTERED-BY EQUAL TO SPACES
292840170620              MOVE WS-ENTERED-BY    TO IS-ENTERED-BY
292850170620           ELSE
292860170620             MOVE IS-ENTERED-BY      TO WS-IS-ENTERED-BY
292870170620             IF WS-IS-ENTERED-BY-3  NOT EQUAL TO WS-LDA-MGMT-COM-CDE
292880170620                AND WS-ENTERED-BY-3 EQUAL TO WS-LDA-MGMT-COM-CDE
292890170620                MOVE WS-ENTERED-BY TO IS-ENTERED-BY
292900170620             END-IF
292910990618           END-IF.
292920990618
292930990618       GUE-EXIT.
292940990618           EXIT.
292950990618       COMPUTE-EXCHANGE-RATE.
292960990619      *RFS167932 - Starts
292970990619           INITIALIZE ld_SelectDateExg
292980011003           IF lc-LdaSelectDate = "T" AND
292990030605              WS-LDA-STMT-CNFM-FLAG = "S"
293000050517              MOVE TRADE-DATE OF TRANS-REC   TO ld_SelectDateExg
293010050517           ELSE
293020030605              MOVE PROCESS-DATE OF TRANS-REC TO ld_SelectDateExg
293030030605           END-IF.
293040030605
293050030605      *RFS167932 - Ends
293060020923
293070020923      ******************************************************
293080020923      *   WHEN NON BASE CURRENCY THE GROSS AMOUNT OF       *
293090020923      *   EACH TRANSACTION WILL BE COMPUTED THROUGH        *
293100021203      *   THE EXCHANGE RATE OF THE SAME TRADE DATE.        *
293110021203      ******************************************************
293120030106
293130021203           MOVE GROSS-AMT OF TRANS TO WS-GROSS-AMT-EX.
293140021203
293150030411R17542     IF TRANSFER-IN
293160030411   v          COMPUTE WS-TRI-TRO-INCEPT-COST ROUNDED = UNIT-AMT
293170030411R26600            OF TRANS * AVERAGE-UNIT-COST OF TRANS-T
293180030401   ¦          MOVE WS-TRI-TRO-INCEPT-COST TO WS-TRI-TRO-INCEPT-COST-EX
293190030414   ¦       END-IF.
293200030411   V
293210030411R17542     IF TRANSFER-OUT
293220030106              COMPUTE WS-TRI-TRO-INCEPT-COST ROUNDED =
293230030414                       UNIT-AMT OF TRANS * AVERAGE-UNIT-COST OF TRANS
293240030411              MOVE WS-TRI-TRO-INCEPT-COST TO WS-TRI-TRO-INCEPT-COST-EX
293250021203R14556     END-IF.
293260021227
293270021227R15022     MOVE 0  TO  WS-GAIN-LOSS.
293280030414R15022     MOVE 0  TO  WS-GAIN-LOSS-EX
293290021203R14556     IF SEL-ONLY OR SWITCHES-OUT OR FEES OR TRANSFER-OUT
293300021203   ¦            OR TRUSTEE-FEES
293310030331   ¦
293320021203   ¦          PERFORM GET-TAXABLE-EVENT-IND        THRU CYTDD-EXIT
293330021203   ¦
293340030401   ¦        IF AVERAGE-UNIT-COST OF TRANS IS NOT EQUAL TO 0
293350020923   ¦          AND TAXABLE-EVENT-INDICATOR OF TAXABLE-EVENT-RECD
293360011003R16666           IS NOT EQUAL TO "N"
293370170620   ¦        OR
293380170620   ¦            AVERAGE-UNIT-COST OF TRANS IS NOT EQUAL TO 0
293390011004   ¦          AND TAXABLE-EVENT-INDICATOR OF TAXABLE-EVENT-RECD
293400071019   ¦             IS EQUAL TO "D"
293410011003   ¦
293420061024   ¦            SUBTRACT AVERAGE-UNIT-COST OF TRANS
293430061103   ¦                FROM UNIT-PRICE OF TRANS
293440061024   ¦                GIVING WS-GAIN-LOSS-TMP1
293450170620   ¦
293460170620   ¦            MULTIPLY WS-GAIN-LOSS-TMP1 BY UNIT-AMT OF TRANS
293470061024   ¦              GIVING WS-GAIN-LOSS ROUNDED
293480071019   ¦         MOVE WS-GAIN-LOSS  TO WS-GAIN-LOSS-EX
293490061024   ¦        END-IF
293500061024R15022     END-IF.
293510061024
293520990618R11127     IF (SWITCHES-OUT OR SEL-ONLY)
293530011003167932*    AND PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
293540990618167932     AND ld_SelectDateExg      IS GREATER THAN WS-CURYTDSTRDTE
293550990618               COMPUTE WS-YTD-DISP-BOOK-VALUE-BASE  ROUNDED =
293560990618                       UNIT-AMT OF TRANS * AVERAGE-UNIT-COST OF TRANS
293570990618R11127     END-IF.
293580990618      *RFS36342 - Starts
293590990618           IF  lb-LdaAccountAdditionalInfoYes
293600990618           AND (SWITCHES-OUT OR SEL-ONLY)
293610990618167932*    AND PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
293620990618167932     AND ld_SelectDateExg       >=  WS-LDA-STRDTE
293630990618               COMPUTE ln_CurrDispBookValueBase ROUNDED =
293640990618                       UNIT-AMT OF TRANS * AVERAGE-UNIT-COST OF TRANS
293650990618               END-IF
293660990618      *RFS36342 - Ends
293670990618
293680990618           IF WS-CC-BASE (CC) IS NOT EQUAL TO "N"
293690990618              GO TO CER-EXIT.
293700990618
293710990618           INITIALIZE MFAEXRHMP.
293720990618           MOVE WS-IC-CURR (IC)        TO  CURRENCY-DDS
293730990619                                           OF EXCHANGE-RATE-M-REC.
293740990627           MOVE TRADE-DATE
293750040903                OF TRANS-REC           TO  TRADE-DATE
293760040903                                           OF EXCHANGE-RATE-M-REC.
293770040903           MOVE WS-CC-RTETYP (CC)      TO  EXCHANGE-RATE-TYPE
293780040903                                           OF EXCHANGE-RATE-M-REC.
293790040903           READ EXCHANGE-RATE-M
293800040903               INVALID KEY
293810040903                   MOVE 1              TO  EXCHANGE-RATE
293820040903                                           OF EXCHANGE-RATE-M-REC.
293830040903
293840040903           IF  EXCHANGE-RATE
293850040903               OF EXCHANGE-RATE-M-REC
293860040903                              IS EQUAL TO  ZEROES
293870040903               MOVE 1                  TO  EXCHANGE-RATE
293880040903                                           OF EXCHANGE-RATE-M-REC.
293890990619
293900990619           MOVE ZEROES                 TO  WS-GROSS-AMT-EX.
293910990619R22370*****
293920990619   ¦  ***** Retrieve the Exchange-Rate from TRANS-TARGET-SPOT-RATE if
293930011003   ¦  ***** Swich from US to CAD or CAD to US. If the Exchange-Rate
293940011003   ¦  ***** not found in TRANS-TARGET-SPOT-RATE or the Exchange-Rate
293950170620   ¦  ***** equals 0, using the default value from EXCHANGE-RATE-M.
293960170620   ¦  *****
293970011004   ¦       IF SWITCHES-OUT OR SWITCHES-IN
293980011004   ¦          PERFORM COMPUTE-SPOT-EXCHANGE-RATE    THRU CSER-EXIT
293990011003   ¦          IF WS-SPOT-EXCHANGE-RATE IS NOT EQUAL TO ZEROES
294000011003   ¦             MOVE WS-SPOT-EXCHANGE-RATE
294010020923   ¦                      TO EXCHANGE-RATE OF EXCHANGE-RATE-M-REC
294020061024   v          END-IF
294030061103R22370     END-IF.
294040061024
294050170620           COMPUTE WS-GROSS-AMT-EX ROUNDED =
294060170620                                   GROSS-AMT OF TRANS-REC
294070061024                                        /   EXCHANGE-RATE
294080061024                                            OF EXCHANGE-RATE-M-REC.
294090061024
294100061024R11127     IF (SWITCHES-OUT OR SEL-ONLY)
294110061024167932*    AND PROCESS-DATE OF TRANS IS GREATER THAN WS-CURYTDSTRDTE
294120020923167932     AND ld_SelectDateExg      IS GREATER THAN WS-CURYTDSTRDTE
294130020923               COMPUTE WS-YTD-DISP-BOOK-VALUE-BASE ROUNDED =
294140020923                       WS-YTD-DISP-BOOK-VALUE-BASE   /  EXCHANGE-RATE
294150020923                                              OF EXCHANGE-RATE-M-REC
294160020923R11127     END-IF.
294170020923
294180021203      *RFS36342 - Starts
294190021203               IF  lb-LdaAccountAdditionalInfoYes
294200021203               AND (SWITCHES-OUT OR SEL-ONLY)
294210021203167932*        AND PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
294220021203167932         AND ld_SelectDateExg       >=  WS-LDA-STRDTE
294230021203                   COMPUTE ln_CurrDispBookValueBase ROUNDED =
294240021203                           ln_CurrDispBookValueBase /
294250030106                           EXCHANGE-RATE OF EXCHANGE-RATE-M-REC
294260030106               END-IF
294270021203      *RFS36342 - Ends
294280021203R14556     IF TRANSFER-IN OR TRANSFER-OUT
294290021203              MOVE ZEROES             TO WS-TRI-TRO-INCEPT-COST-EX
294300021203              COMPUTE WS-TRI-TRO-INCEPT-COST-EX ROUNDED =
294310021203                      WS-TRI-TRO-INCEPT-COST  /  EXCHANGE-RATE
294320021203                                              OF EXCHANGE-RATE-M-REC
294330021203R14556     END-IF.
294340021203R15022     MOVE 0  TO  WS-GAIN-LOSS-EX.
294350990619R14556     IF SEL-ONLY OR SWITCHES-OUT OR FEES OR TRANSFER-OUT
294360990618   ¦            OR TRUSTEE-FEES
294370030304   ¦         IF AVERAGE-UNIT-COST OF TRANS IS NOT EQUAL TO 0
294380030304   ¦            AND TAXABLE-EVENT-INDICATOR OF TAXABLE-EVENT-RECD
294390030304   ¦             IS NOT EQUAL TO "Y"
294400030304   ¦         OR
294410030304   ¦            AVERAGE-UNIT-COST OF TRANS IS NOT EQUAL TO 0
294420030304   ¦            AND TAXABLE-EVENT-INDICATOR OF TAXABLE-EVENT-RECD
294430030605   ¦             IS EQUAL TO "D"
294440030304   ¦
294450030304   ¦          MOVE ZEROES             TO WS-GAIN-LOSS-EX
294460030304   ¦          COMPUTE WS-GAIN-LOSS-EX  ROUNDED =
294470030304   ¦                  WS-GAIN-LOSS   /  EXCHANGE-RATE
294480030304   ¦                                          OF EXCHANGE-RATE-M-REC
294490030304   ¦        END-IF
294500030304R15022     END-IF.
294510030304       CER-EXIT.
294520030304           EXIT.
294530030304R16033*****
294540030304   ¦  *****  Get the Opposite side of GIC TRI/TRO in Statement.
294550040903   ¦  *****
294560040903   ¦
294570040903   ¦   GET-GIC-OPPOSITE-SIDE.
294580040903   ¦
294590040903   ¦
294600040903   ¦       IF ACCOUNT-NO OF       TRANS-T-REC   IS EQUAL TO
294610040903   ¦                ACCOUNT-NO OF TRANS-REC
294620040903   ¦       AND INVESTMENT-CODE OF TRANS-T-REC   IS EQUAL TO
294630040903   ¦           INVESTMENT-CODE OF TRANS-REC
294640160310   ¦          MOVE "Y"               TO WS-GIC-SAME-FUND-FLAG
294650040903   ¦       END-IF.
294660040903   ¦  *****
294670040903   ¦   GGOS-EXIT.
294680040903   ¦        EXIT.
294690040903   ¦
294700040903R16033*****
294710160310R22370*****
294720040903   ¦  *****  Get the SPOT-EXCHANGE-RATE for SWI/SWO.
294730040903   ¦  *****  SWI: link to Placement-Date-2 and Trans-No-2 of MFATRNTRP
294740040903   ¦  *****  SWO: link to Placement-Date and Trans-No of MFATRNTRP
294750040903   ¦  *****
294760040903   ¦   COMPUTE-SPOT-EXCHANGE-RATE.
294770040903   ¦       INITIALIZE       WS-SPOT-EXCHANGE-RATE.
294780040903   ¦
294790040903   ¦       IF SWITCHES-OUT
294800040903148326       OR TRANSFER-OUT
294810040903   ¦         EXEC SQL
294820040903   ¦          SELECT EXCHANGE_RATE INTO :WS-SPOT-EXCHANGE-RATE:IND2
294830040903   ¦          FROM MFATRNTRP
294840040903   ¦          WHERE PLACEMENT_DATE = :WS-PLACEMENT-DATE    AND
294850040903   ¦                TRANS_NO       = :WS-TRANS-NO
294860990618   ¦         END-EXEC
294870980203   ¦       ELSE
294880980203   ¦         EXEC SQL
294890980203   ¦          SELECT EXCHANGE_RATE INTO :WS-SPOT-EXCHANGE-RATE:IND2
294900980203   ¦          FROM MFATRNTRP
294910980203   ¦          WHERE PLACEMENT_DATE_2 = :WS-PLACEMENT-DATE    AND
294920980203   ¦                TRANS_NO_2       = :WS-TRANS-NO
294930980210   ¦         END-EXEC
294940980210   ¦       END-IF.
294950980205   ¦       IF SQLCODE = 100
294960980205   ¦          MOVE ZEROS           TO WS-SPOT-EXCHANGE-RATE
294970980206   ¦       END-IF.
294980980203   ¦  **********
294990980203   ¦   CSER-EXIT.
295000980203   ¦        EXIT.
295010980205R22370**********
295020980206      /
295030980206       HEADING-RTN.
295040980211      *                                                    *
295050980206      *    H E A D I N G   R O U T I N E                   *
295060980206      ******************************************************
295070980206
295080980210           ACCEPT HEAD-DATE FROM DATE.
295090980211           ACCEPT WS-TIME FROM TIME.
295100980206           MOVE WHM TO HDG2-TIME.
295110980206           MOVE YR TO HDG1-YR.
295120980206           MOVE MT TO HDG1-MT.
295130980206           MOVE DT TO HDG1-DD.
295140980205           INSPECT HDG2-TIME REPLACING ALL SPACE BY ":".
295150980205           ADD 1 TO WS-PAGE-CNT.
295160980205           MOVE WS-PAGE-CNT TO HDG1-PAGE.
295170980205
295180980205           CALL "RTVCMPNMA" USING CPWCMPNMA-LINKAGE.
295190980205           CANCEL "RTVCMPNMA".
295200980205           MOVE CPWCMPNMA-CLIENT-NAME TO HDG1-CMPNAME.
295210980203
295220980203           CALL "RTVPRCDTP" USING CPWPRCDTP-LINKAGE.
295230980203           CANCEL "RTVPRCDTP".
295240980203           MOVE PRCDTP-AS-AT-DATE TO HDG3-DATE.
295250980203
295260980205           MOVE YY TO HDG3-YY.
295270980203           MOVE MM TO HDG3-MM.
295280980203           MOVE DD TO HDG3-DD.
295290980203
295300031117           IF WS-LDA-CNFM-DUP-FLAG = "Y"
295310031117              MOVE "DUPLICATE CONFIRMATION CONTROL REPORT"
295320031117                    TO HDG2-TITLE.
295330031117           IF WS-LDA-CNFM-DUP-FLAG = "N"
295340031117              MOVE "DAILY CONFIRMATION CONTROL REPORT"
295350031117                    TO HDG2-TITLE.
295360031117
295370031117           WRITE PRINT-REC FROM HEADING-LINE1 AFTER ADVANCING PAGE.
295380031117           WRITE PRINT-REC FROM HEADING-LINE2 AFTER ADVANCING 1.
295390031117           WRITE PRINT-REC FROM HEADING-LINE3 AFTER ADVANCING 1.
295400031117           WRITE PRINT-REC FROM HEADING-LINE4 AFTER ADVANCING 2.
295410031117           WRITE PRINT-REC FROM HEADING-LINE5 AFTER ADVANCING 2.
295420031117           MOVE 6 TO WS-LINE-CNT.
295430031117
295440031117       HR-EXIT.
295450031117           EXIT.
295460031117      /
295470031117R18643******************************************************
295480031117   ¦  *  GET INVESTMENT UNIT PRICE ROUTINE                 *
295490031117   ¦  ******************************************************
295500031117   ¦   GET-INVESTMENT-UNIT-PRICE-RTE.
295510031117   ¦
295520031117   ¦       INITIALIZE INVESTMENT-PRICE-REC.
295530031117   ¦       MOVE WS-PRICE-INVESTMENT-CODE
295540031117   ¦                TO INVESTMENT-CODE   OF INVESTMENT-PRICE-REC.
295550031117   ¦       MOVE WS-PRICE-TRADE-DATE
295560031117   ¦                TO TRADE-DATE        OF INVESTMENT-PRICE-REC.
295570031117   ¦       MOVE "Y" TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
295580031117   ¦
295590031117   ¦       READ INVESTMENT-UNIT-PRICE
295600031117   ¦          INVALID KEY
295610031117   ¦            GO TO GIUPR-0010
295620031117   ¦       END-READ.
295630031117   ¦
295640031117   ¦       GO TO GIUPR-EXIT.
295650031117   ¦
295660031117   ¦   GIUPR-0010.
295670031117   ¦
295680031117   ¦       INITIALIZE INVESTMENT-PRICE-REC.
295690031117   ¦       MOVE WS-PRICE-INVESTMENT-CODE
295700031117   ¦                TO INVESTMENT-CODE   OF INVESTMENT-PRICE-REC.
295710031117   ¦       MOVE WS-PRICE-TRADE-DATE
295720031117   ¦                TO TRADE-DATE        OF INVESTMENT-PRICE-REC.
295730031117   ¦       MOVE " " TO DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC.
295740031117   ¦
295750031117   ¦       READ INVESTMENT-UNIT-PRICE
295760031117   ¦          INVALID KEY
295770031117   ¦            GO TO GIUPR-0020
295780031117   ¦       END-READ.
295790031117   ¦
295800031117   ¦       GO TO GIUPR-EXIT.
295810031117   ¦
295820031117   ¦   GIUPR-0020.
295830031117   ¦
295840031117   ¦       INITIALIZE INVESTMENT-PRICE-REC.
295850031117   ¦       MOVE WS-PRICE-INVESTMENT-CODE
295860031117   ¦                TO INVESTMENT-CODE   OF INVESTMENT-PRICE-REC.
295870031117   ¦       MOVE WS-PRICE-TRADE-DATE
295880031117   ¦                TO TRADE-DATE        OF INVESTMENT-PRICE-REC.
295890031117   ¦
295900031117   ¦       START INVESTMENT-UNIT-PRICE
295910031117   ¦          KEY IS GREATER THAN  EXTERNALLY-DESCRIBED-KEY
295920031117   ¦           INVALID KEY
295930031117   ¦           GO TO GIUPR-0030
295940031117   ¦       END-START.
295950031117   ¦
295960031117   ¦       GO TO GIUPR-0040.
295970031117   ¦
295980031117   ¦   GIUPR-0030.
295990031117   ¦
296000031117   ¦       READ INVESTMENT-UNIT-PRICE LAST
296010031117   ¦          AT END
296020031117   ¦            INITIALIZE INVESTMENT-PRICE-REC
296030031117   ¦            MOVE WS-LDA-STRDTE TO TRADE-DATE
296040031117   ¦                               OF INVESTMENT-PRICE-REC
296050031117   ¦            MOVE ZEROES TO UNIT-PRICE OF INVESTMENT-PRICE-REC
296060031117   ¦          GO TO GIUPR-EXIT
296070031117   ¦       END-READ.
296080031117   ¦
296090031117   ¦       GO TO GIUPR-0050.
296100031117   ¦
296110031117   ¦   GIUPR-0040.
296120031117   ¦
296130031117   ¦       READ INVESTMENT-UNIT-PRICE PRIOR RECORD
296140031117   ¦          AT END
296150031117   ¦            INITIALIZE INVESTMENT-PRICE-REC
296160031117   ¦            MOVE WS-LDA-STRDTE TO TRADE-DATE
296170031117   ¦                               OF INVESTMENT-PRICE-REC
296180031117   ¦            MOVE ZEROES TO UNIT-PRICE OF INVESTMENT-UNIT-PRICE
296190080219   ¦            GO TO GIUPR-EXIT
296200031117   ¦       END-READ.
296210031117   ¦
296220031117   ¦   GIUPR-0050.
296230031117   ¦
296240031117   ¦       IF INVESTMENT-CODE OF INVESTMENT-PRICE-REC IS NOT EQUAL TO
296250031117   ¦                                WS-PRICE-INVESTMENT-CODE
296260031117   ¦            INITIALIZE INVESTMENT-PRICE-REC
296270031117   ¦            MOVE WS-LDA-STRDTE TO TRADE-DATE
296280030611   ¦                               OF INVESTMENT-PRICE-REC
296290030611   ¦           MOVE ZEROES  TO  UNIT-PRICE OF INVESTMENT-PRICE-REC
296300030611   ¦           GO TO GIUPR-EXIT
296310030611   ¦       END-IF.
296320030611   ¦
296330030611   ¦       IF TRADE-DATE  OF INVESTMENT-PRICE-REC
296340030611   ¦                      IS GREATER THAN  WS-PRICE-TRADE-DATE
296350030611 42749         OR DISTRIBUTION-FLAG OF INVESTMENT-PRICE-REC = lnc_S
296360030611   ¦           GO TO GIUPR-0040
296370030611   ¦       END-IF.
296380030611   ¦
296390030611   ¦  **********
296400030611   ¦   GIUPR-EXIT.
296410030611   ¦         EXIT.
296420030611   v
296430030611R18643**********
296440030611R16913******************************************************
296450030611  ¦   *  GET REVERSAL REASON ROUTINE                       *
296460030611  ¦   ******************************************************
296470030605  ¦    GET-REVERSAL-REASON-RTN.
296480030605  ¦
296490030605  ¦         SET RR TO 1.
296500030605  ¦
296510030605  ¦    GRRR-0010.
296520030605  ¦
296530030605  ¦         IF RR IS LESS THAN WS-RR-LST AND
296540030605  ¦            WS-RR-CODE (RR) NOT EQUAL TO REVERSAL-CODE OF TRANS
296550030825  ¦            SET RR UP BY 1
296560030605  ¦            GO TO GRRR-0010
296570030605  ¦         END-IF.
296580030605  ¦   *****
296590030605  ¦    GRRR-EXIT.
296600030605  ¦         EXIT.
296610030605  v
296620030605R16913*****
296630030605R17542*****
296640030605   ¦  *****  Get the the target transaction. It includes the target
296650030605   ¦  *****  of SWI/SWO, TRI/TRO, and RVS.
296660030605   ¦  *****
296670030605   ¦
296680030605   ¦   GET-TARGET-TRANSACTION.
296690030605   ¦
296700030605   ¦       INITIALIZE MFATRNP OF TRANS-T-REC.
296710030605R18147     MOVE "N" TO WS-TARGET-ERROR.
296720030825   ¦
296730030825   ¦       MOVE PLACEMENT-DATE
296740030825   ¦            OF TRANS-REC           TO  WS-PLACEMENT-DATE-SWTR.
296750030605   ¦       MOVE TRANS-NO
296760030605   ¦            OF TRANS-REC           TO  WS-TRANS-NO-SWTR.
296770030605   ¦       MOVE TRANS-TYPE-CODE
296780030605   ¦            OF TRANS-REC           TO  WS-TRANS-TYPE-SWTR.
296790030605   ¦       MOVE TRANS-STATUS-CODE
296800030605   ¦            OF TRANS-REC           TO  WS-TRANS-STATUS-SWTR.
296810030605   ¦
296820030605   ¦       CALL "STMTTARGET" USING   WS-PLACEMENT-DATE-SWTR
296830030825   ¦                                 WS-TRANS-NO-SWTR
296840030702   ¦                                 WS-TRANS-TYPE-SWTR
296850030702   ¦                                 WS-TRANS-STATUS-SWTR
296860030702   ¦                                 WS-PLACEMENT-DATE-2-SWTR
296870040127   ¦                                 WS-TRANS-NO-2-SWTR
296880040127   ¦                                 WS-HIDDEN-FLAG
296890040127R18147                               WS-DECLARE-STMTTARGET.
296900040107R18147*****CANCEL "STMTTARGET".
296910040106   ¦
296920040107   ¦       MOVE WS-PLACEMENT-DATE-2-SWTR
296930040106   ¦                                TO PLACEMENT-DATE OF TRANS-T-REC.
296940030702   ¦       MOVE WS-TRANS-NO-2-SWTR  TO TRANS-NO       OF TRANS-T-REC.
296950160209   ¦
296960160209   ¦       READ TRANS-T
296970030702   ¦           INVALID KEY
296980030702   ¦             INITIALIZE MFATRNP OF TRANS-T-REC
296990030702R18147           MOVE "Y" TO WS-TARGET-ERROR
297000110519   V             GO TO GTT-EXIT
297010110519R17542     END-READ.
297020110519
297030110519R20573     IF (WS-PT-RULE (PT) = "3" OR WS-PT-RULE (PT) = "4") AND
297040110519R20573        WS-ACCT-CHG = "N"
297050110519R19074        IF  TRANSFER-IN-OUT-ONLY AND
297060110519R17981            ACCOUNT-NO OF TRANS-T-REC NOT =
297070110519  ¦                  ACCOUNT-NO OF TRANS-REC
297080110519  V               MOVE "Y" TO WS-ACCT-CHG
297090110519R19074        END-IF
297100110519R17767     END-IF.
297110110519148326     MOVE ZEROES                    TO ln_OtherAccount.
297120110519148326     MOVE ACCOUNT-NO OF TRANS-T-REC TO ln_OtherAccount.
297130110519
297140110519R17542 GTT-EXIT.
297150110519R17542     EXIT.
297160110519      *RFS93759 BEGIN
297170110519       GET-AND-PUT-TARGET-INFO.
297180110601
297190110601           INITIALIZE MFATRNP OF TRANS-M-REC.
297200110519           MOVE "N" TO WS-TARGET-ERROR.
297210110519
297220110519           MOVE PLACEMENT-DATE OF TRANS-REC TO li-Place-date.
297230110519           MOVE TRANS-NO       OF TRANS-REC TO li-Trans-No.
297240110519           MOVE 0                           TO li-Place-date-2
297250110519                                               li-Trans-No-2.
297260110519
297270110519           EXEC SQL
297280110519             SELECT PLACEMENT_DATE_2, TRANS_NO_2
297290110519             INTO   :li-Place-date-2, :li-Trans-No-2
297300110601             FROM MFATRNTGP
297310110601             WHERE
297320110519               PLACEMENT_DATE = :li-Place-date AND
297330110519               TRANS_NO = :li-Trans-No
29734011051996613          AND RELATIONSHIP_TYPE = :Lc_DSR
29735011051996613        FETCH FIRST 1 ROW ONLY
297360110519           END-EXEC.
297370110519
297380110519           IF li-Place-date-2 = 0 OR li-Trans-No-2 = 0
297390110519              EXEC SQL
297400110519               SELECT PLACEMENT_DATE, TRANS_NO
297410110519               INTO   :li-Place-date-2, :li-Trans-No-2
297420110519               FROM MFATRNTGP
297430110519               WHERE
297440110519                 PLACEMENT_DATE_2 = :li-Place-date AND
297450110519                 TRANS_NO_2 = :li-Trans-No
29746011051996613            AND RELATIONSHIP_TYPE = :Lc_DSR
29747011051996613           FETCH FIRST 1 ROW ONLY
297480110519              END-EXEC
297490110519           END-IF
297500110519
297510110519           IF li-Place-date-2 = 0 OR li-Trans-No-2 = 0
297520110519              GO TO GAPTI-EXIT
297530110519           END-IF
297540110519
297550110519           MOVE li-Place-date-2 TO PLACEMENT-DATE OF TRANS-M-REC.
297560110519           MOVE li-Trans-No-2   TO TRANS-NO       OF TRANS-M-REC.
297570110519
297580110519           READ TRANS-M
297590110519               INVALID KEY
297600110519                 INITIALIZE MFATRNP OF TRANS-M-REC
297610110519                 GO TO GAPTI-EXIT
297620110519           END-READ.
297630110519
297640110519           MOVE ACCOUNT-NO OF TRANS-M-REC TO AT-OTHER-ACCOUNT.
297650110519           SET ICT TO  1.
297660110519
297670110519       GAPTI-10.
297680110519
297690110519           IF  INVESTMENT-CODE OF TRANS-M-REC = WS-IC-CODE (ICT)
297700110519               STRING WS-LDA-MGMT-COM-CDE DELIMITED BY  SIZE
297710110519                      WS-IC-FUND (ICT) DELIMITED BY  " "
297720110519                 INTO AT-OTHER-FUND-NO
297730110519               IF WS-IC-NAME-FLAG = "F"
297740110519                  MOVE WS-IC-NAME-F(ICT) TO AT-OTHER-INVESTMENT-NAME
297750110519               ELSE
297760110519                  MOVE WS-IC-NAME-E(ICT) TO AT-OTHER-INVESTMENT-NAME
297770110519               END-IF
297780030825               GO TO GAPTI-EXIT
297790030826           END-IF.
297800030826
297810030826           IF  ICT <  WS-IC-LST
297820030826               SET ICT UP BY  1
297830030826               GO TO GAPTI-10
297840030826           END-IF.
297850030826
297860030826           STRING WS-LDA-MGMT-COM-CDE DELIMITED BY  SIZE
297870030826                  "***" DELIMITED BY  SIZE
297880030826                  INTO  AT-OTHER-FUND-NO.
297890030826           MOVE ALL "*" TO  AT-OTHER-INVESTMENT-NAME.
297900030826
297910030826       GAPTI-EXIT.
297920030826           EXIT.
297930040712      *RFS93759 END
297940040712R18143*****
297950040712   |  *****  Get the record from Dealer Mailing Instruction file
297960040712   |  *****  using the Form Code provided for every Dealer.
297970040712   |  *****
297980040712   |
297990040712   |   GET-DEALER-MAILING-INSTRUCTION.
298000040712   |
298010040712   |       INITIALIZE        DEALER-MAILING-INST-REC.
298020040712   |       MOVE ACDEALER     TO DEALER-CODE OF DEALER-MAILING-INST-REC.
298030040712   |       MOVE WS-FORM-CODE TO FORM-CODE   OF DEALER-MAILING-INST-REC.
298040040712   |
298050040712   |       CALL "FXDLCKFMCD" USING WS-DECLARE-DLCKFMCD
298060040712   |                               DEALER-MAILING-INST-REC
298070040712   |                               WS-RETURN-CODE.
298080030826   |
298090030826R20804* Return code '99' indicates record not found in FXDLCKFMCD.
298100030826   |  * Return code '98' indicates record found in FXDLCKFMCD but
298110030826   |  * dealer rep override should not be used.
298120030826   |
298130030825   |       IF WS-RETURN-CODE = "00"       AND
298140030825   |          WS-DLRREP-FREQ = "Y"        AND
298150030826   |          WS-FORM-CODE   = "CLTSTREP"
298160030826   |        IF (WS-LDA-FREQUENCY-CODE = "SA" AND
298170030826   |            FREQUENCY-CODE OF DEALER-MAILING-INST-REC NOT = "SA")
298180030826   |        OR (WS-LDA-FREQUENCY-CODE = "AN" AND
298190030826   |            FREQUENCY-CODE OF DEALER-MAILING-INST-REC NOT = "SA"
298200030826   |                                                      AND   "AN")
298210030826   |           MOVE "98" TO WS-RETURN-CODE
298220030826   V        END-IF
298230030826R20804     END-IF.
298240030826   |  **********
298250030826   |
298260030826   |   GDMI-EXIT.
298270030826   |        EXIT.
298280030826   V
298290030826R18143**********
298300040712R18143*****
298310040712   |  *****  Get the record from Dealer Rep Mailing Instruction
298320040712   |  *****  file using the Form Code provided for every Dealer Rep.
298330040712   |  *****
298340040712   |
298350040712   |   GET-DEALER-REP-MAILING-INST.
298360040712   |
298370040712   |       INITIALIZE        DLRREP-MAILING-INST-REC.
298380040712   |       MOVE ACDEALER     TO DEALER-CODE OF DLRREP-MAILING-INST-REC.
298390040712   |       MOVE ACDEALREP    TO DEALER-REP-CODE
298400040712   |                                        OF DLRREP-MAILING-INST-REC.
298410040712   |       MOVE WS-FORM-CODE TO FORM-CODE   OF DLRREP-MAILING-INST-REC.
298420040712   |
298430040712   |       CALL "FXDRCKFMCD" USING WS-DECLARE-DRCKFMCD
298440040712   |                               DLRREP-MAILING-INST-REC
298450040712   |                               WS-RETURN-CODE.
298460030826   ¦
298470030826R20804* Return code '99' indicates record not found in FXDLCKFMCD.
298480030826   |  * Return code '98' indicates record found in FXDLCKFMCD but
298490030826   |  * dealer rep override should not be used.
298500030826   |
298510030825   |       IF WS-RETURN-CODE = "00"       AND
298520030825   |          WS-DLRREP-FREQ = "Y"        AND
298530030826   |          WS-FORM-CODE   = "CLTSTREP"
298540030826   |        IF (WS-LDA-FREQUENCY-CODE = "SA" AND
298550030826   |            FREQUENCY-CODE OF DLRREP-MAILING-INST-REC NOT = "SA")
298560030826   |        OR (WS-LDA-FREQUENCY-CODE = "AN" AND
298570030826   |            FREQUENCY-CODE OF DLRREP-MAILING-INST-REC NOT = "SA"
298580030826   |                                                      AND   "AN")
298590030826   |           MOVE "98" TO WS-RETURN-CODE
298600030826   V        END-IF
298610030826R20804     END-IF.
298620030826   |  **********
298630030826   |
298640030826   |   GDRMI-EXIT.
298650030826   |         EXIT.
298660030826   V
298670120314R18143**********
298680120314R18143*****
298690120314   |  *****  Get the record from the Nominee Mailing Instruction
298700120328   |  *****  file using the Form Code provided for every Nominee.
298710120328   |  *****
298720120326   |
298730120326   |   GET-NOMINEE-MAILING-INST.
298740120328   |
298750120328   |       INITIALIZE        NOMINEE-MAILING-INST-REC.
298760120328   |       MOVE ANNOMCODE OF INVESTOR-JOIN
298770120314   |                      TO NOMINEE-CODE OF NOMINEE-MAILING-INST-REC.
298780120314   |       MOVE WS-FORM-CODE TO FORM-CODE OF NOMINEE-MAILING-INST-REC.
298790120314   |
298800030826   |       CALL "FXNMCKFMCD" USING WS-DECLARE-NMCKFMCD
298810030826   |                               NOMINEE-MAILING-INST-REC
298820030826   |                               WS-RETURN-CODE.
298830030826      * RFS102988 - Start
298840030826      *
298850030825      * For AdvisorTrax do not suppress Account Nominee if form code
298860041019      * CLTSTCLT is not setup for Investor only.
298870151103      *
298880151103           IF lb-AdvisorTraxFlagYes          AND
298890151103              WS-LDA-STMT-CNFM-FLAG = lncc_S AND
298900151103              WS-RETURN-CODE NOT = lncc_00   AND
298910151103             (WS-LDA-CPYSELECT = lncc_A      OR
298920151103              WS-LDA-CPYSELECT = lncc_I)
298930041019              MOVE lncc_00 TO WS-RETURN-CODE
298940030825           END-IF.
298950030825      * RFS102988 - End
298960030825   |  **********
298970030825   |
298980030825   |   GNMI-EXIT.
298990130614   |        EXIT.
299000130614   V
299010130614R18143**********
299020130614
299030130614      * RFS152451 - Strats
299040130614117038*    Copy CPSTM22C.
299050030825           EXEC SQL
299060030825             INCLUDE CPSTM22C
299070030825           END-EXEC.
299080030825      * RFS152451 - Ends
299090130614
299100130614***********************************************************************
299110130614******* INSERT STATEMENT RECORDS
299120130614*******
299130130614***********************************************************************
299140130614R18147 INSERT-STATEMENT-REC.
299150130614
299160130614117038     If lncc-Section22Yes and
299170130614117038        stmtx-section-no (isr) = 80
299180130614117038        Call "FXSTMS22" using Statement-Rec (ISR)
299190130614117038     End-If.
299200130614
299210130614           IF ISR < ISRMAX
299220130614              GO TO ISR-COUNTER
299230030825           END-IF.
299240030825
299250030825117038     If (lncc-STM-SELEC-LOGIC-YES and
299260030825117038         WS-LDA-STMT-CNFM-FLAG = "S") OR
299270030825117038        (lncc-CON-EXL-TRN-YES   and
299280030825117038         WS-LDA-STMT-CNFM-FLAG = "C")
299290030825117038        MOVE STATEMENT-EXTRACT-ARRAY
299300030825117038          TO STATEMENT-EXTRACT-ARRAY-E
299310030825117038        MOVE ISR    to li_ISR
299320030825117038        CALL "FXCHKTRN" USING WS-LDA-STMT-CNFM-FLAG,
299330030825117038                              li_ISR,
299340030825117038                              lc_ReturnFlag
299350030825117038        MOVE STATEMENT-EXTRACT-ARRAY-E
299360030825117038          TO STATEMENT-EXTRACT-ARRAY
299370030825117038     End-If.
299380030825
299390031215       ISR-INSERT.
299400031215           MOVE "INSERT INTO MFASTMEXP " TO WS-SQLERR-STATEMENT.
299410031215           EXEC SQL
299420031215           INSERT INTO MFASTMEXP
299430031215           :ISR ROWS
299440061004           VALUES
299450061004           (:STATEMENT-REC)
299460061004           END-EXEC.
299470060901
299480060901           MOVE ZEROES TO ISR.
299490060829
299500031215       ISR-COUNTER.
299510031215           ADD 1 TO ISR.
299520031215
299530031215       ISR-EXIT.
299540031215           EXIT.
299550031215***********************************************************************
299560031215******* TRANS CHARGES PROCESS
299570031215***********************************************************************
299580031215R17495 TRANS-CHARGES-PROCESS.
299590031215
299600031215R34848*RFS34848 - Start
299610031215           COMPUTE li_DedMax = 0.
299620031215R34848*RFS34848 - End
29963003121536808 *    INITIALIZE WS-TRANS-TOTAL-DEDUCTIONS.
29964003121536808      INITIALIZE WS-TRANS-TOTAL-DEDUCTIONS,
29965003121534072                 ln_trn_total_redem_charge.
299660031215
299670031215           MOVE "OPEN-TRNCHC1" TO WS-SQLERR-STATEMENT.
299680031215
299690031215           EXEC SQL
299700031215             OPEN TRNCHC1
299710031215           END-EXEC.
299720031215
299730031215       TCP-FETCH-NEXT.
299740031215           EXEC SQL
299750031215             FETCH NEXT FROM TRNCHC1
299760061004             FOR :TRNCHMAX ROWS
299770061004             INTO :WS-TRNCH-REC
299780061004           END-EXEC.
299790061004
299800061004           IF SQLCODE > 0
299810061004              GO TO TCP-CLOSE
299820061004           END-IF.
299830061004
299840061004           COMPUTE WS-SQL-ACTUAL = SQLERRD(3)
299850061004           MOVE 0 TO WS-SQL-INDEX.
299860061004
299870061004       TCP-NEXT-CHARGE.
299880061004           ADD 1 TO WS-SQL-INDEX.
299890061004           MOVE WS-TRNCH-DED-CODE(WS-SQL-INDEX) TO WS-DEDUCTION-CODE.
299900061004           MOVE WS-TRNCH-COUNTRY(WS-SQL-INDEX)  TO AT-TAX-COUNTRY.
299910061004           MOVE WS-TRNCH-PRV-CODE(WS-SQL-INDEX) TO AT-TAX-PROVINCE.
299920031215R34848* RFS34848 - Start
299930031215      *  Load Deduction Charges to array. According to business, 100
299940031215      *  entries for deduction charges per transaction is more than
299950031215      *  enough for confirmation.
299960031215      *
299970031215           IF WS-LDA-STMT-CNFM-FLAG = lnc_C   AND
299980031215              lc-LdaSection81   =  lnc_Y
299990031215              COMPUTE  li_DedMax = li_DedMax + 1
300000031215              IF li_DedMax < lnc_101
300010031215                 MOVE WS-TRNCH-DED-CODE(WS-SQL-INDEX) TO
300020031215                      lc_TransDedCode(li_DedMax)
300030031215                 MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO
300040031215                      ln_TransDedCharge(li_DedMax)
300050031215              END-IF
300060031215           END-IF.
300070031215R34848* RFS34848 - End
300080031215      *****    Accumulate the non-resident taxes and the withholding
300090031215      *****    taxes (current, inception and year-to-date).
300100031215
300110170620           IF TAX-NONRES OR TAX-WITHHELD OR CDSC
300120031215               IF  REVERSAL
300130031215                 SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
300140031215                    FROM  ZEROES
300150031215                  GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
300160031215               END-IF
300170031215           END-IF.
300180031215
300190031215           EVALUATE TRUE
300200031215
300210031215           WHEN TAX-NONRES
300220031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300230031215                                               TO WS-INV-NRTAX-CUR
300240031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300250031215                                               TO WS-INV-NRTAX-INC
300260031215
300270031215               IF  PROCESS-DATE OF TRANS-REC > WS-YTDSTRDTE
300280031215                   ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300290031215                                               TO WS-INV-NRTAX-YTD
300300170620               END-IF
300310031215
300320031215               IF  REVERSAL
300330031215                 SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
300340031215                    FROM  ZEROES
300350031215                  GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
300360031215               END-IF
300370031215
300380031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300390031215                TO AT-TAX, WS-TRANS-TOTAL-DEDUCTIONS
300400031215
300410031215
300420031215           WHEN TAX-WITHHELD
300430031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-WHTAX-CUR
300440031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-WHTAX-INC
300450031215
300460031215               IF  PROCESS-DATE OF TRANS-REC >  WS-TAX-S-DATE-P AND
300470031215                   PROCESS-DATE OF TRANS-REC <  WS-TAX-S-DATE
300480031215                   ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300490050920                                              TO WS-INV-WHTAX-PRV
300500050920               END-IF
300510050920
300520050920               IF  PROCESS-DATE OF TRANS-REC > WS-YTDSTRDTE
300530050920                   ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300540050920                                              TO WS-INV-WHTAX-YTD
300550050920               END-IF
300560050920
300570050920               IF  REVERSAL
300580050920                 SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
300590050920                    FROM  ZEROES
300600060206                  GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
300610060206               END-IF
300620060206
300630050920               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300640031215                TO AT-TAX, WS-TRANS-TOTAL-DEDUCTIONS
300650031215
300660031215R29550         IF USWT
300670031215   ¦           ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  AT-US-BACKUP-WHTX
300680031215   ¦           IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
300690031215   ¦             ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300700031215   ¦                                  TO WS-IS2-FED-WHTAX-YTD
300710031215   ¦           END-IF
300720031215   ¦           IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
300730031215   ¦             ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300740031215   ¦                                   TO WS-IS2-FED-WHTAX-CUR
300750031215   ¦           END-IF
300760031215
300770031215R30396         SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
300780031215R30396             FROM AT-TAX
300790031215R29550       END-IF
300800031215
300810031215               IF FEDT
300820031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  AT-FED-TAX
300830031215               IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
300840031215                 ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300850031215                                      TO WS-IS2-FED-WHTAX-YTD
300860031215               END-IF
300870031215               IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
300880031215                 ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300890041025                                       TO WS-IS2-FED-WHTAX-CUR
300900041025               END-IF
300910041025             END-IF
300920041025
300930041025             IF PRVT
300940041025               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO AT-PROV-TAX
300950041025               IF PROCESS-DATE OF TRANS-REC > WS-CURYTDSTRDTE
300960041025                 ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
300970041025                                     TO WS-IS2-PROV-WHTAX-YTD
300980041025               END-IF
300990031215               IF PROCESS-DATE OF TRANS-REC >= WS-LDA-STRDTE
301000031215                 ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301010031215                                     TO WS-IS2-PROV-WHTAX-CUR
301020031215               END-IF
301030031215             END-IF
301040031215
301050031215R18780     WHEN FEDC
301060031215  ¦            MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO AT-FEDC-CLAWBACK
301070031215  ¦            ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301080031215  ¦                                   TO WS-TRANS-TOTAL-DEDUCTIONS
301090031215  ¦
301100031215  ¦        WHEN PRVC
301110040319  ¦            MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO AT-PRVC-CLAWBACK
301120040319  ¦            ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301130040319R18780                                TO WS-TRANS-TOTAL-DEDUCTIONS
301140031215
301150031215           WHEN TAX-GST
301160031215               MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO AT-GST
301170040319               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301180040319                                      TO WS-TRANS-TOTAL-DEDUCTIONS
301190040319
301200040319
301210040319           WHEN TAX-PST
301220040319               MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO AT-PST
301230040319               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301240040319                                      TO WS-TRANS-TOTAL-DEDUCTIONS
301250040319
301260040319           WHEN COMMISSION
301270040319      * RFS21503 Start
301280040319             IF GROSS-AMT OF TRANS IS NOT = NET-AMT OF TRANS
301290040319      * RFS21503 End
301300040319               IF WS-IC-LOAD (IC) NOT EQUAL TO  "B"
301310040319                  ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301320040319                  TO AT-COMMISSION, WS-TRANS-TOTAL-DEDUCTIONS
301330040319      * RFS21503 Start
301340040319               ELSE
301350040319                 IF TRANSFER-IN-ONLY
301360040319                   MOVE INVESTMENT-CODE OF TRANS-T-REC
301370040319                                        TO WS-FROM-INVESTMENT-CODE
301380040319
301390040319                   MOVE INVESTMENT-CODE OF TRANS
301400040319                                        TO WS-TO-INVESTMENT-CODE
301410031215
301420040319                   MOVE " " TO WS-STANDARD-COMMISSION
301430040319           EXEC SQL
301440040319                 SELECT STANDARD_COMMISSION
301450031215                 INTO   :WS-STANDARD-COMMISSION
301460031215                 FROM   MFAINVSCP
301470031215                 WHERE  FROM_INVESTMENT = :WS-FROM-INVESTMENT-CODE AND
301480031215                        TO_INVESTMENT   = :WS-TO-INVESTMENT-CODE
301490031215           END-EXEC
301500040908
301510040908                   IF WS-STANDARD-COMMISSION IS EQUAL TO "N"
301520050401                      ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301530060829                      TO AT-COMMISSION, WS-TRANS-TOTAL-DEDUCTIONS
301540060829                   END-IF
301550060829                 END-IF
301560060829      * RFS21503 End
301570060829               END-IF
301580060829      * RFS21503 Start
301590060829             END-IF
301600040908      * RFS21503 End
301610031215
301620031215           WHEN ADMN
301630060829               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301640060829                   TO AT-ADMIN-FEES, WS-TRANS-TOTAL-DEDUCTIONS
301650060829
301660041220R24080     WHEN ERED
301670041220  ¦            ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301680041220R26894               TO  WS-TRANS-TOTAL-DEDUCTIONS, AT-ERF
301690041220
301700041220R34072         IF REVERSAL
301710041220  ¦               MULTIPLY WS-TRNCH-CHARGE(WS-SQL-INDEX) BY -1
301720041220  ¦                   GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
301730041220  ¦            END-IF
301740041220  ¦            ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301750041220R34072               TO  ln_trn_total_redem_charge
301760041220
301770031215           WHEN CDSC
301780031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301790031215                   TO AT-DSC
301800040713R34072         ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301810040712R34072               TO  ln_trn_total_redem_charge
301820040712R25468         IF  REVERSAL
301830040712  ¦                SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
301840040712  ¦                  FROM  ZEROES GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
301850040712  ¦                ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301860040712  ¦                      TO WS-TRANS-TOTAL-DEDUCTIONS
301870040712  ¦                SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
301880040712  ¦                  FROM  ZEROES GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
301890040712  ¦            ELSE
301900040713  ¦                ADD WS-TRNCH-CHARGE(WS-SQL-INDEX)
301910031215  ¦                   TO   WS-TRANS-TOTAL-DEDUCTIONS
301920061024R25468         END-IF
301930061103               IF (SWITCHES-OUT OR SEL-ONLY) AND
301940061031                   PROCESS-DATE OF TRANS > WS-CURYTDSTRDTE AND
301950061103                   WS-TAXABLE-EVENT-INDICATOR = "D"
301960061031      ***** RFS22892 changes start
301970061031R18194             IF WS-CC-BASE (CC) IS NOT EQUAL TO "N"
301980061031  ¦                   COMPUTE WS-YTD-DISP-CDSC-BASE =
301990061031  ¦                        WS-TRNCH-CHARGE(WS-SQL-INDEX)
302000061031  ¦                ELSE
302010061031  ¦                   COMPUTE WS-YTD-DISP-CDSC-BASE ROUNDED =
302020061031  ¦                     WS-TRNCH-CHARGE(WS-SQL-INDEX) / EXCHANGE-RATE
302030061031  ¦                               OF EXCHANGE-RATE-M-REC
302040061103  ¦                END-IF
302050061031R18194             ADD WS-YTD-DISP-CDSC-BASE  TO  WS-INV-DISP-CDSC-BASE
302060061031      ***** RFS22892 changes end
302070061031               END-IF
302080061031      *RFS36342 - Starts
302090061031               IF  lb-LdaAccountAdditionalInfoYes
302100061103               AND (SWITCHES-OUT OR SEL-ONLY)
302110061031                 IF WS-CC-BASE (CC)  NOT =  lnc_N
302120061031                   COMPUTE ln_DeductionCdscBase ROUNDED =
302130061031                           WS-TRNCH-CHARGE(WS-SQL-INDEX)
302140061031                 ELSE
302150061103                   COMPUTE ln_DeductionCdscBase ROUNDED =
302160061031                           WS-TRNCH-CHARGE(WS-SQL-INDEX) /
302170061031                           EXCHANGE-RATE OF EXCHANGE-RATE-M-REC
302180061031                 END-IF
302190061031
302200061031                 IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
302210061031                   COMPUTE ln_InvDeductionsCdscYtdBase ROUNDED =
302220061024                           ln_InvDeductionsCdscYtdBase +
302230031215                           ln_DeductionCdscBase
302240031215                 END-IF
302250031215
302260031215                 IF PROCESS-DATE OF TRANS  >=  WS-LDA-STRDTE
302270031215                    COMPUTE ln_InvDeductionsCdscCurrBase ROUNDED =
302280031215                            ln_InvDeductionsCdscCurrBase +
302290031215                            ln_DeductionCdscBase
302300031215
302310031215                    IF WS-TAXABLE-EVENT-INDICATOR  =  lnc_D
302320031215                       COMPUTE ln_InvCurrDispCdscBase ROUNDED =
302330031215                               ln_InvCurrDispCdscBase +
302340031215                               ln_DeductionCdscBase
302350031215                    END-IF
302360031215                 END-IF
302370031215               END-IF
302380031215      *RFS36342 - Ends
302390031215           END-EVALUATE.
302400031215 **********IF  SPONSOR-RATE
302410031215 **********    GO TO TCP-LOOP-CHECK.
302420031215      *****
302430031215      *****    Special DAF processing.  DAFs will reduce the GROSS
302440031215      *****    amount but will not increase the DEDUCTIONS amount.
302450031215      *****    Since the GROSS amount was already used to accumulate the
302460031215      *****    current period amounts, this charge must be deducted from
302470031215      *****    the current period ammounts.
302480031215      *****
302490031215RF8503     IF  NOT DAF
302500031215               GO TO TCP-LOOP-CHECK
302510031215           END-IF.
302520031215
302530031215           MOVE GROSS-AMT OF TRANS TO WS-GROSS-AMT.
302540031215
302550031215           IF  REVERSAL
302560031215               MOVE WS-TRNCH-CHARGE(WS-SQL-INDEX) TO GROSS-AMT OF TRANS
302570031215           ELSE
302580031215               SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
302590031215                   FROM ZEROES
302600031215                 GIVING GROSS-AMT OF TRANS
302610031215           END-IF.
302620031215           MOVE "Y"                    TO  WS-TRNCHG-SW.
302630031215           MOVE UNIT-AMT OF TRANS      TO  WS-UNIT-AMT.
302640031215           MOVE ZEROES                 TO  UNIT-AMT OF TRANS.
302650031215           PERFORM COMPUTE-EXCHANGE-RATE  THRU CER-EXIT.
302660031215           PERFORM COMPUTE-CURRENT-PERIOD THRU CP-EXIT.
302670031215      *****
302680031215      *****   RFS9466 If SWI/SWO and the Account-no is different on
302690031215      *****   each side of the trade, the transactions should be
302700031215      *****   considered as TRI/TRO and be included in TRI/TRO instead
302710031215      *****   of in SWI/SWO. Because the amount have been calculated
302720031215      *****   before, therefore, recalculates are required.
302730031215      *****
302740031215RF9466     IF SWITCHES-IN
302750031215           OR SWITCHES-OUT
302760031215              PERFORM RECOMPUTE-SWI-SWO  THRU RSS-EXIT
302770031215           END-IF.
302780031215
302790031215           MOVE WS-UNIT-AMT            TO  UNIT-AMT OF TRANS.
302800031215           MOVE "N"                    TO  WS-TRNCHG-SW.
302810031215           MOVE WS-GROSS-AMT           TO  GROSS-AMT OF TRANS.
302820031215
302830031215           SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX) FROM AT-GROSS.
302840031215           SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
302850031215                                        FROM GROSS-AMT OF TRANS.
302860031215           ADD      WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-TRNCHGHID.
302870031215
302880031215       TCP-LOOP-CHECK.
302890031215           IF WS-SQL-INDEX < WS-SQL-ACTUAL
302900031215              GO TO TCP-NEXT-CHARGE
302910031215           END-IF.
302920031215
302930170620           IF WS-SQL-ACTUAL = TRNCHMAX
302940170620              GO TO TCP-FETCH-NEXT
302950170621           END-IF.
302960170620
302970170620       TCP-CLOSE.
302980170620           EXEC SQL
302990170620              CLOSE TRNCHC1
303000170620           END-EXEC.
303010170620
303020170620       TCP-EXIT.
303030031215           EXIT.
303040031215***********************************************************************
303050031215******* TRANS CHARGES TAXES AND CDSC YTD
303060031215***********************************************************************
303070031215R17495 TRANS-CHARGES-TAXES-CDSC.
303080031215
303090031215      *RFS167932 - Starts
303100031215           INITIALIZE ld_SelectDateChrg
303110031215            IF lc-LdaSelectDate = "T" AND
303120031215                WS-LDA-STMT-CNFM-FLAG = "S"
303130031215               MOVE TRADE-DATE OF TRANS-REC   TO ld_SelectDateChrg
303140031215            ELSE
303150031215               MOVE PROCESS-DATE OF TRANS-REC TO ld_SelectDateChrg
303160031215            END-IF.
303170031215      *RFS167932 - Ends
303180031215
303190031215           MOVE "OPEN-TRNCHC1" TO WS-SQLERR-STATEMENT.
303200031215
303210031215           EXEC SQL
303220031215             OPEN TRNCHC1
303230031215           END-EXEC.
303240031215
303250031215       TCTC-FETCH-NEXT.
303260031215           EXEC SQL
303270031215             FETCH NEXT FROM TRNCHC1
303280031215             FOR :TRNCHMAX ROWS
303290031215             INTO :WS-TRNCH-REC
303300031215           END-EXEC.
303310031215
303320031215           IF SQLCODE > 0
303330031215              GO TO TCTC-CLOSE
303340031215           END-IF.
303350031215
303360031215           COMPUTE WS-SQL-ACTUAL = SQLERRD(3)
303370031215           MOVE 0 TO WS-SQL-INDEX.
303380031215
303390170620       TCTC-NEXT-CHARGE.
303400170620           ADD 1 TO WS-SQL-INDEX.
303410031215           MOVE WS-TRNCH-DED-CODE(WS-SQL-INDEX) TO  WS-DEDUCTION-CODE.
303420031215
303430031215           IF NOT TAX-NONRES AND NOT TAX-WITHHELD AND NOT CDSC
303440031215               GO TO TCTC-LOOP-CHECK
303450031215           END-IF.
303460031215
303470170620           IF  REVERSAL
303480170620               SUBTRACT WS-TRNCH-CHARGE(WS-SQL-INDEX)
303490170620                   FROM ZEROES
303500170620                 GIVING WS-TRNCH-CHARGE(WS-SQL-INDEX)
303510170620           END-IF.
303520170620
303530031215           IF TAX-NONRES
303540031215             ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-NRTAX-INC
303550170620167932*      IF PROCESS-DATE OF TRANS-REC  >  WS-YTDSTRDTE
303560170620167932       IF ld_SelectDateChrg          >  WS-YTDSTRDTE
303570031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-NRTAX-YTD
303580031215             END-IF
303590031215           END-IF.
303600031215
303610031215           IF TAX-WITHHELD
303620031215             ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-WHTAX-INC
303630170620      *RFS167932 - Starts
303640170620      *      IF PROCESS-DATE OF TRANS-REC >  WS-TAX-S-DATE-P AND
303650031215      *        PROCESS-DATE OF TRANS-REC <  WS-TAX-S-DATE
303660031215             IF ld_SelectDateChrg         >  WS-TAX-S-DATE-P AND
303670031215                ld_SelectDateChrg        <  WS-TAX-S-DATE
303680031215      *RFS167932 - Ends
303690031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-WHTAX-PRV
303700031215             END-IF
303710031215167932*      IF PROCESS-DATE OF TRANS-REC  >  WS-YTDSTRDTE
303720031215167932       IF ld_SelectDateChrg          >  WS-YTDSTRDTE
303730031215               ADD WS-TRNCH-CHARGE(WS-SQL-INDEX) TO  WS-INV-WHTAX-YTD
303740031215             END-IF
303750061128           END-IF.
303760061128           IF CDSC
303770061128             IF (SWITCHES-OUT OR SEL-ONLY) AND
303780061128                 WS-TAXABLE-EVENT-INDICATOR = "D" AND
303790061128167932*          PROCESS-DATE OF TRANS > WS-CURYTDSTRDTE
303800061128167932           ld_SelectDateChrg     > WS-CURYTDSTRDTE
303810061128                 IF WS-CC-BASE (CC) IS NOT EQUAL TO "N"
303820061128                   COMPUTE WS-YTD-DISP-CDSC-BASE =
303830061128                           WS-TRNCH-CHARGE(WS-SQL-INDEX)
303840061128                 ELSE
303850061128                   COMPUTE WS-YTD-DISP-CDSC-BASE ROUNDED =
303860170620                        WS-TRNCH-CHARGE(WS-SQL-INDEX) / EXCHANGE-RATE
303870170620                                  OF EXCHANGE-RATE-M-REC
303880061128                 END-IF
303890061128                 ADD WS-YTD-DISP-CDSC-BASE  TO  WS-INV-DISP-CDSC-BASE
303900061128             END-IF
303910061128      *Def 36342.8 - Start
303920061128             IF  lb-LdaAccountAdditionalInfoYes
303930061128             AND (SWITCHES-OUT OR SEL-ONLY)
303940031215                 IF WS-CC-BASE (CC)  NOT =  lnc_N
303950170620                   COMPUTE ln_DeductionCdscBase ROUNDED =
303960031215                           WS-TRNCH-CHARGE(WS-SQL-INDEX)
303970031215                 ELSE
303980031215                   COMPUTE ln_DeductionCdscBase ROUNDED =
303990031215                           WS-TRNCH-CHARGE(WS-SQL-INDEX) /
304000031215                           EXCHANGE-RATE OF EXCHANGE-RATE-M-REC
304010031215                 END-IF
304020031215167932*          IF PROCESS-DATE OF TRANS  >=  WS-CURYTDSTRDTE
304030031215167932           IF ld_SelectDateChrg      >=  WS-CURYTDSTRDTE
304040031215                   COMPUTE ln_InvDeductionsCdscYtdBase ROUNDED =
304050031215                           ln_InvDeductionsCdscYtdBase +
304060031215                           ln_DeductionCdscBase
304070031215                 END-IF
304080070227             END-IF
304090070227      *Def 36342.8 - End
304100070227           END-IF.
304110070227       TCTC-LOOP-CHECK.
304120070227           IF WS-SQL-INDEX < WS-SQL-ACTUAL
304130070227              GO TO TCTC-NEXT-CHARGE
304140070227           END-IF.
304150070227           IF WS-SQL-ACTUAL = TRNCHMAX
304160070227              GO TO TCTC-FETCH-NEXT
304170070227           END-IF.
304180070227       TCTC-CLOSE.
304190070227           EXEC SQL
304200070227              CLOSE TRNCHC1
304210070227           END-EXEC.
304220070227       TCTC-EXIT.
304230070227           EXIT.
304240070227      *RFS 38037 Start
304250070227      * ---------------------------------
304260070228       GetOvrGbvEditCode.
304270070227      * ---------------------------------
304280070301           INITIALIZE MFAEDTSCP of SCREEN-EDITS-ALLOWED-REC.
304290070301           MOVE "Y"  TO lc_OvrGbv.
304300070301           MOVE lc_AccDtlScreenCode
304310070301                TO SCREEN-CODE OF SCREEN-EDITS-ALLOWED.
304320070301           MOVE lc_OvrGbvEditCode
304330070301                TO EDIT-CODE   OF SCREEN-EDITS-ALLOWED.
304340070301           MOVE lc_OvrGbvLevelCode
304350070306                TO LEVEL-CODE OF SCREEN-EDITS-ALLOWED.
304360070302
304370070227           READ SCREEN-EDITS-ALLOWED
304380070227             INVALID KEY
304390070228               MOVE "N" TO lc_OvrGbv
304400070301           END-READ.
304410070301      * ---------------------------------
304420070301       UpdateGBVIndDate.
304430070301      * ---------------------------------
304440070306      * If OVRGBV edit code is set up and GBV was overriden (OVGBV
304450070306      * attribute exists) then check 'IVGBV' account contract attribute
304460070227      * If IVGBV exists and its Effect Date >= OVGBV Effect Date then
304470070301      * CD-GBV-INDICATOR='N' CD-VALIDATION-DATE=Effect-Date of IVGBV
304480070301      *
304490070301      * If IVGBV doesn't exist and OVGBV exists then
304500070301      * CD-GBV-INDICATOR='N' CD-VALIDATION-DATE=0
304510070302
304520070302           COMPUTE ln_LdaEndDate = Ws-Lda-Enddte
304530070302           EXEC SQL
304540070302           SELECT Effect_Date
304550070301           INTO  :li_OvrGbvEffectDate
304560070302           FROM  Mfaacccap A
304570070301           WHERE A.Account_No  = :Ws-Account-No
304580070302           AND   A.Contract_No = :Ws-Contract-No
304590070301           AND   A.Contract_Attribute_Code = :lncc_OVGBV
304600070227           AND   A.Effect_Date  >  :ln_LdaEndDate
304610070430           AND   A.Effect_Date  <= :ln_SystemDate
304620070430           END-EXEC.
304630070430           IF li_OvrGbvEffectDate NOT = 0
304640070430              EXEC SQL
304650070430                 SELECT Effect_Date
304660070430                 INTO   :Ws-Effect-Date
304670070430                 FROM   Mfaacccap A
304680070430                 WHERE  A.Account_No = :Ws-Account-No
304690070430                 AND    A.Contract_No = :Ws-Contract-No
304700070430                 AND    A.Contract_Attribute_Code = :lncc_IVGBV
304710070430                 AND    A.Effect_Date >= :li_OvrGbvEffectDate
304720070430                 AND    A.Effect_Date <= :ln_SystemDate
304730070430              END-EXEC
304740070430              MOVE lncc_No TO Cd-Gbv-Indicator
304750070430           END-IF.
304760070430      *RFS 38037 End
304770070430      * RFS 38639 - begins.
304780070430      * ---------------------------------
304790070430       Check_GbvRst_Edit_Code.
304800070430      * ---------------------------------
304810081120           Initialize MFAEDTSCP of Screen-Edits-Allowed-Rec
304820081120                                   lc-Edit-GbvRst.
304830081120           Move lc_StmtjsiScrnCode
304840081120             to Screen-Code of Screen-Edits-Allowed-Rec.
304850081120           Move lc_GbvRstEditCode
304860081120             to Edit-Code of Screen-Edits-Allowed-Rec.
304870081120           Move lc_GbvRstLevelCode
304880081120             to LEVEL-Code of Screen-Edits-Allowed-Rec.
304890081120           Call "FXSCEDTALW" Using Screen-Edits-Allowed-Rec,
304900081120                                   lc-Scr-Edit-SqlLog
304910081120                                   lc-Scr-Edit-Return.
304920081120           If lc-Scr-Edit-Return = "99"
304930081120              Move "N" to lc-Edit-GbvRst
304940081120           Else
304950081120              Move "Y" to lc-Edit-GbvRst
304960081120           End-If.
304970081120      *RFS 50492 - Begin
304980081120      * ---------------------------------
304990081120       GetDrfytdEdtCde.
305000081120      * ---------------------------------
305010081120           Initialize MFAEDTSCP of Screen-Edits-Allowed-Rec
305020070430                                   lc_Edit-Drfytd.
305030070430           Move lc_StmtjsiScrnCode
305040070430             to Screen-Code of Screen-Edits-Allowed-Rec.
305050070430           Move lc_DrfytdEditCode
305060070501             to Edit-Code of Screen-Edits-Allowed-Rec.
305070070430           Move lc_DrfytdLevelCode
305080070430             to LEVEL-Code of Screen-Edits-Allowed-Rec.
305090070430           Call "FXSCEDTALW" Using Screen-Edits-Allowed-Rec,
305100070501                                   lc-Scr-Edit-SqlLog
305110070430                                   lc-Scr-Edit-Return.
305120070501           If lc-Scr-Edit-Return = "99"
305130070501              Move "N" to lc_Edit-Drfytd
305140070430           Else
305150070430              Move "Y" to lc_Edit-Drfytd
305160070430           End-If.
305170070430      *RFS 50492 - End
305180070430      * ---------------------------------
305190070430       Create_Tmp_Stm_Extract.
305200070430      * ---------------------------------
305210070430           EXEC SQL
305220070430             CREATE TABLE QTEMP/TMPSTMEXP
305230070430                 AS (SELECT * FROM QTEMP/MFASTMEXP) WITH NO DATA
305240070430           END-EXEC.
305250070430      * ---------------------------------
305260070517       Clear_Tmp_Stm_Extract.
305270070502      * ---------------------------------
305280070502           EXEC SQL DELETE FROM QTEMP/TMPSTMEXP END-EXEC.
305290070501           IF SQLCODE = 100
305300070501              CONTINUE
305310070502           END-IF.
305320070502      * ---------------------------------
305330070502       Insert_Tmp_Stm_Extract.
305340070502      * ---------------------------------
305350070502           MOVE "INSERT INTO TMPSTMEXP " TO WS-SQLERR-STATEMENT.
305360070502           EXEC SQL
305370070501             INSERT INTO TMPSTMEXP VALUES (:TMP-STATEMENT-REC)
305380070501           END-EXEC.
305390070501      * ---------------------------------
305400070501       Process_Tmp_Stm_Extract.
305410070501      * ---------------------------------
305420070501           INITIALIZE  lc_EOF.
305430070502      * Declare a cursor. Sort the statement records by Seg Reset
305440070502      * Number and Investment Code.
305450070502           EXEC SQL
305460070501              DECLARE  C_TMP CURSOR FOR
305470070501              SELECT   A.*,
305480070501                       SUBSTR(STMEX_DATA, 1,9) AS Contract_No,
305490070501                       SUBSTR(STMEX_DATA,24,3) AS Seq_Reset_No
305500070501              FROM     TMPSTMEXP A
305510070501              ORDER BY SUBSTR(STMEX_DATA,24,3),
305520070501                       SUBSTR(STMEX_DATA,19,5)
305530070501              FOR FETCH ONLY
305540070430           END-EXEC.
305550070501           EXEC SQL
305560070430              OPEN  C_TMP
305570070502           END-EXEC.
305580070502           EXEC SQL
305590070502             FETCH FROM C_TMP INTO :TMP-STATEMENT-REC,
305600070502                                   :TMP-STMTX-CONTRACT-NO,
305610070502                                   :TMP-STMTX-RESET-NO
305620070502           END-EXEC.
305630130203           IF SQLCODE = 100
305640130203              SET EOF TO TRUE
305650130203           END-IF.
305660130203           PERFORM Write_Stm_Extract until EOF.
305670070502           EXEC SQL
305680070514              CLOSE C_TMP
305690070514           END-EXEC.
305700070514      * ---------------------------------
305710070514       Write_Stm_Extract.
305720070514      * ---------------------------------
305730070514           INITIALIZE  Total_RC_Base_Values.
305740070514           MOVE TMP-STMTX-RESET-NO  TO  SAV-TMP-STMTX-RESET-NO.
305750070514           PERFORM UNTIL EOF  OR  SAV-TMP-STMTX-RESET-NO NOT =
305760090727                                      TMP-STMTX-RESET-NO
305770090729             INITIALIZE RESET-CONTRACT-DETAILS
305780090729             MOVE TMP-STATEMENT-REC        TO  RESET-CONTRACT-DETAILS
305790090729118007***    COMPUTE li_Seq_No_Cnt = li_Seq_No_Cnt + 1
305800090729118007***    MOVE    li_Seq_No_Cnt         TO  TMP-STMTX-SECTION-SEQ
305810090729118007       COMPUTE WS-ACC-SEG90-COUNT = WS-ACC-SEG90-COUNT + 1
305820090729118007       MOVE    WS-ACC-SEG90-COUNT    TO  TMP-STMTX-SECTION-SEQ
305830090729
305840110506             ADD RC-OLD-GUARANTEE-BASE-BASE OF RESET-CONTRACT-DETAILS
305850110506                                            TO Tot-RC-Old-Guar-Base-B
305860110506             ADD RC-NEW-GUARANTEE-BASE-BASE OF RESET-CONTRACT-DETAILS
305870110506                                            TO Tot-RC-New-Guar-Base-B
305880110506             ADD RC-OLD-GUARANTEE-BASE      OF RESET-CONTRACT-DETAILS
305890110506                                            TO Tot-RC-Old-Guar-Base
305900110506             ADD RC-NEW-GUARANTEE-BASE      OF RESET-CONTRACT-DETAILS
305910110506                                            TO Tot-RC-New-Guar-Base
305920110506R64262       ADD RC-OLD-GUARANTEE-DEATH     OF RESET-CONTRACT-DETAILS
305930110506  |                                    TO Tot-RC-Old-Guar-Death-Base
305940110506  |          ADD RC-NEW-GUARANTEE-DEATH     OF RESET-CONTRACT-DETAILS
305950110506  |                                    TO Tot-RC-New-Guar-Death-Base
305960110506  |          ADD RC-OLD-GUARANTEE-MAT-VALUE OF RESET-CONTRACT-DETAILS
305970110506  |                                    TO Tot-RC-Old-Guar-Mat-value
305980110506  V          ADD RC-NEW-GUARANTEE-MAT-VALUE OF RESET-CONTRACT-DETAILS
305990110506R64262                                 TO Tot-RC-New-Guar-Mat-value
306000110506      * RFS63488 Begin
306010110506             IF  RC-OLD-GUAR-BASE-BASE-2-SIGN  = '+'
306020070502                 ADD RC-OLD-GUAR-BASE-BASE-2 OF RESET-CONTRACT-DETAILS
306030070502                             TO Tot-RC-Old-Guar-B-B-2
306040070502             ELSE
306050070502                 SUBTRACT RC-OLD-GUAR-BASE-BASE-2 OF
306060070502                          RESET-CONTRACT-DETAILS
306070070502                 From Tot-RC-Old-Guar-B-B-2
306080070502             END-IF
306090070502             IF  RC-OLD-GUAR-BASE-2-SIGN  = '+'
306100070502                 ADD RC-OLD-GUAR-BASE-2 OF RESET-CONTRACT-DETAILS
306110070502                             TO Tot-RC-Old-Guar-B-2
306120070502             ELSE
306130070502                 SUBTRACT RC-OLD-GUAR-BASE-2 OF
306140070502                          RESET-CONTRACT-DETAILS
306150070502                 From Tot-RC-Old-Guar-B-2
306160070501             END-IF
306170070502      * RFS63488 End
306180070501             MOVE "INSERT INTO MFASTMEXP " TO  WS-SQLERR-STATEMENT
306190070502             EXEC SQL
306200091110               INSERT INTO MFASTMEXP VALUES (:TMP-STATEMENT-REC)
306210091110             END-EXEC
306220070502             EXEC SQL
306230070502               FETCH FROM C_TMP INTO :TMP-STATEMENT-REC,
306240091110                                     :TMP-STMTX-CONTRACT-NO,
306250091110                                     :TMP-STMTX-RESET-NO
306260070502             END-EXEC
306270070502             IF SQLCODE = 100
306280070502                SET EOF TO TRUE
306290130203             END-IF
306300070502           END-PERFORM.
306310070502           PERFORM Format_And_Write_Total_Rec.
306320070502      * ---------------------------------
306330070502       Format_And_Write_Total_Rec.
306340070502      * ---------------------------------
306350070502           INITIALIZE TOT-STATEMENT-REC.
306360070502R74979     MOVE RC-RESET-CATEGORY       TO TOT-RESET-CATEGORY.
306370070502R74979     MOVE RC-RESET-TYPE           to TOT-RESET-TYPE.
306380130203           INITIALIZE RESET-CONTRACT-DETAILS.
306390130203           MOVE SAV-TMP-STMTX-RESET-NO    TO  RC-RESET-NUMBER.
306400130203R74979     MOVE TOT-RESET-CATEGORY        TO  RC-RESET-CATEGORY.
306410130203R74979     MOVE TOT-RESET-TYPE            TO  RC-RESET-TYPE.
306420070502           MOVE TMP-STMTX-INVESTOR-NO     TO  RC-INVESTOR-NO.
306430070502           MOVE TMP-STMTX-ACCOUNT-NO      TO  RC-ACCOUNT.
306440070502           MOVE TMP-STMTX-SECTION-NO      TO  RC-SECTION-NO.
306450070502118007***  MOVE TMP-STMTX-SECTION-SEQ     TO  RC-SECTION-SEQUENCE.
306460070502           MOVE TMP-STMTX-LANGUAGE-CODE   TO  RC-LANGUAGE.
306470090727           MOVE TMP-STMTX-DEALER-CODE     TO  RC-DEALER.
306480090727           MOVE TMP-STMTX-DEALER-REP-CODE TO  RC-SALESREP.
306490090729           MOVE TMP-STMTX-CONTRACT-NO     TO  RC-CONTRACT-NO.
306500090729           MOVE TMP-STMTX-SECTION-SEQ-2   TO  RC-SECTION-SEQUENCE-2.
306510090729           MOVE TMP-STMTX-START-DATE      TO  RC-START-DATE.
306520090729           MOVE TMP-STMTX-END-DATE        TO  RC-END-DATE.
306530110506           MOVE TMP-STMTX-EOR-IND         TO  RC-EOR-INDICATOR.
306540110506118007***  COMPUTE li_Seq_No_Cnt = li_Seq_No_Cnt + 1.
306550110506118007***  MOVE    li_Seq_No_Cnt        TO  RC-SECTION-SEQUENCE.
306560110506118007     COMPUTE WS-ACC-SEG90-COUNT = WS-ACC-SEG90-COUNT  + 1.
306570110506118007     MOVE    WS-ACC-SEG90-COUNT   TO  RC-SECTION-SEQUENCE.
306580110506           MOVE 'TOTAL'                 TO  RC-INVESTMENT-CODE.
306590110506           MOVE Tot-RC-Old-Guar-Base-B  TO  RC-Old-Guarantee-Base-Base.
306600110506           MOVE Tot-RC-New-Guar-Base-B  TO  RC-New-Guarantee-Base-Base.
306610110506           MOVE Tot-RC-Old-Guar-Base    TO  RC-Old-Guarantee-Base.
306620110506           MOVE Tot-RC-New-Guar-Base    TO  RC-New-Guarantee-Base.
306630110506R64262     MOVE Tot-RC-Old-Guar-Death-Base TO RC-OLD-GUARANTEE-DEATH.
306640110506R64262     MOVE Tot-RC-New-Guar-Death-Base TO RC-NEW-GUARANTEE-DEATH.
306650110506R64262     MOVE Tot-RC-Old-Guar-Mat-value
306660110506                                   TO RC-OLD-GUARANTEE-MAT-VALUE.
306670110506R64262     MOVE Tot-RC-New-Guar-Mat-value
306680110601                                   TO RC-NEW-GUARANTEE-MAT-VALUE.
306690110601      *  RFS63488 Begin
306700110506           MOVE Tot-RC-Old-Guar-B-B-2
306710070502                                   TO RC-OLD-GUAR-BASE-BASE-2.
306720070502           IF Tot-RC-Old-Guar-B-B-2  < 0
306730070502              MOVE '-' TO RC-OLD-GUAR-BASE-BASE-2-SIGN
306740070502           ELSE
306750070430              MOVE '+' TO RC-OLD-GUAR-BASE-BASE-2-SIGN
306760070724           END-IF
306770070724           MOVE Tot-RC-Old-Guar-B-2
306780070724                                   TO RC-OLD-GUAR-BASE-2.
306790070724           IF Tot-RC-Old-Guar-B-2  < 0
306800070724              MOVE '-' TO RC-OLD-GUAR-BASE-2-SIGN
306810070724           ELSE
306820070724              MOVE '+' TO RC-OLD-GUAR-BASE-2-SIGN
306830070724           END-IF
306840070724           MOVE lc-Series  TO Lc-Series14
306850070724           MOVE lc-Series5 TO RC-SERIES-TYPE
306860070724      *  RFS63488 End
306870070724           MOVE RESET-CONTRACT-DETAILS  TO  TOT-STATEMENT-REC.
306880070724           EXEC SQL
306890070724             INSERT INTO MFASTMEXP VALUES (:TOT-STATEMENT-REC)
306900070724           END-EXEC.
306910070724      * RFS 38639 - ends.
306920070724      * RFS37906 - Begins                                              *
306930070724      *  Get Guaranteed Death Value Reset on ADHOC state'mt Job        *
306940070724       GET-GDV-BY-SEL-ENDDTE.
306950070724           INITIALIZE WS-NET-DEPOSITG-VALUE
306960070724                      WS-GUAR-DEATHG-VAL
306970080925                      WS-CI-UNITSG-TEMP
306980080925           IF NOT FIRST-PASSG
306990070724              GO TO GGB-0003
307000070724           END-IF
307010070724           MOVE ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC
307020070724             TO WS-PARMG-ACCOUNT-NO
307030070724           MOVE CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC
307040070724             TO WS-PARMG-CONTRACT-NO
307050070724           MOVE WS-LDA-ENDDTE
307060070724             TO WS-PARMG-END-DATE
307061211007111744        INITIALIZE ln_InvArraySize
307062211007111744        MOVE ln_InvArrayInitialSize TO ln_InvArraySize
307070070724           INITIALIZE WS-PARMG-ACC-CON-INV-ARRAY-DEF
307071211007111744     PERFORM VARYING IVS-CNT1 FROM 1 BY 1
307072211007111744             UNTIL IVS-CNT1 > ln_InvArraySize
307073211012111744*     INITIALIZE WS-PARM-ARRAY-ACCOUNT-NO(IVS-CNT1)
307074211012111744*                WS-PARM-ARRAY-CONTRACT-NO(IVS-CNT1)
307075211012111744*                WS-PARM-ARRAY-INVESTMENT-CODE(IVS-CNT1)
307076211012111744*                WS-PARM-ARRAY-NET-DEP-VALUE(IVS-CNT1)
307077211012111744*                WS-PARM-ARRAY-GUAR-BASE-VALUE(IVS-CNT1)
307078211012111744*                WS-PARM-ARRAY-CURR-UNIT-BAL(IVS-CNT1)
307079211012111744*                WS-PARM-ARRAY-GUAR-DTH-VALUE(IVS-CNT1)
307081211012112133     INITIALIZE WS-PARMG-ARRAY-ACCOUNT-NO(IVS-CNT1)
307082211012112133                WS-PARMG-ARRAY-CONTRACT-NO(IVS-CNT1)
307083211012112133                WS-PARMG-ARRAY-INVESTMENT-CODE(IVS-CNT1)
307084211012112133                WS-PARMG-ARRAY-NET-DEP-VAL(IVS-CNT1)
307085211012112133                WS-PARMG-ARRAY-GUAR-DEATH-VAL(IVS-CNT1)
307086211012112133                WS-PARMG-ARRAY-CURR-UNIT-BAL(IVS-CNT1)
307087211017111744     END-PERFORM
307088070724           CALL "TRCODCALD"  USING WS-PARMG-ACCOUNT-NO
307090070724                                   WS-PARMG-CONTRACT-NO
307100070724                                   WS-PARMG-END-DATE
307110070724                                   WS-PARMG-ACC-CON-INV-ARRAY-DEF
307120211017           MOVE "N"
307130070724R50823*  Added a '.' at the end of the following statement
307140070724             TO WS-FIRST-PASSG-FLAG.
307150070724       GGB-0003.
307160070724           SET WS-ACIIDXG TO 1
307170070724           SEARCH WS-PARMG-ACC-CON-INV-ARRAY VARYING WS-ACIIDXG
307180070724             WHEN WS-PARMG-ARRAY-ACCOUNT-NO(WS-ACIIDXG)  =
307190070724                  ACCOUNT-NO OF ACCOUNT-CONTRACT-INV-REC AND
307200070724                  WS-PARMG-ARRAY-CONTRACT-NO(WS-ACIIDXG) =
307210070724                  CONTRACT-NO OF ACCOUNT-CONTRACT-INV-REC AND
307220070724                  WS-PARMG-ARRAY-INVESTMENT-CODE(WS-ACIIDXG) =
307230070724                  INVESTMENT-CODE OF ACCOUNT-CONTRACT-INV-REC
307240070724                  GO TO GGB-0005
307250090609             WHEN WS-PARMG-ARRAY-ACCOUNT-NO(WS-ACIIDXG)      = 0 OR
307260090609                  WS-PARMG-ARRAY-CONTRACT-NO(WS-ACIIDXG)     = 0 OR
307270090609                  WS-PARMG-ARRAY-INVESTMENT-CODE(WS-ACIIDXG) = " "
307280090819                  GO TO GGB-EXIT
307290090819           END-SEARCH.
307300090609       GGB-0005.
307310090609           MOVE WS-PARMG-ARRAY-NET-DEP-VAL(WS-ACIIDXG)
307320090609             TO WS-NET-DEPOSITG-VALUE
307330090609           MOVE WS-PARMG-ARRAY-GUAR-DEATH-VAL(WS-ACIIDXG)
307340090609             TO WS-GUAR-DEATHG-VAL
307350090610           MOVE WS-PARMG-ARRAY-CURR-UNIT-BAL(WS-ACIIDXG)
307360090610             TO WS-CI-UNITSG-TEMP
307370090610               .
307380090609       GGB-EXIT.
307390090610           EXIT.
307400090609      * RFS37906 - Ends                                                *
307410090610      * RFS57388 - Begin                                               *
307420090610      *  Get Guaranteed Death Criteria Sched record if exists          *
307430090610       GetGuarDeathCriteriaSched.
307440090610           MOVE GDV-SCHED-CODE OF INVESTMENT-SEG-REC
307450090610                                    TO GDV-SCHED-CODE
307460090610                                    OF GUAR-DEATH-CRITERIA-SCHED-REC.
307470090610           MOVE ZEROS               TO START-DATE
307480090610                                    OF GUAR-DEATH-CRITERIA-SCHED-REC.
307490090610           MOVE ZEROS               TO END-DATE
307500090819                                    OF GUAR-DEATH-CRITERIA-SCHED-REC.
307510090819           MOVE SPACES              TO ACCOUNT-TYPE-CODE
307520090609                                    OF GUAR-DEATH-CRITERIA-SCHED-REC.
307530090610           MOVE SPACES              TO RESET-TYPE
307540090610                                    OF GUAR-DEATH-CRITERIA-SCHED-REC.
307550090610           SET lc_ProcessGDCSYes TO TRUE.
307560090610           START GUAR-DEATH-CRITERIA-SCHED
307570090610               KEY IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
307580090610               INVALID KEY SET lc_ProcessGDCSNo TO TRUE
307590130716           END-START
307600130716           IF lc_ProcessGDCSYes
307610130716             READ GUAR-DEATH-CRITERIA-SCHED NEXT
307620130716               AT END SET lc_ProcessGDCSNo TO TRUE.
307630090610           PERFORM ProcessGuarDeathCriteriaSched UNTIL lc_ProcessGDCSNo.
307640090610       ProcessGuarDeathCriteriaSched.
307650090610           EVALUATE TRUE
307660090610           WHEN GDV-SCHED-CODE OF GUAR-DEATH-CRITERIA-SCHED-REC
307670090610                 IS NOT EQUAL TO GDV-SCHED-CODE
307680090610                              OF INVESTMENT-SEG-REC
307690090610                  SET lc_ProcessGDCSNo TO TRUE
307700090610           WHEN START-DATE OF GUAR-DEATH-CRITERIA-SCHED-REC >
307710090610                START-DATE OF ACCOUNT-CONTRACT-REC
307720090610                  SET lc_ProcessGDCSNo TO TRUE
307730190919           WHEN ACCOUNT-TYPE-CODE OF GUAR-DEATH-CRITERIA-SCHED-REC
307740200303183449*                  IS EQUAL AD-ACCOUNT-TYPE-SHORT OR SPACES
307750200303      *RFS 1027770 - Begin
307760200303183449*                  IS EQUAL ACACTYP OR SPACES
307770200303                         IS EQUAL PREV-ACCOUNT-TYPE OR SPACES
307780090610      *RFS 1027770 - End
30779013052499973 *    AND RESET-TYPE OF GUAR-DEATH-CRITERIA-SCHED-REC
30780013052499973 *                  IS EQUAL lncc_GDV
30781013052499973      AND (RESET-TYPE OF GUAR-DEATH-CRITERIA-SCHED-REC
30782013052499973                    IS EQUAL lncc_GDV OR lncc_GBV)
307830130614           AND START-DATE OF GUAR-DEATH-CRITERIA-SCHED-REC <=
307840130614               START-DATE OF ACCOUNT-CONTRACT-REC
307850130524           AND   END-DATE OF GUAR-DEATH-CRITERIA-SCHED-REC >=
307860130524               START-DATE OF ACCOUNT-CONTRACT-REC
307870130524                 SET lncc_resetAutoGDVYes TO TRUE
307880130524                 SET lc_ProcessGDCSNo TO TRUE
307890130524           END-EVALUATE.
307900130524           IF lc_ProcessGDCSYes
307910130524              READ GUAR-DEATH-CRITERIA-SCHED NEXT
307920130524                AT END
307930130524                  SET lc_ProcessGDCSNo TO TRUE
307940130614           END-READ.
307950130524      * RFS 115161 - Start
307960130524       Populate-Acct-Ann-routine.
307970130524           SET lb_InvaliddataFalse TO TRUE.
307980130524           INITIALIZE MFAACCNNP.
307990130614117038*QC32062    MOVE ACCOUNT-NO  OF ACCOUNT-CONTRACT-REC
308000130614117038     MOVE PREV-ACCOUNT
308010130524                            TO ACCOUNT-NO OF ACCOUNT-ANNUITANT-REC.
308020130524           START ACCOUNT-ANNUITANT
308030130524             KEY   IS NOT LESS THAN EXTERNALLY-DESCRIBED-KEY
308040130524             INVALID KEY
308050130524                SET lb_InvaliddataTrue TO TRUE
308060130524             NOT INVALID KEY
308070130524                PERFORM Read-Account-Annuitant
308080130524                        UNTIL lb_InvaliddataTrue
308090130524           END-START.
308100130524117038     Read-Account-Annuitant.
308110130524           READ ACCOUNT-ANNUITANT  NEXT RECORD
308120130524             AT END
308130130524                SET lb_InvaliddataTrue TO TRUE
308140130524           END-READ.
308150130524117038*QC32062    IF ACCOUNT-NO  OF ACCOUNT-CONTRACT-REC NOT =
308160130524117038     IF PREV-ACCOUNT NOT =
308170130524                             ACCOUNT-NO OF ACCOUNT-ANNUITANT-REC
308180130524             SET lb_InvaliddataTrue TO TRUE
308190130524           END-IF.
308200130524           IF lb_InvaliddataFalse
308210130524           PERFORM FORMAT-SEG45-ADDRESS-ROUTINE THRU FSA-EXIT
308220130524           ADD 1                       TO  WS-ACC-SEG45-COUNT
308230130524           INITIALIZE ANNUITANT-DETAILS
308240130524           MOVE AD-INVESTOR-NO         TO AN-INVESTOR-NO
308250130524           MOVE ACCOUNT-NO OF ACCOUNT-ANNUITANT-REC TO AN-ACCOUNT
308260130524           MOVE "45"                   TO AN-SECTION-NO
308270130524           MOVE WS-ACC-SEG45-COUNT     TO AN-SECTION-SEQUENCE
308280130524           MOVE AD-LANGUAGE            TO AN-LANGUAGE
308290130524           MOVE AD-DEALER              TO AN-DEALER
308300130524           MOVE AD-SALESREP            TO AN-SALESREP
308310130524           MOVE ZEROES                 TO AN-CONTRACT-NO
308320130524           MOVE SPACES                 TO AN-CONTRACT-XREF
308330130524           MOVE DEFAULT-FLAG        OF ACCOUNT-ANNUITANT-REC
308340130524                                       TO AN-SUCCESSOR-ANNUITANT
308350130524           MOVE ANNUITANT-STATUS    OF ACCOUNT-ANNUITANT-REC
308360130524                                       TO AN-ANNUITANT-STATUS
308370130524           MOVE LAST-NAME           OF ACCOUNT-ANNUITANT-REC
308380130524                                       TO AN-LAST-NAME
308390130524           MOVE INITIALS            OF ACCOUNT-ANNUITANT-REC
308400130524                                       TO AN-INITIALS
308410130524           MOVE FIRST-NAME          OF ACCOUNT-ANNUITANT-REC
308420130524                                       TO AN-FIRST-NAME
308430130524           MOVE SALUTATION-CODE     OF ACCOUNT-ANNUITANT-REC
308440130524                                       TO AN-SALUTATION-CODE
308450130524           MOVE SOCIAL-INSURANCE-NO OF ACCOUNT-ANNUITANT-REC
308460130524                                       TO AN-SOCIAL-INSURANCE-NO
308470130524           MOVE DATE-OF-BIRTH       OF ACCOUNT-ANNUITANT-REC
308480130524                                       TO AN-DATE-OF-BIRTH
308490130524           MOVE SEX                 OF ACCOUNT-ANNUITANT-REC
308500130524                                       TO AN-SEX
308510130524           MOVE LANGUAGE-CODE       OF ACCOUNT-ANNUITANT-REC
308520130524                                       TO AN-LANGUAGE-CODE
308530130524           MOVE DEATH-PROCESS-DATE  OF ACCOUNT-ANNUITANT-REC
308540130524                                       TO AN-DEATH-PROCESS-DATE
308550130524           MOVE ANNUITANT-DEATH     OF ACCOUNT-ANNUITANT-REC
308560130524                                       TO AN-ANNUITANT-DEATH
308570130524           MOVE WS-AN-ADDRESS1         TO AN-ADDRESS1
308580120627           MOVE WS-AN-ADDRESS2         TO AN-ADDRESS2
308590120627           MOVE WS-AN-ADDRESS3         TO AN-ADDRESS3
308600120627           MOVE WS-AN-ADDRESS4         TO AN-ADDRESS4
308610120627           MOVE WS-AN-ADDRESS5         TO AN-ADDRESS5
308620120627           MOVE POSTAL-CODE         OF ADDRESS-RECD
308630120627                                       TO AN-POSTAL-CODE
308640120627           MOVE HOLD-MAIL           OF ADDRESS-RECD
308650120627                                       TO AN-HOLD-MAIL
308660120627           MOVE AD-SECTION-SEQUENCE-2  TO AN-SECTION-SEQUENCE-2
308670120627           MOVE AD-START-DATE          TO AN-START-DATE
308680120627           MOVE AD-END-DATE            TO AN-END-DATE
308690120627           MOVE AD-EOR-INDICATOR       TO AN-EOR-INDICATOR
308700120627           MOVE ANNUITANT-DETAILS TO STATEMENT-REC(ISR)
308710120627           PERFORM INSERT-STATEMENT-REC THRU ISR-EXIT
308720120627           END-IF.
308730120627      * RFS 115161 -End
308731211011      * RFS186199 Starts*
308732210914       FUND-LONG-DESC-83.
308733210914           INITIALIZE FUND-LONG-DESC-SECTION.
308734210914
308735210914           MOVE AD-INVESTOR-NO          TO FLD-INVESTOR-NO.
308736210914           MOVE AD-ACCOUNT              TO FLD-ACCOUNT.
308737211011           MOVE "83"                    TO FLD-SECTION-NO.
308738210914           MOVE AD-SECTION-SEQUENCE     TO FLD-SECTION-SEQUENCE.
308739210914           MOVE AD-LANGUAGE             TO FLD-LANGUAGE.
308740210914           MOVE AD-DEALER               TO FLD-DEALER.
308741210914           MOVE AD-SALESREP             TO FLD-SALESREP.
308742211012           MOVE AD-SECTION-SEQUENCE-2   TO FLD-SECTION-SEQUENCE-2.
308743210914           MOVE AD-START-DATE           TO FLD-START-DATE.
308744210914           MOVE AD-END-DATE             TO FLD-END-DATE.
308745210914           MOVE AD-EOR-INDICATOR        TO FLD-EOR-INDICATOR.
308746210914           SET FNDLDESC-IDX TO 1.
308747210914           SEARCH WS-FND-LNG-DESC-ARR-DTL VARYING FNDLDESC-IDX
308748210914             AT END
308749210914                GO TO FLDSC-EXIT
308750210914             WHEN WS-FNDLDESC-INVESTMENT-CODE(FNDLDESC-IDX)
308751210914                 = WS-IC-CODE(IC)
308752210914              MOVE WS-FNDLDESC-INVESTMENT-CODE(FNDLDESC-IDX)
308753210914                TO FLD-INVESTMENT-CODE
308754210914              MOVE WS-FNDLDESC-ENGLISH(FNDLDESC-IDX)
308755210914                TO FLD-ENGLISH
308756210914              MOVE WS-FNDLDESC-FRENCH(FNDLDESC-IDX)
308757210914                TO FLD-FRENCH
308758210914           END-SEARCH.
308759210914
308760210914       FLDSC-EXIT.
308761210914           EXIT.
308762210914
308763210914      * RFS186199 Ends*
308764211003      * RSF186592 STarts*
308765211003       ACCOUNT-RESET-LEVEL.
308766211003
308767211003           SET lb_Rec_ExistYes To TRUE.
308768211003           SET ARIDX TO 1.
308769211003
308770211003           SEARCH WS-AR-REC  VARYING ARIDX
308771211003             AT END
308772211003                SET lb_Rec_ExistNo TO TRUE
308773211003             WHEN AR-RESET-TYPE(ARIDX) = WS-RESET-TYPE AND
308774211003                  AR-EFFECTIVE-DATE(ARIDX) = EFFECT-DATE OF
308775211003                                             ACCOUNT-CON-INV-SET-REC
308776211003              ADD OLD-GUAR-BASE-VALUE-CUR
308777211003               OF ACCOUNT-CON-INV-SET-REC TO AR-OLD-GUAR-BASE(ARIDX)
308778211003              ADD NEW-GUAR-BASE-VALUE-CUR
308779211003               OF ACCOUNT-CON-INV-SET-REC TO AR-NEW-GUAR-BASE(ARIDX)
308780211003           END-SEARCH.
308781211003
308782211003           IF lb_Rec_ExistNo
308783211003              ADD 1    TO   ln_AccResetLvlCnt
308784211003              SET ARIDX TO ln_AccResetLvlCnt
308785211003              MOVE WS-RESET-ACCOUNT-NO     TO AR-ACCOUNT-NO(ARIDX)
308786211003              MOVE WS-RESET-TYPE           TO AR-RESET-TYPE(ARIDX)
308787211003              MOVE EFFECT-DATE
308788211003                 OF ACCOUNT-CON-INV-SET-REC TO AR-EFFECTIVE-DATE(ARIDX)
308789211003              MOVE OLD-GUAR-BASE-VALUE-CUR
308790211003                 OF ACCOUNT-CON-INV-SET-REC TO AR-OLD-GUAR-BASE(ARIDX)
308791211003              MOVE NEW-GUAR-BASE-VALUE-CUR
308792211003                 OF ACCOUNT-CON-INV-SET-REC TO AR-NEW-GUAR-BASE(ARIDX)
308793211003           END-IF.
308794211003
308795211003           IF WS-RESET-TYPE = lncc_GDV
308796211003              IF EFFECT-DATE
308797211003                   OF ACCOUNT-CON-INV-SET-REC > ln_GDV-EffectiveDate
308798211003                 MOVE EFFECT-DATE
308799211003                   OF ACCOUNT-CON-INV-SET-REC TO ln_GDV-EffectiveDate
308800211003              END-IF
308801211003           ELSE
308802211003              IF EFFECT-DATE
308803211003                   OF ACCOUNT-CON-INV-SET-REC > ln_GBV-EffectiveDate
308804211003                 MOVE EFFECT-DATE
308805211003                   OF ACCOUNT-CON-INV-SET-REC TO ln_GBV-EffectiveDate
308806211003              END-IF
308807211003           END-IF.
308808211003
308809211003       PROCESS-ACCOUNT-RESET-LEVEL.
308810211003
308811211003           PERFORM VARYING ARIDX FROM 1 BY 1 UNTIL
308812211003                  AR-RESET-TYPE(ARIDX) IS EQUAL TO SPACES
308813211003                  OR ARIDX > ln_AccResetLvlCnt
308814211003             MOVE AR-ACCOUNT-NO(ARIDX)    TO ln_AccResetAccNo
308815211003             MOVE AR-RESET-TYPE(ARIDX)    TO lc_ResetTyp
308816211003             MOVE AR-OLD-GUAR-BASE(ARIDX) TO ln_Old-Guar-Base
308817211003             MOVE AR-NEW-GUAR-BASE(ARIDX) TO ln_New-Guar-Base
308818211003             ADD 1                        TO ln_SectionSeqNoAR
308819211003             PERFORM WRITE-ACCRESET-LEVEL-REC
308820211003           END-PERFORM.
308821211003
308822211003       WRITE-ACCRESET-LEVEL-REC.
308823211003
308824211003           INITIALIZE RESET-CONTRACT-DETAILS
308825211003                      TMP-STATEMENT-REC.
308826211003           MOVE AD-INVESTOR-NO         TO RC-INVESTOR-NO.
308827211003           MOVE ln_AccResetAccNo       TO RC-ACCOUNT.
308828211003           MOVE "90"                   TO RC-SECTION-NO.
308829211003           MOVE ln_SectionSeqNoAR      TO RC-SECTION-SEQUENCE.
308830211003           MOVE AD-LANGUAGE            TO RC-LANGUAGE.
308831211003           MOVE AD-DEALER              TO RC-DEALER.
308832211003           MOVE AD-SALESREP            TO RC-SALESREP.
308833211003           IF lc_ResetTyp = 'GDV'
308834211003              MOVE ln_GDV-EffectiveDate TO RC-EFFECTIVE-DATE
308835211003           ELSE
308836211003              MOVE ln_GBV-EffectiveDate TO RC-EFFECTIVE-DATE
308837211003           END-IF.
308838211003           MOVE lc_ResetTyp            TO RC-RESET-TYPE.
308839211003           MOVE ln_Old-Guar-Base       TO RC-OLD-GUARANTEE-BASE.
308840211003           MOVE ln_New-Guar-Base       TO RC-NEW-GUARANTEE-BASE.
308841211003           MOVE AD-START-DATE          TO RC-START-DATE.
308842211003           MOVE AD-END-DATE            TO RC-END-DATE.
308843211003           MOVE 999999                 TO RC-SECTION-SEQUENCE-2.
308844211003           MOVE RESET-CONTRACT-DETAILS TO TMP-STATEMENT-REC.
308845211003           MOVE "WRITE ACCRESET LEVEL REC " TO  WS-SQLERR-STATEMENT.
308846211003
308854211003           EXEC SQL
308855211003             INSERT INTO MFASTMEXP VALUES (:TMP-STATEMENT-REC)
308856211003           END-EXEC.
308857211003      * RSF186592 Ends*
308945210914
308946140707109016* RFS Start
308947140707  |   * ---------------------------------
308948140707  |    ValidateDate.
308949140519  |   * ---------------------------------
308950140519  |         INITIALIZE lc_TestDate_Flag
308951140519  |         Perform until lc_DatOK
308952090609  |           CALL "VALDATEFMT" USING lc_TestDate
308953140417  |                                   lc_TestDate_Flag
308954140417  |           If lc_DatNotOK and lc_TestDate not = Spaces and
308955140417  |                              li_TestDateNm not <= 0
308956091210  |               Compute li_TestDateNm = li_TestDateNm - 1
308957091210  |           Else
308958091210  |               Move 'Y' to lc_TestDate_Flag
308959091210  |           End-If
308960091210  V         End-Perform.
308961150731109016* RFS End
308962211003      * RFS186592 STarts*
308963211003      *----------------------------------
308964211003       GET-RESET-OPTION-CODE.
308965211003      *----------------------------------
308966211003           MOVE "GET-RESET-OPTION-CODE DBRSTCount"
308967211003                                 TO WS-SQLERR-STATEMENT.
308968211003           INITIALIZE ln_DBRSTCount,
308969211003                      ln_MBRSTCount.
308970211003
308971211003           EXEC SQL
308972211003             SELECT COUNT(1)
308973211003             INTO  :ln_DBRSTCount
308974211003             FROM MFAACCATP
308975211003             WHERE ACCOUNT_NO   = :li_AccNo
308976211003               AND ACCOUNT_ATTRIBUTE_CODE = :lncc_DBRST
308977211003           END-EXEC.
308978211003
308979211003           MOVE SQLSTATE   TO lc_sqlStates
308980211003           IF lncc_sqlSuccessful OR lncc_sqlEnd
308981211003                CONTINUE
308982211003           ELSE
308983211003           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
308984211003                GO TO SQLLOG
308985211003           END-IF.
308986211003           MOVE "GET-RESET-OPTION-CODE MBRSTCount"
308987211003                                 TO WS-SQLERR-STATEMENT.
308988211003           EXEC SQL
308989211003             SELECT COUNT(1)
308990211003             INTO  :ln_MBRSTCount
308991211003             FROM MFAACCATP
308992211003             WHERE ACCOUNT_NO   = :li_AccNo
308993211003               AND ACCOUNT_ATTRIBUTE_CODE = :lncc_MBRST
308994211003           END-EXEC.
308995211003
308996211003           MOVE SQLSTATE   TO lc_sqlStates
308997211003           IF lncc_sqlSuccessful OR lncc_sqlEnd
308998211003                CONTINUE
308999211003           ELSE
309000211003           IF NOT lncc_sqlSuccessful AND NOT lncc_sqlEnd
309001211003                GO TO SQLLOG
309002211003           END-IF.
309003211003
309004211003           IF ln_DBRSTCount > 0 AND ln_MBRSTCount > 0
309005211003              MOVE "4"   TO IS2-GUAR-RESET-OPTION-CODE
309006211003           ELSE
309007211003           IF ln_MBRSTCount > 0
309008211003              MOVE "3"   TO IS2-GUAR-RESET-OPTION-CODE
309009211003           ELSE
309010211003           IF ln_DBRSTCount > 0
309011211003              MOVE "2"   TO IS2-GUAR-RESET-OPTION-CODE
309012211003           ELSE
309013211003              MOVE "1"   TO IS2-GUAR-RESET-OPTION-CODE
309014211003           END-IF
309015211003           END-IF
309016211003           END-IF.
309017211003      * RFS186592 Ends*
309074201211      * RFS186198 START
309075201211      *----------------------------------
309076201211       GetACINVGInvstruc.
309077201211      *----------------------------------
309078201211           INITIALIZE lc_ACINVGInvStruc.
309079201211           EXEC SQL
309080201211             SELECT ISTFNP.INVESTMENT_STRUCTURE_CODE
309081201211             INTO  :lc_ACINVGInvStruc
309082201211             FROM  MFAACCCIP ACCCIP
309083201211             LEFT JOIN MFAISTFNP ISTFNP ON
309084201211               ACCCIP.INVESTMENT_CODE = ISTFNP.INVESTMENT_CODE
309085201211               AND ISTFNP.FUNCTION_CODE = :lncc_ACINVG
309086201211             WHERE ACCCIP.ACCOUNT_NO   = :Ws-Account-No
309087201211               AND ACCCIP.CONTRACT_NO = :Ws-Contract-No
309088201211             FETCH FIRST ROW ONLY
309089201211           END-EXEC.
309090201215           MOVE SQLSTATE   TO lc_sqlStates.
309091201215           IF lncc_sqlSuccessful
309092201215              CONTINUE
309093201215           ELSE
309100201215              INITIALIZE lc_ACINVGInvStruc
309110201215           END-IF.
309120201211      * RFS186198 END
309130150731132121     EXEC SQL
309140150731132121       INCLUDE  CPYSTM16AA
309150150731132121     END-EXEC.
309160150731130239     EXEC SQL
309170161024130239       INCLUDE  CPYANSC12B
309180161024130239     END-EXEC.
309190161024      * RFS57388 - Ends                                                *
309200161024129378     EXEC SQL
309210161024129378       INCLUDE  CPYATGICIM
309220161024129378     END-EXEC.
309230030825      * RFS69515 Begin
309240030825           EXEC SQL
309250030825             INCLUDE CPYSTMRDSP
309260030825           END-EXEC.
309270030825      * RFS69515 End
309280030825      * RFS149292 STARTS
309290030825           EXEC SQL
309300030825             INCLUDE CPYSTMT67
309310030825           END-EXEC.
309320030825      * RFS 149292 ENDS
309330030825156507     EXEC SQL
309340030825156507       INCLUDE CPYSTMSLR1
309350030825156507     END-EXEC.
309360030825156507     EXEC SQL
309370030825156507       INCLUDE CPYSTMT79
309380030825156507     END-EXEC.
309381210914      * RFS186199 - Begin
309382210914           EXEC SQL
309383210914             INCLUDE CPYSTMT14
309384210914           END-EXEC.
309385210914           EXEC SQL
309386210914             INCLUDE CPYST40MDB
309387210914           END-EXEC.
309388210914      * RFS186199 - Begin
309390999999       SQLLOG.
309400999999           CALL "SQLLOG"     USING WS-CALLING-PROGRAM
309410999999                                   WS-SQLERR-STATEMENT
309420999999                                   SQLCODE
309430999999                                   SQLERRD(1)
309440999999                                   SQLERRD(2)
309450999999                                   SQLERRD(3)
309460999999                                   SQLERRD(4)
309470999999                                   SQLERRD(5)
309480999999                                   SQLERRD(6)
309490999999                                   SQLSTATE
309500190111                                   WS-SQLERR-DATA
309510999999                                   WS-SQL-STATS
309520999999                                   WS-SQLERR-REPLY.
309530999999           CANCEL "SQLLOG".
309540999999           GOBACK.
